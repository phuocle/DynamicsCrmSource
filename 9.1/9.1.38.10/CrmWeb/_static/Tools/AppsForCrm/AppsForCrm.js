Type.registerNamespace("Mscrm.AppsForCrm");Mscrm.AppsForCrm.ScheduleCRMAppPerUserInstallResult=function(){};Mscrm.AppsForCrm.ScheduleCRMAppPerUserInstallResult.prototype={notInstalled:0,installed:1,installFailed:2,unInstallFailed:3,alreadyAdded:4,pending:5};Mscrm.AppsForCrm.ScheduleCRMAppPerUserInstallResult.registerEnum("Mscrm.AppsForCrm.ScheduleCRMAppPerUserInstallResult",false);Mscrm.AppsForCrm.ScheduleCRMAppInstallResult=function(){};Mscrm.AppsForCrm.ScheduleCRMAppInstallResult.prototype={failure:0,success:1,none:2};Mscrm.AppsForCrm.ScheduleCRMAppInstallResult.registerEnum("Mscrm.AppsForCrm.ScheduleCRMAppInstallResult",false);Mscrm.AppsForCrm.AppsForCrm=function(){this.$$d_$o_0=Function.createDelegate(this,this.$o_0);this.$$d_$m_0=Function.createDelegate(this,this.$m_0);this.$$d_$r_0=Function.createDelegate(this,this.$r_0);this.$$d_$l_0=Function.createDelegate(this,this.$l_0);this.$$d_$n_0=Function.createDelegate(this,this.$n_0)};Mscrm.AppsForCrm.AppsForCrm.$q=function($p0){var $v_0=$p0.get_organizationServiceFault();if(!IsNull($v_0)){var $v_1=$v_0.get_errorCode();Xrm.Internal.openErrorDialog($v_1,$p0.get_message())}};Mscrm.AppsForCrm.AppsForCrm.prototype={$j_0:null,$I_0:null,$L_0:null,$K_0:null,$J_0:null,$6_0:null,$9_0:null,$7_0:null,$M_0:null,$8_0:null,$T_0:null,$Q_0:null,$c_0:null,$D_0:null,$1_0:null,$Z_0:null,$Y_0:null,$X_0:null,$W_0:null,$2_0:null,$h_0:null,$e_0:null,$P_0:null,$E_0:null,$R_0:null,$F_0:false,$G_0:false,$H_0:false,$V_0:false,$f_0:null,$g_0:null,Initialize:function(){this.$T_0=$get("cmdOutlookClient");!IsNull(this.$T_0)&&$addHandler(this.$T_0,"click",this.$$d_$n_0);this.$j_0=$get("mailAppSection");this.$I_0=$get("mailAppErrorOrgServerSideSyncSetup");this.$E_0=$get("installErrorMessage");if(!IsNull(this.$I_0))this.$I_0.style.display="none";this.$L_0=$get("mailAppErrorUserServerSideSyncSetup");if(!IsNull(this.$L_0))this.$L_0.style.display="none";this.$K_0=$get("mailAppErrorUserPrivilege");if(!IsNull(this.$K_0))this.$K_0.style.display="none";this.$J_0=$get("mailAppErrorServerNotIFDEnabled");if(!IsNull(this.$J_0))this.$J_0.style.display="none";this.$6_0=$get("mailAppErrorAlreadyAdded");if(!IsNull(this.$6_0))this.$6_0.style.display="none";this.$9_0=$get("mailAppSuccessMessage");if(!IsNull(this.$9_0))this.$9_0.style.display="none";this.$7_0=$get("mailAppErrorPending");if(!IsNull(this.$7_0))this.$7_0.style.display="none";this.$M_0=$get("mailAppInstallFailedHelp");if(!IsNull(this.$M_0))this.$M_0.style.display="none";this.$8_0=$get("mailAppFooter");if(!IsNull(this.$8_0))this.$8_0.style.display="";this.$h_0=$get("popupMessage");this.$e_0=$get("closePopupMessage");this.$1_0=$get("detailMessagePopup");if(!IsNull(this.$1_0))this.$1_0.style.display="none";this.$Q_0=$get("cmdMailApp");!IsNull(this.$Q_0)&&$addHandler(this.$Q_0,"click",this.$$d_$l_0);this.$Z_0=$get("readdLink");!IsNull(this.$Z_0)&&$addHandler(this.$Z_0,"click",this.$$d_$l_0);this.$c_0=$get("tryAgainLink");!IsNull(this.$c_0)&&$addHandler(this.$c_0,"click",this.$$d_$l_0);this.$D_0=$get("dynamicHelpLink");this.$Y_0=$get("learnMoreUserPrivLink");!IsNull(this.$Y_0)&&$addHandler(this.$Y_0,"click",this.$$d_$r_0);this.$X_0=$get("learnMoreSSSUserLink");!IsNull(this.$X_0)&&$addHandler(this.$X_0,"click",this.$$d_$r_0);this.$W_0=$get("learnMoreSSSOrgLink");!IsNull(this.$W_0)&&$addHandler(this.$W_0,"click",this.$$d_$r_0);this.$P_0=$get("closePopupMessage");!IsNull(this.$P_0)&&$addHandler(this.$P_0,"click",this.$$d_$m_0);this.$R_0=$get("detailsExpand");this.$2_0=$get("detailsLink");!IsNull(this.$2_0)&&$addHandler(this.$2_0,"click",this.$$d_$o_0);this.$F_0=window.IsServerSideSyncEnabledForOrg;this.$G_0=window.IsServerSideSyncEnabledForUser;this.$H_0=window.IsUserHasCrmAppForOutlookPrivilege;this.$V_0=window.IsOnPremServerIFDEnabled},ApplicationOnLoad:function(){!this.$V_0&&this.$0_0("EnableIFDServerErrorMessage");if(this.$F_0&&this.$G_0&&this.$H_0){this.$t_0();this.$p_0()}else{this.$4_0(false);!this.$F_0&&this.$0_0("EnableOrgServerSideSyncErrorMessage");!this.$G_0&&this.$0_0("EnableUserServerSideSyncErrorMessage");!this.$H_0&&this.$0_0("EnableUserPrivilegeErrorMessage")}},$l_0:function($p0){var $v_0=false;if(!IsNull($p0.target)){$v_0=!IsNull($p0.target.id)&&$p0.target.id==="readdLink"?true:false;var $v_1=$p0.target.parentNode;if($v_0)this.$6_0.style.display="none";else this.$7_0.style.display="none"}if(!this.$V_0){this.$0_0("EnableIFDServerErrorMessage");return}if(!this.$F_0){this.$0_0("EnableOrgServerSideSyncErrorMessage");return}else if(!this.$G_0){this.$0_0("EnableUserServerSideSyncErrorMessage");return}else if(!this.$H_0){this.$0_0("EnableUserPrivilegeErrorMessage");return}else{var $v_2=new RemoteCommand("MailboxService","AddAppForOutlookForCurrentUser");$v_2.SetParameter("readd",$v_0);var $v_3=$v_2.Execute(),$v_4=new Mscrm.AppsForCrm.ReturnInstallStatusFromXml($v_3.ReturnValue);if($v_4.resultStatus===(4).toString())this.$0_0("EnableAppAlreadyAddedErrorMessage");else if($v_4.resultStatus===(1).toString())this.$0_0("EnableAppSuccessMessage");else if($v_4.resultStatus===(2).toString()){$v_4.exceptionMessage.length&&XUI.Html.SetText(this.$E_0,$v_4.exceptionMessage);this.$0_0("EnableAppErrorMessage")}else if($v_4.resultStatus===(5).toString())this.$0_0("EnableAppPendingMessage");else if($v_4.resultStatus===(0).toString())this.$0_0("EnableAppErrorMessage");else{XUI.Html.SetText(this.$E_0,$v_4.exceptionMessage);this.$0_0("EnableAppErrorMessage")}}},$0_0:function($p0){this.$4_0(false);switch($p0){case "EnableOrgServerSideSyncErrorMessage":this.$I_0.style.display="";break;case "EnableUserServerSideSyncErrorMessage":this.$L_0.style.display="";break;case "EnableUserPrivilegeErrorMessage":this.$K_0.style.display="";break;case "EnableIFDServerErrorMessage":this.$J_0.style.display="";break;case "EnableAppAlreadyAddedErrorMessage":this.$6_0.style.display="";break;case "EnableAppSuccessMessage":this.$9_0.style.display="";break;case "EnableAppErrorMessage":this.$7_0.style.display="";break;case "EnableAppPendingMessage":this.$9_0.style.display="";break}},$n_0:function($p0){var $v_0="";if($get("SignupOutlookDownloadFWLink")){var $v_4=$get("SignupOutlookDownloadFWLink");$v_0=$v_4.value}var $v_1={};$v_1["downloadUrl"]=$v_0.toString();var $v_2=Mscrm.CrmUri.create("/_grid/cmds/dlg_downloadoutlookclient.aspx"),$v_3=new Xrm.DialogOptions;$v_3.height=370;$v_3.width=640;Xrm.Internal.openDialog($v_2.toString(),$v_3,$v_1,null,null)},$r_0:function($p0){if(!IsNull($p0.target)){var $v_1="";if($p0.target.id==="learnMoreSSSUserLink")$v_1=window.LOCID_APPSFORCRM_USERSSS;else if($p0.target.id==="learnMoreSSSOrgLink")$v_1=window.LOCID_APPSFORCRM_ORGSSS;else if($p0.target.id==="learnMoreUserPrivLink")$v_1=window.LOCID_APPSFORCRM_USERPRIV;XUI.Html.SetText(this.$h_0,$v_1);this.$1_0.style.display=""}var $v_0=$get($p0.target.id);this.$1_0.style.left=$v_0.parentNode.offsetLeft+$v_0.parentNode.clientWidth+"px";this.$1_0.style.top=$v_0.parentNode.offsetTop+$v_0.parentNode.clientHeight+"px";this.$e_0.focus()},$m_0:function($p0){this.$1_0.style.display="none"},$o_0:function($p0){this.$R_0.style.visibility="visible";this.$R_0.style.display=""},$t_0:function(){this.$f_0=Xrm.Page.context.getUserId();var $v_0=new RemoteCommand("MailboxService","RetrieveDefaultMailboxId",null);$v_0.SetParameter("objectId",this.$f_0);$v_0.SetParameter("objectTypeCode",8);var $v_1=$v_0.Execute();this.$g_0=$v_1.ReturnValue},$p_0:function(){var $$t_A=this;Xrm.Internal.messages.retrieve("mailbox",this.$g_0,["officeappsdeploymentscheduled","officeappsdeploymentstatus","officeappsdeploymenterror"]).then(function($p1_0){var $v_0=$p1_0.entity,$v_1=parseInt($v_0.getValue("officeappsdeploymentscheduled").getValue("value").toString()),$v_2="";if(!IsNull($v_0.getValue("officeappsdeploymenterror")))$v_2=$v_0.getValue("officeappsdeploymenterror").toString();if($v_1===1){$$t_A.$0_0("EnableAppPendingMessage");$$t_A.$4_0(false)}else if(!$v_1){var $v_3=parseInt($v_0.getValue("officeappsdeploymentstatus").getValue("value").toString());if(!$v_3)$$t_A.$4_0(true);else if($v_3===1){$$t_A.$0_0("EnableAppAlreadyAddedErrorMessage");$$t_A.$4_0(false)}else if($v_3===2){$$t_A.$0_0("EnableAppErrorMessage");var $v_4="MailAppDeploymentException",$v_5=$v_2.split("##");if(!IsNull($v_5)&&$v_5.length===2){XUI.Html.SetText($$t_A.$E_0,$v_5[1]);var $v_6=$v_5[0].split(":"),$v_7=$v_6.length>=1?$v_6[0]:"",$v_8=$v_6.length>=2?$v_6[1]:"";if($v_7!==""&&$v_8!=="")$v_4+=CrmEncodeDecode.CrmUrlEncode(String.format("&{0}:{1}",$v_7,$v_8))}$$t_A.$M_0.style.display="";if(!IsNull($$t_A.$D_0)){$$t_A.$D_0.href=String.format("http://go.microsoft.com/fwlink/?LinkID=398563&lcid={0}&client=MailApp&error={1}",window.USER_LANGUAGE_CODE,$v_4);$$t_A.$D_0.target="_blank"}$$t_A.$4_0(false)}}},Mscrm.AppsForCrm.AppsForCrm.$q)},$4_0:function($p0){if($p0)this.$8_0.style.display="";else this.$8_0.style.display="none"}};Mscrm.AppsForCrm.AppsForCrmAdminSettings=function(){this.$$d_$u_0=Function.createDelegate(this,this.$u_0);this.$$d_$w_0=Function.createDelegate(this,this.$w_0);this.$$d_$k_0=Function.createDelegate(this,this.$k_0);this.$$d_$s_0=Function.createDelegate(this,this.$s_0)};Mscrm.AppsForCrm.AppsForCrmAdminSettings.SetQuickFindViewId=function(){var $v_0=$find("crmGrid_SavedNewQuerySelector");if(!IsNull($v_0)&&$v_0.showNewVSControl&&!$v_0.showOriginalSelectBox)$v_0.quickFindQuery="0ed008ba-5b1e-47c3-9d89-2bcbe8143c76"};Mscrm.AppsForCrm.AppsForCrmAdminSettings.prototype={$N_0:null,$O_0:null,$b_0:null,$i_0:null,$U_0:null,$d_0:null,$5_0:null,$a_0:null,$S_0:null,$B_0:null,$A_0:null,$C_0:null,ApplicationOnLoad:function(){this.$a_0=$get("save");!IsNull(this.$a_0)&&$addHandler(this.$a_0,"click",this.$$d_$s_0);this.$5_0=$find("crmGrid");this.$k_0(null,null);if(!IsNull(this.$5_0)){this.$5_0.add_onSelectionChange(this.$$d_$k_0);Mscrm.AppsForCrm.AppsForCrmAdminSettings.SetQuickFindViewId()}this.$S_0=$get("doneLink");!IsNull(this.$S_0)&&$addHandler(this.$S_0,"click",this.$$d_$w_0);this.$N_0=$get("setupBody");this.$O_0=$get("showLink");this.$b_0=$get("showSpan");this.$d_0=$get("autoAddCheckbox");!IsNull(this.$O_0)&&$addHandler(this.$O_0,"click",this.$$d_$w_0);this.$i_0=$get("crmappBody");this.$U_0=$get("gridContainer");this.$C_0=$get("autoAddTooltipText");this.$B_0=$get("seeMoreLink");!IsNull(this.$B_0)&&$addHandler(this.$B_0,"click",this.$$d_$u_0);this.$A_0=$get("seeLessLink");!IsNull(this.$A_0)&&$addHandler(this.$A_0,"click",this.$$d_$u_0)},$k_0:function($p0,$p1){if(!IsNull(this.$5_0)){var $v_0=$get("appForSelectedUsersCommandBtnId");if(this.$5_0.get_innerGrid().get_selectedRecords().length>0)$v_0.style.display="";else $v_0.style.display="none"}},ScheduleCRMAppInstallOnSave:function(isAutoAddEnabled,gridId){var $v_0;if(isAutoAddEnabled){var $v_1=new RemoteCommand("MailboxService","ScheduleCRMAppInstallForAllUsers",null);$v_0=$v_1.Execute();var $v_2=new Mscrm.AppsForCrm.ReturnInstallStatusFromXml($v_0.ReturnValue),$v_3=$find(gridId);if($v_2.resultStatus===(1).toString())$v_3.Refresh();else if($v_2.resultStatus===(2).toString())!IsNull($v_2.exceptionMessage)&&Xrm.Utility.alertDialog($v_2.exceptionMessage,null)}else{var $v_4=new RemoteCommand("MailboxService","UpdateIsOfficeAppsAutoDeploymentSetting",null);$v_4.SetParameter("enableAutoDeployForAllUsers",false);$v_0=$v_4.Execute()}},ScheduleCRMAppInstallForSelectedUsers:function(gridId){var $v_0=$find(gridId),$v_1,$v_2=new RemoteCommand("MailboxService","ScheduleCRMAppInstallForSelectedUsers",null);$v_2.SetParameter("selectedMailboxIds",$v_0.get_selectedIds().join(","));$v_1=$v_2.Execute();var $v_3=new Mscrm.AppsForCrm.ReturnInstallStatusFromXml($v_1.ReturnValue);if($v_3.resultStatus===(1).toString())$v_0.Refresh();else if($v_3.resultStatus===(2).toString())!IsNull($v_3.exceptionMessage)&&Xrm.Utility.alertDialog($v_3.exceptionMessage,null)},OpenInstallStatusDetailsDialog:function(mailboxid,scheduled){var $v_0=Mscrm.CrmUri.create("/_grid/cmds/dlg_appforoutlookinstallstatusdetails.aspx");$v_0.get_query()["mailboxid"]=mailboxid;$v_0.get_query()["scheduled"]=scheduled;var $v_1=new Xrm.DialogOptions;if(scheduled==="true"){$v_1.height=220;$v_1.width=600}else{$v_1.height=240;$v_1.width=600}Xrm.Internal.openDialog($v_0.toString(),$v_1,null,null,null)},$w_0:function($p0){if(this.$N_0.style.display==="none"){this.$N_0.style.display="";this.$b_0.style.display="none";this.$U_0.style.height="24%"}else{this.$N_0.style.display="none";this.$b_0.style.display="";this.$O_0.title=window.LOCID_SETTINGS_SHOW;this.$U_0.style.height="47%"}},$s_0:function($p0){var $v_0=this.$d_0.checked;this.ScheduleCRMAppInstallOnSave($v_0,"crmGrid")},$u_0:function($p0){if(this.$C_0.style.display==="none"){this.$C_0.style.display="";this.$A_0.style.display="";this.$B_0.style.display="none"}else{this.$C_0.style.display="none";this.$A_0.style.display="none";this.$B_0.style.display=""}}};Mscrm.AppsForCrm.ReturnInstallStatusFromXml=function(result){var $v_0=XUI.Xml.LoadXml(result);this.resultStatus=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_0,"/result/ResultStatus",null));this.exceptionCode=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_0,"/result/ExceptionCode",null));this.exceptionType=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_0,"/result/ExceptionType",null));this.exceptionMessage=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_0,"/result/ExceptionMessage",null))};Mscrm.AppsForCrm.ReturnInstallStatusFromXml.prototype={resultStatus:null,exceptionCode:null,exceptionType:null,exceptionMessage:null};Mscrm.AppsForCrm.AppsForCrmInstallStatusDetails=function(){this.$$d_$v_0=Function.createDelegate(this,this.$v_0)};Mscrm.AppsForCrm.AppsForCrmInstallStatusDetails.prototype={$2_0:null,$3_0:null,ApplicationOnLoad:function(){this.$3_0=$get("exceptionDetails");if(!IsNull(this.$3_0))this.$3_0.style.display="none";this.$2_0=$get("detailsLink");!IsNull(this.$2_0)&&$addHandler(this.$2_0,"click",this.$$d_$v_0)},$v_0:function($p0){var $v_0=window.parent.document.getElementById("InlineDialog");if(!IsNull($v_0))if(this.$3_0.style.display==="none"){this.$3_0.style.display="";$v_0.style.height="400px";$v_0.firstChild.style.height="400px"}else{this.$3_0.style.display="none";$v_0.style.height="240px";$v_0.firstChild.style.height="240px"}}};Mscrm.AppsForCrm.AppsForCrm.registerClass("Mscrm.AppsForCrm.AppsForCrm");Mscrm.AppsForCrm.AppsForCrmAdminSettings.registerClass("Mscrm.AppsForCrm.AppsForCrmAdminSettings");Mscrm.AppsForCrm.ReturnInstallStatusFromXml.registerClass("Mscrm.AppsForCrm.ReturnInstallStatusFromXml");Mscrm.AppsForCrm.AppsForCrmInstallStatusDetails.registerClass("Mscrm.AppsForCrm.AppsForCrmInstallStatusDetails")