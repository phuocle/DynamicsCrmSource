Type.registerNamespace("Mscrm");Mscrm.MobileOfflineProvisioningHelper=function(){};Mscrm.MobileOfflineProvisioningHelper.get_$4=function(){return Mscrm.CrmUri.create("/Tools/MobileOffline/cmds/cmd_update.aspx")};Mscrm.MobileOfflineProvisioningHelper.alertOnDisable=function(){var $v_0=$get("mobileOfflineEnable"),$v_1=Mscrm.MobileOfflineProvisioningHelper.$1(),$v_2=new Xrm.ConfirmDialogStrings;$v_2.text=Xrm.Internal.getResourceString("LOCID_MOP_DISABLE_ALERT_MSG");$v_2.title=Xrm.Internal.getResourceString("LOCID_MOP_DISABLE_ALERT_TITLE");Xrm.Dialog.openConfirmDialog($v_2,$v_1,function(){var $v_3=$get("mobileOfflineConfigurationSave");if($v_3)$v_3.disabled=false},function(){$v_0.checked=true;var $v_4=$get("mobileOfflineConfigurationSave");if($v_4)$v_4.disabled=true})};Mscrm.MobileOfflineProvisioningHelper.alertForDeprovisioning=function(){var $v_0=Mscrm.MobileOfflineProvisioningHelper.$1(),$v_1=new Xrm.ConfirmDialogStrings;$v_1.text=Xrm.Internal.getResourceString("LOCID_MOP_DISABLE_ALERT_MSG");$v_1.title=Xrm.Internal.getResourceString("LOCID_MOP_DISABLE_ALERT_TITLE");Xrm.Dialog.openConfirmDialog($v_1,$v_0,function(){Mscrm.MobileOfflineProvisioningHelper.$3()},function(){$get("buttonConfigure").disabled=false})};Mscrm.MobileOfflineProvisioningHelper.alertForStopProvisioning=function(){var $v_0=Mscrm.MobileOfflineProvisioningHelper.$1(),$v_1=new Xrm.ConfirmDialogStrings;$v_1.text=Xrm.Internal.getResourceString("LOCID_MOP_STOP_PROVI_ALERT_MSG");$v_1.title=Xrm.Internal.getResourceString("LOCID_MOP_STOP_PROVI_ALERT_TITLE");Xrm.Dialog.openConfirmDialog($v_1,$v_0,function(){Mscrm.MobileOfflineProvisioningHelper.$3()},function(){$get("buttonConfigure").disabled=false})};Mscrm.MobileOfflineProvisioningHelper.switchMobileOfflineForOrganization=function(isEnabled,newUI){var $v_0,$v_1=false;if(newUI){$v_0=$get("buttonConfigure");$v_1=isEnabled}else{var $v_4=$get("mobileOfflineEnable"),$v_5=$get("mobileOfflineDisable"),$v_6=$get("enableStatusLabel"),$v_7=$get("disableStatusLabel");if(isEnabled===$v_4.checked)return false;$v_4.disabled=true;$v_5.disabled=true;Sys.UI.DomElement.addCssClass($get("MobileOfflineEnableDiv"),"hide");Sys.UI.DomElement.addCssClass($get("MobileOfflineDisableDiv"),"hide");if($v_4.checked){$v_7.innerHTML="";$v_6.innerHTML=Xrm.Internal.getResourceString("LOCID_MOP_STATUS_INPROCESS")}if($v_5.checked){$v_6.innerHTML="";$v_7.innerHTML=Xrm.Internal.getResourceString("LOCID_MOP_STATUS_INPROCESS")}$v_0=$get("mobileOfflineConfigurationSave");$v_1=$v_4.checked}var $v_2=true,$v_3=Mscrm.MobileOfflineProvisioningHelper.$6($v_1);$v_3.done(function(){if($v_0)$v_0.disabled=true;window.location.reload()});$v_3.fail(function(){Xrm.Internal.trace.error("MobileOfflineProvisioningHelper","SwitchMobileOfflineForOrganization : Received Failed response from Crm");if($v_0){$v_0.disabled=false;$v_2=false}});return $v_2};Mscrm.MobileOfflineProvisioningHelper.$6=function($p0){var $v_0="<ProvisioningRequest>\r\n\t\t\t\t\t<ismobileofflineenabled>{0}</ismobileofflineenabled>\r\n\t\t\t\t</ProvisioningRequest>",$v_1=String.format($v_0,$p0?"enabled":"disabled");return Mscrm.MobileOfflineProvisioningHelper.$B($v_1)};Mscrm.MobileOfflineProvisioningHelper.$B=function($p0){var $v_0=new jQueryAjaxOptions;$v_0.beforeSend=function($p1_0){Mscrm.WrpcTokenFuncs.setTokenInHeader($p1_0,Mscrm.MobileOfflineProvisioningHelper.get_$4())};$v_0.url=Mscrm.MobileOfflineProvisioningHelper.get_$4().toString();$v_0.type="POST";$v_0.data=$p0;return $P_CRM.ajax($v_0)};Mscrm.MobileOfflineProvisioningHelper.$3=function(){var $v_0=$get("sendStatus");$v_0.click()};Mscrm.MobileOfflineProvisioningHelper.$1=function(){var $v_0=new Xrm.DialogOptions;$v_0.height=200;$v_0.width=500;return $v_0};Mscrm.MobileOfflineProvisioningHelper.updateUI=function(response){var $v_0=Sys.Serialization.JavaScriptSerializer.deserialize(response);if(!$v_0["ShowProgressBlock"]){$get("progressBlock").className="nodisplay";return true}$get("progressState").innerHTML=$v_0["ProgressState"].toString();$get("progressStatus").innerHTML=$v_0["ProgressStatus"].toString();$get("lastUpdate").innerHTML=$v_0["LastUpdateString"].toString();var $v_1=$v_0["MobileOfflineDataSyncProgress"]?$v_0["MobileOfflineDataSyncProgress"].toString():"",$v_2=$v_0["MobileOfflineDeprovisionReason"]?$v_0["MobileOfflineDeprovisionReason"].toString():"";Mscrm.MobileOfflineProvisioningHelper.$A($v_2);var $v_3=$v_0["ProgressBar"],$v_4="",$v_5=false;switch($v_3){case 0:$v_4="orange";break;case 1:$v_4="red";$v_5=true;break;case 2:$v_4="green";$v_5=true;break}$get("progressBar").className=$v_4;var $v_6=$get("buttonConfigure"),$v_7=CrmEncodeDecode.CrmHtmlDecode($v_0["ConfigureButtonLabel"].toString());$v_6.accessKey=Mscrm.Utilities.getAccessKey($v_7);$v_6.innerHTML=Mscrm.Utilities.decorateAccessKey($v_7);$v_6.title=$v_7;$v_6.disabled=$v_0["DisableConfigButton"];$v_6.setAttribute("requestType",$v_0["RequestType"].toString());if($v_0["ShouldShowDataSyncProgressUi"]&&!Mscrm.InternalUtilities._String.isNullOrEmpty($v_1)){var $v_8=$v_0["IsProvisioningCompleted"];Mscrm.MobileOfflineProvisioningHelper.$8($v_1,$v_8);Mscrm.MobileOfflineProvisioningHelper.$9($v_1);Mscrm.MobileOfflineProvisioningHelper.$0("EntityStatusDetailContainer",true);Mscrm.MobileOfflineProvisioningHelper.$0("lastUpdate",false);if($v_8){Mscrm.MobileOfflineProvisioningHelper.$7();Mscrm.MobileOfflineProvisioningHelper.$0("timerContainer",false)}else Mscrm.MobileOfflineProvisioningHelper.$0("timerContainer",true)}else{Mscrm.MobileOfflineProvisioningHelper.$0("EntityStatusDetailContainer",false);Mscrm.MobileOfflineProvisioningHelper.$0("lastUpdate",true)}return $v_5};Mscrm.MobileOfflineProvisioningHelper.$A=function($p0){if(!Mscrm.InternalUtilities._String.isNullOrEmpty($p0)){var $v_0=Sys.Serialization.JavaScriptSerializer.deserialize($p0),$v_1=false,$v_2="";if(Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.toString(2) in $v_0){$v_1=true;$v_2=Xrm.Internal.getResourceString("LOCID_ERROR_UNKNOWNFAILURE")}else if(Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.toString(0) in $v_0){$v_1=true;$v_2=Xrm.Internal.getResourceString("LOCID_ERROR_METADATAFAILED")}else if(Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.toString(1) in $v_0){$v_1=true;var $v_4=$v_0[Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.toString(1)]?$v_0[Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.toString(1)].toString():"";$v_2=String.format(Xrm.Internal.getResourceString("LOCID_ERROR_ENTITYDOWNLOADFAILED"),$v_4)}var $v_3=$get("deprovisionReasonMessageContainerId");if($v_1&&$v_3){$v_3.innerHTML=$v_2;$v_3.style.display="block"}else Mscrm.MobileOfflineProvisioningHelper.$0("deprovisionReasonMessageContainerId",false)}else Mscrm.MobileOfflineProvisioningHelper.$0("deprovisionReasonMessageContainerId",false)};Mscrm.MobileOfflineProvisioningHelper.$8=function($p0,$p1){var $v_0=$find("mobileOfflineProvisioningInitialDataDownloadProgressGrid");if($v_0){$v_0.SetParameter("refreshGridOnDemand","0");$v_0.SetParameter("gridjsondata",$p0);$v_0.SetParameter("IsProvisioningCompleted",$p1.toString());$p1&&Mscrm.MobileOfflineProvisioningHelper.$5();$v_0.Refresh();$v_0.SetParameter("refreshGridOnDemand",$p1?"1":"0")}};Mscrm.MobileOfflineProvisioningHelper.$5=function(){var $v_0=$P_CRM("th[field =recordsremaining]");if($v_0){$v_0.hide();$v_0.next("td").hide()}};Mscrm.MobileOfflineProvisioningHelper.$0=function($p0,$p1){var $v_0=$get($p0);if($v_0)$v_0.style.display=$p1?"block":"none"};Mscrm.MobileOfflineProvisioningHelper.$7=function(){var $v_0=$get("userMessage_text");if($v_0)$v_0.innerHTML=Xrm.Internal.getResourceString("LOCID_MOP_USER_MESSAGE_TEXT");var $v_1=$get("tabTextId");if($v_1)$v_1.innerHTML=Xrm.Internal.getResourceString("LOCID_MOP_TAB_ENT_STATUS_TEXT")};Mscrm.MobileOfflineProvisioningHelper.$9=function($p0){for(var $v_0=0,$v_1=0,$v_2=0,$v_3=0,$v_4=Sys.Serialization.JavaScriptSerializer.deserialize($p0),$$arr_6=$v_4,$$len_7=$$arr_6.length,$$idx_8=0;$$idx_8<$$len_7;++$$idx_8){var $v_9=$$arr_6[$$idx_8],$v_A=0;if("TotalRecords" in $v_9&&$v_9["TotalRecords"]){var $v_C=parseInt($v_9["TotalRecords"].toString(),10);$v_A=!isNaN($v_C)?$v_C:0}var $v_B=0;if("DownloadedRecords" in $v_9&&$v_9["DownloadedRecords"]){var $v_D=parseInt($v_9["DownloadedRecords"].toString(),10);$v_B=!isNaN($v_D)?$v_D:0}if($v_A>=$v_B){$v_1+=$v_B;$v_0+=$v_A;if("EstimatedTimeOfDownloadCompletionInMinutes" in $v_9&&$v_9["EstimatedTimeOfDownloadCompletionInMinutes"]){var $v_E=parseInt($v_9["EstimatedTimeOfDownloadCompletionInMinutes"].toString(),10);if(!isNaN($v_E)&&$v_E>$v_3)$v_3=$v_E}}}if($v_0>=$v_1&&$v_1>0)$v_2=Math.floor($v_1*100/$v_0);var $v_5=Math.floor($v_3/60),$v_6=$v_3%60,$v_7=$get("remainingTimeLabel"),$v_8=$get("totalPercentageCompletedLabel");if($v_7&&$v_3>0)$v_7.innerHTML=String.format(Xrm.Internal.getResourceString("LOCID_MOP_REM_TIME_LEFT_MSG"),$v_5,$v_6);else $v_7.innerHTML=String.format(Xrm.Internal.getResourceString("LOCID_MOP_REM_TIME_CALC_MSG"));if($v_8)$v_8.innerHTML=String.format(Xrm.Internal.getResourceString("LOCID_MOP_TOTAL_PER_COMP_MSG"),$v_1,$v_0,$v_2)};Mscrm.MobileOfflineProvisioningHelper.ProgressColor=function(){};Mscrm.MobileOfflineProvisioningHelper.ProgressColor.prototype={orange:0,red:1,green:2};Mscrm.MobileOfflineProvisioningHelper.ProgressColor.registerEnum("Mscrm.MobileOfflineProvisioningHelper.ProgressColor",false);Mscrm.MobileOfflineProvisioningHelper.RequestType=function(){};Mscrm.MobileOfflineProvisioningHelper.RequestType.prototype={none:0,provision:1,stopProvisioning:2,deprovision:3};Mscrm.MobileOfflineProvisioningHelper.RequestType.registerEnum("Mscrm.MobileOfflineProvisioningHelper.RequestType",false);Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason=function(){};Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.prototype={metadataDownloadFailed:0,mandatoryEntityInitialDataDownloadFailed:1,provisioningFailed:2,customer:3};Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason.registerEnum("Mscrm.MobileOfflineProvisioningHelper.DeprovisioningReason",false);Mscrm.MobileOfflineProvisioningHelper.registerClass("Mscrm.MobileOfflineProvisioningHelper")