Type.registerNamespace("Mscrm");Mscrm.PickListMappingEdit=function($p0){this.$$d_$M_3=Function.createDelegate(this,this.$M_3);this.$$d_$N_3=Function.createDelegate(this,this.$N_3);this.$3_3=-1;Mscrm.PickListMappingEdit.initializeBase(this,[$p0])};Mscrm.PickListMappingEdit.prototype={$2_3:null,$1_3:null,$5_3:null,$0_3:null,$8_3:false,$9_3:null,$A_3:false,get_selectedValue:function(){return this.$0_3.get_selectedValue()},set_selectedValue:function(value){var $v_0=IsNull(value)?value:Number.parseInvariant(value.toString());if(!this.$8_3){var $v_1=this.$0_3.get_selectedValue();this.$0_3.setSelectedValue($v_0);for(var $v_2=0,$v_3=0,$v_4=this.$0_3.get_valuesCollection().length,$v_5=0;$v_5<$v_4;$v_5++){var $v_6=this.$6_3($v_5).get_value();if($v_1===$v_6)$v_2=$v_5;else if($v_0===$v_6)$v_3=$v_5}this.$0_3.set_selectedValue(!IsNull($v_3)?$v_0:-1);this.$K_3($v_2);this.$F_3($v_3)}return value},get_selectedParentValue:function(){return this.$3_3},set_selectedParentValue:function(value){this.$3_3=value;return value},get_isReadOnlyMode:function(){return this.$A_3},set_isReadOnlyMode:function(value){this.$A_3=value;return value},get_disabled:function(){return this.$8_3},set_disabled:function(value){this.$8_3=value;return value},get_initialXml:function(){return this.$9_3},set_initialXml:function(value){this.$9_3=value;return value},get_$J_3:function(){return this.get_element().id},get_values:function(){return this.$0_3},set_values:function(value){this.$0_3=value;this.$O_3();return value},$O_3:function(){this.$I_3();this.$H_3()},resetControl:function(){this.$0_3.resetSelectedValue();this.$F_3(-1)},$I_3:function(){for(var $v_0=new Sys.StringBuilder("<ul>"),$v_1=-1,$v_2=this.get_element().id,$v_3=this.$0_3.get_valuesCollection().length,$v_4=0;$v_4<$v_3;$v_4++){var $v_5=this.$6_3($v_4),$v_6=$v_5.get_value();if($v_5.get_editable()){$v_0.append("<li tabindex='-1'");$v_0.append(String.format("id={0} ",$v_6));$v_0.append(String.format("selected={0} ",0));$v_0.append("><a class='ms-crm-Anchor-ChildOptionList'");var $v_7=' onmousedown="$find('+CrmEncodeDecode.CrmJavaScriptEncode(this.get_$J_3())+").selectRow(event, "+$v_6+');" ';$v_0.append($v_7);$v_0.append("><label style='display:block;'>");$v_0.append(String.format("<input type='checkbox' tabindex='-1' onclick='return false;' class='ms-crm-CheckBox ms-crm-CheckBox-ChildOptionList' id={0}_{1}",CrmEncodeDecode.CrmHtmlAttributeEncode($v_2),$v_6));$v_0.append(String.format(">{0}</label></a></li>",CrmEncodeDecode.CrmHtmlEncode($v_5.get_label())))}}$v_0.append("</ul>");this.$C_3("divValueList").innerHTML=$v_0.toString()},selectRow:function(eventObject,elementValue){var $v_0=eventObject.target;while($v_0.tagName!=="LI"){$v_0=$v_0.parentNode;if(IsNull($v_0))return}this.$1_3=$v_0;eventObject.preventDefault();var $v_1=$v_0.parentNode;this.$5_3=$v_1;if(IsNull(this.$2_3)||this.$4_3($v_1,this.$2_3)<0||!eventObject.shiftKey)this.$2_3=$v_0;!eventObject.ctrlKey&&this.$7_3($v_1);var $v_2=this.$D_3($v_0);if(!$v_2.disabled)if($v_2.checked)$v_2.checked=false;else $v_2.checked=true;this.$B_3($v_0);if(!eventObject.shiftKey)this.updateParentValues($v_2.checked,elementValue);else{this.$7_3($v_1);var $v_3=this.$4_3($v_1,this.$2_3),$v_4=this.$4_3($v_1,$v_0);$v_3>-1&&$v_4>-1&&this.$E_3($v_1,$v_3,$v_4,$v_2.checked)}},$E_3:function($p0,$p1,$p2,$p3){if($p1>$p2){this.$E_3($p0,$p2,$p1,$p3);return}for(var $v_0=$p1;$v_0<=$p2;$v_0++){this.$B_3($p0.childNodes[$v_0]);var $v_1=this.$D_3($p0.childNodes[$v_0]);$v_1.setActive();$v_1.checked=$p3;this.updateParentValues($p3,Number.parseInvariant($v_1.id.split("_")[1]))}},$4_3:function($p0,$p1){if(IsNull($p0)||IsNull($p1)||IsNull($p1.firstChild))return -1;for(var $v_0=$p0.childNodes.length-1;$v_0>=0;$v_0--)if($p0.childNodes[$v_0].id===$p1.id)return $v_0;return -1},$B_3:function($p0){if(IsNull($p0))return;Sys.UI.DomElement.addCssClass($p0,"ms-crm-Selected-ChildOption")},$7_3:function($p0){if(IsNull($p0))return;for(var $v_0=$p0.querySelectorAll("ms-crm-Selected-ChildOption"),$v_1=$v_0.length-1;$v_1>=0;$v_1--)Sys.UI.DomElement.removeCssClass($v_0[$v_1],"ms-crm-Selected-ChildOption")},$D_3:function($p0){return $p0.querySelector("input[type='checkbox']")},bindToParentValueControl:function(parentValueListControl){parentValueListControl.add_selectedItemChange(this.$$d_$N_3)},$N_3:function($p0,$p1){var $v_0=$p0;if(!IsNull($v_0))this.$3_3=$v_0.get_selectedValue();this.$H_3();!IsNull(this.$5_3)&&this.$7_3(this.$5_3)},$H_3:function(){for(var $v_0=this.$0_3.get_valuesCollection().length,$v_1=0;$v_1<$v_0;$v_1++){var $v_2=this.$6_3($v_1);if($v_2.get_value()===-2147483648)continue;var $v_3=$get(this.get_element().id+"_"+$v_2.get_value());if(IsNull(this.$3_3)||this.$3_3===-1){$v_3.checked=false;$v_3.disabled=true;continue}else{$v_3.disabled=this.$A_3;if(this.$3_3.toString() in $v_2.get_parentValues())$v_3.checked=true;else $v_3.checked=false}}},updateParentValues:function(state,elementValue){for(var $v_0=this.$3_3,$v_1=0;$v_1<this.$0_3.get_valuesCollection().length;$v_1++){var $v_2=this.$6_3($v_1);if($v_2.get_value()===elementValue){if(state)$v_2.addParentValue($v_0);else $v_2.removeParentValue($v_0);break}}},resetParentValues:function(){for(var $v_0=0;$v_0<this.$0_3.get_valuesCollection().length;$v_0++){var $v_1=this.$6_3($v_0);$v_1.clearParentValues()}},$6_3:function($p0){var $v_0=this.$0_3.get_valuesCollection()[$p0];return $v_0},$F_3:function($p0){this.$G_3($p0,"#c4ddff")},$K_3:function($p0){this.$G_3($p0,"#ffffff")},$G_3:function($p0,$p1){if(!IsNull($p0)){var $v_0=this.$C_3("val"+$p0);if(IsNull($v_0))return;$v_0.style.backgroundColor=$p1;$v_0.selected=$p1!=="#ffffff"}},$C_3:function($p0){return $get(String.format("{0}_{1}",this.get_element().id,$p0))},$M_3:function($p0){var $v_0,$v_1,$v_2=this.$C_3("divValueList"),$v_3=$v_2.firstChild;this.$5_3=$v_3;$p0.preventDefault();$p0.stopPropagation();if(IsNull($v_3))return;switch($p0.keyCode){case 40:$v_1=this.$4_3($v_3,this.$1_3);$v_0=($v_1+1)%$v_3.childNodes.length;if($v_0>=$v_3.childNodes.length)return;if(!$p0.shiftKey){this.$7_3($v_3);this.$2_3=$v_3.childNodes[$v_0]}else $v_3.childNodes[$v_0].className==="ms-crm-Selected-ChildOption"&&Sys.UI.DomElement.removeCssClass($v_3.childNodes[$v_1%$v_3.childNodes.length],"ms-crm-Selected-ChildOption");this.$B_3($v_3.childNodes[$v_0]);this.$1_3=$v_3.childNodes[$v_0];break;case 32:var $v_4=this.$4_3($v_3,this.$2_3),$v_5=this.$4_3($v_3,this.$1_3);this.$E_3($v_3,$v_4,$v_5,!this.$D_3(this.$1_3).checked);break;case 38:$v_1=this.$4_3($v_3,this.$1_3);$v_0=$v_1-1;if($v_0<0)$v_0=$v_3.childNodes.length-1;if(!$p0.shiftKey){this.$7_3($v_3);this.$2_3=$v_3.childNodes[$v_0]}else $v_3.childNodes[$v_0].className==="ms-crm-Selected-ChildOption"&&Sys.UI.DomElement.removeCssClass($v_3.childNodes[$v_1%$v_3.childNodes.length],"ms-crm-Selected-ChildOption");this.$B_3($v_3.childNodes[$v_0]);this.$1_3=$v_3.childNodes[$v_0];break;default:break}},initialize:function(){Mscrm.CrmUIControl.prototype.initialize.call(this);this.$0_3=new Mscrm.ValuesList;this.$0_3.deserialize(this.$9_3);$addHandler(this.get_element(),"keydown",this.$$d_$M_3)},dispose:function(){if(this.get_isDisposed())return;$removeHandler(this.get_element(),"keydown",this.$$d_$M_3);Mscrm.CrmUIControl.prototype.dispose.call(this)}};Mscrm.PickListMappingEdit.registerClass("Mscrm.PickListMappingEdit",Mscrm.CrmUIControl);Mscrm.PickListMappingEdit.highlighT_COLOR="#c4ddff";Mscrm.PickListMappingEdit.diM_COLOR="#ffffff"