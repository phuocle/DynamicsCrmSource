!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?(module.exports=t()):"function"==typeof define&&define.amd?define(t):(e.moment=t())}(this,function(){"use strict";var H;function _(){return H.apply(null,arguments)}function y(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function F(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function L(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;for(var t in e)if(c(e,t))return;return 1}function g(e){return void 0===e}function w(e){return "number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function V(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function G(e,t){for(var n=[],s=e.length,i=0;i<s;++i)n.push(t(e[i],i));return n}function E(e,t){for(var n in t)c(t,n)&&(e[n]=t[n]);return c(t,"toString")&&(e.toString=t.toString),c(t,"valueOf")&&(e.valueOf=t.valueOf),e}function l(e,t,n,s){return Wt(e,t,n,s,!0).utc()}function p(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function A(e){var t,n,s=e._d&&!isNaN(e._d.getTime());return s&&(t=p(e),n=j.call(t.parsedDateParts,function(e){return null!=e}),s=t.overflow<0&&!t.empty&&!t.invalidEra&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n),e._strict)&&(s=s&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e)?s:(e._isValid=s,e._isValid)}function I(e){var t=l(NaN);return null!=e?E(p(t),e):(p(t).userInvalidated=!0),t}var j=Array.prototype.some||function(e){for(var t=Object(this),n=t.length>>>0,s=0;s<n;s++)if(s in t&&e.call(this,t[s],s,t))return !0;return !1},Z=_.momentProperties=[],z=!1;function q(e,t){var n,s,i,r=Z.length;if(g(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),g(t._i)||(e._i=t._i),g(t._f)||(e._f=t._f),g(t._l)||(e._l=t._l),g(t._strict)||(e._strict=t._strict),g(t._tzm)||(e._tzm=t._tzm),g(t._isUTC)||(e._isUTC=t._isUTC),g(t._offset)||(e._offset=t._offset),g(t._pf)||(e._pf=p(t)),g(t._locale)||(e._locale=t._locale),0<r)for(n=0;n<r;n++)g(i=t[s=Z[n]])||(e[s]=i);return e}function $(e){q(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===z&&(z=!0,_.updateOffset(this),z=!1)}function k(e){return e instanceof $||null!=e&&null!=e._isAMomentObject}function B(e){!1===_.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function e(r,a){var o=!0;return E(function(){if(null!=_.deprecationHandler&&_.deprecationHandler(null,r),o){for(var e,t,n=[],s=arguments.length,i=0;i<s;i++){if(e="","object"==typeof arguments[i]){for(t in e+="\n["+i+"] ",arguments[0])c(arguments[0],t)&&(e+=t+": "+arguments[0][t]+", ");e=e.slice(0,-2)}else e=arguments[i];n.push(e)}B(r+"\nArguments: "+Array.prototype.slice.call(n).join("")+"\n"+(new Error).stack),o=!1}return a.apply(this,arguments)},a)}var J={};function Q(e,t){null!=_.deprecationHandler&&_.deprecationHandler(e,t),J[e]||(B(t),J[e]=!0)}function a(e){return "undefined"!=typeof Function&&e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function X(e,t){var n,s=E({},e);for(n in t)c(t,n)&&(F(e[n])&&F(t[n])?(s[n]={},E(s[n],e[n]),E(s[n],t[n])):null!=t[n]?(s[n]=t[n]):delete s[n]);for(n in e)c(e,n)&&!c(t,n)&&F(e[n])&&(s[n]=E({},s[n]));return s}function K(e){null!=e&&this.set(e)}_.suppressDeprecationWarnings=!1,_.deprecationHandler=null;var ee=Object.keys||function(e){var t,n=[];for(t in e)c(e,t)&&n.push(t);return n};function r(e,t,n){var s=""+Math.abs(e);return (0<=e?n?"+":"":"-")+Math.pow(10,Math.max(0,t-s.length)).toString().substr(1)+s}var te=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,ne=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,se={},ie={};function s(e,t,n,s){var i="string"==typeof s?function(){return this[s]()}:s;e&&(ie[e]=i),t&&(ie[t[0]]=function(){return r(i.apply(this,arguments),t[1],t[2])}),n&&(ie[n]=function(){return this.localeData().ordinal(i.apply(this,arguments),e)})}function re(e,t){return e.isValid()?(t=ae(t,e.localeData()),se[t]=se[t]||function(s){for(var e,i=s.match(te),t=0,r=i.length;t<r;t++)ie[i[t]]?(i[t]=ie[i[t]]):(i[t]=(e=i[t]).match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,""));return function(e){for(var t="",n=0;n<r;n++)t+=a(i[n])?i[n].call(e,s):i[n];return t}}(t),se[t](e)):e.localeData().invalidDate()}function ae(e,t){var n=5;function s(e){return t.longDateFormat(e)||e}for(ne.lastIndex=0;0<=n&&ne.test(e);)e=e.replace(ne,s),ne.lastIndex=0,--n;return e}var oe={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function o(e){return "string"==typeof e?oe[e]||oe[e.toLowerCase()]:void 0}function ue(e){var t,n,s={};for(n in e)c(e,n)&&(t=o(n))&&(s[t]=e[n]);return s}var le={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1},de=/\d/,t=/\d\d/,he=/\d{3}/,ce=/\d{4}/,fe=/[+-]?\d{6}/,n=/\d\d?/,me=/\d\d\d\d?/,_e=/\d\d\d\d\d\d?/,ye=/\d{1,3}/,ge=/\d{1,4}/,we=/[+-]?\d{1,6}/,pe=/\d+/,ke=/[+-]?\d+/,Me=/Z|[+-]\d\d:?\d\d/gi,ve=/Z|[+-]\d\d(?::?\d\d)?/gi,i=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,u=/^[1-9]\d?/,d=/^([1-9]\d|\d)/;function h(e,n,s){Ye[e]=a(n)?n:function(e,t){return e&&s?s:n}}function De(e,t){return c(Ye,e)?Ye[e](t._strict,t._locale):new RegExp(f(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,i){return t||n||s||i})))}function f(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function m(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function M(e){var e=+e,t=0;return t=0!=e&&isFinite(e)?m(e):t}var Ye={},Se={};function v(e,n){var t,s,i=n;for("string"==typeof e&&(e=[e]),w(n)&&(i=function(e,t){t[n]=M(e)}),s=e.length,t=0;t<s;t++)Se[e[t]]=i}function Oe(e,i){v(e,function(e,t,n,s){n._w=n._w||{},i(e,n._w,n,s)})}function be(e){return e%4==0&&e%100!=0||e%400==0}var D=0,Y=1,S=2,O=3,b=4,T=5,Te=6,xe=7,Ne=8;function We(e){return be(e)?366:365}s("Y",0,0,function(){var e=this.year();return e<=9999?r(e,4):"+"+e}),s(0,["YY",2],0,function(){return this.year()%100}),s(0,["YYYY",4],0,"year"),s(0,["YYYYY",5],0,"year"),s(0,["YYYYYY",6,!0],0,"year"),h("Y",ke),h("YY",n,t),h("YYYY",ge,ce),h("YYYYY",we,fe),h("YYYYYY",we,fe),v(["YYYYY","YYYYYY"],D),v("YYYY",function(e,t){t[D]=2===e.length?_.parseTwoDigitYear(e):M(e)}),v("YY",function(e,t){t[D]=_.parseTwoDigitYear(e)}),v("Y",function(e,t){t[D]=parseInt(e,10)}),_.parseTwoDigitYear=function(e){return M(e)+(68<M(e)?1900:2e3)};var x,Pe=Re("FullYear",!0);function Re(t,n){return function(e){return null!=e?(Ue(this,t,e),_.updateOffset(this,n),this):Ce(this,t)}}function Ce(e,t){if(!e.isValid())return NaN;var n=e._d,s=e._isUTC;switch(t){case "Milliseconds":return s?n.getUTCMilliseconds():n.getMilliseconds();case "Seconds":return s?n.getUTCSeconds():n.getSeconds();case "Minutes":return s?n.getUTCMinutes():n.getMinutes();case "Hours":return s?n.getUTCHours():n.getHours();case "Date":return s?n.getUTCDate():n.getDate();case "Day":return s?n.getUTCDay():n.getDay();case "Month":return s?n.getUTCMonth():n.getMonth();case "FullYear":return s?n.getUTCFullYear():n.getFullYear();default:return NaN}}function Ue(e,t,n){var s,i,r;if(e.isValid()&&!isNaN(n)){switch(s=e._d,i=e._isUTC,t){case "Milliseconds":return i?s.setUTCMilliseconds(n):s.setMilliseconds(n);case "Seconds":return i?s.setUTCSeconds(n):s.setSeconds(n);case "Minutes":return i?s.setUTCMinutes(n):s.setMinutes(n);case "Hours":return i?s.setUTCHours(n):s.setHours(n);case "Date":return i?s.setUTCDate(n):s.setDate(n);case "FullYear":break;default:return}t=n,r=e.month(),e=29!==(e=e.date())||1!==r||be(t)?e:28,i?s.setUTCFullYear(t,r,e):s.setFullYear(t,r,e)}}function He(e,t){var n;return isNaN(e)||isNaN(t)?NaN:(n=(t%(n=12)+n)%n,e+=(t-n)/12,1==n?be(e)?29:28:31-n%7%2)}x=Array.prototype.indexOf||function(e){for(var t=0;t<this.length;++t)if(this[t]===e)return t;return -1},s("M",["MM",2],"Mo",function(){return this.month()+1}),s("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),s("MMMM",0,0,function(e){return this.localeData().months(this,e)}),h("M",n,u),h("MM",n,t),h("MMM",function(e,t){return t.monthsShortRegex(e)}),h("MMMM",function(e,t){return t.monthsRegex(e)}),v(["M","MM"],function(e,t){t[Y]=M(e)-1}),v(["MMM","MMMM"],function(e,t,n,s){s=n._locale.monthsParse(e,s,n._strict);null!=s?(t[Y]=s):(p(n).invalidMonth=e)});var Fe="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Le="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Ve=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Ge=i,Ee=i;function Ae(e,t){if(e.isValid()){if("string"==typeof t)if(/^\d+$/.test(t))t=M(t);else if(!w(t=e.localeData().monthsParse(t)))return;var n=(n=e.date())<29?n:Math.min(n,He(e.year(),t));e._isUTC?e._d.setUTCMonth(t,n):e._d.setMonth(t,n)}}function Ie(e){return null!=e?(Ae(this,e),_.updateOffset(this,!0),this):Ce(this,"Month")}function je(){function e(e,t){return t.length-e.length}for(var t,n,s=[],i=[],r=[],a=0;a<12;a++)n=l([2e3,a]),t=f(this.monthsShort(n,"")),n=f(this.months(n,"")),s.push(t),i.push(n),r.push(n),r.push(t);s.sort(e),i.sort(e),r.sort(e),this._monthsRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+i.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Ze(e,t,n,s,i,r,a){var o;return e<100&&0<=e?(o=new Date(e+400,t,n,s,i,r,a),isFinite(o.getFullYear())&&o.setFullYear(e)):(o=new Date(e,t,n,s,i,r,a)),o}function ze(e){var t;return e<100&&0<=e?((t=Array.prototype.slice.call(arguments))[0]=e+400,t=new Date(Date.UTC.apply(null,t)),isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e)):(t=new Date(Date.UTC.apply(null,arguments))),t}function qe(e,t,n){n=7+t-n;return n-(7+ze(e,0,n).getUTCDay()-t)%7-1}function $e(e,t,n,s,i){var r,t=1+7*(t-1)+(7+n-s)%7+qe(e,s,i),n=t<=0?We(r=e-1)+t:t>We(e)?(r=e+1,t-We(e)):(r=e,t);return {year:r,dayOfYear:n}}function Be(e,t,n){var s,i,r=qe(e.year(),t,n),r=Math.floor((e.dayOfYear()-r-1)/7)+1;return r<1?(s=r+N(i=e.year()-1,t,n)):r>N(e.year(),t,n)?(s=r-N(e.year(),t,n),i=e.year()+1):(i=e.year(),s=r),{week:s,year:i}}function N(e,t,n){var s=qe(e,t,n),t=qe(e+1,t,n);return (We(e)-s+t)/7}s("w",["ww",2],"wo","week"),s("W",["WW",2],"Wo","isoWeek"),h("w",n,u),h("ww",n,t),h("W",n,u),h("WW",n,t),Oe(["w","ww","W","WW"],function(e,t,n,s){t[s.substr(0,1)]=M(e)});function Je(e,t){return e.slice(t,7).concat(e.slice(0,t))}s("d",0,"do","day"),s("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),s("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),s("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),s("e",0,0,"weekday"),s("E",0,0,"isoWeekday"),h("d",n),h("e",n),h("E",n),h("dd",function(e,t){return t.weekdaysMinRegex(e)}),h("ddd",function(e,t){return t.weekdaysShortRegex(e)}),h("dddd",function(e,t){return t.weekdaysRegex(e)}),Oe(["dd","ddd","dddd"],function(e,t,n,s){s=n._locale.weekdaysParse(e,s,n._strict);null!=s?(t.d=s):(p(n).invalidWeekday=e)}),Oe(["d","e","E"],function(e,t,n,s){t[s]=M(e)});var Qe="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Xe="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Ke="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),et=i,tt=i,nt=i;function st(){function e(e,t){return t.length-e.length}for(var t,n,s,i=[],r=[],a=[],o=[],u=0;u<7;u++)s=l([2e3,1]).day(u),t=f(this.weekdaysMin(s,"")),n=f(this.weekdaysShort(s,"")),s=f(this.weekdays(s,"")),i.push(t),r.push(n),a.push(s),o.push(t),o.push(n),o.push(s);i.sort(e),r.sort(e),a.sort(e),o.sort(e),this._weekdaysRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+i.join("|")+")","i")}function it(){return this.hours()%12||12}function rt(e,t){s(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function at(e,t){return t._meridiemParse}s("H",["HH",2],0,"hour"),s("h",["hh",2],0,it),s("k",["kk",2],0,function(){return this.hours()||24}),s("hmm",0,0,function(){return ""+it.apply(this)+r(this.minutes(),2)}),s("hmmss",0,0,function(){return ""+it.apply(this)+r(this.minutes(),2)+r(this.seconds(),2)}),s("Hmm",0,0,function(){return ""+this.hours()+r(this.minutes(),2)}),s("Hmmss",0,0,function(){return ""+this.hours()+r(this.minutes(),2)+r(this.seconds(),2)}),rt("a",!0),rt("A",!1),h("a",at),h("A",at),h("H",n,d),h("h",n,u),h("k",n,u),h("HH",n,t),h("hh",n,t),h("kk",n,t),h("hmm",me),h("hmmss",_e),h("Hmm",me),h("Hmmss",_e),v(["H","HH"],O),v(["k","kk"],function(e,t,n){e=M(e);t[O]=24===e?0:e}),v(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),v(["h","hh"],function(e,t,n){t[O]=M(e),p(n).bigHour=!0}),v("hmm",function(e,t,n){var s=e.length-2;t[O]=M(e.substr(0,s)),t[b]=M(e.substr(s)),p(n).bigHour=!0}),v("hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[O]=M(e.substr(0,s)),t[b]=M(e.substr(s,2)),t[T]=M(e.substr(i)),p(n).bigHour=!0}),v("Hmm",function(e,t,n){var s=e.length-2;t[O]=M(e.substr(0,s)),t[b]=M(e.substr(s))}),v("Hmmss",function(e,t,n){var s=e.length-4,i=e.length-2;t[O]=M(e.substr(0,s)),t[b]=M(e.substr(s,2)),t[T]=M(e.substr(i))});i=Re("Hours",!0);var ot,ut={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Fe,monthsShort:Le,week:{dow:0,doy:6},weekdays:Qe,weekdaysMin:Ke,weekdaysShort:Xe,meridiemParse:/[ap]\.?m?\.?/i},W={},lt={};function dt(e){return e&&e.toLowerCase().replace("_","-")}function ht(e){for(var t,n,s,i,r=0;r<e.length;){for(t=(i=dt(e[r]).split("-")).length,n=(n=dt(e[r+1]))?n.split("-"):null;0<t;){if(s=ct(i.slice(0,t).join("-")))return s;if(n&&n.length>=t&&function(e,t){for(var n=Math.min(e.length,t.length),s=0;s<n;s+=1)if(e[s]!==t[s])return s;return n}(i,n)>=t-1)break;t--}r++}return ot}function ct(t){var e,n;if(void 0===W[t]&&"undefined"!=typeof module&&module&&module.exports&&(n=t)&&n.match("^[^/\\\\]*$"))try{e=ot._abbr,require("./locale/"+t),ft(e)}catch(e){W[t]=null}return W[t]}function ft(e,t){return e&&((t=g(t)?P(e):mt(e,t))?(ot=t):"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),ot._abbr}function mt(e,t){if(null===t)return delete W[e],null;var n,s=ut;if(t.abbr=e,null!=W[e])Q("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),s=W[e]._config;else if(null!=t.parentLocale)if(null!=W[t.parentLocale])s=W[t.parentLocale]._config;else{if(null==(n=ct(t.parentLocale)))return lt[t.parentLocale]||(lt[t.parentLocale]=[]),lt[t.parentLocale].push({name:e,config:t}),null;s=n._config}return W[e]=new K(X(s,t)),lt[e]&&lt[e].forEach(function(e){mt(e.name,e.config)}),ft(e),W[e]}function P(e){var t;if(!(e=e&&e._locale&&e._locale._abbr?e._locale._abbr:e))return ot;if(!y(e)){if(t=ct(e))return t;e=[e]}return ht(e)}function _t(e){var t=e._a;return t&&-2===p(e).overflow&&(t=t[Y]<0||11<t[Y]?Y:t[S]<1||t[S]>He(t[D],t[Y])?S:t[O]<0||24<t[O]||24===t[O]&&(0!==t[b]||0!==t[T]||0!==t[Te])?O:t[b]<0||59<t[b]?b:t[T]<0||59<t[T]?T:t[Te]<0||999<t[Te]?Te:-1,p(e)._overflowDayOfYear&&(t<D||S<t)&&(t=S),p(e)._overflowWeeks&&-1===t&&(t=xe),p(e)._overflowWeekday&&-1===t&&(t=Ne),p(e).overflow=t),e}var yt=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,wt=/Z|[+-]\d\d(?::?\d\d)?/,pt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],kt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Mt=/^\/?Date\((-?\d+)/i,vt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Dt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function Yt(e){var t,n,s,i,r,a,o=e._i,u=yt.exec(o)||gt.exec(o),o=pt.length,l=kt.length;if(u){for(p(e).iso=!0,t=0,n=o;t<n;t++)if(pt[t][1].exec(u[1])){i=pt[t][0],s=!1!==pt[t][2];break}if(null==i)e._isValid=!1;else{if(u[3]){for(t=0,n=l;t<n;t++)if(kt[t][1].exec(u[3])){r=(u[2]||" ")+kt[t][0];break}if(null==r)return void(e._isValid=!1)}if(s||null==r){if(u[4]){if(!wt.exec(u[4]))return void(e._isValid=!1);a="Z"}e._f=i+(r||"")+(a||""),xt(e)}else e._isValid=!1}}else e._isValid=!1}function St(e,t,n,s,i,r){e=[function(e){e=parseInt(e,10);if(e<=49)return 2e3+e;if(e<=999)return 1900+e;return e}(e),Le.indexOf(t),parseInt(n,10),parseInt(s,10),parseInt(i,10)];return r&&e.push(parseInt(r,10)),e}function Ot(e){var t,n,s=vt.exec(e._i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));s?(t=St(s[4],s[3],s[2],s[5],s[6],s[7]),function(e,t,n){if(!e||Xe.indexOf(e)===(new Date(t[0],t[1],t[2])).getDay())return 1;p(n).weekdayMismatch=!0,n._isValid=!1}(s[1],t,e)&&(e._a=t,e._tzm=(t=s[8],n=s[9],s=s[10],t?Dt[t]:n?0:60*(((t=parseInt(s,10))-(n=t%100))/100)+n),e._d=ze.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),p(e).rfc2822=!0)):(e._isValid=!1)}function bt(e,t,n){return null!=e?e:null!=t?t:n}function Tt(e){var t,n,s,i,r,a,o,u,l,d,h,c=[];if(!e._d){for(s=e,i=new Date(_.now()),n=s._useUTC?[i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate()]:[i.getFullYear(),i.getMonth(),i.getDate()],e._w&&null==e._a[S]&&null==e._a[Y]&&(null!=(i=(s=e)._w).GG||null!=i.W||null!=i.E?(u=1,l=4,r=bt(i.GG,s._a[D],Be(R(),1,4).year),a=bt(i.W,1),((o=bt(i.E,1))<1||7<o)&&(d=!0)):(u=s._locale._week.dow,l=s._locale._week.doy,h=Be(R(),u,l),r=bt(i.gg,s._a[D],h.year),a=bt(i.w,h.week),null!=i.d?((o=i.d)<0||6<o)&&(d=!0):null!=i.e?(o=i.e+u,(i.e<0||6<i.e)&&(d=!0)):(o=u)),a<1||a>N(r,u,l)?(p(s)._overflowWeeks=!0):null!=d?(p(s)._overflowWeekday=!0):(h=$e(r,a,o,u,l),s._a[D]=h.year,s._dayOfYear=h.dayOfYear)),null!=e._dayOfYear&&(i=bt(e._a[D],n[D]),(e._dayOfYear>We(i)||0===e._dayOfYear)&&(p(e)._overflowDayOfYear=!0),d=ze(i,0,e._dayOfYear),e._a[Y]=d.getUTCMonth(),e._a[S]=d.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=c[t]=n[t];for(;t<7;t++)e._a[t]=c[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[O]&&0===e._a[b]&&0===e._a[T]&&0===e._a[Te]&&(e._nextDay=!0,e._a[O]=0),e._d=(e._useUTC?ze:Ze).apply(null,c),r=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[O]=24),e._w&&void 0!==e._w.d&&e._w.d!==r&&(p(e).weekdayMismatch=!0)}}function xt(e){if(e._f===_.ISO_8601)Yt(e);else if(e._f===_.RFC_2822)Ot(e);else{e._a=[],p(e).empty=!0;for(var t,n,s,i,r,a=""+e._i,o=a.length,u=0,l=ae(e._f,e._locale).match(te)||[],d=l.length,h=0;h<d;h++)n=l[h],(t=(a.match(De(n,e))||[])[0])&&(0<(s=a.substr(0,a.indexOf(t))).length&&p(e).unusedInput.push(s),a=a.slice(a.indexOf(t)+t.length),u+=t.length),ie[n]?(t?(p(e).empty=!1):p(e).unusedTokens.push(n),s=n,r=e,null!=(i=t)&&c(Se,s)&&Se[s](i,r._a,r,s)):e._strict&&!t&&p(e).unusedTokens.push(n);p(e).charsLeftOver=o-u,0<a.length&&p(e).unusedInput.push(a),e._a[O]<=12&&!0===p(e).bigHour&&0<e._a[O]&&(p(e).bigHour=void 0),p(e).parsedDateParts=e._a.slice(0),p(e).meridiem=e._meridiem,e._a[O]=function(e,t,n){if(null==n)return t;return null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((e=e.isPM(n))&&t<12&&(t+=12),t=e||12!==t?t:0):t}(e._locale,e._a[O],e._meridiem),null!==(o=p(e).era)&&(e._a[D]=e._locale.erasConvertYear(o,e._a[D])),Tt(e),_t(e)}}function Nt(e){var t,n,s,i=e._i,r=e._f;if(e._locale=e._locale||P(e._l),null===i||void 0===r&&""===i)return I({nullInput:!0});if("string"==typeof i&&(e._i=i=e._locale.preparse(i)),k(i))return new $(_t(i));if(V(i))e._d=i;else if(y(r)){var a,o,u,l,d,h,c=e,f=!1,m=c._f.length;if(0===m)p(c).invalidFormat=!0,c._d=new Date(NaN);else{for(l=0;l<m;l++)d=0,h=!1,a=q({},c),null!=c._useUTC&&(a._useUTC=c._useUTC),a._f=c._f[l],xt(a),A(a)&&(h=!0),d=(d+=p(a).charsLeftOver)+10*p(a).unusedTokens.length,p(a).score=d,f?d<u&&(u=d,o=a):(null==u||d<u||h)&&(u=d,o=a,h)&&(f=!0);E(c,o||a)}}else if(r)xt(e);else if(g(r=(i=e)._i))i._d=new Date(_.now());else V(r)?(i._d=new Date(r.valueOf())):"string"==typeof r?(n=i,null!==(t=Mt.exec(n._i))?(n._d=new Date(+t[1])):(Yt(n),!1===n._isValid&&(delete n._isValid,Ot(n),!1===n._isValid)&&(delete n._isValid,n._strict?(n._isValid=!1):_.createFromInputFallback(n)))):y(r)?(i._a=G(r.slice(0),function(e){return parseInt(e,10)}),Tt(i)):F(r)?(t=i)._d||(s=void 0===(n=ue(t._i)).day?n.date:n.day,t._a=G([n.year,n.month,s,n.hour,n.minute,n.second,n.millisecond],function(e){return e&&parseInt(e,10)}),Tt(t)):w(r)?(i._d=new Date(r)):_.createFromInputFallback(i);return A(e)||(e._d=null),e}function Wt(e,t,n,s,i){var r={};return !0!==t&&!1!==t||(s=t,t=void 0),!0!==n&&!1!==n||(s=n,n=void 0),(F(e)&&L(e)||y(e)&&0===e.length)&&(e=void 0),r._isAMomentObject=!0,r._useUTC=r._isUTC=i,r._l=n,r._i=e,r._f=t,r._strict=s,(i=new $(_t(Nt(i=r))))._nextDay&&(i.add(1,"d"),i._nextDay=void 0),i}function R(e,t,n,s){return Wt(e,t,n,s,!1)}_.createFromInputFallback=e("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),_.ISO_8601=function(){},_.RFC_2822=function(){};me=e("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=R.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:I()}),_e=e("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=R.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:I()});function Pt(e,t){var n,s;if(!(t=1===t.length&&y(t[0])?t[0]:t).length)return R();for(n=t[0],s=1;s<t.length;++s)t[s].isValid()&&!t[s][e](n)||(n=t[s]);return n}var Rt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ct(e){var e=ue(e),t=e.year||0,n=e.quarter||0,s=e.month||0,i=e.week||e.isoWeek||0,r=e.day||0,a=e.hour||0,o=e.minute||0,u=e.second||0,l=e.millisecond||0;this._isValid=function(e){var t,n,s=!1,i=Rt.length;for(t in e)if(c(e,t)&&(-1===x.call(Rt,t)||null!=e[t]&&isNaN(e[t])))return !1;for(n=0;n<i;++n)if(e[Rt[n]]){if(s)return !1;parseFloat(e[Rt[n]])!==M(e[Rt[n]])&&(s=!0)}return !0}(e),this._milliseconds=+l+1e3*u+6e4*o+1e3*a*60*60,this._days=+r+7*i,this._months=+s+3*n+12*t,this._data={},this._locale=P(),this._bubble()}function Ut(e){return e instanceof Ct}function Ht(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Ft(e,n){s(e,0,0,function(){var e=this.utcOffset(),t="+";return e<0&&(e=-e,t="-"),t+r(~~(e/60),2)+n+r(~~e%60,2)})}Ft("Z",":"),Ft("ZZ",""),h("Z",ve),h("ZZ",ve),v(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Vt(ve,e)});var Lt=/([\+\-]|\d\d)/gi;function Vt(e,t){var t=(t||"").match(e);return null===t?null:0===(t=60*(e=((t[t.length-1]||[])+"").match(Lt)||["-",0,0])[1]+M(e[2]))?0:"+"===e[0]?t:-t}function Gt(e,t){var n;return t._isUTC?(t=t.clone(),n=(k(e)||V(e)?e:R(e)).valueOf()-t.valueOf(),t._d.setTime(t._d.valueOf()+n),_.updateOffset(t,!1),t):R(e).local()}function Et(e){return -Math.round(e._d.getTimezoneOffset())}function At(){return !!this.isValid()&&this._isUTC&&0===this._offset}_.updateOffset=function(){};var It=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,jt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function C(e,t){var n,s=e;return Ut(e)?(s={ms:e._milliseconds,d:e._days,M:e._months}):w(e)||!isNaN(+e)?(s={},t?(s[t]=+e):(s.milliseconds=+e)):(t=It.exec(e))?(n="-"===t[1]?-1:1,s={y:0,d:M(t[S])*n,h:M(t[O])*n,m:M(t[b])*n,s:M(t[T])*n,ms:M(Ht(1e3*t[Te]))*n}):(t=jt.exec(e))?(n="-"===t[1]?-1:1,s={y:Zt(t[2],n),M:Zt(t[3],n),w:Zt(t[4],n),d:Zt(t[5],n),h:Zt(t[6],n),m:Zt(t[7],n),s:Zt(t[8],n)}):null==s?(s={}):"object"==typeof s&&("from" in s||"to" in s)&&(t=function(e,t){var n;if(!e.isValid()||!t.isValid())return {milliseconds:0,months:0};t=Gt(t,e),e.isBefore(t)?(n=zt(e,t)):((n=zt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months);return n}(R(s.from),R(s.to)),(s={}).ms=t.milliseconds,s.M=t.months),n=new Ct(s),Ut(e)&&c(e,"_locale")&&(n._locale=e._locale),Ut(e)&&c(e,"_isValid")&&(n._isValid=e._isValid),n}function Zt(e,t){e=e&&parseFloat(e.replace(",","."));return (isNaN(e)?0:e)*t}function zt(e,t){var n={};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function qt(s,i){return function(e,t){var n;return null===t||isNaN(+t)||(Q(i,"moment()."+i+"(period, number) is deprecated. Please use moment()."+i+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=e,e=t,t=n),$t(this,C(e,t),s),this}}function $t(e,t,n,s){var i=t._milliseconds,r=Ht(t._days),t=Ht(t._months);e.isValid()&&(s=null==s||s,t&&Ae(e,Ce(e,"Month")+t*n),r&&Ue(e,"Date",Ce(e,"Date")+r*n),i&&e._d.setTime(e._d.valueOf()+i*n),s)&&_.updateOffset(e,r||t)}C.fn=Ct.prototype,C.invalid=function(){return C(NaN)};Fe=qt(1,"add"),Qe=qt(-1,"subtract");function Bt(e){return "string"==typeof e||e instanceof String}function Jt(e){return k(e)||V(e)||Bt(e)||w(e)||function(t){var e=y(t),n=!1;e&&(n=0===t.filter(function(e){return !w(e)&&Bt(t)}).length);return e&&n}(e)||function(e){for(var n,s=F(e)&&!L(e),i=!1,r=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],a=r.length,t=0;t<a;t+=1)n=r[t],i=i||c(e,n);return s&&i}(e)||null==e}function Qt(e,t){var n,s;return e.date()<t.date()?-Qt(t,e):-((n=12*(t.year()-e.year())+(t.month()-e.month()))+(t-(s=e.clone().add(n,"months"))<0?(t-s)/(s-e.clone().add(n-1,"months")):(t-s)/(e.clone().add(1+n,"months")-s)))||0}function Xt(e){return void 0===e?this._locale._abbr:(null!=(e=P(e))&&(this._locale=e),this)}_.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",_.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";Ke=e("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function Kt(){return this._locale}var en=1.26227808e13;function tn(e,t){return (e%t+t)%t}function nn(e,t,n){return e<100&&0<=e?new Date(e+400,t,n)-en:(new Date(e,t,n)).valueOf()}function sn(e,t,n){return e<100&&0<=e?Date.UTC(e+400,t,n)-en:Date.UTC(e,t,n)}function rn(e,t){return t.erasAbbrRegex(e)}function an(){for(var e,t,n,s=[],i=[],r=[],a=[],o=this.eras(),u=0,l=o.length;u<l;++u)e=f(o[u].name),t=f(o[u].abbr),n=f(o[u].narrow),i.push(e),s.push(t),r.push(n),a.push(e),a.push(t),a.push(n);this._erasRegex=new RegExp("^("+a.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+i.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+s.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+r.join("|")+")","i")}function on(e,t){s(0,[e,e.length],0,t)}function un(e,t,n,s,i){var r;return null==e?Be(this,s,i).year:(r=N(e,s,i),function(e,t,n,s,i){e=$e(e,t,n,s,i),t=ze(e.year,0,e.dayOfYear);return this.year(t.getUTCFullYear()),this.month(t.getUTCMonth()),this.date(t.getUTCDate()),this}.call(this,e,t=r<t?r:t,n,s,i))}s("N",0,0,"eraAbbr"),s("NN",0,0,"eraAbbr"),s("NNN",0,0,"eraAbbr"),s("NNNN",0,0,"eraName"),s("NNNNN",0,0,"eraNarrow"),s("y",["y",1],"yo","eraYear"),s("y",["yy",2],0,"eraYear"),s("y",["yyy",3],0,"eraYear"),s("y",["yyyy",4],0,"eraYear"),h("N",rn),h("NN",rn),h("NNN",rn),h("NNNN",function(e,t){return t.erasNameRegex(e)}),h("NNNNN",function(e,t){return t.erasNarrowRegex(e)}),v(["N","NN","NNN","NNNN","NNNNN"],function(e,t,n,s){s=n._locale.erasParse(e,s,n._strict);s?(p(n).era=s):(p(n).invalidEra=e)}),h("y",pe),h("yy",pe),h("yyy",pe),h("yyyy",pe),h("yo",function(e,t){return t._eraYearOrdinalRegex||pe}),v(["y","yy","yyy","yyyy"],D),v(["yo"],function(e,t,n,s){var i;n._locale._eraYearOrdinalRegex&&(i=e.match(n._locale._eraYearOrdinalRegex)),n._locale.eraYearOrdinalParse?(t[D]=n._locale.eraYearOrdinalParse(e,i)):(t[D]=parseInt(e,10))}),s(0,["gg",2],0,function(){return this.weekYear()%100}),s(0,["GG",2],0,function(){return this.isoWeekYear()%100}),on("gggg","weekYear"),on("ggggg","weekYear"),on("GGGG","isoWeekYear"),on("GGGGG","isoWeekYear"),h("G",ke),h("g",ke),h("GG",n,t),h("gg",n,t),h("GGGG",ge,ce),h("gggg",ge,ce),h("GGGGG",we,fe),h("ggggg",we,fe),Oe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,s){t[s.substr(0,2)]=M(e)}),Oe(["gg","GG"],function(e,t,n,s){t[s]=_.parseTwoDigitYear(e)}),s("Q",0,"Qo","quarter"),h("Q",de),v("Q",function(e,t){t[Y]=3*(M(e)-1)}),s("D",["DD",2],"Do","date"),h("D",n,u),h("DD",n,t),h("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),v(["D","DD"],S),v("Do",function(e,t){t[S]=M(e.match(n)[0])});ge=Re("Date",!0);s("DDD",["DDDD",3],"DDDo","dayOfYear"),h("DDD",ye),h("DDDD",he),v(["DDD","DDDD"],function(e,t,n){n._dayOfYear=M(e)}),s("m",["mm",2],0,"minute"),h("m",n,d),h("mm",n,t),v(["m","mm"],b);var ln,ce=Re("Minutes",!1),we=(s("s",["ss",2],0,"second"),h("s",n,d),h("ss",n,t),v(["s","ss"],T),Re("Seconds",!1));for(s("S",0,0,function(){return ~~(this.millisecond()/100)}),s(0,["SS",2],0,function(){return ~~(this.millisecond()/10)}),s(0,["SSS",3],0,"millisecond"),s(0,["SSSS",4],0,function(){return 10*this.millisecond()}),s(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),s(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),s(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),s(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),s(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),h("S",ye,de),h("SS",ye,t),h("SSS",ye,he),ln="SSSS";ln.length<=9;ln+="S")h(ln,pe);function dn(e,t){t[Te]=M(1e3*("0."+e))}for(ln="S";ln.length<=9;ln+="S")v(ln,dn);fe=Re("Milliseconds",!1),s("z",0,0,"zoneAbbr"),s("zz",0,0,"zoneName");u=$.prototype;function hn(e){return e}u.add=Fe,u.calendar=function(e,t){1===arguments.length&&(arguments[0]?Jt(arguments[0])?(e=arguments[0],t=void 0):function(e){for(var t=F(e)&&!L(e),n=!1,s=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],i=0;i<s.length;i+=1)n=n||c(e,s[i]);return t&&n}(arguments[0])&&(t=arguments[0],e=void 0):(t=e=void 0));var e=e||R(),n=Gt(e,this).startOf("day"),n=_.calendarFormat(this,n)||"sameElse",t=t&&(a(t[n])?t[n].call(this,e):t[n]);return this.format(t||this.localeData().calendar(n,this,R(e)))},u.clone=function(){return new $(this)},u.diff=function(e,t,n){var s,i,r;if(!this.isValid())return NaN;if(!(s=Gt(e,this)).isValid())return NaN;switch(i=6e4*(s.utcOffset()-this.utcOffset()),t=o(t)){case "year":r=Qt(this,s)/12;break;case "month":r=Qt(this,s);break;case "quarter":r=Qt(this,s)/3;break;case "second":r=(this-s)/1e3;break;case "minute":r=(this-s)/6e4;break;case "hour":r=(this-s)/3.6e6;break;case "day":r=(this-s-i)/8.64e7;break;case "week":r=(this-s-i)/6.048e8;break;default:r=this-s}return n?r:m(r)},u.endOf=function(e){var t,n;if(void 0!==(e=o(e))&&"millisecond"!==e&&this.isValid()){switch(n=this._isUTC?sn:nn,e){case "year":t=n(this.year()+1,0,1)-1;break;case "quarter":t=n(this.year(),this.month()-this.month()%3+3,1)-1;break;case "month":t=n(this.year(),this.month()+1,1)-1;break;case "week":t=n(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case "isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case "day":case "date":t=n(this.year(),this.month(),this.date()+1)-1;break;case "hour":t=this._d.valueOf(),t+=3.6e6-tn(t+(this._isUTC?0:6e4*this.utcOffset()),3.6e6)-1;break;case "minute":t=this._d.valueOf(),t+=6e4-tn(t,6e4)-1;break;case "second":t=this._d.valueOf(),t+=1e3-tn(t,1e3)-1;break}this._d.setTime(t),_.updateOffset(this,!0)}return this},u.format=function(e){return e=e||(this.isUtc()?_.defaultFormatUtc:_.defaultFormat),e=re(this,e),this.localeData().postformat(e)},u.from=function(e,t){return this.isValid()&&(k(e)&&e.isValid()||R(e).isValid())?C({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},u.fromNow=function(e){return this.from(R(),e)},u.to=function(e,t){return this.isValid()&&(k(e)&&e.isValid()||R(e).isValid())?C({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},u.toNow=function(e){return this.to(R(),e)},u.get=function(e){return a(this[e=o(e)])?this[e]():this},u.invalidAt=function(){return p(this).overflow},u.isAfter=function(e,t){return e=k(e)?e:R(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=o(t)||"millisecond")?this.valueOf()>e.valueOf():e.valueOf()<this.clone().startOf(t).valueOf())},u.isBefore=function(e,t){return e=k(e)?e:R(e),!(!this.isValid()||!e.isValid())&&("millisecond"===(t=o(t)||"millisecond")?this.valueOf()<e.valueOf():this.clone().endOf(t).valueOf()<e.valueOf())},u.isBetween=function(e,t,n,s){return e=k(e)?e:R(e),t=k(t)?t:R(t),!!(this.isValid()&&e.isValid()&&t.isValid())&&("("===(s=s||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===s[1]?this.isBefore(t,n):!this.isAfter(t,n))},u.isSame=function(e,t){var e=k(e)?e:R(e);return !(!this.isValid()||!e.isValid())&&("millisecond"===(t=o(t)||"millisecond")?this.valueOf()===e.valueOf():(e=e.valueOf(),this.clone().startOf(t).valueOf()<=e&&e<=this.clone().endOf(t).valueOf()))},u.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},u.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},u.isValid=function(){return A(this)},u.lang=Ke,u.locale=Xt,u.localeData=Kt,u.max=_e,u.min=me,u.parsingFlags=function(){return E({},p(this))},u.set=function(e,t){if("object"==typeof e)for(var n=function(e){var t,n=[];for(t in e)c(e,t)&&n.push({unit:t,priority:le[t]});return n.sort(function(e,t){return e.priority-t.priority}),n}(e=ue(e)),s=n.length,i=0;i<s;i++)this[n[i].unit](e[n[i].unit]);else if(a(this[e=o(e)]))return this[e](t);return this},u.startOf=function(e){var t,n;if(void 0!==(e=o(e))&&"millisecond"!==e&&this.isValid()){switch(n=this._isUTC?sn:nn,e){case "year":t=n(this.year(),0,1);break;case "quarter":t=n(this.year(),this.month()-this.month()%3,1);break;case "month":t=n(this.year(),this.month(),1);break;case "week":t=n(this.year(),this.month(),this.date()-this.weekday());break;case "isoWeek":t=n(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case "day":case "date":t=n(this.year(),this.month(),this.date());break;case "hour":t=this._d.valueOf(),t-=tn(t+(this._isUTC?0:6e4*this.utcOffset()),3.6e6);break;case "minute":t=this._d.valueOf(),t-=tn(t,6e4);break;case "second":t=this._d.valueOf(),t-=tn(t,1e3);break}this._d.setTime(t),_.updateOffset(this,!0)}return this},u.subtract=Qe,u.toArray=function(){var e=this;return [e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},u.toObject=function(){var e=this;return {years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},u.toDate=function(){return new Date(this.valueOf())},u.toISOString=function(e){var t;return this.isValid()?(t=(e=!0!==e)?this.clone().utc():this).year()<0||9999<t.year()?re(t,e?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):a(Date.prototype.toISOString)?e?this.toDate().toISOString():(new Date(this.valueOf()+60*this.utcOffset()*1e3)).toISOString().replace("Z",re(t,"Z")):re(t,e?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ"):null},u.inspect=function(){var e,t,n;return this.isValid()?(t="moment",e="",this.isLocal()||(t=0===this.utcOffset()?"moment.utc":"moment.parseZone",e="Z"),t="["+t+'("]',n=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",this.format(t+n+"-MM-DD[T]HH:mm:ss.SSS"+(e+'[")]'))):"moment.invalid(/* "+this._i+" */)"},u.toJSON=function(){return this.isValid()?this.toISOString():null},u.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},u.unix=function(){return Math.floor(this.valueOf()/1e3)},u.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},u.creationData=function(){return {input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},u.eraName=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].name;if(t[n].until<=e&&e<=t[n].since)return t[n].name}return ""},u.eraNarrow=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].narrow;if(t[n].until<=e&&e<=t[n].since)return t[n].narrow}return ""},u.eraAbbr=function(){for(var e,t=this.localeData().eras(),n=0,s=t.length;n<s;++n){if(e=this.clone().startOf("day").valueOf(),t[n].since<=e&&e<=t[n].until)return t[n].abbr;if(t[n].until<=e&&e<=t[n].since)return t[n].abbr}return ""},u.eraYear=function(){for(var e,t,n=this.localeData().eras(),s=0,i=n.length;s<i;++s)if(e=n[s].since<=n[s].until?1:-1,t=this.clone().startOf("day").valueOf(),n[s].since<=t&&t<=n[s].until||n[s].until<=t&&t<=n[s].since)return (this.year()-_(n[s].since).year())*e+n[s].offset;return this.year()},u.year=Pe,u.isLeapYear=function(){return be(this.year())},u.weekYear=function(e){return un.call(this,e,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)},u.isoWeekYear=function(e){return un.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},u.quarter=u.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},u.month=Ie,u.daysInMonth=function(){return He(this.year(),this.month())},u.week=u.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},u.isoWeek=u.isoWeeks=function(e){var t=Be(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},u.weeksInYear=function(){var e=this.localeData()._week;return N(this.year(),e.dow,e.doy)},u.weeksInWeekYear=function(){var e=this.localeData()._week;return N(this.weekYear(),e.dow,e.doy)},u.isoWeeksInYear=function(){return N(this.year(),1,4)},u.isoWeeksInISOWeekYear=function(){return N(this.isoWeekYear(),1,4)},u.date=ge,u.day=u.days=function(e){var t,n,s;return this.isValid()?(t=Ce(this,"Day"),null!=e?(n=e,s=this.localeData(),e="string"!=typeof n?n:isNaN(n)?"number"==typeof(n=s.weekdaysParse(n))?n:null:parseInt(n,10),this.add(e-t,"d")):t):null!=e?this:NaN},u.weekday=function(e){var t;return this.isValid()?(t=(this.day()+7-this.localeData()._week.dow)%7,null==e?t:this.add(e-t,"d")):null!=e?this:NaN},u.isoWeekday=function(e){var t,n;return this.isValid()?null!=e?(t=e,n=this.localeData(),n="string"==typeof t?n.weekdaysParse(t)%7||7:isNaN(t)?null:t,this.day(this.day()%7?n:n-7)):this.day()||7:null!=e?this:NaN},u.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/8.64e7)+1;return null==e?t:this.add(e-t,"d")},u.hour=u.hours=i,u.minute=u.minutes=ce,u.second=u.seconds=we,u.millisecond=u.milliseconds=fe,u.utcOffset=function(e,t,n){var s,i=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null==e)return this._isUTC?i:Et(this);if("string"==typeof e){if(null===(e=Vt(ve,e)))return this}else Math.abs(e)<16&&!n&&(e*=60);return !this._isUTC&&t&&(s=Et(this)),this._offset=e,this._isUTC=!0,null!=s&&this.add(s,"m"),i!==e&&(!t||this._changeInProgress?$t(this,C(e-i,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,_.updateOffset(this,!0),this._changeInProgress=null)),this},u.utc=function(e){return this.utcOffset(0,e)},u.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e)&&this.subtract(Et(this),"m"),this},u.parseZone=function(){var e;return null!=this._tzm?this.utcOffset(this._tzm,!1,!0):"string"==typeof this._i&&(null!=(e=Vt(Me,this._i))?this.utcOffset(e):this.utcOffset(0,!0)),this},u.hasAlignedHourOffset=function(e){return !!this.isValid()&&(e=e?R(e).utcOffset():0,(this.utcOffset()-e)%60==0)},u.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},u.isLocal=function(){return !!this.isValid()&&!this._isUTC},u.isUtcOffset=function(){return !!this.isValid()&&this._isUTC},u.isUtc=At,u.isUTC=At,u.zoneAbbr=function(){return this._isUTC?"UTC":""},u.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},u.dates=e("dates accessor is deprecated. Use date instead.",ge),u.months=e("months accessor is deprecated. Use month instead",Ie),u.years=e("years accessor is deprecated. Use year instead",Pe),u.zone=e("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?(this.utcOffset(e="string"!=typeof e?-e:e,t),this):-this.utcOffset()}),u.isDSTShifted=e("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){var e,t;return g(this._isDSTShifted)&&(q(e={},this),(e=Nt(e))._a?(t=(e._isUTC?l:R)(e._a),this._isDSTShifted=this.isValid()&&0<function(e,t,n){for(var s=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),r=0,a=0;a<s;a++)(n&&e[a]!==t[a]||!n&&M(e[a])!==M(t[a]))&&r++;return r+i}(e._a,t.toArray())):(this._isDSTShifted=!1)),this._isDSTShifted});d=K.prototype;function cn(e,t,n,s){var i=P(),s=l().set(s,t);return i[n](s,e)}function fn(e,t,n){if(w(e)&&(t=e,e=void 0),e=e||"",null!=t)return cn(e,t,n,"month");for(var s=[],i=0;i<12;i++)s[i]=cn(e,i,n,"month");return s}function mn(e,t,n,s){t=("boolean"==typeof e?w(t)&&(n=t,t=void 0):(t=e,e=!1,w(n=t)&&(n=t,t=void 0)),t||"");var i,r=P(),a=e?r._week.dow:0,o=[];if(null!=n)return cn(t,(n+a)%7,s,"day");for(i=0;i<7;i++)o[i]=cn(t,(i+a)%7,s,"day");return o}d.calendar=function(e,t,n){return a(e=this._calendar[e]||this._calendar.sameElse)?e.call(t,n):e},d.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.match(te).map(function(e){return "MMMM"===e||"MM"===e||"DD"===e||"dddd"===e?e.slice(1):e}).join(""),this._longDateFormat[e])},d.invalidDate=function(){return this._invalidDate},d.ordinal=function(e){return this._ordinal.replace("%d",e)},d.preparse=hn,d.postformat=hn,d.relativeTime=function(e,t,n,s){var i=this._relativeTime[n];return a(i)?i(e,t,n,s):i.replace(/%d/i,e)},d.pastFuture=function(e,t){return a(e=this._relativeTime[0<e?"future":"past"])?e(t):e.replace(/%s/i,t)},d.set=function(e){var t,n;for(n in e)c(e,n)&&(a(t=e[n])?(this[n]=t):(this["_"+n]=t));this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},d.eras=function(e,t){for(var n,s=this._eras||P("en")._eras,i=0,r=s.length;i<r;++i){switch(typeof s[i].since){case "string":n=_(s[i].since).startOf("day"),s[i].since=n.valueOf();break}switch(typeof s[i].until){case "undefined":s[i].until=1/0;break;case "string":n=_(s[i].until).startOf("day").valueOf(),s[i].until=n.valueOf();break}}return s},d.erasParse=function(e,t,n){var s,i,r,a,o,u=this.eras();for(e=e.toUpperCase(),s=0,i=u.length;s<i;++s)if(r=u[s].name.toUpperCase(),a=u[s].abbr.toUpperCase(),o=u[s].narrow.toUpperCase(),n)switch(t){case "N":case "NN":case "NNN":if(a===e)return u[s];break;case "NNNN":if(r===e)return u[s];break;case "NNNNN":if(o===e)return u[s];break}else if(0<=[r,a,o].indexOf(e))return u[s]},d.erasConvertYear=function(e,t){var n=e.since<=e.until?1:-1;return void 0===t?_(e.since).year():_(e.since).year()+(t-e.offset)*n},d.erasAbbrRegex=function(e){return c(this,"_erasAbbrRegex")||an.call(this),e?this._erasAbbrRegex:this._erasRegex},d.erasNameRegex=function(e){return c(this,"_erasNameRegex")||an.call(this),e?this._erasNameRegex:this._erasRegex},d.erasNarrowRegex=function(e){return c(this,"_erasNarrowRegex")||an.call(this),e?this._erasNarrowRegex:this._erasRegex},d.months=function(e,t){return e?(y(this._months)?this._months:this._months[(this._months.isFormat||Ve).test(t)?"format":"standalone"])[e.month()]:y(this._months)?this._months:this._months.standalone},d.monthsShort=function(e,t){return e?(y(this._monthsShort)?this._monthsShort:this._monthsShort[Ve.test(t)?"format":"standalone"])[e.month()]:y(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},d.monthsParse=function(e,t,n){var s,i;if(this._monthsParseExact)return function(e,t,n){var s,i,r,e=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],s=0;s<12;++s)r=l([2e3,s]),this._shortMonthsParse[s]=this.monthsShort(r,"").toLocaleLowerCase(),this._longMonthsParse[s]=this.months(r,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(i=x.call(this._shortMonthsParse,e))?i:null:-1!==(i=x.call(this._longMonthsParse,e))?i:null:"MMM"===t?-1!==(i=x.call(this._shortMonthsParse,e))||-1!==(i=x.call(this._longMonthsParse,e))?i:null:-1!==(i=x.call(this._longMonthsParse,e))||-1!==(i=x.call(this._shortMonthsParse,e))?i:null}.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;s<12;s++){if(i=l([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(i,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(i,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(i="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[s]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},d.monthsRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||je.call(this),e?this._monthsStrictRegex:this._monthsRegex):(c(this,"_monthsRegex")||(this._monthsRegex=Ee),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},d.monthsShortRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||je.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(c(this,"_monthsShortRegex")||(this._monthsShortRegex=Ge),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},d.week=function(e){return Be(e,this._week.dow,this._week.doy).week},d.firstDayOfYear=function(){return this._week.doy},d.firstDayOfWeek=function(){return this._week.dow},d.weekdays=function(e,t){return t=y(this._weekdays)?this._weekdays:this._weekdays[e&&!0!==e&&this._weekdays.isFormat.test(t)?"format":"standalone"],!0===e?Je(t,this._week.dow):e?t[e.day()]:t},d.weekdaysMin=function(e){return !0===e?Je(this._weekdaysMin,this._week.dow):e?this._weekdaysMin[e.day()]:this._weekdaysMin},d.weekdaysShort=function(e){return !0===e?Je(this._weekdaysShort,this._week.dow):e?this._weekdaysShort[e.day()]:this._weekdaysShort},d.weekdaysParse=function(e,t,n){var s,i;if(this._weekdaysParseExact)return function(e,t,n){var s,i,r,e=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],s=0;s<7;++s)r=l([2e3,1]).day(s),this._minWeekdaysParse[s]=this.weekdaysMin(r,"").toLocaleLowerCase(),this._shortWeekdaysParse[s]=this.weekdaysShort(r,"").toLocaleLowerCase(),this._weekdaysParse[s]=this.weekdays(r,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(i=x.call(this._weekdaysParse,e))?i:null:"ddd"===t?-1!==(i=x.call(this._shortWeekdaysParse,e))?i:null:-1!==(i=x.call(this._minWeekdaysParse,e))?i:null:"dddd"===t?-1!==(i=x.call(this._weekdaysParse,e))||-1!==(i=x.call(this._shortWeekdaysParse,e))||-1!==(i=x.call(this._minWeekdaysParse,e))?i:null:"ddd"===t?-1!==(i=x.call(this._shortWeekdaysParse,e))||-1!==(i=x.call(this._weekdaysParse,e))||-1!==(i=x.call(this._minWeekdaysParse,e))?i:null:-1!==(i=x.call(this._minWeekdaysParse,e))||-1!==(i=x.call(this._weekdaysParse,e))||-1!==(i=x.call(this._shortWeekdaysParse,e))?i:null}.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),s=0;s<7;s++){if(i=l([2e3,1]).day(s),n&&!this._fullWeekdaysParse[s]&&(this._fullWeekdaysParse[s]=new RegExp("^"+this.weekdays(i,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[s]=new RegExp("^"+this.weekdaysShort(i,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[s]=new RegExp("^"+this.weekdaysMin(i,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[s]||(i="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[s]=new RegExp(i.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[s].test(e))return s;if(n&&"ddd"===t&&this._shortWeekdaysParse[s].test(e))return s;if(n&&"dd"===t&&this._minWeekdaysParse[s].test(e))return s;if(!n&&this._weekdaysParse[s].test(e))return s}},d.weekdaysRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||st.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(c(this,"_weekdaysRegex")||(this._weekdaysRegex=et),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},d.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||st.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(c(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=tt),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},d.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||st.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(c(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=nt),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},d.isPM=function(e){return "p"===(e+"").toLowerCase().charAt(0)},d.meridiem=function(e,t,n){return 11<e?n?"pm":"PM":n?"am":"AM"},ft("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===M(e%100/10)?"th":1==t?"st":2==t?"nd":3==t?"rd":"th")}}),_.lang=e("moment.lang is deprecated. Use moment.locale instead.",ft),_.langData=e("moment.langData is deprecated. Use moment.localeData instead.",P);var _n=Math.abs;function yn(e,t,n,s){t=C(t,n);return e._milliseconds+=s*t._milliseconds,e._days+=s*t._days,e._months+=s*t._months,e._bubble()}function gn(e){return e<0?Math.floor(e):Math.ceil(e)}function wn(e){return 4800*e/146097}function pn(e){return 146097*e/4800}function kn(e){return function(){return this.as(e)}}de=kn("ms"),t=kn("s"),ye=kn("m"),he=kn("h"),Fe=kn("d"),_e=kn("w"),me=kn("M"),Qe=kn("Q"),i=kn("y"),ce=de;function Mn(e){return function(){return this.isValid()?this._data[e]:NaN}}var we=Mn("milliseconds"),fe=Mn("seconds"),ge=Mn("minutes"),Pe=Mn("hours"),d=Mn("days"),vn=Mn("months"),Dn=Mn("years"),Yn=Math.round,Sn={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function On(e,t,n,s){var i=C(e).abs(),r=Yn(i.as("s")),a=Yn(i.as("m")),o=Yn(i.as("h")),u=Yn(i.as("d")),l=Yn(i.as("M")),d=Yn(i.as("w")),i=Yn(i.as("y")),r=(r<=n.ss?["s",r]:r<n.s&&["ss",r])||(a<=1?["m"]:a<n.m&&["mm",a])||(o<=1?["h"]:o<n.h&&["hh",o])||(u<=1?["d"]:u<n.d&&["dd",u]);return (r=(r=null!=n.w?r||(d<=1?["w"]:d<n.w&&["ww",d]):r)||(l<=1?["M"]:l<n.M&&["MM",l])||(i<=1?["y"]:["yy",i]))[2]=t,r[3]=0<+e,r[4]=s,function(e,t,n,s,i){return i.relativeTime(t||1,!!n,e,s)}.apply(null,r)}var bn=Math.abs;function Tn(e){return (0<e)-(e<0)||+e}function xn(){var e,t,n,s,i,r,a,o,u,l,d;return this.isValid()?(e=bn(this._milliseconds)/1e3,t=bn(this._days),n=bn(this._months),(o=this.asSeconds())?(s=m(e/60),i=m(s/60),e%=60,s%=60,r=m(n/12),n%=12,a=e?e.toFixed(3).replace(/\.?0+$/,""):"",u=Tn(this._months)!==Tn(o)?"-":"",l=Tn(this._days)!==Tn(o)?"-":"",d=Tn(this._milliseconds)!==Tn(o)?"-":"",(o<0?"-":"")+"P"+(r?u+r+"Y":"")+(n?u+n+"M":"")+(t?l+t+"D":"")+(i||s||e?"T":"")+(i?d+i+"H":"")+(s?d+s+"M":"")+(e?d+a+"S":"")):"P0D"):this.localeData().invalidDate()}var U=Ct.prototype;return U.isValid=function(){return this._isValid},U.abs=function(){var e=this._data;return this._milliseconds=_n(this._milliseconds),this._days=_n(this._days),this._months=_n(this._months),e.milliseconds=_n(e.milliseconds),e.seconds=_n(e.seconds),e.minutes=_n(e.minutes),e.hours=_n(e.hours),e.months=_n(e.months),e.years=_n(e.years),this},U.add=function(e,t){return yn(this,e,t,1)},U.subtract=function(e,t){return yn(this,e,t,-1)},U.as=function(e){if(!this.isValid())return NaN;var t,n,s=this._milliseconds;if("month"===(e=o(e))||"quarter"===e||"year"===e)switch(t=this._days+s/8.64e7,n=this._months+wn(t),e){case "month":return n;case "quarter":return n/3;case "year":return n/12}else switch(t=this._days+Math.round(pn(this._months)),e){case "week":return t/7+s/6.048e8;case "day":return t+s/8.64e7;case "hour":return 24*t+s/3.6e6;case "minute":return 1440*t+s/6e4;case "second":return 86400*t+s/1e3;case "millisecond":return Math.floor(8.64e7*t)+s;default:throw new Error("Unknown unit "+e)}},U.asMilliseconds=de,U.asSeconds=t,U.asMinutes=ye,U.asHours=he,U.asDays=Fe,U.asWeeks=_e,U.asMonths=me,U.asQuarters=Qe,U.asYears=i,U.valueOf=ce,U._bubble=function(){var e=this._milliseconds,t=this._days,n=this._months,s=this._data;return 0<=e&&0<=t&&0<=n||e<=0&&t<=0&&n<=0||(e+=8.64e7*gn(pn(n)+t),n=t=0),s.milliseconds=e%1e3,e=m(e/1e3),s.seconds=e%60,e=m(e/60),s.minutes=e%60,e=m(e/60),s.hours=e%24,t+=m(e/24),n+=e=m(wn(t)),t-=gn(pn(e)),e=m(n/12),n%=12,s.days=t,s.months=n,s.years=e,this},U.clone=function(){return C(this)},U.get=function(e){return e=o(e),this.isValid()?this[e+"s"]():NaN},U.milliseconds=we,U.seconds=fe,U.minutes=ge,U.hours=Pe,U.days=d,U.weeks=function(){return m(this.days()/7)},U.months=vn,U.years=Dn,U.humanize=function(e,t){var n,s;return this.isValid()?(n=!1,s=Sn,"object"==typeof e&&(t=e,e=!1),"boolean"==typeof e&&(n=e),"object"==typeof t&&(s=Object.assign({},Sn,t),null!=t.s)&&null==t.ss&&(s.ss=t.s-1),e=this.localeData(),t=On(this,!n,s,e),n&&(t=e.pastFuture(+this,t)),e.postformat(t)):this.localeData().invalidDate()},U.toISOString=xn,U.toString=xn,U.toJSON=xn,U.locale=Xt,U.localeData=Kt,U.toIsoString=e("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",xn),U.lang=Ke,s("X",0,0,"unix"),s("x",0,0,"valueOf"),h("x",ke),h("X",/[+-]?\d+(\.\d{1,3})?/),v("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e))}),v("x",function(e,t,n){n._d=new Date(M(e))}),_.version="2.30.1",H=R,_.fn=u,_.min=function(){return Pt("isBefore",[].slice.call(arguments,0))},_.max=function(){return Pt("isAfter",[].slice.call(arguments,0))},_.now=function(){return Date.now?Date.now():+new Date},_.utc=l,_.unix=function(e){return R(1e3*e)},_.months=function(e,t){return fn(e,t,"months")},_.isDate=V,_.locale=ft,_.invalid=I,_.duration=C,_.isMoment=k,_.weekdays=function(e,t,n){return mn(e,t,n,"weekdays")},_.parseZone=function(){return R.apply(null,arguments).parseZone()},_.localeData=P,_.isDuration=Ut,_.monthsShort=function(e,t){return fn(e,t,"monthsShort")},_.weekdaysMin=function(e,t,n){return mn(e,t,n,"weekdaysMin")},_.defineLocale=mt,_.updateLocale=function(e,t){var n,s;return null!=t?(s=ut,null!=W[e]&&null!=W[e].parentLocale?W[e].set(X(W[e]._config,t)):(t=X(s=null!=(n=ct(e))?n._config:s,t),null==n&&(t.abbr=e),(s=new K(t)).parentLocale=W[e],W[e]=s),ft(e)):null!=W[e]&&(null!=W[e].parentLocale?(W[e]=W[e].parentLocale,e===ft()&&ft(e)):null!=W[e]&&delete W[e]),W[e]},_.locales=function(){return ee(W)},_.weekdaysShort=function(e,t,n){return mn(e,t,n,"weekdaysShort")},_.normalizeUnits=o,_.relativeTimeRounding=function(e){return void 0===e?Yn:"function"==typeof e&&(Yn=e,!0)},_.relativeTimeThreshold=function(e,t){return void 0!==Sn[e]&&(void 0===t?Sn[e]:(Sn[e]=t,"s"===e&&(Sn.ss=t-1),!0))},_.calendarFormat=function(e,t){return (e=e.diff(t,"days",!0))<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse"},_.prototype=u,_.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},_});var cardTypeDictionary=window.top.cardTypeDictionary,currentActionCardIndex=1;Array.prototype.unique=function(){return this.reduce(function(uniqueArray,current){uniqueArray.indexOf(current)<0&&uniqueArray.push(current);return uniqueArray},[])};function populateCardTypeDictionary(){var resourcesArray=[];if(_Script.isNullOrUndefined(cardTypeDictionary)){cardTypeDictionary={};for(cardTypeIndex=0;cardTypeIndex<Mscrm.CardTypeData.length;cardTypeIndex++){var cardTypeData=Mscrm.CardTypeData[cardTypeIndex];cardTypeDictionary[cardTypeData.cardtypeid.split("{").pop().split("}")[0]]=cardTypeData;resourcesArray=pushResourceStringsFromCardType(cardTypeData,resourcesArray)}Xrm.Internal.getStringKeyList(resourcesArray.unique(),window.top);window.top.cardTypeDictionary=cardTypeDictionary}}function pushResourceStringsFromCardType(cardTypeData,resourcesArray){if(cardTypeData.actions){var actionObject=JSON.parse(cardTypeData.actions),webClientActions=actionObject["WebClient"],actions=webClientActions["Actions"];resourcesArray=resourcesArray.concat(Object.keys(actions))}cardTypeData.softtitle&&resourcesArray.push(cardTypeData.softtitle);var cardName=cardTypeData.cardname;if(cardName){if(cardName.indexOf(":")>=0)cardName=cardName.replace(":","_");resourcesArray.push("CardType_ToolTip_"+cardName)}return resourcesArray}function loadCards(isCarouselView){try{populateCardTypeDictionary();if(!isCarouselView||Mscrm.ActionCardData.length<=2){$("#previousActionCard").hide();$("#nextActionCard").hide()}if(Mscrm.ActionCardData.length<=0)try{var emptyCardMessage=Xrm.Internal.getResourceString("DelveActionHub.NoRecordsMessage",window.top);$(parent.$("#noCardMessageDiv")).html(emptyCardMessage)}catch(ex){}var arguments={};arguments["isCarouselView"]=isCarouselView;if(Mscrm.ActionCardData.length>0){$("#smileyCard").hide();window.top.SHOWCAROUSEL=true;var resourcesArray=[];for(actionCardIndex=0;actionCardIndex<Mscrm.ActionCardData.length;actionCardIndex++){var actionCardData=Mscrm.ActionCardData[actionCardIndex];resourcesArray=pushResourceStringsFromActionCard(actionCardData,resourcesArray)}Xrm.Internal.getStringKeyList(resourcesArray.unique(),window.top);arguments["whatsDisplayed"]="allCards";loadActionCards(isCarouselView,0,null);if(isCarouselView&&!_Script.isNullOrUndefined(parent))if(!_Script.isNullOrUndefined(parent.frames["WebResource_PersonalWall"])&&!_Script.isNullOrUndefined(parent.frames["WebResource_PersonalWall"].ActivityFeeds)&&parent.frames["WebResource_PersonalWall"].ActivityFeeds.UI.DefaultFilterStateTracker.get_savedDefaultPostSourceFilter().context==3)return;else $(parent.$("#containerID")).show()}else if(isCarouselView){arguments["whatsDisplayed"]="noCards";parent&&$(parent.$("#containerID")).hide()}else{arguments["whatsDisplayed"]="smileyCard";window.top.SHOWCAROUSEL=false;var emptyCardMessageHeader=Xrm.Internal.getResourceString("ActionCard.CFC.Common.NoCardsTitle",window.top),emptyCardMessage=Xrm.Internal.getResourceString("DelveActionHub.NoRecordsMessage",window.top);$("#emptyCardMessageHeaderDiv").html(emptyCardMessageHeader);$("#emptyCardMessageDiv").html(emptyCardMessage);$("#smileyCard").show(500)}Mscrm.MetricsReporting.instance().addMetric("ActionCardOnLoad",arguments)}catch(ex){console.log("loadCards failed")}}function pushResourceStringsFromActionCard(actionCardData,resourcesArray){if(actionCardData.referencetokens){var referenceTokenObject=JSON.parse(actionCardData.referencetokens)["Tokens"];referenceTokenObject["title"]&&resourcesArray.push(referenceTokenObject["title"]["ResourceId"]);referenceTokenObject["body"]&&resourcesArray.push(referenceTokenObject["body"]["ResourceId"])}return resourcesArray}function loadActionCards(isCarouselView,cardDisplayType,dismissedCardId){currentActionCardIndex=1;for(var displayedCardIds=[],actionCardIndex=1;actionCardIndex<=Mscrm.ActionCardData.length;actionCardIndex++){var domElement=document.getElementById("card"+actionCardIndex);if(domElement!=null&&domElement!=undefined){var varCardTypeData=cardTypeDictionary[Mscrm.ActionCardData[actionCardIndex-1].cardtypeid.Id.toString().toUpperCase()],varActionCardData=Mscrm.ActionCardData[actionCardIndex-1];varActionCardData.cardTypeData=varCardTypeData;actionCardIndex==1&&$("#previousImage").hide();var objCardData={mode:"medium",cardId:varActionCardData.actioncardid,cardName:varCardTypeData.cardname?typeof varCardTypeData.cardname=="object"?varCardTypeData.cardname.get_value():varCardTypeData.cardname:"",cardTypeIcon:varCardTypeData.cardtypeicon?typeof varCardTypeData.cardtypeicon=="object"?varCardTypeData.cardtypeicon.get_value():varCardTypeData.cardtypeicon:"",softTitle:varCardTypeData.softtitle?typeof varCardTypeData.softtitle=="object"?varCardTypeData.softtitle.get_value():varCardTypeData.softtitle:"",title:varActionCardData.title,description:varActionCardData.description,data:varActionCardData},ActionCardControl=MscrmControls.ActionCard.varActionCardControl({cardData:objCardData,isCarouselView:isCarouselView,cardDisplayType:cardDisplayType,dismissedCardId:dismissedCardId});ReactDOM.render(ActionCardControl,domElement);displayedCardIds[displayedCardIds.length]=varActionCardData.actioncardid.toString()}}if(!isCarouselView||Mscrm.ActionCardData.length<=2)$("#nextImage").hide();else $("#nextImage").show();if(dismissedCardId){var dismissedCard=$("#"+dismissedCardId);if(dismissedCard!=null&&dismissedCard.length>0){var yesAnchor=dismissedCard.find(".yesanchorclass");if(yesAnchor!=null&&yesAnchor.length>0){yesAnchor.focus();setTimeout(function(){var yesLabel=window.Xrm.Internal.getResourceString("Button_Label_Yes",window.top);yesAnchor[0].setAttribute("aria-label",yesLabel)},4e3)}else{var feedbackoption=dismissedCard.find(".feedbackoptions1");if(feedbackoption!=null&&feedbackoption.length>0){feedbackoption.focus();setTimeout(function(){var optionLabel=window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Option1",window.top);feedbackoption[0].setAttribute("aria-label",optionLabel)},8e3)}}}}else addTelemetryOnCardDisplay(isCarouselView,displayedCardIds)}function loadActionCardsForCarousel(cardDisplayType,dismissedCardId){loadActionCards(true,cardDisplayType,dismissedCardId)}function addTelemetryOnCardDisplay(isCarouselView,displayedCardIds){try{var actionType="actionCardsDisplayed",displayedCardIdsArray=JSON.parse(localStorage.getItem(actionType))||[];if(displayedCardIdsArray.toString()!=displayedCardIds.toString()){var arguments={};arguments["actionType"]=actionType;arguments["cardType"]=displayedCardIds.toString();arguments["isWebClient"]=isCarouselView;Mscrm.MetricsReporting.instance().addMetric("relationshipcardactiontaken",arguments);localStorage.setItem(actionType,JSON.stringify(displayedCardIds))}}catch(e){}}function loadPreviousActionCards(){if(currentActionCardIndex==1){$("#previousImage").hide();return}$(".actionhubcontrol").removeClass("actionhubcontrolAnimation");currentActionCardIndex==Mscrm.ActionCardData.length&&$("#nextImage").show();var id=Mscrm.ActionCardData[currentActionCardIndex-1].actioncardid;currentActionCardIndex--;eval("Mscrm.CommandBarActions.showPreviousCardFromUI(id)");currentActionCardIndex==1&&$("#previousImage").hide()}function loadNextActionCards(){if(Mscrm.ActionCardData.length>2){$(".actionhubcontrol").removeClass("actionhubcontrolAnimation");if(currentActionCardIndex==Mscrm.ActionCardData.length){$("#nextImage").hide();return}currentActionCardIndex==1&&$("#previousImage").show();var id=Mscrm.ActionCardData[currentActionCardIndex-1].actioncardid;currentActionCardIndex+=1;eval("Mscrm.CommandBarActions.hidePreviousCardFromUI(id)");currentActionCardIndex==Mscrm.ActionCardData.length&&$("#nextImage").hide()}else $("#nextImage").hide()}function applyCarouselCss(){if(Mscrm.ActionCardData.length>0)for(var actioncards=document.getElementsByClassName("actionhubcontrol"),i=0;i<actioncards.length;i++)actioncards[i].setAttribute("style","display:inline-block");else $(parent.$("#containerID")).hide()}function openLegacyRIConfigPopup(){var src=Mscrm.CrmUri.create("/_static/tools/RelationshipIntelligenceConfig/UnifiedConfig.html?ispersonal=true").toString();window.open(src,"_blank","toolbar=0,location=0,menubar=0,resizable=1,width=966,height=628")}function openRIConfiguUiPopUp(){getAppModuleId().then(function(data){if(data.value&&data.value[0]){var appId=data.value[0].appmoduleid;window.open("/main.aspx?pagetype=control&controlName=MscrmControls.UnifiedConfigWrapperControl.UnifiedConfigWrapperControl&navbar=off&appId="+appId,"_blank","toolbar=0,location=0,menubar=0,resizable=1,width=966,height=628")}else window.open("/uclient/main.htm?pagetype=control&controlName=MscrmControls.UnifiedConfigWrapperControl.UnifiedConfigWrapperControl&navbar=off","_blank","toolbar=0,location=0,menubar=0,resizable=1,width=966,height=628")})}function getAppModuleId(){return $.getJSON("/api/data/v8.0/appmodules?$filter=(clienttype eq 8)&$select=appmoduleid&$top=1")}function addTelemetry(cardType,response,reason){try{var arguments={};arguments["cardtype"]=cardType;arguments["response"]=response;arguments["reason"]=reason;Mscrm.MetricsReporting.instance().addMetric("actioncardfeedback",arguments)}catch(e){}}function addActionTelemetry(actionType,cardType,isWebClient){isWebClient=isWebClient=="true";try{var arguments={};arguments["actionType"]=actionType;arguments["cardType"]=cardType;arguments["isWebClient"]=isWebClient;Mscrm.MetricsReporting.instance().addMetric("relationshipcardactiontaken",arguments)}catch(e){}}window.onload=function(){var _window=window,previousImageUrl=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Previous_16.png";$("#previousImage").css("background-image","url("+previousImageUrl+")");$("#previousImage").hover(function(){var previousImageUrlOnHover=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Previous_Hover_16.png";$("#previousImage").css("background-image","url("+previousImageUrlOnHover+")")},function(){$("#previousImage").css("background-image","url("+previousImageUrl+")")});var nextImageUrl=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Next_16.png";$("#nextImage").css("background-image","url("+nextImageUrl+")");$("#nextImage").hover(function(){var nextImageUrlOnHover=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Next_Hover_16.png";$("#nextImage").css("background-image","url("+nextImageUrlOnHover+")")},function(){$("#nextImage").css("background-image","url("+nextImageUrl+")")});var customizationImageUrl=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Card_customization_16.png";$("#customizationImage").css("background-image","url("+customizationImageUrl+")");$("#customizationImage").hover(function(){var customizationImageUrlOnhover=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Card_Customization_Hover_16.png";$("#customizationImage").css("background-image","url("+customizationImageUrlOnhover+")")},function(){$("#customizationImage").css("background-image","url("+customizationImageUrl+")")});$("#previousAnchor").on("keydown click",function(e){if(e.which===13||e.which===32||e.type==="click"){e.preventDefault();loadPreviousActionCards()}});$("#nextAnchor").on("keydown click",function(e){if(e.which===13||e.which===32||e.type==="click"){e.preventDefault();loadNextActionCards()}});$("#customizeAnchor").on("keydown click",function(e){if(e.which===13||e.which===32||e.type==="click"){e.preventDefault();openRIConfiguUiPopUp()}});setTabIndexes()};function setTabIndexes(){if(window.parent.document.getElementById("actionhubcontrol_notescontrol_container")){var tabIndex=window.parent.document.getElementById("actionhubcontrol_notescontrol_container").getAttribute("actionhubtabindex");window.parent.document.getElementById("actionhubcontrol_notescontrol_container").childNodes[5]&&window.parent.document.getElementById("actionhubcontrol_notescontrol_container").childNodes[5].childNodes[1]&&window.parent.document.getElementById("actionhubcontrol_notescontrol_container").childNodes[5].childNodes[1].setAttribute("tabindex",tabIndex);$("#cardTypeHeader").attr("tabindex",tabIndex);$("#delveActionHubPreview").attr("tabindex","-1");$("#imgRefreshWall").attr("tabindex",tabIndex)}};var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},Mscrm;(function(Mscrm){var ContextHelper=function(){function ContextHelper(){}ContextHelper.createControl=function(props,control){control.crmContext=ContextHelper.generateContext(props);return ReactUtils.createComponent(control)};ContextHelper.generateContext=function(props){return {parameters:props}};ContextHelper.prototype.generateLookupContext=function(props){return {parameters:props}};return ContextHelper}();Mscrm.ContextHelper=ContextHelper;Mscrm.actioncardTabIndex=1;Mscrm.isRTL=false})(Mscrm||(Mscrm={}));var ReactUtils;(function(ReactUtils){function createComponent(spec){return React.createFactory(React.createClass(extractMembers(spec)))}ReactUtils.createComponent=createComponent;function createMixin(mixin){return extractMembers(mixin)}ReactUtils.createMixin=createMixin;function extractMembers(mixin){var skipList=["constructor","forceUpdate"],indexableMixin=mixin,members={};for(var key in indexableMixin)if(skipList.indexOf(key)===-1)members[key]=indexableMixin[key];return members}var ComponentBase=function(){function ComponentBase(){}return ComponentBase}();ReactUtils.ComponentBase=ComponentBase})(ReactUtils||(ReactUtils={}));var Mscrm;(function(Mscrm){var Controls;(function(Controls){var VDOM;(function(VDOM){function span(context,properties,children){return React.DOM.span(properties,children)}VDOM.span=span;function div(context,properties,children){return React.DOM.div(properties,children)}VDOM.div=div;function anchor(context,properties,children){return React.DOM.a(properties,children)}VDOM.anchor=anchor;function button(context,properties,children){return React.DOM.button(properties,children)}VDOM.button=button;function input(context,properties,children){return React.DOM.input(properties,children)}VDOM.input=input;function label(context,properties,children){return React.DOM.label(properties,children)}VDOM.label=label;function option(context,properties,children){return React.DOM.option(properties,children)}VDOM.option=option;function select(context,properties,children){return React.DOM.select(properties,children)}VDOM.select=select;function table(context,properties,children){return React.DOM.table(properties,children)}VDOM.table=table;function tr(context,properties,children){return React.DOM.tr(properties,children)}VDOM.tr=tr;function td(context,properties,children){return React.DOM.td(properties,children)}VDOM.td=td;function img(context,properties,children){return React.DOM.img(properties,children)}VDOM.img=img;function ul(context,properties,children){return React.DOM.ul(properties,children)}VDOM.ul=ul;function li(context,properties,children){return React.DOM.li(properties,children)}VDOM.li=li;function br(context,properties,children){return React.DOM.br(properties,children)}VDOM.br=br;function hr(context,properties,children){return React.DOM.hr(properties,children)}VDOM.hr=hr})(VDOM=Controls.VDOM||(Controls.VDOM={}));var VirtualComponentBase=function(_super){__extends(VirtualComponentBase,_super);function VirtualComponentBase(){_super.apply(this,arguments);this.observables=[]}VirtualComponentBase.prototype.render=function(){return this.onRender()};VirtualComponentBase.prototype.getContext=function(){return this.crmContext};VirtualComponentBase.prototype.createObservable=function(event){if(this.observables==null){var evt=this.observables[event];if(typeof evt==="undefined")this.observables[event]=new Rx.Subject}return this.observables[event]};VirtualComponentBase.prototype.onRender=function(){};return VirtualComponentBase}(ReactUtils.ComponentBase);Controls.VirtualComponentBase=VirtualComponentBase})(Controls=Mscrm.Controls||(Mscrm.Controls={}))})(Mscrm||(Mscrm={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var GenericCardFactory=function(){function GenericCardFactory(){}GenericCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,isGroup:isGroup,showTitleInfo:args.mode==="small"?false:true,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,contextTemplateData:cardData.data&&cardData.data!=null&&cardData.data.cardContextDetails?cardData.data.cardContextDetails:null,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:cardData.data&&cardData.data!=null&&cardData.data.cardRelatedInfo?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon&&args.cardTypeIcon!==""?args.cardTypeIcon:cardData.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,regardingObject:cardData.regardingobjectid,showIcon:args.showIcon,key:args.key,showDescription:args.showDescription,showMenu:args.showMenu,showSuccessCardOverlay:args.showSuccessCardOverlay,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.GenericCardControl(props)};GenericCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[cardData],groupedData=_.groupBy(data,"cardName");if(args.additionalData&&args.additionalData[cardData.cardId])for(var additionalData=args.additionalData[cardData.cardId],keys=Object.keys(additionalData),index=0;index<keys.length;index++)groupedData[keys[index]]=additionalData[keys[index]];return groupedData};GenericCardFactory.prototype.generateAdditionalData=function(cardData,args){if(CRMNow.CardUtils.isCCFMode()&&cardData.regardingobjectid&&cardData.regardingobjectid!=null&&cardData.regardingobjectid.LogicalName&&cardData.regardingobjectid.Id){var params=this.getParameterInfo(cardData);args["cardData"]=cardData;var refs=[CRMNow.CardService.getRegardingData(params,args)];return refs}return []};GenericCardFactory.prototype.getParameterInfo=function(cardData){var data={logicalName:cardData.regardingobjectid.LogicalName,entityId:cardData.regardingobjectid.Id.toString()};return data};return GenericCardFactory}();CRMNow.GenericCardFactory=GenericCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var MeetingCardFactory=function(){function MeetingCardFactory(){}MeetingCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){if(cardData.cardName=="UPCOMING_MEETING"&&!isGroup)args.mode="medium";var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,softTitleGenerator:null,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,showMap:args.showMap?args.showMap:false,regardingObject:cardData.regardingobjectid,showMenu:args.showMenu,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.MeetingCardControl(props)};MeetingCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,regardingobjectid:cardData.regardingobjectid,data:{cardContextDetails:cardData.data.cardContextDetails?cardData.data.cardContextDetails:null,cardRelatedInfo:{starttime:cardData.data.cardRelatedInfo?cardData.data.cardRelatedInfo.starttime?cardData.data.cardRelatedInfo.starttime:"":null},mailweblink:cardData.data.mailweblink?cardData.data.mailweblink:""}};data.push(meetingData);for(var i in cardData.data.cardRelatedInfo.attendees){var curAttendee=cardData.data.cardRelatedInfo.attendees[i],options={mode:"small",cardData:cardData,curAttendee:curAttendee,cardId:"ATTENDEE"+i.toString(),cardName:"ATTENDEE",softTitle:CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingMeeting.AttendeesText")};data.push(this.getDataObj(options))}if(cardData.cardName!=="ACTIVITY_MEETING")if(cardData.data.cardRelatedInfo.address!=""&&cardData.data.cardRelatedInfo.bingApiKey){var mapData={mode:"medium",softTitle:CRMNow.CardUtils.getResources("ActionCard.CFC.Meeting.Location"),title:cardData.title,description:cardData.description,cardId:"Map0",cardName:"MAP",cardTypeIcon:"",cardOptionIcon:"",groupBackIcon:"",summaryText:cardData.summaryText,data:{cardRelatedInfo:{address:cardData.data.cardRelatedInfo.address,bingApiKey:cardData.data.cardRelatedInfo.bingApiKey}}};data.push(mapData)}else if(cardData.data.cardRelatedInfo.address!=""){var mapData={mode:"medium",softTitle:CRMNow.CardUtils.getResources("ActionCard.CFC.Meeting.Location"),title:cardData.title,description:cardData.description,cardId:"Map0",cardName:"MAP",cardTypeIcon:"",cardOptionIcon:"",groupBackIcon:"",summaryText:cardData.summaryText,data:{cardRelatedInfo:{address:cardData.data.cardRelatedInfo.address}}};data.push(mapData)}var groupedData=_.groupBy(data,"cardName");if(args.additionalData&&args.additionalData[cardData.cardId])for(var additionalData=args.additionalData[cardData.cardId],keys=Object.keys(additionalData),index=0;index<keys.length;index++)groupedData[keys[index]]=additionalData[keys[index]];return groupedData};MeetingCardFactory.prototype.generateAdditionalData=function(cardData,args){if(CRMNow.CardUtils.isCCFMode()){var regardingData,attendeeData;args["cardData"]=cardData;if(cardData.regardingobjectid&&cardData.regardingobjectid!=null&&cardData.regardingobjectid.LogicalName&&cardData.regardingobjectid.Id){var attParams=this.getParameterInfo(cardData,true);attParams["logicalName"]="meetingData";args["detailsView"]=true;args["cardData"]=cardData;attendeeData=CRMNow.CardService.getAttendeesData(attParams,args);var regParams=this.getParameterInfo(cardData,true);regardingData=CRMNow.CardService.getRegardingData(regParams,args)}var params=this.getParameterInfo(cardData,false),stocks=CRMNow.CardService.getStocksData(params,args),news=CRMNow.CardService.getNewsData(params,args),refs=[attendeeData,regardingData,stocks,news];cardData&&cardData.data&&cardData.data.cardRelatedInfo.bingApiKey&&refs.push(CRMNow.CardService.getNearbyCustomers(cardData.data.cardRelatedInfo.address,cardData.data.cardRelatedInfo.bingApiKey,args));return refs}return []};MeetingCardFactory.prototype.getAttendeesData=function(cardData,args){var attendeeData;if(CRMNow.CardUtils.isCCFMode()){var attParams=this.getParameterInfo(cardData,true);attParams["logicalName"]="meetingData";return CRMNow.CardService.getAttendeesData(attParams,args)}return []};MeetingCardFactory.prototype.getParameterInfo=function(cardData,isRegarding){if(!isRegarding){var data=[],cardContextDetails=cardData.data.cardContextDetails;for(var key in cardContextDetails){var context=cardContextDetails[key].contextObject;data.push({logicalName:context.entityName,entityId:context.guid})}return data}else{var data={};if(cardData.regardingobjectid)data={logicalName:cardData.regardingobjectid.LogicalName,entityId:cardData.regardingobjectid.Id.toString()};return data}};MeetingCardFactory.prototype.getDataObj=function(args){var curAttendee=args.curAttendee,cardId=args.cardId,cardName=args.cardName,summary=args.summary,mode=args.mode,cardData=args.cardData,cardObj={mode:mode,cardId:cardId,cardName:cardName,summaryText:summary,softTitle:CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingMeeting.AttendeesText"),title:curAttendee.contextPrimaryInfo.title,description:curAttendee.contextPrimaryInfo.description,cardTypeIcon:curAttendee.contextIcon,cardOptionIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAHRJREFUWIXtlDEOgDAMAw/E1K3iC3yGF/Oqio21LGZgTIuAwTfVkdpaSWQw5mOGjrszkHQ+gPKmgRnYgCxdgBXYow9NjQaSPl+kq2phA2Ojgcdo7cA18ypdVAvTs4SZ+xKG22/AOeAccA4Y54BzwDlgzA84AVMHKhzbfPhRAAAAAElFTkSuQmCC",groupBackIcon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAArCAYAAAAUo/pwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAIgSURBVFhH7ZZNSxtBGMf/k0w2b7a0pYYepCZ4qFBb2kNV0B76GVoQvRUVT578BH4DQT0qKIgfoMcei5Q2KlLvvtCglECTaJLVJDvxmbBCKWJm4iwssr/LLuwy+5vnZfZhTQI+hF1Uzv0pdrD33Z9iR/tZX4qF3KvvCMR0CcR0CcR0ub9ijLk3hrmTWCTMcFJycNloGhfsWCzGGXZzNcx/LeO44IAbLoqOlouSVPZ3DYtbVYy9iSPzhKMh3IeG0BaTUtuu1MTbOEbTFiwOmJ7qtMRaUpS+JZIaJ6kRj6QkymIWSe2Q1LKbvvcZ76QkSvNYmPT3T+tY27bx6XUcH/oscOrI9lM5gyOasKlrZQ3qNK6SWI6OhLkvZ3Q0CLx8xhGiL6hEqkZSL7o5Pr6KoT8VQd1RD6+SWOlCYOFbBVtHdUwPJRANA/TNtkiPp8kQBmgzqa4QRc99oICSmIzQn3OBzT2b0sowO5JA0qI0KcgJkqnRiyob+RflmV+e8rliA6tZu3W4zgwn8CAma8h9wTDKXSnro+cRx+d3cVTrAis/qyjZzVZjeIHWslLuOclNDiZQpLpb37FR8EhOe0lZL72POaZILl9xsLFrI18WoEwbpaO9ymkiTf9H2aFnFLnypfnpQrn4b8KiMP2tCsQizB/TxTUyrQ+pMyN+qLH/kedTxyG/BQ/2aoZATJdATJdATJdATJdATBd2+OuHF7+6OwJcAfQP04PXKjyQAAAAAElFTkSuQmCC",data:{cardContextDetails:[curAttendee]}};return cardObj};MeetingCardFactory.prototype.filterExpiredCard=function(cardData){var isNotExpired=true;if(cardData.cardName=="UPCOMING_MEETING")if(cardData.data&&cardData.data.cardRelatedInfo&&cardData.data.cardRelatedInfo.starttime){var now=moment(new Date),startTime=moment(cardData.data.cardRelatedInfo.starttime),duration=moment.duration(startTime.diff(now));if(duration.hours()<0||duration.minutes()<0||duration.seconds()<0)isNotExpired=false}return isNotExpired};return MeetingCardFactory}();CRMNow.MeetingCardFactory=MeetingCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var GroupCardFactory=function(){function GroupCardFactory(){}GroupCardFactory.prototype.generateCardContainer=function(cardData,args){var el=CRMNow.GroupCardControl({cardData:cardData,currentView:args.currentView,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showMenu:args.showMenu,selectedCardType:args.selectedGroupCard,callbackContainer:args.callbackContainer,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,groupType:args.groupType?args.groupType:"",showGroupCardHeader:args.showGroupCardHeader,groupTitle:args.groupTitle?args.groupTitle:"",getReferenceTokenData:args.getReferenceTokenData,getActionData:args.getActionData,overlayCardId:args.overlayCardId,showIcon:args.showIcon,key:args.key,canNavigate:args.canNavigate!=undefined?args.canNavigate:true,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager});return el};GroupCardFactory.prototype.generateDetailsViewData=function(cardData,args){};return GroupCardFactory}();CRMNow.GroupCardFactory=GroupCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TaskCardFactory=function(){function TaskCardFactory(){}TaskCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,softTitleGenerator:null,showSuccessCardOverlay:args.showSuccessCardOverlay,regardingObject:cardData.regardingobjectid,showMenu:args.showMenu,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.TaskCardControl(props)};TaskCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],maindata={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data,regardingobjectid:cardData.regardingobjectid};data.push(maindata);var groupedData=_.groupBy(data,"cardName");if(args.additionalData&&args.additionalData[cardData.cardId])for(var additionalData=args.additionalData[cardData.cardId],keys=Object.keys(additionalData),index=0;index<keys.length;index++)groupedData[keys[index]]=additionalData[keys[index]];return groupedData};TaskCardFactory.prototype.generateAdditionalData=function(cardData,args){if(CRMNow.CardUtils.isCCFMode()){var regardingData;args["cardData"]=cardData;if(cardData.regardingobjectid&&cardData.regardingobjectid!=null&&cardData.regardingobjectid.LogicalName&&cardData.regardingobjectid.Id){var regParams=this.getParameterInfo(cardData,true);regardingData=CRMNow.CardService.getRegardingData(regParams,args)}var params=this.getParameterInfo(cardData,false),stocks=CRMNow.CardService.getStocksData(params,args),news=CRMNow.CardService.getNewsData(params,args),refs=[regardingData,stocks,news];return refs}return []};TaskCardFactory.prototype.getParameterInfo=function(cardData,isRegarding){if(!isRegarding){var data=[],cardContextDetails=cardData.data.cardContextDetails;for(var key in cardContextDetails){var context=cardContextDetails[key].contextObject;data.push({logicalName:context.entityName,entityId:context.guid})}return data}else{var data={logicalName:cardData.regardingobjectid.LogicalName,entityId:cardData.regardingobjectid.Id.toString()};return data}};return TaskCardFactory}();CRMNow.TaskCardFactory=TaskCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var PhoneCardFactory=function(){function PhoneCardFactory(){}PhoneCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,softTitleGenerator:null,showSuccessCardOverlay:args.showSuccessCardOverlay,regardingObject:cardData.regardingobjectid,showMenu:args.showMenu,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.PhoneCardControl(props)};PhoneCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],maindata={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data,regardingobjectid:cardData.regardingobjectid,commandManager:args.commandManager};data.push(maindata);var groupedData=_.groupBy(data,"cardName");if(args.additionalData&&args.additionalData[cardData.cardId])for(var additionalData=args.additionalData[cardData.cardId],keys=Object.keys(additionalData),index=0;index<keys.length;index++)groupedData[keys[index]]=additionalData[keys[index]];return groupedData};PhoneCardFactory.prototype.generateAdditionalData=function(cardData,args){if(CRMNow.CardUtils.isCCFMode()){var regardingData;args["cardData"]=cardData;if(cardData.regardingobjectid&&cardData.regardingobjectid!=null&&cardData.regardingobjectid.LogicalName&&cardData.regardingobjectid.Id){var regParams=this.getParameterInfo(cardData,true);regardingData=CRMNow.CardService.getRegardingData(regParams,args)}var params=this.getParameterInfo(cardData,false),stocks=CRMNow.CardService.getStocksData(params,args),news=CRMNow.CardService.getNewsData(params,args),refs=[regardingData,stocks,news];return refs}return []};PhoneCardFactory.prototype.getParameterInfo=function(cardData,isRegarding){if(!isRegarding){var data=[],cardContextDetails=cardData.data.cardContextDetails;for(var key in cardContextDetails){var context=cardContextDetails[key].contextObject;data.push({logicalName:context.entityName,entityId:context.guid})}return data}else{var data={logicalName:cardData.regardingobjectid.LogicalName,entityId:cardData.regardingobjectid.Id.toString()};return data}};return PhoneCardFactory}();CRMNow.PhoneCardFactory=PhoneCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var EmailCardFactory=function(){function EmailCardFactory(){}EmailCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data!=null?cardData.data.cardContextDetails!=undefined?cardData.data.cardContextDetails:"":"",showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:cardData.data!=null?cardData.data.cardRelatedInfo!=undefined?cardData.data.cardRelatedInfo:"":"",showActionInfo:true,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:cardData.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,regardingObject:cardData.regardingobjectid,key:args.key,showMenu:args.showMenu,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.EmailCardControl(props)};EmailCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],emailData={mode:"medium",title:cardData.title,softTitle:cardData.softTitle,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,regardingobjectid:cardData.regardingobjectid,data:cardData.data};data.push(emailData);var groupedData=_.groupBy(data,"cardName");return groupedData};return EmailCardFactory}();CRMNow.EmailCardFactory=EmailCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var NewsCardFactory=function(){function NewsCardFactory(){}NewsCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,regardingObject:cardData.regardingobjectid,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.NewsCardControl(props)};NewsCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardOptionIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data};data.push(meetingData);var groupedData=_.groupBy(data,"cardName");return groupedData};return NewsCardFactory}();CRMNow.NewsCardFactory=NewsCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var NearByCustomerCardFactory=function(){function NearByCustomerCardFactory(){}NearByCustomerCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:cardData.snoozeTime,dismiss:cardData.dismiss,regardingObject:cardData.regardingobjectid,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.NearbyCustomerControl};NearByCustomerCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data};data.push(meetingData);var groupedData=_.groupBy(data,"cardName");return groupedData};return NearByCustomerCardFactory}();CRMNow.NearByCustomerCardFactory=NearByCustomerCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TopPeopleCardFactory=function(){function TopPeopleCardFactory(){}TopPeopleCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:false,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,showIcon:args.showIcon,key:args.key,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.TopPeopleOfTheDayControl(props)};TopPeopleCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:CRMNow.CardUtils.getResources(cardData.description),cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data};data.push(meetingData);var groupedData=_.groupBy(data,"cardName");return groupedData};return TopPeopleCardFactory}();CRMNow.TopPeopleCardFactory=TopPeopleCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TopRecordsCardFactory=function(){function TopRecordsCardFactory(){}TopRecordsCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:false,actionTemplate:null,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:args.snoozetime,dismiss:args.dismiss,canShowDetailsView:args.canShowDetailsView,showIcon:args.showIcon,key:args.key,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.TopRecordsOfTheDayControl(props)};TopRecordsCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:CRMNow.CardUtils.getResources(cardData.description),cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data};data.push(meetingData);var groupedData=_.groupBy(data,"cardName");return groupedData};return TopRecordsCardFactory}();CRMNow.TopRecordsCardFactory=TopRecordsCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var StockActivityCardFactory=function(){function StockActivityCardFactory(){}StockActivityCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:cardData,mode:args.mode,showSnooze:args.showSnooze,showDismiss:args.showDismiss,showTitleInfo:true,isGroup:isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:args.cardTypeIcon,snoozetime:cardData.snoozeTime,dismiss:cardData.dismiss,regardingObject:cardData.regardingobjectid,key:args.key,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.StockActivityCardControl(props)};StockActivityCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],meetingData={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardOptionIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:cardData.data};data.push(meetingData);var groupedData=_.groupBy(data,"cardName");return groupedData};return StockActivityCardFactory}();CRMNow.StockActivityCardFactory=StockActivityCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var FlightCardFactory=function(){function FlightCardFactory(){}FlightCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var props={cardData:this.getTitle(cardData),mode:args.mode,showSnooze:false,showDismiss:false,snoozetime:args.snoozetime,dismiss:args.dismiss,isGroup:isGroup,showTitleInfo:true,actionTemplate:null,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:cardData.data?cardData.data.cardContextDetails:null,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,showActionInfo:true,actionData:args.cardActionData&&args.cardActionData!=null?args.cardActionData:null,callbackContainer:args.callbackContainer,cardTypeIcon:"generalCard-leftblock-nobg CRMMDL2 icon-flight",canShowDetailsView:false,showMenu:false,isGlobalPanelEnabled:args.isGlobalPanelEnabled,commandManager:args.commandManager};props=args.getReferenceTokenData?args.getReferenceTokenData(cardData,props):props;return CRMNow.FlightCardControl(props)};FlightCardFactory.prototype.generateDetailsViewData=function(cardData,args){var data=[],flightCard={mode:"medium",softTitle:cardData.softTitle,title:cardData.title,description:cardData.description,cardId:cardData.cardId,cardName:cardData.cardName,cardTypeIcon:cardData.cardTypeIcon,cardOptionIcon:cardData.cardOptionIcon,groupBackIcon:cardData.groupBackIcon,summaryText:cardData.summaryText,actions:cardData.actions,data:{cardContextDetails:[],cardRelatedInfo:cardData.data.cardRelatedInfo}};data.push(flightCard);for(var item=0;item<cardData.data.cardContextDetails.length;item++)for(var contextData=cardData.data.cardContextDetails[item],groupKeys=Object.keys(contextData),index=0;index<groupKeys.length;index++){var groupData=contextData[groupKeys[index]];groupData!=""&&groupData!=undefined&&groupData.map!=undefined&&groupData.map(function(card){data.push(card)})}var groupedData=_.groupBy(data,"cardName");return groupedData};FlightCardFactory.prototype.generateAdditionalData=function(cardData,args){if(CRMNow.CardUtils.isCCFMode()){var params,refs=[];if(args.fetch=="FetchMeeting"){params=this.getParameterInfo(cardData);refs=[CRMNow.CardService.getFlightRegardingData(params,args)]}else refs.push(CRMNow.CardService.getNearbyCustomers(cardData.data.cardRelatedInfo.arrivalAirport.name,cardData.data.cardRelatedInfo.bingApiKey,args));return refs}return []};FlightCardFactory.prototype.getParameterInfo=function(cardData){var data={logicalName:"flightMeeting",dateTime:cardData.data.cardRelatedInfo.arrivalTime};return data};FlightCardFactory.prototype.getTitle=function(cardData){var diffInMinutes=moment(cardData.data.cardRelatedInfo.departureTime).diff(moment(),"minutes"),hours=0,description;hours=diffInMinutes/60;hours=hours|0;var minutes=diffInMinutes-hours*60;if(diffInMinutes<0){diffInMinutes=diffInMinutes*-1;description=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartedText");description=MscrmCommon.ControlUtils.String.Format(description,diffInMinutes)}else if(hours>0){description=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartHMText");description=MscrmCommon.ControlUtils.String.Format(description,[hours,minutes])}else{description=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartMText");description=MscrmCommon.ControlUtils.String.Format(description,[minutes])}cardData.title=description;return cardData};return FlightCardFactory}();CRMNow.FlightCardFactory=FlightCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var MapCardFactory=function(){function MapCardFactory(){}MapCardFactory.prototype.generateCardContainer=function(cardData,isGroup,args){var el=CRMNow.MapCardControl({cardData:cardData,mode:args.mode,relatedTemplateData:cardData.data?cardData.data.cardRelatedInfo:null,callbackContainer:args.callbackContainer,snoozetime:args.snoozetime,dismiss:args.dismiss,commandManager:args.commandManager});return el};MapCardFactory.prototype.generateDetailsViewData=function(cardData,args){};return MapCardFactory}();CRMNow.MapCardFactory=MapCardFactory})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var GroupCardView=function(_super){__extends(GroupCardView,_super);function GroupCardView(){_super.call(this);this.dataFactories={UPCOMING_MEETING:new CRMNow.MeetingCardFactory,"AGENDA:ACTIVITY_MEETING":new MscrmControls.CRMNow.MeetingCardFactory,STOCK_ACTIVITY:new MscrmControls.CRMNow.StockActivityCardFactory,RELEVANT_NEWS:new MscrmControls.CRMNow.NewsCardFactory,TOP_RECORD:new MscrmControls.CRMNow.TopRecordsCardFactory,TOP_PEOPLE:new MscrmControls.CRMNow.TopPeopleCardFactory,NEARBY_CUSTOMERS:new MscrmControls.CRMNow.TopPeopleCardFactory,BESTTIMETOCALL:new CRMNow.EmailCardFactory,EMAILOPEN:new CRMNow.EmailCardFactory,REMINDERWITHCALL:new CRMNow.EmailCardFactory,REMINDERWITHOUTCALL:new CRMNow.EmailCardFactory,UPCOMING_FLIGHT:new MscrmControls.CRMNow.FlightCardFactory,"AGENDA:ACTIVITY_PHONE":new MscrmControls.CRMNow.PhoneCardFactory,"AGENDA:ACTIVITY_TASK":new MscrmControls.CRMNow.TaskCardFactory,MAP:new MscrmControls.CRMNow.MapCardFactory,GroupView:new MscrmControls.CRMNow.GroupCardFactory,Generic:new MscrmControls.CRMNow.GenericCardFactory,"AGENDA:ACTIVITY_OTHERS":new MscrmControls.CRMNow.GenericCardFactory};this.menuItemsString=["ActionCard.CFC.Menu.SnoozeAll","ActionCard.CFC.Menu.DismissAll","ActionCard.CFC.Menu.ShowAllCards"];this.timerId=0;this.mouseMoved=false;this.inSwipe=false;this.showMenu=false;this.groupCardTabIndex=-1;this.displayName="GroupCard"}GroupCardView.prototype.getInitialState=function(){return {}};GroupCardView.prototype.handleDismiss=function(cardData,cardName){this.props.callbackContainer&&this.props.callbackContainer("dismiss",{cardId:"",isGroupSwipe:true,cardName:cardName,cardData:cardData})};GroupCardView.prototype.dismissFirstThreeCards=function(cardData,cardName){for(var i=0;i<3;i++)this.props.callbackContainer&&this.props.callbackContainer("dismiss",{cardId:cardData[i].cardId,isGroupSwipe:false,cardName:cardName})};GroupCardView.prototype.handleSnooze=function(cardData,cardName){this.props.callbackContainer&&this.props.callbackContainer("snooze",{cardId:"",isGroupSwipe:true,cardName:cardName,cardData:cardData})};GroupCardView.prototype.componentDidMount=function(){this.fetchActionCommands();this.setLearningPathIDs()};GroupCardView.prototype.setLearningPathIDs=function(){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(CRMNow.CardUtils.ccfContext.learningPath))return;var groupContainer=this.refs["cardList"],controlPrefix=CRMNow.CardUtils.ccfContext.learningPath.baseControlId;$(groupContainer).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|groupCardContainer");var groupTitle=this.refs["groupcardPrimaryTitle"];$(groupTitle).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|groupcardPrimaryTitle");var groupMoreCommands=this.refs["optionBtn"];$(groupMoreCommands).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|optionBtn");var groupCardArrow=this.refs["iconArrow"];$(groupCardArrow).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|iconArrow")};GroupCardView.prototype.fetchActionCommands=function(){var _this=this;if(this.commandManager.commandFetchCompleted)for(var i in this.props.cardData){var commands=this.getActionCommands(this.props.cardData[i]);commands&&commands.length>0&&this.updateCardActions(commands,this.props.cardData[i])}else window.setTimeout(function(){_this.fetchActionCommands()},600)};GroupCardView.prototype.getActionCommands=function(cardData){var commands=this.commandManager.getCommandByCardId(cardData.cardId);if(commands&&commands.length>0)return commands};GroupCardView.prototype.updateCardActions=function(commands,cardData){var container=this.refs["cardList"],actionData=[],actions=jQuery(container).find("[data-action-cardId="+cardData.cardId+"]");actionData=this.getActionData(cardData);if(Mscrm.ActionCardDefaultFocusId==cardData.cardId)this.groupCardTabIndex=Mscrm.actioncardTabIndex;else this.groupCardTabIndex=-1;var count=[0,1];if(actionData&&actionData.length>0)for(var i in count)if(actionData[count[i]]&&actions[count[i]]){jQuery(actions[count[i]]).text(actionData[count[i]].label);jQuery(actions[count[i]]).data("command",actionData[count[i]].label);jQuery(actions[count[i]]).attr("content",actionData[count[i]].command);jQuery(actions[count[i]]).attr("title",actionData[count[i]].label);jQuery(actions[count[i]]).attr("aria-label",actionData[count[i]].label);jQuery(actions[count[i]]).attr("tabIndex",this.groupCardTabIndex)}};GroupCardView.prototype.getActionData=function(card){var cardActions,actionData=[],container=this.refs["cardList"],actions=jQuery(container).find("[data-action-cardId="+card.cardId+"]"),commands=this.commandManager.getCommandByCardId(card.cardId),canShowEmail=true,userAgent=CRMNow.CardUtils.ccfContext.client.userAgent;if(card.actions&&commands&&commands.length>0){var filteredCommands=_.filter(commands,function(cmd){return cmd.command!="Mscrm.HomepageGrid.actioncard.DismissCommand"&&cmd.command!="Mscrm.HomepageGrid.actioncard.SnoozeCommand"&&(cmd.command=="Mscrm.Modern.EmailAttendeesCommand"||cmd.command=="Mscrm.Modern.SendEmailCommand"?canShowEmail:true)});if(card.actions.Mobile)cardActions=card.actions.Mobile.Actions;else if(card.actions.WebClient)cardActions=card.actions.WebClient.Actions;if(cardActions){var actionCount=0;$.each(cardActions,function(label,command){if(actionCount<2){var curcommand=_.find(filteredCommands,function(cmd){return cmd.command==command||cmd.command==command+"Solution"});if(curcommand){actionData.push(curcommand);actionCount++}}});return actionData}}};GroupCardView.prototype.componentWillMount=function(){var _this=this;this.swipeStartObserver=new Rx.Subject;this.swipeEndObserver=new Rx.Subject;this.elementMove=new Rx.Subject;var startX,startY,cardBoundary;this.swipeStartObserver.subscribe(function(mdEvent){var swipeEvent=mdEvent;_this.mouseDown=true;_this.mouseMoved=false;cardBoundary=swipeEvent.currentTarget.getBoundingClientRect();if(swipeEvent.type=="mousedown"){startX=swipeEvent.clientX;startY=swipeEvent.clientY}else if(swipeEvent.type=="touchstart"){startX=swipeEvent.changedTouches[0].clientX;startY=swipeEvent.changedTouches[0].clientY}});this.elementMove.subscribe(function(mmEvent){var currentPosY,currentPosX,swipeEvent=mmEvent,canPerformOp=true;if(_this.mouseDown&&cardBoundary&&cardBoundary.width)if(_this.refs["cardList"]){var swipedElement=_this.refs["cardList"],swipedCard=_this.refs["swipe-content"];if(swipeEvent.type=="mousemove"){currentPosX=swipeEvent.clientX;currentPosY=swipeEvent.clientY}else if(swipeEvent.type=="touchmove"){currentPosX=swipeEvent.changedTouches[0].clientX;currentPosY=swipeEvent.changedTouches[0].clientY}var swipediffY=currentPosY-startY,swipediffX=currentPosX-startX;Math.abs(swipediffX)>10&&mmEvent.preventDefault();var rtlScreenPos=Mscrm.isRTL?-1:1;if(rtlScreenPos*(startX-currentPosX)<=0){if(_this.props.cardData[0]&&!Boolean(_this.props.cardData[0].hasSnoozeDismiss))canPerformOp=false}else canPerformOp=true;if(!_this.inSwipe&&canPerformOp){if(Math.abs(swipediffX)>cardBoundary.width/2)swipedCard.style.opacity="0.5";else swipedCard.style.opacity="1";if(swipediffX!=0)_this.mouseMoved=true;swipedElement.style.transform="translate3d("+swipediffX+"px,0,0)";swipedElement.style.webkitTransform="translate3d("+swipediffX+"px,0,0)";(!(currentPosX>cardBoundary.left&&currentPosX<cardBoundary.right)||!(currentPosY>cardBoundary.top&&currentPosY<cardBoundary.bottom))&&_this.swipeEndHandler(mmEvent)}}});this.swipeEndObserver.subscribe(function(muEvent){var endPosX,endPosY,swipeEvent=muEvent,self=_this;_this.mouseDown=false;var swipedElement=_this.refs["cardList"];if(swipeEvent.type=="mouseup"||swipeEvent.type=="mousemove"){endPosX=swipeEvent.clientX;endPosY=swipeEvent.clientY}else if(swipeEvent.type=="touchend"||swipeEvent.type=="touchmove"){endPosX=swipeEvent.changedTouches[0].clientX;endPosY=swipeEvent.changedTouches[0].clientY}var rtlScreenPos=Mscrm.isRTL?-1:1,groupType=_this.props.cardData[0].cardName?_this.props.cardData[0].cardName:"";if(cardBoundary&&cardBoundary.width)if(Math.abs(startX-endPosX)/cardBoundary.width*100<30||!(endPosY>cardBoundary.top&&endPosY<cardBoundary.bottom))_this.resetCard(event);else if(rtlScreenPos*(endPosX-startX)/cardBoundary.width*100>30&&Boolean(_this.props.cardData[0].hasSnoozeDismiss)){if(cardBoundary.right>=endPosX){var snoozeStateInfo=_this.refs["snooze-state"],snoozeCard=_this.refs["snooze-container"];_this.inSwipe=true;snoozeCard.style.display="none";snoozeStateInfo.style.display="flex";snoozeStateInfo.style.display="-webkit-flex";swipedElement.style.transform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d("+cardBoundary.width+"px,0,0)";swipedElement.style.webkitTransform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d("+cardBoundary.width+"px,0,0)";_this.timerId=setTimeout(function(){jQuery(swipedElement).fadeOut("slow",function(){self.handleSnooze(self.props.cardData,groupType);self.inSwipe=false})},2e3)}}else if(rtlScreenPos*(startX-endPosX)/cardBoundary.width*100>30)if(cardBoundary.left<=endPosX){var dismissStateInfo=_this.refs["dismiss-state"],dismissCard=_this.refs["dismiss-container"];_this.inSwipe=true;dismissCard.style.display="none";dismissStateInfo.style.display="flex";dismissStateInfo.style.display="-webkit-flex";swipedElement.style.transform=Mscrm.isRTL?"translate3d("+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";swipedElement.style.webkitTransform=Mscrm.isRTL?"translate3d("+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";_this.timerId=setTimeout(function(){jQuery(swipedElement).fadeOut("slow",function(){self.handleDismiss(self.props.cardData,groupType);self.inSwipe=false})},2e3)}});this.commandManager=this.props.commandManager};GroupCardView.prototype.undoClick=function(event){this.inSwipe=false;clearTimeout(this.timerId);this.resetCard(event)};GroupCardView.prototype.resetCard=function(event){this.mouseDown=false;if(!this.inSwipe)if(this.refs["cardList"]){var swipedElement=this.refs["cardList"];swipedElement.style.transform="translate3d(0px,0px,0px)";swipedElement.style.webkitTransform="translate3d(0px,0px,0px)";var swipedCard=this.refs["swipe-content"];swipedCard.style.opacity="1";var snoozeStateInfo=this.refs["snooze-state"],snoozeCard=this.refs["snooze-container"],dismissStateInfo=this.refs["dismiss-state"],dismissCard=this.refs["dismiss-container"];swipedElement.style.display="";dismissCard.style.display="flex";dismissCard.style.display="-webkit-flex";dismissStateInfo.style.display="none";snoozeCard.style.display="flex";snoozeCard.style.display="-webkit-flex";snoozeStateInfo.style.display="none"}this.props.callbackContainer&&this.props.callbackContainer("SwipeCards",{currentElement:this.refs["cardList"],reset:true})};GroupCardView.prototype.swipeStartHandler=function(event){this.props.currentView.viewType!=="CardView"&&this.swipeStartObserver.onNext(event)};GroupCardView.prototype.swipeEndHandler=function(event){this.props.currentView.viewType!=="CardView"&&this.swipeEndObserver.onNext(event)};GroupCardView.prototype.elementMoveHandle=function(event){var reset=true;if(this.mouseDown){reset=false;this.props.currentView.viewType!=="CardView"&&this.elementMove.onNext(event)}this.props.callbackContainer&&this.props.callbackContainer("SwipeCards",{currentElement:this.refs["cardList"],reset:reset})};GroupCardView.prototype.renderCardFeeds=function(){var _this=this,cards=[],options={swipeId:this.props.swipeId?this.props.swipeId:"",showSnooze:this.props.showSnooze?this.props.showSnooze:"",showDismiss:this.props.showDismiss?this.props.showDismiss:"",callbackContainer:this.props.callbackContainer?this.props.callbackContainer:"",currentView:this.props.currentView,canShowDetailsView:this.props.canShowDetailsView,mode:this.props.mode,getReferenceTokenData:this.props.getReferenceTokenData?this.props.getReferenceTokenData:"",showIcon:this.props.showIcon,key:"",showDescription:false,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled},cardData=this.props.cardData?this.props.cardData:[];if(cardData.length>3)cardData=cardData.slice(0,3);else if(!cardData.length){var data=[];data.push(cardData);cardData=data}var cardItems=cardData.map(function(card,index){card.mode=_this.props.mode;options["cardActionData"]=_this.props.getActionData(card);options["key"]=card.cardName+index;if(_this.props.overlayCardId==card.cardId)options["showSuccessCardOverlay"]=true;else options["showSuccessCardOverlay"]=false;if(card.cardName==="NEARBY_CUSTOMERS"||card.cardName=="TOP_PEOPLE"||card.cardName=="TOP_RECORD"){options.canShowDetailsView=false;options.showMenu=false}if(card.cardName==="ATTENDEE"){options.showDismiss=false;options.showSnooze=false;options.showIcon=true;return _this.dataFactories["TOP_PEOPLE"].generateCardContainer(card,true,options)}else if(_this.dataFactories[card.cardName]){if(card.cardName==="NEARBY_CUSTOMERS"||card.cardName=="TOP_PEOPLE"||card.cardName=="TOP_RECORD"){options.showDismiss=false;options.showSnooze=false;options.showIcon=true;if(_this.props.currentView.viewType==="CardView")options.showIcon=true}return _this.dataFactories[card.cardName].generateCardContainer(card,true,options)}else{if(card.cardName==="REGARDING")options.showDescription=true;return _this.dataFactories["Generic"].generateCardContainer(card,true,options)}}),container=Mscrm.Controls.VDOM.ul(this.props.cardData,{key:this.props.groupType,className:"groupcard groupcard-box",ref:"cardslist"},cardItems);return container};GroupCardView.prototype.renderGroupCardHeader=function(item){var curItem,groupcardarrow,grpCardCount,headers=[],content=[],headerContent,grpTitleAlign,imgBlock,grpCardSummaryTitle,card,summaryDescription,cardName=this.props.groupType=="AGENDA"?"AGENDA:ACTIVITY_TASK":this.props.cardData[0].cardName;if(item.length>0)curItem=item[0];else curItem=item;if(Mscrm.ActionCardDefaultFocusId==curItem.cardId)this.groupCardTabIndex=Mscrm.actioncardTabIndex;else this.groupCardTabIndex=-1;var optionBtn;this.globalPanelCardIdSuffix=this.props.isGlobalPanelEnabled?" globalPanelId":"";if(this.props.showGroupCardHeader){if(this.props.currentView.viewType==="GroupView"||this.props.currentView.viewType==="Main"){this.headerText=this.props.groupTitle&&this.props.groupTitle!=""?this.props.groupTitle:curItem.softTitle;grpTitleAlign="";imgBlock=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"defaultCardIcon",className:CRMNow.CardUtils.defaultCardIcon(cardName)});summaryDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupSummaryDescription","aria-describedby":"ariaToolTipId",title:curItem.summaryText,className:"groupcard-summaryDescription"},[curItem.summaryText]);this.headerText=this.headerText.toUpperCase();if(this.props.currentView.viewType!="CardView")optionBtn=Mscrm.Controls.VDOM.button(this.props.cardData,{className:"CRMMDL2 icon-dotdotdot",ref:"optionBtn",tabIndex:this.groupCardTabIndex,key:"optionBtn",id:"optionBtn","aria-haspopup":true,"aria-expanded":"false",type:"button",title:CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.MenuButton_Label"),"aria-label":CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.MenuButton_Label"),onKeyDown:this.handleTabFocus.bind(null,this),onClick:this.handleMenuBottonClick.bind(null,this)})}else if(this.props.currentView.viewType==="CardView"){grpTitleAlign=" cardview";this.headerText=this.props.groupTitle&&this.props.groupTitle!=""?this.props.groupTitle:curItem.softTitle;if(curItem.summaryText&&curItem.summaryText!=null&&curItem.summaryText!="")if(curItem.cardName!="TOP_PEOPLE"&&curItem.cardName!="TOP_RECORD"){var grpCardSummaryTitle=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupSumTitle",className:"groupcard-summaryTitle"},curItem.summaryText);this.headerText=this.headerText}}var grpCardTitle=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupcardPrimaryTitle",ref:"groupcardPrimaryTitle","aria-describedby":"ariaToolTipId",title:this.headerText,className:"groupcard-primaryTitle",style:{color:CRMNow.CardUtils.defaultCardTitleColor(cardName)}},this.headerText);if(this.props.canNavigate){grpCardCount=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"count",className:"groupcard-count","aria-label":CRMNow.CardUtils.getResources("ActionCard.GroupCardView.Navigation_AccessibilityText"),role:"link"},3);groupcardarrow=Mscrm.Controls.VDOM.span(this.props.cardData,{key:"iconArrow",ref:"iconArrow",className:"CRMMDL2 icon-rightarrow"})}var headerDisplay=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"headerDisplay",className:"groupcard-title-Display"+grpTitleAlign},[grpCardTitle,grpCardCount,groupcardarrow]);grpCardSummaryTitle=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupSumTitle",className:this.props.currentView.viewType!="CardView"?"maingroupcard-summaryTitle":"groupcard-summaryTitle"},[headerDisplay,summaryDescription]);card=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupcardSummary",className:"groupcard-summary"+grpTitleAlign},[imgBlock,grpCardSummaryTitle]);headers.push(card);headerContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"headerContent",className:""},[headers]);var header=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"groupcardHeader",className:this.props.showGroupOnly?"groupcard-header":"groupcard-header groupcard-header-border",onMouseDown:this.swipeStartHandler,onMouseUp:this.swipeEndHandler,onMouseMove:this.elementMoveHandle,onTouchStart:this.swipeStartHandler,onTouchEnd:this.swipeEndHandler,onKeyPress:this.props.canNavigate?this.handleGroupActionKeyPress.bind(null,this,this.headerText):null,onClick:this.props.canNavigate?this.handleGroupActionClick.bind(null,this,this.headerText):null,onTouchMove:this.elementMoveHandle,onKeyDown:this.handleKeyDownPress.bind(null,this)},headerContent),menu=this.renderMenu();content.push(header);this.props.currentView.viewType!="CardView"&&content.push(optionBtn);content.push(menu)}var container=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"contentContainer"},[content]);return container};GroupCardView.prototype.handleGroupActionKeyPress=function(evt,cardName,keyEvent){keyEvent.charCode==13&&this.handleGroupActionClick.call(null,evt,cardName)};GroupCardView.prototype.handleKeyDownPress=function(event,keyEvent){var menuEle=jQuery(this.refs["menu"]),optionBtn=jQuery(this.refs["optionBtn"]);if(keyEvent.keyCode==38||keyEvent.keyCode==40){if(this.showMenu&&(optionBtn.is(keyEvent.target)||menuEle.has(keyEvent.target).length>0))return;var allCardElements=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix+"']"),backArrow=jQuery("div[class^=cardFeedContainer_]").find("div[class='CRMMDL2 icon-backarrow"+this.globalPanelCardIdSuffix+"']"),currentActiveCard=jQuery(this.refs["cardList"]);if(keyEvent.keyCode==40){var nextelement=currentActiveCard.next();if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextelement.get(0)))if(backArrow.length>0)nextelement=backArrow;else nextelement=jQuery(allCardElements[0]);var setFocus=this.handleTabindex(nextelement,currentActiveCard);if(nextelement[0].children.length==0)nextelement.focus();else if(!setFocus){jQuery(nextelement[0]).attr("tabindex",Mscrm.actioncardTabIndex);jQuery(nextelement[0]).focus()}}else if(keyEvent.keyCode==38){var previousElement=jQuery(currentActiveCard.prevAll()[0]);if(!previousElement.hasClass("carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix)||MscrmCommon.ControlUtils.Object.isNullOrUndefined(previousElement.get(0)))if(backArrow.length>0)previousElement=backArrow;else previousElement=jQuery(allCardElements[allCardElements.length-1]);var setFocus=this.handleTabindex(previousElement,currentActiveCard);if(previousElement[0].children.length==0)previousElement.focus();else if(!setFocus){jQuery(previousElement[0]).attr("tabindex",Mscrm.actioncardTabIndex);jQuery(previousElement[0]).focus()}}}if(keyEvent.keyCode==13)if(optionBtn.is(keyEvent.target))return;else if(menuEle.has(keyEvent.target).length>0){var index=jQuery(menuEle[0].children).find("span").index(keyEvent.target);this.handleMenuItemClick.call(null,index,event)}else this.props.canNavigate&&jQuery(this.refs["cardList"]).is(keyEvent.target)&&this.handleGroupActionClick.call(null,this,this.headerText)};GroupCardView.prototype.handleTabindex=function(nextCard,previousCard){var isCardFocused=false;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextCard)){var actionableItems=nextCard.find("[tabindex]");actionableItems.each(function(index,ele){if(!isCardFocused&&(index==0&&ele.tagName=="LI")){ele.focus();isCardFocused=true}if(ele.className=="generalCard-actions"&&MscrmCommon.ControlUtils.String.isNullOrEmpty(ele.textContent))ele.tabIndex=-1;else ele.tabIndex=Mscrm.actioncardTabIndex})}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(previousCard)){jQuery(previousCard[0]).attr("tabindex",-1);var previousActionableItems=previousCard.find("[tabindex]");previousActionableItems.each(function(index,ele){ele.tabIndex=-1})}return isCardFocused};GroupCardView.prototype.handleGroupActionClick=function(evt,cardName){var data=this.props.cardData;if(!this.mouseMoved&&data.length&&data.length>1){this.props.callbackContainer&&this.props.callbackContainer("GroupView",{selectedGroupCard:cardName,showMenu:false,data:this.props.cardData});jQuery(".landingPageActivities").scrollTop(0);jQuery(".pullToRefresher").scrollTop(0)}};GroupCardView.prototype.handleMenuBottonKeyPress=function(event,keyEvent){keyEvent.charCode==13&&this.handleMenuBottonClick.call(null,event)};GroupCardView.prototype.handleMenuBottonClick=function(event){if(this.showMenu){this.showMenu=false;if(this.refs["menu"]){var ele=jQuery(this.refs["menu"]);jQuery(ele).css({display:"none"})}}else{this.hideMenu(event);this.showMenu=true;if(this.refs["menu"]){var ele=jQuery(this.refs["menu"]);jQuery(ele).css({display:"block"})}}this.changeOptionBtnColor()};GroupCardView.prototype.changeOptionBtnColor=function(){if(this.refs["optionBtn"]){var btn=jQuery(this.refs["optionBtn"]),bColor=this.showMenu?"#BFDFFF":"transparent";jQuery(btn).css({"background-color":bColor})}};GroupCardView.prototype.handleMenuItemClick=function(selectedIndex,event){var groupType=this.props.cardData[0].cardName?this.props.cardData[0].cardName:"";switch(selectedIndex){case 0:this.handleSnooze(this.props.cardData,groupType);break;case 1:this.handleDismiss(this.props.cardData,groupType);break;case 2:this.handleGroupActionClick(groupType,event);break;case 3:break}};GroupCardView.prototype.renderMenu=function(){var _this=this,menuItems=this.menuItemsString.map(function(row,index){var icon=Mscrm.Controls.VDOM.img(_this.props.cardData,{key:"menuItemIcon"+index,className:"menuItemIcon",src:_this.props.cardData[0].cardOptionIcon?_this.props.cardData[0].cardOptionIcon:""}),content=Mscrm.Controls.VDOM.span(_this.props.cardData,{key:"menuContent"+index,className:"menuContent",tabIndex:_this.groupCardTabIndex,"aria-role":"menuItem",title:CRMNow.CardUtils.getResources(row),"aria-label":CRMNow.CardUtils.getResources(row)},CRMNow.CardUtils.getResources(row)),item=Mscrm.Controls.VDOM.div(_this.props.cardData,{key:"menuItem"+index,className:"menuItem",onClick:_this.handleMenuItemClick.bind(null,index)},[content]);if(index==2&&!_this.props.canNavigate)item="";return item}),menu=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"menu",className:"menu",ref:"menu","aria-role":"menu",onKeyDown:this.handleTabFocus.bind(null,this)},menuItems),that=this;jQuery(document).mouseup(function(e){if(that.refs["menu"]){var menuEle=jQuery(that.refs["menu"]),optionBtn=jQuery(that.refs["optionBtn"]);if(!menuEle.is(e.target)&&!optionBtn.is(e.target)&&menuEle.has(e.target).length===0){that.showMenu=false;that.hideMenu(e)}}});return menu};GroupCardView.prototype.hideMenu=function(event){this.changeOptionBtnColor();jQuery(".menu").css({display:"none"})};GroupCardView.prototype.handleTabFocus=function(event,keyEvent){var menuEle=jQuery(this.refs["menu"]),optionBtn=jQuery(this.refs["optionBtn"]);if(optionBtn.is(keyEvent.target)){if(keyEvent.keyCode==9){this.showMenu=false;this.hideMenu(event)}else if(keyEvent.keyCode==27){this.showMenu=false;this.hideMenu(event);optionBtn.focus()}if(this.showMenu&&keyEvent.keyCode==40){jQuery(menuEle[0].children[0].firstChild).focus();return false}else if(keyEvent.keyCode==38){this.showMenu=false;this.hideMenu(event);return false}}else if(menuEle.has(keyEvent.target).length>0){var menuIndex=jQuery(menuEle[0].children).find("span").index(keyEvent.target),childCount=menuEle[0].childElementCount;if(keyEvent.keyCode==9){this.showMenu=false;this.hideMenu(event);return false}else if(keyEvent.keyCode==40){if(menuIndex==childCount-1)menuIndex=-1;jQuery(menuEle[0].children[menuIndex+1].firstChild).focus()}else if(keyEvent.keyCode==38){if(menuIndex==0)menuIndex=childCount;jQuery(menuEle[0].children[menuIndex-1].firstChild).focus()}else if(keyEvent.keyCode==27){this.showMenu=false;this.hideMenu(event);optionBtn.focus()}}else{this.showMenu=false;this.hideMenu(event)}};GroupCardView.prototype.onRender=function(){var cards=[],cardsClass,data=this.props.cardData;for(var i in data)if(data[i].cardName=="ATTENDEE"||data[i].cardName=="REGARDING")cardsClass="groupcard-list-in-medium";else cardsClass="groupcard-list";var snoozeIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeIcon",className:"CRMMDL2 icon-snooze","aria-hidden":true}),snoozeStr=CRMNow.CardUtils.getSnoozeTimeStr(this.props.cardData[0]).split(/\s/),snoozeFirstWord=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeWord",className:"first-word","aria-hidden":true},snoozeStr[0]);snoozeStr.shift();var snoozeString=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeText ",className:"snooze-text","aria-hidden":true},[snoozeFirstWord,snoozeStr.join(" ")]),snooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snooze",className:"snooze"},[snoozeIcon,snoozeString]),defaultSnooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeContainer",ref:"snooze-container",className:"snooze-container"},[snooze]),swipeUndoLabel=Mscrm.Controls.VDOM.span(this.props.cardData,{onClick:this.undoClick.bind(null,this),key:"snoozeUndo",className:"swipe-undo-label"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Undo")),swipeUndoContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeUndoContainer",className:"swipe-undo"},swipeUndoLabel),snoozed=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeAction",className:"swipedaction"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Snoozing")),snoozedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeState",ref:"snooze-state",className:"snooze-state"},[snoozed,swipeUndoContainer]),snoozeDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeleft",className:"snooze-left","aria-hidden":true},[defaultSnooze,snoozedState]),dismissIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissIcon",className:"CRMMDL2 icon-dismark","aria-hidden":true}),dismissText=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissText",className:"dismiss-text","aria-hidden":true},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Dismiss")),dismiss=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismiss",className:"dismiss"},[dismissText,dismissIcon]),dismissContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissContainer",ref:"dismiss-container",className:"dismiss-container"},[dismiss]),dismissed=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissAction",className:"swipedaction"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Dismissing")),dismissedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissState",ref:"dismiss-state",className:"dismiss-state"},[dismissed,swipeUndoContainer]),dismissDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissRight",className:"dismiss-right","aria-hidden":true},[dismissContainer,dismissedState]),title=this.renderGroupCardHeader(this.props.cardData);cards.push(title);cards.push(this.renderCardFeeds());var cardGroup=Mscrm.Controls.VDOM.div(this.props.cardData,{ref:"swipe-content",key:"swipe",className:cardsClass},cards),container=Mscrm.Controls.VDOM.li(this.props.cardData,{onMouseLeave:this.resetCard,key:this.props.cardData[0]?this.props.cardData[0].cardName:"",className:"carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix,ref:"cardList","aria-label":!MscrmCommon.ControlUtils.String.isNullUndefinedOrWhitespace(this.headerText)?MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.Navigation_HelpText"),this.headerText):null,onKeyDown:this.handleKeyDownPress.bind(null,this),id:this.props.cardData[0]?this.props.cardData[0].cardName:""},[snoozeDiv,cardGroup,dismissDiv]);return container};return GroupCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.GroupCardView=GroupCardView;CRMNow.GroupCardControl=ReactUtils.createComponent(new GroupCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var MeetingCardView=function(_super){__extends(MeetingCardView,_super);function MeetingCardView(){_super.call(this);this.dataFactories={MEETING:new CRMNow.MeetingCardFactory};this.displayName="MeetingCard"}MeetingCardView.prototype.getInitialState=function(){return {attendeeDataFetchSuccess:false,attendeeData:{}}};MeetingCardView.prototype.componentDidMount=function(){var args={};args["detailsView"]=false;args["callbackContainer"]=this.updateAttendeeData;args["cardData"]=this.props.cardData;this.dataFactories["MEETING"]&&this.dataFactories["MEETING"].getAttendeesData&&this.dataFactories["MEETING"].getAttendeesData(this.props.cardData,args)};MeetingCardView.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:true,titleData:this.props.titleData,showPrimaryInfo:true,primaryTemplate:null,primaryTemplateData:this.props.primaryTemplateData,showContextInfo:true,contextTemplate:this.props.cardData.cardName=="UPCOMING_MEETING"?this.showContextTemplate:null,contextTemplateData:this.props.contextTemplateData,showRelatedInfo:this.props.cardData.cardName=="UPCOMING_MEETING"?true:false,relatedTemplate:this.props.cardData.cardName=="UPCOMING_MEETING"?this.showRelatedTemplate:null,relatedTemplateData:this.props.relatedTemplateData,showActionInfo:true,actionTemplate:null,actionData:this.props.actionData,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:false,titleData:this.props.titleData,showPrimaryInfo:true,primaryTemplate:null,primaryTemplateData:this.props.primaryTemplateData,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.contextTemplateData,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:this.props.relatedTemplateData,showActionInfo:false,actionTemplate:null,actionData:this.props.actionData,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,regardingObject:this.props.regardingObject,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};MeetingCardView.prototype.renderMapView=function(){return CRMNow.MapCardControl({cardData:this.props.cardData,callbackContainer:this.props.callbackContainer,commandManager:this.props.commandManager})};MeetingCardView.prototype.renderCardTitle=function(){var titleimg=[],titleImgDiv=[],titlediv=[];if(this.props.cardTypeIcon!=null&&this.props.cardTypeIcon!=undefined&&this.props.cardTypeIcon!=""){titleimg=Mscrm.Controls.VDOM.img(this.props.cardData,{key:"titleImg",className:this.props.cardTypeIcon?this.props.cardTypeIcon:""});titleImgDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleImgDiv"},titleimg)}var titleTextDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleTextDiv",className:"title-content"},this.props.cardData.cardName?this.props.cardData.cardName:""),titleTimeDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleTimeDiv",className:"title-content"},this.props.cardData.softTitle?this.props.cardData.softTitle:"");titlediv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleDiv",className:"title-div"},[titleImgDiv,titleTextDiv,titleTimeDiv]);return titlediv};MeetingCardView.prototype.showContextTemplate=function(){var _this=this,contextContent=[],hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"dashedline"},""),rows=[];if(this.props.cardData.data.cardContextDetails){for(var item=0;item<this.props.cardData.data.cardContextDetails.length;item++){var icon="",iconNA="",iconText,curContextItem=this.props.cardData.data.cardContextDetails[item];if(curContextItem.contextPrimaryInfo&&(curContextItem.contextPrimaryInfo.title!==""||curContextItem.contextPrimaryInfo.description!=="")){var contextObject=this.props.cardData.data.cardContextDetails[item].contextObject;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(contextObject.entityName)+" regarding "+contextObject.entityName});icon=Mscrm.Controls.VDOM.img(this.props.cardData,{key:"icon",className:"meeting-contexticon defaultEntityIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.contextTemplateRef&&jQuery(_this.contextTemplateRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}var column1Div=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"imgdiv",className:"imgdiv",onKeyPress:this.onRegardingCardKeyPress.bind(null,this)},[icon,defaultIcon]);if(this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo)var nameDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"nameDiv",className:"description-top-font",tabIndex:-1,title:this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title?this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title:"","aria-label":this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title?this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title:""},this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title?this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.title:""),descriptionDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"descriptionDiv",className:"description-font","aria-label":this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.description?this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.description:""},this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.description?this.props.cardData.data.cardContextDetails[item].contextPrimaryInfo.description:""),column2Div=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextText",className:"context-text"},[nameDiv,descriptionDiv]);var row=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contenxtTemplate",className:"context-template"},[column1Div,column2Div]),romain=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"meetingRowContext",className:"meeting-row-contextNA",onKeyPress:this.onRegardingCardKeyPress.bind(null,this),onClick:this.onRegardingCardClick.bind(null,this)},[row]);rows.push(romain);this.props.cardData.data.cardContextDetails.length>1&&rows.push(hr)}}contextContent.push(romain);contextContent=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextContent",ref:function(r){return _this.contextTemplateRef=r}},[contextContent])}return contextContent};MeetingCardView.prototype.onRegardingCardKeyPress=function(event,keyEvent){keyEvent.charCode==13&&this.onRegardingCardClick.call(null,event)};MeetingCardView.prototype.onRegardingCardClick=function(event){var data,action;if(this.props.cardData.data&&this.props.cardData.data!=null&&this.props.cardData.data.cardContextDetails&&this.props.cardData.data.cardContextDetails.length>0){var contextItem=this.props.cardData.data.cardContextDetails[0],contextObject=contextItem?contextItem.contextObject:"";if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){action="Navigation";data={entityName:contextObject.entityName,guid:contextObject.guid,cardData:this.props.cardData}}}this.props.callbackContainer&&this.props.callbackContainer(action,data)};MeetingCardView.prototype.showRelatedTemplate=function(){var _this=this,data1=[],relatedAttributes=[],mapViewContainer,imagTag="",imagText,attendees,args={};if(this.state.attendeeData&&this.state.attendeeData.cardData&&this.state.attendeeData.cardData.cardRelatedInfo&&this.state.attendeeData.cardData.cardRelatedInfo.attendees){attendees=this.state.attendeeData.cardData.cardRelatedInfo.attendees.length;if(this.state.attendeeData.cardData.cardRelatedInfo.attendees.length>0){for(var attendee=0;attendee<3&&this.state.attendeeData.cardData.cardRelatedInfo.attendees.length>attendee;attendee++){var contextObject=this.state.attendeeData.cardData.cardRelatedInfo.attendees[attendee].contextObject;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(this.state.attendeeData.cardData,{key:"defaultIcon"+attendee,className:"CRMMDL2 icon-attendee generalCard-leftblock"});imagTag=Mscrm.Controls.VDOM.img(this.state.attendeeData,{key:"imageTag"+attendee,className:"meeting-attendees-icons defaultEntityIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.relatedTemplateRef&&jQuery(_this.relatedTemplateRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}data1.push(imagTag);data1.push(defaultIcon)}var headerPipeicon=Mscrm.Controls.VDOM.div(this.getContext(),{key:"headerpipeicon",className:"CRMMDL2 icon-pipe"}),attendeediv=Mscrm.Controls.VDOM.div(this.state.attendeeData.cardData,{key:"attendeediv",className:"Meeting-Related imgdiv"},[data1,headerPipeicon]),data2=Mscrm.Controls.VDOM.div(this.state.attendeeData.cardData,{key:"relAttribute",className:"rel-attribute-data"},[(this.state.attendeeData.cardData.cardRelatedInfo.numberOfAttending?this.state.attendeeData.cardData.cardRelatedInfo.numberOfAttending:"")+"  "+CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingMeeting.AttendeesText")]),contextdiv=Mscrm.Controls.VDOM.div(this.state.attendeeData,{key:"contextdiv",className:"context-div"},[data2]),contextmain=Mscrm.Controls.VDOM.div(this.state.attendeeData,{key:"contextMain",className:"context-main",ref:function(r){return _this.relatedTemplateRef=r}},[attendeediv,contextdiv]);relatedAttributes.push(contextmain)}}if(this.props.showMap){var mapView=this.renderMapView();mapViewContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"mapContainer",className:"map-container"},mapView)}relatedAttributes.push(mapViewContainer);return relatedAttributes};MeetingCardView.prototype.updateAttendeeData=function(action,cardData){this.setState({attendeeData:cardData,attendeeDataFetchSuccess:true})};MeetingCardView.prototype.softTitleGenerator=function(softTitle,starttime){var formatedSoftTitle=softTitle?softTitle:"";if(starttime&&softTitle){var timeLeft="";if(this.props.cardData.cardName=="UPCOMING_MEETING"){var now=moment(new Date),start=moment(starttime),duration=moment.duration(start.diff(now));if(duration.hours()>0)timeLeft=duration.hours().toString()+" "+CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Hours");else if(duration.minutes()+1>0||duration.seconds()>0)timeLeft=(duration.minutes()+1).toString()+"  "+CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Minutes");else{formatedSoftTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.Common.MeetingExpired");timeLeft=CRMNow.CardUtils.getUserTime(starttime,"formatTime")}}else timeLeft=CRMNow.CardUtils.getUserTime(starttime,"formatTime");if(CRMNow.CardUtils.isCCFMode())formatedSoftTitle=MscrmCommon.ControlUtils.String.Format(formatedSoftTitle,timeLeft)}return formatedSoftTitle};return MeetingCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.MeetingCardView=MeetingCardView;CRMNow.MeetingCardControl=ReactUtils.createComponent(new MeetingCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TaskCardView=function(_super){__extends(TaskCardView,_super);function TaskCardView(){_super.call(this);this.displayName="TaskCard"}TaskCardView.prototype.getInitialState=function(){return null};TaskCardView.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:true,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,showRelatedInfo:false,relatedTemplate:null,showActionInfo:true,actionTemplate:null,actionData:this.props.actionData,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,showSuccessCardOverlay:this.props.showSuccessCardOverlay,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:false,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,showRelatedInfo:false,relatedTemplate:null,showActionInfo:false,actionTemplate:null,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};TaskCardView.prototype.softTitleGenerator=function(softTitle,starttime){var formatedSoftTitle=softTitle?softTitle:"";if(starttime&&softTitle){var formatedMeetingTime=CRMNow.CardUtils.getUserTime(starttime,"formatTime");if(CRMNow.CardUtils.isCCFMode())formatedSoftTitle=MscrmCommon.ControlUtils.String.Format(softTitle,formatedMeetingTime)}return formatedSoftTitle};return TaskCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.TaskCardView=TaskCardView;CRMNow.TaskCardControl=ReactUtils.createComponent(new TaskCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var PhoneCardView=function(_super){__extends(PhoneCardView,_super);function PhoneCardView(){_super.call(this);this.displayName="PhoneCard"}PhoneCardView.prototype.getInitialState=function(){return null};PhoneCardView.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:true,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,showRelatedInfo:false,relatedTemplate:null,showActionInfo:true,actionTemplate:null,actionData:this.props.actionData,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,showSuccessCardOverlay:this.props.showSuccessCardOverlay,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showTitleInfo:false,isGroup:this.props.isGroup,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,showRelatedInfo:false,relatedTemplate:null,showActionInfo:false,actionTemplate:null,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,softTitleGenerator:this.softTitleGenerator,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};PhoneCardView.prototype.softTitleGenerator=function(softTitle,starttime){var formatedSoftTitle=softTitle?softTitle:"";if(starttime&&softTitle){var formatedMeetingTime=CRMNow.CardUtils.getUserTime(starttime,"formatTime");if(CRMNow.CardUtils.isCCFMode())formatedSoftTitle=MscrmCommon.ControlUtils.String.Format(softTitle,formatedMeetingTime)}return formatedSoftTitle};return PhoneCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.PhoneCardView=PhoneCardView;CRMNow.PhoneCardControl=ReactUtils.createComponent(new PhoneCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var EmailCardView=function(_super){__extends(EmailCardView,_super);function EmailCardView(){_super.call(this)}EmailCardView.prototype.getInitialState=function(){return null};EmailCardView.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:true,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:this.props.contextTemplateData,showRelatedInfo:false,relatedTemplate:null,showActionInfo:true,actionTemplate:null,actionData:this.props.actionData,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,isGroup:this.props.isGroup,showTitleInfo:false,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:true,contextTemplate:null,contextTemplateData:this.props.contextTemplateData,showRelatedInfo:false,relatedTemplate:null,showActionInfo:false,actionTemplate:null,callbackContainer:this.props.callbackContainer,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};EmailCardView.prototype.showPrimaryTemplate=function(){};EmailCardView.prototype.showActionTemplate=function(){};return EmailCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.EmailCardView=EmailCardView;CRMNow.EmailCardControl=ReactUtils.createComponent(new EmailCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var NewsCardView=function(_super){__extends(NewsCardView,_super);function NewsCardView(){_super.call(this);this.displayName="NewsCard"}NewsCardView.prototype.getInitialState=function(){return null};NewsCardView.prototype.onRender=function(){return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:false,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplateSmall,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionData:this.props.cardData.actions,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,regardingObject:this.props.regardingObject,commandManager:this.props.commandManager})};NewsCardView.prototype.showPrimaryTemplateSmall=function(){var title=[],primaryContent=[],secContent=[],smallCard=[],newsIcon,newsUrlImage,defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)});if(this.props.cardData.data.cardRelatedInfo.newsImage!=""||this.props.cardData.data.cardRelatedInfo.newsImage!=undefined){newsUrlImage=this.props.cardData.data.cardRelatedInfo.newsImage;newsUrlImage=newsUrlImage.replace("http://","https://")}else newsUrlImage="";if(this.props.cardData.data&&this.props.cardData.data.cardRelatedInfo&&this.props.cardData.data.cardRelatedInfo.newsImage)newsIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{key:"newsIcon",className:newsUrlImage==""?"icon-relevant-news":"news-icon",src:newsUrlImage});var newsIconContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"newsIconContainer",className:"imgdiv"},[newsIcon,defaultIcon]),cardNewsTitle=Mscrm.Controls.VDOM.anchor(this.props.cardData,{key:"cardNewsTitle",className:"news-primary-content",tabIndex:-1,href:"#","aria-label":this.props.cardData.title?this.props.cardData.title:"","aria-describedby":"ariaToolTipId",title:this.props.cardData.title?this.props.cardData.title:""},this.props.cardData.title?this.props.cardData.title:"");primaryContent.push(cardNewsTitle);var primdivcontainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"childContainer",className:"maxwidth displayInline"},[newsIconContainer,primaryContent]),container=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"parentContainer",className:"cardViewSmall"},[primdivcontainer]);return container};return NewsCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.NewsCardView=NewsCardView;CRMNow.NewsCardControl=ReactUtils.createComponent(new NewsCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var NearbyCustomer=function(_super){__extends(NearbyCustomer,_super);function NearbyCustomer(){_super.call(this);this.displayName="NearbyCustomerCard"}NearbyCustomer.prototype.getInitialState=function(){return null};NearbyCustomer.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:true,showPrimaryInfo:true,primaryTemplate:null,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:true,relatedTemplate:null,showActionInfo:false,actionData:this.props.cardData.actions,callbackContainer:this.props.callbackContainer,cardTypeIcon:"CRMMDL2 icon-nearby",snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:true,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplate,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:true,relatedTemplate:null,showActionInfo:false,actionData:this.props.cardData.actions,callbackContainer:this.props.callbackContainer,cardTypeIcon:"CRMMDL2 icon-nearby",snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};NearbyCustomer.prototype.showPrimaryTemplate=function(){var contextInfo=[],hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"dashedline"},""),contextimg=Mscrm.Controls.VDOM.img(this.props.cardData.data,{key:"imgContext",className:"Context-testIcon",src:this.props.cardData.data.cardRelatedInfo.cardTypeIcon}),contextImgdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextImgdiv"},contextimg),contexttextdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contexttextdiv",className:"Context-textTitle"},this.props.cardData.title),contexttext=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contexttext",className:"Context-description"},this.props.cardData.description),contextdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextdiv",className:"NearbyCostom-contextdesc"},[contexttextdiv,contexttext]),contextmaindiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextmaindiv",className:"generalCard-leftblock-small NearbyCostom-ContextInfo"},[contextImgdiv,contextdiv]);contextInfo.push(contextmaindiv);this.props.cardData.data.cardContextDetails.length>1&&contextInfo.push(hr);return contextInfo};return NearbyCustomer}(Mscrm.Controls.VirtualComponentBase);CRMNow.NearbyCustomer=NearbyCustomer;CRMNow.NearbyCustomerControl=ReactUtils.createComponent(new NearbyCustomer)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TopPeopleOfTheDay=function(_super){__extends(TopPeopleOfTheDay,_super);function TopPeopleOfTheDay(){_super.call(this);this.displayName="TopPeopleOfTheDay"}TopPeopleOfTheDay.prototype.getInitialState=function(){return null};TopPeopleOfTheDay.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:false,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplate,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionTemplate:null,actionData:this.props.cardData.actions,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showIcon:true,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:true,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplate,showContextInfo:true,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionTemplate:null,actionData:this.props.cardData.actions,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showIcon:this.props.showIcon,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};TopPeopleOfTheDay.prototype.showPrimaryTemplate=function(self){var _this=this,contextInfo=[],hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"dashedline"},""),contextObject=this.props.cardData.data.cardContextDetails==undefined?this.props.cardData.data.contextObject:this.props.cardData.data.cardContextDetails[0].contextObject;this.props.cardData.description=this.props.cardData.description==null?"":CRMNow.CardUtils.getResources(this.props.cardData.description);if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)}),contextimg=Mscrm.Controls.VDOM.img(this.props.cardData.data,{key:"contextimg",className:"Context-testIcon defaultTopPeopleIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.topPplRef&&jQuery(_this.topPplRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}var contextImgdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{className:"imgdiv",key:"imgdiv",ref:function(r){return _this.topPplRef=r}},[contextimg,defaultIcon]),contexttextdiv=Mscrm.Controls.VDOM.anchor(this.props.cardData.data,{key:"contexttextdiv",tabIndex:-1,href:"#","aria-label":this.props.cardData.title,"aria-describedby":"ariaToolTipId",title:this.props.cardData.title,className:"Context-textTitle"},this.props.cardData.title),employeesText=this.props.cardData.cardName=="NEARBY_CUSTOMERS"?CRMNow.CardUtils.getResources("ActionCard.CFC.NearbyCustomers.Employees.Text"):"",contexttext=Mscrm.Controls.VDOM.div(this.props.cardData.data,{"aria-describedby":"ariaToolTipId",title:this.props.cardData.description,className:"Context-description"},this.props.cardData.description==null?"":this.props.cardData.description+" "+employeesText),contextdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextdiv",className:this.props.showIcon==true?"TopPeopleOfTheDay-contextdesc":"groupcard-toppeople"},[contexttextdiv,contexttext]),contextmaindiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextmaindiv",className:"generalCard-leftblock-small TopPeopleOfTheDay-ContextInfo"},this.props.showIcon==true?[contextImgdiv,contextdiv]:[contextdiv]);contextInfo.push(contextmaindiv);contextObject&&contextObject.length>1&&contextInfo.push(hr);return contextInfo};return TopPeopleOfTheDay}(Mscrm.Controls.VirtualComponentBase);CRMNow.TopPeopleOfTheDay=TopPeopleOfTheDay;CRMNow.TopPeopleOfTheDayControl=ReactUtils.createComponent(new TopPeopleOfTheDay)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var TopRecordsOfTheDay=function(_super){__extends(TopRecordsOfTheDay,_super);function TopRecordsOfTheDay(){_super.call(this);this.displayName="TopRecordsOfTheDay"}TopRecordsOfTheDay.prototype.getInitialState=function(){return null};TopRecordsOfTheDay.prototype.onRender=function(){if(this.props.mode=="medium")return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:false,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplate,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionTemplate:null,actionData:this.props.cardData.actions,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showIcon:this.props.showIcon,commandManager:this.props.commandManager});else return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:true,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplate,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:true,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionTemplate:null,actionData:this.props.cardData.actions,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,regardingObject:this.props.regardingObject,showIcon:this.props.showIcon,commandManager:this.props.commandManager})};TopRecordsOfTheDay.prototype.showPrimaryTemplate=function(self){var _this=this,contextInfo=[],hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"dashedline"},"");this.props.cardData.description=this.props.cardData.description==null?"":CRMNow.CardUtils.getResources(this.props.cardData.description);var contextObject=this.props.cardData.data.cardContextDetails[0].contextObject;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)}),contextimg=Mscrm.Controls.VDOM.img(this.props.cardData.data,{key:"contextimg",className:"Context-testIcon defaultTopRecordIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.topRecRef&&$(_this.topRecRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){})}}var contextImgdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{className:"imgdiv",key:"imgDiv",ref:function(r){return _this.topRecRef=r}},[contextimg,defaultIcon]),contexttextdiv=Mscrm.Controls.VDOM.anchor(this.props.cardData.data,{key:"contexttextdiv",tabIndex:-1,href:"#","aria-label":this.props.cardData.title,"aria-describedby":"ariaToolTipId",title:this.props.cardData.title,className:"Context-textTitle"},this.props.cardData.title),contexttext=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextText","aria-describedby":"ariaToolTipId",title:this.props.cardData.description,className:"Context-description"},this.props.cardData.description),contextdiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextdiv",className:this.props.showIcon==true?"TopPeopleOfTheDay-contextdesc":"groupcard-toppeople"},[contexttextdiv,contexttext]),contextmaindiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextmaindiv",className:"generalCard-leftblock-small TopPeopleOfTheDay-ContextInfo"},this.props.showIcon==true?[contextdiv]:[contextdiv]);contextInfo.push(contextmaindiv);this.props.cardData.data.cardContextDetails.length>1&&contextInfo.push(hr);return contextInfo};return TopRecordsOfTheDay}(Mscrm.Controls.VirtualComponentBase);CRMNow.TopRecordsOfTheDay=TopRecordsOfTheDay;CRMNow.TopRecordsOfTheDayControl=ReactUtils.createComponent(new TopRecordsOfTheDay)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var StockActivityCardView=function(_super){__extends(StockActivityCardView,_super);function StockActivityCardView(){_super.call(this);this.displayName="StockCard"}StockActivityCardView.prototype.getInitialState=function(){return null};StockActivityCardView.prototype.onRender=function(){return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showTitleInfo:false,showPrimaryInfo:true,primaryTemplate:this.showPrimaryTemplateSmall,primaryTemplateData:this.props.cardData.data.cardPrimaryInfo,showContextInfo:false,contextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,callbackContainer:this.props.callbackContainer,showRelatedInfo:false,relatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,showActionInfo:true,actionData:this.props.cardData.actions,regardingObject:this.props.regardingObject,commandManager:this.props.commandManager})};StockActivityCardView.prototype.showPrimaryTemplateSmall=function(){var contextContent=[],hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"dashedline"},""),rows=[],stockIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stockIcon",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)}),column1Div=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stockLeft",className:"stock-left"},stockIcon),titleInfo=this.props.cardData.data.cardRelatedInfo.Ticker?this.props.cardData.data.cardRelatedInfo.LoczExName+": "+this.props.cardData.data.cardRelatedInfo.Ticker:"",descriptionInfo=this.props.cardData.data.cardRelatedInfo.ShtName?this.props.cardData.data.cardRelatedInfo.ShtName:"",nameDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stockCompanyCode",className:"stock-body-companyCode",tabIndex:-1,title:titleInfo,"aria-label":titleInfo},this.props.cardData.data.cardRelatedInfo.Ticker?this.props.cardData.data.cardRelatedInfo.LoczExName+": "+this.props.cardData.data.cardRelatedInfo.Ticker:""),descriptionDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stockCompany",className:"stock-body-company",tabIndex:-1,title:descriptionInfo,"aria-label":descriptionInfo},this.props.cardData.data.cardRelatedInfo.ShtName?this.props.cardData.data.cardRelatedInfo.ShtName:""),column2Div=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stockCompanyDetails",className:"stock-body-companyDetails"},[nameDiv,descriptionDiv]),stockCurrencyBold=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stockCurrencyBold",className:"stock-currency-bold"},Math.round(this.props.cardData.data.cardRelatedInfo.Lp*100)/100),stockCurrencyNormal=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stockCurrencyNormal",className:"stock-currency-normal"},this.props.cardData.data.cardRelatedInfo.Cur),stockCurrencyDiv=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stockCurrencyDiv",className:"stock-currency",tabIndex:-1,title:Math.round(this.props.cardData.data.cardRelatedInfo.Lp*100)/100+" "+this.props.cardData.data.cardRelatedInfo.Cur,"aria-label":Math.round(this.props.cardData.data.cardRelatedInfo.Lp*100)/100+" "+this.props.cardData.data.cardRelatedInfo.Cur},[stockCurrencyBold,stockCurrencyNormal]),stockValue=this.props.cardData.data.cardRelatedInfo.Ch?this.props.cardData.data.cardRelatedInfo.Ch:"",stockPercentage=this.props.cardData.data.cardRelatedInfo.Chp?Math.round(this.props.cardData.data.cardRelatedInfo.Chp*100)/100+"%":"";if(stockValue&&stockValue>0){var titles=[];titles[0]=CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.StockCard_Increased_Text");titles[1]=stockValue+"("+stockPercentage+")";var stockLabel=MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.StockCard_Label"),titles),stockDiv=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stockDiv",className:"CRMMDL2 icon-stock-up"}),stocksInfo=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stocksInfo",className:"stock-info-green",tabIndex:-1,title:stockLabel,"aria-label":stockLabel},[stockDiv,[stockValue+"("+stockPercentage+")"]])}else if(stockValue&&stockValue<0){var titles=[];titles[0]=CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.StockCard_Decreased_Text");titles[1]=stockValue+"("+stockPercentage+")";var stockLabel=MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.StockCard_Label"),titles),stockDiv=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stockDiv",className:" CRMMDL2 icon-stock-down"}),stocksInfo=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stocksInfo",className:"stock-info-red",tabIndex:-1,title:stockLabel,"aria-label":stockLabel},[stockDiv,[stockValue+"("+stockPercentage+")"]])}else var stocksInfo=Mscrm.Controls.VDOM.div(this.getContext(),{key:"stocksInfo",className:"",tabIndex:-1,title:stockValue+"("+stockPercentage+")","aria-label":stockValue+"("+stockPercentage+")"},[[stockValue+"("+stockPercentage+")"]]);var rightContainer=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"rightContainer",className:"stock-right-container"},[stockCurrencyDiv,stocksInfo]),leftContainer=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"leftContainer",className:"stock-left-container"},[column2Div,rightContainer]),row=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stocksRow",className:"stock-data"},[column1Div,leftContainer]);rows.push(row);this.props.cardData.data.cardContextDetails&&this.props.cardData.data.cardContextDetails.length>1&&rows.push(hr);contextContent.push(rows);return Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"stocks",className:"stocks maxwidth"},[contextContent])};return StockActivityCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.StockActivityCardView=StockActivityCardView;CRMNow.StockActivityCardControl=ReactUtils.createComponent(new StockActivityCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var FlightCardView=function(_super){__extends(FlightCardView,_super);function FlightCardView(){_super.call(this);this.dataFactories={UPCOMING_FLIGHT:new CRMNow.FlightCardFactory};this.meetingCards=[];this.nearBycards=[];this.meetingResponseSuccess=false;this.nearByResponseSuccess=false;this.displayName="FlightCard"}FlightCardView.prototype.getInitialState=function(){return null};FlightCardView.prototype.onRender=function(){return CRMNow.GenericCardControl({mode:this.props.mode,cardData:this.props.cardData,isGroup:this.props.isGroup,showSnooze:this.props.showSnooze,showDismiss:this.props.showDismiss,showTitleInfo:false,showPrimaryInfo:true,primaryTemplate:this.props.mode=="medium"?this.showPrimaryTemplate:null,showContextInfo:true,contextTemplate:this.props.mode=="medium"?this.showContextTemplate:null,contextTemplateData:this.props.cardData.data.cardContextDetails,showRelatedInfo:true,relatedTemplate:this.props.mode=="medium"?this.showRelatedTemplate:null,relatedTemplateData:this.props.cardData.data.cardRelatedInfo,callbackContainer:this.props.callbackContainer,showActionInfo:false,actionData:this.props.cardData.actions,cardTypeIcon:this.props.cardTypeIcon,snoozetime:this.props.snoozetime,dismiss:this.props.dismiss,canShowDetailsView:this.props.canShowDetailsView,showMenu:this.props.showMenu,commandManager:this.props.commandManager,isGlobalPanelEnabled:this.props.isGlobalPanelEnabled})};FlightCardView.prototype.componentDidMount=function(){if(this.props.cardData.data.cardContextDetails.length==1){if(this.meetingCards.length==0){var margs={callbackContainer:this.fetchMeetingData,fetch:"FetchMeeting"};this.dataFactories[this.props.cardData.cardName].generateAdditionalData&&this.dataFactories[this.props.cardData.cardName].generateAdditionalData(this.props.cardData,margs)}if(this.nearBycards.length==0){var nargs={callbackContainer:this.fetchNearByData,fetch:"FetchNearBy"};this.dataFactories[this.props.cardData.cardName].generateAdditionalData&&this.dataFactories[this.props.cardData.cardName].generateAdditionalData(this.props.cardData,nargs)}}};FlightCardView.prototype.fetchMeetingData=function(action,data){var cardData=data.cardData;if(cardData){this.meetingCards=cardData;this.meetingResponseSuccess=true}this.meetingResponseSuccess&&this.props.callbackContainer("FetchFlightCards",{meetingData:this.meetingCards,cardId:this.props.cardData.cardId})};FlightCardView.prototype.fetchNearByData=function(action,data){var cardData=data.cardData;if(cardData){this.nearBycards=cardData;this.nearByResponseSuccess=true}this.nearByResponseSuccess&&this.props.callbackContainer("FetchFlightCards",{nearByData:this.nearBycards,cardId:this.props.cardData.cardId})};FlightCardView.prototype.showPrimaryTemplate=function(self){var imgBlock=[],titleContainer;if(this.props.cardTypeIcon!="")imgBlock=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"imgBlock",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)});var title=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardSoftTitle",className:"generalCard-softTitle",title:this.props.cardData.softTitle?MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartInfo"),moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("MMM dd"),moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("t")):""},this.props.cardData.softTitle?MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartInfo"),moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("MMM dd"),moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("t")):""),title_description=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardPrimTitle",className:"generic-PrimTitle",title:this.props.cardData.data.cardRelatedInfo.provider.name+" . "+this.props.cardData.data.cardRelatedInfo.provider.iataCode+" "+this.props.cardData.data.cardRelatedInfo.flightNumber},this.props.cardData.data.cardRelatedInfo.provider.name+" . "+this.props.cardData.data.cardRelatedInfo.provider.iataCode+" "+this.props.cardData.data.cardRelatedInfo.flightNumber),diffInMinutes=moment((new Date(this.props.cardData.data.cardRelatedInfo.departureTime)).toUTCString()).diff(moment(),"minutes"),hours=0,description,descrpText;hours=diffInMinutes/60;hours=hours|0;var minutes=diffInMinutes-hours*60;if(diffInMinutes<0){diffInMinutes=diffInMinutes*-1;hours=hours*-1;minutes=minutes*-1;descrpText=hours>0?CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartedHMText"):CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartedText");descrpText=hours>0?MscrmCommon.ControlUtils.String.Format(descrpText,hours,minutes):MscrmCommon.ControlUtils.String.Format(descrpText,diffInMinutes)}else if(hours>0){descrpText=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartHMText");descrpText=MscrmCommon.ControlUtils.String.Format(descrpText,hours,minutes)}else{descrpText=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.DepartMText");descrpText=MscrmCommon.ControlUtils.String.Format(descrpText,minutes)}description=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardDescription",className:"generalCard-description",title:descrpText},descrpText);var titleContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleContainer",className:"generalCard-maincontent generalCard-maincontent-medium"},[title,title_description]),titleContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"diplay",className:"Display-Title",onClick:self.onCardClick.bind(null,this)},[imgBlock,titleContent,description]),mainContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"mainContent",className:"generalCard-contentcontainer"},[titleContainer]);return mainContent};FlightCardView.prototype.showContextTemplate=function(){var _this=this,contextContent=[],contextContentTop=[],contextContentBottom=[],flightStartLocationDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"flightLoc",className:"flight-loc"},this.props.cardData.data.cardRelatedInfo.departureAirport.iataCode?this.props.cardData.data.cardRelatedInfo.departureAirport.iataCode:""),departureTime=moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("t"),flightStartTimeDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"iconFlight",className:"flight-font"},departureTime.replace(/\s/g,"")),startLocTime=this.props.cardData.data.cardRelatedInfo.departureAirport.iataCode?this.props.cardData.data.cardRelatedInfo.departureAirport.iataCode:" "+departureTime.replace(/\s/g,""),contextPrevLeftContent=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"flighLocDiv",className:"flight-related-start-div",title:startLocTime},[flightStartLocationDiv,flightStartTimeDiv]),flightImg=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"iconFlight!",className:"CRMMDL2 icon-temp-flight "}),distance=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"line",className:"flight-line"}),flightImgDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"route",className:"flight-related-route-div"},[flightImg,distance]),flightDestinationLocationDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"flightarrival",className:"flight-loc"},this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode?this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode:""),arrivalTime=moment(this.props.cardData.data.cardRelatedInfo.arrivalTime).toDate().localeFormat("t"),flightEndTimeDiv=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"flightFont",className:"flight-font"},arrivalTime.replace(/\s/g,"")),endLocTime=this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode?this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode:" "+arrivalTime.replace(/\s/g,""),contextPrevRightContent=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"routeEnd",className:"flight-related-end-div",title:endLocTime},[flightDestinationLocationDiv,flightEndTimeDiv]),hr=Mscrm.Controls.VDOM.hr(this.props.cardData.data,{key:"dashedline",className:"maxwidth dashedline"}),flightInfo=CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.FlightCard_Label");flightInfo=MscrmCommon.ControlUtils.String.Format(flightInfo,startLocTime,departureTime.replace(/\s/g,""),endLocTime,arrivalTime.replace(/\s/g,""));contextContentTop=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"flightContent",className:"flight-related-content",tabIndex:-1,"aria-label":flightInfo},[contextPrevLeftContent,flightImgDiv,contextPrevRightContent]);for(var rows=[],rowsContact=[],cards=[],item=0;item<this.props.cardData.data.cardContextDetails.length;item++)for(var groupedData=this.props.cardData.data.cardContextDetails[item],groupKeys=Object.keys(groupedData),index=0;index<groupKeys.length;index++){var groupData=groupedData[groupKeys[index]];if(groupKeys[index]=="REGARDING"){groupData.map(function(card,index){if(index<3){var icon="",iconNA="",iconText,curContextItem=card.data.cardContextDetails[0];if(curContextItem.contextPrimaryInfo&&(curContextItem.contextPrimaryInfo.title!==""||curContextItem.contextPrimaryInfo.description!=="")){var contextObject=card.data.cardContextDetails[0].contextObject;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(contextObject.entityName)+" regarding "+contextObject.entityName});icon=Mscrm.Controls.VDOM.img(_this.props.cardData,{key:"icon",className:"meeting-contexticon defaultEntityIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.contextTemplateRef&&jQuery(_this.contextTemplateRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}var column1Div=Mscrm.Controls.VDOM.div(_this.props.cardData,{key:"imgdiv",className:"imgdiv"},[icon,defaultIcon]),formatedTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.Meeting.SoftTitle");if(formatedTitle.indexOf(":")!=-1){var titleArray=formatedTitle.split(":");if(titleArray[1]!=undefined&&titleArray[1]!=""&&titleArray[1].length>0)formatedTitle=titleArray[1]}if(card.data&&card.data.cardRelatedInfo&&card.data.cardRelatedInfo.starttime)formatedTitle=_this.softTitleGenerator(formatedTitle,card.data.cardRelatedInfo.starttime);else formatedTitle=_this.softTitleGenerator(formatedTitle,card.startDate);if(card.data.cardContextDetails[0].contextPrimaryInfo)var nameDiv=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"nameDiv",className:"description-top-font"},formatedTitle),descriptionDiv=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"descriptionDiv",className:"description-font"},card.data.cardContextDetails[0].contextPrimaryInfo.title?card.data.cardContextDetails[0].contextPrimaryInfo.title:""),column2Div=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"contextText",className:"context-text"},[nameDiv,descriptionDiv]);var meetingTitle=formatedTitle+" "+(card.data.cardContextDetails[0].contextPrimaryInfo.title?card.data.cardContextDetails[0].contextPrimaryInfo.title:""),row=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"contenxtTemplate",className:"context-template"},[column1Div,column2Div]),romain=Mscrm.Controls.VDOM.div(_this.props.cardData.data,{key:"meetingRowContext"+card.cardId,className:"meeting-row-contextNA",tabIndex:Mscrm.actioncardTabIndex,title:meetingTitle,"aria-label":meetingTitle,onClick:_this.onMeetingClick.bind(_this,card),onKeyPress:_this.onMeetingKeyPress.bind(_this,card)},[row]);rows.push(romain);card.data.cardContextDetails[0].length>1&&rows.push(hr)}}});contextContent.push(rows)}else if(groupKeys[index]=="NEARBY_CUSTOMERS"){var data1=[],icon="",defaultIcon="",column1Div;groupData.map(function(card,index){if(index<3){var iconText,curContextItem=card.data.cardContextDetails[0];if(curContextItem.contextPrimaryInfo&&(curContextItem.contextPrimaryInfo.title!==""||curContextItem.contextPrimaryInfo.description!=="")){var contextObject=card.data.cardContextDetails[0].contextObject;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");var defaultIcon=Mscrm.Controls.VDOM.div(curContextItem,{key:"defaultIcon"+index,className:"CRMMDL2 icon-nearby Context-testIcon"});icon=Mscrm.Controls.VDOM.img(_this.props.cardData,{key:"icon",className:"meeting-contexticon defaultEntityIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.contextTemplateRef&&jQuery(_this.relatedTemplateRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}}column1Div=Mscrm.Controls.VDOM.div(_this.props.cardData,{key:"imgdiv"+index,className:"imgdiv"},[icon,defaultIcon]);data1.push(column1Div)}});var dotSpan,spanCount;if(groupData.length>3){spanCount=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"spanCount",className:"attendees-count"},groupData.length-3);dotSpan=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dotIcon",className:"meeting-attendees-icons"},spanCount)}var attendeediv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"attendeediv",className:"Meeting-Related"},[data1,dotSpan]),destination=CRMNow.CardUtils.getResources("ActionCard.CFC.FlightCard.NearbyCustomers.Text");destination=MscrmCommon.ControlUtils.String.Format(destination,groupData.length?groupData.length:"",this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode?this.props.cardData.data.cardRelatedInfo.arrivalAirport.iataCode:"");var data2=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"relAttribute",className:"rel-attribute-data"},[destination]),contextdiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"contextdiv",className:"context-div"},[data2]),contextmain=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"contextMain",className:"context-main",tabIndex:-1,title:destination,"aria-label":destination,onKeyPress:this.onNearByCustomerActionKeyPress.bind(null,this,"NEARBY_CUSTOMERS"),onClick:this.onNearByCustomerActionClick.bind(null,this,"NEARBY_CUSTOMERS"),ref:function(r){return _this.relatedTemplateRef=r}},[attendeediv,contextdiv]);rowsContact.push(contextmain);contextContent.push(rowsContact)}}return Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"contextContent",ref:function(r){return _this.contextTemplateRef=r}},[contextContentTop,contextContent])};FlightCardView.prototype.softTitleGenerator=function(softTitle,starttime){var formatedSoftTitle=softTitle?softTitle:"";if(starttime&&softTitle){var timeLeft="";timeLeft=CRMNow.CardUtils.getUserTime(starttime,"formatTime");if(CRMNow.CardUtils.isCCFMode())formatedSoftTitle=MscrmCommon.ControlUtils.String.Format(formatedSoftTitle,timeLeft)}return formatedSoftTitle};FlightCardView.prototype.onNearByCustomerActionKeyPress=function(evt,cardName,keyEvent){keyEvent.charCode==13&&this.onNearByCustomerActionClick.call(null,evt,cardName)};FlightCardView.prototype.onNearByCustomerActionClick=function(evt,cardName){for(var data=[],cardData=this.props.cardData,item=0;item<cardData.data.cardContextDetails.length;item++){var contextData=cardData.data.cardContextDetails[item];if(contextData["NEARBY_CUSTOMERS"]!=null)for(var groupKeys=Object.keys(contextData),index=0;index<groupKeys.length;index++){var groupData=contextData[groupKeys[index]];groupData!=""&&groupData!=undefined&&groupData.map!=undefined&&groupData.map(function(card){data.push(card)})}}if(data.length&&data.length>0)this.props.callbackContainer&&this.props.callbackContainer("GroupView",{selectedGroupCard:cardName,showMenu:false,data:data})};FlightCardView.prototype.onMeetingKeyPress=function(meetingItem,e){e.charCode==13&&this.onMeetingClick.call(null,meetingItem,e)};FlightCardView.prototype.onMeetingClick=function(meetingItem,e){e.stopPropagation();var contextObject=meetingItem.data.cardContextDetails[0].contextObject,data={entityName:contextObject.entityName,guid:contextObject.guid,cardData:this.props.cardData};this.props.callbackContainer&&this.props.callbackContainer("Navigation",data)};FlightCardView.prototype.showRelatedTemplate=function(){var data1=[],relatedAttributes=[];if(this.props.cardData.data.cardRelatedInfo.company!=undefined){if(this.props.cardData.data.cardRelatedInfo.company.length>0){for(var comp=0;comp<3;comp++){var imagTag=Mscrm.Controls.VDOM.img(this.props.cardData.data,{key:"imgTag",className:"img-align ",src:this.props.cardData.data.cardRelatedInfo.company[comp].contextIcon?this.props.cardData.data.cardRelatedInfo.company[comp].contextIcon:""});data1.push(imagTag)}var customerNearBy=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.CustomerNearMsg");customerNearBy=MscrmCommon.ControlUtils.String.Format(customerNearBy,[this.props.cardData.data.cardRelatedInfo.numberOfCustomers?this.props.cardData.data.cardRelatedInfo.numberOfCustomers:"",this.props.cardData.data.cardRelatedInfo.customerLocationName?this.props.cardData.data.cardRelatedInfo.customerLocationName:""]);var data2=Mscrm.Controls.VDOM.span(this.props.cardData.data,{key:"relData",className:"rel-attribute-data"},[customerNearBy]),dotSpan=[];if(this.props.cardData.data.cardRelatedInfo.company.length>3)dotSpan=Mscrm.Controls.VDOM.span(this.props.cardData.data,{key:"dots",className:"primaryContent-text"},"...");relatedAttributes=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"relatedAttributes",className:"flight-related-template-content"},[data1,dotSpan,data2])}return relatedAttributes}};return FlightCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.FlightCardView=FlightCardView;CRMNow.FlightCardControl=ReactUtils.createComponent(new FlightCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var MapCardView=function(_super){__extends(MapCardView,_super);function MapCardView(){_super.call(this);this.displayName="MapCard"}MapCardView.prototype.getInitialState=function(){return null};MapCardView.prototype.getDefaultProps=function(){return {zoomLevel:15}};MapCardView.prototype.callLocationService=function(request,callback){jQuery.ajax({url:request,dataType:"jsonp",jsonp:"jsonp",success:function(r){callback(r)},error:function(e){}})};MapCardView.prototype.refreshFrame=function(data){var el=this.refs["MapView"];if(data!=undefined&&data!=null&&data.resourceSets.length>0&&data.resourceSets[0].resources){var resources=data.resourceSets[0].resources;if(resources.length>0){var location=resources[0].point.coordinates;if(el&&location){var mapOptions={credentials:this.props.cardData.data.cardRelatedInfo.bingApiKey?this.props.cardData.data.cardRelatedInfo.bingApiKey:"",center:new Microsoft.Maps.Location(location[0],location[1]),zoom:this.props.zoomLevel?this.props.zoomLevel:11,showScalebar:false,enableSearchLogo:false,disableKeyboardInput:true,showDashboard:false},map=new Microsoft.Maps.Map(el,mapOptions);Microsoft.Maps.Events.addHandler(map,"click",this.handleMapclick);Microsoft.Maps.Events.addHandler(map,"keypress",this.handleMapEnterKey);var pushpin=new Microsoft.Maps.Pushpin(map.getCenter(),null);map.entities.push(pushpin)}}else jQuery(el).hide()}else jQuery(el).hide()};MapCardView.prototype.handleMapclick=function(event){var data,action;if(this.props.cardData.data.cardRelatedInfo.address){action="GetDirections";data={address:this.props.cardData.data.cardRelatedInfo.address}}this.props.callbackContainer&&this.props.callbackContainer(action,data)};MapCardView.prototype.handleMapEnterKey=function(event){event.keyCode==13&&this.handleMapclick.call(null,event)};MapCardView.prototype.onRender=function(){var children=[],mapLocation=this.props.cardData.data.cardRelatedInfo.address?this.props.cardData.data.cardRelatedInfo.address:"",isMapViewEnabled=Xrm.Internal.isFeatureEnabled("MapControlEnabled");if(isMapViewEnabled)if(this.props.cardData&&this.props.cardData.data&&!this.props.cardData.data.cardRelatedInfo.bingApiKey)children.push(React.DOM.div({className:"generalCard-description",tabIndex:-1},mapLocation));else{var url=window.location.href.toLocaleLowerCase().indexOf("https://")!=-1?"https://dev.virtualearth.net/REST/v1/Locations?query=":"http://dev.virtualearth.net/REST/v1/Locations?query=",geocodeRequest=url+encodeURIComponent(this.props.cardData.data.cardRelatedInfo.address)+"&key="+(this.props.cardData.data.cardRelatedInfo.bingApiKey?this.props.cardData.data.cardRelatedInfo.bingApiKey:"");this.callLocationService(geocodeRequest,this.refreshFrame);var info=React.DOM.div({className:"cardView-innerframe",ref:"MapView",tabIndex:-1});children.push(info)}var container=React.DOM.div({className:"cardView-frameContainer cardContianer-spacing"},[children]);return container};return MapCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.MapCardView=MapCardView;CRMNow.MapCardControl=ReactUtils.createComponent(new MapCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var GenericCardView=function(_super){__extends(GenericCardView,_super);function GenericCardView(){_super.call(this);this.mouseMoved=false;this.timerId=0;this.inSwipe=false;this.menuItemsString=["ActionCard.CFC.Common.Snooze","ActionCard.CFC.Common.Dismiss"];this.showMenu=false;this.cardTabIndex=-1;this.displayName="GenericCard"}GenericCardView.prototype.getInitialState=function(){return {}};GenericCardView.prototype.handleMenuBottonClick=function(event){if(this.showMenu){this.showMenu=false;if(this.refs["menu"]){var ele=jQuery(this.refs["menu"]);jQuery(ele).css({display:"none"})}}else{this.hideMenu(event);this.showMenu=true;if(this.refs["menu"]){var ele=jQuery(this.refs["menu"]);jQuery(ele).css({display:"block"})}}this.changeOptionBtnColor()};GenericCardView.prototype.handleMenuBottonKeyPress=function(event,keyEvent){keyEvent.charCode==13&&this.handleMenuBottonClick.call(null,event)};GenericCardView.prototype.changeOptionBtnColor=function(){if(this.refs["optionBtn"]){var btn=jQuery(this.refs["optionBtn"]),bColor=this.showMenu?"#BFDFFF":"transparent";jQuery(btn).css({"background-color":bColor})}};GenericCardView.prototype.handleDismissInMenuItem=function(){var dismissStateInfo=this.refs["dismiss-state"],dismissCard=this.refs["dismiss-container"],undoButton=jQuery(this.refs["dismiss-state"]).find("button[class='swipe-undo-label']");dismissCard.style.display="none";dismissStateInfo.style.display="flex";dismissStateInfo.style.display="-webkit-flex";this.inSwipe=true;this.showMenu=false;this.hideMenu(null);var genericCard=this.refs["genericCard"],card=this,cardBoundary=genericCard.getBoundingClientRect();genericCard.style.transform=Mscrm.isRTL?"translate3d("+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";genericCard.style.webkitTransform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";if(undoButton.length>0){var dismissCardItems=jQuery(dismissStateInfo).find("[tabindex]"),feedbackItems=jQuery(this.refs["negativeFeedbackRef"]).find("[tabindex]"),previousActionableItems=jQuery(genericCard).find("[tabindex]");jQuery(genericCard)[0].tabIndex=-1;previousActionableItems.not(dismissCardItems).not(feedbackItems).each(function(index,ele){ele.tabIndex=-1});setTimeout(function(){undoButton.focus()},100)}this.timerId=setTimeout(function(){jQuery(genericCard).fadeOut("slow",function(){card.addTelemetryForCardDismiss("",false);card.inSwipe=false;card.handleDismiss(card)})},4e3)};GenericCardView.prototype.handleMenuItemClick=function(selectedIndex,event){switch(selectedIndex){case 0:this.handleSnooze(this);break;case 1:this.handleDismissInMenuItem();break;case 2:break}};GenericCardView.prototype.renderMenu=function(){var _this=this,menuItems=this.menuItemsString.map(function(row,index){var content=Mscrm.Controls.VDOM.span(_this.props.cardData,{key:"menuContent"+index,className:"menuContent",tabIndex:_this.cardTabIndex,title:CRMNow.CardUtils.getResources(row),"aria-role":"menuItem","aria-label":CRMNow.CardUtils.getResources(row)},CRMNow.CardUtils.getResources(row)),item=Mscrm.Controls.VDOM.div(_this.props.cardData,{key:"menuItem"+index,className:"menuItem",onClick:_this.handleMenuItemClick.bind(null,index)},[content]);return item}),menu=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"menu",className:"menu",ref:"menu","aria-role":"menu",onKeyDown:this.handleTabFocus.bind(null,this)},menuItems),that=this;jQuery(document).mouseup(function(e){if(that.refs["menu"]){var menuEle=jQuery(that.refs["menu"]),optionBtn=jQuery(that.refs["optionBtn"]);if(!menuEle.is(e.target)&&!optionBtn.is(e.target)&&menuEle.has(e.target).length===0){that.showMenu=false;that.hideMenu(e)}}});return menu};GenericCardView.prototype.hideMenu=function(event){this.changeOptionBtnColor();jQuery(".menu").css({display:"none"})};GenericCardView.prototype.handleKeyDownPress=function(event,keyEvent){var menuEle=jQuery(this.refs["menu"]),optionBtn=jQuery(this.refs["optionBtn"]);if(keyEvent.keyCode==38||keyEvent.keyCode==40){if(this.showMenu&&(optionBtn.is(keyEvent.target)||menuEle.has(keyEvent.target).length>0))return;var allCardElements=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix+"']"),backArrow=jQuery("div[class^=cardFeedContainer_]").find("div[class='CRMMDL2 icon-backarrow"+this.globalPanelCardIdSuffix+"']"),currentActiveCard=jQuery(this.refs["genericCard"]);if(this.props.isGroup)currentActiveCard=jQuery(currentActiveCard.parents().get(2));if(keyEvent.keyCode==40){var nextelement=currentActiveCard.next();if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextelement.get(0)))if(backArrow.length>0)nextelement=backArrow;else nextelement=jQuery(allCardElements[0]);var setFocus=this.handleTabindex(nextelement,currentActiveCard);if(nextelement[0].children.length==0)nextelement.focus();else if(!setFocus){jQuery(nextelement[0]).attr("tabindex",Mscrm.actioncardTabIndex);jQuery(nextelement[0]).focus()}}else if(keyEvent.keyCode==38){var previousElement=jQuery(currentActiveCard.prevAll()[0]);if(!previousElement.hasClass("carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix)||MscrmCommon.ControlUtils.Object.isNullOrUndefined(previousElement.get(0)))if(backArrow.length>0)previousElement=backArrow;else previousElement=jQuery(allCardElements[allCardElements.length-1]);var setFocus=this.handleTabindex(previousElement,currentActiveCard);if(previousElement[0].children.length==0)previousElement.focus();else if(!setFocus){jQuery(previousElement[0]).attr("tabindex",Mscrm.actioncardTabIndex);jQuery(previousElement[0]).focus()}}}else if(keyEvent.keyCode==13)if(jQuery(this.refs["optionBtn"]).is(keyEvent.target))return false;else if(jQuery(this.refs["dismiss-state"]).find("button[class='swipe-undo-label']").is(keyEvent.target))return false;else if(jQuery(this.refs["dismiss-state"]).find("button[class='feedbackResponseNo']").is(keyEvent.target))return false;else if(jQuery(this.refs["negativeFeedbackRef"]).find("button[class='closeFeedbackDiv']").is(keyEvent.target))return false;else if(jQuery(this.refs["negativeFeedbackRef"]).find("button[class='feedbackOptionString']").is(keyEvent.target))return false;else if(menuEle.has(keyEvent.target).length>0){var index=jQuery(menuEle[0].children).find("span").index(keyEvent.target);this.handleMenuItemClick.call(null,index,event)}else if(jQuery(this.refs["actionContainer1"]).is(keyEvent.target)){var data=[];if(this.props.actionTemplate==undefined&&this.props.actionTemplate==null){var cmdManager=this.commandManager;if(cmdManager.commandFetchCompleted)data=this.getActionData(this.props.cardData);else data=[];var cmd=data&&data.length>0?data[0]:"";this.handleActionClick.call(null,event,"actionContainer1",cmd)}}else if(jQuery(this.refs["actionContainer2"]).is(keyEvent.target)){var data=[];if(this.props.actionTemplate==undefined&&this.props.actionTemplate==null){var cmdManager=this.commandManager;if(cmdManager.commandFetchCompleted)data=this.getActionData(this.props.cardData);else data=[];var cmd=data&&data.length>1?data[1]:"";this.handleActionClick.call(null,event,"actionContainer2",data)}}else this.onCardClick.call(null,event)};GenericCardView.prototype.handleTabindex=function(nextCard,previousCard){var isCardFocused=false;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextCard)){var actionableItems=nextCard.find("[tabindex]");actionableItems.each(function(index,ele){if(!isCardFocused&&ele.tabIndex==Mscrm.actioncardTabIndex){ele.focus();isCardFocused=true}if(ele.className=="generalCard-actions"&&MscrmCommon.ControlUtils.String.isNullOrEmpty(ele.textContent))ele.tabIndex=-1;else ele.tabIndex=Mscrm.actioncardTabIndex})}if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(previousCard)){jQuery(previousCard[0]).attr("tabindex",-1);var previousActionableItems=previousCard.find("[tabindex]");previousActionableItems.each(function(index,ele){ele.tabIndex=-1})}return isCardFocused};GenericCardView.prototype.handleTabFocus=function(event,keyEvent){var menuEle=jQuery(this.refs["menu"]),optionBtn=jQuery(this.refs["optionBtn"]);if(optionBtn.is(keyEvent.target)){if(keyEvent.keyCode==9){this.showMenu=false;this.hideMenu(event)}else if(keyEvent.keyCode==27){this.showMenu=false;this.hideMenu(event);optionBtn.focus()}if(this.showMenu&&keyEvent.keyCode==40){jQuery(menuEle[0].children[0].firstChild).focus();return false}else if(keyEvent.keyCode==38){this.showMenu=false;this.hideMenu(event);return false}}else if(menuEle.has(keyEvent.target).length>0){var menuIndex=jQuery(menuEle[0].children).find("span").index(keyEvent.target),childCount=menuEle[0].childElementCount;if(keyEvent.keyCode==9){this.showMenu=false;this.hideMenu(event);return false}else if(keyEvent.keyCode==40){if(menuIndex==childCount-1)menuIndex=-1;jQuery(menuEle[0].children[menuIndex+1].firstChild).focus()}else if(keyEvent.keyCode==38){if(menuIndex==0)menuIndex=childCount;jQuery(menuEle[0].children[menuIndex-1].firstChild).focus()}else if(keyEvent.keyCode==27){this.showMenu=false;this.hideMenu(event);optionBtn.focus()}}else{this.showMenu=false;this.hideMenu(event)}};GenericCardView.prototype.handleDismiss=function(self){if(!CRMNow.CardUtils.isMOCAOffline())this.props.callbackContainer&&this.props.callbackContainer("dismiss",{cardId:self.props.cardData.cardId,isGroupSwipe:false});else{this.resetCard();var offlineText=CRMNow.CardUtils.getResources("Error_Message_Generic_Mobile_Client_Offline");Xrm.Utility.alertDialog(offlineText,null)}};GenericCardView.prototype.handleSnooze=function(self){if(!CRMNow.CardUtils.isMOCAOffline())this.props.callbackContainer&&this.props.callbackContainer("snooze",{cardId:self.props.cardData.cardId,isGroupSwipe:false});else{this.resetCard();var offlineText=CRMNow.CardUtils.getResources("Error_Message_Generic_Mobile_Client_Offline");Xrm.Utility.alertDialog(offlineText,null)}};GenericCardView.prototype.onCardKeyPress=function(event){event.charCode==13&&this.onCardClick.call(null,event)};GenericCardView.prototype.onMediumCardKeyPress=function(event,keyEvent){keyEvent.charCode==13&&this.onCardClick.call(null,event)};GenericCardView.prototype.onCardClick=function(event){var data,action;if(!this.mouseMoved){if(this.props.canShowDetailsView){action="CardView";data={cardId:this.props.cardData.cardId?this.props.cardData.cardId:"",data:this.props.cardData}}else if(!this.props.canShowDetailsView)if(this.props.cardData.data&&this.props.cardData.data.mailweblink){action="Navigation";data={mailweblink:this.props.cardData.data.mailweblink,cardData:this.props.cardData}}else if(this.props.regardingObject){if(this.props.regardingObject.LogicalName&&this.props.regardingObject.Id){action="Navigation";data={entityName:this.props.regardingObject.LogicalName,guid:this.props.regardingObject.Id.toString(),cardData:this.props.cardData}}}else if(this.props.cardData.data&&this.props.cardData.data!=null&&this.props.cardData.data.cardContextDetails&&this.props.cardData.data.cardContextDetails.length>0){var contextItem=this.props.cardData.data.cardContextDetails[0],contextObject=contextItem?contextItem.contextObject:"";if(contextObject&&contextObject.guid&&contextObject.guid!=null&&contextObject.entityName&&contextObject.entityName!=null){action="Navigation";data={entityName:contextObject.entityName,guid:contextObject.guid,cardData:this.props.cardData}}}this.props.callbackContainer&&action!=undefined&&action!=null&&data&&data!=null&&this.props.callbackContainer(action,data)}};GenericCardView.prototype.handleOnCardTitleKeyPress=function(event,keyEvent){keyEvent.charCode==13&&this.onCardClick.call(null,this)};GenericCardView.prototype.handleActionClick=function(event,srcElememt,data){if(this.props.callbackContainer){var actionData=jQuery(this.refs[srcElememt]).attr("content");this.props.callbackContainer("ActionClick",{actionData:actionData,cardId:this.props.cardData.cardId})}};GenericCardView.prototype.componentDidMount=function(){this.showActionCommands()};GenericCardView.prototype.componentDidUpdate=function(){this.showActionCommands()};GenericCardView.prototype.showActionCommands=function(){jQuery(this.refs["actionContainer1"]).attr("content","");jQuery(this.refs["actionContainer2"]).attr("content","");this.fetchActionCommands();this.props.callerApp!="WebClient"&&this.setLearningPathIDs()};GenericCardView.prototype.setLearningPathIDs=function(){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(CRMNow.CardUtils.ccfContext.learningPath))return;var cardId=this.props.cardData.cardId,controlPrefix=CRMNow.CardUtils.ccfContext.learningPath.baseControlId+"|card|"+cardId,cardContainer=this.refs["genericCard"];$(cardContainer).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix);var cardTitle=this.refs["cardSoftTitle"];$(cardTitle).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|SoftTitle");var primTitle=this.refs["cardPrimTitle"];$(primTitle).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|SoftTitle");var actionContainer1=this.refs["actionContainer1"];$(actionContainer1).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|Action1");var actionContainer2=this.refs["actionContainer2"];$(actionContainer2).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|Action2");var moreOptionsContainer=this.refs["optionBtn"];$(moreOptionsContainer).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,controlPrefix+"|optionBtn")};GenericCardView.prototype.fetchActionCommands=function(){var _this=this;if(this.commandManager)if(this.commandManager.commandFetchCompleted){var commands=this.getActionCommands(this.props.cardData);commands&&commands.length>0&&this.updateCardActions(commands,this.props.cardData)}else window.setTimeout(function(){_this.fetchActionCommands()},600)};GenericCardView.prototype.getActionCommands=function(cardData){var commands=this.commandManager.getCommandByCardId(cardData.cardId);if(commands&&commands.length>0)return commands};GenericCardView.prototype.updateCardActions=function(commands,cardData){var container=this.refs["genericCard"],actionData=[],actions=jQuery(container).find("[data-action-cardId="+cardData.cardId+"]");actionData=this.getActionData(cardData);var count=[0,1];if(actionData&&actionData.length>0)for(var i in count)if(actionData[count[i]]&&actions[count[i]]){jQuery(actions[count[i]]).text(actionData[count[i]].label);jQuery(actions[count[i]]).data("command",actionData[count[i]].label);jQuery(actions[count[i]]).attr("content",actionData[count[i]].command);jQuery(actions[count[i]]).attr("title",actionData[count[i]].label);jQuery(actions[count[i]]).attr("aria-label",actionData[count[i]].label);jQuery(actions[count[i]]).attr("tabIndex",this.cardTabIndex)}};GenericCardView.prototype.getActionData=function(card){var cardActions,actionData=[],container=this.refs["genericCard"],actions=jQuery(container).find("[data-action-cardId="+card.cardId+"]"),commands=this.commandManager.getCommandByCardId(card.cardId),canShowEmail=true,userAgent=CRMNow.CardUtils.ccfContext.client.userAgent;if(card.actions&&commands&&commands.length>0){var filteredCommands=_.filter(commands,function(cmd){return cmd.command!="Mscrm.HomepageGrid.actioncard.DismissCommand"&&cmd.command!="Mscrm.HomepageGrid.actioncard.SnoozeCommand"&&(cmd.command=="Mscrm.Modern.EmailAttendeesCommand"||cmd.command=="Mscrm.Modern.SendEmailCommand"?canShowEmail:true)});if(card.actions.Mobile)cardActions=card.actions.Mobile.Actions;else if(card.actions.WebClient)cardActions=card.actions.WebClient.Actions;if(cardActions){var actionCount=0;jQuery.each(cardActions,function(label,command){if(actionCount<2){var curcommand=_.find(filteredCommands,function(cmd){return cmd.command==command||cmd.command==command+"Solution"});if(curcommand){actionData.push(curcommand);actionCount++}}});return actionData}}return actionData};GenericCardView.prototype.componentWillMount=function(){var _this=this;this.swipeStartObserver=new Rx.Subject;this.swipeEndObserver=new Rx.Subject;this.elementMove=new Rx.Subject;var startX,startY,cardBoundary;this.swipeStartObserver.subscribe(function(mdEvent){var swipeEvent=mdEvent;_this.mouseDown=true;_this.mouseMoved=false;cardBoundary=swipeEvent.currentTarget.getBoundingClientRect();if(swipeEvent.type=="mousedown"){startX=swipeEvent.clientX;startY=swipeEvent.clientY}else if(swipeEvent.type=="touchstart"){startX=swipeEvent.changedTouches[0].clientX;startY=swipeEvent.changedTouches[0].clientY}});this.elementMove.subscribe(function(mmEvent){var currentPosY,currentPosX,swipeEvent=mmEvent,card=_this,canPerformOp=true;if(_this.mouseDown&&cardBoundary&&cardBoundary.width)if(_this.refs["genericCard"]){var swipedElement=_this.refs["genericCard"],swipedCard=_this.refs["swipe-content"];if(swipeEvent.type=="mousemove"){currentPosX=swipeEvent.clientX;currentPosY=swipeEvent.clientY}else if(swipeEvent.type=="touchmove"){currentPosX=swipeEvent.changedTouches[0].clientX;currentPosY=swipeEvent.changedTouches[0].clientY}var rtlScreenPos=Mscrm.isRTL?-1:1,swipediffY=currentPosY-startY,swipediffX=currentPosX-startX;Math.abs(swipediffX)>10&&mmEvent.preventDefault();if(rtlScreenPos*(startX-currentPosX)<=0){if(!Boolean(_this.props.cardData.hasSnoozeDismiss))canPerformOp=false}else canPerformOp=true;if(!_this.inSwipe&&canPerformOp){if(Math.abs(swipediffX)>cardBoundary.width/2)swipedCard.style.opacity="0.5";else swipedCard.style.opacity="1";if(swipediffX!=0)_this.mouseMoved=true;swipedElement.style.transform="translate3d("+swipediffX+"px,0,0)";swipedElement.style.webkitTransform="translate3d("+swipediffX+"px,0,0)";(!(currentPosX>cardBoundary.left&&currentPosX<cardBoundary.right)||!(currentPosY>cardBoundary.top&&currentPosY<cardBoundary.bottom))&&_this.resetCard()}}});this.swipeEndObserver.subscribe(function(muEvent){var endPosX,endPosY,swipeEvent=muEvent,card=_this,swipedElement=swipeEvent.currentTarget;if(swipeEvent.type=="mouseup"){endPosX=swipeEvent.clientX;endPosY=swipeEvent.clientY}else if(swipeEvent.type=="touchend"){endPosX=swipeEvent.changedTouches[0].clientX;endPosY=swipeEvent.changedTouches[0].clientY}var rtlScreenPos=Mscrm.isRTL?-1:1;_this.mouseDown=false;if(cardBoundary&&cardBoundary.width)if(Math.abs(startX-endPosX)/cardBoundary.width*100<30&&Math.abs(startX-endPosX)!=0||!(endPosY>cardBoundary.top&&endPosY<cardBoundary.bottom))_this.resetCard();else if(rtlScreenPos*(endPosX-startX)/cardBoundary.width*100>30){if(cardBoundary.right>=endPosX&&Boolean(_this.props.cardData.hasSnoozeDismiss)){var snoozeStateInfo=_this.refs["snooze-state"],snoozeCard=_this.refs["snooze-container"];swipedElement.style.transform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d("+cardBoundary.width+"px,0,0)";swipedElement.style.webkitTransform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d("+cardBoundary.width+"px,0,0)";snoozeCard.style.display="none";snoozeStateInfo.style.display="flex";snoozeStateInfo.style.display="-webkit-flex";_this.inSwipe=true;_this.timerId=setTimeout(function(){jQuery(swipedElement).fadeOut("slow",function(){card.handleSnooze(card);card.inSwipe=false})},2e3)}}else if(rtlScreenPos*(startX-endPosX)/cardBoundary.width*100>30)if(cardBoundary.left<=endPosX){var dismissStateInfo=_this.refs["dismiss-state"],dismissCard=_this.refs["dismiss-container"];dismissCard.style.display="none";dismissStateInfo.style.display="flex";dismissStateInfo.style.display="-webkit-flex";_this.inSwipe=true;swipedElement.style.transform=Mscrm.isRTL?"translate3d("+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";swipedElement.style.webkitTransform=Mscrm.isRTL?"translate3d(-"+cardBoundary.width+"px,0,0)":"translate3d(-"+cardBoundary.width+"px,0,0)";_this.timerId=setTimeout(function(){jQuery(swipedElement).fadeOut("slow",function(){card.addTelemetryForCardDismiss("",false);card.inSwipe=false;card.handleDismiss(card)})},4e3)}});this.commandManager=this.props.commandManager};GenericCardView.prototype.setCardLevelTabIndex=function(nextCard,prevCard){var allCardElements=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix+"']");if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextCard.get(0)))nextCard=jQuery(allCardElements[0]);this.handleTabindex(jQuery(nextCard),jQuery(prevCard));nextCard[0].tabIndex=Mscrm.actioncardTabIndex;nextCard[0].focus()};GenericCardView.prototype.undoClick=function(event){this.inSwipe=false;clearTimeout(this.timerId);this.resetCard();var currentActiveCard=jQuery(this.refs["genericCard"]);this.setCardLevelTabIndex(currentActiveCard,currentActiveCard.prevAll()[0])};GenericCardView.prototype.resetCard=function(){this.mouseDown=false;if(!this.inSwipe)if(this.refs["genericCard"]){var swipedElement=this.refs["genericCard"],snoozeStateInfo=this.refs["snooze-state"],snoozeCard=this.refs["snooze-container"],dismissStateInfo=this.refs["dismiss-state"],dismissCard=this.refs["dismiss-container"];swipedElement.style.transform="translate3d(0px,0px,0px)";swipedElement.style.webkitTransform="translate3d(0px,0px,0px)";var swipedCard=this.refs["swipe-content"];swipedCard.style.opacity="1";swipedElement.style.display="";dismissCard.style.display="flex";dismissCard.style.display="-webkit-flex";dismissStateInfo.style.display="none";snoozeCard.style.display="flex";snoozeCard.style.display="-webkit-flex";snoozeStateInfo.style.display="none"}this.props.callbackContainer&&this.props.callbackContainer("SwipeCards",{currentElement:this.refs["genericCard"],reset:true})};GenericCardView.prototype.swipeStartHandler=function(event){this.props.showSnooze&&this.props.showDismiss&&this.swipeStartObserver.onNext(event)};GenericCardView.prototype.swipeEndHandler=function(event){this.props.showSnooze&&this.props.showDismiss&&this.swipeEndObserver.onNext(event)};GenericCardView.prototype.elementMoveHandle=function(event){var reset=true;if(this.mouseDown){reset=false;this.props.showSnooze&&this.props.showDismiss&&this.elementMove.onNext(event)}this.props.callbackContainer&&this.props.callbackContainer("SwipeCards",{currentElement:this.refs["genericCard"],reset:reset})};GenericCardView.prototype.IsKTGExchangeCard=function(cardType){switch(cardType){case 1:case 2:case 3:case 22:case 23:case 35:return true;default:return false}};GenericCardView.prototype.addTelemetryForCardDismiss=function(reason,response){var card=this,cardDismissEvent=new ActionCardFeedback(card.props.cardData.cardtype,response,reason);MscrmControls.CRMNow.CardUtils.ccfContext.reporting.reportEvent(cardDismissEvent)};GenericCardView.prototype.handleCardDismissReason=function(reason,response){clearTimeout(this.timerId);var card=this,genericCard=card.refs["genericCard"];this.timerId=setTimeout(function(){jQuery(genericCard).fadeOut("slow",function(){var currentActiveCard=jQuery(genericCard);card.addTelemetryForCardDismiss(reason,response);card.inSwipe=false;card.setCardLevelTabIndex(currentActiveCard.next(),genericCard);card.handleDismiss(card)})},2e3)};GenericCardView.prototype.handleNegativeFeedback=function(event){clearTimeout(this.timerId);var genericCard=this.refs["genericCard"],card=this;if(this.IsKTGExchangeCard(card.props.cardData.cardtype)){var feedbackdiv=this.refs["negativeFeedbackRef"],dismissStateInfo=this.refs["dismiss-state"];dismissStateInfo.style.display="none";feedbackdiv.style.display="flex";feedbackdiv.style.display="-webkit-flex";genericCard.style.height=feedbackdiv.clientHeight+2*16+"px";dismissStateInfo.parentElement.style.height="auto";var feedbackItems=jQuery(this.refs["negativeFeedbackRef"]).find("[tabindex]");setTimeout(function(){feedbackItems[0].focus()},100)}else this.timerId=setTimeout(function(){jQuery(genericCard).fadeOut("slow",function(){var currentActiveCard=jQuery(genericCard);card.addTelemetryForCardDismiss("",false);card.inSwipe=false;card.setCardLevelTabIndex(currentActiveCard.next(),genericCard);card.handleDismiss(card)})},2e3)};GenericCardView.prototype.handlePositiveFeedback=function(event){clearTimeout(this.timerId);var card=this,genericCard=this.refs["genericCard"];this.timerId=setTimeout(function(){jQuery(genericCard).fadeOut("slow",function(){var currentActiveCard=jQuery(genericCard);card.addTelemetryForCardDismiss("",true);card.inSwipe=false;card.setCardLevelTabIndex(currentActiveCard.next(),genericCard);card.handleDismiss(card)})},2e3)};GenericCardView.prototype.handleCloseFeedbackDiv=function(event){var genericCard=this.refs["genericCard"],card=this;this.timerId=setTimeout(function(){jQuery(genericCard).fadeOut("slow",function(){var currentActiveCard=jQuery(genericCard);card.addTelemetryForCardDismiss("",false);card.inSwipe=false;card.setCardLevelTabIndex(currentActiveCard.next(),genericCard);card.handleDismiss(card)})},2e3)};GenericCardView.prototype.renderGenericSmallCard=function(){var _this=this,content,imgText,description,imgBlock=[],container,defaultIcon;if(this.props.showPrimaryInfo){if(this.props.primaryTemplate==null){var contextObject=this.props.cardData.data&&this.props.cardData.data!=null?this.props.cardData.data.cardContextDetails!=null?this.props.cardData.data.cardContextDetails[0].contextObject:undefined:undefined;if(contextObject&&contextObject.guid!=null&&contextObject.guid!=undefined&&contextObject.entityName!=null&&contextObject.entityName!=undefined){var id=contextObject.guid;id=id.replace(/-/g,"");defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(contextObject.entityName)+" regarding "+contextObject.entityName});imgBlock=Mscrm.Controls.VDOM.img(this.props.cardData,{key:"imgBlock",className:"Meeting-AttendeeIcon defaultEntityIcon crmSymbolFont","data-entityimgid":"img_"+id,src:""});if(CRMNow.CardUtils.isCCFMode())if(contextObject.entityName!=""&&contextObject.guid!="00000000-0000-0000-0000-000000000000"){var getEntityImg=CRMNow.CardUtils.getEntityImage(contextObject.entityName,contextObject.guid);getEntityImg.then(function(data){if(data&&data.entityCollection&&data.entityCollection.get_entities().length>0){var fields=data.entityCollection.get_entities()[0].fields,img=fields?fields.entityimage_url:"",id=data.entityCollection.get_entities()[0].getObjectData().identifier.id.rawguid;img&&id&&_this.imgBlockRef&&jQuery(_this.imgBlockRef).find('*[data-entityimgid="img_'+id+'"]').attr("src",img)}},function(failure){console.log("Error:"+failure)})}}else{defaultIcon=Mscrm.Controls.VDOM.div(this.props.cardData.data,{key:"defaultIcon",className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)});imgBlock=Mscrm.Controls.VDOM.img(this.props.cardData,{key:"iconCard",src:""})}var imgBlockDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"imgBlockDiv",className:"imgdiv",ref:function(r){return _this.imgBlockRef=r}},[imgBlock,defaultIcon]),title=this.props.cardData.title&&this.props.cardData.title!=null?this.props.cardData.title:"",originalTitle;if(this.props.cardData.softTitle!=undefined&&this.props.cardData.softTitle!="")if(this.props.cardData.softTitle.indexOf(":")!=-1){var titleArray=this.props.cardData.softTitle.split(":");if(titleArray&&titleArray.length>0&&this.props.cardData.cardName.indexOf("AGENDA")!=-1){if(titleArray[1]!=undefined&&titleArray[1]!=""&&titleArray[1].length>0)title=titleArray[1];else title=this.props.cardData.softTitle;originalTitle=this.props.cardData.originalTitle&&this.props.cardData.originalTitle!=null?this.props.cardData.originalTitle:"";if(this.props.callerApp=="WebClient"){title+=" : "+originalTitle;originalTitle=undefined}if(this.props.softTitleGenerator){var starttime=this.props.cardData.data.cardRelatedInfo?this.props.cardData.data.cardRelatedInfo.starttime:"";if(starttime&&title)title=this.props.softTitleGenerator(title,starttime)}else if(this.props.cardData.data&&this.props.cardData.data.cardRelatedInfo&&this.props.cardData.data.cardRelatedInfo.starttime)title=this.softTitleGenerator(title,this.props.cardData.data.cardRelatedInfo.starttime)}}if(title){var titleElement=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardPrimTitle","aria-describedby":"ariaToolTipId",title:title,className:"card-primaryTitle"+(this.props.showIcon==true?" no-left-margin":"")+(this.props.showDescription&&this.props.cardData.description?" card-primaryTitle-withDescription":"")},title);if(this.props.cardData.cardName=="REGARDING")var titleElement=Mscrm.Controls.VDOM.anchor(this.props.cardData,{key:"cardPrimTitle",tabIndex:this.cardTabIndex,href:"#",title:title,"aria-describedby":"ariaToolTipId",className:"card-primaryTitle"+(this.props.showIcon==true?" no-left-margin":"")+(this.props.showDescription&&this.props.cardData.description?" card-primaryTitle-withDescription":"")},title)}if(originalTitle)var originalTitleElement=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardOrigTitle",className:"originalTitleOverride card-primaryTitle"+(this.props.showIcon==true?" no-left-margin":"")+(this.props.showDescription&&this.props.cardData.description?" card-primaryTitle-withDescription":"")},originalTitle);var descriptionDiv;if(this.props.showDescription&&this.props.cardData.description)descriptionDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardPrimeDescription",title:this.props.cardData.description,"aria-describedby":"ariaToolTipId",className:this.props.showIcon==true?"generalCard-description no-left-margin":"generalCard-description"},this.props.cardData.description);var contentDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"group-attendeeicon"},[imgBlockDiv,titleElement]);content=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"content",className:"generalCard-maincontent generalCard-maincontent-small"+(this.props.showIcon!=true?" align-center":"")},[titleElement,originalTitleElement,descriptionDiv])}else content=this.props.primaryTemplate(this);if(this.props.callerApp=="WebClient"){var card=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"card",className:this.props.isGroup?"generalCard generalCard-small generalCard-small-group":"generalCard generalCard-small",onClick:this.onCardClick.bind(null,this)},[imgBlock,content]);container=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"swipe-content"},[card])}else{var snoozeIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeIcon",className:"CRMMDL2 icon-snooze","aria-hidden":true}),snoozeStr=CRMNow.CardUtils.getSnoozeTimeStr(this.props.cardData).split(/\s/),snoozeFirstWord=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeWord",className:"first-word","aria-hidden":true},snoozeStr[0]);snoozeStr.shift();var snoozeString=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeText ",className:"snooze-text","aria-hidden":true},[snoozeFirstWord,snoozeStr.join(" ")]),snooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snooze",className:"snooze"},[snoozeIcon,snoozeString]),defaultSnooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeContainer",ref:"snooze-container",className:"snooze-container"},[snooze]),swipeUndoLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.undoClick.bind(null,this),key:"snoozeUndo",className:"swipe-undo-label",type:"button",tabIndex:this.cardTabIndex,"aria-label":CRMNow.CardUtils.getResources("ActionCard.CFC.Common.UndoCardDismiss")},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Undo")),swipeUndoContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeUndoContainer",className:"swipe-undo"},swipeUndoLabel),snoozed=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeAction",className:"swipedaction"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Snoozing")),snoozedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeState",ref:"snooze-state",className:"snooze-state"},[snoozed,swipeUndoContainer]),snoozeDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeleft",className:"snooze-left","aria-hidden":true},[defaultSnooze,snoozedState]),dismissIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissIcon",className:"CRMMDL2 icon-dismark","aria-hidden":true}),dismissText=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissText",className:"dismiss-text","aria-hidden":true},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Dismiss")),dismiss=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismiss",className:"dismiss"},[dismissText,dismissIcon]),dismissContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissContainer",ref:"dismiss-container",className:"dismiss-container"},[dismiss]),negativeFeedbackLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleNegativeFeedback.bind(null,this),key:"negativefeedback",type:"button",className:"feedbackResponseNo",tabIndex:this.cardTabIndex},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.No")),positiveFeedbackLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handlePositiveFeedback.bind(null,this),key:"positivefeedback",type:"button",className:"feedbackResponseYes",tabIndex:this.cardTabIndex},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Yes")),feedbackString=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"feedbackString",className:"feedbackString-short"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.FeedbackString-short")),feedbackResponses=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"feedbackResponses",className:"feedbackResponses"},[positiveFeedbackLabel,negativeFeedbackLabel]),dismissedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissState",ref:"dismiss-state",className:"dismiss-state"},[swipeUndoLabel,feedbackString,positiveFeedbackLabel,negativeFeedbackLabel]),feedbackOptionsDiv=[],feedbackOptions=[CRMNow.CardUtils.getResources("ActionCard.CFC.Common.IncorrectEmail"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.ReasonAlreadyProvided"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.IncorrectRequest"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.OtherReasons")],askFeedbackDiv=Mscrm.Controls.VDOM.span(this.props.cardData,{className:"askForFeedback"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.AskForFeedback")),closeFeedbackDiv=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleCloseFeedbackDiv.bind(null,this),className:"closeFeedbackDiv",tabIndex:this.cardTabIndex,type:"button","aria-label":CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Close")});feedbackOptionsDiv.push(askFeedbackDiv,closeFeedbackDiv);for(var i=0;i<feedbackOptions.length;i++){var option=feedbackOptions[i],optionButton=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleCardDismissReason.bind(null,option,false),tabIndex:this.cardTabIndex,className:"feedbackOptionString",type:"button"},option),optionDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"feedbackoptions"},optionButton);feedbackOptionsDiv.push(optionDiv)}var optionsDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},feedbackOptionsDiv),negativeFeedbackDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{ref:"negativeFeedbackRef",className:"negativeFeedbackDiv"},optionsDiv),dismissDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissRight",className:"dismiss-right"},[dismissContainer,dismissedState,negativeFeedbackDiv]),card=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"card",ref:"swipe-content",className:this.props.isGroup?"generalCard generalCard-small generalCard-small-group":"generalCard generalCard-small generalCard-small-group setborder",onKeyPress:this.onCardKeyPress,onKeyDown:this.handleKeyDownPress.bind(null,this),onClick:this.onCardClick},this.props.showIcon==true?[imgBlockDiv,content]:[content]);container=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"swipeContent",className:"swipe-content"},[snoozeDiv,card,dismissDiv])}}else container=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"swipeContent"},[]);return container};GenericCardView.prototype.renderGenericCardFooter=function(){var actions=[],footer,data=[],actionData=[];if(this.props.showActionInfo){if(this.props.actionTemplate==undefined&&this.props.actionTemplate==null){var cmdManager=this.commandManager;if(cmdManager.commandFetchCompleted)data=this.getActionData(this.props.cardData);else data=[];var cmd=data&&data.length>0?data[0]:"",actionFirst=Mscrm.Controls.VDOM.button(this.props.cardData,{className:"generalCard-actions",ref:"actionContainer1",key:"actions1","data-action-cardId":this.props.cardData.cardId,"data-contents":"",type:"button",tabIndex:cmd&&cmd.label?this.cardTabIndex:-1,onClick:this.handleActionClick.bind(null,this,"actionContainer1",cmd)},cmd&&cmd.label?cmd.label:"");cmd=data&&data.length>1?data[1]:"";var actionSecond=Mscrm.Controls.VDOM.button(this.props.cardData,{className:"generalCard-actions",ref:"actionContainer2",key:"actions2","data-action-cardId":this.props.cardData.cardId,"data-contents":"",type:"button",tabIndex:cmd&&cmd.label?this.cardTabIndex:-1,onClick:this.handleActionClick.bind(null,this,"actionContainer2",cmd)},cmd&&cmd.label?cmd.label:"");if(data&&data.length>1)actions=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-footeractions"},[actionFirst,actionSecond]);else actions=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-footeractions"},[actionFirst])}else actions=this.props.actionTemplate();footer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardFooter",className:"generalCard-footer","data-footer-cardId":this.props.cardData.cardId},actions)}return footer};GenericCardView.prototype.softTitleGenerator=function(softTitle,starttime){var formatedSoftTitle=softTitle?softTitle:"";if(starttime&&softTitle){var formatedMeetingTime=CRMNow.CardUtils.getUserTime(starttime,"formatTime");if(CRMNow.CardUtils.isCCFMode())formatedSoftTitle=this.formatSoftTitle(softTitle,formatedMeetingTime)}return formatedSoftTitle};GenericCardView.prototype.formatSoftTitle=function(format){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var returnValue=format,i=1;i<arguments.length;i++){var actualValue=typeof arguments[i]=="undefined"||arguments[i]==null?"":arguments[i].toString();returnValue=returnValue.replace(new RegExp("\\{"+(i-1)+"\\}","g"),actualValue)}return returnValue};GenericCardView.prototype.renderCardTitle=function(){var imgBlock=[],titleContainer,formatedTitle;if(this.props.showTitleInfo)if(!this.props.titleTemplate){if(this.props.cardTypeIcon!="")imgBlock=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"imgBlock",onKeyPress:this.handleOnCardTitleKeyPress.bind(null,this),className:CRMNow.CardUtils.defaultCardIcon(this.props.cardData.cardName)});formatedTitle=this.generateFormattedTitle();var title=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardSoftTitle",ref:"cardSoftTitle",title:formatedTitle?formatedTitle:"","aria-describedby":"ariaToolTipId",className:"generalCard-softTitle",style:{color:CRMNow.CardUtils.defaultCardTitleColor(this.props.cardData.cardName)}},formatedTitle?formatedTitle:""),title_description=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardPrimTitle",ref:"cardPrimTitle",title:this.props.cardData.title?this.props.cardData.title:"","aria-describedby":"ariaToolTipId",className:"generic-PrimTitle"},this.props.cardData.title?this.props.cardData.title:""),description=[];if(this.props.showPrimaryInfo)if(this.props.primaryTemplate==null)description=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardDescription",className:"generalCard-description",title:this.props.cardData.description?this.props.cardData.description:"","aria-describedby":"ariaToolTipId"},this.props.cardData.description?this.props.cardData.description:"");var titleContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardTitleContent",onKeyPress:this.handleOnCardTitleKeyPress.bind(null,this),className:"generalCard-maincontent generalCard-maincontent-medium"},[title,title_description,description]);titleContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleContainer",className:"Display-Title",onClick:!this.props.showSuccessCardOverlay?this.onCardClick.bind(null,this):""},[imgBlock,titleContent])}else titleContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"titleContainer",className:"Display-Title",onClick:!this.props.showSuccessCardOverlay?this.onCardClick.bind(null,this):""},[this.props.titleTemplate?this.props.titleTemplate():""]);return titleContainer};GenericCardView.prototype.generateFormattedTitle=function(){var formatedTitle;if(this.props.cardData.softTitle!=undefined&&this.props.cardData.softTitle!=""){var softTitle=this.props.cardData.softTitle;if(softTitle.indexOf(":")!=-1){var titleArray=softTitle.split(":");if(titleArray[1]!=undefined&&titleArray[1]!=""&&titleArray[1].length>0)formatedTitle=titleArray[1];else formatedTitle=softTitle}else formatedTitle=softTitle;if(this.props.softTitleGenerator){var starttime=this.props.cardData.data.cardRelatedInfo?this.props.cardData.data.cardRelatedInfo.starttime:"";if(starttime&&formatedTitle)formatedTitle=this.props.softTitleGenerator(formatedTitle,starttime)}else if(this.props.cardData.data&&this.props.cardData.data.cardRelatedInfo&&this.props.cardData.data.cardRelatedInfo.starttime)formatedTitle=this.softTitleGenerator(formatedTitle,this.props.cardData.data.cardRelatedInfo.starttime);else if(this.props.cardData.cardtype=="107"&&this.props.cardData.data&&this.props.cardData.data.cardRelatedInfo&&this.props.cardData.data.cardRelatedInfo.departureTime)formatedTitle=this.props.cardData.softTitle?MscrmCommon.ControlUtils.String.Format(formatedTitle,moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("MMM dd"),moment(this.props.cardData.data.cardRelatedInfo.departureTime).toDate().localeFormat("t")):""}return formatedTitle};GenericCardView.prototype.renderGenericMediumCard=function(){var mainContent,contextContent,relatedContent,optionBtn,menu;if(this.props.showMenu!=undefined?this.props.showMenu:true)if(Boolean(this.props.cardData.hasSnoozeDismiss)){optionBtn=Mscrm.Controls.VDOM.button(this.props.cardData,{className:"CRMMDL2 icon-dotdotdot",ref:"optionBtn",key:"optionBtn",id:"optionBtn",title:CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.MenuButton_Label"),"aria-label":CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.MenuButton_Label"),"aria-haspopup":true,"aria-expanded":"false",type:"button",tabIndex:this.cardTabIndex,onKeyDown:this.handleTabFocus.bind(null,this),onClick:this.handleMenuBottonClick.bind(null,this)});menu=this.renderMenu()}if(this.props.showPrimaryInfo)if(this.props.primaryTemplate==null)var mainContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardTitle",className:"generalCard-contentcontainer"},[this.renderCardTitle(),optionBtn,menu]);else mainContent=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardTitle",className:"generalCard-contentcontainer"},[this.renderCardTitle(),optionBtn,menu,this.props.primaryTemplate?this.props.primaryTemplate(this):""]);if(this.props.showContextInfo&&this.props.contextTemplate)contextContent=this.props.contextTemplate();if(this.props.showRelatedInfo&&this.props.relatedTemplate)relatedContent=this.props.relatedTemplate();if(this.props.callerApp=="WebClient")var cardData=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardData",className:"swipe-medium-data"},[mainContent,contextContent,relatedContent,this.renderGenericCardFooter()]),card=Mscrm.Controls.VDOM.div(this.props.cardData,{key:this.props.cardData.cardName,className:"generalCard generalCard-medium"},[cardData]);else{var snoozeIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeIcon",className:"CRMMDL2 icon-snooze","aria-hidden":true}),snoozeStr=CRMNow.CardUtils.getSnoozeTimeStr(this.props.cardData).split(/\s/),snoozeFirstWord=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeWord",className:"first-word","aria-hidden":true},snoozeStr[0]);snoozeStr.shift();var snoozeString=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeText ",className:"snooze-text","aria-hidden":true},[snoozeFirstWord,snoozeStr.join(" ")]),snooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snooze",className:"snooze"},[snoozeIcon,snoozeString]),defaultSnooze=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeContainer",ref:"snooze-container",className:"snooze-container"},[snooze]),dismissedLabel=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissed-string",className:"dismissedString"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Dismissed")),swipeUndoLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.undoClick.bind(null,this),type:"button",key:"snoozeUndo",className:"swipe-undo-label",tabIndex:this.cardTabIndex,"aria-label":CRMNow.CardUtils.getResources("ActionCard.CFC.Common.UndoCardDismiss")},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Undo")),swipeUndoContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeUndoContainer",className:"swipe-undo"},swipeUndoLabel),dismissUndoContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissUndoContainer",className:"dismiss-undo"},[dismissedLabel,swipeUndoLabel]),snoozed=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeAction",className:"swipedaction"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Snoozing")),snoozedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeState",ref:"snooze-state",className:"snooze-state"},[snoozed,swipeUndoContainer]),snoozeDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"snoozeleft",className:"snooze-left"},[defaultSnooze,snoozedState]),dismissIcon=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissIcon",className:"CRMMDL2 icon-dismark","aria-hidden":true}),dismissText=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissText",className:"dismiss-text","aria-hidden":true},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Dismiss")),dismiss=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismiss",className:"dismiss"},[dismissText,dismissIcon]),dismissContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissContainer",ref:"dismiss-container",className:"dismiss-container"},[dismiss]),negativeFeedbackLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleNegativeFeedback.bind(null,this),key:"negativefeedback",type:"button",className:"feedbackResponseNo",tabIndex:this.cardTabIndex},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.No")),positiveFeedbackLabel=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handlePositiveFeedback.bind(null,this),key:"positivefeedback",type:"button",className:"feedbackResponseYes",tabIndex:this.cardTabIndex},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Yes")),feedbackString=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"feedbackString",className:"feedbackString"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.FeedbackString")),feedbackResponses=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"feedbackResponses",className:"feedbackResponses"},[positiveFeedbackLabel,negativeFeedbackLabel]),feedbackContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"feedbackContainer",className:"feedbackContainer"},[feedbackString,feedbackResponses]),dismissedState=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissState",ref:"dismiss-state",className:"dismiss-state"},[dismissUndoContainer,feedbackContainer]),feedbackOptionsDiv=[],feedbackOptions=[CRMNow.CardUtils.getResources("ActionCard.CFC.Common.IncorrectEmail"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.ReasonAlreadyProvided"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.IncorrectRequest"),CRMNow.CardUtils.getResources("ActionCard.CFC.Common.OtherReasons")],askFeedbackDiv=Mscrm.Controls.VDOM.span(this.props.cardData,{className:"askForFeedback"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.AskForFeedback")),closeFeedbackDiv=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleCloseFeedbackDiv.bind(null,this),className:"closeFeedbackDiv",type:"button",tabIndex:this.cardTabIndex,"aria-label":CRMNow.CardUtils.getResources("ActionCard.CFC.Common.Close")});feedbackOptionsDiv.push(askFeedbackDiv,closeFeedbackDiv);for(var i=0;i<feedbackOptions.length;i++){var option=feedbackOptions[i],optionButton=Mscrm.Controls.VDOM.button(this.props.cardData,{onClick:this.handleCardDismissReason.bind(null,option,false),tabIndex:this.cardTabIndex,className:"feedbackOptionString",type:"button"},option),optionDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"feedbackoptions"},optionButton);feedbackOptionsDiv.push(optionDiv)}var optionsDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},feedbackOptionsDiv),negativeFeedbackDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{ref:"negativeFeedbackRef",className:"negativeFeedbackDiv"},optionsDiv),dismissDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"dismissRight",className:"dismiss-right"},[dismissContainer,dismissedState,negativeFeedbackDiv]),cardData=Mscrm.Controls.VDOM.div(this.props.cardData,{key:"cardData",ref:"swipe-content",className:"swipe-medium-data"},[mainContent,contextContent,relatedContent,this.renderGenericCardFooter()]),card=Mscrm.Controls.VDOM.div(this.props.cardData,{key:this.props.cardData.cardId,className:this.props.showSuccessCardOverlay?"overlay generalCard generalCard-medium":"generalCard generalCard-medium",onKeyPress:!this.props.showPrimaryInfo||this.props.showPrimaryInfo&&!this.props.showTitleInfo?this.onMediumCardKeyPress.bind(null,this):null,onClick:!this.props.showPrimaryInfo||this.props.showPrimaryInfo&&!this.props.showTitleInfo?this.onCardClick.bind(null,this):null},[snoozeDiv,cardData,dismissDiv])}return card};GenericCardView.prototype.renderCard=function(){if(this.props.mode=="small")return this.renderGenericSmallCard();else return this.renderGenericMediumCard()};GenericCardView.prototype.onRender=function(){this.globalPanelCardIdSuffix=this.props.isGlobalPanelEnabled?" globalPanelId":"";if(Mscrm.ActionCardDefaultFocusId==this.props.cardData.cardId&&this.props.mode!="small")this.cardTabIndex=Mscrm.actioncardTabIndex;else this.cardTabIndex=-1;var liTabIndex=this.cardTabIndex;if(this.props.mode=="small")if(this.props.cardData.cardName=="REGARDING"||MscrmCommon.ControlUtils.String.isNullOrEmpty(this.props.regardingObject)&&MscrmCommon.ControlUtils.String.isNullOrEmpty(this.props.actionData))liTabIndex=null;var titles=[];titles[0]=this.generateFormattedTitle()+" "+this.props.cardData.title;var cardProps;if(this.props.callerApp=="WebClient")cardProps={className:this.props.isGroup?"carVwidth":"carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix,key:this.props.cardData.cardId,ref:"genericCard",onMouseDown:this.swipeStartHandler,onMouseUp:this.swipeEndHandler,onMouseMove:this.elementMoveHandle,onMouseLeave:this.resetCard,onTouchStart:this.swipeStartHandler,onTouchEnd:this.swipeEndHandler,onTouchMove:this.elementMoveHandle,id:this.props.cardData.cardName};else cardProps={className:this.props.isGroup?"carVwidth":"carVwidth groupcard-spacing"+this.globalPanelCardIdSuffix,key:this.props.cardData.cardId,ref:"genericCard",onMouseDown:this.swipeStartHandler,onMouseUp:this.swipeEndHandler,onMouseMove:this.elementMoveHandle,onMouseLeave:this.resetCard,onTouchStart:this.swipeStartHandler,onTouchEnd:this.swipeEndHandler,onTouchMove:this.elementMoveHandle,"aria-label":liTabIndex!=null?MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.Navigation_HelpText"),titles):null,onKeyDown:this.handleKeyDownPress.bind(null,this),tabIndex:liTabIndex,id:this.props.cardData.cardName};var container;if(this.props.callerApp=="WebClient"){var webClientCardProps;if(this.props.cardData.data.cardTypeData.cardtypeid=="{0734FEA3-46B9-4E9C-9001-53E957EC2DD4}")webClientCardProps={key:this.props.cardData.cardId,className:"letsGetStartedClass controlBgClass",id:this.props.cardData.cardId};else webClientCardProps={key:this.props.cardData.cardId,className:"actionCardLayout controlBgClass",id:this.props.cardData.cardId,onClick:this.props.defaultActionTemplate?this.props.defaultActionTemplate.bind(this):null};container=Mscrm.Controls.VDOM.div(this.props.cardData,webClientCardProps,[this.renderCard()])}else container=Mscrm.Controls.VDOM.li(this.props.cardData,cardProps,[this.renderCard()]);return container};return GenericCardView}(Mscrm.Controls.VirtualComponentBase);CRMNow.GenericCardView=GenericCardView;CRMNow.GenericCardControl=ReactUtils.createComponent(new GenericCardView)})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var CardFeedContainerMain=function(_super){__extends(CardFeedContainerMain,_super);function CardFeedContainerMain(globalPanelEnabled,commandManager){_super.call(this);this.dataFactories={UPCOMING_MEETING:new CRMNow.MeetingCardFactory,"AGENDA:ACTIVITY_MEETING":new CRMNow.MeetingCardFactory,STOCK_ACTIVITY:new CRMNow.StockActivityCardFactory,RELEVANT_NEWS:new CRMNow.NewsCardFactory,TOP_RECORD:new CRMNow.TopRecordsCardFactory,TOP_PEOPLE:new CRMNow.TopPeopleCardFactory,NEARBY_CUSTOMERS:new CRMNow.TopPeopleCardFactory,BESTTIMETOCALL:new CRMNow.EmailCardFactory,EMAILOPEN:new CRMNow.EmailCardFactory,REMINDERWITHCALL:new CRMNow.EmailCardFactory,REMINDERWITHOUTCALL:new CRMNow.EmailCardFactory,UPCOMING_FLIGHT:new CRMNow.FlightCardFactory,"AGENDA:ACTIVITY_PHONE":new CRMNow.PhoneCardFactory,"AGENDA:ACTIVITY_TASK":new CRMNow.TaskCardFactory,MAP:new CRMNow.MapCardFactory,GroupView:new CRMNow.GroupCardFactory,Generic:new CRMNow.GenericCardFactory,"AGENDA:ACTIVITY_OTHERS":new CRMNow.GenericCardFactory};this.autoDissmissCards={"3":["Mscrm.HomepageGrid.actioncard.CreateNewMeetingCardCommand","Mscrm.SubGrid.actioncard.CreateNewMeetingCardCommand"],"4":["Mscrm.HomepageGrid.actioncard.AddAsStakeHolderCommand","Mscrm.HomepageGrid.actioncard.DoThisAutomaticallyCommand","Mscrm.SubGrid.actioncard.AddAsStakeHolderCommand","Mscrm.SubGrid.actioncard.DoThisAutomaticallyCommand"],"5":["Mscrm.HomepageGrid.actioncard.AddAsCompetitorCommand","Mscrm.HomepageGrid.actioncard.DoThisAutomaticallyCommand","Mscrm.SubGrid.actioncard.AddAsCompetitorCommand","Mscrm.SubGrid.actioncard.DoThisAutomaticallyCommand"],"8":["Mscrm.HomepageGrid.actioncard.ClosePhoneCallCommand","Mscrm.HomepageGrid.actioncard.CompletePhoneCallCommand","Mscrm.SubGrid.actioncard.ClosePhoneCallCommand","Mscrm.SubGrid.actioncard.CompletePhoneCallCommand"],"7":["Mscrm.HomepageGrid.actioncard.CompleteTaskCommand","Mscrm.HomepageGrid.actioncard.CloseTaskCommand","Mscrm.SubGrid.actioncard.CompleteTaskCommand","Mscrm.SubGrid.actioncard.CloseTaskCommand"],"11":["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.HomepageGrid.actioncard.CancelOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CancelOtherActivityCommand"],"12":["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand"],"13":["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand"],"14":["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand"],"15":["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand"]};this.globalPanelCloseCards={"Mscrm.HomepageGrid.actioncard.CreateCaseCommand":"Mscrm.HomepageGrid.actioncard.CreateCaseCommand","Mscrm.SubGrid.actioncard.CreateCaseCommand":"Mscrm.SubGrid.actioncard.CreateCaseCommand","Mscrm.Modern.OpenEmailCommand":"Mscrm.Modern.OpenEmailCommand","Mscrm.HomepageGrid.actioncard.TakeNotesCommand":"Mscrm.HomepageGrid.actioncard.TakeNotesCommand","Mscrm.SubGrid.actioncard.TakeNotesCommand":"Mscrm.SubGrid.actioncard.TakeNotesCommand","Mscrm.HomepageGrid.actioncard.Open":"Mscrm.HomepageGrid.actioncard.Open","Mscrm.SubGrid.actioncard.Open":"Mscrm.SubGrid.actioncard.Open","Mscrm.Modern.SendEmailCommand":"Mscrm.Modern.SendEmailCommand","Mscrm.HomepageGrid.actioncard.OpenRecipientView":"Mscrm.HomepageGrid.actioncard.OpenRecipientView","Mscrm.SubGrid.actioncard.OpenRecipientView":"Mscrm.SubGrid.actioncard.OpenRecipientView","Mscrm.HomepageGrid.actioncard.OpenEmailView":"Mscrm.HomepageGrid.actioncard.OpenEmailView","Mscrm.SubGrid.actioncard.OpenEmailView":"Mscrm.SubGrid.actioncard.OpenEmailView","Mscrm.HomepageGrid.actioncard.CreateNewMeetingCardCommand":"Mscrm.HomepageGrid.actioncard.CreateNewMeetingCardCommand","Mscrm.SubGrid.actioncard.CreateNewMeetingCardCommand":"Mscrm.SubGrid.actioncard.CreateNewMeetingCardCommand","Mscrm.HomepageGrid.actioncard.OpenOpportunity":"Mscrm.HomepageGrid.actioncard.OpenOpportunity","Mscrm.SubGrid.actioncard.OpenOpportunity":"Mscrm.SubGrid.actioncard.OpenOpportunity","Mscrm.Modern.EmailAttendeesCommand":"Mscrm.Modern.EmailAttendeesCommand"};this.markcompleteCommands={"Mscrm.HomepageGrid.actioncard.ClosePhoneCallCommand":"Mscrm.HomepageGrid.actioncard.ClosePhoneCallCommand","Mscrm.SubGrid.actioncard.ClosePhoneCallCommand":"Mscrm.SubGrid.actioncard.ClosePhoneCallCommand","Mscrm.HomepageGrid.actioncard.CompletePhoneCallCommand":"Mscrm.HomepageGrid.actioncard.CompletePhoneCallCommand","Mscrm.SubGrid.actioncard.CompletePhoneCallCommand":"Mscrm.SubGrid.actioncard.CompletePhoneCallCommand","Mscrm.HomepageGrid.actioncard.CompleteTaskCommand":"Mscrm.HomepageGrid.actioncard.CompleteTaskCommand","Mscrm.SubGrid.actioncard.CompleteTaskCommand":"Mscrm.SubGrid.actioncard.CompleteTaskCommand","Mscrm.HomepageGrid.actioncard.CloseTaskCommand":"Mscrm.HomepageGrid.actioncard.CloseTaskCommand","Mscrm.SubGrid.actioncard.CloseTaskCommand":"Mscrm.SubGrid.actioncard.CloseTaskCommand","Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand":"Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand","Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand":"Mscrm.SubGrid.actioncard.CompleteOtherActivityCommand","Mscrm.HomepageGrid.actioncard.AddAsCompetitorCommand":"Mscrm.HomepageGrid.actioncard.AddAsCompetitorCommand","Mscrm.SubGrid.actioncard.AddAsCompetitorCommand":"Mscrm.SubGrid.actioncard.AddAsCompetitorCommand"};this.additionalData={};this.actionCommands={};this.commandsFetched=false;this.commandFetchCounter=0;this.isBackButtonClicked=false;this.isGlobalPanelEnabled=false;this.displayName="CFCContainer";this.isGlobalPanelEnabled=globalPanelEnabled;this.randomIdentity=Math.random().toString();this.commandManager=commandManager}CardFeedContainerMain.prototype.getInitialState=function(){return {showGroupOnly:false,mode:"small",selectedGroupCard:"",showSnooze:false,showDismiss:false,swipeId:"",showMenu:false,currentDataSource:this.getContext().parameters.value.listData,currentView:{name:"Step1",data:this.getContext().parameters.value.listData,viewType:"Main"},views:[{name:"Step1",data:this.getContext().parameters.value.listData,viewType:"Main"}],overlayCardId:""}};CardFeedContainerMain.prototype.componentDidMount=function(){this.setHeight();this.setLearningPathIDs();this.commandManager.fetchCommands(0,this.fetchActionCommands)};CardFeedContainerMain.prototype.setLearningPathIDs=function(){if(MscrmCommon.ControlUtils.Object.isNullOrUndefined(CRMNow.CardUtils.ccfContext.learningPath))return;var container=this.refs["cardFeedContainer"];$(container).attr(CRMNow.CardUtils.ccfContext.learningPath.DOMAttributeName,CRMNow.CardUtils.ccfContext.learningPath.baseControlId+"|cardFeedContainer")};CardFeedContainerMain.prototype.setHeight=function(){var container=this.refs["cardFeedContainer"];this.getContext().parameters.value.listData.length>0&&jQuery(container).height("100%");this.setDefaultFocus()};CardFeedContainerMain.prototype.setDefaultFocus=function(){var globalPanelCardIdSuffix=this.isGlobalPanelEnabled?" globalPanelId":"",backArrow=jQuery("div[class^=cardFeedContainer_]").find("div[class='CRMMDL2 icon-backarrow"+globalPanelCardIdSuffix+"']");if(backArrow.length>0){backArrow.attr("tabindex",Mscrm.actioncardTabIndex);backArrow.focus()}else{$("#ariaNavigationTextId").trigger("pointerdown");var firstCard=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+globalPanelCardIdSuffix+"']")[0];this.getFirstCardElement(firstCard,globalPanelCardIdSuffix,false)}};CardFeedContainerMain.prototype.getFirstCardElement=function(nextCard,globalPanelCardIdSuffix,setFocus){var isCardFocusSet=false;if(!MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextCard)&&!MscrmCommon.ControlUtils.Object.isNullOrUndefined(nextCard)){var tabbingElements=jQuery(nextCard).find("[tabindex]");tabbingElements.each(function(index,ele){if(setFocus&&!isCardFocusSet&&(index==0&&ele.tagName=="LI")){ele.focus();isCardFocusSet=true}if(ele.className=="generalCard-actions"&&MscrmCommon.ControlUtils.String.isNullOrEmpty(ele.textContent))ele.tabIndex=-1;else ele.tabIndex=Mscrm.actioncardTabIndex});if(this.isBackButtonClicked||globalPanelCardIdSuffix!=""||setFocus)if(!isCardFocusSet){jQuery(nextCard).attr("tabindex",Mscrm.actioncardTabIndex);jQuery(nextCard).focus()}}};CardFeedContainerMain.prototype.componentDidUpdate=function(){this.setHeight()};CardFeedContainerMain.prototype.componentWillMount=function(){};CardFeedContainerMain.prototype.commandFetchSuccess=function(status){var _this=this;if(status)this.commandManager.fetchCommands(0,this.fetchActionCommands);else if(this.commandFetchCounter<3){this.commandFetchCounter++;window.setTimeout(function(){_this.state.currentDataSource.length>0&&_this.commandManager.checkCommandAvailable(_this.state.currentDataSource[0].cardId,_this.commandFetchSuccess)},500)}};CardFeedContainerMain.prototype.handleScroll=function(event){var container=this.refs["cardFeedContainer"];jQuery(container).scrollLeft()>0&&jQuery(container).scrollLeft(0);jQuery(container).scrollTop()+jQuery(container).innerHeight()>=jQuery(container)[0].scrollHeight&&this.onScrollEnd()};CardFeedContainerMain.prototype.onScrollEnd=function(){};CardFeedContainerMain.prototype.fetchActionCommands=function(){if(this.state.currentDataSource.length>0)for(var card in this.state.currentDataSource){this.commandFetchCounter=0;var commands=this.getActionCommands(this.state.currentDataSource[card]);commands&&commands.length>0&&this.updateCardActions(commands,this.state.currentDataSource[card])}};CardFeedContainerMain.prototype.getActionCommands=function(cardData){var _this=this,commands=this.commandManager.getCommandByCardId(cardData.cardId);if(commands&&commands.length>0)return commands;else if(this.commandFetchCounter<3){this.commandFetchCounter++;window.setTimeout(function(){_this.getActionCommands(cardData)},500)}};CardFeedContainerMain.prototype._getCCFContext=function(){return this.getContext().parameters.value.ccfContext};CardFeedContainerMain.prototype.navigateToEntity=function(entityLogicalName,entityId){try{this._getCCFContext().utils.fireEvent("close",{});this._getCCFContext().navigation.openForm({entityName:entityLogicalName,entityId:entityId})}catch(e){}};CardFeedContainerMain.prototype.navigateTo=function(entityReference){var formOptions={entityName:entityReference.LogicalName};this._getCCFContext().navigation.openForm(formOptions)};CardFeedContainerMain.prototype.getReferenceTokenData=function(cardData,props){var _window=window,FlagForRefToken=this.dataFactories[cardData.cardName]instanceof CRMNow.EmailCardFactory;if(typeof cardData.referencetokens=="string")cardData.referencetokens=JSON.parse(cardData.referencetokens);if(!this.dataFactories[cardData.cardName]||FlagForRefToken)if(cardData.referencetokens&&cardData.referencetokens.Tokens){var tokens=cardData.referencetokens.Tokens,value="";props.cardData.title=cardData.originalTitle;if(tokens.title&&CRMNow.CardUtils.getResources){value=CRMNow.CardUtils.getResources(tokens.title.ResourceId);if(tokens.title.ResourceId!=value||props.cardData.title==undefined||props.cardData.title==null){var paramsNameValues=[];if(tokens.title.Params&&tokens.title.Params.length>0)paramsNameValues=tokens.title.Params.map(function(param){if(param.Name)return param.Name});if(paramsNameValues&&paramsNameValues.length>0)if(paramsNameValues&&paramsNameValues.length>1)props.cardData.title=CRMNow.CardUtils.formatStringArray(value,paramsNameValues);else props.cardData.title=MscrmCommon.ControlUtils.String.Format(value,paramsNameValues);else props.cardData.title=value}}if(tokens.body&&CRMNow.CardUtils.getResources){value=CRMNow.CardUtils.getResources(tokens.body.ResourceId);if(tokens.body.ResourceId!=value||props.cardData.description==undefined||props.cardData.description==null){var paramsNameValues=[];if(tokens.body.Params&&tokens.body.Params.length>0)paramsNameValues=tokens.body.Params.map(function(param){if(param.Name){var name=param.Name;if(param.Type==1){if(moment(name).isValid())try{var dateTime=new Date(name);if(dateTime!=null){var dformat="formatDateLong";if(name.indexOf("T")!=-1){dformat="formatDateLongWithTime";name=CRMNow.CardUtils.getUserTime(dateTime,dformat)}else return dateTime.localeFormat(CRMNow.CardUtils.ccfContext.client.dateFormattingInfo.LongDatePattern)}}catch(Exception){if(dateTime!=null)name=dateTime.toDateString()}else{var curDate=new Date,dateStr=curDate.toDateString();dateStr+=" "+name;name=CRMNow.CardUtils.getUserTime(dateStr,"formatTime")}return name}else return name}});if(paramsNameValues&&paramsNameValues.length>0)if(paramsNameValues&&paramsNameValues.length>1)props.cardData.description=CRMNow.CardUtils.formatStringArray(value,paramsNameValues);else props.cardData.description=MscrmCommon.ControlUtils.String.Format(value,paramsNameValues);else props.cardData.description=value}else props.cardData.description=""}if(props.mode==="small"&&tokens.minicardtext&&CRMNow.CardUtils.getResources&&(props.cardData.title==""||props.cardData.title==null||props.cardData.title==undefined)){value=CRMNow.CardUtils.getResources(tokens.minicardtext.ResourceId);if(tokens.minicardtext.ResourceId!=value||props.cardData.title==undefined||props.cardData.title==null){var paramsNameValues=[];if(tokens.minicardtext.Params&&tokens.minicardtext.Params.length>0)paramsNameValues=tokens.minicardtext.Params.map(function(param){if(param.Name){var name=param.Name;if(param.Type==1){if(moment(name).isValid())try{var dateTime=new Date(name);if(dateTime!=null){var dformat="formatDateLong";if(name.indexOf("/")!=-1)dformat="formatDateLongWithTime";name=CRMNow.CardUtils.getUserTime(dateTime,dformat)}}catch(Exception){if(dateTime!=null)name=dateTime.toDateString()}else{var curDate=new Date,dateStr=curDate.toDateString();dateStr+=" "+name;name=CRMNow.CardUtils.getUserTime(dateStr,"formatTime")}return name}else return name}});if(paramsNameValues&&paramsNameValues.length>0)if(paramsNameValues&&paramsNameValues.length>1)props.cardData.title=CRMNow.CardUtils.formatStringArray(value,paramsNameValues);else props.cardData.title=MscrmCommon.ControlUtils.String.Format(value,paramsNameValues);else props.cardData.title=value}}}return props};CardFeedContainerMain.prototype.updateCardActions=function(commands,cardData){var container=this.refs["cardFeedContainer"],cards=this.state.currentDataSource,actionData=[],actions=jQuery(container).find("[data-action-cardId="+cardData.cardId+"]");actionData=this.getActionData(cardData);var count=[0,1];if(actionData&&actionData.length>0)for(var i in count)if(actionData[count[i]]&&actions[count[i]]){jQuery(actions[count[i]]).text(actionData[count[i]].label);jQuery(actions[count[i]]).data("command",actionData[count[i]].label);jQuery(actions[count[i]]).attr("content",actionData[count[i]].command);jQuery(actions[count[i]]).attr("title",actionData[count[i]].label);jQuery(actions[count[i]]).attr("aria-label",actionData[count[i]].label);jQuery(actions[count[i]]).attr("tabIndex",Mscrm.actioncardTabIndex)}};CardFeedContainerMain.prototype.getActionData=function(card){var cardActions,actionData=[],container=this.refs["cardFeedContainer"],actions=jQuery(container).find("[data-action-cardId="+card.cardId+"]"),commands=this.commandManager.getCommandByCardId(card.cardId),canShowEmail=true;if(card.actions&&commands&&commands.length>0){var filteredCommands=_.filter(commands,function(cmd){if(cmd.commandId!=null)cmd.command=cmd.commandId;return cmd.command!="Mscrm.HomepageGrid.actioncard.DismissCommand"&&cmd.command!="Mscrm.HomepageGrid.actioncard.SnoozeCommand"&&(cmd.command=="Mscrm.Modern.EmailAttendeesCommand"||cmd.command=="Mscrm.Modern.SendEmailCommand"?canShowEmail:true)});if(card.actions.Mobile)cardActions=card.actions.Mobile.Actions;else if(card.actions.WebClient)cardActions=card.actions.WebClient.Actions;if(cardActions){var actionCount=0;$.each(cardActions,function(label,command){if(actionCount<2){var curcommand=_.find(filteredCommands,function(cmd){if(cmd.commandId!=null)cmd.command=cmd.commandId;return cmd.command==command||cmd.command==command+"Solution"});if(curcommand){actionData.push(curcommand);actionCount++}}});return actionData}}};CardFeedContainerMain.prototype.getDeviceName=function(){var deviceName="",ccfContext=this._getCCFContext();if(ccfContext!=null&&ccfContext!=undefined&&ccfContext.client!=null&&ccfContext.client!=undefined)if(ccfContext.client.userAgent!=null&&ccfContext.client.userAgent!=undefined){var userAgent=ccfContext.client.userAgent;if(userAgent.isWin)deviceName="Windows";else if(userAgent.isAndroidModern||userAgent.isAndroid)deviceName="Android";else if(userAgent.isIos)deviceName="iOS"}return deviceName};CardFeedContainerMain.prototype.addTelemetryForActionOnRAActionCard=function(cardtype,command){var params=this._getCCFContext().parameters,entryPoint=params!=null&&params!=undefined&&params.Location!=undefined&&params.Location!=null&&params.Location.raw!=undefined&&params.Location.raw!=null?params.Location.raw:"0",actionOnRelationshipAssistantCard=new ActionOnRelationshipAssistantCard(cardtype,command,entryPoint,"TBD",MscrmControls.CRMNow.CardUtils.isUci,this.getDeviceName());MscrmControls.CRMNow.CardUtils.ccfContext.reporting.reportEvent(actionOnRelationshipAssistantCard)};CardFeedContainerMain.prototype.updateCardFeedContainer=function(action,args){var curData,curView,data=[],selectedGroupCard=args.selectedGroupCard,cardId=args.cardId,direction=args.direction,isGroupSwipe=args.isGroupSwipe,cardName=args.cardName,showMenu=args.showMenu,cardData=args.cardData,randomIdentity=args.randomIdentity,options=args.options,dataSource=this.getContext().parameters.value.listData,ccfContext=this._getCCFContext();if(args.cardId){curData=_.find(dataSource,function(item){return item.cardId==args.cardId});if(!curData)curData=args.data}else if(selectedGroupCard&&selectedGroupCard!==""){var groupedData=this.groupData(dataSource);curData=groupedData[args.selectedGroupCard];if(!curData)curData=args.data}if(action=="GroupView"||action=="backViewClick"){if(action=="backViewClick"){if(this.state.currentView.viewType=="CardView")this.randomIdentity=Math.random().toString();this.state.views.pop();if(this.state.views.length>0){curView=this.state.views[this.state.views.length-1];curData=curView.data}else{curView={name:"Step1",data:dataSource,viewType:"Main"};curData=curView.data}}else{var curName=action,prevView=this.state.views[this.state.views.length-1],prevViewName=prevView.name.match(/[a-zA-Z]+|[0-9]+/g);if(prevViewName.length>1)curName=prevViewName[0]+ ++prevViewName[1];curView={name:curName,data:curData,viewType:action};this.state.views.push(curView)}if(curData.length&&curData.length>0)data=curData;else data.push(curData);if(this.state.overlayCardId&&this.state.overlayCardId!=""){var curSource=data.slice();for(var key in curSource){var curdata=curSource[key];if(curdata.cardId==this.state.overlayCardId){var index=data.indexOf(curdata);data.splice(index,1);var pView=this.state.views[this.state.views.indexOf(curView)-1];pView&&pView.data.splice(pView.data.indexOf(curdata),1);break}}}this.setState({showGroupOnly:!this.state.showGroupOnly,selectedGroupCard:selectedGroupCard,mode:this.state.mode==="small"?"medium":"small",views:this.state.views,currentView:curView,currentDataSource:data,showMenu:false,overlayCardId:""});this.setScrollTopToZero()}else if(action=="CardView"&&curData){var curCardData=curData;this.handleCardClickEvent(cardId,curCardData,action);this.setScrollTopToZero()}else if(action=="Navigation")if(!CRMNow.CardUtils.isMOCAOffline()){if(cardData.cardName=="RELEVANT_NEWS"||cardData.cardName=="STOCK_ACTIVITY")this._getCCFContext().navigation.openUrl(decodeURIComponent(cardData.data.cardRelatedInfo.link));else if(cardData.data&&cardData.data.mailweblink)this._getCCFContext().navigation.openUrl(cardData.data.mailweblink);else if(args.entityName&&args.guid){this.navigateToEntity(args.entityName,args.guid);CRMNow.CardUtils.collapseLandingPage()}}else{var offlineText=CRMNow.CardUtils.getResources("Error_Message_Generic_Mobile_Client_Offline");Xrm.Utility.alertDialog(offlineText,null)}else if(action=="snooze")if(isGroupSwipe){if(cardData&&cardData.length>0)for(var i=0;i<3;i++){var card=cardData[i],curRecord=ccfContext.parameters.SubGrid.records[card.cardId];curRecord&&this.handleSnoozeEvent(card.cardId,isGroupSwipe,card.cardName)}}else{var curRecord=ccfContext.parameters.SubGrid.records[cardId];curRecord&&this.handleSnoozeEvent(cardId,isGroupSwipe,cardName)}else if(action=="dismiss")if(isGroupSwipe){if(cardData&&cardData.length>0)for(var i=0;i<3;i++){var card=cardData[i],curRecord=ccfContext.parameters.SubGrid.records[card.cardId];curRecord&&this.handleDismissEvent(card.cardId,isGroupSwipe,card.cardName)}}else{var curRecord=ccfContext.parameters.SubGrid.records[cardId];curRecord&&this.handleDismissEvent(cardId,isGroupSwipe,cardName)}else if(action=="MenuClick")this.setState({selectedGroupCard:selectedGroupCard,showMenu:showMenu});else if(action=="ActionClick"){if(curData){var curRecord=ccfContext.parameters.SubGrid.records[cardId];curRecord&&this.handleActionClickEvent(args,curData)}}else if(action=="appendCards"){if(this.randomIdentity&&randomIdentity&&this.randomIdentity==randomIdentity&&cardData&&cardData!=null&&Object.keys(cardData).length>0){if(this.additionalData[options.cardData.cardId])for(var keys=Object.keys(cardData),index=0;index<keys.length;index++)this.additionalData[options.cardData.cardId][keys[index]]=cardData[keys[index]];else this.additionalData[options.cardData.cardId]=cardData;this.forceUpdate()}}else if(action=="FetchFlightCards"){if(this.state.currentDataSource){for(var i=0;i<this.state.currentDataSource.length;i++)if(this.state.currentDataSource[i].cardId==args.cardId){args.meetingData&&this.state.currentDataSource[i].data.cardContextDetails.push(args.meetingData);args.nearByData&&this.state.currentDataSource[i].data.cardContextDetails.push(args.nearByData)}this.setState({currentDataSource:this.state.currentDataSource})}}else if(action=="SwipeCards")if(!args.reset)jQuery(ReactDOM.findDOMNode(this)).find(".carVwidth").not(jQuery(args.currentElement)).addClass("no-transistion");else jQuery(ReactDOM.findDOMNode(this)).find(".carVwidth").removeClass("no-transistion");else if(action=="GetDirections"){var context=this._getCCFContext();context.navigation.openMaps(args.address)}};CardFeedContainerMain.prototype.setScrollTopToZero=function(){jQuery(".landingPageActivities").scrollTop(0);jQuery(".pullToRefresher").scrollTop(0)};CardFeedContainerMain.prototype.handleActionClickEvent=function(args,cardData){if(args.actionData){var curCommand=null,context=this._getCCFContext(),commands=this.commandManager.getCommandByCardId(args.cardId),command=_.filter(commands,function(cmd){return cmd.command==args.actionData});if(command&&command.length>0){curCommand=command[0].command;this.globalPanelCloseCards[curCommand]&&this._getCCFContext().utils.fireEvent("close",{});this.addTelemetryForActionOnRAActionCard(cardData.cardtype,command[0].label);if(!command[0].execute())return}if(this.state.currentView.viewType!=="CardView"){if(curCommand&&cardData&&cardData.cardtype&&this.autoDissmissCards[cardData.cardtype]){var autoDismisscommands=this.autoDissmissCards[cardData.cardtype];if(autoDismisscommands.indexOf(curCommand)>-1){var index=this.state.currentDataSource.indexOf(cardData);this.state.currentDataSource.splice(index,1);var prevView=this.state.views[this.state.views.indexOf(this.state.currentView)-1];prevView&&prevView.data.splice(prevView.data.indexOf(cardData),1);this.setState({currentDataSource:this.state.currentDataSource,currentView:this.state.currentView,views:this.state.views})}else this.setState({currentDataSource:this.state.currentDataSource,currentView:this.state.currentView,views:this.state.views})}}else if(curCommand&&this.markcompleteCommands[curCommand])for(var i=0;i<this.state.currentDataSource.length;i++)this.state.currentDataSource[i].cardId==args.cardId&&this.setState({overlayCardId:args.cardId})}};CardFeedContainerMain.prototype.handleCardClickEvent=function(cardId,curData,action){var data=[],genData,curName=action,prevView=this.state.views[this.state.views.length-1],prevViewName=prevView.name.match(/[a-zA-Z]+|[0-9]+/g);if(prevViewName.length>1)curName=prevViewName[0]+ ++prevViewName[1];if(action=="CardView"&&curData){this.randomIdentity=Math.random().toString();var args=this.getArguments();args["cardData"]=curData;if(this.dataFactories[curData.cardName]&&this.dataFactories[curData.cardName].generateAdditionalData)this.dataFactories[curData.cardName].generateAdditionalData(curData,args);else!this.dataFactories[curData.cardName]&&this.dataFactories["Generic"].generateAdditionalData(curData,args)}var curView={name:curName,data:curData,viewType:action};this.state.views.push(curView);this.setState({mode:"medium",views:this.state.views,currentView:curView,currentDataSource:[curData],showMenu:false})};CardFeedContainerMain.prototype.handleDismissEvent=function(cardId,isGroupSwipe,cardName){var curSource=this.state.currentDataSource.slice(),listData=this.getContext().parameters.value.listData.slice(),commands=this.commandManager.getCommandByCardId(cardId),command=_.filter(commands,function(cmd){return cmd.command=="Mscrm.HomepageGrid.actioncard.DismissCommand"||cmd.commandId=="Mscrm.HomepageGrid.actioncard.DismissCommand"});if(command&&command.length>0){this.addTelemetryForActionOnRAActionCard(curSource[0].cardtype,command[0].label);if(!command[0].execute())return}if(isGroupSwipe)for(var key in curSource){var data=curSource[key];if(data.cardName==cardName){var index=this.state.currentDataSource.indexOf(data);this.state.currentDataSource.splice(index,1)}}else for(var key in curSource){var data=curSource[key];if(data.cardId==cardId){var index=this.state.currentDataSource.indexOf(data);this.state.currentDataSource.splice(index,1);var prevView=this.state.views[this.state.views.indexOf(this.state.currentView)-1];prevView&&prevView.data.splice(prevView.data.indexOf(data),1);break}}if(this.state.currentDataSource.length==0)if(this.state.currentView.viewType!="Main"){this.state.views.pop();this.state.currentView=this.state.views[this.state.views.length-1];this.state.currentDataSource=this.state.currentView.data}this.setState({showSnooze:false,showDismiss:true,swipeId:cardId,showMenu:false,currentDataSource:this.state.currentDataSource,currentView:this.state.currentView,views:this.state.views})};CardFeedContainerMain.prototype.handleSnoozeEvent=function(cardId,isGroupSwipe,cardName){var curSource=this.state.currentDataSource.slice(),commands=this.commandManager.getCommandByCardId(cardId),command=_.filter(commands,function(cmd){return cmd.command=="Mscrm.HomepageGrid.actioncard.SnoozeCommand"||cmd.commandId=="Mscrm.HomepageGrid.actioncard.SnoozeCommand"});if(command&&command.length>0){this.addTelemetryForActionOnRAActionCard(curSource[0].cardtype,command[0].label);if(!command[0].execute())return}if(isGroupSwipe)for(var key in curSource){var data=curSource[key];if(data.cardName==cardName){var index=this.state.currentDataSource.indexOf(data);this.state.currentDataSource.splice(index,1)}}else for(var key in curSource){var data=curSource[key];if(data.cardId==cardId){var index=this.state.currentDataSource.indexOf(data);this.state.currentDataSource.splice(index,1);var prevView=this.state.views[this.state.views.indexOf(this.state.currentView)-1];prevView&&prevView.data.splice(prevView.data.indexOf(data),1);break}}if(this.state.currentDataSource.length==0)if(this.state.currentView.viewType!="Main"){this.state.views.pop();this.state.currentView=this.state.views[this.state.views.length-1];this.state.currentDataSource=this.state.currentView.data}this.setState({showSnooze:true,showDismiss:false,swipeId:cardId,showMenu:false,currentDataSource:this.state.currentDataSource,currentView:this.state.currentView,views:this.state.views})};CardFeedContainerMain.prototype.handleKeyDownPress=function(evt,cardName,keyEvent){var globalPanelCardIdSuffix=this.isGlobalPanelEnabled?" globalPanelId":"";if(keyEvent.keyCode==40){var firstCard=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+globalPanelCardIdSuffix+"']")[0];this.getFirstCardElement(firstCard,globalPanelCardIdSuffix,true)}else if(keyEvent.keyCode==38){var allElementCards=jQuery("div[class^=cardFeedContainer_]").find("li[class='carVwidth groupcard-spacing"+globalPanelCardIdSuffix+"']");this.getFirstCardElement(allElementCards[allElementCards.length-1],globalPanelCardIdSuffix,true)}keyEvent.keyCode==13&&this.handleBackButtonClick.call(null,cardName,evt)};CardFeedContainerMain.prototype.handleBackButtonClick=function(cardName,evt){var mode=this.state.currentDataSource.mode==="small"?"medium":"small";this.isBackButtonClicked=true;this.updateCardFeedContainer&&this.updateCardFeedContainer("backViewClick",{cardId:this.state.currentDataSource.cardId,mode:mode})};CardFeedContainerMain.prototype.handleEmptyClickEvent=function(evt){};CardFeedContainerMain.prototype.executeCommand=function(command){var shouldContinue=true;if(command&&command!=null)if(!CRMNow.CardUtils.isMOCAOffline())command.execute();else{var offlineText=CRMNow.CardUtils.getResources("Error_Message_Generic_Mobile_Client_Offline");Xrm.Utility.alertDialog(offlineText,null);shouldContinue=false}return shouldContinue};CardFeedContainerMain.prototype.renderCardFeedContainer=function(dataSource,args){var _this=this,els=[];args.isGlobalPanelEnabled=this.isGlobalPanelEnabled;if(this._getCCFContext().mode&&!this._getCCFContext().mode.isOffline)if(dataSource.length>0){var that=this,groupedData=this.groupData(args.currentDataSource),hasGroup=CRMNow.CardUtils.checkWhetherGroupPresent(groupedData),sortedGroupData=groupedData,groupKeys=Object.keys(groupedData);if(groupKeys.length>0){var groupData=groupedData[groupKeys[0]];Mscrm.ActionCardDefaultFocusId=groupData[0].cardId}if(args.currentView.viewType=="CardView"&&args.currentDataSource.length>0){var genData;args.showSnooze=false;args.showDismiss=false;args.showIcon=true;els=args.currentDataSource.map(function(card,index){args["key"]=card.cardId;args["cardActionData"]=_this.getActionData(card);if(card.cardRelatedInfo!=null&&card.data.cardRelatedInfo!=undefined)if(Object.keys(card.data.cardRelatedInfo).length>0)args.canShowDetailsView=true;else args.canShowDetailsView=false;else args.canShowDetailsView=false;var cardTypeArray=card.cardName.split(":");if(cardTypeArray.length>1)if(cardTypeArray[1].trim()==="ACTIVITY_MEETING")args["showMap"]=true;else if(cardTypeArray[1].trim()==="UPCOMING_MEETING")args["showMap"]=true;else args["showMap"]=false;args["cardData"]=card;if(args["overlayCardId"]==card.cardId)args["showSuccessCardOverlay"]=true;else args["showSuccessCardOverlay"]=false;if(_this.dataFactories[card.cardName])genData=_this.dataFactories[card.cardName].generateDetailsViewData(card,args);else genData=_this.dataFactories["Generic"].generateDetailsViewData(card,args);if(genData)return _this.renderMainView(genData,args)})}else if(args.currentView.viewType=="GroupView"){args.showSnooze=true;args.showDismiss=true;args.mode="medium";els=args.currentDataSource.map(function(card,index){args["key"]=card.cardId;args["showMenu"]=true;args["cardActionData"]=_this.getActionData(card);if(args["overlayCardId"]==card.cardId)args["showSuccessCardOverlay"]=true;else args["showSuccessCardOverlay"]=false;if(card.data!=null&&card.data.cardRelatedInfo!=null&&card.data.cardRelatedInfo!=undefined)if(Object.keys(card.data.cardRelatedInfo).length>0)args.canShowDetailsView=true;else args.canShowDetailsView=false;else args.canShowDetailsView=false;if(card.cardName==="ATTENDEE"){args.showDismiss=false;args.showSnooze=false;args.showIcon=true;args["showMenu"]=false;return _this.dataFactories["TOP_PEOPLE"].generateCardContainer(card,false,args)}else if(_this.dataFactories[card.cardName]){if(card.cardName==="NEARBY_CUSTOMERS"||card.cardName=="TOP_PEOPLE"||card.cardName=="TOP_RECORD"){args.showDismiss=false;args.showSnooze=false;args.canShowDetailsView=false;args.showIcon=true;args["showMenu"]=false}return _this.dataFactories[card.cardName].generateCardContainer(card,false,args)}else return _this.dataFactories["Generic"].generateCardContainer(card,false,args)})}else if(sortedGroupData){args.showSnooze=true;args.showDismiss=true;els.push(this.renderMainView(sortedGroupData,args))}return els}else{var noCardsTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.Common.NoCardsTitle"),noCardsText=CRMNow.CardUtils.getResources("ActionCard.CFC.Common.NoCardsText"),noCardsErrorDesc=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsText",className:"noCardsText"},noCardsText),noCardsIcon=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsIcon",className:"noCardsimg"}),noCardsTitle=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsTitle",className:"noCardsTitle"},noCardsTitle),noCards=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsDesc",className:"noCardsDesc"},[noCardsIcon,noCardsTitle,noCardsErrorDesc]),noCardsContainer=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsContainer",className:"noCardsContainer"},[noCards]);return noCardsContainer}else{var noCardsIcon=Mscrm.Controls.VDOM.div(this.getContext(),{key:"offlineCardsimg",className:"offlineCardsimg"}),noCardsTitle=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsTitle",className:"noCardsTitle"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.OfflineTitle")),noCardsErrorDesc=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsText",className:"noCardsText"},CRMNow.CardUtils.getResources("ActionCard.CFC.Common.OfflineDescription")),noCards=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsDesc",className:"noCardsDesc"},[noCardsIcon,noCardsTitle,noCardsErrorDesc]),noCardsContainer=Mscrm.Controls.VDOM.div(this.getContext(),{key:"noCardsContainer",className:"noCardsContainer"},[noCards]);return noCardsContainer}};CardFeedContainerMain.prototype.renderMainView=function(groupedData,args){var _this=this,els=[],curIndex=0,hasGroup=CRMNow.CardUtils.checkWhetherGroupPresent(groupedData),groupKeys=Object.keys(groupedData);args.isGlobalPanelEnabled=this.isGlobalPanelEnabled;for(var index=0;index<groupKeys.length;index++){var groupData=groupedData[groupKeys[index]];if(index==0)Mscrm.ActionCardDefaultFocusId=groupData[0].cardId;if((groupKeys[index]=="TOP_PEOPLE"||groupKeys[index]=="TOP_RECORD")&&groupData.length<3)continue;if(groupKeys[index]==="REGARDING"||groupKeys[index]==="TOP_RECORD"||groupKeys[index]==="TOP_PEOPLE"||groupKeys[index]==="MAP"||groupKeys[index]==="STOCK_ACTIVITY")args["canNavigate"]=false;else if(groupKeys[index]=="ATTENDEE"||groupKeys[index]=="NEARBY_CUSTOMERS"||groupKeys[index]=="RELEVANT_NEWS")if(groupData.length>3)args["canNavigate"]=true;else args["canNavigate"]=false;else args["canNavigate"]=true;if((groupData.length>2||args.currentView.viewType==="CardView")&&(groupKeys[index]!="UPCOMING_MEETING"&&groupKeys[index]!="UPCOMING_FLIGHT")){args["groupType"]=groupKeys[index];if(args.currentView.viewType=="CardView"){args.canShowDetailsView=false;args.showIcon=true;if(index==0){args.mode="medium";args["showGroupCardHeader"]=false}else{args.mode="small";args["showGroupCardHeader"]=true}}else{args.mode="small";args["showGroupCardHeader"]=true;args.canShowDetailsView=true}var softTitle=groupData[0].softTitle;if(groupData[0].cardName!=null&&groupData[0].cardName!="")if(groupData[0].cardName!="STOCK_ACTIVITY")if(groupData[0].softTitle.indexOf(":")!=-1){var softTitleAry=groupData[0].softTitle.split(":");if(softTitleAry.length>1)softTitle=softTitleAry[0]}args["getActionData"]=this.getActionData;args["groupTitle"]=softTitle;args["key"]="GroupView"+index;els.push(this.dataFactories["GroupView"].generateCardContainer(groupData,args))}else{var cards=groupData.map(function(card,index){args.mode="medium";if(_this.getActionData(card))args["cardActionData"]=_this.getActionData(card);else args["cardActionData"]="ActionsNotAvailable";if(args["overlayCardId"]==card.cardId)args["showSuccessCardOverlay"]=true;else args["showSuccessCardOverlay"]=false;if(card.cardName=="UPCOMING FLIGHT")args.canShowDetailsView=true;if(card.cardName=="UPCOMING_MEETING")args.showMap=true;if(card.cardName=="TOP_PEOPLE"||card.cardName=="TOP_RECORD"){args.showSnooze=false;args.showDismiss=false}if(card.actioncardid!=undefined)args["key"]=card.actioncardid.toString();else args["key"]=card.cardName;args["showMenu"]=true;if(_this.dataFactories[card.cardName])return _this.dataFactories[card.cardName].generateCardContainer(card,false,args);else return _this.dataFactories["Generic"].generateCardContainer(card,false,args)});els.push(cards)}}return els};CardFeedContainerMain.prototype.renderCardHeader=function(item){var headers=[],headerContent,headerText="";if(this.state.currentView.viewType=="GroupView")if(item.softTitle.indexOf(":")!=-1){var softTitleArray=item.softTitle.split(":");if(softTitleArray.length>0)if(softTitleArray[0]!=undefined&&softTitleArray[0]!=""&&softTitleArray[0].length>0)headerText=softTitleArray[0];else headerText=item.softTitle}else headerText=item.softTitle;else headerText=item.originalTitle==null||item.originalTitle==undefined?"":item.originalTitle;var grpCardSummaryTitle=Mscrm.Controls.VDOM.div(this.getContext(),{key:"grpCardSummaryTitle",className:"groupcard-primaryTitle-expanded"},headerText.toLowerCase()),headerbackicon=Mscrm.Controls.VDOM.div(this.getContext(),{key:"headerbackicon",className:"CRMMDL2 icon-backarrow"+(this.isGlobalPanelEnabled?" globalPanelId":""),tabIndex:Mscrm.actioncardTabIndex,title:CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.BackButton_Label"),"aria-label":CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.BackButton_Label"),onKeyDown:this.handleKeyDownPress.bind(null,this,headerText),onClick:this.handleBackButtonClick.bind(null,this,headerText)}),headerPipeicon=Mscrm.Controls.VDOM.div(this.getContext(),{key:"headerpipeicon",className:"CRMMDL2 icon-pipe"+(this.isGlobalPanelEnabled?" globalPanelId":"")}),imgDiv=Mscrm.Controls.VDOM.div(this.getContext(),{key:"headerbackiconDiv",className:"backandpipeIconsDiv"},[headerbackicon,headerPipeicon]);headers.push(imgDiv);headers.push(grpCardSummaryTitle);headerContent=Mscrm.Controls.VDOM.div(this.getContext(),{key:"headerContent",className:"groupcard-header-expanded"},headers);var header=Mscrm.Controls.VDOM.div(this.getContext(),{key:"header",className:"groupcard-header"},headerContent),container=Mscrm.Controls.VDOM.div(this.getContext(),{},[header]);return container};CardFeedContainerMain.prototype.groupData=function(dataSource){var groupedData=_.groupBy(dataSource,function(data){if(data.cardName.indexOf(":")!=-1){var cardTypeArray=data.cardName.split(":");if(cardTypeArray.length>0)if(cardTypeArray[0]!=undefined&&cardTypeArray[0]!=""&&cardTypeArray[0].length>0)return cardTypeArray[0];else return data.cardName;else return data.cardName}else return data.cardName});return groupedData};CardFeedContainerMain.prototype.getArguments=function(){var options={showGroupOnly:false,mode:"small",selectedGroupCard:"",canShowDetailsView:true,showSnooze:false,showDismiss:false,swipeId:"",showMenu:false,overlayCardId:"",showIcon:false,currentDataSource:this.getContext().parameters.value.listData,currentView:{name:"Step1",data:this.getContext().parameters.value.listData,viewType:"Main"},views:[{name:"Step1",data:this.getContext().parameters.value.listData,viewType:"Main"}],callbackContainer:this.updateCardFeedContainer,randomIdentity:this.randomIdentity,snoozetime:"Snooze for 12 hr",dismiss:"Dismiss",additionalData:this.additionalData,getReferenceTokenData:this.getReferenceTokenData,key:"",isGlobalPanelEnabled:false,commandManager:this.commandManager};_.extend(options,this.state);return options};CardFeedContainerMain.prototype.onRender=function(){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_onRender");stopwatch.start();var cards=[],header,options=this.getArguments();if(this.state.currentView.viewType!="Main"){var data=this.state.currentDataSource;if(data.length>0)data=data[0];cards.push(this.renderCardHeader(data))}var ariaDescribed=Mscrm.Controls.VDOM.div(this.getContext(),{id:"ariaNavigationTextId",pointerDown:this.handleEmptyClickEvent.bind(null,this),className:"display-none"},[CRMNow.CardUtils.getResources("ActionCard.RelationshipAssistance.Navigation_AccessibilityText")]),ariaToolTip=Mscrm.Controls.VDOM.div(this.getContext(),{id:"ariaToolTipId",className:"display-none"},[MscrmCommon.ControlUtils.String.Empty]),CFCList=Mscrm.Controls.VDOM.ul(this.getContext(),{key:"cardFeedList",className:"cardFeedList","aria-label":CRMNow.CardUtils.getResources("RI_FCB_Card_Header"),"aria-describedby":"ariaNavigationTextId"},[cards,this.renderCardFeedContainer(this.getContext().parameters.value.listData,options)]),CFCContainer=Mscrm.Controls.VDOM.div(this.getContext(),{key:"CFCContainer",className:Mscrm.isRTL?"cardFeedContainer_ccrtl":"cardFeedContainer_ccltr",ref:"cardFeedContainer",onScroll:this.handleScroll.bind(null,this)},[ariaDescribed,ariaToolTip,CFCList]);this.setDefaultFocus();stopwatch.stop();return CFCContainer};return CardFeedContainerMain}(Mscrm.Controls.VirtualComponentBase);CRMNow.CardFeedContainerMain=CardFeedContainerMain})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var CardService;(function(CardService){CardService.CrmSoapServiceCall="CrmSoapServiceCall";CardService.staticStockId="2DC1CA86-7141-4B02-8050-7A07973B8468";CardService.staticNewsId="4A5DD3AA-BA13-417F-959A-B94875803BC2";CardService.staticNearbyCustomersId="0E8288AA-A9DC-4FAF-AF7A-AEA6E9E4E757";CardService.staticRegardingId="CAC83683-0E44-4FDE-8951-A3FFDC702861";CardService.staticUpcomingMeeting="CAC83683-0E44-4FDE-8951-A3FFDC702861";CardService.geocodeRequest=window.location.href.toLocaleLowerCase().indexOf("https://")!=-1?"https://dev.virtualearth.net/REST/v1/Locations?query={0}&key={1}":"http://dev.virtualearth.net/REST/v1/Locations?query={0}&key={1}";function getCurrentUserId(){var userId=CRMNow.CardUtils.ccfContext.userSettings.userId;return userId.substr(1,userId.length-2)}function callPopulateCards(callback){var userId=getCurrentUserId();if(userId!=null){var r=new RelationshipAssitantSdkContracts.PopulateCardRequest(userId),genericRequest=r,deferred=CRMNow.CardUtils.ccfContext.webAPI.execute(genericRequest);deferred.then(function(){},function(e){console.error(e)})}else console.error("UserId cannot be null")}CardService.callPopulateCards=callPopulateCards;function getStocksData(parameterInfo,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetStocksData");stopwatch.start();var json=JSON.stringify(parameterInfo),deferred1=retrieveCardData(CardService.staticStockId,json);deferred1.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.Data),today=new Date;data=data.map(function(curCardData){var publishedDate=moment(moment(curCardData.Data.cardRelatedInfo.Ld,"DD-MM-YYYY").format("MM/DD/YYYY")+" "+curCardData.Data.cardRelatedInfo.Lt),publishedDateCalculated=moment(publishedDate).toDate(),dat=publishedDateCalculated.localeFormat("MMM dd")+" "+publishedDateCalculated.localeFormat("t")+" "+curCardData.Data.cardRelatedInfo.tz,softTitle=MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.CFC.GroupCard.Stock.SoftTitle"),[dat]),cardData={};cardData.cardId=curCardData.CardId;cardData.cardName="STOCK_ACTIVITY";cardData.data=curCardData.Data;cardData.description=curCardData.Description;cardData.expiryDate=curCardData.ExpiryDate;cardData.priority=curCardData.Priority;cardData.softTitle=softTitle;cardData.startDate=curCardData.StartDate;cardData.title=curCardData.Title;cardData.visibility=curCardData.Visibility;return cardData});args.callbackContainer("appendCards",{cardData:_.groupBy(data,"cardName"),randomIdentity:args.randomIdentity,options:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});return deferred1}CardService.getStocksData=getStocksData;function getNewsData(parameterInfo,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetNewsData");stopwatch.start();var json=JSON.stringify(parameterInfo),deferred2=retrieveCardData(CardService.staticNewsId,json);deferred2.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.Data),today=moment(new Date);data=data.map(function(curCardData){var publishedDate=moment(new Date(curCardData.Data.cardRelatedInfo.publishedDate)),duration=moment.duration(today.diff(publishedDate)),refreshTime="";if(duration.days()>0)refreshTime=duration.days().toString()+"d";else refreshTime=duration.hours().toString()+"h "+duration.minutes().toString()+"m";var softTitle=MscrmCommon.ControlUtils.String.Format(CRMNow.CardUtils.getResources("ActionCard.CFC.GroupCard.News.SoftTitle"),refreshTime),cardData={};cardData.cardId=curCardData.CardId;cardData.cardName="RELEVANT_NEWS";cardData.data=curCardData.Data;cardData.description=curCardData.Description;cardData.expiryDate=curCardData.ExpiryDate;cardData.priority=curCardData.Priority;cardData.softTitle=softTitle;cardData.startDate=curCardData.StartDate;cardData.title=curCardData.Title;cardData.visibility=curCardData.Visibility;cardData.summaryText="Updated "+refreshTime+" ago";return cardData});args.callbackContainer("appendCards",{cardData:_.groupBy(data,"cardName"),randomIdentity:args.randomIdentity,options:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});return deferred2}CardService.getNewsData=getNewsData;function getNearbyCustomers(address,bingMapsApiKey,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetNearByCustomers");stopwatch.start();if(!CRMNow.CardUtils.isCCFMode())return null;var jQuery=$,resultDeferred=jQuery.Deferred(),userId=getCurrentUserId();CardService.callLocationService(address,bingMapsApiKey).then(function(r){if(r.status){var data=r.data;if(data!=undefined&&data!=null&&data.resourceSets.length>0&&data.resourceSets[0].resources){var resources=data.resourceSets[0].resources,address=resources[0].address,city=address.locality,state=address.adminDistrict,json=JSON.stringify({userId:userId,city:city,stateOrProvince:state}),deferred2=retrieveCardData(CardService.staticNearbyCustomersId,json);deferred2.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.Data);data=data.map(function(curCardData,index){var cardData={};cardData.cardId=curCardData.CardId+index;cardData.cardName="NEARBY_CUSTOMERS";cardData.data=curCardData.Data;cardData.description=curCardData.Description;cardData.expiryDate=curCardData.ExpiryDate;cardData.priority=curCardData.Priority;cardData.softTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.GroupCard.NearbyCustomers.SoftTitle");cardData.startDate=curCardData.StartDate;cardData.title=curCardData.Title;cardData.visibility=curCardData.Visibility;return cardData});args.callbackContainer("appendCards",{cardData:_.groupBy(data,"cardName"),randomIdentity:args.randomIdentity,options:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});resultDeferred.resolve(true)}else resultDeferred.resolve(false)}else resultDeferred.resolve(false)},function(e){stopwatch.stop();console.error(e)});return resultDeferred}CardService.getNearbyCustomers=getNearbyCustomers;function getRegardingData(parameterInfo,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetMeetingRegardingData");stopwatch.start();var json=JSON.stringify(parameterInfo),deferred2=retrieveCardData(CardService.staticRegardingId,json);deferred2.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.Data),regData=[];for(var key in data){var curCardData=data[key];if(curCardData.Title!=null){var cardData={};cardData.cardId=curCardData.CardId+Object.keys(data).indexOf(key);cardData.cardName=curCardData.CardName;cardData.data=curCardData.Data;cardData.description=CRMNow.CardUtils.getResources(curCardData.Description);cardData.expiryDate=curCardData.ExpiryDate;cardData.priority=curCardData.Priority;cardData.softTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingMeeting.RegardingText");cardData.startDate=curCardData.StartDate;cardData.title=curCardData.Title;cardData.visibility=curCardData.Visibility;if(!curCardData.RegardingObjectId&&curCardData.Data.cardContextDetails&&curCardData.Data.cardContextDetails.length>0){var contextObject=curCardData.Data.cardContextDetails[0].contextObject;cardData.regardingobjectid={LogicalName:contextObject.entityName,Id:contextObject.guid}}regData.push(cardData)}}args.callbackContainer("appendCards",{cardData:_.groupBy(regData,"cardName"),randomIdentity:args.randomIdentity,options:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});return deferred2}CardService.getRegardingData=getRegardingData;function getFlightRegardingData(parameterInfo,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetUpcomingFlightData");stopwatch.start();var json=JSON.stringify(parameterInfo),deferred2=retrieveCardData(CardService.staticRegardingId,json);deferred2.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.data);data=data.map(function(curCardData,index){var cardData={};cardData.cardId=curCardData.CardId+index;cardData.cardName=curCardData.CardName;cardData.data=curCardData.Data;cardData.description=curCardData.Description;cardData.expiryDate=curCardData.ExpiryDate;cardData.priority=curCardData.Priority;cardData.softTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingFlight.Meeting.SoftTitle");cardData.startDate=curCardData.StartDate;cardData.title=curCardData.Title;cardData.visibility=curCardData.Visibility;return cardData});args.callbackContainer("appendCards",{cardData:_.groupBy(data,"cardName"),args:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});return deferred2}CardService.getFlightRegardingData=getFlightRegardingData;function getAttendeesData(parameterInfo,args){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetMeetingAttendeeData");stopwatch.start();var json=JSON.stringify(parameterInfo),deferred2=retrieveCardData(CardService.staticRegardingId,json);deferred2.then(function(res){res.json().then(function(odataResponse){var data=JSON.parse(odataResponse.Data),attData=[];if(args.detailsView)if(data.cardRelatedInfo&&data.cardRelatedInfo.attendees)for(var i in data.cardRelatedInfo.attendees){var curAttendee=data.cardRelatedInfo.attendees[i],cardData={};cardData.mode="small";cardData.cardData=args.cardData;cardData.cardId="ATTENDEE"+i.toString();cardData.cardName="ATTENDEE";cardData.softTitle=CRMNow.CardUtils.getResources("ActionCard.CFC.UpcomingMeeting.AttendeesText");cardData.title=curAttendee.contextPrimaryInfo.title;cardData.description=curAttendee.contextPrimaryInfo.description;cardData.cardTypeIcon=curAttendee.contextIcon;cardData.cardOptionIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAHRJREFUWIXtlDEOgDAMAw/E1K3iC3yGF/Oqio21LGZgTIuAwTfVkdpaSWQw5mOGjrszkHQ+gPKmgRnYgCxdgBXYow9NjQaSPl+kq2phA2Ojgcdo7cA18ypdVAvTs4SZ+xKG22/AOeAccA4Y54BzwDlgzA84AVMHKhzbfPhRAAAAAElFTkSuQmCC";cardData.groupBackIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAArCAYAAAAUo/pwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAIgSURBVFhH7ZZNSxtBGMf/k0w2b7a0pYYepCZ4qFBb2kNV0B76GVoQvRUVT578BH4DQT0qKIgfoMcei5Q2KlLvvtCglECTaJLVJDvxmbBCKWJm4iwssr/LLuwy+5vnZfZhTQI+hF1Uzv0pdrD33Z9iR/tZX4qF3KvvCMR0CcR0CcR0ub9ijLk3hrmTWCTMcFJycNloGhfsWCzGGXZzNcx/LeO44IAbLoqOlouSVPZ3DYtbVYy9iSPzhKMh3IeG0BaTUtuu1MTbOEbTFiwOmJ7qtMRaUpS+JZIaJ6kRj6QkymIWSe2Q1LKbvvcZ76QkSvNYmPT3T+tY27bx6XUcH/oscOrI9lM5gyOasKlrZQ3qNK6SWI6OhLkvZ3Q0CLx8xhGiL6hEqkZSL7o5Pr6KoT8VQd1RD6+SWOlCYOFbBVtHdUwPJRANA/TNtkiPp8kQBmgzqa4QRc99oICSmIzQn3OBzT2b0sowO5JA0qI0KcgJkqnRiyob+RflmV+e8rliA6tZu3W4zgwn8CAma8h9wTDKXSnro+cRx+d3cVTrAis/qyjZzVZjeIHWslLuOclNDiZQpLpb37FR8EhOe0lZL72POaZILl9xsLFrI18WoEwbpaO9ymkiTf9H2aFnFLnypfnpQrn4b8KiMP2tCsQizB/TxTUyrQ+pMyN+qLH/kedTxyG/BQ/2aoZATJdATJdATJdATJdATBd2+OuHF7+6OwJcAfQP04PXKjyQAAAAAElFTkSuQmCC";cardData.data={cardContextDetails:[curAttendee]};attData.push(cardData)}args.callbackContainer("appendCards",{cardData:args.detailsView?_.groupBy(attData,"cardName"):data,randomIdentity:args.randomIdentity,options:args});stopwatch.stop()})},function(e){stopwatch.stop();console.error(e)});return deferred2}CardService.getAttendeesData=getAttendeesData;function callLocationService(address,bingMapsApiKey){var stopwatch=CRMNow.CardUtils.createPerformanceStopwatch("CardFeedContainer_GetCallLocationService");stopwatch.start();var jQuery=$,deferred=jQuery.Deferred();if(address&&bingMapsApiKey&&address!=""&&bingMapsApiKey!=""){var request=MscrmCommon.ControlUtils.String.Format(CardService.geocodeRequest,encodeURIComponent(address),bingMapsApiKey);$.ajax({url:request,dataType:"jsonp",jsonp:"jsonp",success:function(r){deferred.resolve({status:true,error:null,data:r});stopwatch.stop()},error:function(e){deferred.resolve({status:false,error:e,data:null});stopwatch.stop()}})}else deferred.resolve({status:false,error:"No address or bingMapsApiKey specified",data:null});return deferred}CardService.callLocationService=callLocationService;function retrieveCardData(guid,data){data=data.replace(/"/g,'\\"');var r=new RelationshipAssitantSdkContracts.RetrieveCardDataRequest(guid,data),genericRequest=r,deferred=CRMNow.CardUtils.ccfContext.webAPI.execute(genericRequest);return deferred}})(CardService=CRMNow.CardService||(CRMNow.CardService={}))})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var ActionCommandsManager=function(){function ActionCommandsManager(){this._context={};this.commandFetchCompleted=false;this.callbackQueue=[];this.fetchIsInprogress=false;this.fetchCounter=0;this.actionCommands={}}ActionCommandsManager.init=function(context){var manager=new ActionCommandsManager;manager._context=context;ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.Open"]="Mscrm.HomepageGrid.actioncard.Open";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.OpenEmailCommand"]="Mscrm.HomepageGrid.actioncard.OpenEmail";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.OpenEmailCommand"]="Mscrm.HomepageGrid.actioncard.OpenEmail";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CreateNewMeetingCardCommand"]="Mscrm.HomepageGrid.actioncard.CreateNewMeetingCard";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CreateNewMeetingCardCommand"]="Mscrm.HomepageGrid.actioncard.CreateNewMeetingCard";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.CreateEmailReplyDraftCommand"]="Mscrm.HomepageGrid.actioncard.Yes";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.CreateEmailReplyDraftCommand"]="Mscrm.HomepageGrid.actioncard.No";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.SendEmailWebClientCommand"]="Mscrm.HomepageGrid.actioncard.SendEmailWebClient";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.DoThisAutomaticallyCommand"]="Mscrm.HomepageGrid.actioncard.DoThisAutomatically";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.DoThisAutomaticallyCommand"]="Mscrm.HomepageGrid.actioncard.DoThisAutomatically";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.AddAsStakeHolderCommand"]=["Mscrm.HomepageGrid.actioncard.AddAsStakeHolder","Mscrm.SubGrid.actioncard.AddAsStakeHolder"];ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CallCommand"]="Mscrm.HomepageGrid.actioncard.Call";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenRecipientCommand"]="Mscrm.HomepageGrid.actioncard.OpenRecipient";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompletePhoneCallCommand"]="Mscrm.HomepageGrid.actioncard.CompletePhoneCall";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompletePhoneCallCommand"]="Mscrm.HomepageGrid.actioncard.CompletePhoneCall";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CloseTaskCommand"]="Mscrm.HomepageGrid.actioncard.CloseTask";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CloseTaskCommand"]="Mscrm.HomepageGrid.actioncard.CloseTask";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompleteTaskCommand"]="Mscrm.HomepageGrid.actioncard.CompleteTask";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompleteTaskCommand"]="Mscrm.HomepageGrid.actioncard.CompleteTask";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.UpdateContactOrLeadCommand"]="Mscrm.HomepageGrid.actioncard.UpdateContactOrLead";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.ConvertToOpportunityCommand"]="Mscrm.HomepageGrid.actioncard.ConvertToOpportunity";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.ConvertToCaseCommand"]="Mscrm.HomepageGrid.actioncard.ConvertToCase";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.ClosePhoneCallCommand"]="Mscrm.HomepageGrid.actioncard.ClosePhoneCall";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.ClosePhoneCallCommand"]="Mscrm.HomepageGrid.actioncard.ClosePhoneCall";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.ReplyCommand"]="Mscrm.HomepageGrid.actioncard.Reply";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.AddAsCompetitorCommand"]=["Mscrm.HomepageGrid.actioncard.AddAsCompetitor","Mscrm.SubGrid.actioncard.AddAsCompetitor"];ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.SnoozeCommand"]="Mscrm.HomepageGrid.actioncard.Snooze";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.SnoozeCommand"]="Mscrm.SubGrid.actioncard.Snooze";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.DismissCommand"]="Mscrm.HomepageGrid.actioncard.Dismiss";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.DismissCommand"]="Mscrm.SubGrid.actioncard.Dismiss";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenEmailWebClientCommand"]="Mscrm.HomepageGrid.actioncard.OpenEmailWebClient";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.TakeNotesCommand"]="Mscrm.HomepageGrid.actioncard.TakeNotes";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.TakeNotesCommand"]="Mscrm.HomepageGrid.actioncard.TakeNotes";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.SendEmailCommand"]="Mscrm.HomepageGrid.actioncard.SendEmail";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.SendEmailCommand"]="Mscrm.HomepageGrid.actioncard.SendEmail";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CreateCaseCommand"]=["Mscrm.HomepageGrid.actioncard.CreateCase","Mscrm.SubGrid.actioncard.CreateCase"];ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CreateCaseCommandSolution"]="Mscrm.SubGrid.actioncard.CreateCase";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand"]="Mscrm.HomepageGrid.actioncard.CompleteOtherActivity";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompleteOtherActivityCommand"]="Mscrm.HomepageGrid.actioncard.CompleteOtherActivity";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CancelOtherActivityCommand"]="Mscrm.HomepageGrid.actioncard.CancelOtherActivity";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CancelOtherActivityCommand"]="Mscrm.HomepageGrid.actioncard.CancelOtherActivity";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.GotItActionCommand"]="Mscrm.HomepageGrid.actioncard.GotItAction";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.GotItActionCommand"]="Mscrm.HomepageGrid.actioncard.GotItAction";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.SkypeMeetingCommand"]="Mscrm.HomepageGrid.actioncard.SkypeMeetingAction";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.SkypeMeetingCommand"]="Mscrm.HomepageGrid.actioncard.SkypeMeetingAction";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.PhoneCallCommand"]="Mscrm.HomepageGrid.actioncard.PhoneCallAction";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.EmailAttendeesCommand"]="Mscrm.HomepageGrid.actioncard.EmailAttendeesAction";ActionCommandsManager.buttonCommandMap["Mscrm.Modern.EmailAttendeesCommand"]="Mscrm.HomepageGrid.actioncard.EmailAttendeesAction";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenOpportunity"]=["Mscrm.HomepageGrid.actioncard.OpenOpportunity","Mscrm.SubGrid.actioncard.OpenOpportunity"];ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenEmailView"]=["Mscrm.HomepageGrid.actioncard.OpenEmailView","Mscrm.SubGrid.actioncard.OpenEmailView"];ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenAppointmentView"]="Mscrm.HomepageGrid.actioncard.OpenAppointment";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenRecipientView"]="Mscrm.HomepageGrid.actioncard.OpenRecipientView";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.OpenRecipientView"]="Mscrm.HomepageGrid.actioncard.OpenRecipientView";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.CompleteExchangeTaskCommand"]="Mscrm.HomepageGrid.actioncard.CompleteExchangeTask";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.EmailAttendeesWeb"]="Mscrm.HomepageGrid.actioncard.EmailAttendeesWeb";ActionCommandsManager.buttonCommandMap["Mscrm.HomepageGrid.actioncard.Open"]="Mscrm.HomepageGrid.actioncard.Open";return manager};ActionCommandsManager.prototype.fetchCommands=function(index,callback){var _this=this,commands,self=this;if(this.fetchIsInprogress&&index==0)this.callbackQueue.push(callback);else{this.commandFetchCompleted=false;this.fetchIsInprogress=true;var keys=Object.keys(this._context.parameters.SubGrid.records);if(keys.length>0){var curRecord=this._context.parameters.SubGrid.records[keys[index]];if(curRecord){var commandList=[];if(curRecord.actions==null||curRecord.actions==undefined)commandList=[];else{if(curRecord.actions.WebClient!=null||curRecord.actions.WebClient!=undefined){var vals=Object.keys(curRecord.actions.WebClient.Actions).map(function(key){return curRecord.actions.WebClient.Actions[key]});commandList=commandList.concat(vals)}if(curRecord.actions.Mobile!=null||curRecord.actions.Mobile!=undefined){var vals=Object.keys(curRecord.actions.Mobile.Actions).map(function(key){return curRecord.actions.Mobile.Actions[key]});commandList=commandList.concat(vals)}}var buttonList=[];for(var i in commandList){if(ActionCommandsManager.buttonCommandMap[commandList[i]]==undefined){buttonList=[];break}buttonList=buttonList.concat(ActionCommandsManager.buttonCommandMap[commandList[i]])}if(buttonList.length>0){buttonList=buttonList.concat(["Mscrm.HomepageGrid.actioncard.Snooze","Mscrm.SubGrid.actioncard.Snooze","Mscrm.SubGrid.actioncard.Dismiss","Mscrm.HomepageGrid.actioncard.Dismiss"]);buttonList=$.unique(buttonList)}this._context.parameters.SubGrid.retrieveRecordCommand(curRecord.getValue("actioncardid").toString(),buttonList).then(function(data){_this.actionCommands[curRecord.getValue("actioncardid").toString()]=data;if(keys.length-1>index)self.fetchCommands(index+1,callback);else self.fetchActionCommandsCompleted(callback)},function(e){keys.length-1>index&&self.fetchCommands(index+1,callback)})}else keys.length-1>index&&self.fetchCommands(index+1,callback)}}};ActionCommandsManager.prototype.getCommandByCardId=function(cardId){if(this.actionCommands)return this.actionCommands[cardId];else return []};ActionCommandsManager.prototype.fetchActionCommandsCompleted=function(callback){if(this.callbackQueue.length>0){this.fetchIsInprogress=false;this.actionCommands={};var cb=this.callbackQueue[this.callbackQueue.length-1];this.callbackQueue=[];this.fetchCommands(0,cb)}else{this.commandFetchCompleted=true;this.fetchIsInprogress=false;this.callbackQueue=[];callback()}};ActionCommandsManager.prototype.checkCommandAvailable=function(cardId,callback){var commands,self=this,curRecord=this._context.parameters.SubGrid.records[cardId];curRecord&&this._context.parameters.SubGrid.retrieveRecordCommand(curRecord.getValue("actioncardid").toString()).then(function(data){callback(true)},function(e){if(self.fetchCounter<3){self.fetchCounter++;window.setTimeout(function(){self.checkCommandAvailable(cardId,callback)},600)}else callback(false)})};ActionCommandsManager.prototype.fetchCardCommand=function(cardData,callback){var commands,self=this,curRecord=this._context.parameters.SubGrid.records[cardData.cardId];if(curRecord){this._context.parameters.SubGrid.setSelectedRecordId(curRecord.getValue("actioncardid").toString());this._context.parameters.SubGrid.commanding.getRecordCommands(curRecord.getValue("actioncardid").toString()).then(function(data){callback(data,cardData)},function(e){console.error(e)})}};ActionCommandsManager.buttonCommandMap={};return ActionCommandsManager}();CRMNow.ActionCommandsManager=ActionCommandsManager})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var RelationshipAssitantSdkContracts;(function(RelationshipAssitantSdkContracts){var Guid=function(){function Guid(userId){this.guid=userId}return Guid}();RelationshipAssitantSdkContracts.Guid=Guid;var PopulateCardRequest=function(){function PopulateCardRequest(userId){this.UserId=new Guid(userId)}PopulateCardRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{UserId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:"PopulateCard",operationType:0};return metadata};return PopulateCardRequest}();RelationshipAssitantSdkContracts.PopulateCardRequest=PopulateCardRequest;var RetrieveCardDataRequest=function(){function RetrieveCardDataRequest(cardTypeId,additionalParameter){this.CardTypeId=new Guid(cardTypeId);this.AdditionalParameter=additionalParameter}RetrieveCardDataRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{CardTypeId:{typeName:"Edm.Guid",structuralProperty:1},AdditionalParameter:{typeName:"Edm.String",structuralProperty:1}},operationName:"RetrieveCardData",operationType:0};return metadata};return RetrieveCardDataRequest}();RelationshipAssitantSdkContracts.RetrieveCardDataRequest=RetrieveCardDataRequest})(RelationshipAssitantSdkContracts||(RelationshipAssitantSdkContracts={}));var MscrmControls;(function(MscrmControls){var CRMNow;(function(CRMNow){var CardUtils;(function(CardUtils){CardUtils.isGetStartedClicked=false;CardUtils.isUci=false;function checkWhetherGroupPresent(data){var hasGroup=false;for(var i in data)if(data[i].length>1)hasGroup=true;return hasGroup}CardUtils.checkWhetherGroupPresent=checkWhetherGroupPresent;function sortDataSource(source){var keys=[];for(var key in source)keys[keys.length]=key;for(var values=[],i=0;i<keys.length;i++)values[values.length]=source[keys[i]];var sortedValues=values.sort(function(a,b){return a.length-b.length});return sortedValues}CardUtils.sortDataSource=sortDataSource;function isCCFMode(){return CardUtils.isUci}CardUtils.isCCFMode=isCCFMode;function getEntityImage(entityName,entityId){var fetchXML="<fetch mapping='logical'> <entity name='"+entityName+"'> <attribute name='entityimage_url' /> <filter> <condition attribute='"+entityName+"id' operator='eq' value='"+entityId+"' /> </filter> </entity> </fetch>",_window=window,context=CardUtils.ccfContext;return context.webAPI.retrieveMultipleRecords(entityName,"?fetchXml="+fetchXML)}CardUtils.getEntityImage=getEntityImage;function getCardTypeEntities(){var fetchXML="<fetch mapping='logical'><entity name='cardtype'><attribute name='cardtypeid'/><attribute name='cardname'/><attribute name='softtitle'/><attribute name='hassnoozedismiss'/><attribute name='grouptype'/><attribute name='summarytext'/><attribute name='actions'/></entity></fetch>",context=CardUtils.ccfContext;return context.webAPI.retrieveMultipleRecords("cardtype","?fetchXml="+fetchXML)}CardUtils.getCardTypeEntities=getCardTypeEntities;function getOrgName(){var url=window.location.href,params=url.split("?")[1],orgParam=params.split("&")[0],org=orgParam.split("=")[1];return org}function getEntityReference(entityLogicalName,entityId){return new Xrm.Objects.EntityReference(entityLogicalName,new Microsoft.Crm.Client.Core.Framework.Guid(entityId))}CardUtils.getEntityReference=getEntityReference;function getSnoozeTimeStr(cardData){var snoozeString;if(cardData.priority>=1e3)snoozeString=CardUtils.getResources("ActionCard.CFC.Common.Snooze5m");else if(cardData.cardName.indexOf("AGENDA")!=-1)snoozeString=CardUtils.getResources("ActionCard.CFC.Common.Snooze15m");else snoozeString=CardUtils.getResources("ActionCard.CFC.Common.Snooze12h");return snoozeString}CardUtils.getSnoozeTimeStr=getSnoozeTimeStr;function formatStringArray(format,array){var returnValue=format;if(array!=undefined&&array.length>0)for(var i=0;i<array.length;i++){var actualValue=typeof array[i]=="undefined"||array[i]==null?"":array[i].toString();returnValue=returnValue.replace(new RegExp("\\{"+i+"\\}","g"),actualValue)}return returnValue}CardUtils.formatStringArray=formatStringArray;function getLocaleTime(utcTime){if(utcTime!=undefined&&utcTime!=""&&moment(utcTime,moment.ISO_8601).isValid()){var format=CardUtils.ccfContext.formatting.formatDateLong(new Date(utcTime));return format.substr(format.indexOf(",")+1).trim()}}CardUtils.getLocaleTime=getLocaleTime;function getUserTime(utcTime,format,context){var formattedDate,userDateTimeStr;utcTime=moment(utcTime).toDate();var userDateTime=utcTime;if(userDateTime!=undefined&&userDateTime!="")switch(format){case "formatShortDate24Hour":utcTime.setMinutes(moment(utcTime).toDate().getMinutes()+moment(utcTime).toDate().getTimezoneOffset()+CardUtils.ccfContext.client.getUserTimeZoneUtcOffset(moment(utcTime).toDate()));userDateTime=utcTime;formattedDate=userDateTime.format("MM/dd/yyyy HH:mm");return formattedDate;case "formatDateShort":formattedDate=CardUtils.ccfContext.formatting.formatDateShort(userDateTime,false);return formattedDate;case "formatTime":var dateOnly=CardUtils.ccfContext.formatting.formatDateShort(userDateTime,false),dateTime=CardUtils.ccfContext.formatting.formatTime(userDateTime,1),time=dateTime.replace(dateOnly,"").trim();return time;case "formatDateLong":formattedDate=CardUtils.ccfContext.formatting.formatDateLong(utcTime);return formattedDate;case "formatDateLongWithTime":var time=CardUtils.ccfContext.formatting.formatTime(userDateTime,1).split(/\s/);formattedDate=CardUtils.ccfContext.formatting.formatDateLong(userDateTime);return formattedDate+" "+time[1]+(time[2]!=undefined?" "+time[2]:"");default:formattedDate=CardUtils.ccfContext.formatting.formatTime(userDateTime,1);return formattedDate}}CardUtils.getUserTime=getUserTime;function htmlDecoder(htmlString){var decodedHtml=htmlString.replace(/&quot;/g,'"');decodedHtml=decodedHtml.replace(/&apos;/g,"'");decodedHtml=decodedHtml.replace(/&lt;/g,"<");decodedHtml=decodedHtml.replace(/&gt;/g,">");decodedHtml=decodedHtml.replace(/&amp;/g,"&");return decodedHtml}CardUtils.htmlDecoder=htmlDecoder;function defaultCardIcon(cardName){var defaultIcon="generalCard-leftblock CRMMDL2 ";switch(cardName){case "CLOSEDATECOMINGSOON":defaultIcon+="icon-closeDate";return defaultIcon;case "TOP_RECORD":defaultIcon+="icon-top-record";return defaultIcon;case "TOP_PEOPLE":defaultIcon+="icon-top-people";return defaultIcon;case "NEARBY_CUSTOMERS":defaultIcon+="icon-nearby";return defaultIcon;case "AGENDA:ACTIVITY_EMAIL":defaultIcon+="icon-email";return defaultIcon;case "RELEVANT_NEWS":defaultIcon+="icon-relevant-news";return defaultIcon;case "STOCK_ACTIVITY":defaultIcon+="icon-stock";return defaultIcon;case "UPCOMING_MEETING":defaultIcon+="icon-upcoming-meeting";return defaultIcon;case "RECENTMEETING":defaultIcon+="icon-recent-meeting";return defaultIcon;case "EMAILOPENED:EMAILOPEN":case "REMINDERWITHOUTCALL":defaultIcon+="icon-email-open";return defaultIcon;case "REMINDERWITHCALL":defaultIcon+="icon-email-reminder";return defaultIcon;case "ATTENDEE":defaultIcon+="icon-attendee";return defaultIcon;case "account":defaultIcon+="icon-account";return defaultIcon;case "contact":defaultIcon+="icon-contact";return defaultIcon;case "appointment":defaultIcon+="icon-appointment";return defaultIcon;case "task":defaultIcon+="icon-task";return defaultIcon;case "quote":defaultIcon+="icon-quote";return defaultIcon;case "opportunity":defaultIcon+="icon-entity-opportunity";return defaultIcon;case "invoice":defaultIcon+="icon-invoice";return defaultIcon;case "dashboard":defaultIcon+="icon-entity-dashboard";return defaultIcon;case "lead":defaultIcon+="icon-entity-lead";return defaultIcon;case "LEAD":case "LEADDETECTION":defaultIcon+="icon-lead";return defaultIcon;case "OPPORTUNITY":case "NOACTIVITYWITHOPPORTUNITY":defaultIcon+="icon-opportunity";return defaultIcon;case "EMAIL":defaultIcon+="icon-email";return defaultIcon;case "CASE":case "NOACTIVITYWITHCASE":defaultIcon+="icon-case";return defaultIcon;case "COMPETITORMENTIONED":defaultIcon+="icon-competitor-mentioned";return defaultIcon;case "MEETING_REQUEST":defaultIcon+="icon-meeting-request";return defaultIcon;case "STAKEHOLDER":defaultIcon+="icon-Stakeholder";return defaultIcon;case "MISSEDCLOSEDATE":defaultIcon+="icon-missed-closedate";return defaultIcon;case "ISSUEDETECTION":defaultIcon+="icon-issue-detection";return defaultIcon;case "DEFAULT_EXCHANGE":defaultIcon+="icon-default-exchange";return defaultIcon;case "NOACTIVITYWITHACCOUNT":case "NOACTIVITYWITHLEAD":case "NOACTIVITYWITHCONTACT ":defaultIcon+="icon-no-activity";return defaultIcon;case "YES_NO":defaultIcon+="icon-yes-no";return defaultIcon;case "MISSEDEMAIL":defaultIcon+="icon-missed-email";return defaultIcon;case "AGENDA:ACTIVITY_SERVICEAPPOINTMENT":defaultIcon+="icon-activity-serviceappointment";return defaultIcon;case "AGENDA:ACTIVITY_FAX":defaultIcon+="icon-activity-fax";return defaultIcon;case "REGARDING":defaultIcon+="icon-regarding";return defaultIcon;case "SEND_CONTENT_REQUEST":defaultIcon+="icon-send-content-request";return defaultIcon;case "EMAILOPENED:BESTTIMETOCALL":defaultIcon+="icon-best-time-to-call";return defaultIcon;case "AGENDA:ACTIVITY_LETTER":defaultIcon+="icon-activity-letter";return defaultIcon;case "UPCOMING_FLIGHT":defaultIcon+="icon-flight";return defaultIcon;case "OpportunityAtRiskSentiment":defaultIcon+="icon-opportunity-atrisk-sentiment";return defaultIcon;case "OpportunityAtRiskKTGModel":defaultIcon+="icon-opportunity-atrisk-ktgmodel";return defaultIcon;case "AGENDA:ACTIVITY_MEETING":case "AGENDA:ACTIVITY_PHONE":case "AGENDA:ACTIVITY_TASK":default:defaultIcon+="icon-due";return defaultIcon}}CardUtils.defaultCardIcon=defaultCardIcon;function defaultCardTitleColor(cardName){switch(cardName){case "CLOSEDATECOMINGSOON":return "#008272";case "TOP_RECORD":return "#333333";case "TOP_PEOPLE":return "#333333";case "NEARBY_CUSTOMERS":return "#333333";case "AGENDA:ACTIVITY_EMAIL":return "#5C2D94";case "RELEVANT_NEWS":return "#333333";case "STOCK_ACTIVITY":return "#628200";case "UPCOMING_MEETING":return "#333333";case "RECENTMEETING":return "#008274";case "EMAILOPENED:EMAILOPEN":case "REMINDERWITHOUTCALL":return "#D83B01";case "REMINDERWITHCALL":return "#D83B01";case "ATTENDEE":return "#333333";case "account":return "#ffffff";case "contact":return "#ffffff";case "appointment":return "#ffffff";case "task":return "#ffffff";case "quote":return "#ffffff";case "opportunity":return "#ffffff";case "invoice":return "#ffffff";case "dashboard":return "#ffffff";case "lead":return "#ffffff";case "LEAD":case "LEADDETECTION":return "#D83B01";case "OPPORTUNITY":case "NOACTIVITYWITHOPPORTUNITY":return "#5C2D94";case "EMAIL":return "#5C2D94";case "CASE":case "NOACTIVITYWITHCASE":return "#5C2D94";case "COMPETITORMENTIONED":return "#5C2D94";case "MEETING_REQUEST":return "#D83B01";case "STAKEHOLDER":return "#5C2D93";case "MISSEDCLOSEDATE":return "#008273";case "ISSUEDETECTION":return "#D83B01";case "DEFAULT_EXCHANGE":return "#D83B01";case "NOACTIVITYWITHACCOUNT":case "NOACTIVITYWITHLEAD":case "NOACTIVITYWITHCONTACT ":return "#5C2D91";case "YES_NO":return "#D83B01";case "MISSEDEMAIL":return "#008272";case "AGENDA:ACTIVITY_SERVICEAPPOINTMENT":return "#5C2D91";case "AGENDA:ACTIVITY_FAX":return "#5C2D91";case "REGARDING":return "#D83B01";case "SEND_CONTENT_REQUEST":return "#D83B01";case "EMAILOPENED:BESTTIMETOCALL":return "#D83B01";case "AGENDA:ACTIVITY_LETTER":return "#5C2D91";case "UPCOMING_FLIGHT":return "#333333";case "OpportunityAtRiskSentiment":return "#E81123";case "OpportunityAtRiskKTGModel":return "#E81123";case "AGENDA:ACTIVITY_MEETING":case "AGENDA:ACTIVITY_PHONE":case "AGENDA:ACTIVITY_TASK":default:return "#333333"}}CardUtils.defaultCardTitleColor=defaultCardTitleColor;function collapseLandingPage(){return}CardUtils.collapseLandingPage=collapseLandingPage;function isMOCAOffline(){var context=CardUtils.ccfContext;return context.client.isOffline()}CardUtils.isMOCAOffline=isMOCAOffline})(CardUtils=CRMNow.CardUtils||(CRMNow.CardUtils={}))})(CRMNow=MscrmControls.CRMNow||(MscrmControls.CRMNow={}))})(MscrmControls||(MscrmControls={}));var ActionOnRACard="ActionOnRelationshipAssistantCard",RAEntryPoint="RelationshipAssistantEntryPoint",RAActionCardFeedback="ActionCardFeedback",CardEventParameter=function(){function CardEventParameter(name,value){this.name=name;this.value=value}return CardEventParameter}(),ActionOnRelationshipAssistantCard=function(){function ActionOnRelationshipAssistantCard(cardType,actionTaken,entryPoint,appName,isUCI,deviceName){this.eventParameters=[];this.eventName=ActionOnRACard;this.addEventParameter("cardType",cardType);this.addEventParameter("actionTaken",actionTaken);this.addEventParameter("cardEntryPoint",entryPoint);this.addEventParameter("appName",appName);this.addEventParameter("isUCI",isUCI);this.addEventParameter("deviceName",deviceName)}ActionOnRelationshipAssistantCard.prototype.addEventParameter=function(parameterName,value){var event=new CardEventParameter(parameterName,value);this.eventParameters.push(event)};return ActionOnRelationshipAssistantCard}(),RelationshipAssistantEntryPoint=function(){function RelationshipAssistantEntryPoint(entryPoint,appName){this.eventParameters=[];this.eventName=RAEntryPoint;this.addEventParameter("entryPoint",entryPoint);this.addEventParameter("appName",appName)}RelationshipAssistantEntryPoint.prototype.addEventParameter=function(parameterName,value){var event=new CardEventParameter(parameterName,value);this.eventParameters.push(event)};return RelationshipAssistantEntryPoint}(),ActionCardFeedback=function(){function ActionCardFeedback(cardType,response,reason){this.eventParameters=[];this.eventName=RAActionCardFeedback;this.addEventParameter("cardType",cardType);this.addEventParameter("response",response);this.addEventParameter("reason",reason)}ActionCardFeedback.prototype.addEventParameter=function(parameterName,value){var event=new CardEventParameter(parameterName,value);this.eventParameters.push(event)};return ActionCardFeedback}(),MscrmControls;(function(MscrmControls){var ActionCard;(function(ActionCard){var ActionCardUtil=function(){function ActionCardUtil(){}ActionCardUtil.getSegmentValueFromReferenceTokens=function(referenceTokens,referenceTokenType,segment,returnFormat){var segmentValue;if(returnFormat=="ResourceString")segmentValue="";if(referenceTokens){var referenceTokenObject=JSON.parse(referenceTokens)["Tokens"];if(referenceTokenObject){var referenceTokenObject_TokenType=referenceTokenObject[referenceTokenType];if(referenceTokenObject_TokenType){var referenceTokenObject_TokenType_Segment=referenceTokenObject_TokenType[segment];if(referenceTokenObject_TokenType_Segment)if(returnFormat=="ResourceString"){var _window=window;segmentValue=_window.Xrm.Internal.getResourceString(referenceTokenObject_TokenType_Segment,window.top)}else if(returnFormat=="Object")segmentValue=referenceTokenObject_TokenType_Segment}}}return segmentValue};ActionCardUtil.formatString=function(inputString,removables,replacements){var formattedString=inputString;if(removables.length==replacements.length)for(var index=0;index<removables.length;index++)if(inputString.indexOf(removables[index])>=0)formattedString=formattedString.replace(removables[index],replacements[index]);return formattedString};ActionCardUtil.retrieveSubString=function(inputString,delimiter){var formattedSubString=inputString;if(inputString.indexOf(delimiter)>=0){var delimiterIndex=inputString.indexOf(delimiter),inputStringLength=inputString.length;formattedSubString=inputString.substr(delimiterIndex+1,inputStringLength)}return formattedSubString};ActionCardUtil.calculateRemainingTime=function(startTime){var remainingTime="",_window=window;if(startTime){var now=moment(new Date),start=moment(startTime),duration=moment.duration(start.diff(now)),timeLeft="";if(duration.hours()>0){var hoursText=_window.Xrm.Internal.getResourceString("ActionCard.CFC.Common.Hours",window.top);remainingTime=duration.hours().toString()+" "+hoursText}else if(duration.minutes()>0){var minutesText=_window.Xrm.Internal.getResourceString("ActionCard.CFC.Common.Minutes",window.top);remainingTime=duration.minutes().toString()+" "+minutesText}else{var timeExpiredText=_window.Xrm.Internal.getResourceString("ActionCard.CFC.Common.TimeExpired",window.top);remainingTime=" "+timeExpiredText}}return remainingTime};ActionCardUtil.removeHtmlTags=function(inputString){var refinedString=inputString;refinedString=refinedString.replace(/<\/?[^>]+(>|$)/g,"");return refinedString};return ActionCardUtil}();ActionCard.ActionCardUtil=ActionCardUtil})(ActionCard=MscrmControls.ActionCard||(MscrmControls.ActionCard={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var ActionCard;(function(ActionCard){ActionCard.PRIMARY_UI=0;ActionCard.FEEDBACK_UI=1;ActionCard.FEEDBACK_NO_REASON_UI=2;var ReasonForCardDismiss;(function(ReasonForCardDismiss){ReasonForCardDismiss[ReasonForCardDismiss["None"]=0]="None";ReasonForCardDismiss[ReasonForCardDismiss["IncorrectEmail"]=1]="IncorrectEmail";ReasonForCardDismiss[ReasonForCardDismiss["ReasonAlreadyProvided"]=2]="ReasonAlreadyProvided";ReasonForCardDismiss[ReasonForCardDismiss["IncorrectRequest"]=3]="IncorrectRequest";ReasonForCardDismiss[ReasonForCardDismiss["OtherReasons"]=4]="OtherReasons"})(ReasonForCardDismiss||(ReasonForCardDismiss={}));var ActionCardView=function(_super){__extends(ActionCardView,_super);function ActionCardView(){_super.call(this)}ActionCardView.prototype.getInitialState=function(){return null};ActionCardView.prototype.generateDomElementsFromReferenceTokens=function(referenceTokenType){var toolTip="",toolTipItems=[],toolTipItemIndex=0,formattedParams=[],domElements=[],_window=window,options=new _window.Xrm.DialogOptions;options.openInNewWindow=true;var params=ActionCard.ActionCardUtil.getSegmentValueFromReferenceTokens(this.props.cardData.data.referencetokens,referenceTokenType,"Params","Object");if(!params)return null;for(var resourceString=ActionCard.ActionCardUtil.getSegmentValueFromReferenceTokens(this.props.cardData.data.referencetokens,referenceTokenType,"ResourceId","ResourceString"),resourceStringSegments=resourceString.split(/\s+/g),regExpr=new RegExp("{[0-9]*}"),placeholders=[],i=0;i<resourceStringSegments.length;i++)resourceStringSegments[i].match(regExpr)&&placeholders.push(resourceStringSegments[i]);for(var i=0;i<params.length;i++){var name=params[i]["Name"],recordId=params[i]["Id"],paramsType=params[i]["Type"];if(paramsType==1)try{var dateTime=new Date(name);if(dateTime!=null){var specifier="D";if(name.indexOf("T")!=-1){var timeZoneDifference=_window.USER_TIMEZONE_OFFSET+dateTime.getTimezoneOffset();dateTime=new Date(dateTime.getTime()+timeZoneDifference*6e4);if(!this.isNoActivityCard(this.props.cardData.data.cardtype))specifier="f"}name=Mscrm.DateTimeUtility.formatDate(dateTime,specifier)}}catch(Exception){if(dateTime!=null)name=dateTime.toDateString()}var placeholder=placeholders[i].substring(placeholders[i].indexOf("{"),placeholders[i].indexOf("}")+1);name=placeholders[i].replace(placeholder,name);if(recordId){var entityName=_window.Xrm.Internal.getEntityName(params[i]["TypeCode"]);formattedParams[i]=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:Xrm.Utility.openEntityForm('"+entityName+"','{"+recordId+"}');",className:"cardText",tabIndex:"-1"}," "+name)}else formattedParams[i]=Mscrm.Controls.VDOM.span(this.props.cardData,{}," "+name);toolTipItems[i]=name}for(var i=0,j=0;i<resourceStringSegments.length;i++)if(resourceStringSegments[i].match(regExpr)){domElements[i]=formattedParams[j++];if(toolTipItemIndex<toolTipItems.length){if(toolTip=="")toolTip=toolTipItems[toolTipItemIndex];else toolTip=toolTip+" "+toolTipItems[toolTipItemIndex];toolTipItemIndex++}}else{domElements[i]=Mscrm.Controls.VDOM.span(this.props.cardData,{}," "+resourceStringSegments[i]);if(toolTip=="")toolTip=resourceStringSegments[i];else toolTip=toolTip+" "+resourceStringSegments[i]}if(referenceTokenType=="title")ActionCard.TITLE_TOOL_TIP=toolTip;else if(referenceTokenType=="body")ActionCard.DESCRIPTION_TOOL_TIP=toolTip;return domElements};ActionCardView.prototype.isNoActivityCard=function(cardType){switch(cardType){case 29:case 30:case 31:case 32:case 33:return true;default:return false}};ActionCardView.prototype.handleFeedbackNoOption=function(option,event){var cardtype=this.props.cardData.data.cardtype;eval('addTelemetry("'+cardtype+'","FeedbackNo","'+option+'")');ActionCard.handleCommand(this.props.cardData.cardId,"Mscrm.HomepageGrid.actioncard.DismissCommand",event)};ActionCardView.prototype.handleKeyPressFeedbackNoOption=function(option,event){(event.keyCode==13||event.charCode==13)&&this.handleFeedbackNoOption(option,event)};ActionCardView.prototype.handleSnoozeHover=function(event){var _window=window,element=event.target;while(element.className!="snoozeCard")element=element.firstChild;element.src=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/iconsnoozeonfocus.png"};ActionCardView.prototype.handleDismissHover=function(event){var _window=window,element=event.target;while(element.className!="closeCard")element=element.firstChild;element.src=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/icondismissonfocus.png"};ActionCardView.prototype.handleSnoozeNoHover=function(event){var _window=window,element=event.target;while(element.className!="snoozeCard")element=element.firstChild;element.src=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/iconsnoozenofocus.png"};ActionCardView.prototype.handleDismissNoHover=function(event){var _window=window,element=event.target;while(element.className!="closeCard")element=element.firstChild;element.src=_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/icondismissnofocus.png"};ActionCardView.prototype.handleActionCommandOnKeyDown=function(requestedActionCommandKey,event){if(event.keyCode==9||event.charCode==9)if($(event.target).next().length==0&&$(event.target).closest(".actionhubcontrol").next().length==0){var notesControl=window.parent.document.getElementById("header_notescontrol");if(notesControl){var TabElement=notesControl.firstElementChild;TabElement.focus();event.nativeEvent.preventDefault();event.nativeEvent.stopPropagation()}}};ActionCardView.prototype.executeDefaultAction=function(event){var varDefaultActionJson=this.props.cardData.data.cardTypeData.actions;if(varDefaultActionJson){var actionObject=JSON.parse(varDefaultActionJson),webClientActions=actionObject["WebClient"],defaultActions=webClientActions["Default"],defaultActionKeys=Object.keys(defaultActions);defaultActionKeys.length>0&&ActionCard.handleCommand(this.props.cardData.cardId.toString(),defaultActions[defaultActionKeys[0]],event)}};ActionCardView.prototype.executeDefaultActionOnClick=function(event){this.executeDefaultAction(event)};ActionCardView.prototype.executeDefaultActionOnKeyPress=function(event){(event.keyCode==13||event.charCode==13)&&this.executeDefaultAction(event)};ActionCardView.prototype.showBlankTemplate=function(){var titleContent="",divTitleDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{title:titleContent},titleContent),divTitleContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"blankTitleTemplate"},[divTitleDescription]);return divTitleContainer};ActionCardView.prototype.showOptionsTitleTemplate=function(){var _window=window,titleContent=_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Title",window.top),divTitleDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{title:titleContent,className:"fontsize14",tabIndex:"0"},titleContent),dismissToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.Dismiss",window.top),imgDismissIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{className:"closeCard",alt:dismissToolTip,src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/icondismissnofocus.png"}),anchorDismissIcon=Mscrm.Controls.VDOM.anchor(this.props.cardData,{onMouseOver:this.handleDismissHover.bind(this),onMouseOut:this.handleDismissNoHover.bind(this),onFocus:this.handleDismissHover.bind(this),onBlur:this.handleDismissNoHover.bind(this),onClick:this.handleFeedbackNoOption.bind(this,ReasonForCardDismiss.None),"aria-label":dismissToolTip,tabIndex:"0",title:dismissToolTip},imgDismissIcon),divIconGroup=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"pullRightClass"},[anchorDismissIcon]);return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"feedbackoptionsTitle"},[divIconGroup,divTitleDescription])};ActionCardView.prototype.showTitleTemplate=function(){var imgCardTypeIcon,anchorCardTypeIcon,divCardTypeIcon,divActionCardTitle,divTitleContainer,varTitleToolTip="",_window=window,highcontrast,url;if(!this.props.cardData.title){if(this.props.cardData.data.referencetokens!=undefined){this.props.cardData.title=this.generateDomElementsFromReferenceTokens("title");if(this.props.cardData.title)varTitleToolTip=ActionCard.TITLE_TOOL_TIP}}else varTitleToolTip=this.props.cardData.title;if(this.props.cardTypeIcon!=""){var cardName=this.props.cardData.cardName;if(cardName.indexOf(":")>=0)cardName=cardName.replace(":","_");var cardNameResourceKey="CardType_ToolTip_"+cardName,cardNameToolTip=_window.Xrm.Internal.getResourceString(cardNameResourceKey,window.top);if(cardNameToolTip&&cardNameToolTip!=null&&cardNameToolTip!=undefined&&cardNameToolTip!="[object Object]"){imgCardTypeIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{src:this.props.cardData.cardTypeIcon,alt:cardNameToolTip});anchorCardTypeIcon=Mscrm.Controls.VDOM.anchor(this.props.cardData,{className:"generalCard-leftblock",onClick:this.executeDefaultActionOnClick.bind(this),onKeyPress:this.executeDefaultActionOnKeyPress.bind(this),"aria-label":cardNameToolTip,tabIndex:"0",title:cardNameToolTip},imgCardTypeIcon)}else{imgCardTypeIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{src:this.props.cardData.cardTypeIcon});anchorCardTypeIcon=Mscrm.Controls.VDOM.anchor(this.props.cardData,{tabIndex:"0",className:"generalCard-leftblock",onClick:this.executeDefaultActionOnClick.bind(this),onKeyPress:this.executeDefaultActionOnKeyPress.bind(this)},imgCardTypeIcon)}}var divTitleDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generic-PrimTitle",title:varTitleToolTip,tabIndex:"0",onKeyPress:this.executeDefaultActionOnKeyPress.bind(this)},this.props.cardData.title?this.props.cardData.title:""),cardtypeidArrays=["{64A6C256-E479-41F5-8719-D1AFC4835FE8}","{CF6BDDD4-E712-4F1D-97B6-68D3A7788A97}","{DEA00147-C288-49D2-83C8-8B6437868C5A}","{EEC00A9D-0D1E-445A-83AD-A3A6FB603CD4}","{7AC21A31-8C11-4239-8505-A9FD748439DC}","{E9BF7F81-442C-4145-BD43-F68FFC56CD54}","{8B087B1A-CF01-4203-921C-97DC156225EF}","{6C54F024-E4DD-40DD-AC05-92667ED7FA3B}","{FC4EC2E1-7655-4C8C-A518-EA4BF1EF5721}","{7E3C4A08-7E2E-4EC0-BFE5-840C8F91B607}","{705EFBED-7E6B-445F-BD7D-8C60572DED04}"],snoozeRemovables=["{0}"],snoozeReplacements=[],snoozeToolTip;if(this.props.cardData.data.priority>=1e3){snoozeToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.Snooze.Minutes",window.top);snoozeReplacements=["5"]}else if(cardtypeidArrays.indexOf(this.props.cardData.data.cardTypeData.cardtypeid)>-1){snoozeToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.Snooze.Minutes",window.top);snoozeReplacements=["15"]}else{snoozeToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.Snooze.Hours",window.top);snoozeReplacements=["12"]}snoozeToolTip=ActionCard.ActionCardUtil.formatString(snoozeToolTip,snoozeRemovables,snoozeReplacements);var imgSnoozeIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{className:"snoozeCard",alt:snoozeToolTip,src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/iconsnoozenofocus.png"}),anchorSnoozeIcon=Mscrm.Controls.VDOM.anchor(this.props.cardData,{className:"snoozeCardIcon",onMouseOver:this.handleSnoozeHover.bind(this),onMouseOut:this.handleSnoozeNoHover.bind(this),onFocus:this.handleSnoozeHover.bind(this),onBlur:this.handleSnoozeNoHover.bind(this),href:"javascript:MscrmControls.ActionCard.handleCommand('"+this.props.cardData.cardId+"','Mscrm.HomepageGrid.actioncard.SnoozeCommand');","aria-label":snoozeToolTip,tabIndex:"0",title:snoozeToolTip},imgSnoozeIcon),dismissToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.Dismiss",window.top),imgDismissIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{className:"closeCard",alt:dismissToolTip,src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/icondismissnofocus.png"}),cardType=this.props.cardData.data?this.props.cardData.data.cardTypeData.cardtype["#text"]:"",anchorDismissIcon=Mscrm.Controls.VDOM.anchor(this.props.cardData,{onMouseOver:this.handleDismissHover.bind(this),onMouseOut:this.handleDismissNoHover.bind(this),onFocus:this.handleDismissHover.bind(this),onBlur:this.handleDismissNoHover.bind(this),href:"javascript:MscrmControls.ActionCard.handleDismissCommand('"+this.props.cardData.cardId+"','"+cardType+"','Mscrm.HomepageGrid.actioncard.ShowFeedbackAfterDismiss');","aria-label":dismissToolTip,tabIndex:"0",title:dismissToolTip},imgDismissIcon),divIconGroup=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"pullRightClass"},[anchorSnoozeIcon,anchorDismissIcon]),softTitle=this.props.cardData.data.cardtype<1e3?_window.Xrm.Internal.getResourceString(this.props.cardData.softTitle,window.top):this.props.cardData.softTitle,formattedSoftTitle=softTitle;formattedSoftTitle=ActionCard.ActionCardUtil.retrieveSubString(formattedSoftTitle,":");if(formattedSoftTitle.indexOf("{0}")>=0){var startDate=this.props.cardData.data.startdate,cardRelatedData=this.props.cardData.data.data,cardInfo=JSON.parse(cardRelatedData),cardRelatedInfo=cardInfo["cardRelatedInfo"],startTime=cardRelatedInfo["starttime"]?cardRelatedInfo["starttime"]:"",startTimeFormatted=new Date(startTime),timeZoneDifference=_window.USER_TIMEZONE_OFFSET+startTimeFormatted.getTimezoneOffset();startTime=new Date(startTimeFormatted.getTime()+timeZoneDifference*6e4);var removables=["{0}"],replacements=[];if(this.props.cardData.cardName=="Upcoming_Meeting"){var remainingTime=ActionCard.ActionCardUtil.calculateRemainingTime(startTime);replacements.push(remainingTime)}else{var formattedStartTime=Mscrm.DateTimeUtility.formatDate(startTime,"t");replacements.push(formattedStartTime)}formattedSoftTitle=ActionCard.ActionCardUtil.formatString(formattedSoftTitle,removables,replacements)}var divSoftTitle=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-softTitle",tabIndex:"0",title:formattedSoftTitle},formattedSoftTitle?formattedSoftTitle:""),divTitleContent=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"actionCardTitles"},[divSoftTitle,divTitleDescription]);divActionCardTitle=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"pullLeftClass"},[anchorCardTypeIcon,divTitleContent]);divTitleContainer=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"Display-Title-Container"},[divActionCardTitle,divIconGroup]);return divTitleContainer};ActionCardView.prototype.getCardTypeIcon=function(url,highcontrast){var _window=window,imgUrlArr=url.split("/");if(imgUrlArr!=null){for(var highContrastUrl="",i=0;i<imgUrlArr.length-1;i++)highContrastUrl+=imgUrlArr[i]+"/";highContrastUrl+=imgUrlArr[imgUrlArr.length-1].replace(/_(.+)_/g,"_WHITE_");return _window.getAttributeInWindow("CDNURL")+highContrastUrl}else return _window.getAttributeInWindow("CDNURL")+url};ActionCardView.prototype.showPrimaryTemplate=function(){var varDescriptionToolTip="",divCardDescription;if(!this.props.cardData.description){if(this.props.cardData.data.referencetokens!=undefined){this.props.cardData.description=this.generateDomElementsFromReferenceTokens("body");divCardDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"Prim-Text-Info"},[Mscrm.Controls.VDOM.span(this.props.cardData.data,{},this.props.cardData.description)]);if(this.props.cardData.description)varDescriptionToolTip=ActionCard.DESCRIPTION_TOOL_TIP}}else{divCardDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"Prim-Text-Info"},this.props.cardData.description);varDescriptionToolTip=ActionCard.ActionCardUtil.removeHtmlTags(this.props.cardData.description)}return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"cardDescription",tabIndex:"0",title:varDescriptionToolTip,"aria-label":varDescriptionToolTip,onKeyPress:this.executeDefaultActionOnKeyPress.bind(this)},[divCardDescription])};ActionCardView.prototype.showFeedbackPrimaryTemplate=function(){var _window=window,description=_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.Description",window.top),divDescription=Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-softTitle generalCard-softTitleBoxChange",tabIndex:"0",title:description},description);return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"cardDescription"},[divDescription])};ActionCardView.prototype.showFeedbackNoOptionsTemplate=function(){for(var _window=window,reasonForCardDismissList=[ReasonForCardDismiss.None,ReasonForCardDismiss.IncorrectEmail,ReasonForCardDismiss.ReasonAlreadyProvided,ReasonForCardDismiss.IncorrectRequest,ReasonForCardDismiss.OtherReasons],titleContent=_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Title",window.top),actionComponents=[],options=[_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Option1",window.top),_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Option2",window.top),_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Option3",window.top),_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.NoFeedback.Option4",window.top)],i=0;i<options.length;i++){var option=options[i],ariaLabel=option;if(i==0)ariaLabel=titleContent+" "+option;var optionAnchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{onClick:this.handleFeedbackNoOption.bind(this,reasonForCardDismissList[i+1]),onKeyPress:this.handleKeyPressFeedbackNoOption.bind(this,reasonForCardDismissList[i+1]),className:"feedbackoptions feedbackoptions"+(i+1),tabIndex:"0",title:option,"aria-label":ariaLabel},[option]),optionDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},[optionAnchor]);actionComponents.push(optionDiv)}return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"feedbackOptionsDescription"},[actionComponents])};ActionCardView.prototype.showActionTemplate=function(){var varActionsJson=this.props.cardData.data.cardTypeData.actions,actionComponents=[];if(varActionsJson){var actionObject=JSON.parse(varActionsJson),webClientActions=actionObject["WebClient"],actions=webClientActions["Actions"],actionKeys=Object.keys(actions),_window=window,actionCardId=this.props.cardData.cardId.toString(),action1Name=this.props.cardData.data.cardtype<1e3?_window.Xrm.Internal.getResourceString(actionKeys[0],window.top):actionKeys[0],action1Anchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+actionCardId+"','"+actions[actionKeys[0]]+"');",className:"actionItemsClass generalCardAction",tabIndex:"0",title:action1Name},action1Name);if(actionKeys[1]){var action1Div=Mscrm.Controls.VDOM.div(this.props.cardData,{},[action1Anchor]);actionComponents.push(action1Div)}else{var action1Div=Mscrm.Controls.VDOM.div(this.props.cardData,{onKeyDown:this.handleActionCommandOnKeyDown.bind(this,actions[actionKeys[0]])},[action1Anchor]);actionComponents.push(action1Div)}if(actionKeys[1]){var action2Name=_window.Xrm.Internal.getResourceString(actionKeys[1],window.top),action2Anchor;if(this.props.cardData.data.cardTypeData.cardname=="Stakeholder"||this.props.cardData.data.cardTypeData.cardname=="CompetitorMentioned"){var Action2ToolTip=_window.Xrm.Internal.getResourceString("Ribbon.Tooltip.actioncard.DoThisAutomatically.Title",window.top);action2Anchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+actionCardId+"','"+actions[actionKeys[1]]+"');",className:"actionItemsClass generalCardAction",tabIndex:"0",title:Action2ToolTip},action2Name)}else action2Anchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+actionCardId+"','"+actions[actionKeys[1]]+"');",className:"actionItemsClass generalCardAction",tabIndex:"0",title:action2Name},action2Name);var action2Div=Mscrm.Controls.VDOM.div(this.props.cardData,{onKeyDown:this.handleActionCommandOnKeyDown.bind(this,actions[actionKeys[1]])},[action2Anchor]);actionComponents.push(action2Div)}return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-footer-text"},actionComponents)}};ActionCardView.prototype.showFeedbackActionTemplate=function(){var _window=window,actionComponents=[],titleContent=_window.Xrm.Internal.getResourceString("Actioncard.Feedbackcard.Description",window.top),yesLabel=_window.Xrm.Internal.getResourceString("Button_Label_Yes",window.top),imgYesIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{alt:yesLabel,className:"feedbacksymbolclass",src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Yes.png"}),yesAnchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+this.props.cardData.cardId+"','Mscrm.HomepageGrid.actioncard.ExecuteFeedbackYes');",className:"generalCardAction yesanchorclass",tabIndex:"0",title:yesLabel,"aria-label":titleContent+" "+yesLabel},[imgYesIcon,yesLabel]),yesDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},[yesAnchor]);actionComponents.push(yesDiv);var noLabel=_window.Xrm.Internal.getResourceString("Button_Label_No",window.top),imgNoIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{alt:noLabel,className:"feedbacksymbolclass",src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/No.png"}),noAnchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+this.props.cardData.cardId+"','Mscrm.HomepageGrid.actioncard.ExecuteFeedbackNo');",className:"generalCardAction noanchorclass",tabIndex:"0",title:noLabel},[imgNoIcon,noLabel]),noDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},[noAnchor]);actionComponents.push(noDiv);var undoLabel=_window.Xrm.Internal.getResourceString("ActionCard.CFC.Common.Undo",window.top),imgUndoIcon=Mscrm.Controls.VDOM.img(this.props.cardData,{alt:undoLabel,className:"feedbacksymbolclass",src:_window.getAttributeInWindow("CDNURL")+"/_static/_controls/actionhubcontrol/Undo.png"}),undoAnchor=Mscrm.Controls.VDOM.anchor(this.props.cardData,{href:"javascript:MscrmControls.ActionCard.handleCommand('"+this.props.cardData.cardId+"','Mscrm.HomepageGrid.actioncard.ExecuteFeedbackUndo');",className:"pullRightClass generalCardAction  undoanchorclass",tabIndex:"0",title:undoLabel},[imgUndoIcon,undoLabel]),undoDiv=Mscrm.Controls.VDOM.div(this.props.cardData,{},[undoAnchor]);actionComponents.push(undoDiv);return Mscrm.Controls.VDOM.div(this.props.cardData,{className:"generalCard-footer-text"},actionComponents)};ActionCardView.prototype.executeDefaultActionOnCardClick=function(event){var targetele=event.target;targetele.tagName.toLowerCase()!="img"&&targetele.tagName.toLowerCase()!="a"&&targetele.className!="generalCardAction"&&this.executeDefaultAction(event)};ActionCardView.prototype.getTitleTemplate=function(){switch(this.props.cardDisplayType){case ActionCard.FEEDBACK_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showBlankTemplate;else return this.showTitleTemplate;case ActionCard.FEEDBACK_NO_REASON_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showOptionsTitleTemplate;else return this.showTitleTemplate;default:return this.showTitleTemplate}};ActionCardView.prototype.getPrimaryTemplate=function(){switch(this.props.cardDisplayType){case ActionCard.FEEDBACK_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showFeedbackPrimaryTemplate;else return this.showPrimaryTemplate;case ActionCard.FEEDBACK_NO_REASON_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showFeedbackNoOptionsTemplate;else return this.showPrimaryTemplate;default:return this.showPrimaryTemplate}};ActionCardView.prototype.getActionTemplate=function(){switch(this.props.cardDisplayType){case ActionCard.FEEDBACK_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showFeedbackActionTemplate;else return this.showActionTemplate;case ActionCard.FEEDBACK_NO_REASON_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return this.showBlankTemplate;else return this.showActionTemplate;default:return this.showActionTemplate}};ActionCardView.prototype.getDefaultActionTemplate=function(){switch(this.props.cardDisplayType){case ActionCard.FEEDBACK_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return null;else return this.executeDefaultActionOnCardClick;case ActionCard.FEEDBACK_NO_REASON_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return null;else return this.executeDefaultActionOnCardClick;default:return this.executeDefaultActionOnCardClick}};ActionCardView.prototype.toShowActionTemplate=function(){switch(this.props.cardDisplayType){case ActionCard.FEEDBACK_NO_REASON_UI:if(this.props.dismissedCardId==this.props.cardData.cardId.toString())return false;else return true;default:return true}};ActionCardView.prototype.onRender=function(){return MscrmControls.CRMNow.GenericCardControl({callerApp:"WebClient",mode:this.props.cardData.mode,cardData:this.props.cardData,showTitleInfo:true,titleData:null,titleTemplate:this.getTitleTemplate(),showPrimaryInfo:true,showPrimaryTemplate:true,showPrimaryTemplateSmall:false,primaryTemplateData:null,primaryTemplate:this.getPrimaryTemplate(),showActionInfo:this.toShowActionTemplate(),actionData:this.props.cardData.data,actionTemplateData:null,actionTemplate:this.getActionTemplate(),defaultActionTemplate:this.getDefaultActionTemplate(),commandManager:null})};return ActionCardView}(Mscrm.Controls.VirtualComponentBase);ActionCard.ActionCardView=ActionCardView;ActionCard.varActionCardControl=ReactUtils.createComponent(new ActionCardView)})(ActionCard=MscrmControls.ActionCard||(MscrmControls.ActionCard={}))})(MscrmControls||(MscrmControls={}));var MscrmControls;(function(MscrmControls){var ActionCard;(function(ActionCard){var ActionCardControl=function(){function ActionCardControl(){}ActionCardControl.getCellValue=function(columnName,recordId){for(var data=Mscrm.ActionCardData,i=0;i<data.length;i++)if(data[i].actioncardid==recordId){var columnValue=data[i][columnName];if(columnValue!=null&&columnValue&&columnValue["#text"])return columnValue["#text"];return columnValue!=null?columnValue.toString():null}return ""};ActionCardControl.refresh=function(){};return ActionCardControl}();ActionCard.ActionCardControl=ActionCardControl;var id;function handleCommand(actionCardId,requestedCommandKey,domElmEvent){id=actionCardId;var actualCommand=Mscrm.ActionCardCommand.commands[requestedCommandKey];executeCommand(actualCommand);if(Mscrm.ActionsToDismiss.indexOf(requestedCommandKey)>-1)eval("Mscrm.CommandBarActions.dismissCardFromUI(id)")}ActionCard.handleCommand=handleCommand;function handleDismissCommand(actionCardId,cardType,requestedCommandKey,domElmEvent){id=actionCardId;var actualCommand=Mscrm.ActionCardCommand.commands[requestedCommandKey];executeCommand(actualCommand);if(Mscrm.ActionsToDismiss.indexOf(requestedCommandKey)>-1)eval("Mscrm.CommandBarActions.dismissCardFromUI(id)");addDismissTelemetryAction(cardType)}ActionCard.handleDismissCommand=handleDismissCommand;function addDismissTelemetryAction(cardType){try{var args={actionType:"DismissCommand",cardType:cardType,isWebClient:true};Mscrm.MetricsReporting.instance().addMetric("relationshipcardactiontaken",args)}catch(e){}}function executeCommand(commandData){for(var actionIndex=0;actionIndex<commandData.Actions.length;actionIndex++)commandData.Actions[actionIndex].ActionType==3&&executeJavascriptFunction(commandData.Actions[actionIndex])}ActionCard.executeCommand=executeCommand;function executeJavascriptFunction(commandData){var functionName=parseMethodName(commandData);eval(functionName+"(ActionCardControl,[{'Id':id}])")}ActionCard.executeJavascriptFunction=executeJavascriptFunction;function parseMethodName(commandData){return commandData.Attributes.FunctionName}ActionCard.parseMethodName=parseMethodName})(ActionCard=MscrmControls.ActionCard||(MscrmControls.ActionCard={}))})(MscrmControls||(MscrmControls={}))