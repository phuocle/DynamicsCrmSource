Type.registerNamespace("Mscrm");Mscrm.EmailEngagementActions=function(element){this.$$d_setReminderCallback=Function.createDelegate(this,this.setReminderCallback);this.$$d_sendLaterCallback=Function.createDelegate(this,this.sendLaterCallback);this.$$d_onEmailFollowedDialogCloseCallback=Function.createDelegate(this,this.onEmailFollowedDialogCloseCallback);this.$$d_$l_3=Function.createDelegate(this,this.$l_3);this.$$d_$n_3=Function.createDelegate(this,this.$n_3);this.$$d_$m_3=Function.createDelegate(this,this.$m_3);this.$$d_$s_3=Function.createDelegate(this,this.$s_3);this.$$d_$q_3=Function.createDelegate(this,this.$q_3);this.$$d_$p_3=Function.createDelegate(this,this.$p_3);this.$$d_$f_3=Function.createDelegate(this,this.$f_3);this.$$d_$r_3=Function.createDelegate(this,this.$r_3);this.$$d_$a_3=Function.createDelegate(this,this.$a_3);this.$$d_$Y_3=Function.createDelegate(this,this.$Y_3);this.$$d_$Z_3=Function.createDelegate(this,this.$Z_3);this.$$d_$d_3=Function.createDelegate(this,this.$d_3);this.$$d_$e_3=Function.createDelegate(this,this.$e_3);this.$$d_$b_3=Function.createDelegate(this,this.$b_3);this.$$d_$h_3=Function.createDelegate(this,this.$h_3);this.$$d_$c_3=Function.createDelegate(this,this.$c_3);this.$$d_$Q_3=Function.createDelegate(this,this.$Q_3);this.$0_3=Mscrm.EmailEngagementActions.$6;Mscrm.EmailEngagementActions.initializeBase(this,[element])};Mscrm.EmailEngagementActions.initializeLocalizedStrings=function(){if(!Mscrm.EmailEngagementActions.localizedStrings)Mscrm.EmailEngagementActions.localizedStrings=window.self.EmailEngagementActionsStrings};Mscrm.EmailEngagementActions.$o=function($p0){if(IsNull($p0)||!Mscrm.InternalUtilities.Utilities.isRefreshForm())return;!Mscrm.InternalUtilities.Utilities.isTurboForm()&&!IsNull(Xrm.Page.ui)&&Xrm.Page.ui.controls.get("emailengagementactionscontrol")&&Xrm.Page.ui.controls.get("emailengagementactionscontrol").getParent().setVisible(false);var $v_0=$find($p0.id),$v_1=new Mscrm.InlineEmailEngagementActionsControlView($v_0),$v_2=Xrm.Page.ui;if(!IsNull($v_2)&&IsNull($v_2.controls))$v_2.controls=new Xrm.XrmControls;if(Mscrm.InternalUtilities.Utilities.isTurboForm()){$v_2.controls.add($v_1);Mscrm.EmailEngagementActions.$W($p0,$v_1)}};Mscrm.EmailEngagementActions.$W=function($p0,$p1){if(!IsNull($p0)){var $v_0=Xrm.Page.ui,$v_1=$P_CRM($p0).parents("table.ms-crm-FormSection:first"),$v_2=IsNull($v_1)?"":$v_1.attr("name");if(isNullOrEmptyString($v_2))return;var $v_3=$P_CRM($p0).parents("div.ms-crm-InlineTab-Read:first"),$v_4=IsNull($v_3)?"":$v_3.attr("name");if(!IsNull($v_0)&&!isNullOrEmptyString($v_2)&&!isNullOrEmptyString($v_4)){var $v_5=$v_0.tabs.get($v_4);if(!IsNull($v_5)){var $v_6=$v_5.sections.get($v_2);!IsNull($v_6)&&$v_6.controls.add($p1.getWrapper())}}}};Mscrm.EmailEngagementActions.$1=function($p0,$p1,$p2){var $v_0={};if($p0==="controlStatus"){$v_0["controlName"]=$p2;$v_0["controlLoadStatus"]=$p1;Mscrm.MetricsReporting.instance().addMetric("emailengagementcontrolstatus",$v_0)}else{$v_0["entityType"]=$p2;$v_0["dataRetreivalStatus"]=$p1;Mscrm.MetricsReporting.instance().addMetric("emailengagemententityfetchstatus",$v_0)}};Mscrm.EmailEngagementActions.$U=function($p0,$p1,$p2,$p3,$p4){var $v_0={};if($p0){for(var $v_1=0;$v_1<$p0.length;$v_1++){if($p0[$v_1].entityType==="account"){$p4=$p1===""?$p4+1:$p4;$p1=$p1+String.format("<value>{0}</value>",$p0[$v_1].id.toString())}if($p0[$v_1].entityType==="contact"){$p4=$p2===""?$p4+1:$p4;$p2=$p2+String.format("<value>{0}</value>",$p0[$v_1].id.toString())}if($p0[$v_1].entityType==="lead"){$p4=$p3===""?$p4+1:$p4;$p3=$p3+String.format("<value>{0}</value>",$p0[$v_1].id.toString())}}$v_0["account"]=$p1;$v_0["contact"]=$p2;$v_0["lead"]=$p3;$v_0["participatingEntitiesCount"]=$p4}return $v_0};Mscrm.EmailEngagementActions.$C=function($p0){var $v_0=false;if($p0)for(var $v_1=0;$v_1<$p0.length;$v_1++)if($p0[$v_1].entityType!=="account"&&$p0[$v_1].entityType!=="contact"&&$p0[$v_1].entityType!=="lead")return true;return $v_0};Mscrm.EmailEngagementActions.getRecipientPreferences=function(){var $v_0="",$v_1="",$v_2="",$v_3=3,$v_4=0,$v_5=false,$v_6=false;Mscrm.EmailEngagementActions.$5=false;var $v_7=jQueryApi.jQueryDeferredFactory.Deferred(Array,Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.Responses.CrmErrorResponse),$v_8=[],$v_9=null,$v_A=null;if(Xrm.Page.getAttribute("to"))$v_9=Xrm.Page.getAttribute("to").getValue();if(Xrm.Page.getAttribute("cc"))$v_A=Xrm.Page.getAttribute("cc").getValue();$v_5=Mscrm.EmailEngagementActions.$C($v_9);$v_6=Mscrm.EmailEngagementActions.$C($v_A);if($v_5||$v_6){var $v_I=new Mscrm.RecipientResponse;$v_I.emailPreference=0;$v_8.push($v_I);Mscrm.EmailEngagementActions.$5=true;$v_7.resolve($v_8);return $v_7.promise()}if($v_9&&$v_9.length>0){var $v_J=Mscrm.EmailEngagementActions.$U($v_9,$v_0,$v_1,$v_2,$v_3);$v_0=$v_0+$v_J["account"];$v_1=$v_1+$v_J["contact"];$v_2=$v_2+$v_J["lead"]}if($v_A&&$v_A.length>0){var $v_K=Mscrm.EmailEngagementActions.$U($v_A,$v_0,$v_1,$v_2,$v_3);$v_0=$v_0+$v_K["account"];$v_1=$v_1+$v_K["contact"];$v_2=$v_2+$v_K["lead"]}var $v_B="<fetch version='1.0' mapping='logical' distinct='true'><entity name='{0}'><attribute name='{1}' /><attribute name='{2}' /><attribute name='{3}' /><filter type='and'><condition attribute='{4}' operator='in'>{5}</condition></filter></entity></fetch>",$v_C=String.format($v_B,"account","followemail","name","accountid","accountid",$v_0),$v_D=String.format($v_B,"contact","followemail","fullname","contactid","contactid",$v_1),$v_E=String.format($v_B,"lead","followemail","subject","leadid","leadid",$v_2),$v_F=jQueryApi.jQueryDeferredFactory.Deferred(Array,Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.Responses.CrmErrorResponse),$v_G=jQueryApi.jQueryDeferredFactory.Deferred(Array,Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.Responses.CrmErrorResponse),$v_H=jQueryApi.jQueryDeferredFactory.Deferred(Array,Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.Responses.CrmErrorResponse);if($v_0!=="")Xrm.Internal.messages.retrieveMultiple($v_C).then(function($p1_0){var $v_L=$p1_0.entityCollection;if($v_L.get_count()>0)for(var $v_M=0;$v_M<$v_L.get_count();$v_M++)if($v_L.get_item($v_M).hasField("followemail")){var $v_N=new Mscrm.RecipientResponse;$v_N.entityName="account";$v_N.entityDisplayName=$v_L.get_item($v_M).getValue("name").toString();$v_N.entityId=$v_L.get_item($v_M).getValue("accountid").toString();$v_N.emailPreference=$v_L.get_item($v_M).getValue("followemail").get_value();$v_8.push($v_N)}Mscrm.EmailEngagementActions.$1("entityFetchStatus",true,"Account");$v_F.resolve($v_8)},function($p1_0){Mscrm.EmailEngagementActions.$1("entityFetchStatus",false,"Account");$v_F.reject($p1_0)});else $v_F.resolve($v_8);if($v_1!=="")Xrm.Internal.messages.retrieveMultiple($v_D).then(function($p1_0){var $v_O=$p1_0.entityCollection;if($v_O.get_count()>0)for(var $v_P=0;$v_P<$v_O.get_count();$v_P++)if($v_O.get_item($v_P).hasField("followemail")){var $v_Q=new Mscrm.RecipientResponse;$v_Q.entityName="contact";$v_Q.entityDisplayName=$v_O.get_item($v_P).getValue("fullname").toString();$v_Q.emailPreference=$v_O.get_item($v_P).getValue("followemail").get_value();$v_Q.entityId=$v_O.get_item($v_P).getValue("contactid").toString();$v_8.push($v_Q)}Mscrm.EmailEngagementActions.$1("entityFetchStatus",true,"Contact");$v_G.resolve($v_8)},function($p1_0){Mscrm.EmailEngagementActions.$1("entityFetchStatus",false,"Contact");$v_G.reject($p1_0)});else $v_G.resolve($v_8);if($v_2!=="")Xrm.Internal.messages.retrieveMultiple($v_E).then(function($p1_0){var $v_R=$p1_0.entityCollection;if($v_R.get_count()>0)for(var $v_S=0;$v_S<$v_R.get_count();$v_S++)if($v_R.get_item($v_S).hasField("followemail")){var $v_T=new Mscrm.RecipientResponse;$v_T.entityName="lead";$v_T.entityDisplayName=$v_R.get_item($v_S).getValue("subject").toString();$v_T.emailPreference=$v_R.get_item($v_S).getValue("followemail").get_value();$v_T.entityId=$v_R.get_item($v_S).getValue("leadid").toString();$v_8.push($v_T)}Mscrm.EmailEngagementActions.$1("entityFetchStatus",true,"Lead");$v_H.resolve($v_8)},function($p1_0){Mscrm.EmailEngagementActions.$1("entityFetchStatus",false,"Lead");$v_H.reject($p1_0)});else $v_H.resolve($v_8);$v_F.then(function($p1_0){$v_4++;$v_4===$v_3&&$v_7.resolve($v_8)},function($p1_0){});$v_G.then(function($p1_0){$v_4++;$v_4===$v_3&&$v_7.resolve($v_8)},function($p1_0){});$v_H.then(function($p1_0){$v_4++;$v_4===$v_3&&$v_7.resolve($v_8)},function($p1_0){});return $v_7.promise()};Mscrm.EmailEngagementActions.prototype={$4_3:false,$2_3:false,$I_3:false,$H_3:true,$G_3:"emailreminderstatus",$3_3:"followemailuserpreference",$S_3:"EmailEngagementActionsHeader",$9_3:"isemailfollowed",$V_3:"to",$P_3:"cc",$D_3:"statuscode",$E_3:"BTDisplay",$N_3:"BTTrue",$F_3:"BTFalse",$O_3:"BTCancel",$L_3:"BTChange",$M_3:"BTAccept",$8_3:false,initialize:function(){Mscrm.CrmUIControl.prototype.initialize.call(this);var $v_0=$get("emailFollowUnfollow");if(!IsNull($v_0)&&Xrm.Page.getAttribute("directioncode").getValue()&&Mscrm.InternalUtilities.Utilities.isTurboForm()){if(Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString(Xrm.Page.data.entity.getId())){Xrm.Page.getAttribute(this.$9_3).setValue(true);Xrm.Page.getAttribute(this.$3_3).setValue(true)}Mscrm.EmailEngagementActions.initializeLocalizedStrings();this.$X_3();this.$j_3();this.$i_3();this.$k_3();this.$J_3(Xrm.Page.getAttribute(this.$9_3).getValue());this.$7_3();this.$A_3();Mscrm.EmailEngagementActions.$1("controlStatus",true,"Email Engagement Actions")}else!IsNull(Xrm.Page.ui)&&Xrm.Page.ui.controls.get("emailengagementactionscontrol")&&Mscrm.InternalUtilities.Utilities.isTurboForm()&&Xrm.Page.ui.controls.get("emailengagementactionscontrol").getParent().setVisible(false);if(Mscrm.InternalUtilities.Utilities.isTurboForm())this.$Q_3();else Mscrm.OnLoadDeferredExecutor.queueCallback(this.$$d_$Q_3,2)},$Q_3:function(){Mscrm.EmailEngagementActions.$o(this.get_element())},$J_3:function($p0){if(Xrm.Page.getAttribute(this.$3_3)){this.$2_3=Xrm.Page.getAttribute(this.$3_3).getValue();this.$t_3(this.$2_3&&$p0)}var $v_0=$get("email_followed"),$v_1=$get("email_cannot_be_followed"),$v_2=$get("email_cannot_be_followed_for_preference"),$v_3=$get("email_not_followed"),$v_4=$get("email_follow_unfollow_div_text");if(this.$4_3&&this.$2_3){$v_0.style.display="table";$v_1.style.display="none";$v_2.style.display="none";if(!this.$H_3)$v_4.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOWED+Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOW_DONTFOLLOW_ARIA_TEXT;$v_3.style.display="none"}else if(!this.$4_3&&this.$2_3){$v_0.style.display="none";$v_4.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOW+Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOW_DONTFOLLOW_ARIA_TEXT;$v_3.style.display="none";if(Mscrm.EmailEngagementActions.$5){$v_1.style.display="none";$v_2.style.display="table"}else{$v_1.style.display="table";$v_2.style.display="none"}}else{$v_0.style.display="none";$v_1.style.display="none";$v_2.style.display="none";$v_3.style.display="table"}this.$H_3=false},$t_3:function($p0){this.$4_3=$p0;this.$7_3()},$7_3:function(){var $v_0=Xrm.Internal.startMetricsStopwatch("ReminderRelatedStatesMetrics");$v_0.start();this.$8_3=false;var $v_1=$get("reminderSet"),$v_2=$get("reminderNotSet"),$v_3=$get("reminderSetAndHasWarning"),$v_4=$get("reminderMet");if(Xrm.Page.getAttribute("emailreminderexpirytime"))this.$I_3=Xrm.Page.getAttribute("emailreminderexpirytime").getValue();if(this.$I_3)if(Xrm.Page.getAttribute(this.$G_3).getValue()===2){this.$8_3=true;$v_1.style.display="none";$v_2.style.display="none";$v_3.style.display="none";$v_4.style.display="table"}else if(Xrm.Page.getAttribute("emailreminderexpirytime").getValue()<Mscrm.DateTimeUtility.localDateTimeNow()){this.$8_3=true;$v_1.style.display="none";$v_2.style.display="table";$v_3.style.display="none";$v_4.style.display="none"}else if(this.$4_3||Xrm.Page.getAttribute("emailremindertype").getValue()===2){$v_1.style.display="table";$v_2.style.display="none";$v_3.style.display="none";$v_4.style.display="none"}else{$v_1.style.display="none";$v_2.style.display="none";$v_3.style.display="table";$v_4.style.display="none"}else{$v_1.style.display="none";$v_2.style.display="table";$v_3.style.display="none";$v_4.style.display="none"}if(Xrm.Page.getAttribute("emailreminderexpirytime").getValue()){var $v_5=Xrm.Page.getAttribute("emailremindertype").getValue(),$v_6=Xrm.Page.getAttribute("emailreminderexpirytime").getValue(),$v_7=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortDatePattern"],$v_8=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortTimePattern"],$v_9=String.localeFormat("{0:"+$v_7+" "+$v_8+"}",$v_6),$v_A="",$v_B=this.$R_3();if(!$v_5)if($v_B==="")$v_A=String.format(Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION1_2,$v_9);else $v_A=String.format(Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION1_1,$v_B,$v_9);if($v_5===1)if($v_B==="")$v_A=String.format(Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION2_2,$v_9);else $v_A=String.format(Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION2_1,$v_B,$v_9);if($v_5===2)$v_A=String.format(Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION3_1,$v_9);var $v_C=$get("reminderSet_text");$v_C.innerText=$v_A;$v_C.setAttribute("aria-label",$v_A);$v_C.setAttribute("title",$v_A)}$v_0.stop()},$A_3:function(){var $v_0=Xrm.Internal.startMetricsStopwatch("DelayRelatedStatesMetrics");$v_0.start();var $v_1=$get("delaySendNotSet"),$v_2=$get("delaySendNotSet_hassuggestion"),$v_3=$get("delaySendSet"),$v_4=$get("emailSent");if(Xrm.Page.getAttribute("statuscode")&&(Xrm.Page.getAttribute("statuscode").getValue()===3||Xrm.Page.getAttribute("statuscode").getValue()===2)){$v_1.style.display="none";$v_2.style.display="none";$v_3.style.display="none";$v_4.style.display="none"}else if(Xrm.Page.getAttribute("delayedemailsendtime")&&!IsNull(Xrm.Page.getAttribute("delayedemailsendtime").getValue())){var $v_5=$get("delaySendSet_text"),$v_6=Xrm.Page.getAttribute("delayedemailsendtime").getValue(),$v_7=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortDatePattern"],$v_8=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortTimePattern"],$v_9=String.localeFormat("{0:"+$v_7+" "+$v_8+"}",$v_6);$v_5.innerText=String.format(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET,$v_9);$v_5.setAttribute("title",String.format(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET,$v_9));$v_5.setAttribute("aria-label",String.format(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET,$v_9));$v_1.style.display="none";$v_2.style.display="none";$v_3.style.display="table";$v_4.style.display="none"}else this.$g_3();$v_0.stop()},$g_3:function(){var $v_0="",$v_1=Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),$v_2="",$v_3=null,$v_4=null;if(Xrm.Page.getAttribute("to"))$v_3=Xrm.Page.getAttribute("to").getValue();if(Xrm.Page.getAttribute("cc"))$v_4=Xrm.Page.getAttribute("cc").getValue();if($v_3&&$v_3.length===1)if($v_3[0].entityType){$v_0=$v_3[0].name.toString();$v_1=new Microsoft.Crm.Client.Core.Framework.Guid($v_3[0].id);$v_2=$v_3[0].entityType}if($v_4&&$v_4.length===1)if($v_0===""&&$v_4[0].entityType){$v_0=$v_4[0].name.toString();$v_1=new Microsoft.Crm.Client.Core.Framework.Guid($v_4[0].id);$v_2=$v_4[0].entityType}else $v_0="";var $v_5=$get("delaySendNotSet"),$v_6=$get("delaySendNotSet_hassuggestion"),$v_7=$get("delaySendSet"),$v_8=$get("emailSent");if($v_0!==""){var $v_9=new Xrm.Objects.EntityReference($v_2,$v_1),$v_A=[$v_9],$$t_P=this,$$t_Q=this;Xrm.Internal.messages.bestTimeToEmail($v_A).then(function($p1_0){var $v_B=new Mscrm.BestTimeToEmailResponse,$v_C={};if($p1_0){$v_5.style.display="none";$v_6.style.display="table";$v_7.style.display="none";$v_8.style.display="none";var $v_D="",$v_E="";$v_C=$p1_0;$v_B=$v_C;var $v_F=$v_B.preferredTime,$v_G=new Date;$v_F.setMinutes($v_F.getMinutes()+$v_G.getTimezoneOffset());var $v_H=Mscrm.DateTimeUtility.localDateTimeNow();if(!$v_B.shouldDisplay){$v_5.style.display="table";$v_6.style.display="none";$v_7.style.display="none";$v_8.style.display="none";$$t_P.$0_3=Mscrm.EmailEngagementActions.$6}else{$$t_P.$0_3=$v_F;var $v_I=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortDatePattern"],$v_J=Sys.CultureInfo.CurrentCulture.dateTimeFormat["ShortTimePattern"],$v_K=String.localeFormat("{0:"+$v_I+" "+$v_J+"}",$v_F);$v_D=String.format(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SCH,$v_0,$v_K);$v_E=String.format(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_TOOLTIP_SUGGESTION,$v_B.weekDayStart,$v_B.weekDayEnd);var $v_L=$get("delaySendNotSet_hassuggestion_text");$v_L.innerText=$v_D;$v_L.setAttribute("title",$v_D);$v_L.setAttribute("aria-label",$v_D);var $v_M=$get("delaySendNotSet_hassuggestion_tooltiptext");$v_M.setAttribute("title",$v_E);$v_M.setAttribute("aria-label",$v_E)}}else{$v_5.style.display="table";$v_6.style.display="none";$v_7.style.display="none";$v_8.style.display="none";$$t_P.$0_3=Mscrm.EmailEngagementActions.$6}},function($p1_0){$v_5.style.display="table";$v_6.style.display="none";$v_7.style.display="none";$v_8.style.display="none";$$t_Q.$0_3=Mscrm.EmailEngagementActions.$6})}else{$v_5.style.display="table";$v_6.style.display="none";$v_7.style.display="none";$v_8.style.display="none";this.$0_3=Mscrm.EmailEngagementActions.$6}},handleEvent:function(eventCode,parameters,sourceComponent){return Mscrm.CrmUIControl.prototype.handleEvent.call(this,eventCode,parameters,sourceComponent)},dispose:function(){if(this.get_isDisposed())return;Mscrm.CrmUIControl.prototype.dispose.call(this)},$j_3:function(){var $v_0=$get("emailFollowUnfollow");if(!IsNull($v_0)){var $v_3=$get("email_followed_icon"),$v_4=$v_3.tabIndex,$v_5=$get(this.$S_3);$v_5.setAttribute("tabindex",$v_4-5);$v_5.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_HEADER);$v_5.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_HEADER);$v_5.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAILENGAGEMENT_TITLE;Sys.UI.DomElement.addCssClass($v_5,"clsEmailEngagementActions");var $v_6=$get("email_followed");if(!IsNull($v_6)){var $v_A=$get("email_followed_text");$v_A.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOWED;$v_A.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOWED);$v_A.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOWED);var $v_B=$get("email_followed_link");$v_B.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_DONT_FOLLOW;$addHandler($v_B,"click",this.$$d_$c_3);!(Xrm.Page.getAttribute(this.$D_3).getValue()===1)&&Sys.UI.DomElement.toggleCssClass($v_B,"emailLink-disabled");var $v_C=$get("emailFollowedHelpIcon");$v_C.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_HELP_TOOLTIP);$addHandler($v_C,"click",this.$$d_$h_3)}var $v_7=$get("email_cannot_be_followed");if(!IsNull($v_7)){var $v_D=$get("email_cannot_be_followed_text");$v_D.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOWED;$v_D.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOWED);$v_D.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOWED);var $v_E=$get("email_cannot_be_followed_link");$v_E.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_RECEIPIENTS_PREF;$addHandler($v_E,"click",this.$$d_$b_3);var $v_F=$get("email_retry_follow_link");$v_F.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_RETRY_FOLLOW;$addHandler($v_F,"click",this.$$d_$e_3);var $v_G=$get("email_donot_follow_link");$v_G.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_DONT_FOLLOW;$addHandler($v_G,"click",this.$$d_$c_3);if(!(Xrm.Page.getAttribute(this.$D_3).getValue()===1)){Sys.UI.DomElement.toggleCssClass($v_F,"emailLink-disabled");Sys.UI.DomElement.toggleCssClass($v_G,"emailLink-disabled")}var $v_H=$get("emailCantBeFollowedHelpIcon");$v_H.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_HELP_TOOLTIP);$addHandler($v_H,"click",this.$$d_$h_3)}var $v_8=$get("email_cannot_be_followed_for_preference");if(!IsNull($v_8)){var $v_I=$get("email_cannot_be_followed_for_preference_text");$v_I.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NON_FOLLOWABLE_ENTITY_TEXT;$v_I.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NON_FOLLOWABLE_ENTITY_TEXT);$v_I.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NON_FOLLOWABLE_ENTITY_TEXT);var $v_J=$get("emailCantBeFollowedForPreferenceHelpIcon");$v_J.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_HELP_TOOLTIP);$addHandler($v_J,"click",this.$$d_$h_3)}var $v_9=$get("email_not_followed");if(!IsNull($v_9)){var $v_K=$get("email_not_followed_text");$v_K.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOW;$v_K.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOW);$v_K.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_NOT_FOLLOW);var $v_L=$get("email_not_followed_link");$v_L.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_FOLLOW;$addHandler($v_L,"click",this.$$d_$d_3);!(Xrm.Page.getAttribute(this.$D_3).getValue()===1)&&Sys.UI.DomElement.toggleCssClass($v_L,"emailLink-disabled");var $v_M=$get("emailNotFollowedHelpIcon");$v_M.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_HELP_TOOLTIP);$addHandler($v_M,"click",this.$$d_$h_3)}}var $v_1=$get("delaySend");if(!IsNull($v_1)){var $v_N=$get("delaySendNotSet");if(!IsNull($v_N)){var $v_R=$get("delaySendNotSet_text");$v_R.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_MAIL;$v_R.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_MAIL);$v_R.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_MAIL);var $v_S=$get("delaySendNotSet_link");$v_S.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_DELAY_SEND;$addHandler($v_S,"click",this.$$d_$Z_3)}var $v_O=$get("delaySendNotSet_hassuggestion");if(!IsNull($v_O)){var $v_T=$get("delaySendNotSet_hassuggestion_text");$v_T.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SCH;$v_T.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SCH);$v_T.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SCH);var $v_U=$get("delaySendNotSet_hassuggestion_link");$v_U.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_DELAY_MAIL_TITLE;$addHandler($v_U,"click",this.$$d_$Y_3)}var $v_P=$get("delaySendSet");if(!IsNull($v_P)){var $v_V=$get("delaySendSet_text");$v_V.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET;$v_V.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET);$v_V.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_DELAY_SEND_SET);var $v_W=$get("delaySendSet_link");$v_W.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_CHANGE_SCHEDULE;$addHandler($v_W,"click",this.$$d_$a_3);var $v_X=$get("resetDelaySend_link");$v_X.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_REMOVE_DELAY;$addHandler($v_X,"click",this.$$d_$r_3)}var $v_Q=$get("emailSent");if(!IsNull($v_Q)){var $v_Y=$get("emailSent_text");$v_Y.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SENT;$v_Y.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SENT);$v_Y.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SENT);var $v_Z=$get("emailSent_link");$v_Z.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_SENT;$addHandler($v_Z,"click",this.$$d_$f_3)}}var $v_2=$get("emailReminder");if(!IsNull($v_2)){var $v_a=$get("reminderNotSet");if(!IsNull($v_a)){var $v_e=$get("reminderNotSet_text");$v_e.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMINDER;$v_e.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMINDER);$v_e.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMINDER);var $v_f=$get("reminderNotSet_link");$v_f.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_SET_REMINDER;$addHandler($v_f,"click",this.$$d_$p_3)}var $v_b=$get("reminderSet");if(!IsNull($v_b)){var $v_g=$get("reminderSet_text");$v_g.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMIND_EMAIL_NOREPLYBY;$v_g.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMIND_EMAIL_NOREPLYBY);$v_g.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_REMIND_EMAIL_NOREPLYBY);var $v_h=$get("reminderSet_link");$v_h.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_CHANGE_REMINDER;$addHandler($v_h,"click",this.$$d_$q_3);var $v_i=$get("reminderRemove_link");$v_i.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_REMOVE_REMINDER;$addHandler($v_i,"click",this.$$d_$s_3)}var $v_c=$get("reminderSetAndHasWarning");if(!IsNull($v_c)){var $v_j=$get("reminderSetAndHasWarning_text");$v_j.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_NOT_FOLLOWED;$v_j.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_NOT_FOLLOWED);$v_j.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_NOT_FOLLOWED);var $v_k=$get("reminderHasWarning_change_link");$v_k.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_CHANGE_REMINDER;$addHandler($v_k,"click",this.$$d_$q_3);var $v_l=$get("reminderHasWarning_remove_link");$v_l.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_REMOVE_REMINDER;$addHandler($v_l,"click",this.$$d_$s_3)}var $v_d=$get("reminderMet");if(!IsNull($v_d)){var $v_m=$get("reminderMet_text");$v_m.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_CONDITION_MET;$v_m.setAttribute("title",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_CONDITION_MET);$v_m.setAttribute("aria-label",Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_CONDITION_MET);var $v_n=$get("reminderMet_link");$v_n.innerText=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_LINK_SET_REMINDER;$addHandler($v_n,"click",this.$$d_$q_3)}}},$h_3:function($p0){var $v_0=Mscrm.CrmUri.create(Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_LINK_HELP_URL);openStdWin($v_0,"_blank",1e3,600,null,"")},$B_3:function(){var $v_0=Xrm.Internal.startMetricsStopwatch("FollowRelatedStatesMetrics");$v_0.start();var $v_1=true,$$t_5=this,$$t_6=this;Mscrm.EmailEngagementActions.getRecipientPreferences().then(function($p1_0){if(!$p1_0.length)$$t_5.$J_3(true);else{for(var $v_2=0;$v_2<$p1_0.length;$v_2++)$v_1=$v_1&&($p1_0[$v_2].emailPreference===1?true:false);$$t_5.$J_3($v_1)}$v_0.stop()},function($p1_0){})},$i_3:function(){var $v_0=Xrm.Page.getAttribute(this.$9_3);$v_0&&$v_0.addOnChange(this.$$d_$m_3);var $v_1=Xrm.Page.getAttribute(this.$3_3);$v_1&&$v_1.addOnChange(this.$$d_$m_3);var $v_2=Xrm.Page.getAttribute(this.$G_3);$v_2&&$v_2.addOnChange(this.$$d_$n_3);var $v_3=Xrm.Page.getAttribute(this.$V_3);if($v_3){$v_3.addOnChange(this.$$d_$m_3);$v_3.addOnChange(this.$$d_$l_3)}var $v_4=Xrm.Page.getAttribute(this.$P_3);if($v_4){$v_4.addOnChange(this.$$d_$m_3);$v_4.addOnChange(this.$$d_$l_3)}},$m_3:function($p0){this.$B_3()},$l_3:function($p0){this.$A_3()},$n_3:function($p0){this.$7_3()},$c_3:function($p0){var $v_0=new Xrm.ConfirmDialogStrings;$v_0.title=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_DIALOG_TITLE_DONOT_FOLLOW;$v_0.subtitle=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_ERROR_DIALOG_CANCEL_RECIPIENT_ACTIVITY;$v_0.text=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_ERROR_DIALOG_CANCEL_RECIPIENT_ACTIVITY;$v_0.confirmButtonLabel=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_BUTTON_OK;$v_0.cancelButtonLabel=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_BUTTON_CANCEL;var $$t_2=this,$$t_3=this;Xrm.Dialog.openConfirmDialog($v_0,null,function(){Xrm.Page.getAttribute($$t_2.$3_3).setValue(false);$$t_2.$B_3();window.setTimeout(function(){$get("email_not_followed_link").focus()},100)},function(){$p0.target.focus()})},$b_3:function($p0){var $v_0=new Xrm.DialogOptions;$v_0.height=410;$v_0.width=400;var $v_1={},$$t_9=this,$$t_A=this;Mscrm.EmailEngagementActions.getRecipientPreferences().then(function($p1_0){$p1_0.sort(function($p2_0,$p2_1){var $v_2=$p2_0,$v_3=$p2_1;if($v_2.emailPreference!==$v_3.emailPreference)return $v_2.emailPreference-$v_3.emailPreference;else return $v_2.entityDisplayName.localeCompare($v_3.entityDisplayName)});$v_1["preferences"]=$p1_0;$v_1["tableHeaderLeft"]=Mscrm.EmailEngagementActions.localizedStrings.VIEW_CONTACT_PREFERENCES_INLINEDLG_TABLEHEADINGLEFT;$v_1["tableHeaderRight"]=Mscrm.EmailEngagementActions.localizedStrings.VIEW_CONTACT_PREFERENCES_INLINEDLG_TABLEHEADINGRIGHT;$v_1["followText"]=Mscrm.EmailEngagementActions.localizedStrings.VIEW_CONTACT_PREFERENCES_INLINEDLG_FOLLOW;$v_1["donotFollowText"]=Mscrm.EmailEngagementActions.localizedStrings.VIEW_CONTACT_PREFERENCES_INLINEDLG_DONOTFOLLOW;Xrm.Dialog.openDialog("ContactPreferences",$v_0,$v_1,$$t_9.$$d_onEmailFollowedDialogCloseCallback,null)},function($p1_0){})},onEmailFollowedDialogCloseCallback:function(outputArgs,callbackParameters){var $$t_2=this;window.setTimeout(function(){$get("email_cannot_be_followed_link").focus()},100)},$e_3:function($p0){this.$B_3();$p0.target.focus()},$d_3:function($p0){var $v_0=new Xrm.ConfirmDialogStrings;$v_0.title=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_DIALOG_TITLE_FOLLOW;$v_0.text=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_WARNING_ATTACHMENTS;$v_0.subtitle=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_WARNING_ATTACHMENTS;$v_0.confirmButtonLabel=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_BUTTON_OK;$v_0.cancelButtonLabel=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ACT_BUTTON_CANCEL;var $$t_2=this,$$t_3=this;Xrm.Dialog.openConfirmDialog($v_0,null,function(){Xrm.Page.getAttribute($$t_2.$3_3).setValue(true);$$t_2.$B_3();window.setTimeout(function(){$get("email_followed_link").focus()},100)},function(){$p0.target.focus()})},$K_3:function(){var $v_0=new Xrm.DialogOptions;$v_0.height=230;$v_0.width=450;var $v_1={};$v_1["isSetFromBestTimeToEmail"]="false";if(!IsNull(Xrm.Page.getAttribute("delayedemailsendtime"))&&Xrm.Page.getAttribute("delayedemailsendtime").getValue())$v_1["delayedSendTime"]=Xrm.Page.getAttribute("delayedemailsendtime").getValue();else if(this.$0_3>Mscrm.DateTimeUtility.localDateTimeNow()){$v_1["delayedSendTime"]=this.$0_3;$v_1["isSetFromBestTimeToEmail"]="true";var $v_4={};$v_4["bestTimeToEmailSuggestion"]=$v_1["delayedSendTime"];$v_4["bestTimeToEmailSuggestionUsed"]=this.$E_3;$v_4["data"]=this.$E_3;Mscrm.MetricsReporting.instance().addMetric("besttimetoemail",$v_4)}else{var $v_5=Mscrm.DateTimeUtility.localDateTimeNow();$v_5.setDate($v_5.getDate()+2);$v_1["delayedSendTime"]=$v_5}var $v_2=$v_1["delayedSendTime"];$v_1["footerText"]=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_DELAY_SEND_INLINEDLG_FOOTERTEXT;$v_1["dateErrorText"]=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_DIALOG_DATE_ERROR;$v_1["lastButtonClicked"]="";$v_1["now"]=Mscrm.DateTimeUtility.localDateTimeNow().getTime();$v_1["UserSpecificShortDatePattern"]=Mscrm.DateTimeUtility.getShortDateFormat();$v_1["UserSpecificShortTimePattern"]=Mscrm.DateTimeUtility.getShortTimeFormat();var $v_3=this.$$d_sendLaterCallback;Xrm.Dialog.openDialog("DelaySend",$v_0,$v_1,$v_3,$v_1)},$Z_3:function($p0){this.$K_3()},sendLaterCallback:function(dialogParams,callbackParams){if(IsNull(dialogParams)||dialogParams["lastButtonClicked"]!=="ok_id"){if(callbackParams&&("isSetFromBestTimeToEmail" in callbackParams&&callbackParams["isSetFromBestTimeToEmail"]==="true")){var $v_1={};$v_1["bestTimeToEmailSuggestion"]=callbackParams["delayedSendTime"];$v_1["bestTimeToEmailSuggestionUsed"]=this.$F_3;$v_1["data"]=this.$O_3;Mscrm.MetricsReporting.instance().addMetric("besttimetoemail",$v_1)}var $$t_6=this;window.setTimeout(function(){$get("delaySendNotSet_link").focus()},100);return}var $v_0=dialogParams["delayedSendTime"];if($v_0){if(callbackParams&&("isSetFromBestTimeToEmail" in callbackParams&&callbackParams["isSetFromBestTimeToEmail"]==="true")){var $v_2={};if("delayedSendTime" in callbackParams){var $v_3=callbackParams["delayedSendTime"];if($v_0.toString()==$v_3.toString()){$v_2["bestTimeToEmailSuggestionUsed"]=this.$N_3;$v_2["data"]=this.$M_3}}else{$v_2["data"]=this.$L_3;$v_2["bestTimeToEmailSuggestionUsed"]=this.$F_3}$v_2["bestTimeToEmailSuggestion"]=$v_0.toString();Mscrm.MetricsReporting.instance().addMetric("besttimetoemail",$v_2)}Xrm.Page.getAttribute("delayedemailsendtime").setValue($v_0.getTime());this.$A_3();var $$t_7=this;window.setTimeout(function(){$get("delaySendSet_link").focus()},100)}else{var $$t_8=this;window.setTimeout(function(){$get("delaySendNotSet_link").focus()},100)}},$k_3:function(){var $v_0=$get("EmailEngagementParentcontainer");if(Mscrm.InternalUtilities.Utilities.isHighContrastEnabled())!Sys.UI.DomElement.containsCssClass($v_0,"EmailEngagementActions-HighContrast")&&Sys.UI.DomElement.addCssClass($v_0,"EmailEngagementActions-HighContrast");else Sys.UI.DomElement.containsCssClass($v_0,"EmailEngagementActions-HighContrast")&&Sys.UI.DomElement.removeCssClass($v_0,"EmailEngagementActions-HighContrast")},$Y_3:function($p0){this.$K_3()},$a_3:function($p0){this.$K_3()},$f_3:function($p0){},$p_3:function($p0){this.$T_3()},setReminderCallback:function(dialogParams,callbackParams){if(IsNull(dialogParams)||dialogParams["lastButtonClicked"]!=="ok_id"){var $$t_3=this;window.setTimeout(function(){$get("reminderNotSet_link").focus()},100);return}var $v_0=dialogParams["reminderDateSelected"];if(!$v_0)return;Xrm.Page.getAttribute("emailreminderexpirytime").setValue($v_0.getTime());Xrm.Page.getAttribute("emailremindertype").setValue(dialogParams["reminderOptionSelected"]);Xrm.Page.getAttribute("emailremindertext").setValue(dialogParams["reminderTextSelected"]);this.$7_3();var $$t_4=this;window.setTimeout(function(){$get("reminderSet_link").focus()},100)},$T_3:function(){var $v_0=new Xrm.DialogOptions;$v_0.height=370;$v_0.width=530;var $v_1=Mscrm.DateTimeUtility.localDateTimeNow();$v_1.setDate($v_1.getDate()+2);var $v_2={};$v_2["reminderOptionSelected"]=Xrm.Page.getAttribute("emailremindertype").getValue();$v_2["reminderTextSelected"]=Xrm.Page.getAttribute("emailremindertext").getValue();if(!IsNull(Xrm.Page.getAttribute("emailreminderexpirytime")))if(Xrm.Page.getAttribute("emailreminderexpirytime").getValue())if(!this.$8_3)$v_2["reminderDateSelected"]=Xrm.Page.getAttribute("emailreminderexpirytime").getValue();else $v_2["reminderDateSelected"]=null;else $v_2["reminderDateSelected"]=$v_1;else $v_2["reminderDateSelected"]=$v_1;$v_2["footerTextOption1_single_recipient"]=Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION1_1;$v_2["footerTextOption1_ignore_recipient"]=Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION1_2;$v_2["footerTextOption2_single_recipient"]=Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION2_1;$v_2["footerTextOption2_ignore_recipient"]=Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION2_2;$v_2["footerTextOption3"]=Mscrm.EmailEngagementActions.localizedStrings.SET_REMINDER_INLINEDLG_REMINDOPTION3_1;$v_2["dateErrorText"]=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_DIALOG_DATE_ERROR;if(!this.$4_3&&this.$2_3)$v_2["invalidChoice"]=Mscrm.EmailEngagementActions.localizedStrings.EMAIL_ENGAGEMENT_ACTIONS_REMINDER_NOT_FOLLOWED;else $v_2["invalidChoice"]=Mscrm.EmailEngagementActions.localizedStrings.FOLLOW_EMAIL_INVALID_CHOICE;$v_2["isEmailFollowedValue"]=this.$4_3&&this.$2_3;$v_2["now"]=Mscrm.DateTimeUtility.localDateTimeNow().getTime();var $v_3=this.$R_3();if($v_3!=="")$v_2["recipientName"]=$v_3;$v_2["lastButtonClicked"]="";$v_2["UserSpecificShortDatePattern"]=Mscrm.DateTimeUtility.getShortDateFormat();$v_2["UserSpecificShortTimePattern"]=Mscrm.DateTimeUtility.getShortTimeFormat();var $v_4=this.$$d_setReminderCallback;Xrm.Dialog.openDialog("EmailReminder",$v_0,$v_2,$v_4,null)},$R_3:function(){var $v_0="",$v_1=null,$v_2=null;if(Xrm.Page.getAttribute("to"))$v_1=Xrm.Page.getAttribute("to").getValue();if(Xrm.Page.getAttribute("cc"))$v_2=Xrm.Page.getAttribute("cc").getValue();if($v_1&&$v_1.length===1)$v_0=$v_1[0].name.toString();if($v_2&&$v_2.length===1)if($v_0==="")$v_0=$v_2[0].name.toString();else $v_0="";return $v_0},$s_3:function($p0){Xrm.Page.getAttribute("emailremindertype").setValue("0");Xrm.Page.getAttribute("emailremindertext").setValue(null);Xrm.Page.getAttribute("emailreminderexpirytime").setValue(null);this.$7_3();var $$t_1=this;window.setTimeout(function(){$get("reminderNotSet_link").focus()},100)},$r_3:function($p0){Xrm.Page.getAttribute("delayedemailsendtime").setValue(null);this.$A_3();var $$t_1=this;window.setTimeout(function(){$get("delaySendNotSet_link").focus()},100)},$q_3:function($p0){this.$T_3()},$X_3:function(){Mscrm.EmailEngagementActions.$5=false;var $v_0=false,$v_1=false,$v_2=[],$v_3=null,$v_4=null;if(Xrm.Page.getAttribute("to"))$v_3=Xrm.Page.getAttribute("to").getValue();if(Xrm.Page.getAttribute("cc"))$v_4=Xrm.Page.getAttribute("cc").getValue();$v_0=Mscrm.EmailEngagementActions.$C($v_3);$v_1=Mscrm.EmailEngagementActions.$C($v_4);if($v_0||$v_1){var $v_5=new Mscrm.RecipientResponse;$v_5.emailPreference=0;$v_2.push($v_5);Mscrm.EmailEngagementActions.$5=true}}};Mscrm.BestTimeToEmailResponse=function(){};Mscrm.BestTimeToEmailResponse.prototype={preferredTime:null,weekDayStart:null,weekDayEnd:null,shouldDisplay:0};Mscrm.RecipientResponse=function(){};Mscrm.RecipientResponse.prototype={entityId:null,entityName:null,emailPreference:0,entityDisplayName:null};Mscrm.EmailEngagementActions.registerClass("Mscrm.EmailEngagementActions",Mscrm.CrmUIControl);Mscrm.BestTimeToEmailResponse.registerClass("Mscrm.BestTimeToEmailResponse");Mscrm.RecipientResponse.registerClass("Mscrm.RecipientResponse");Mscrm.EmailEngagementActions.$6=Mscrm.DateTimeUtility.localDateTimeNow();Mscrm.EmailEngagementActions.$5=false;Mscrm.EmailEngagementActions.localizedStrings=null