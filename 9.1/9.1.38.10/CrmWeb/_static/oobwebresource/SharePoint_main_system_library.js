var __extends=this&&this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)},DocumentManagement;(function(DocumentManagement){var SharePointConstants;(function(SharePointConstants){var Guids;(function(Guids){Guids.ONEDRIVE_LOCATION_NOT_CREATED="d311bf6e-6683-4583-9909-69f7182da440";Guids.ALL_FILES_LOCATION_GUID="BEF666F6-2EAD-4B6A-BCD4-22D87DFFF51E";Guids.SHARED_LOCATION_GUID="17DE0DBB-153C-4C1A-B98A-223B3EA10125";Guids.GUID_EMPTY="00000000-0000-0000-0000-000000000000"})(Guids=SharePointConstants.Guids||(SharePointConstants.Guids={}));var ErrorCodes;(function(ErrorCodes){ErrorCodes.DUPLICATION_ERROR_CODE=2147878668;ErrorCodes.DUPLICATION_ERROR_CODE_SOAP_CALL=-2147088628})(ErrorCodes=SharePointConstants.ErrorCodes||(SharePointConstants.ErrorCodes={}));var Commands;(function(Commands){Commands.EDIT_SHAREPOINT_DOCUMENT="SharePointDocumentEdit";Commands.UPLOAD_SHAREPOINT_DOCUMENT="SharePointDocumentUpload";Commands.UPLOAD_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentUploadSuccess";Commands.UPLOAD_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentUploadFailure";Commands.CHECKIN_SHAREPOINT_DOCUMENT="SharePointDocumentCheckIn";Commands.CHECKIN_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentCheckinSuccess";Commands.CHECKIN_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentCheckinFailure";Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT="SharePointDocumentAddLocation";Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentAddLocationSuccess";Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentAddLocationFailure";Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT="SharePointDocumentEditLocation";Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentEditLocationSuccess";Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentEditLocationFailure";Commands.CHECKOUT_SHAREPOINT_DOCUMENT="SharePointDocumentCheckout";Commands.CHECKOUT_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentCheckoutSuccess";Commands.CHECKOUT_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentCheckoutFailure";Commands.OPEN_LOCATION_SHAREPOINT_DOCUMENT="SharePointDocumentOpenLocation";Commands.DELETE_SHAREPOINT_DOCUMENT="SharePointDocumentDelete";Commands.DELETE_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentDeleteSuccess";Commands.DELETE_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentDeleteFailure";Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT="SharePointDocumentEditProperties";Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentEditPropertiesSuccess";Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentEditPropertiesFailure";Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT="SharePointDocumentDiscardCheckout";Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentDiscardCheckoutSuccess";Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentDiscardCheckoutFailure";Commands.CHANGE_LOCAITON_SHAREPOINT_DOCUMENT="SharePointDocumentChangeLocation";Commands.NEW_SHAREPOINT_DOCUMENT="SharePointDocumentNewDocument";Commands.NEW_SHAREPOINT_DOCUMENT_SUCCESS="SharePointDocumentNewDocumentSuccess";Commands.NEW_SHAREPOINT_DOCUMENT_FAILURE="SharePointDocumentNewDocumentFailure";Commands.UPDATE_FOLDER_SHAREPOINT_DOCUMENT="SharePointUpdateFolder";Commands.ONEDRIVE_CONFIRM_DIALOG="ConfirmFolderForOneDriveSuccess";Commands.RENAME_ODB_FOLDER_SUCCESS="RenameODBFolderSuccess";Commands.RENAME_ODB_FOLDER_FAILURE="RenameODBFolderFailure";Commands.ONEDRIVE_FRE_SUCCESS="OneDriveFirstRunExperienceSuccess";Commands.ONEDRIVE_FRE_FAILURE="OneDriveFirstRunExperienceFailure";Commands.CREATE_FOLDER_SUCCESS="CreateFolderSuccess";Commands.CREATE_FOLDER_FAILURE="CreateFolderFailure"})(Commands=SharePointConstants.Commands||(SharePointConstants.Commands={}));var MDDConstants;(function(MDDConstants){MDDConstants.DIALOG_OPTIONS="DialogOptions";MDDConstants.LOCATION_ID="location_Id";MDDConstants.LOCATION_ID_URL_PARAMETER="locationId";MDDConstants.VIEW_ID_URL_PARAMETER="viewId";MDDConstants.DOCUMENT_ID="document_Id";MDDConstants.ENTITY_ID="entity_Id";MDDConstants.ENTITY_NAME="entity_Name";MDDConstants.REGARDING_OBJECT_ID="regarding_Object_Id";MDDConstants.REGARDING_OBJECT_ENTITY_NAME="regarding_Object_EntityName";MDDConstants.GRID_CONTROL="grid_Control";MDDConstants.EVENT_CONTEXT="event_context";MDDConstants.COMMENTS="comments";MDDConstants.IS_RETAIN="isRetain";MDDConstants.ENTITY_TYPE_CODE="entity_Type_Code";MDDConstants.MODE="mode_Value";MDDConstants.FOLDER_NAME="folder_Name";MDDConstants.LOCATION_NAME="location_Name";MDDConstants.RELATIVE_LOCATION="relative_Location";MDDConstants.LAST_BUTTON_CLICKED="last_Button_Clicked";MDDConstants.FULLNAME="full_Name";MDDConstants.FILE_TYPE="file_Type";MDDConstants.SHAREPOINT_DOCUMENT_ID="sharePoint_Document_Id";MDDConstants.USE_FALLBACK="use_Fallback";MDDConstants.FULL_NAME="full_Name";MDDConstants.TITLE="title_Value";MDDConstants.CREATED_BY="created_By";MDDConstants.CREATED_ON="created_On";MDDConstants.MODIFIED_BY="modified_By";MDDConstants.MODIFIED_ON="modified_On";MDDConstants.DOCUMENT_TYPE="document_Type";MDDConstants.USEFALLBACK_TRUE="1";MDDConstants.USEFALLBACK_FALSE="0";MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_TITLE="SharePointUpdateFolder";MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_DESCRIPTION="SharePointUpdateFolderDescription";MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_TEXT="SharePointAddFolderDescriptionText";MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_TITLE="ODB_Confirm_Dialog";MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_DESCRIPTION="ODB_Confirm_Dialog_Description";MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_SUB_DESCRIPTION="ODB_Confirm_Dialog_Sub_Description"})(MDDConstants=SharePointConstants.MDDConstants||(SharePointConstants.MDDConstants={}));var ParameterConstants;(function(ParameterConstants){ParameterConstants.FILE_NAME="filename";ParameterConstants.FOLDER_NAME="foldername";ParameterConstants.REGARDING_OBJECT_ID="regardingObjectId";ParameterConstants.REGARDING_ENTITY_LOGICAL_NAME="regardingEntityLogicalName";ParameterConstants.RECORD_NAME="recordName";ParameterConstants.LOCATION_ID="locationId";ParameterConstants.SITE_TYPE="sitetype";ParameterConstants.ENTITY_REFERENCE="entityReference"})(ParameterConstants=SharePointConstants.ParameterConstants||(SharePointConstants.ParameterConstants={}));var EntityTypeCode;(function(EntityTypeCode){EntityTypeCode.SHAREPOINT_SITE=9502})(EntityTypeCode=SharePointConstants.EntityTypeCode||(SharePointConstants.EntityTypeCode={}));var DialogNames;(function(DialogNames){DialogNames.SHAREPOINT_NEWDOCUMENT_DIALOG="NewSharePointDocument";DialogNames.SHAREPOINT_EDIT_DOCUMENT_PROPERTIES_DIALOG="EditSharePointDocumentProperties";DialogNames.SHAREPOINT_UPLOAD_DIALOG="UploadSharePointDocument";DialogNames.SHAREPOINT_CHECKIN_DIALOG="SharePointDocumentCheckin";DialogNames.SHAREPOINT_ADD_LOCATION_DIALOG="AddSharePointLocation"})(DialogNames=SharePointConstants.DialogNames||(SharePointConstants.DialogNames={}));var ResourceStrings;(function(ResourceStrings){ResourceStrings.LABEL_TO_DISPLAY_FOR_ONEDRIVECONFIG="OneDriveConfigLabel";ResourceStrings.DIALOG_DELETESHAREPOINTCONFIRM_TITLE="Dialog_DeleteSharePointConfirm_Title";ResourceStrings.DIALOG_DELETESHAREPOINTCONFIRM_DESCRIPTION="Dialog_DeleteAccountConfirm_Description";ResourceStrings.BUTTON_LABEL_DELETE="Button_Label_Delete";ResourceStrings.DIALOG_DISCARDCHECKOUT_TITLE="Web._grid.cmds.dlg_discardcheckout.aspx_discardTitle";ResourceStrings.DIALOG_DISCARDCHECKOUT_SUBTITLE="Web._grid.cmds.dlg_discardcheckout.aspx_discardDescription";ResourceStrings.DIALOG_DISCARDCHECKOUT_TEXT="Web._grid.cmds.dlg_discardcheckout.aspx_discardconfirm";ResourceStrings.BUTTON_LABEL_CONFIRM="Button_Label_Confirm";ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_CREATEDON_INFORMATION="Web._grid.cmds.dlg_editdocumentproperties.CreationInformation";ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_MODIFICATION_INFORMATION="Web._grid.cmds.dlg_editdocumentproperties.ModificationInformation";ResourceStrings.DIALOG_EDIT_LOCATION_TITLE="EditLocationHeaderTitle";ResourceStrings.DIALOG_EDIT_LOCATION_SUBHEADER_FIRST="EditLocationDialogHeader";ResourceStrings.DIALOG_EDIT_LOCATION_PARENTSITEORLOCATION_LABEL="EditParentSiteOrLocationLabel";ResourceStrings.DIALOG_NEWFOLDER_HEADER="NewFolderDialogHeader";ResourceStrings.DIALOG_WORD_HEADER="WordDocumentDialogHeader";ResourceStrings.DIALOG_EXCEL_HEADER="ExcelDialogHeader";ResourceStrings.DIALOG_ONENOTE_HEADER="OneNoteDialogHeader";ResourceStrings.DIALOG_POWERPOINT_HEADER="PowerPointDialogHeader";ResourceStrings.DIALOG_EDIT_LOCATION_SUBHEADER_SECOND="EditLocationParentSiteLocation";ResourceStrings.LOCID_INVALID_FOLDER_NAME="Error_Message_0x80048054";ResourceStrings.LOCID_INVALID_FILE_NAME="Error_Message_0x8004700c";ResourceStrings.LOCID_DOCM_FOLDERNAME_MAXLENGTH="DocumentManagement.AddLocation.FolderName.Maxlength.Exceeded";ResourceStrings.LOCID_GENERIC_MESSAGE="DocumentManagement.CreateFolder.GenericError";ResourceStrings.LOCID_SPECIAL_MESSAGE="DocumentManagement.CreateFolder.ConflictError";ResourceStrings.LOCID_SITE_NAME_NOTIFICATION="SharePointSiteError";ResourceStrings.DIALOG_ADDSHAREPOINTLOCATION_DISPLAYNAME_VALUE="DocumentManagement.DefaultLocationName.Text";ResourceStrings.PROCESSING_LABEL="ProcessingLabel";ResourceStrings.ALERT_UPLOAD_NOFILESELECTED="Upload_NoFileSelected";ResourceStrings.ALERT_UPLOAD_MAXFILESIZE="Upload_FileSizeGreaterThanMax";ResourceStrings.ALERT_UPLOAD_MINFILESIZE="Upload_FileSizeLesserThanMin";ResourceStrings.ONEDRIVE_CONFIGURATION_CANCELLED="OneDriveConfiguration_cancelled_message";ResourceStrings.ONEDRIVE_CONFIGURATION_ERROR="OneDriveConfiguration_error_message";ResourceStrings.LOCID_ENTER_SP_FOLDER_NAME="OneDriveBusinessSettings_EmptyFolderName_Message"})(ResourceStrings=SharePointConstants.ResourceStrings||(SharePointConstants.ResourceStrings={}));var EntityNames;(function(EntityNames){EntityNames.SHAREPOINT_DOCUMENT_ENTITY="sharepointdocument";EntityNames.SHAREPOINT_LOCATION_ENTITY="sharepointdocumentlocation";EntityNames.SHAREPOINT_SITE_ENTITY="sharepointsite";EntityNames.PRIVILEGE_ENTITY="privilege";EntityNames.ROLE_PRIVILEGES_ENTITY="roleprivileges";EntityNames.SYSTEM_USER_ENTITY="systemuser";EntityNames.ORGANIZATION_ENTITY="organization"})(EntityNames=SharePointConstants.EntityNames||(SharePointConstants.EntityNames={}));var AttributeNames;(function(AttributeNames){AttributeNames.DEFAULT_ODB_FOLDER_NAME="defaultodbfoldername";AttributeNames.SHAREPOINT_LOCATION_ID="sharepointdocumentlocationid";AttributeNames.SHAREPOINT_LOCATION_NAME="name";AttributeNames.SHAREPOINT_LOCATION_TYPE="locationtype";AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION="parentsiteorlocation";AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA="_parentsiteorlocation_value";AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_NAME="_parentsiteorlocation_value@OData.Community.Display.V1.FormattedValue";AttributeNames.REGARDING_OBJECT_ID_FOR_ODATA="_regardingobjectid_value";AttributeNames.SHAREPOINT_LOCATION_PARENT_CODE="parentsiteorlocationtypecode";AttributeNames.SHAREPOINT_LOCATION_PARENT_NAME="parentsiteorlocationname";AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID="sitecollectionid";AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL="relativeurl";AttributeNames.SHAREPOINT_LOCATION_CREATED_ON="createdon";AttributeNames.SHAREPOINT_SERVICE_TYPE="servicetype";AttributeNames.SHAREPOINT_SITE_ID="sharepointsiteid";AttributeNames.SHAREPOINT_DOCUMENT_ID="sharepointdocumentid";AttributeNames.SHAREPOINT_DOCUMENT_FULL_NAME="fullname";AttributeNames.SHAREPOINT_DOCUMENT_TITLE="title";AttributeNames.SHAREPOINT_DOCUMENT_AUTHOR="author";AttributeNames.SHAREPOINT_DOCUMENT_CREATED_BY="createdby";AttributeNames.SHAREPOINT_DOCUMENT_CREATED_ON="sharepointcreatedon";AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED_BY="sharepointmodifiedby";AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED="modified";AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE="filetype";AttributeNames.DOCUMENT_ID="documentid";AttributeNames.LOCATION_ID="locationid";AttributeNames.SHAREPOINT_FULL_NAME="fullname";AttributeNames.SHAREPOINT_DOCUMENT_LOCATION_NAME="locationname";AttributeNames.SHAREPOINT_RELATIVE_LOCATION="relativelocation";AttributeNames.SHAREPOINT_SITE_NAME="name";AttributeNames.SHAREPOINT_SITE_COLLECTION_ID="sitecollectionid";AttributeNames.SHAREPOINT_SITE_IS_GRID_PRESENT="isgridpresent";AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL="absoluteurl";AttributeNames.SHAREPOINT_SITE_EDIT_URL="editurl";AttributeNames.SHAREPOINT_SITE_READ_URL="readurl";AttributeNames.SHAREPOINT_SITE_IS_DEFAULT="isdefault";AttributeNames.SHAREPOINT_SITE_FOLDER_STRUCTURE_ENTITY="folderstructureentity";AttributeNames.OBJECT_ID="oid";AttributeNames.REGARDING_OBJECT_ID="regardingobjectid";AttributeNames.REGARDING_OBJECT_TYPE_CODE="regardingobjecttypecode";AttributeNames.STATE_CODE="statecode";AttributeNames.STATUS_CODE="statuscode";AttributeNames.SERVICE_TYPE="servicetype";AttributeNames.USER_ID="userid";AttributeNames.MODIFIED_ON="modifiedon";AttributeNames.CREATED_BY="createdby";AttributeNames.SHAREPOINT_ID="sharepointsiteid";AttributeNames.PARENT_SITE_OR_LOCATION="parentsiteorlocation";AttributeNames.RETRIEVE_URL="relativeurl";AttributeNames.PRIVILEGE_NAME="name";AttributeNames.PRIVILEGE_ID="privilegeid";AttributeNames.CAN_BE_BASIC="canbebasic";AttributeNames.CAN_BE_LOCAL="canbelocal";AttributeNames.CAN_BE_DEEP="canbedeep";AttributeNames.CAN_BE_GLOBAL="canbeglobal";AttributeNames.ROLE_ID="roleid";AttributeNames.IS_ONEDRIVE_ENABLED="isonedriveenabled";AttributeNames.IS_MSTEAMS_ENABLED="ismsteamsenabled";AttributeNames.SYSTEM_USER_ID="systemuserid";AttributeNames.ORGANIZATION_ID="organizationid";AttributeNames.ATTRIBUTE_NAME="name";AttributeNames.ONE_DRIVE_SITE_TYPE=1;AttributeNames.IS_SHAREPOINT_ENABLED="IsDocumentManagementEnabled";AttributeNames.IS_MSTEAMS_INTEGRATION_ENABLED="IsMSTeamsIntegrationEnabled";AttributeNames.FCB_SHAREPOINT_S2S="SharePointS2S";AttributeNames.FCB_MSTEAMS_INTEGRATION="MSTeamsIntegration"})(AttributeNames=SharePointConstants.AttributeNames||(SharePointConstants.AttributeNames={}));var FormXMLControls;(function(FormXMLControls){FormXMLControls.DOCUMENT_NAME_CONTROL="documentname_id";FormXMLControls.LOCATION_ID_CONTROL="documentlocation_id";FormXMLControls.HEADER_CONTROL_NEW_DOCUMENT_DIALOG="lbl_newsharepointdocument";FormXMLControls.FULLNAME_CONTROL="fullname_id";FormXMLControls.FOLDER_NAME_TO_DISPLAY_CONTROL="folder_name_to_display_id";FormXMLControls.MODIFIEDON_CONTROL="lbl_modifiedon_id";FormXMLControls.CREATEDON_CONTROL="lbl_createdon_id";FormXMLControls.DOCUMENT_LOCATION_OPTIONSET="documentlocation_id";FormXMLControls.RETAIN_CHECKOUT_CONTROL="retaincheckout_id";FormXMLControls.TITLE_CONTROL="title_id";FormXMLControls.OK_BUTTON_CONTROL="ok_id";FormXMLControls.CONTINUE_BUTTON_CONTROL="continue_id";FormXMLControls.COMMENTS_CONTROL="comments_id";FormXMLControls.FILEUPLOAD_CONTROL="attachmentfile_id";FormXMLControls.UPLOAD_DOCUMENT_FILENAME="param_AttachmentFileName";FormXMLControls.OVERWRITE_CONTROL="overwrite_id";FormXMLControls.UPLOAD_DOCUMENT_FILESIZE="id_UploadedFileSize";FormXMLControls.HEADER_CONTROL_ADD_LOCATION_DIALOG="lbl_addlocation";FormXMLControls.FOLDER_NAME_CONTROL="foldername_id";FormXMLControls.EDIT_LOCATION_SUBHEADER_CONTROL_FIRST="lbl_addlocation_locationname";FormXMLControls.EDIT_LOCATION_SUBHEADER_CONTROL_SECOND="lbl_addlocation_foldername";FormXMLControls.EDIT_LOCATION_PARENTSITEORLOCATION_LABEL="parentsite_id";FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL="documentlocation_id";FormXMLControls.EDIT_LOCATION_DISPLAY_NAME_CONTROL="documentlocation_id";FormXMLControls.PARENT_SITE_CONTROL="parentsite_id";FormXMLControls.LOCATION_MESSAGE="lbl_location_message"})(FormXMLControls=SharePointConstants.FormXMLControls||(SharePointConstants.FormXMLControls={}));SharePointConstants.ODATA_BIND_CONSTANTS="@odata.bind";SharePointConstants.ODATA_TYPE_CONSTANTS="@odata.type";SharePointConstants.ODATA_ENTITY_CONSTANTS="Microsoft.Dynamics.CRM.";SharePointConstants.SHARED_WITH_ME_URL_FORMAT="{0}/Documents/Forms/SharedWithMe.aspx/#";SharePointConstants.OBJECT_ID="oid";SharePointConstants.OPTIONS="Options";SharePointConstants.ATTRIBUTE_LOGICAL_NAME="AttributeLogicalName";SharePointConstants.ASSOCIATED_GRID_RIBBON_IDENTIFIER="associatedGridRibbon";SharePointConstants.CONFIRM_DIALOG_STRINGS="ConfirmDialogStrings";SharePointConstants.ODB_OPTION_TEXT="OneDrive";SharePointConstants.ADD_LOCATION_HEADER_TITLE="Add Location";SharePointConstants.EDIT_LOCATION_HEADER_TITLE="Edit Location";SharePointConstants.IS_DEFAULT="isdefault";SharePointConstants.PRIVILEGE_ONE_DRIVE="prvOneDrive";SharePointConstants.SHAREPOINT_SITE_ENTITY_TYPE_CODE=9502;SharePointConstants.FOLDER="folder";SharePointConstants.ONETOC2="onetoc2";SharePointConstants.DOCUMENT_ID="documentId";SharePointConstants.LOCATION_ID="locationId";SharePointConstants.ENTITY_ID="entityId";SharePointConstants.ABSOLUTE_URL="absoluteUrl";SharePointConstants.EDIT_URL="editUrl";SharePointConstants.CLIENT_TYPE="clientType";SharePointConstants.ERROR_RESPONSE="ErrorResponse";SharePointConstants.FILETYPE="filetype";SharePointConstants.ONEDRIVE_LOCATION_NAME_KEY="Odb_Location_Title";SharePointConstants.SHARED_WITH_ME_LOCATION_NAME_KEY="SharedWithMe_Location_Title";SharePointConstants.ALL_LOCATIONS_NAME_KEY="All_Locations_Title";SharePointConstants.FCB_ONENOTE_INTEGRATION="OneNoteIntegration";SharePointConstants.FOLDER_NAME_REGEX_STRING='[:~""#%&*<>?/\\{|}.]';SharePointConstants.FOLDER_NAME_MAX_LENGTH=128;SharePointConstants.FILE_NAME_MAX_LENGTH=120;SharePointConstants.IFRAME_FOLDER_NAME="foldername";SharePointConstants.IFRAME_LOCATION_NAME="locationname";SharePointConstants.SITE_COLLECTION_URL="_siteCollectionUrl";SharePointConstants.SELECTED_LOCATION_URL="_selectedLocationUrl";var OneDriveDialog;(function(OneDriveDialog){OneDriveDialog.REGARDING_OBJECT_ID="regardingObjectId";OneDriveDialog.SITE_TYPE="siteType";OneDriveDialog.LOCATION_NAME="locationName";OneDriveDialog.FILE_NAME="fileName";OneDriveDialog.FOLDER_NAME="foldername";OneDriveDialog.GRID_CONTROL="gridControl"})(OneDriveDialog=SharePointConstants.OneDriveDialog||(SharePointConstants.OneDriveDialog={}));var GridParams;(function(GridParams){GridParams.LOCATION_ID="locationId";GridParams.RELATIVE_LOCATION="relativeLocation";GridParams.LOCATION_NAME="locationName"})(GridParams=SharePointConstants.GridParams||(SharePointConstants.GridParams={}));var MenuParams;(function(MenuParams){MenuParams.CHANGE_LOCATION_CONTROL_ID="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SubGrid.SharePointDocument.ChangeLocation";MenuParams.EDIT_LOCATION_CONTROL_ID="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SubGrid.SharePointDocument.EditLocation";MenuParams.OPEN_IN_SHAREPOINT_CONTROL_ID="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SubGrid.SharePointDocument.OpenInSharePoint";MenuParams.CHANGE_LOCATION_COMMAND="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SharePointChangeLocation";MenuParams.EDIT_LOCATION_COMMAND="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SharePointEditLocation";MenuParams.OPEN_IN_SHAREPOINT_COMMAND="sharepointdocument|NoRelationship|SubGridAssociated|Mscrm.SharePointOpenSource";MenuParams.CHANGE_LOCATION_SUBGRID_CONTROL_ID="sharepointdocument|NoRelationship|SubGridStandard|Mscrm.SubGrid.SharePointDocument.ChangeLocation";MenuParams.EDIT_LOCATION_SUBGRID_CONTROL_ID="sharepointdocument|NoRelationship|SubGridStandard|Mscrm.SubGrid.SharePointDocument.EditLocation";MenuParams.OPEN_IN_SHAREPOINT_SUBGRID_CONTROL_ID="sharepointdocument|NoRelationship|SubGridStandard|Mscrm.SubGrid.SharePointDocument.OpenInSharePoint"})(MenuParams=SharePointConstants.MenuParams||(SharePointConstants.MenuParams={}));SharePointConstants.ROOT_LOCATION_MESSAGE_FORMAT='The document will be created inside location "{0}"';SharePointConstants.LOCATION_MESSAGE_FORMAT='The document will be created at "{0}" inside location "{1}"'})(SharePointConstants=DocumentManagement.SharePointConstants||(DocumentManagement.SharePointConstants={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var DialogUtilities;(function(DialogUtilities){var DialogName=function(){function DialogName(){}DialogName.SHAREPOINT_NEWDOCUMENT_DIALOG="NewSharePointDocument";DialogName.SHAREPOINT_EDIT_DOCUMENT_PROPERTIES_DIALOG="EditSharePointDocumentProperties";DialogName.SHAREPOINT_UPLOAD_DIALOG="UploadSharePointDocument";DialogName.SHAREPOINT_CHECKIN_DIALOG="SharePointDocumentCheckIn";DialogName.SHAREPOINT_ADD_LOCATION_DIALOG="AddSharePointLocation";DialogName.ONE_DRIVE_CONFIGURATION_DIALOG="OneDriveConfigurationDialog";DialogName.ONE_DRIVE_FOLDER_SETTINGS_DIALOG="OneDriveFolderSettings";return DialogName}();DialogUtilities.DialogName=DialogName;var DialogConstants=function(){function DialogConstants(){}DialogConstants.DefaultGuidString="00000000-0000-0000-0000-000000000000";DialogConstants.DefaultFormattedGuidString="{00000000-0000-0000-0000-000000000000}";DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED="d311bf6e-6683-4583-9909-69f7182da440";DialogConstants.ALL_FILES_LOCATION_GUID="BEF666F6-2EAD-4B6A-BCD4-22D87DFFF51E";DialogConstants.SHARED_LOCATION_GUID="17DE0DBB-153C-4C1A-B98A-223B3EA10125";return DialogConstants}();DialogUtilities.DialogConstants=DialogConstants})(DialogUtilities=DocumentManagement.DialogUtilities||(DocumentManagement.DialogUtilities={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var EntityUtilities;(function(EntityUtilities){var EntityNames=function(){function EntityNames(){}EntityNames.None="none";EntityNames.Account="account";EntityNames.ActionCard="actioncard";EntityNames.SyncError="syncerror";EntityNames.AccountLeads="accountleads";EntityNames.ActivityMimeAttachment="activitymimeattachment";EntityNames.ActivityParty="activityparty";EntityNames.ActivityPointer="activitypointer";EntityNames.AdvancedSimilarityRule="advancedsimilarityrule";EntityNames.Annotation="annotation";EntityNames.AnnualFiscalCalendar="annualfiscalcalendar";EntityNames.ApplicationFile="applicationfile";EntityNames.Appointment="appointment";EntityNames.AsyncOperation="asyncoperation";EntityNames.Attachment="attachment";EntityNames.AttributeMap="attributemap";EntityNames.Audit="audit";EntityNames.AzureServiceConnection="azureserviceconnection";EntityNames.BaseAddEntityObjectTypeCode="baseaddentityobjecttypecode";EntityNames.BulkDeleteFailure="bulkdeletefailure";EntityNames.BulkDeleteOperation="bulkdeleteoperation";EntityNames.BulkOperation="bulkoperation";EntityNames.BulkOperationLog="bulkoperationlog";EntityNames.BusinessDataLocalizedLabel="businessdatalocalizedlabel";EntityNames.BusinessUnit="businessunit";EntityNames.BusinessUnitMap="businessunitmap";EntityNames.BusinessUnitNewsArticle="businessunitnewsarticle";EntityNames.Calendar="calendar";EntityNames.CalendarRule="calendarrule";EntityNames.Campaign="campaign";EntityNames.CampaignActivity="campaignactivity";EntityNames.CampaignActivityItem="campaignactivityitem";EntityNames.CampaignItem="campaignitem";EntityNames.CampaignResponse="campaignresponse";EntityNames.ChannelProperty="channelproperty";EntityNames.ChannelPropertyGroup="channelpropertygroup";EntityNames.ClientUpdate="clientupdate";EntityNames.ColumnMapping="columnmapping";EntityNames.Commitment="commitment";EntityNames.Competitor="competitor";EntityNames.CompetitorAddress="competitoraddress";EntityNames.CompetitorProduct="competitorproduct";EntityNames.CompetitorSalesLiterature="competitorsalesliterature";EntityNames.ComplexControl="complexcontrol";EntityNames.Connection="connection";EntityNames.ConnectionRole="connectionrole";EntityNames.ConnectionRoleAssociation="connectionroleassociation";EntityNames.ConnectionRoleObjectTypeCode="connectionroleobjecttypecode";EntityNames.ConvertRule="convertrule";EntityNames.ConvertRuleItem="convertruleitem";EntityNames.ConstraintBasedGroup="constraintbasedgroup";EntityNames.Contact="contact";EntityNames.ContactInvoices="contactinvoices";EntityNames.ContactLeads="contactleads";EntityNames.ContactOrders="contactorders";EntityNames.ContactQuotes="contactquotes";EntityNames.Contract="contract";EntityNames.ContractDetail="contractdetail";EntityNames.ContractTemplate="contracttemplate";EntityNames.CustomerAddress="customeraddress";EntityNames.CustomerOpportunityRole="customeropportunityrole";EntityNames.CustomerRelationship="customerrelationship";EntityNames.Dependency="dependency";EntityNames.DependencyNode="dependencynode";EntityNames.Discount="discount";EntityNames.DiscountType="discounttype";EntityNames.DisplayString="displaystring";EntityNames.DisplayStringMap="displaystringmap";EntityNames.DocumentIndex="documentindex";EntityNames.DocumentTemplate="documenttemplate";EntityNames.DuplicateRecord="duplicaterecord";EntityNames.DuplicateRule="duplicaterule";EntityNames.DuplicateRuleCondition="duplicaterulecondition";EntityNames.DynamicProperty="dynamicproperty";EntityNames.DelveActionHub="delveactionhub";EntityNames.DynamicPropertyOptionSetItem="dynamicpropertyoptionsetitem";EntityNames.Email="email";EntityNames.EmailHash="emailhash";EntityNames.EmailSearch="emailsearch";EntityNames.EmailServerProfile="emailserverprofile";EntityNames.EmailSignature="emailsignature";EntityNames.Entitlement="entitlement";EntityNames.EntityMap="entitymap";EntityNames.Equipment="equipment";EntityNames.EntitlementChannel="entitlementchannel";EntityNames.EntitlementTemplateChannel="entitlementtemplatechannel";EntityNames.Fax="fax";EntityNames.FieldPermission="fieldpermission";EntityNames.FieldSecurityProfile="fieldsecurityprofile";EntityNames.FilterTemplate="filtertemplate";EntityNames.FixedMonthlyFiscalCalendar="fixedmonthlyfiscalcalendar";EntityNames.Goal="goal";EntityNames.GoalRollupQuery="goalrollupquery";EntityNames.Import="import";EntityNames.ImportData="importdata";EntityNames.ImportEntityMapping="importentitymapping";EntityNames.ImportFile="importfile";EntityNames.ImportJob="importjob";EntityNames.ImportLog="importlog";EntityNames.ImportMap="importmap";EntityNames.Incident="incident";EntityNames.IncidentResolution="incidentresolution";EntityNames.IntegrationStatus="integrationstatus";EntityNames.InternalAddress="internaladdress";EntityNames.InterProcessLock="interprocesslock";EntityNames.InvalidDependency="invaliddependency";EntityNames.Invoice="invoice";EntityNames.InvoiceDetail="invoicedetail";EntityNames.IsvConfig="isvconfig";EntityNames.KbArticle="kbarticle";EntityNames.KbArticleComment="kbarticlecomment";EntityNames.KbArticleTemplate="kbarticletemplate";EntityNames.NewKbArticle="newkbarticle";EntityNames.KnowledgeArticle="knowledgearticle";EntityNames.KnowledgeArticlesCategories="knowledgearticlescategories";EntityNames.KnowledgeArticleIncident="knowledgearticleincident";EntityNames.KnowledgeArticleViews="knowledgearticleviews";EntityNames.KnowledgeSearchModel="knowledgesearchmodel";EntityNames.LanguageLocale="languagelocale";EntityNames.Lead="lead";EntityNames.LeadAddress="leadaddress";EntityNames.LeadCompetitors="leadcompetitors";EntityNames.LeadProduct="leadproduct";EntityNames.Letter="letter";EntityNames.License="license";EntityNames.List="list";EntityNames.ListMember="listmember";EntityNames.LookUpMapping="lookupmapping";EntityNames.Mailbox="mailbox";EntityNames.MailMergeTemplate="mailmergetemplate";EntityNames.Metric="metric";EntityNames.MobileOfflineProfile="mobileofflineprofile";EntityNames.MobileOfflineProfileItem="mobileofflineprofileitem";EntityNames.MonthlyFiscalCalendar="monthlyfiscalcalendar";EntityNames.Notification="notification";EntityNames.Notes="annotation";EntityNames.OfficeDocument="officedocument";EntityNames.Opportunity="opportunity";EntityNames.OpportunityClose="opportunityclose";EntityNames.OpportunityCompetitors="opportunitycompetitors";EntityNames.OpportunityProduct="opportunityproduct";EntityNames.OrderClose="orderclose";EntityNames.Organization="organization";EntityNames.OrganizationStatistic="organizationstatistic";EntityNames.OrganizationUI="organizationui";EntityNames.Owner="owner";EntityNames.OwnerMapping="ownermapping";EntityNames.PersonalDocumentTemplate="personaldocumenttemplate";EntityNames.PhoneCall="phonecall";EntityNames.PickListMapping="picklistmapping";EntityNames.PluginAssembly="pluginassembly";EntityNames.PluginType="plugintype";EntityNames.PluginTypeStatistic="plugintypestatistic";EntityNames.PluginTraceLog="plugintracelog";EntityNames.Post="post";EntityNames.PostComment="postcomment";EntityNames.PostFollow="postfollow";EntityNames.PostLike="postlike";EntityNames.PostRegarding="postregarding";EntityNames.PostRole="postrole";EntityNames.PriceLevel="pricelevel";EntityNames.PrincipalAttributeAccessMap="principalattributeaccessmap";EntityNames.PrincipalEntityMap="principalentitymap";EntityNames.PrincipalObjectAccess="principalobjectaccess";EntityNames.PrincipalObjectAccessReadSnapshot="principalobjectaccessreadsnapshot";EntityNames.PrincipalObjectAttributeAccess="principalobjectattributeaccess";EntityNames.Privilege="privilege";EntityNames.PrivilegeObjectTypeCodes="privilegeobjecttypecodes";EntityNames.ChannelAccessProfileEntityAccessLevel="channelaccessprofileentityaccesslevel";EntityNames.ProcessSession="processsession";EntityNames.Product="product";EntityNames.ProductAssociation="productassociation";EntityNames.ProductPriceLevel="productpricelevel";EntityNames.ProductSalesLiterature="productsalesliterature";EntityNames.ProductSubstitute="productsubstitute";EntityNames.Publisher="publisher";EntityNames.PublisherAddress="publisheraddress";EntityNames.QuarterlyFiscalCalendar="quarterlyfiscalcalendar";EntityNames.Queue="queue";EntityNames.QueueItem="queueitem";EntityNames.Quote="quote";EntityNames.QuoteClose="quoteclose";EntityNames.QuoteDetail="quotedetail";EntityNames.RecommendationModel="recommendationmodel";EntityNames.RecommendationModelVersion="recommendationmodelversion";EntityNames.RecordCountSnapshot="recordcountsnapshot";EntityNames.RecurrenceRule="recurrencerule";EntityNames.RecurringAppointmentMaster="recurringappointmentmaster";EntityNames.RelationshipRole="relationshiprole";EntityNames.RelationshipRoleMap="relationshiprolemap";EntityNames.ReplicationBacklog="replicationbacklog";EntityNames.Report="report";EntityNames.ReportCategory="reportcategory";EntityNames.ReportEntity="reportentity";EntityNames.ReportLink="reportlink";EntityNames.ReportVisibility="reportvisibility";EntityNames.Resource="resource";EntityNames.ResourceGroup="resourcegroup";EntityNames.ResourceGroupExpansion="resourcegroupexpansion";EntityNames.ResourceSpec="resourcespec";EntityNames.RibbonCommand="ribboncommand";EntityNames.RibbonContextGroup="ribboncontextgroup";EntityNames.RibbonCustomization="ribboncustomization";EntityNames.RibbonDiff="ribbondiff";EntityNames.RibbonRule="ribbonrule";EntityNames.RibbonTabToCommandMap="ribbontabtocommandmap";EntityNames.Role="role";EntityNames.RolePrivileges="roleprivileges";EntityNames.RoleTemplate="roletemplate";EntityNames.RoleTemplatePrivileges="roletemplateprivileges";EntityNames.RollupField="rollupfield";EntityNames.SalesLiterature="salesliterature";EntityNames.SalesLiteratureItem="salesliteratureitem";EntityNames.SalesOrder="salesorder";EntityNames.SalesOrderDetail="salesorderdetail";EntityNames.SalesProcessInstance="salesprocessinstance";EntityNames.SavedQuery="savedquery";EntityNames.SavedQueryVisualization="savedqueryvisualization";EntityNames.SdkMessage="sdkmessage";EntityNames.SdkMessageFilter="sdkmessagefilter";EntityNames.SdkMessagePair="sdkmessagepair";EntityNames.SdkMessageProcessingStep="sdkmessageprocessingstep";EntityNames.SdkMessageProcessingStepImage="sdkmessageprocessingstepimage";EntityNames.SdkMessageProcessingStepSecureConfig="sdkmessageprocessingstepsecureconfig";EntityNames.SdkMessageRequest="sdkmessagerequest";EntityNames.SdkMessageRequestField="sdkmessagerequestfield";EntityNames.SdkMessageResponse="sdkmessageresponse";EntityNames.SdkMessageResponseField="sdkmessageresponsefield";EntityNames.SemiAnnualFiscalCalendar="semiannualfiscalcalendar";EntityNames.Service="service";EntityNames.ServiceAppointment="serviceappointment";EntityNames.ServiceContractContacts="servicecontractcontacts";EntityNames.ServiceEndpoint="serviceendpoint";EntityNames.SharePointDocumentLocation="sharepointdocumentlocation";EntityNames.SharePointData="sharepointdata";EntityNames.SharePointDocument="sharepointdocument";EntityNames.SharePointSite="sharepointsite";EntityNames.Site="site";EntityNames.SiteMap="sitemap";EntityNames.Solution="solution";EntityNames.SocialActivity="socialactivity";EntityNames.SocialProfile="socialprofile";EntityNames.SolutionComponent="solutioncomponent";EntityNames.StatusMap="statusmap";EntityNames.StringMap="stringmap";EntityNames.Subject="subject";EntityNames.Subscription="subscription";EntityNames.SubscriptionClients="subscriptionclients";EntityNames.SubscriptionManuallyTrackedObject="subscriptionmanuallytrackedobject";EntityNames.SubscriptionSyncInfo="subscriptionsyncinfo";EntityNames.SubscriptionTrackingDeletedObject="subscriptiontrackingdeletedobject";EntityNames.SystemForm="systemform";EntityNames.SystemUser="systemuser";EntityNames.Position="position";EntityNames.SystemUserBusinessUnitEntityMap="systemuserbusinessunitentitymap";EntityNames.SystemUserLicenses="systemuserlicenses";EntityNames.SystemUserPrincipals="systemuserprincipals";EntityNames.SystemUserProfiles="systemuserprofiles";EntityNames.SystemUserRoles="systemuserroles";EntityNames.Task="task";EntityNames.Team="team";EntityNames.TeamMembership="teammembership";EntityNames.TeamProfiles="teamprofiles";EntityNames.TeamRoles="teamroles";EntityNames.TeamTemplate="teamtemplate";EntityNames.Template="template";EntityNames.Territory="territory";EntityNames.Theme="theme";EntityNames.TimeZoneDefinition="timezonedefinition";EntityNames.TimeZoneLocalizedName="timezonelocalizedname";EntityNames.TimeZoneRule="timezonerule";EntityNames.TopicModel="topicmodel";EntityNames.TransactionCurrency="transactioncurrency";EntityNames.TransformationMapping="transformationmapping";EntityNames.TransformationParameterMapping="transformationparametermapping";EntityNames.UnresolvedAddress="unresolvedaddress";EntityNames.UoM="uom";EntityNames.UoMSchedule="uomschedule";EntityNames.UserEntityInstanceData="userentityinstancedata";EntityNames.UserEntityUISettings="userentityuisettings";EntityNames.UserFiscalCalendar="userfiscalcalendar";EntityNames.UserForm="userform";EntityNames.UserQuery="userquery";EntityNames.UserQueryVisualization="userqueryvisualization";EntityNames.UserSettings="usersettings";EntityNames.WebResource="webresource";EntityNames.WebWizard="webwizard";EntityNames.WizardAccessPrivilege="wizardaccessprivilege";EntityNames.WizardPage="wizardpage";EntityNames.Workflow="workflow";EntityNames.WorkflowDependency="workflowdependency";EntityNames.WorkflowLog="workflowlog";EntityNames.WorkflowWaitSubscription="workflowwaitsubscription";EntityNames.RoutingRule="routingrule";EntityNames.RoutingRuleItem="routingruleitem";EntityNames.HierarchyRule="hierarchyrule";EntityNames.SLA="sla";EntityNames.SLAItem="slaitem";EntityNames.SLAKPIInstance="slakpiinstance";EntityNames.DataPerformance="dataperformance";EntityNames.ChannelAccessProfileRule="channelaccessprofilerule";EntityNames.ChannelAccessProfileRuleItem="channelaccessprofileruleitem";EntityNames.ExternalParty="externalparty";EntityNames.ExternalPartyItem="externalpartyitem";EntityNames.Category="category";return EntityNames}();EntityUtilities.EntityNames=EntityNames})(EntityUtilities=DocumentManagement.EntityUtilities||(DocumentManagement.EntityUtilities={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Query;(function(Query){var ConditionalOperatorDictionary={};ConditionalOperatorDictionary[0]="eq";ConditionalOperatorDictionary[1]="ne";ConditionalOperatorDictionary[2]="ge";ConditionalOperatorDictionary[3]="gt";ConditionalOperatorDictionary[4]="le";ConditionalOperatorDictionary[5]="lt";ConditionalOperatorDictionary[7]="in";ConditionalOperatorDictionary[6]="like";ConditionalOperatorDictionary[8]="null";ConditionalOperatorDictionary[9]="not-null";var FilterTypeDictionary={};FilterTypeDictionary[0]="and";FilterTypeDictionary[1]="or";var LinkTypeDictionary={};LinkTypeDictionary[0]="inner";LinkTypeDictionary[1]="outer";var SortingOrderTypeDictionary={};SortingOrderTypeDictionary[0]="ascending";SortingOrderTypeDictionary[1]="descending";var FetchExpression=function(){function FetchExpression(){this._distinct=false;this._mapping="logical";this._attributes=[];this._filters=[];this._linkEntities=[]}Object.defineProperty(FetchExpression.prototype,"Distinct",{"set":function(distinct){this._distinct=distinct},enumerable:true,configurable:true});Object.defineProperty(FetchExpression.prototype,"Mapping",{"set":function(mapping){this._mapping=mapping},enumerable:true,configurable:true});Object.defineProperty(FetchExpression.prototype,"PageInfo",{"set":function(pageInfo){this._pageInfo=pageInfo},enumerable:true,configurable:true});Object.defineProperty(FetchExpression.prototype,"EntityName",{"get":function(){return this._entityName},"set":function(entityName){this._entityName=entityName},enumerable:true,configurable:true});FetchExpression.prototype.AddAttribute=function(attribute){this._attributes.push(attribute)};FetchExpression.prototype.AddAttributes=function(attributes){this._attributes.push.apply(this._attributes,attributes)};FetchExpression.prototype.AddFilter=function(filter){this._filters.push(filter)};FetchExpression.prototype.AddLinkEntity=function(linkEntity){this._linkEntities.push(linkEntity)};Object.defineProperty(FetchExpression.prototype,"Order",{"set":function(order){this._order=order},enumerable:true,configurable:true});FetchExpression.prototype.toString=function(){var pageInfoStr="";if(this._pageInfo!=null)pageInfoStr=this._pageInfo.toString();var fetchXml="<fetch mapping='"+this._mapping+"' distinct='"+this._distinct+"' "+pageInfoStr+">";fetchXml+="<entity name='"+this._entityName+"'>";for(var attrNode,_i=0,_a=this._attributes;_i<_a.length;_i++){var attribute=_a[_i];attrNode="<attribute name='"+attribute+"' />";fetchXml+=attrNode}for(var _b=0,_c=this._filters;_b<_c.length;_b++){var filter=_c[_b];fetchXml+=filter.toString()}for(var _d=0,_e=this._linkEntities;_d<_e.length;_d++){var linkEntity=_e[_d];fetchXml+=linkEntity.toString()}if(this._order!=null)fetchXml+=this._order.toString();fetchXml+="</entity>";fetchXml+="</fetch>";return fetchXml};return FetchExpression}();Query.FetchExpression=FetchExpression;var Condition=function(){function Condition(attrName,op,attrValue,entityName){this._entityName=null;this._attributeName=attrName;this._operator=op;this._attributeValue=attrValue;if(entityName)this._entityName=entityName}Condition.prototype.toString=function(){var fetchXml="";if(this._operator==7){fetchXml+="<condition attribute='"+this._attributeName+"' operator='"+ConditionalOperatorDictionary[this._operator]+"'>";for(var _i=0,_a=this._attributeValue;_i<_a.length;_i++){var value=_a[_i];fetchXml+="<value>"+value+"</value>"}fetchXml+="</condition>"}else{var alias=this._entityName==null?"":" entityname='"+this._entityName+"'",attributeValue=this._attributeValue==null?"":" value='"+this._attributeValue.toString()+"'";fetchXml+="<condition attribute='"+this._attributeName+"' operator='"+ConditionalOperatorDictionary[this._operator]+"'"+attributeValue+alias+"/>"}return fetchXml};return Condition}();Query.Condition=Condition;var Filter=function(){function Filter(){this._type=0;this._conditions=[];this._filters=[]}Object.defineProperty(Filter.prototype,"Type",{"set":function(type){this._type=type},enumerable:true,configurable:true});Filter.prototype.AddCondition=function(condition){this._conditions.push(condition)};Filter.prototype.AddFilter=function(filter){this._filters.push(filter)};Filter.prototype.toString=function(){var fetchXml="";if(this._filters.length==0&&this._conditions.length==0)return fetchXml;fetchXml+="<filter type='"+FilterTypeDictionary[this._type]+"'>";for(var _i=0,_a=this._conditions;_i<_a.length;_i++){var condition=_a[_i];fetchXml+=condition.toString()}for(var _b=0,_c=this._filters;_b<_c.length;_b++){var filter=_c[_b];fetchXml+=filter.toString()}fetchXml+="</filter>";return fetchXml};return Filter}();Query.Filter=Filter;var LinkEntity=function(){function LinkEntity(toEntity,toAttribute,fromAttribute,linkType,alias){if(linkType===void 0)linkType=0;this._linkType=0;this._attributes=[];this._filters=[];this._referencedEntityName=toEntity;this._referencedAttributeName=toAttribute;this._referencingAttributeName=fromAttribute;this._linkType=linkType;this._alias=alias}LinkEntity.prototype.AddAttribute=function(attribute){this._attributes.push(attribute)};LinkEntity.prototype.AddAttributes=function(attributes){this._attributes.push.apply(this._attributes,attributes)};LinkEntity.prototype.AddFilter=function(filter){this._filters.push(filter)};LinkEntity.prototype.toString=function(){var fetchXml="",aliasStr=this._alias==null?"":" alias='"+this._alias+"' ";fetchXml+="<link-entity name='"+this._referencedEntityName+"' to='"+this._referencedAttributeName+"' from='"+this._referencingAttributeName+"' link-type='"+LinkTypeDictionary[this._linkType]+"'"+aliasStr+">";for(var attrNode,_i=0,_a=this._attributes;_i<_a.length;_i++){var attribute=_a[_i];attrNode="<attribute name='"+attribute+"' />";fetchXml+=attrNode}for(var _b=0,_c=this._filters;_b<_c.length;_b++){var filter=_c[_b];fetchXml+=filter.toString()}fetchXml+="</link-entity>";return fetchXml};return LinkEntity}();Query.LinkEntity=LinkEntity;var Order=function(){function Order(attribute,orderType){this._attributeName=attribute;this._orderType=orderType}Order.prototype.toString=function(){var fetchXml="";fetchXml+="<order attribute='"+this._attributeName+"' "+SortingOrderTypeDictionary[this._orderType]+"='true' />";return fetchXml};return Order}();Query.Order=Order;var PageInfo=function(){function PageInfo(numberOfPages,countPerPage){this._pages=numberOfPages;this._count=countPerPage}PageInfo.prototype.toString=function(){var pageInfoStr="";if(this._pages!=null)pageInfoStr+=" page='"+this._pages.toString()+"' ";if(this._count!=null)pageInfoStr+=" count='"+this._count.toString()+"' ";return pageInfoStr};return PageInfo}();Query.PageInfo=PageInfo})(Query=DocumentManagement.Query||(DocumentManagement.Query={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var SdkMessage=function(){function SdkMessage(){}SdkMessage.Retrieve=function(entityLogicalName,entityId,columns,eventContext,successCallback,errorCallback){var options="?$select="+columns.join(",");Xrm.WebApi.online.retrieveRecord(entityLogicalName,entityId,options).then(function(response){successCallback(eventContext,response)},function(err){errorCallback(err)})};SdkMessage.RetrieveMultiple=function(eventContext,entityLogicalName,fetchXMLQuery,successCallback,errorCallback){fetchXMLQuery="?fetchXml="+fetchXMLQuery;Xrm.WebApi.online.retrieveMultipleRecords(entityLogicalName,fetchXMLQuery).then(function(collection){successCallback(eventContext,collection.entities)},function(err){errorCallback(err)})};SdkMessage.FetchSiteUrl=function(documentId,entityReference,successCallback,errorCallback){var fetchsiteurl=new DocumentManagement.FetchSiteUrlRequest(documentId,entityReference);Xrm.WebApi.online.execute(fetchsiteurl).then(function(successResponse){successResponse.json().then(function(parsedResponse){successCallback(parsedResponse.SiteAndLocationUrl)})},function(err){errorCallback(err)})};SdkMessage.AddOrEditLocation=function(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,successCallback,errorCallback){var addOrEditLocation=new DocumentManagement.AddOrEditLocationRequest(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference);Xrm.WebApi.online.execute(addOrEditLocation).then(function(successResponse){successResponse.json().then(function(parsedResponse){successCallback(parsedResponse.LocationId)})},function(err){errorCallback(err)})};SdkMessage.DeleteDocument=function(entityCollection,parentEntityReference,gridControl,successCallback,errorCallback){var deleteDocumentRequest=new DocumentManagement.DeleteDocumentRequest(entityCollection,parentEntityReference);Xrm.WebApi.online.execute(deleteDocumentRequest).then(function(successResponse){successCallback(gridControl)},function(err){errorCallback(err)})};SdkMessage.CheckInFiles=function(documentRecord,comments,retainFlag,parentEntityReference,gridControl,successCallback,errorCallback){var checkInDocumentDialog=new DocumentManagement.CheckInDocumentRequest(documentRecord,comments,retainFlag,parentEntityReference);Xrm.WebApi.online.execute(checkInDocumentDialog).then(function(successResponse){successCallback(gridControl)},function(err){errorCallback(err)})};SdkMessage.NewDocument=function(fileName,locationId,gridControl,isOneDriveLocationCreated,parentEntityReference,isFolder,folderPath,successCallback,errorCallback){var newDocumentRequest=new DocumentManagement.NewDocumentRequest(fileName,locationId,parentEntityReference,isFolder,folderPath);Xrm.WebApi.online.execute(newDocumentRequest).then(function(successResponse){successResponse.json().then(function(parsedResponse){successCallback(parsedResponse.EditLink,gridControl,locationId,isOneDriveLocationCreated)})},function(err){errorCallback(err)})};SdkMessage.CreateFolder=function(foldername,entityReference,sitetype,isCreatedFolder,isUploadDocument,dialogParams,gridControl,regardingEntityLogicalName,regardingObjectId,fileName,successCallback,errorCallback){var createFolderRequest=new DocumentManagement.CreateFolderRequest(foldername,entityReference,sitetype,isCreatedFolder);Xrm.WebApi.online.execute(createFolderRequest).then(function(successResponse){successResponse.json().then(function(response){successCallback(isUploadDocument,response.LocationId.toString(),dialogParams,gridControl,regardingEntityLogicalName,regardingObjectId,fileName)})},function(err){errorCallback(err)})};SdkMessage.CreateOneDriveFolderRequest=function(foldername,entityReference,sitetype,validateFolder,gridControl,successCallback,errorCallback){var createFolderRequest=new DocumentManagement.CreateFolderRequest(foldername,entityReference,sitetype,validateFolder);Xrm.WebApi.online.execute(createFolderRequest).then(function(successResponse){successResponse.json().then(function(response){successCallback(gridControl,response.LocationId.toString())})},function(err){errorCallback(err,gridControl,entityReference)})};SdkMessage.CreateODBFolder=function(foldername,eventContext,successCallback,errorCallback){var renamefoldernameforonedriverequest=new DocumentManagement.RenameFolderNameForOneDriveRequest(foldername);Xrm.WebApi.online.execute(renamefoldernameforonedriverequest).then(function(successResponse){return successCallback()},function(err){errorCallback(err)})};SdkMessage.CheckoutFile=function(documentRecord,gridControl,parentEntityReference,successCallback,errorCallback){var checkoutDocumentRequest=new DocumentManagement.CheckoutDocumentRequest(documentRecord,parentEntityReference);Xrm.WebApi.online.execute(checkoutDocumentRequest).then(function(successResponse){successCallback(gridControl)},function(err){errorCallback(err)})};SdkMessage.RetrievePersonalSiteUrl=function(successCallback,errorCallback){var retrievePersonalSiteUrlRequest=new DocumentManagement.RetrievePersonalSiteUrlRequest;Xrm.WebApi.online.execute(retrievePersonalSiteUrlRequest).then(function(successResponse){successResponse.json().then(function(parsedResponse){successCallback(parsedResponse.PersonalSiteUrl)})},function(err){errorCallback(err)})};SdkMessage.EditDocumentProperties=function(documentRecord,gridControl,parentEntityReference,successCallback,errorCallback){var editDocumentProperties=new DocumentManagement.EditDocumentPropertiesRequest(documentRecord,parentEntityReference);Xrm.WebApi.online.execute(editDocumentProperties).then(function(successResponse){successCallback(gridControl)},function(err){errorCallback(err)})};SdkMessage.DiscardCheckout=function(entityRecord,gridControl,parentEntityReference,successCallback,errorCallback){var discardDocumentCheckoutRequest=new DocumentManagement.DiscardDocumentCheckoutRequest(entityRecord,parentEntityReference);Xrm.WebApi.online.execute(discardDocumentCheckoutRequest).then(function(successResponse){successCallback(gridControl)},function(err){errorCallback(err)})};SdkMessage.UploadDocument=function(fileContent,documentRecord,overWriteValue,parentEntityReference,gridControl,isOneDriveLocationCreated,relativeLocation,successCallback,errorCallback){var uploadDocumentRequest=new DocumentManagement.UploadDocumentRequest(fileContent,documentRecord,overWriteValue,parentEntityReference,relativeLocation);Xrm.WebApi.online.execute(uploadDocumentRequest).then(function(successResponse){var locationId=documentRecord[DocumentManagement.SharePointConstants.AttributeNames.LOCATION_ID];successCallback(gridControl,locationId,isOneDriveLocationCreated)},function(err){errorCallback(err)})};return SdkMessage}();DocumentManagement.SdkMessage=SdkMessage})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var FetchExpression=DocumentManagement.Query.FetchExpression,Filter=DocumentManagement.Query.Filter,Condition=DocumentManagement.Query.Condition,Order=DocumentManagement.Query.Order,LinkEntity=DocumentManagement.Query.LinkEntity,PageInfo=DocumentManagement.Query.PageInfo,SharePointUtilities=function(){function SharePointUtilities(){}Object.defineProperty(SharePointUtilities,"IsOneDriveEnabled",{"get":function(){return Xrm.Utility.getGlobalContext().organizationSettings.attributes[DocumentManagement.SharePointConstants.AttributeNames.IS_ONEDRIVE_ENABLED]},enumerable:true,configurable:true});SharePointUtilities.IsMSTeamsEnabled=function(entityMetadata){return Xrm.Internal.isFeatureEnabled(DocumentManagement.SharePointConstants.AttributeNames.FCB_MSTEAMS_INTEGRATION)&&Xrm.Utility.getGlobalContext().organizationSettings.attributes[DocumentManagement.SharePointConstants.AttributeNames.IS_MSTEAMS_ENABLED]&&entityMetadata[DocumentManagement.SharePointConstants.AttributeNames.IS_MSTEAMS_INTEGRATION_ENABLED]};SharePointUtilities.IsSharePointEnabled=function(entityMetadata){return Xrm.Internal.isFeatureEnabled(DocumentManagement.SharePointConstants.AttributeNames.FCB_SHAREPOINT_S2S)&&entityMetadata[DocumentManagement.SharePointConstants.AttributeNames.IS_SHAREPOINT_ENABLED]};SharePointUtilities.ParseDocumentName=function(documentName,extension){var index=documentName.lastIndexOf(".");if(index!=-1){var ext=documentName.substr(index,documentName.length);if(!DocumentManagement.GenericUtilities.isNullOrEmpty(ext)&&ext!=extension)index=-1}return index==-1?documentName:documentName.substr(0,index)};SharePointUtilities.ValidateDocumentName=function(documentName){var result=1;if(documentName.length>0)result=0;return result};SharePointUtilities.DocumentExt=function(documentType){var fileExtension;switch(documentType){case "Word Document":fileExtension=".docx";break;case "Excel Document":fileExtension=".xlsx";break;case "OneNote":fileExtension=".one";break;case "Power Point":fileExtension=".pptx";break}return fileExtension};SharePointUtilities.RetrieveSharePointDocLocationForMenuBuilder=function(regardingObjectId,isOneNoteIntegrationEnabled,commandProperties,successCallback,errorCallback){return Xrm.Utility.getEntityMetadata(Xrm.Page.data.entity.getEntityName(),[DocumentManagement.SharePointConstants.AttributeNames.IS_SHAREPOINT_ENABLED]).then(function(metadata){var query=new FetchExpression;query.EntityName=DocumentManagement.SharePointConstants.EntityNames.SHAREPOINT_LOCATION_ENTITY;var columns=[DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_PARENT_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE];query.AddAttributes(columns);var rootFilter=new Filter;rootFilter.Type=0;rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_ID,0,regardingObjectId));rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATE_CODE,0,0));rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATUS_CODE,0,1));rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID,9,"true"));rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,8,null));isOneNoteIntegrationEnabled&&rootFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_TYPE,0,0));var serviceTypeSharepointLocationFilter=new Filter,shouldQueryForOneDrive=commandProperties.SourceControlId===DocumentManagement.SharePointConstants.MenuParams.CHANGE_LOCATION_CONTROL_ID||commandProperties.SourceControlId===DocumentManagement.SharePointConstants.MenuParams.OPEN_IN_SHAREPOINT_CONTROL_ID;if(SharePointUtilities.IsOneDriveEnabled&&shouldQueryForOneDrive){var currentUserId=DocumentManagement.GenericUtilities.GetCurrentUserId();currentUserId=DocumentManagement.GenericUtilities.FormatGuid(currentUserId);var oneDriveSharepointFilter=new Filter;serviceTypeSharepointLocationFilter.Type=1;oneDriveSharepointFilter.Type=0;oneDriveSharepointFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE,0,1));oneDriveSharepointFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.USER_ID,0,currentUserId));serviceTypeSharepointLocationFilter.AddFilter(oneDriveSharepointFilter)}if(SharePointUtilities.IsMSTeamsEnabled(metadata)&&commandProperties.SourceControlId!=DocumentManagement.SharePointConstants.MenuParams.EDIT_LOCATION_CONTROL_ID){var msTeamsSharepointFilter=new Filter;serviceTypeSharepointLocationFilter.Type=1;msTeamsSharepointFilter.Type=0;msTeamsSharepointFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE,0,3));serviceTypeSharepointLocationFilter.AddFilter(msTeamsSharepointFilter)}SharePointUtilities.IsSharePointEnabled(metadata)&&serviceTypeSharepointLocationFilter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE,0,0));rootFilter.AddFilter(serviceTypeSharepointLocationFilter);query.AddFilter(rootFilter);query.Order=new Order(DocumentManagement.SharePointConstants.AttributeNames.MODIFIED_ON,1);return DocumentManagement.SdkMessage.RetrieveMultiple(commandProperties,query.EntityName,query.toString(),successCallback,errorCallback)},errorCallback)};SharePointUtilities.IsPersonalSitesPresent=function(successCallback,errorCallback){var Xrm=DocumentManagement.GenericUtilities.GetXrmStaticObject(),currentUserId=DocumentManagement.GenericUtilities.GetCurrentUserId();currentUserId=DocumentManagement.GenericUtilities.FormatGuid(currentUserId);var query=new FetchExpression;query.EntityName=DocumentManagement.EntityUtilities.EntityNames.SharePointDocumentLocation;query.AddAttribute(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_ID);var filter=new Filter;filter.Type=0;filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATE_CODE,0,0));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATUS_CODE,0,1));query.AddFilter(filter);var linkToParent=new LinkEntity(DocumentManagement.EntityUtilities.EntityNames.SharePointDocumentLocation,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_ID),linkCriteria=new Filter;linkCriteria.Type=0;linkCriteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE,0,1));linkCriteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_PARENT_CODE,0,DocumentManagement.SharePointConstants.EntityTypeCode.SHAREPOINT_SITE));linkCriteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.USER_ID,0,currentUserId));linkCriteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATE_CODE,0,0));linkCriteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATUS_CODE,0,1));linkToParent.AddFilter(linkCriteria);query.AddLinkEntity(linkToParent);DocumentManagement.SdkMessage.RetrieveMultiple(null,query.EntityName,query.toString(),function(eventContext,entityCollection){var count=entityCollection.length;successCallback(count>0)},errorCallback)};SharePointUtilities.FetchSelectedDocumentInformation=function(documentId,regardingObjectId,regardingObjectLogicalName,locationId,eventContext,successCallback,errorCallback){var columns=[DocumentManagement.SharePointConstants.AttributeNames.DOCUMENT_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_FULL_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_AUTHOR,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_CREATED_ON,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED_BY,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE],query=new FetchExpression;query.EntityName=DocumentManagement.EntityUtilities.EntityNames.SharePointDocument;query.AddAttributes(columns);var filter=new Filter;filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.DOCUMENT_ID,0,documentId.toString()));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_ID,0,regardingObjectId));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_TYPE_CODE,0,Xrm.Internal.getEntityCode(regardingObjectLogicalName).toString()));!DocumentManagement.GenericUtilities.isNullOrEmpty(locationId)&&filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.LOCATION_ID,0,locationId));query.AddFilter(filter);query.PageInfo=new PageInfo(1,1);DocumentManagement.SdkMessage.RetrieveMultiple(eventContext,query.EntityName,query.toString(),successCallback,errorCallback)};SharePointUtilities.BuildFilterforDefaultSPSite=function(){var criteria=new Filter;criteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_IS_DEFAULT,0,true));criteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATE_CODE,0,0));return criteria};SharePointUtilities.BuildFilterforParentSPSite=function(sharePointDocumentLocation){var criteria=new Filter;criteria.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ID,0,sharePointDocumentLocation[DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID]));return criteria};SharePointUtilities.BuildQueryforSPSiteAndRetrieve=function(eventContext,criteria,successCallback,errorCallback){var query=new FetchExpression;query.EntityName=DocumentManagement.EntityUtilities.EntityNames.SharePointSite;var columns=[DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_COLLECTION_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_IS_GRID_PRESENT,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_IS_DEFAULT,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_FOLDER_STRUCTURE_ENTITY];query.AddAttributes(columns);query.AddFilter(criteria);DocumentManagement.SdkMessage.RetrieveMultiple(eventContext,query.EntityName,query.toString(),successCallback,errorCallback)};SharePointUtilities.RetrieveDefaultSPSite=function(eventContext,successCallback,errorCallback){var criteria=SharePointUtilities.BuildFilterforDefaultSPSite();SharePointUtilities.BuildQueryforSPSiteAndRetrieve(eventContext,criteria,successCallback,errorCallback)};SharePointUtilities.RetrieveParentSPSite=function(eventContext,sharePointDocumentLocation,successCallback,errorCallback){var criteria=SharePointUtilities.BuildFilterforParentSPSite(sharePointDocumentLocation);SharePointUtilities.BuildQueryforSPSiteAndRetrieve(eventContext,criteria,successCallback,errorCallback)};SharePointUtilities.FetchSharePointDefaultDocument=function(regardingObjectId,eventContext,successCallback,errorCallback){var query=new FetchExpression;query.EntityName=DocumentManagement.EntityUtilities.EntityNames.SharePointDocumentLocation;var columns=[DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_NAME,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_PARENT_CODE,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL];query.AddAttributes(columns);var filter=new Filter;filter.Type=0;filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_ID,0,regardingObjectId));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATE_CODE,0,0));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.STATUS_CODE,0,1));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_COLLECTION_ID,9,"true"));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,8,"true"));query.AddFilter(filter);query.Order=new Order(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_CREATED_ON,1);DocumentManagement.SdkMessage.RetrieveMultiple(eventContext,query.EntityName,query.toString(),function(eventContext,entityCollection){var entity=entityCollection[0];successCallback(eventContext,entity)},errorCallback)};SharePointUtilities.FetchActiveLocationCountForEntity=function(regardingObjectId,regardingObjectLogicalName,eventContext,successCallback,errorCallback){var query=new FetchExpression;query.EntityName=DocumentManagement.EntityUtilities.EntityNames.SharePointDocumentLocation;var columns=[DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_NAME];query.AddAttributes(columns);var filter=new Filter;filter.Type=0;filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_ID,0,regardingObjectId));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.REGARDING_OBJECT_TYPE_CODE,0,Xrm.Internal.getEntityCode(regardingObjectLogicalName).toString()));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_LOCATION_TYPE,0,0));filter.AddCondition(new Condition(DocumentManagement.SharePointConstants.AttributeNames.SERVICE_TYPE,0,0));query.AddFilter(filter);DocumentManagement.SdkMessage.RetrieveMultiple(eventContext,query.EntityName,query.toString(),function(eventContext,entityCollection){var entityCount=entityCollection.length>0?entityCollection.length-1:0;successCallback(eventContext,entityCount)},errorCallback)};SharePointUtilities.GetFileNameWithoutExtension=function(fileName){var index=fileName.lastIndexOf("."),fileNameWithoutExtension=index!=-1?fileName.substr(0,index):fileName;return fileNameWithoutExtension};SharePointUtilities.DisableAssociatedGridCommandBar=function(){if(DocumentManagement.GenericUtilities.GetClientType()===0){var associatedGridRibbon=window.document.getElementById(DocumentManagement.SharePointConstants.ASSOCIATED_GRID_RIBBON_IDENTIFIER);if(associatedGridRibbon){var commandBar=associatedGridRibbon.children[0];associatedGridRibbon.style.cursor="wait";commandBar.style.visibility="hidden"}}};SharePointUtilities.SharePointDocumentEditUrl=function(editUrl,absoluteUrl){var dialogOptions={openInNewWindow:false};if(!DocumentManagement.GenericUtilities.isNullOrEmpty(editUrl))Xrm.Navigation.openUrl(editUrl,dialogOptions);else!DocumentManagement.GenericUtilities.isNullOrEmpty(absoluteUrl)&&Xrm.Navigation.openUrl(absoluteUrl,dialogOptions)};SharePointUtilities.SharePointDocumentLocationtUrl=function(absoluteUrl,url){if(!DocumentManagement.GenericUtilities.isNullOrEmpty(absoluteUrl)){var regExp=new RegExp("/+$","g");absoluteUrl=absoluteUrl.replace(regExp,"");url=absoluteUrl.substr(0,absoluteUrl.lastIndexOf("/"));var dialogOptions={openInNewWindow:false};Xrm.Navigation.openUrl(url,dialogOptions)}};SharePointUtilities.ReloadParentGridSP=function(gridControl,locationId,isOneDriveLocationCreated){if(DocumentManagement.GenericUtilities.GetClientType()===1)gridControl.refresh();else if(gridControl!=null)if(!isOneDriveLocationCreated&&locationId!=null){var sharepointIframe=window.frameElement,locationUrl=sharepointIframe.contentWindow.location.href,Mscrm_1=DocumentManagement.GenericUtilities.GetMscrmStaticObject(),uri=Mscrm_1.GlobalImported.CrmUri.create(locationUrl);uri.get_query()[DocumentManagement.SharePointConstants.MDDConstants.LOCATION_ID_URL_PARAMETER]=locationId;sharepointIframe.src=uri.toString()}else gridControl.refresh()};SharePointUtilities.EnableAssociatedGridCommandBar=function(){if(DocumentManagement.GenericUtilities.GetClientType()===0){var associatedGridRibbon=window.document.getElementById(DocumentManagement.SharePointConstants.ASSOCIATED_GRID_RIBBON_IDENTIFIER);if(associatedGridRibbon){var commandBar=associatedGridRibbon.children[0];associatedGridRibbon.style.cursor="default";commandBar.style.visibility="visible"}}};SharePointUtilities.IsAllOrSharedLocation=function(currentLocation){return currentLocation==DocumentManagement.DialogUtilities.DialogConstants.ALL_FILES_LOCATION_GUID||currentLocation==DocumentManagement.DialogUtilities.DialogConstants.SHARED_LOCATION_GUID};SharePointUtilities.openRecord=function(associatedRecordId,entityReferences,gridControl){var rows=gridControl.getGrid().getRows(),selectedRow=rows.get(entityReferences[0].Id.toString()),sharePointEntityAttributes=selectedRow.data.entity.attributes,absoluteUrl=sharePointEntityAttributes.get(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL).getValue(),readUrl=sharePointEntityAttributes.get(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_SITE_READ_URL).getValue(),fileType=sharePointEntityAttributes.get(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue(),customFilterXml=gridControl.getFilterXml();if(DocumentManagement.GenericUtilities.isNullOrUndefined(customFilterXml))customFilterXml="";var locationId=DocumentManagement.GenericUtilities.GetParameterFromGridControl(gridControl,DocumentManagement.SharePointConstants.AttributeNames.LOCATION_ID);if(!DocumentManagement.GenericUtilities.isNullOrEmpty(fileType)&&fileType=="folder"&&!DocumentManagement.GenericUtilities.compareGuid(locationId,DocumentManagement.DialogUtilities.DialogConstants.SHARED_LOCATION_GUID)){var relativeLocation=sharePointEntityAttributes.get(DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_RELATIVE_LOCATION).getValue(),newXML=DocumentManagement.GenericUtilities.AddOrReplaceCondition(customFilterXml,DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_RELATIVE_LOCATION,relativeLocation);gridControl.setFilterXml(newXML);var eventParams=[],fileTypeParam={name:"fileType",value:fileType};Xrm.Reporting.reportSuccess("SharePointAssociatedGridFolderClick",eventParams);gridControl.refresh()}else{DocumentManagement.OpenRecordUtil.openUrl(absoluteUrl,readUrl,fileType);var eventParams=[],fileTypeParam={name:DocumentManagement.SharePointConstants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,value:fileType};eventParams.push(fileTypeParam);Xrm.Reporting.reportSuccess("SharePointAssociatedGridFileClick",eventParams)}};return SharePointUtilities}();DocumentManagement.SharePointUtilities=SharePointUtilities})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,PageInfo=DocumentManagement.Query.PageInfo,GenericUtilities=function(){function GenericUtilities(){}GenericUtilities.createChainedEntityMetadataMapWithCallback=function(uniqueEntityTypes,currentIndex,entityNameToMetadataMap,callback){if(currentIndex<uniqueEntityTypes.length)Xrm.Utility.getEntityMetadata(uniqueEntityTypes[currentIndex],["EntitySetName","EntityDisplayName","IsDocumentManagementEnabled"]).then(function(metadata){entityNameToMetadataMap[uniqueEntityTypes[currentIndex]]=metadata;GenericUtilities.createChainedEntityMetadataMapWithCallback(uniqueEntityTypes,currentIndex+1,entityNameToMetadataMap,callback)},function(error){GenericUtilities.createChainedEntityMetadataMapWithCallback(uniqueEntityTypes,currentIndex+1,entityNameToMetadataMap,callback)});else callback(entityNameToMetadataMap)};GenericUtilities.stringFormat=function(stringToFormat,args){if(!args||stringToFormat===undefined||stringToFormat===null)return stringToFormat||"";return stringToFormat.replace(/{(\d+)}/g,function(match,number){return args[number]!=null&&args[number]!=undefined?args[number]:match})};GenericUtilities.FormatFolderName=function(recordName,recordId){var stringToFormat=recordName+"_"+recordId.toUpperCase(),regExp=new RegExp("-|{|}","g"),stringToReturn;return stringToFormat.replace(regExp,"")};GenericUtilities.Format=function(format){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var returnValue=format,i=1;i<arguments.length;i++){var actualValue=typeof arguments[i]=="undefined"||arguments[i]==null?"":arguments[i].toString();returnValue=returnValue.replace(new RegExp("\\{"+(i-1)+"\\}","g"),actualValue)}return returnValue};GenericUtilities.isNullOrEmpty=function(s){return s==null||s.length===0};GenericUtilities.isNullOrWhitespace=function(s){return s==null||s.trim().length===0};GenericUtilities.isNullUndefinedOrWhitespace=function(s){return s==null||s==undefined||s.trim().length===0};GenericUtilities.isNullOrUndefined=function(object){return typeof object=="undefined"||object==null};GenericUtilities.EqualsIgnoreCase=function(string1,string2){var isString1Null=string1==null,isString2Null=string2==null,isString1Undefined=string1==undefined,isString2Undefined=string2==undefined;if(isString1Null&&isString2Null||isString1Undefined&&isString2Undefined)return true;if(isString1Null!=isString2Null||isString1Undefined!=isString2Undefined)return false;return string1.toUpperCase()===string2.toUpperCase()};GenericUtilities.ReplaceLineBreaksWithBrTags=function(text){return text.replace(/(?:\r\n|&#13;&#10;|\r|&#13;|\n|&#10;)/g,"<br />")};GenericUtilities.DJB2Code=function(str){for(var hash=5381,i=0;i<str.length;i++){var char=str.charCodeAt(i);hash=(hash<<5)+hash+char}return hash};GenericUtilities.GetClientType=function(){return Xrm.Internal.isUci()?1:0};GenericUtilities.GetXrmStaticObject=function(){return window["Xrm"]?window["Xrm"]:window.parent["Xrm"]};GenericUtilities.GetMicrosoftStaticObject=function(){return window["Microsoft"]?window["Microsoft"]:window.parent["Microsoft"]};GenericUtilities.GetMscrmStaticObject=function(){return window["Mscrm"]?window["Mscrm"]:window.parent["Mscrm"]};GenericUtilities.FormatGuid=function(guid){return guid.toString().replace("{","").replace("}","").toLowerCase()};GenericUtilities.compareGuid=function(guid1,guid2){return this.FormatGuid(guid1)===this.FormatGuid(guid2)};GenericUtilities.ParseDateTime=function(dateString){var dateValue=new Date(dateString),month=dateValue.getMonth()+1,day=dateValue.getDate(),year=dateValue.getFullYear(),hour=dateValue.getHours(),meridian=hour<=11?"AM":"PM";hour=hour%12;if(hour==0)hour=12;var minutes=(dateValue.getMinutes()<10?"0":"")+dateValue.getMinutes();return month+"/"+day+"/"+year+" "+hour+":"+minutes+" "+meridian};GenericUtilities.ValidateFolderName=function(folderName){var maxLength=DocumentManagement.SharePointConstants.FOLDER_NAME_MAX_LENGTH,regEx=new RegExp(DocumentManagement.SharePointConstants.FOLDER_NAME_REGEX_STRING,"g"),result=0;if(regEx.test(folderName))result=1;else if(folderName.length>maxLength)result=2;return result};GenericUtilities.ReplaceSpecialCharactersFromFolderName=function(folderName){var updatedFolderName=folderName,maxLength=DocumentManagement.SharePointConstants.FOLDER_NAME_MAX_LENGTH,regEx=new RegExp(DocumentManagement.SharePointConstants.FOLDER_NAME_REGEX_STRING,"g");updatedFolderName=folderName.replace(regEx,"-").trim();var regExpStringForSpace="\\s+";regEx=new RegExp(regExpStringForSpace,"g");updatedFolderName=updatedFolderName.replace(regEx," ").trim();updatedFolderName=updatedFolderName.substring(0,maxLength);return updatedFolderName};GenericUtilities.ConvertGuidToString=function(inputString){if(inputString.charAt(0)=="{"&&inputString.charAt(inputString.length-1)=="}")return inputString.substr(1,inputString.length-2);return inputString};GenericUtilities.GetResourceString=function(key){return Xrm.Utility.getResourceString("SharePoint_main_system_library",key)};GenericUtilities.GetConfirmDialogStringObject=function(){if(GenericUtilities.GetClientType()===1)return {};else return new Xrm[DocumentManagement.SharePointConstants.CONFIRM_DIALOG_STRINGS]};GenericUtilities.GetEntityLocalizedSetName=function(entityMetadata){return entityMetadata.DisplayCollectionName};GenericUtilities.GetEntityDisplayName=function(entityMetadata){return entityMetadata.DisplayName};GenericUtilities.OpenConfirmDialog=function(confirmDialogStrings,dialogOptions,confirmButtonCallback,cancelButtonCallback){var _this=this;Xrm.Navigation.openConfirmDialog(confirmDialogStrings,dialogOptions).then(function(successParameter){if(successParameter)if(successParameter.confirmed)confirmButtonCallback();else!_this.isNullOrUndefined(cancelButtonCallback)&&cancelButtonCallback()},null)};GenericUtilities.OpenAlertDialog=function(alertDialogStrings,dialogOptions){Xrm.Navigation.openAlertDialog({text:alertDialogStrings},dialogOptions)};GenericUtilities.OpenDialog=function(dialogName,dialogOptions,dialogParams,closeCallback,callbackParams){Xrm.Navigation.openDialog(dialogName,dialogOptions,dialogParams).then(function(successParameter){successParameter&&successParameter.parameters&&closeCallback(dialogParams,callbackParams,successParameter.parameters)},null)};GenericUtilities.ClosePage=function(){Xrm.Page.ui.close()};GenericUtilities.GetAttributeFromPage=function(eventContext,attributeId){var dialogAttributes=eventContext.getFormContext().data.attributes;return dialogAttributes.get(attributeId).getValue()};GenericUtilities.SetAttributeInPage=function(eventContext,attributeId,value){var dialogAttributes=eventContext.getFormContext().data.attributes,attribute=dialogAttributes.get(attributeId);attribute!=undefined&&attribute!=null&&attribute.setValue(value)};GenericUtilities.GetDialogOptions=function(height,width,position){var dialogOptions={height:height,width:width,position:position};return dialogOptions};GenericUtilities.GetControlFromPage=function(eventContext,controlId){var formContext=eventContext.getFormContext();return formContext.getControl(controlId)};GenericUtilities.GetParameterFromGridControl=function(gridControl,id){if(GenericUtilities.GetClientType()===1){var customFilterXml=gridControl.getFilterXml();return customFilterXml?GenericUtilities.GetParameterFromFetchXml(customFilterXml,id.toLowerCase()):""}else return gridControl.GetParameter(id)};GenericUtilities.GetParameterFromFetchXml=function(fetchXml,parameterName){var domParser=new DOMParser,fetchXmlDocument=domParser.parseFromString(fetchXml,"text/xml");if(fetchXmlDocument){var filterElements=fetchXmlDocument.getElementsByTagName("filter");if(filterElements&&filterElements.length>0)for(var index=0;index<filterElements.length;index++)for(var filterElement=filterElements[index],filterElementIndex=0;filterElementIndex<filterElement.childNodes.length;filterElementIndex++){var currentElement=filterElement.childNodes.item(filterElementIndex);if(currentElement.nodeName==="condition"){var attributeName=GenericUtilities.getNodeAttributeValueFromName(currentElement,"attribute");if(attributeName===parameterName)return GenericUtilities.getNodeAttributeValueFromName(currentElement,"value")}}}return ""};GenericUtilities.GetParametersFromFetchXml=function(fetchXml,parameters){var values={},domParser=new DOMParser,fetchXmlDocument=domParser.parseFromString(fetchXml,"text/xml");if(fetchXmlDocument){var filterElements=fetchXmlDocument.getElementsByTagName("filter");if(filterElements&&filterElements.length>0)for(var index=0;index<filterElements.length;index++)for(var filterElement=filterElements[index],filterElementIndex=0;filterElementIndex<filterElement.childNodes.length;filterElementIndex++){var currentElement=filterElement.childNodes.item(filterElementIndex);if(currentElement.nodeName==="condition"){var attributeName=GenericUtilities.getNodeAttributeValueFromName(currentElement,"attribute");if(parameters.indexOf(attributeName)>-1)values[attributeName]=GenericUtilities.getNodeAttributeValueFromName(currentElement,"value")}}}return values};GenericUtilities.getNodeAttributeValueFromName=function(inputNode,attribuetName){if(!inputNode)return null;var nodeAttributeMap=inputNode.attributes.getNamedItem(attribuetName);return nodeAttributeMap?nodeAttributeMap.value:null};GenericUtilities.SetControlValue=function(control,value){var control=Xrm.Page.ui.controls.get(control);if(control){var controlAttribute=control.getAttribute();controlAttribute&&controlAttribute.setValue(value)}};GenericUtilities.GetCellValue=function(cell,rowId,gridControl){if(GenericUtilities.GetClientType()===0){var cellValue=gridControl.getCellValue(cell,rowId);return cellValue==null?"-1":cellValue}};GenericUtilities.GetFirstSelectedRowId=function(gridControl){if(GenericUtilities.GetClientType()===0)return gridControl.GetRecordsFromInnerGrid(true)[0][0]};GenericUtilities.GetIdFromPage=function(){return Xrm.Page.data.entity.getId()};GenericUtilities.GetEntityAttributeFromPage=function(attributeName){return Xrm.Page.data.entity.attributes.get(attributeName).getValue()};GenericUtilities.GetEntityPrimaryAttribute=function(){return Xrm.Page.data.entity.getPrimaryAttributeValue()};GenericUtilities.GetEntityNameFromPage=function(){return Xrm.Page.data.entity.getEntityName()};GenericUtilities.GetRecordNameFromPage=function(){return Xrm.Page.data.entity.getPrimaryAttributeValue()};GenericUtilities.GetCurrentUserId=function(){var Xrm=GenericUtilities.GetXrmStaticObject();return Xrm.Page.context.getUserId()};GenericUtilities.HandleErrorMessage=function(errorResponse){var errorDialogOptions={message:errorResponse.message,errorCode:errorResponse.errorCode};Xrm.Navigation.openErrorDialog(errorDialogOptions)};GenericUtilities.CommandErrorTelemetry=function(commandName,errorResponse){var eventParams=[],clientType=GenericUtilities.GetClientType(),clientTypeParam={name:Constants.CLIENT_TYPE,value:clientType},errorParam={name:Constants.ERROR_RESPONSE,message:errorResponse.message};eventParams.push(clientTypeParam);clientType===1&&Xrm.Reporting.reportFailure(commandName,errorParam,"",eventParams)};GenericUtilities.CommandSuccessTelemetry=function(commandName,eventParameters){var eventParams=[],clientType=GenericUtilities.GetClientType(),clientTypeParam={name:Constants.CLIENT_TYPE,value:clientType};eventParams.push(clientTypeParam);if(eventParameters)for(var _i=0,eventParameters_1=eventParameters;_i<eventParameters_1.length;_i++){var eventParameter=eventParameters_1[_i];eventParams.push(eventParameter)}clientType===1&&Xrm.Reporting.reportSuccess(commandName,eventParams)};GenericUtilities.IsFeatureEnabled=function(featureName){return Xrm.Internal.isFeatureEnabled(featureName)};GenericUtilities.GetSelectedRow=function(gridControl){if(GenericUtilities.GetClientType()===0){var selectedRecords=gridControl.GetRecordsFromInnerGrid(true);return selectedRecords[0][0]}};GenericUtilities.GetGridCellValue=function(gridControl,selectedRow,attributeName){if(GenericUtilities.GetClientType()===0){var value=gridControl.getCellValue(attributeName,selectedRow);return GenericUtilities.isNullOrEmpty(value)?GenericUtilities.Empty:value}};GenericUtilities.CreateCallbackFunctionFactory=function(functionName,parameters){return function(retValue){return functionName.apply(null,parameters)}};GenericUtilities.CloseDialog=function(context){var formContext;if(context==null||context==undefined){var Xrm_1=GenericUtilities.GetXrmStaticObject();formContext=Xrm_1.Page}else formContext=context.getFormContext();formContext.ui.close()};GenericUtilities.ShowProgressMessage=function(){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString("SharePoint_main_system_library",DocumentManagement.SharePointConstants.ResourceStrings.PROCESSING_LABEL))};GenericUtilities.HideProgressMessage=function(){Xrm.Utility.closeProgressIndicator()};GenericUtilities.SetAttributeValueInDialogParams=function(eventContext,attributeId,value){eventContext.getFormContext().data.attributes.get(attributeId)!=null&&eventContext.getFormContext().data.attributes.get(attributeId).setValue(value)};GenericUtilities.AddOrReplaceCondition=function(fetchXML,attrName,attrVal){var domParser=new DOMParser,fetchXmlDocument=domParser.parseFromString(fetchXML,"text/xml"),replaced=false,createNewXml=true,modifiedXML="";if(fetchXmlDocument){var filterElements=fetchXmlDocument.getElementsByTagName("filter");if(filterElements&&filterElements.length>0){createNewXml=false;for(var filterElement=filterElements[0],filterElementIndex=0;filterElementIndex<filterElement.childNodes.length;filterElementIndex++){var currentElement=filterElement.childNodes.item(filterElementIndex);if(currentElement.nodeName==="condition"){var attributeName=GenericUtilities.getNodeAttributeValueFromName(currentElement,"attribute");if(attributeName===attrName){var value=currentElement.attributes.getNamedItem("value");value.value=attrVal;currentElement.attributes.setNamedItem(value);replaced=true;break}}}if(!replaced){var condition=fetchXmlDocument.createElement("condition");condition.setAttribute("attribute",attrName);condition.setAttribute("operator","eq");condition.setAttribute("value",attrVal);filterElement.appendChild(condition)}}}if(createNewXml){modifiedXML+='<filter type="and">';modifiedXML+='<condition attribute="'+attrName+'" operator="eq" value="'+Xrm.Encoding.xmlEncode(attrVal)+'" /> ';modifiedXML+="</filter>"}else modifiedXML=(new XMLSerializer).serializeToString(fetchXmlDocument);return modifiedXML};GenericUtilities.getHexErrorCode=function(errorCode){var code=errorCode,codePrefix="0x";if(code<0)code=code+4294967295+1;return codePrefix+code.toString(16)};GenericUtilities.SetPerfMarker=function(marker){GenericUtilities.GetClientType()===0&&window["setPerfMarkerTimestamp"](marker)};GenericUtilities.Empty="";return GenericUtilities}();DocumentManagement.GenericUtilities=GenericUtilities})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentDiscardCheckout=function(){function SharePointDocumentDiscardCheckout(){}SharePointDocumentDiscardCheckout.Invoker=function(gridControl){Util.SetPerfMarker("DiscardCheckoutSharePointDocumentStart");if(gridControl!=null){var discardCheckoutDialogObject=new SharePointDocumentDiscardCheckout,dialogOptions=Util.GetDialogOptions(252,400,1),confirmDialogStrings=discardCheckoutDialogObject.getDiscardCheckoutDialogStrings();discardCheckoutDialogObject.OpenDialog(confirmDialogStrings,dialogOptions,gridControl)}};SharePointDocumentDiscardCheckout.prototype.OpenDialog=function(dialogStrings,dialogOptions,gridControl){var discardCheckoutDialogObject=new SharePointDocumentDiscardCheckout,parameters=this.getParametersForConfirmCallback(gridControl,dialogStrings,dialogOptions,null),confirmDialogCallback=Util.CreateCallbackFunctionFactory(SharePointDocumentDiscardCheckout.ConfirmCloseCallback,parameters);Util.OpenConfirmDialog(dialogStrings,dialogOptions,confirmDialogCallback,null)};SharePointDocumentDiscardCheckout.ConfirmCloseCallback=function(entityRecord,gridControl,parentEntityReference){if(entityRecord!=null){SharePointUtil.DisableAssociatedGridCommandBar();Util.ShowProgressMessage();DocumentManagement.SdkMessage.DiscardCheckout(entityRecord,gridControl,parentEntityReference,SharePointDocumentDiscardCheckout.DiscardCheckoutSuccessCallBack,SharePointDocumentDiscardCheckout.DiscardCheckoutFailureCallback)}};SharePointDocumentDiscardCheckout.DiscardCheckoutSuccessCallBack=function(gridControl){Util.HideProgressMessage();SharePointUtil.EnableAssociatedGridCommandBar();gridControl.refresh();Util.CommandSuccessTelemetry(Constants.Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT_SUCCESS);Util.SetPerfMarker("DiscardCheckoutSharePointDocumentSDKEnd")};SharePointDocumentDiscardCheckout.DiscardCheckoutFailureCallback=function(errorResponse){Util.HideProgressMessage();SharePointUtil.EnableAssociatedGridCommandBar();Util.SetPerfMarker("DiscardCheckoutSharePointDocumentSDKEnd");Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};SharePointDocumentDiscardCheckout.prototype.getDiscardCheckoutDialogStrings=function(){var confirmDialogStrings=Util.GetConfirmDialogStringObject();confirmDialogStrings.title=Util.GetResourceString(Constants.ResourceStrings.DIALOG_DISCARDCHECKOUT_TITLE);confirmDialogStrings.subtitle=Util.GetResourceString(Constants.ResourceStrings.DIALOG_DISCARDCHECKOUT_SUBTITLE);confirmDialogStrings.text=Util.GetResourceString(Constants.ResourceStrings.DIALOG_DISCARDCHECKOUT_TEXT);confirmDialogStrings.confirmButtonLabel=Util.GetResourceString(Constants.ResourceStrings.BUTTON_LABEL_CONFIRM);confirmDialogStrings.cancelButtonLabel="";return confirmDialogStrings};SharePointDocumentDiscardCheckout.prototype.getParametersForConfirmCallback=function(gridControl,dialogStrings,dialogOptions,successCallback){var parameters,entityName=Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY,params={};if(Util.GetClientType()==1)params=SharePointDocumentDiscardCheckout.getParamsForUCI(gridControl);else params=SharePointDocumentDiscardCheckout.getParamsForWebClient(gridControl);var eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.MDDConstants.FILE_TYPE,value:params[Constants.MDDConstants.FILE_TYPE]};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.DISCARD_CHECKOUT_SHAREPOINT_DOCUMENT,eventParams);var documentId=params[Constants.DOCUMENT_ID],entityId=params[Constants.ENTITY_ID],locationId=params[Constants.LOCATION_ID],documentRecord={};if(documentId!=null){documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=entityId;documentRecord[Constants.AttributeNames.DOCUMENT_ID]=documentId;if(Util.isNullOrEmpty(locationId))documentRecord.locationid="";else documentRecord.locationid=locationId;var entityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:entityReference.id,entityType:entityReference.entityType};parameters=[documentRecord,gridControl,parentEntityReference];return parameters}};SharePointDocumentDiscardCheckout.getParamsForUCI=function(gridControl){var params={},selectedRecords=gridControl.getGrid().getSelectedRows(),index=0;if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var sharepointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue(),documentId=row.data.entity.attributes.get(Constants.AttributeNames.DOCUMENT_ID).getValue(),locationId=row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue(),fileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue();params[Constants.LOCATION_ID]=locationId;params[Constants.DOCUMENT_ID]=documentId;params[Constants.ENTITY_ID]=sharepointDocumentId;params[Constants.MDDConstants.FILE_TYPE]=fileType}});return params};SharePointDocumentDiscardCheckout.getParamsForWebClient=function(gridControl){var params={},selectedRow=Util.GetSelectedRow(gridControl),documentId=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.DOCUMENT_ID),entityId=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.OBJECT_ID),locationId=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.LOCATION_ID),fileType=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE);params[Constants.LOCATION_ID]=locationId;params[Constants.DOCUMENT_ID]=documentId;params[Constants.ENTITY_ID]=entityId;params[Constants.MDDConstants.FILE_TYPE]=fileType;return params};return SharePointDocumentDiscardCheckout}();DocumentManagement.SharePointDocumentDiscardCheckout=SharePointDocumentDiscardCheckout})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentEditProperties=function(){function SharePointDocumentEditProperties(){}SharePointDocumentEditProperties.Invoker=function(gridControl){Util.SetPerfMarker("EditPropertiesSharePointDocumentDialogStartLoad");if(gridControl!=null){var editDocumentPropertiesDialog=new SharePointDocumentEditProperties,dialogOptions=Util.GetDialogOptions(280,600,1),dialogParams={};if(Util.GetClientType()==1)dialogParams=SharePointDocumentEditProperties.getDialogParamsForUCI(gridControl);else dialogParams=SharePointDocumentEditProperties.getDialogParamsForWebClient(gridControl);var closeCallback=SharePointDocumentEditProperties.CloseCallback,callbackParams=editDocumentPropertiesDialog.getCallbackParams(gridControl),eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,value:dialogParams[Constants.MDDConstants.FILE_TYPE]};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT,eventParams);Util.OpenDialog(DocumentManagement.DialogUtilities.DialogName.SHAREPOINT_EDIT_DOCUMENT_PROPERTIES_DIALOG,dialogOptions,dialogParams,closeCallback,callbackParams);Util.SetPerfMarker("EditPropertiesSharePointDocumentDialogEndLoad")}};SharePointDocumentEditProperties.OnLoadEventHandler=function(eventContext){var useFallback=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.USE_FALLBACK);if(useFallback===Constants.MDDConstants.USEFALLBACK_TRUE){var sharePointDocumentId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.SHAREPOINT_DOCUMENT_ID),regardingObjectId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.REGARDING_OBJECT_ID),regardingObjectEntityName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME),locationId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.LOCATION_ID),documentId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.DOCUMENT_ID);SharePointUtil.FetchSelectedDocumentInformation(documentId,regardingObjectId,regardingObjectEntityName,locationId,eventContext,SharePointDocumentEditProperties.FetchSelectedDocumentInformationCallback,Util.HandleErrorMessage)}else{var fileType=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.FILE_TYPE),isFolder=Util.EqualsIgnoreCase(fileType,Constants.FOLDER),isOneToc2=Util.EqualsIgnoreCase(fileType,Constants.ONETOC2),fullname=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.FULL_NAME),fullNameWithoutExtension=isFolder||isOneToc2?fullname:SharePointUtil.GetFileNameWithoutExtension(fullname),title=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.TITLE),createdOn=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.CREATED_ON),createdBy=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.CREATED_BY),modifiedOn=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.MODIFIED_ON),modifiedBy=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.MODIFIED_BY),createdInformationText=Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_CREATEDON_INFORMATION),createdOn,createdBy),modifiedInformationText=Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_MODIFICATION_INFORMATION),modifiedOn,modifiedBy),createdOnControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.CREATEDON_CONTROL);createdOnControl.setLabel(createdInformationText);var modifiedOnControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.MODIFIEDON_CONTROL);modifiedOnControl.setLabel(modifiedInformationText);var fullnameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.FULLNAME_CONTROL);Util.SetControlValue(Constants.FormXMLControls.FULLNAME_CONTROL,fullNameWithoutExtension);if(title!="-1"){var titleControl_1=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.TITLE_CONTROL);Util.SetControlValue(Constants.FormXMLControls.TITLE_CONTROL,title)}var titleControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.TITLE_CONTROL);isFolder&&titleControl.setVisible(false)}};SharePointDocumentEditProperties.EditPropertiesClickHandler=function(eventContext){var documentNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.FULLNAME_CONTROL),documentName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.FULLNAME_CONTROL);if(!documentName){documentNameControl.setFocus();return}var fileType=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.FILE_TYPE),isFolder=Util.EqualsIgnoreCase(fileType,Constants.FOLDER),isOneToc2=Util.EqualsIgnoreCase(fileType,Constants.ONETOC2);documentName=isFolder||isOneToc2?documentName:documentName+"."+fileType;var documentTitle=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.TITLE_CONTROL);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.FULLNAME_CONTROL,documentName);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.TITLE_CONTROL,documentTitle);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);Util.ClosePage()};SharePointDocumentEditProperties.CloseCallback=function(dialogParams,callbackParams,parameters){Util.SetPerfMarker("EditPropertiesSharePointDocumentStart");if(dialogParams!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){var gridControl=callbackParams[Constants.MDDConstants.GRID_CONTROL];dialogParams[Constants.FormXMLControls.FULLNAME_CONTROL]=parameters[Constants.FormXMLControls.FULLNAME_CONTROL];dialogParams[Constants.FormXMLControls.TITLE_CONTROL]=parameters[Constants.FormXMLControls.TITLE_CONTROL];var record=(new SharePointDocumentEditProperties).getDocumentRecord(dialogParams,gridControl),parentEntityReference=record[1];SharePointDocumentEditProperties.ExecuteSDKMessage(record[0],parentEntityReference,gridControl)}};SharePointDocumentEditProperties.ExecuteSDKMessage=function(documentRecord,parentEntityReference,gridControl){Util.ShowProgressMessage();DocumentManagement.SdkMessage.EditDocumentProperties(documentRecord,gridControl,parentEntityReference,SharePointDocumentEditProperties.EditDocumentPropertiesSuccessCallBack,SharePointDocumentEditProperties.EditDocumentPropertiesFailureCallBack)};SharePointDocumentEditProperties.EditDocumentPropertiesSuccessCallBack=function(gridControl,entity){Util.HideProgressMessage();gridControl.refresh();Util.SetPerfMarker("EditPropertiesSharePointDocumentSDKEnd");Util.CommandSuccessTelemetry(Constants.Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT_SUCCESS)};SharePointDocumentEditProperties.EditDocumentPropertiesFailureCallBack=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.EDIT_PROPERTIES_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};SharePointDocumentEditProperties.prototype.getDocumentRecord=function(dialogParams,gridControl){var documentRecord={},parameters={};documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=dialogParams[Constants.MDDConstants.SHAREPOINT_DOCUMENT_ID];documentRecord[Constants.AttributeNames.DOCUMENT_ID]=parseInt(dialogParams[Constants.MDDConstants.DOCUMENT_ID]);documentRecord[Constants.AttributeNames.LOCATION_ID]=dialogParams[Constants.MDDConstants.LOCATION_ID];documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FULL_NAME]=dialogParams[Constants.FormXMLControls.FULLNAME_CONTROL]==null?Util.Empty:dialogParams[Constants.FormXMLControls.FULLNAME_CONTROL];documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE]=dialogParams[Constants.FormXMLControls.TITLE_CONTROL]==null?Util.Empty:dialogParams[Constants.FormXMLControls.TITLE_CONTROL];var entityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:entityReference.id,entityType:entityReference.entityType};parameters=[documentRecord,parentEntityReference];return parameters};SharePointDocumentEditProperties.getDialogParamsForUCI=function(gridControl){var selectedRecords=gridControl.getGrid().getSelectedRows(),dialogParams={},sharePointDocumentId="",oId="",documentId="",locationId="",fullName="",title="",author="",fileType="",sharePointCreatedOn="",sharePointModifiedBy="",sharePointModifiedOn="";if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity)sharePointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue()});if(!Util.isNullOrEmpty(sharePointDocumentId)){dialogParams[Constants.MDDConstants.SHAREPOINT_DOCUMENT_ID]=sharePointDocumentId;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){oId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue();documentId=row.data.entity.attributes.get(Constants.AttributeNames.DOCUMENT_ID).getValue();locationId=row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue();fullName=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_FULL_NAME).getValue();title=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE).getValue();author=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_AUTHOR).getValue();sharePointCreatedOn=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_CREATED_ON).getValue();sharePointModifiedBy=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED_BY).getValue();sharePointModifiedOn=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED).getValue();fileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue()}});if(Util.isNullOrEmpty(fullName)||Util.isNullOrEmpty(author)||Util.isNullOrEmpty(sharePointCreatedOn)||Util.isNullOrEmpty(sharePointModifiedBy)||Util.isNullOrEmpty(sharePointModifiedOn))dialogParams[Constants.MDDConstants.USE_FALLBACK]=Constants.MDDConstants.USEFALLBACK_TRUE;else{dialogParams[Constants.MDDConstants.FULL_NAME]=fullName;dialogParams[Constants.MDDConstants.TITLE]=title;dialogParams[Constants.MDDConstants.USE_FALLBACK]=Constants.MDDConstants.USEFALLBACK_FALSE;dialogParams[Constants.MDDConstants.CREATED_BY]=author;dialogParams[Constants.MDDConstants.CREATED_ON]=Util.ParseDateTime(sharePointCreatedOn);dialogParams[Constants.MDDConstants.MODIFIED_BY]=sharePointModifiedBy;dialogParams[Constants.MDDConstants.MODIFIED_ON]=Util.ParseDateTime(sharePointModifiedOn);dialogParams[Constants.MDDConstants.FILE_TYPE]=fileType}dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.DOCUMENT_ID]=documentId}return dialogParams};SharePointDocumentEditProperties.getDialogParamsForWebClient=function(gridControl){var dialogParams={},rowId=Util.GetFirstSelectedRowId(gridControl),sharePointDocumentId=Util.GetCellValue(Constants.AttributeNames.OBJECT_ID,rowId,gridControl);if(!Util.isNullOrEmpty(sharePointDocumentId)){dialogParams[Constants.MDDConstants.SHAREPOINT_DOCUMENT_ID]=sharePointDocumentId;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();var locationId=Util.GetCellValue(Constants.AttributeNames.LOCATION_ID,rowId,gridControl),documentId=Util.GetCellValue(Constants.AttributeNames.DOCUMENT_ID,rowId,gridControl),fullName=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_FULL_NAME,rowId,gridControl),title=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE,rowId,gridControl),author=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_AUTHOR,rowId,gridControl),sharePointCreatedOn=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_CREATED_ON,rowId,gridControl),sharePointModifiedBy=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED_BY,rowId,gridControl),sharePointModifiedOn=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED,rowId,gridControl),fileType=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,rowId,gridControl);if(Util.isNullOrEmpty(fullName)||Util.isNullOrEmpty(author)||Util.isNullOrEmpty(sharePointCreatedOn)||Util.isNullOrEmpty(sharePointModifiedBy)||Util.isNullOrEmpty(sharePointModifiedOn))dialogParams[Constants.MDDConstants.USE_FALLBACK]=Constants.MDDConstants.USEFALLBACK_TRUE;else{dialogParams[Constants.MDDConstants.FULL_NAME]=fullName;dialogParams[Constants.MDDConstants.TITLE]=title;dialogParams[Constants.MDDConstants.USE_FALLBACK]=Constants.MDDConstants.USEFALLBACK_FALSE;dialogParams[Constants.MDDConstants.CREATED_BY]=author;dialogParams[Constants.MDDConstants.CREATED_ON]=Util.ParseDateTime(sharePointCreatedOn);dialogParams[Constants.MDDConstants.MODIFIED_BY]=sharePointModifiedBy;dialogParams[Constants.MDDConstants.MODIFIED_ON]=Util.ParseDateTime(sharePointModifiedOn);dialogParams[Constants.MDDConstants.FILE_TYPE]=fileType}dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.DOCUMENT_ID]=documentId}return dialogParams};SharePointDocumentEditProperties.prototype.getCallbackParams=function(gridControl){var callbackParams={};callbackParams[Constants.MDDConstants.GRID_CONTROL]=gridControl;return callbackParams};SharePointDocumentEditProperties.FetchSelectedDocumentInformationCallback=function(eventContext,entityCollection){var businessEntity=entityCollection[0],fileType=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE];Util.SetAttributeInPage(eventContext,Constants.MDDConstants.FILE_TYPE,fileType);var isFolder=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]!=null&&businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]==Constants.FOLDER?true:false,isOneToc2=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]!=null&&businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]==Constants.ONETOC2?true:false,fileName=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FULL_NAME].toString(),title=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE]==null?null:businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE].toString(),sharePointCreatedOn=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_CREATED_ON].toString(),author=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_AUTHOR].toString(),modifiedOn=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED].toString(),sharePointModifiedBy=businessEntity[Constants.AttributeNames.SHAREPOINT_DOCUMENT_MODIFIED_BY].toString(),createdInformationText=Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_CREATEDON_INFORMATION),Util.ParseDateTime(sharePointCreatedOn),author),modifiedInformationText=Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDITDOCUMENTPROPERTIES_MODIFICATION_INFORMATION),Util.ParseDateTime(modifiedOn),sharePointModifiedBy),fullNameWithoutExtension=isFolder||isOneToc2?fileName:SharePointUtil.GetFileNameWithoutExtension(fileName),createdOnControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.CREATEDON_CONTROL);createdOnControl.setLabel(createdInformationText);var modifiedOnControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.MODIFIEDON_CONTROL);modifiedOnControl.setLabel(modifiedInformationText);var fullnameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.FULLNAME_CONTROL);Util.SetControlValue(Constants.FormXMLControls.FULLNAME_CONTROL,fullNameWithoutExtension);if(title!="-1"){var titleControl_2=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.TITLE_CONTROL);Util.SetControlValue(Constants.FormXMLControls.TITLE_CONTROL,title)}var titleControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.TITLE_CONTROL);isFolder&&titleControl.setVisible(false)};return SharePointDocumentEditProperties}();DocumentManagement.SharePointDocumentEditProperties=SharePointDocumentEditProperties})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,OneDriveFolderSettings=function(){function OneDriveFolderSettings(){}OneDriveFolderSettings.OpenOneDriveFolderSettingsDialog=function(eventContext){var dialogOptions=Util.GetDialogOptions(240,600,1);Util.OpenDialog(DocumentManagement.DialogUtilities.DialogName.ONE_DRIVE_FOLDER_SETTINGS_DIALOG,dialogOptions,eventContext,OneDriveFolderSettings.OneDriveFolderSettingsSuccessCallback,null)};OneDriveFolderSettings.OneDriveFolderSettingsSuccessCallback=function(eventContext,callbackParams,parameters){if(parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){Util.HideProgressMessage();Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.CONTINUE_BUTTON_CONTROL);Util.CommandSuccessTelemetry(Constants.Commands.RENAME_ODB_FOLDER_SUCCESS);Util.ClosePage()}};OneDriveFolderSettings.OnLoadOneDriveFolderSettingsDialog=function(eventContext){var currentUserId=DocumentManagement.GenericUtilities.GetCurrentUserId();currentUserId=DocumentManagement.GenericUtilities.FormatGuid(currentUserId);var EntityName=DocumentManagement.SharePointConstants.EntityNames.SYSTEM_USER_ENTITY,ODBcolumns=[DocumentManagement.SharePointConstants.AttributeNames.DEFAULT_ODB_FOLDER_NAME];DocumentManagement.SdkMessage.Retrieve(EntityName,currentUserId,ODBcolumns,eventContext,function(eventContext,entity){var documentNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.DOCUMENT_NAME_CONTROL);Util.SetControlValue(Constants.FormXMLControls.DOCUMENT_NAME_CONTROL,entity.defaultodbfoldername)},function(errorResponse){Util.HandleErrorMessage(errorResponse)})};OneDriveFolderSettings.OkButtonClicked=function(eventContext){var documentNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.DOCUMENT_NAME_CONTROL);documentNameControl.setFocus();var folderName=documentNameControl.getAttribute().getValue();if(Util.isNullOrEmpty(folderName)){Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_ENTER_SP_FOLDER_NAME));return}var result=Util.ValidateFolderName(folderName);switch(result){case 0:break;case 1:Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_INVALID_FOLDER_NAME));return;case 2:Util.OpenAlertDialog(Util.Format(Constants.ResourceStrings.LOCID_DOCM_FOLDERNAME_MAXLENGTH,Constants.FILE_NAME_MAX_LENGTH));return}Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.FOLDER_NAME,folderName);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);Util.ShowProgressMessage();DocumentManagement.SdkMessage.CreateODBFolder(folderName,eventContext,Util.ClosePage,OneDriveFolderSettings.RenameFolderFailureCallback)};OneDriveFolderSettings.RenameFolderFailureCallback=function(errorResponse){Util.HideProgressMessage();Util.CommandErrorTelemetry(Constants.Commands.RENAME_ODB_FOLDER_FAILURE,errorResponse);Util.HandleErrorMessage(errorResponse)};return OneDriveFolderSettings}();DocumentManagement.OneDriveFolderSettings=OneDriveFolderSettings})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,OneDriveForBusiness=function(){function OneDriveForBusiness(){}OneDriveForBusiness.CreateOneDriveFolder=function(dialogParams,gridControl,isUploadDocument){Util.ShowProgressMessage();var SDKCallParams=OneDriveForBusiness.getSDKCallParameters(dialogParams,isUploadDocument),validateFolder=false;DocumentManagement.SdkMessage.CreateFolder(SDKCallParams.foldername,SDKCallParams.entityReference,SDKCallParams.sitetype,validateFolder,isUploadDocument,dialogParams,gridControl,SDKCallParams.regardingEntityLogicalName,SDKCallParams.regardingObjectId,SDKCallParams.filename,OneDriveForBusiness.CreateFolderSuccessCallback,OneDriveForBusiness.CreateFolderFailureCallBack)};OneDriveForBusiness.HandleOneDriveLocationNotCreated=function(gridControl){Util.ShowProgressMessage();SharePointUtil.IsPersonalSitesPresent(function(response){Util.HideProgressMessage();if(!response)OneDriveForBusiness.ShowOneDriveFirstRunExperience(gridControl);else{var locationName=Util.GetResourceString(Constants.ONEDRIVE_LOCATION_NAME_KEY);DocumentManagement.SharePointChangeLocation.SetChangeLocationParamters(gridControl,DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED,locationName,1)}},OneDriveForBusiness.OneDriveConfigurationFailureCallback)};OneDriveForBusiness.ShowOneDriveFirstRunExperience=function(gridControl){var dialogParams={};dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();dialogParams[Constants.MDDConstants.ENTITY_NAME]=Util.GetRecordNameFromPage();DocumentManagement.OneDriveConfiguration.OpenOneDriveConfigurationDialog(dialogParams,gridControl)};OneDriveForBusiness.getSDKCallParameters=function(dialogParams,isUploadDocument){var params={};params[Constants.ParameterConstants.FILE_NAME]="";params[Constants.ParameterConstants.REGARDING_OBJECT_ID]=dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID];params[Constants.ParameterConstants.LOCATION_ID]=dialogParams[Constants.MDDConstants.LOCATION_ID];params[Constants.ParameterConstants.RECORD_NAME]=dialogParams[Constants.MDDConstants.ENTITY_NAME];params[Constants.ParameterConstants.REGARDING_ENTITY_LOGICAL_NAME]=dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME];params[Constants.ParameterConstants.FOLDER_NAME]="";params[Constants.ParameterConstants.SITE_TYPE]=Constants.AttributeNames.ONE_DRIVE_SITE_TYPE;params[Constants.ParameterConstants.ENTITY_REFERENCE]={id:params[Constants.ParameterConstants.REGARDING_OBJECT_ID],entityType:params[Constants.ParameterConstants.REGARDING_ENTITY_LOGICAL_NAME]};params[Constants.ParameterConstants.FOLDER_NAME]=Util.FormatFolderName(params[Constants.ParameterConstants.RECORD_NAME],params[Constants.ParameterConstants.REGARDING_OBJECT_ID]);if(!isUploadDocument)params[Constants.ParameterConstants.FILE_NAME]=dialogParams[Constants.FormXMLControls.DOCUMENT_NAME_CONTROL];return params};OneDriveForBusiness.ShowConfirmFolderForOneDrive=function(gridControl,entityReference){var dialogOptions=Util.GetDialogOptions(280,670,1),params=[gridControl,entityReference],confirmFolderCallback=Util.CreateCallbackFunctionFactory(OneDriveForBusiness.confirmFolderCallback,params),currentUserId=DocumentManagement.GenericUtilities.GetCurrentUserId();currentUserId=DocumentManagement.GenericUtilities.FormatGuid(currentUserId);var EntityName=DocumentManagement.SharePointConstants.EntityNames.SYSTEM_USER_ENTITY,ODBcolumns=[DocumentManagement.SharePointConstants.AttributeNames.DEFAULT_ODB_FOLDER_NAME];DocumentManagement.SdkMessage.Retrieve(EntityName,currentUserId,ODBcolumns,null,function(eventContext,entity){Util.HideProgressMessage();var confirmDialogStrings=OneDriveForBusiness.getUpdateFolderDialogStrings(entity[DocumentManagement.SharePointConstants.AttributeNames.DEFAULT_ODB_FOLDER_NAME]);Util.OpenConfirmDialog(confirmDialogStrings,dialogOptions,confirmFolderCallback,OneDriveForBusiness.HandleOneDriveFirstRunExperienceCancelled)},OneDriveForBusiness.OneDriveConfigurationFailureCallback)};OneDriveForBusiness.getUpdateFolderDialogStrings=function(FolderName){var confirmDialogStrings=Util.GetConfirmDialogStringObject();confirmDialogStrings.title=Util.GetResourceString(Constants.MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_TITLE);confirmDialogStrings.subtitle=Util.Format(Util.GetResourceString(Constants.MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_DESCRIPTION),FolderName);confirmDialogStrings.text=Util.GetResourceString(Constants.MDDConstants.ONE_DRIVE_CONFIRM_DIALOG_SUB_DESCRIPTION);return confirmDialogStrings};OneDriveForBusiness.confirmFolderCallback=function(gridControl,entityReference){Util.CommandSuccessTelemetry(Constants.Commands.ONEDRIVE_CONFIRM_DIALOG);Util.ShowProgressMessage();var folderName=Util.FormatFolderName(entityReference.name,entityReference.id);DocumentManagement.SdkMessage.CreateOneDriveFolderRequest(folderName,entityReference,Constants.AttributeNames.ONE_DRIVE_SITE_TYPE,false,gridControl,OneDriveForBusiness.OneDriveConfigurationSuccessCallback,OneDriveForBusiness.OneDriveConfigurationFailureCallback)};OneDriveForBusiness.CreateFolderSuccessCallback=function(isUploadDocument,locationId,dialogParams,gridControl,regardingEntityLogicalName,regardingObjectId,fileName){var entityLogicalName=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY,columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL];DocumentManagement.SdkMessage.Retrieve(entityLogicalName,locationId,columns,null,function(eventcontext,sharePointDocumentLocation){Util.HideProgressMessage();var locationName=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME];if(gridControl!=null){DocumentManagement.SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName,1);if(isUploadDocument){dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;DocumentManagement.SharePointDocumentUpload.UploadDocumentRecord(dialogParams,gridControl,false,Util.Empty)}else{var fileType=dialogParams[Constants.MDDConstants.DOCUMENT_TYPE],parentEntityReference={id:regardingObjectId,entityType:regardingEntityLogicalName},isOneDriveLocationCreated=false;DocumentManagement.SharePointNewDocument.CreateNewSharePointDocument(fileName,locationId,gridControl,isOneDriveLocationCreated,parentEntityReference,fileType,Util.Empty)}}},function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse)})};OneDriveForBusiness.OneDriveConfigurationSuccessCallback=function(gridControl,locationId){var entityLogicalName=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY,columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL];DocumentManagement.SdkMessage.Retrieve(entityLogicalName,locationId,columns,null,function(eventcontext,sharePointDocumentLocation){Util.HideProgressMessage();var locationName=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME];Util.CommandSuccessTelemetry(Constants.Commands.ONEDRIVE_FRE_SUCCESS,[]);DocumentManagement.SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName,1)},OneDriveForBusiness.OneDriveConfigurationFailureCallback)};OneDriveForBusiness.OneDriveConfigurationFailureCallback=function(errorResponse){Util.HideProgressMessage();OneDriveForBusiness.HandleOneDriveFirstRunExperienceError(errorResponse)};OneDriveForBusiness.CreateFolderFailureCallBack=function(errorResponse){Util.HideProgressMessage();Util.CommandErrorTelemetry(Constants.Commands.CREATE_FOLDER_FAILURE,errorResponse);Util.HandleErrorMessage(errorResponse)};OneDriveForBusiness.HandleCreateFolderErrorInOneDriveFRE=function(errorResponse,gridControl,entityReference){var codePrefix="0x",duplicationErrorCode=codePrefix+Constants.ErrorCodes.DUPLICATION_ERROR_CODE.toString(16),hexErrorCode;hexErrorCode=Util.getHexErrorCode(errorResponse.errorCode);if(Util.EqualsIgnoreCase(duplicationErrorCode,hexErrorCode))OneDriveForBusiness.ShowConfirmFolderForOneDrive(gridControl,entityReference);else OneDriveForBusiness.OneDriveConfigurationFailureCallback(errorResponse)};OneDriveForBusiness.HandleOneDriveFirstRunExperienceError=function(errorResponse){var alertString=Util.GetResourceString(DocumentManagement.SharePointConstants.ResourceStrings.ONEDRIVE_CONFIGURATION_ERROR);Util.CommandErrorTelemetry(Constants.Commands.ONEDRIVE_FRE_FAILURE,errorResponse);var dialogOptions=Util.GetDialogOptions(200,420,1);DocumentManagement.GenericUtilities.OpenAlertDialog(alertString)};OneDriveForBusiness.HandleOneDriveFirstRunExperienceCancelled=function(){var alertString=Util.Format(Util.GetResourceString(DocumentManagement.SharePointConstants.ResourceStrings.ONEDRIVE_CONFIGURATION_CANCELLED),"\n"),dialogOptions=Util.GetDialogOptions(200,420,1);DocumentManagement.GenericUtilities.OpenAlertDialog(alertString,dialogOptions)};return OneDriveForBusiness}();DocumentManagement.OneDriveForBusiness=OneDriveForBusiness})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointAddLocation=function(){function SharePointAddLocation(){}SharePointAddLocation.AddSharePointDocLocation=function(gridControl){var eventParams=[],clientType=Util.GetClientType();Util.CommandSuccessTelemetry(Constants.Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT);var objectId=Util.GetIdFromPage(),oName=Util.GetEntityPrimaryAttribute(),regardingEntityLogicalName=Util.GetEntityNameFromPage(),locationName=Util.Empty,defaultLocationId=Util.Empty,callback=null,folderName=Util.Empty,mode=0;if(!Util.isNullOrEmpty(oName))oName=Util.ReplaceSpecialCharactersFromFolderName(oName);SharePointAddLocation.OpenSharePointAddLocationDialog(gridControl,objectId,regardingEntityLogicalName,oName,mode,folderName,locationName,defaultLocationId,callback)};SharePointAddLocation.EditSharePointDocLocation=function(gridControl,locationId,folderName,locationName,commandProperties){var eventParams=[],clientType=Util.GetClientType();Util.CommandSuccessTelemetry(Constants.Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT);var objectId=Util.GetIdFromPage(),oName=Util.GetEntityPrimaryAttribute(),callback=null,regardingEntityLogicalName=Util.GetEntityNameFromPage();if(Util.GetClientType()==1){if(commandProperties!=null&&commandProperties.SourceControlId!=null){locationId=commandProperties.SourceControlId.substr(commandProperties.SourceControlId.length-36);var entityLogicalName=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY,columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL];DocumentManagement.SdkMessage.Retrieve(entityLogicalName,locationId,columns,null,function(eventcontext,sharePointDocumentLocation){var locationName=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME],folderName=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL];SharePointAddLocation.OpenSharePointAddLocationDialog(gridControl,objectId,regardingEntityLogicalName,oName,1,folderName,locationName,locationId,callback)},function(errorResponse){Util.HandleErrorMessage(errorResponse)})}}else SharePointAddLocation.OpenSharePointAddLocationDialog(gridControl,objectId,regardingEntityLogicalName,oName,1,folderName,locationName,locationId,callback)};SharePointAddLocation.OpenSharePointAddLocationDialog=function(gridControl,oId,regardingEntityLogicalName,oName,mode,folderName,locationName,defaultLocationId,callback){var dialogParams={};dialogParams[Constants.MDDConstants.ENTITY_ID]=oId;dialogParams[Constants.MDDConstants.ENTITY_NAME]=oName;dialogParams[Constants.MDDConstants.MODE]=mode;dialogParams[Constants.MDDConstants.FOLDER_NAME]=folderName;dialogParams[Constants.MDDConstants.LOCATION_NAME]=locationName;dialogParams[Constants.MDDConstants.LOCATION_ID]=defaultLocationId;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=regardingEntityLogicalName;var dialogOptions=Util.GetDialogOptions(420,800,1),closeCallback=SharePointAddLocation.dialogCloseCallback,callbackParams=SharePointAddLocation.GetCallbackParams(gridControl);Util.OpenDialog(Constants.DialogNames.SHAREPOINT_ADD_LOCATION_DIALOG,dialogOptions,dialogParams,closeCallback,callbackParams)};SharePointAddLocation.OnLoadAddSharePointLocation=function(eventContext){var mode=parseInt(Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.MODE)),headerDescription=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.HEADER_CONTROL_ADD_LOCATION_DIALOG);if(mode==1){var headerDescription_1=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.HEADER_CONTROL_ADD_LOCATION_DIALOG),subHeaderFirstControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.EDIT_LOCATION_SUBHEADER_CONTROL_FIRST),subHeaderSecondControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.EDIT_LOCATION_SUBHEADER_CONTROL_SECOND),parentSiteOrLocationLabelControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.EDIT_LOCATION_PARENTSITEORLOCATION_LABEL);headerDescription_1.setLabel(Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDIT_LOCATION_TITLE)));subHeaderFirstControl.setLabel(Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDIT_LOCATION_SUBHEADER_FIRST)));subHeaderSecondControl.setLabel(Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDIT_LOCATION_SUBHEADER_SECOND)));parentSiteOrLocationLabelControl.setLabel(Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_EDIT_LOCATION_PARENTSITEORLOCATION_LABEL)))}SharePointAddLocation.PopulateDialogFields(eventContext)};SharePointAddLocation.PopulateDialogFields=function(eventContext){var mode=parseInt(Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.MODE)),regardingObjectId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_ID),regardingEntityLogicalName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME);if(mode==0){var query=new DocumentManagement.Query.FetchExpression;query.EntityName=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY;var columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_ID,Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL,Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,Constants.AttributeNames.SERVICE_TYPE,Constants.AttributeNames.PARENT_SITE_OR_LOCATION];query.AddAttributes(columns);var rootFilter=new DocumentManagement.Query.Filter;rootFilter.Type=0;rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.REGARDING_OBJECT_ID,0,regardingObjectId));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.STATE_CODE,0,0));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.STATUS_CODE,0,1));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.SHAREPOINT_LOCATION_TYPE,0,0));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.SERVICE_TYPE,0,0));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID,9,"true"));rootFilter.AddCondition(new DocumentManagement.Query.Condition(Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL,8,null));query.AddFilter(rootFilter);query.Order=new DocumentManagement.Query.Order(Constants.AttributeNames.MODIFIED_ON,1);DocumentManagement.SdkMessage.RetrieveMultiple(eventContext,query.EntityName,query.toString(),SharePointAddLocation.RetrieveDefaultLocationSuccessCallback,function(errorResponse){Util.HandleErrorMessage(errorResponse)})}else if(mode==1){var locationId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.LOCATION_ID);if(locationId==null){SharePointUtil.FetchSharePointDefaultDocument(regardingObjectId,eventContext,SharePointAddLocation.FetchSharePointDefaultDocumentSuccessCallback,SharePointAddLocation.FetchSharePointDefaultDocumentFailureCallback);SharePointUtil.RetrieveDefaultSPSite(eventContext,SharePointAddLocation.RetrieveDefaultSitesSuccessCallback,SharePointAddLocation.RetrieveDefaultSitesFailureCallback)}else{var entityLogicalName=DocumentManagement.EntityUtilities.EntityNames.SharePointDocumentLocation,columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA,Constants.AttributeNames.RETRIEVE_URL,Constants.AttributeNames.REGARDING_OBJECT_ID_FOR_ODATA,Constants.AttributeNames.SHAREPOINT_LOCATION_SITE_COLLECTION_ID];DocumentManagement.SdkMessage.Retrieve(entityLogicalName,locationId,columns,eventContext,SharePointAddLocation.SharePointDocumentLocationCallback,SharePointAddLocation.SharePointDocumentLocationFailureCallback)}}};SharePointAddLocation.RetrieveDefaultLocationSuccessCallback=function(eventContext,locations){var regardingObjectId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_ID),regardingEntityLogicalName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME);if(locations!=null&&locations.length>0){var parentLocation=locations[0][Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA];if(parentLocation==null){SharePointUtil.FetchActiveLocationCountForEntity(regardingObjectId,regardingEntityLogicalName,eventContext,SharePointAddLocation.PopulateDefaults,SharePointAddLocation.FetchActiveLocationCountForEntityFailureCallback);SharePointUtil.RetrieveDefaultSPSite(eventContext,SharePointAddLocation.RetrieveDefaultSitesSuccessCallback,SharePointAddLocation.RetrieveDefaultSitesFailureCallback)}else{var sharePointDocumentLocation=locations[0];if(sharePointDocumentLocation!=null){var displayNameControlText=Util.GetResourceString(Constants.ResourceStrings.DIALOG_ADDSHAREPOINTLOCATION_DISPLAYNAME_VALUE);displayNameControlText=Util.Format(displayNameControlText,locations.length);Util.SetControlValue(Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL,displayNameControlText);var oName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_NAME).toString();if(!Util.isNullOrEmpty(oName)){var folderNameText=oName;Util.SetControlValue(Constants.FormXMLControls.FOLDER_NAME_CONTROL,folderNameText)}var lookUpControlDefaultObject={};lookUpControlDefaultObject.id=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA];lookUpControlDefaultObject.name=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_NAME];lookUpControlDefaultObject.entityType=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY;var lookUpControlDefaultObjectArray=new Array(1);lookUpControlDefaultObjectArray[0]=lookUpControlDefaultObject;Util.SetControlValue(Constants.FormXMLControls.PARENT_SITE_CONTROL,lookUpControlDefaultObjectArray)}}}};SharePointAddLocation.GetCallbackParams=function(gridControl){var callbackParams={};callbackParams[Constants.MDDConstants.GRID_CONTROL]=gridControl;return callbackParams};SharePointAddLocation.dialogCloseCallback=function(dialogParams,callbackParams,parameters){if(dialogParams!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){var gridControl=callbackParams[Constants.MDDConstants.GRID_CONTROL],locationId=parameters[Constants.MDDConstants.LOCATION_ID],locationName=parameters[Constants.MDDConstants.LOCATION_NAME];DocumentManagement.SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName,0)}};SharePointAddLocation.RetrieveDefaultSitesFailureCallback=function(errorResponse){Util.HandleErrorMessage(errorResponse)};SharePointAddLocation.RetrieveDefaultSitesSuccessCallback=function(eventContext,sites){var defaultSite=null;if(sites.length>0&&sites[0][Constants.IS_DEFAULT])defaultSite=sites[0];if(defaultSite!=null){var lookUpControlDefaultObject={};lookUpControlDefaultObject.id=defaultSite[Constants.AttributeNames.SHAREPOINT_ID].toString();lookUpControlDefaultObject.name=defaultSite[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME];lookUpControlDefaultObject.entityType=Constants.EntityNames.SHAREPOINT_SITE_ENTITY;var lookUpControlDefaultObjectArray=new Array(1);lookUpControlDefaultObjectArray[0]=lookUpControlDefaultObject;Util.SetControlValue(Constants.FormXMLControls.PARENT_SITE_CONTROL,lookUpControlDefaultObjectArray)}};SharePointAddLocation.FetchSharePointDefaultDocumentFailureCallback=function(errorResponse){Util.HandleErrorMessage(errorResponse)};SharePointAddLocation.FetchActiveLocationCountForEntityFailureCallback=function(errorResponse){Util.HandleErrorMessage(errorResponse)};SharePointAddLocation.PopulateDefaults=function(eventContext,entityCount){var oId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_ID),oName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_NAME),oType=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_TYPE_CODE),displayNameControlText=Util.GetResourceString(Constants.ResourceStrings.DIALOG_ADDSHAREPOINTLOCATION_DISPLAYNAME_VALUE);displayNameControlText=Util.Format(displayNameControlText,entityCount+1);var displayNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL);Util.SetControlValue(Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL,displayNameControlText);if(!Util.isNullOrEmpty(oName)){var folderNameText=oName;Util.SetControlValue(Constants.FormXMLControls.FOLDER_NAME_CONTROL,folderNameText)}};SharePointAddLocation.FetchSharePointDefaultDocumentSuccessCallback=function(eventContext,sharePointEntityCollection){var sharePointEntity=sharePointEntityCollection[0];SharePointAddLocation._currentLocId=sharePointEntity[Constants.AttributeNames.SHAREPOINT_LOCATION_ID];if(sharePointEntity[Constants.AttributeNames.PARENT_SITE_OR_LOCATION]!=null){var displayNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL),displayNameText=sharePointEntity[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME].toString();Util.SetControlValue(Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL,displayNameText);var folderNameText=sharePointEntity[Constants.AttributeNames.RETRIEVE_URL].toString();Util.SetControlValue(Constants.FormXMLControls.FOLDER_NAME_CONTROL,folderNameText)}var locationNameTextValue=sharePointEntity[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME].toString()};SharePointAddLocation.SharePointDocumentLocationFailureCallback=function(errorResponse){Util.HandleErrorMessage(errorResponse)};SharePointAddLocation.SharePointDocumentLocationCallback=function(eventContext,sharePointDocumentLocation){if(sharePointDocumentLocation!=null){var regardingObjectId=sharePointDocumentLocation[Constants.AttributeNames.REGARDING_OBJECT_ID_FOR_ODATA],value=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA];if(value!=null){var folderNameText=sharePointDocumentLocation[Constants.AttributeNames.RETRIEVE_URL].toString();Util.SetControlValue(Constants.FormXMLControls.FOLDER_NAME_CONTROL,folderNameText);var displayNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL),displayNameText=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME].toString();Util.SetControlValue(Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL,displayNameText);var locationNameTextValue=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME].toString(),lookUpControlDefaultObject={};lookUpControlDefaultObject.id=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_FOR_ODATA];lookUpControlDefaultObject.name=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_PARENT_SITE_OR_LOCATION_NAME];lookUpControlDefaultObject.entityType=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY;var lookUpControlDefaultObjectArray=new Array(1);lookUpControlDefaultObjectArray[0]=lookUpControlDefaultObject;Util.SetControlValue(Constants.FormXMLControls.PARENT_SITE_CONTROL,lookUpControlDefaultObjectArray)}}};SharePointAddLocation.OnClickAddEditSharePointLocation=function(eventContext){var isAddMode=parseInt(Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.MODE))==0,isCreateFolder=true,locationLookupArray=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.PARENT_SITE_CONTROL),displaynameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL),parentSiteControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.PARENT_SITE_CONTROL),folderNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.FOLDER_NAME_CONTROL),folderName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.FOLDER_NAME_CONTROL),displayName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.ADD_EDIT_LOCATION_DISPLAY_NAME_CONTROL),parentSiteName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.PARENT_SITE_CONTROL);if(!displayName){displaynameControl.setFocus();return}else if(!parentSiteName){parentSiteControl.setFocus();return}if(!folderName){folderNameControl.setFocus();return}folderName=folderName.toString().trim();if(locationLookupArray==null||locationLookupArray[0]==null||locationLookupArray[0].id==null)Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_SITE_NAME_NOTIFICATION));else{var result=Util.ValidateFolderName(folderName);switch(result){case 0:SharePointAddLocation.createSharePointFolderURL(eventContext,folderName,isAddMode,isCreateFolder);break;case 1:Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_INVALID_FOLDER_NAME));break;case 2:Util.OpenAlertDialog(Util.Format(Util.GetResourceString(Constants.ResourceStrings.LOCID_DOCM_FOLDERNAME_MAXLENGTH),Constants.FOLDER_NAME_MAX_LENGTH));break}}};SharePointAddLocation.createSharePointFolderURL=function(eventContext,folderName,isAddMode,isCreateFolder){Util.ShowProgressMessage();var locationLookup=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.PARENT_SITE_CONTROL)[0],documentId=Util.FormatGuid(locationLookup.id),locationType=locationLookup.entityType,regardingEntityLogicalName=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME),locationUrl="",regardingObjectId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_ID),parentEntityReference={id:regardingObjectId,entityType:regardingEntityLogicalName};DocumentManagement.SdkMessage.FetchSiteUrl(documentId,parentEntityReference,function(url){SharePointAddLocation._entityCentricPrimaryName=null;SharePointAddLocation._entityCentricEntityName=null;SharePointAddLocation._folderName=folderName;locationUrl=url+"/";if(locationType==Constants.EntityNames.SHAREPOINT_SITE_ENTITY)locationUrl+=regardingEntityLogicalName+"/";locationUrl+=folderName;SharePointAddLocation.createOrUpdateSharePointLocation(eventContext,folderName,locationUrl,isAddMode,isCreateFolder,regardingEntityLogicalName)},SharePointAddLocation.fetchSiteUrlErrorCallback)};SharePointAddLocation.fetchSiteUrlErrorCallback=function(errorResponse){Util.HideProgressMessage();Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_GENERIC_MESSAGE))};SharePointAddLocation.createOrUpdateSharePointLocation=function(eventContext,locationRelativeUrl,absoluteUrl,isAddMode,isCreateFolder,regardingEntityLogicalName){var locationName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.LOCATION_ID_CONTROL).toString(),parentType="",parentId="",docId="";if(!Util.isNullOrEmpty(absoluteUrl)){var locationLookup=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.PARENT_SITE_CONTROL)[0];parentId=Util.FormatGuid(locationLookup.id);parentType=locationLookup.entityType}if(!isAddMode)docId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.LOCATION_ID);var regardingObjectId=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.ENTITY_ID),parentEntityReference={id:regardingObjectId,entityType:regardingEntityLogicalName};SharePointAddLocation.CreateOrUpdateSharePointDocument(locationName,absoluteUrl,locationRelativeUrl,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext)};SharePointAddLocation.CreateOrUpdateSharePointDocument=function(locationName,absoluteUrl,locationRelativeUrl,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext){DocumentManagement.SdkMessage.AddOrEditLocation(locationName,absoluteUrl,locationRelativeUrl,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,function(locationId){Util.HideProgressMessage();Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.FOLDER_NAME,locationRelativeUrl);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LOCATION_NAME,locationName);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LOCATION_ID,locationId);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);var eventParams=[],locationIdParam={name:Constants.MDDConstants.LOCATION_ID,value:locationId};eventParams.push(locationIdParam);Util.CommandSuccessTelemetry(isAddMode?Constants.Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT_SUCCESS:Constants.Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT_SUCCESS,eventParams);Util.ClosePage()},function(errorResponse){if(parseInt(errorResponse.errorCode.toString())==Constants.ErrorCodes.DUPLICATION_ERROR_CODE){Util.HideProgressMessage();SharePointAddLocation.handleSharePointLocationDuplication(locationName,absoluteUrl,locationRelativeUrl,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext)}else{Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(isAddMode?Constants.Commands.ADD_LOCATION_SHAREPOINT_DOCUMENT_FAILURE:Constants.Commands.EDIT_LOCATION_SHAREPOINT_DOCUMENT_FAILURE,errorResponse);Util.ClosePage()}})};SharePointAddLocation.handleSharePointLocationDuplication=function(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext){DocumentManagement.SharePointUpdateFolder.Invoker(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,false,docId,parentEntityReference,eventContext)};SharePointAddLocation.locationGuid={};return SharePointAddLocation}();DocumentManagement.SharePointAddLocation=SharePointAddLocation})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,OneDriveConfiguration=function(){function OneDriveConfiguration(){}OneDriveConfiguration.OpenOneDriveConfigurationDialog=function(dialogParams,gridControl){var dialogOptions=Util.GetDialogOptions(280,670,1),closeCallback=OneDriveConfiguration.createOneDriveConfigurationCallback,parameters=[gridControl];Util.OpenDialog(DocumentManagement.DialogUtilities.DialogName.ONE_DRIVE_CONFIGURATION_DIALOG,dialogOptions,dialogParams,closeCallback,parameters)};OneDriveConfiguration.createOneDriveConfigurationCallback=function(dialogParams,controlParameters,parameters){if(dialogParams!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.CONTINUE_BUTTON_CONTROL){var gridControl=controlParameters[0];Util.ShowProgressMessage();var entityReference={id:dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID],entityType:dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME],name:dialogParams[Constants.MDDConstants.ENTITY_NAME]},folderName=Util.FormatFolderName(entityReference.name,entityReference.id);DocumentManagement.SdkMessage.CreateOneDriveFolderRequest(folderName,entityReference,Constants.AttributeNames.ONE_DRIVE_SITE_TYPE,true,gridControl,DocumentManagement.OneDriveForBusiness.OneDriveConfigurationSuccessCallback,DocumentManagement.OneDriveForBusiness.HandleCreateFolderErrorInOneDriveFRE)}else DocumentManagement.OneDriveForBusiness.HandleOneDriveFirstRunExperienceCancelled()};OneDriveConfiguration.OnLoadOneDriveConfigurationDialog=function(eventContext){var currentUserId=DocumentManagement.GenericUtilities.GetCurrentUserId();currentUserId=DocumentManagement.GenericUtilities.FormatGuid(currentUserId);var EntityName=DocumentManagement.SharePointConstants.EntityNames.SYSTEM_USER_ENTITY,ODBcolumns=[DocumentManagement.SharePointConstants.AttributeNames.DEFAULT_ODB_FOLDER_NAME],folderNameToDisplayControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.FOLDER_NAME_TO_DISPLAY_CONTROL);DocumentManagement.SdkMessage.Retrieve(EntityName,currentUserId,ODBcolumns,null,function(eventContext,entity){var labelDescription=Util.Format(Util.GetResourceString(Constants.ResourceStrings.LABEL_TO_DISPLAY_FOR_ONEDRIVECONFIG),entity.defaultodbfoldername);folderNameToDisplayControl.setLabel(labelDescription)},function(errorResponse){Util.HandleErrorMessage(errorResponse)})};OneDriveConfiguration.ChangeOneDriveFolderSettings=function(eventContext){DocumentManagement.OneDriveFolderSettings.OpenOneDriveFolderSettingsDialog(eventContext)};OneDriveConfiguration.ContinueCreateFolderForOneDrive=function(eventContext){Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.CONTINUE_BUTTON_CONTROL);Util.ClosePage()};return OneDriveConfiguration}();DocumentManagement.OneDriveConfiguration=OneDriveConfiguration})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointMenuBuilder=function(){function SharePointMenuBuilder(){}SharePointMenuBuilder.DynamicMenuBuilder=function(commandProperties,entityTypeName,gridControl){if(Util.GetClientType()==1){var isOneNoteIntegrationEnabled_1=Util.IsFeatureEnabled(Constants.FCB_ONENOTE_INTEGRATION),_promise=new window.Promise(function(resolve){SharePointUtil.RetrieveSharePointDocLocationForMenuBuilder(Util.GetIdFromPage(),isOneNoteIntegrationEnabled_1,commandProperties,function(eventContext,locations){for(var commandId=SharePointMenuBuilder.getCommandId(commandProperties),isOneDriveFolderNotCreated=false,menuitem=0;menuitem<locations.length;menuitem++)if(locations[menuitem].servicetype==1)isOneDriveFolderNotCreated=true;if(commandId==Constants.MenuParams.CHANGE_LOCATION_COMMAND){if(DocumentManagement.SharePointUtilities.IsOneDriveEnabled){if(!isOneDriveFolderNotCreated){var OneDriveObject={};OneDriveObject.servicetype=1;OneDriveObject.name=Util.GetResourceString(Constants.ONEDRIVE_LOCATION_NAME_KEY);OneDriveObject.sharepointdocumentlocationid=DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED;locations.push(OneDriveObject)}var sharedWithMeObject={};sharedWithMeObject.servicetype=2;sharedWithMeObject.name=Util.GetResourceString(Constants.SHARED_WITH_ME_LOCATION_NAME_KEY);sharedWithMeObject.sharepointdocumentlocationid=DocumentManagement.DialogUtilities.DialogConstants.SHARED_LOCATION_GUID;locations.push(sharedWithMeObject)}var allLocationsObject={},allLocationsStr=Util.GetResourceString(Constants.ALL_LOCATIONS_NAME_KEY);if(allLocationsStr==null||allLocationsStr==undefined||allLocationsStr=="")allLocationsStr="All Locations";allLocationsObject.name=allLocationsStr;allLocationsObject.sharepointdocumentlocationid=DocumentManagement.DialogUtilities.DialogConstants.ALL_FILES_LOCATION_GUID;locations.push(allLocationsObject)}return resolve(SharePointMenuBuilder.buildMenu(commandProperties,locations))},function(errorResponse){Util.HandleErrorMessage(errorResponse)})});commandProperties["PopulationXML"]=_promise;return}};SharePointMenuBuilder.buildMenu=function(commandProperties,locations){var menuId=commandProperties.SourceControlId,commandId=SharePointMenuBuilder.getCommandId(commandProperties),locationButtonsControl=SharePointMenuBuilder.buildControlsFromLocations(commandProperties,menuId,commandId,locations),menuSection=SharePointMenuBuilder.buildMenuSection(menuId,10,locationButtonsControl),menuSections=[];menuSections.push(menuSection);var menu=SharePointMenuBuilder.buildMenuSections(menuId,menuSections);return menu};SharePointMenuBuilder.buildMenuSection=function(menuId,sequenceNum,controls){var section={Id:menuId+".section",Sequence:Util.Format("{0}",sequenceNum),DisplayMode:6,Item:controls};return section};SharePointMenuBuilder.buildMenuSections=function(menuId,menuSections){var menu={Id:menuId,MenuSection:menuSections};return menu};SharePointMenuBuilder.buildControlsFromLocations=function(commandProperties,menuId,commandId,locations){for(var buttons=[],controlsPrefix=menuId+".Controls",i=0;i<locations.length;i++){var button={ControlType:"Button",Id:controlsPrefix+"."+locations[i].sharepointdocumentlocationid,Command:commandId,Sequence:Util.Format("'{0}'",i*10+10),ToolTipDescription:locations[i].name,Alt:locations[i].name,LabelText:locations[i].name,ModernImage:"SharePointOpenDocument"};buttons.push(button)}var controls={Id:controlsPrefix,Items:buttons};return controls};SharePointMenuBuilder.getCommandId=function(commandProperties){switch(commandProperties.SourceControlId){case Constants.MenuParams.CHANGE_LOCATION_CONTROL_ID:case Constants.MenuParams.CHANGE_LOCATION_SUBGRID_CONTROL_ID:return Constants.MenuParams.CHANGE_LOCATION_COMMAND;case Constants.MenuParams.EDIT_LOCATION_CONTROL_ID:case Constants.MenuParams.EDIT_LOCATION_SUBGRID_CONTROL_ID:return Constants.MenuParams.EDIT_LOCATION_COMMAND;case Constants.MenuParams.OPEN_IN_SHAREPOINT_CONTROL_ID:case Constants.MenuParams.OPEN_IN_SHAREPOINT_SUBGRID_CONTROL_ID:return Constants.MenuParams.OPEN_IN_SHAREPOINT_COMMAND}};return SharePointMenuBuilder}();DocumentManagement.SharePointMenuBuilder=SharePointMenuBuilder})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointChangeLocation=function(){function SharePointChangeLocation(){}SharePointChangeLocation.ChangeSharePointDocumentLocation=function(gridControl,locationId,locationName,commandProperties){if(Util.GetClientType()==1){if(commandProperties!=null&&commandProperties.SourceControlId!=null){locationId=commandProperties.SourceControlId.substr(commandProperties.SourceControlId.length-36);if(DocumentManagement.GenericUtilities.compareGuid(locationId,DocumentManagement.DialogUtilities.DialogConstants.SHARED_LOCATION_GUID)){var locationName_1=Util.GetResourceString(Constants.SHARED_WITH_ME_LOCATION_NAME_KEY);SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName_1,2);return}else if(DocumentManagement.GenericUtilities.compareGuid(locationId,DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED)){DocumentManagement.OneDriveForBusiness.HandleOneDriveLocationNotCreated(gridControl);return}else if(DocumentManagement.GenericUtilities.compareGuid(locationId,DocumentManagement.DialogUtilities.DialogConstants.ALL_FILES_LOCATION_GUID))SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,Util.GetResourceString(Constants.ALL_LOCATIONS_NAME_KEY),4);else{var entityLogicalName=Constants.EntityNames.SHAREPOINT_LOCATION_ENTITY,columns=[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME,Constants.AttributeNames.SHAREPOINT_LOCATION_RELATIVE_URL,Constants.AttributeNames.SHAREPOINT_SERVICE_TYPE];DocumentManagement.SdkMessage.Retrieve(entityLogicalName,locationId,columns,null,function(eventcontext,sharePointDocumentLocation){var locationName=sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_LOCATION_NAME];SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName,sharePointDocumentLocation[Constants.AttributeNames.SHAREPOINT_SERVICE_TYPE])},function(errorResponse){Util.HandleErrorMessage(errorResponse)})}}}else if(DocumentManagement.GenericUtilities.compareGuid(locationId,DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED)){DocumentManagement.OneDriveForBusiness.HandleOneDriveLocationNotCreated(gridControl);return}else SharePointChangeLocation.SetChangeLocationParamters(gridControl,locationId,locationName,1)};SharePointChangeLocation.SetChangeLocationParamters=function(gridControl,locationId,locationName,servicetype){var eventParams=[],clientType=Util.GetClientType(),locationIdParam={name:Constants.LOCATION_ID,value:locationId};eventParams.push(locationIdParam);Util.CommandSuccessTelemetry(Constants.Commands.CHANGE_LOCAITON_SHAREPOINT_DOCUMENT,eventParams);var parameterNames,parameterValues;if(Util.GetClientType()==0){var sharePointIframe=window.frameElement;sharePointIframe.setAttribute(Constants.IFRAME_LOCATION_NAME,locationName);var locationUrl=sharePointIframe.contentWindow.location.href,Mscrm_2=Util.GetMscrmStaticObject(),uri=Mscrm_2.CrmUri.create(locationUrl);uri.get_query()[Constants.MDDConstants.LOCATION_ID_URL_PARAMETER]=locationId;uri.get_query()[Constants.MDDConstants.VIEW_ID_URL_PARAMETER]=gridControl.getViewSelector().getCurrentView().id;sharePointIframe.src=uri.toString()}else{parameterNames=new Array(3);parameterValues=new Array(3);parameterNames[0]="locationId";parameterValues[0]=locationId;parameterNames[1]="locationName";parameterValues[1]=locationName;parameterNames[2]="servicetype";parameterValues[2]=servicetype.toString();SharePointChangeLocation.SetParameter(gridControl,parameterNames,parameterValues);gridControl.refreshRibbon();gridControl.refresh()}};SharePointChangeLocation.SetParameter=function(gridControl,parameterNames,parameterValues){if(Util.GetClientType()==1)if(parameterNames.length>0){for(var filterExpression='<filter type="and">',i=0;i<parameterNames.length;i++)filterExpression+='<condition attribute="'+parameterNames[i].toLowerCase()+'" operator= "eq" value= "'+Xrm.Encoding.xmlEncode(parameterValues[i])+'" />';filterExpression+="</filter>";gridControl.setFilterXml(filterExpression)}};return SharePointChangeLocation}();DocumentManagement.SharePointChangeLocation=SharePointChangeLocation})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentCheckin=function(){function SharePointDocumentCheckin(){}SharePointDocumentCheckin.Invoker=function(gridControl){if(gridControl!=null){var checkInDocumentDialogObject=new SharePointDocumentCheckin,dialogOptions=Util.GetDialogOptions(378,600,1),dialogParams={};if(Util.GetClientType()==1)dialogParams=checkInDocumentDialogObject.getDialogParamsForUCI(gridControl);else dialogParams=checkInDocumentDialogObject.getDialogParamsForWebClient(gridControl);var eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.MDDConstants.FILE_TYPE,value:dialogParams[Constants.MDDConstants.FILE_TYPE]};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.CHECKIN_SHAREPOINT_DOCUMENT,eventParams);var closeCallback=SharePointDocumentCheckin.CloseCallback,callbackParams=checkInDocumentDialogObject.getCallbackParams(gridControl);Util.OpenDialog(DocumentManagement.DialogUtilities.DialogName.SHAREPOINT_CHECKIN_DIALOG,dialogOptions,dialogParams,closeCallback,callbackParams)}};SharePointDocumentCheckin.CheckInClickHandler=function(eventContext){var comments=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.COMMENTS_CONTROL),isRetain=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.RETAIN_CHECKOUT_CONTROL);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.COMMENTS_CONTROL,comments);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.RETAIN_CHECKOUT_CONTROL,isRetain);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);Util.ClosePage()};SharePointDocumentCheckin.CloseCallback=function(dialogParams,callbackParams,parameters){Util.SetPerfMarker("CheckinSharePointDocumentStart");if(dialogParams!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){var retainFlag=parameters[Constants.FormXMLControls.RETAIN_CHECKOUT_CONTROL]==1?"true":"false",comments=parameters[Constants.FormXMLControls.COMMENTS_CONTROL]==null?Util.Empty:parameters[Constants.FormXMLControls.COMMENTS_CONTROL],gridControl=callbackParams[Constants.MDDConstants.GRID_CONTROL],record=(new SharePointDocumentCheckin).getDocumentRecord(dialogParams,comments,retainFlag,gridControl);SharePointDocumentCheckin.ExecuteSDKMessage(record[0],comments,retainFlag,record[1],gridControl)}};SharePointDocumentCheckin.ExecuteSDKMessage=function(documentRecord,comments,retainFlag,parentEntityReference,gridControl){Util.ShowProgressMessage();DocumentManagement.SdkMessage.CheckInFiles(documentRecord,comments,retainFlag,parentEntityReference,gridControl,SharePointDocumentCheckin.DocumentCheckInSuccessCallBack,SharePointDocumentCheckin.DocumentCheckInFailureCallBack)};SharePointDocumentCheckin.DocumentCheckInSuccessCallBack=function(gridControl){Util.HideProgressMessage();gridControl.refresh();Util.SetPerfMarker("CheckinSharePointDocumentSDKEnd&GridRefreshStart");Util.CommandSuccessTelemetry(Constants.Commands.CHECKIN_SHAREPOINT_DOCUMENT_SUCCESS)};SharePointDocumentCheckin.DocumentCheckInFailureCallBack=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.CHECKIN_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};SharePointDocumentCheckin.prototype.getDocumentRecord=function(dialogParams,comments,retainFlag,gridControl){var documentRecord={},parameters={};documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=dialogParams[Constants.MDDConstants.ENTITY_ID].toString();documentRecord[Constants.AttributeNames.DOCUMENT_ID]=dialogParams[Constants.MDDConstants.DOCUMENT_ID].toString();documentRecord[Constants.AttributeNames.LOCATION_ID]=dialogParams[Constants.MDDConstants.LOCATION_ID].toString();var entityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:entityReference.id,entityType:entityReference.entityType};parameters=[documentRecord,parentEntityReference];return parameters};SharePointDocumentCheckin.prototype.getDialogParamsForWebClient=function(gridControl){var dialogParams={},rowId=Util.GetFirstSelectedRowId(gridControl),locationId=Util.GetCellValue(Constants.AttributeNames.LOCATION_ID,rowId,gridControl),documentId=Util.GetCellValue(Constants.AttributeNames.DOCUMENT_ID,rowId,gridControl),entityId=Util.GetCellValue(Constants.AttributeNames.OBJECT_ID,rowId,gridControl),fileType=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,rowId,gridControl);dialogParams[Constants.MDDConstants.ENTITY_ID]=entityId;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.DOCUMENT_ID]=documentId;dialogParams[Constants.MDDConstants.FILE_TYPE]=fileType;return dialogParams};SharePointDocumentCheckin.prototype.getDialogParamsForUCI=function(gridControl){var selectedRecords=gridControl.getGrid().getSelectedRows(),dialogParams={},index=0;if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var sharepointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue(),documentId=row.data.entity.attributes.get(Constants.AttributeNames.DOCUMENT_ID).getValue(),locationId=row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue(),fileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.DOCUMENT_ID]=documentId;dialogParams[Constants.MDDConstants.ENTITY_ID]=sharepointDocumentId;dialogParams[Constants.MDDConstants.FILE_TYPE]=fileType}});return dialogParams};SharePointDocumentCheckin.prototype.getCallbackParams=function(gridControl){var callbackParams={};callbackParams[Constants.MDDConstants.GRID_CONTROL]=gridControl;return callbackParams};return SharePointDocumentCheckin}();DocumentManagement.SharePointDocumentCheckin=SharePointDocumentCheckin})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentCheckout=function(){function SharePointDocumentCheckout(){}SharePointDocumentCheckout.Checkout=function(gridControl){Util.SetPerfMarker("CheckoutSharePointDocumentStart");if(gridControl!=null){Util.ShowProgressMessage();var paramaters={};if(Util.GetClientType()==1)paramaters=SharePointDocumentCheckout.getParametersForUCI(gridControl);else paramaters=SharePointDocumentCheckout.getParametersForWebClient(gridControl);var eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.MDDConstants.FILE_TYPE,value:paramaters[Constants.MDDConstants.FILE_TYPE]};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.CHECKOUT_SHAREPOINT_DOCUMENT,eventParams);SharePointDocumentCheckout.CheckoutFile(paramaters[Constants.LOCATION_ID],paramaters[Constants.DOCUMENT_ID],paramaters[Constants.ENTITY_ID],gridControl)}};SharePointDocumentCheckout.getParametersForUCI=function(gridControl){var params={},selectedRecords=gridControl.getGrid().getSelectedRows(),index=0;if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var sharepointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue(),documentId=row.data.entity.attributes.get(Constants.AttributeNames.DOCUMENT_ID).getValue(),locationId=row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue(),fileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue();params[Constants.LOCATION_ID]=locationId;params[Constants.DOCUMENT_ID]=documentId;params[Constants.ENTITY_ID]=sharepointDocumentId;params[Constants.MDDConstants.FILE_TYPE]=fileType}});return params};SharePointDocumentCheckout.getParametersForWebClient=function(gridControl){var params={},selectedRow=Util.GetSelectedRow(gridControl),documentId=Util.GetGridCellValue(gridControl,selectedRow,"documentid"),entityId=Util.GetGridCellValue(gridControl,selectedRow,"oid"),locationId=Util.GetGridCellValue(gridControl,selectedRow,"locationid"),fileType=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE);params[Constants.LOCATION_ID]=locationId;params[Constants.DOCUMENT_ID]=documentId;params[Constants.ENTITY_ID]=entityId;params[Constants.MDDConstants.FILE_TYPE]=fileType;return params};SharePointDocumentCheckout.CheckoutFile=function(locationId,documentId,entityId,gridControl){SharePointUtil.DisableAssociatedGridCommandBar();var documentRecord={};documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=entityId;documentRecord[Constants.AttributeNames.DOCUMENT_ID]=documentId;if(Util.isNullOrEmpty(locationId))documentRecord.locationid="";else documentRecord.locationid=locationId;var entityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:entityReference.id,entityType:entityReference.entityType};DocumentManagement.SdkMessage.CheckoutFile(documentRecord,gridControl,parentEntityReference,SharePointDocumentCheckout.CheckoutFileSuccessCallBack,SharePointDocumentCheckout.CheckoutFileFailureCallback)};SharePointDocumentCheckout.CheckoutFileSuccessCallBack=function(gridControl){SharePointUtil.EnableAssociatedGridCommandBar();gridControl.refresh();Util.SetPerfMarker("CheckoutSharePointDocumentSDKEnd");Util.CommandSuccessTelemetry(Constants.Commands.CHECKOUT_SHAREPOINT_DOCUMENT_SUCCESS);Util.HideProgressMessage()};SharePointDocumentCheckout.CheckoutFileFailureCallback=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);SharePointUtil.EnableAssociatedGridCommandBar();Util.CommandErrorTelemetry(Constants.Commands.CHECKOUT_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};return SharePointDocumentCheckout}();DocumentManagement.SharePointDocumentCheckout=SharePointDocumentCheckout})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentDelete=function(){function SharePointDocumentDelete(){}SharePointDocumentDelete.Invoker=function(gridControl,records){Util.SetPerfMarker("DeleteSharePointRecordsDialogLoadStart");gridControl!=null&&Xrm.Utility.getEntityMetadata(DocumentManagement.EntityUtilities.EntityNames.SharePointDocument).then(function(metadata){var deleteDocumentDialogObject=new SharePointDocumentDelete,dialogOptions=Util.GetDialogOptions(252,570,1),confirmDialogStrings=deleteDocumentDialogObject.getDeleteDocumentDialogStrings(records,metadata),parameters=deleteDocumentDialogObject.getParametersForDeleteCallback(gridControl,confirmDialogStrings,dialogOptions,null),confirmDialogCallback=Util.CreateCallbackFunctionFactory(SharePointDocumentDelete.ConfirmCloseCallback,parameters);Util.OpenConfirmDialog(confirmDialogStrings,dialogOptions,confirmDialogCallback,null);Util.SetPerfMarker("DeleteSharePointRecordsDialogLoadEnd")})};SharePointDocumentDelete.ConfirmCloseCallback=function(entityCollection,gridControl,parentEntityReference){Util.SetPerfMarker("DeleteSharePointRecordsSDKStart");if(entityCollection!=null){Util.ShowProgressMessage();DocumentManagement.SdkMessage.DeleteDocument(entityCollection,parentEntityReference,gridControl,SharePointDocumentDelete.DeleteDocumentSuccessCallBack,SharePointDocumentDelete.DeleteDocumentFailureCallback)}};SharePointDocumentDelete.DeleteDocumentSuccessCallBack=function(gridControl){Util.SetPerfMarker("DeleteSharePointRecordsSDKEnd");Util.HideProgressMessage();gridControl.refresh();Util.CommandSuccessTelemetry(Constants.Commands.DELETE_SHAREPOINT_DOCUMENT_SUCCESS)};SharePointDocumentDelete.DeleteDocumentFailureCallback=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.DELETE_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};SharePointDocumentDelete.prototype.getDeleteDocumentDialogStrings=function(records,spDocumentEntityMetadata){var iObjType=DocumentManagement.EntityUtilities.EntityNames.SharePointDocument,iTotal=records.length,ObjName=Util.GetEntityDisplayName(spDocumentEntityMetadata);if(iTotal>1)ObjName=Util.GetEntityLocalizedSetName(spDocumentEntityMetadata);var confirmDialogStrings=Util.GetConfirmDialogStringObject();confirmDialogStrings.title=Util.GetResourceString(Constants.ResourceStrings.DIALOG_DELETESHAREPOINTCONFIRM_TITLE);confirmDialogStrings.subtitle="";confirmDialogStrings.text=Util.Format(Util.GetResourceString(Constants.ResourceStrings.DIALOG_DELETESHAREPOINTCONFIRM_DESCRIPTION),iTotal,ObjName);confirmDialogStrings.confirmButtonLabel=Util.GetResourceString(Constants.ResourceStrings.BUTTON_LABEL_DELETE);confirmDialogStrings.cancelButtonLabel="";return confirmDialogStrings};SharePointDocumentDelete.prototype.getParametersForDeleteCallback=function(gridControl,dialogStrings,dialogOptions,successCallback){var parameters,documentRecords;if(Util.GetClientType()==1)documentRecords=SharePointDocumentDelete.GetDocumentRecordCollectionForUCI(gridControl);else documentRecords=SharePointDocumentDelete.GetDocumentRecordCollectionForWebClient(gridControl);var eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,value:documentRecords[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.DELETE_SHAREPOINT_DOCUMENT,eventParams);var entityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:entityReference.id,entityType:entityReference.entityType};parameters=[documentRecords,gridControl,parentEntityReference];return parameters};SharePointDocumentDelete.GetDocumentRecordCollectionForWebClient=function(gridControl){for(var selectedRecords=gridControl.GetRecordsFromInnerGrid(true),documentRecords=new Array(selectedRecords.length),i=0;i<selectedRecords.length;i++){var documentRecord={},rowId=selectedRecords[i][0],sharepointDocumentId=Util.GetCellValue(Constants.AttributeNames.OBJECT_ID,rowId,gridControl),documentId=Util.GetCellValue(Constants.AttributeNames.DOCUMENT_ID,rowId,gridControl),locationId=Util.GetCellValue(Constants.AttributeNames.LOCATION_ID,rowId,gridControl),sharePointDocumentFileType=Util.GetCellValue(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,rowId,gridControl);documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=sharepointDocumentId;documentRecord[Constants.AttributeNames.DOCUMENT_ID]=documentId;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]=sharePointDocumentFileType;if(Util.isNullOrEmpty(locationId))documentRecord.locationid="";else documentRecord.locationid=locationId;documentRecords[i]=documentRecord}return documentRecords};SharePointDocumentDelete.GetDocumentRecordCollectionForUCI=function(gridControl){var selectedRecords=gridControl.getGrid().getSelectedRows(),documentRecords=new Array(selectedRecords.getLength()),index=0;selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var documentRecord={},sharepointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue(),documentId=row.data.entity.attributes.get(Constants.AttributeNames.DOCUMENT_ID).getValue(),locationId=row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue(),sharePointDocumentFileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue();documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID]=sharepointDocumentId;documentRecord[Constants.AttributeNames.DOCUMENT_ID]=documentId;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE]=sharePointDocumentFileType;if(Util.isNullOrEmpty(locationId))documentRecord.locationid="";else documentRecord.locationid=locationId;documentRecords[index++]=documentRecord}});return documentRecords};return SharePointDocumentDelete}();DocumentManagement.SharePointDocumentDelete=SharePointDocumentDelete})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,Constants=DocumentManagement.SharePointConstants,SharePointDocumentEdit=function(){function SharePointDocumentEdit(){}SharePointDocumentEdit.SharePointDocumentEdit=function(gridControl,records){Util.SetPerfMarker("EditSharepointDocumentStart");if(gridControl!=null&&records.length==1){var eventParams=[],selectedRow=Util.GetSelectedRow(gridControl),fileType=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE),clientType=Util.GetClientType(),fileTypeParam={name:Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE,value:fileType};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.EDIT_SHAREPOINT_DOCUMENT,eventParams);var params={};if(clientType==1)params=SharePointDocumentEdit.getParamsForUCI(gridControl);else params=SharePointDocumentEdit.getParamsForWebClient(gridControl);(!Util.isNullOrEmpty(params[Constants.ABSOLUTE_URL])||!Util.isNullOrEmpty(params[Constants.EDIT_URL]))&&DocumentManagement.OpenRecordUtil.openUrl(params[Constants.ABSOLUTE_URL],params[Constants.EDIT_URL],params[Constants.FILETYPE])}};SharePointDocumentEdit.getParamsForUCI=function(gridControl){var params={},selectedRecords=gridControl.getGrid().getSelectedRows(),index=0;if(selectedRecords.getLength()==1)selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){var sharepointDocumentId=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_ID).getValue(),absoluteUrl=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL).getValue(),editUrl=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_SITE_EDIT_URL).getValue(),fileType=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE).getValue();params[Constants.ABSOLUTE_URL]=absoluteUrl;params[Constants.EDIT_URL]=editUrl;params[Constants.ENTITY_ID]=sharepointDocumentId;params[Constants.FILETYPE]=fileType}});return params};SharePointDocumentEdit.getParamsForWebClient=function(gridControl){var params={},selectedRow=Util.GetSelectedRow(gridControl),entityId=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.OBJECT_ID),absoluteUrl=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL),editUrl=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_SITE_EDIT_URL),fileType=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_DOCUMENT_FILE_TYPE);params[Constants.ABSOLUTE_URL]=absoluteUrl;params[Constants.EDIT_URL]=editUrl;params[Constants.ENTITY_ID]=entityId;params[Constants.FILETYPE]=fileType;return params};return SharePointDocumentEdit}();DocumentManagement.SharePointDocumentEdit=SharePointDocumentEdit})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointDocumentUpload=function(){function SharePointDocumentUpload(){}SharePointDocumentUpload.SharePointUpload=function(gridControl,primaryEntityTypeCode){Util.CommandSuccessTelemetry(Constants.Commands.UPLOAD_SHAREPOINT_DOCUMENT);var sharePointDocumentUploadDialog=new SharePointDocumentUpload,pid=Util.GetIdFromPage(),pType=primaryEntityTypeCode,locationId=Util.GetParameterFromGridControl(gridControl,Constants.GridParams.LOCATION_ID),recordName=Util.GetRecordNameFromPage(),foldername=recordName+"_"+pid,relativeLocation=Util.GetParameterFromGridControl(gridControl,Constants.GridParams.RELATIVE_LOCATION),dialogOptions=Util.GetDialogOptions(320,600,1),dialogParams={};dialogParams[Constants.MDDConstants.ENTITY_NAME]=recordName;dialogParams[Constants.MDDConstants.FOLDER_NAME]=foldername;dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=Util.GetEntityNameFromPage();dialogParams[Constants.MDDConstants.RELATIVE_LOCATION]=relativeLocation;var closeCallback=SharePointDocumentUpload.closeCallback,callbackParams=SharePointDocumentUpload.getCallbackParams(gridControl);Util.OpenDialog(Constants.DialogNames.SHAREPOINT_UPLOAD_DIALOG,dialogOptions,dialogParams,closeCallback,callbackParams)};SharePointDocumentUpload.OnLoadSharePointUplaodDocument=function(eventContext){};SharePointDocumentUpload.UploadDocumentClickHandler=function(eventContext){var fileSize=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.UPLOAD_DOCUMENT_FILESIZE);if(fileSize>=52428800){Util.OpenAlertDialog(Util.GetResourceString(DocumentManagement.SharePointConstants.ResourceStrings.ALERT_UPLOAD_MAXFILESIZE));return}var fileContent=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.FILEUPLOAD_CONTROL),fileName=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.UPLOAD_DOCUMENT_FILENAME);if(fileSize==0&&fileContent==null&&fileName!=null){Util.OpenAlertDialog(Util.GetResourceString(DocumentManagement.SharePointConstants.ResourceStrings.ALERT_UPLOAD_MINFILESIZE));return}var overwriteValue=Util.GetAttributeFromPage(eventContext,Constants.FormXMLControls.OVERWRITE_CONTROL);if(fileName==null||fileContent==null||fileName==undefined||fileContent==undefined||fileName==""||fileContent==""){Util.OpenAlertDialog(Util.GetResourceString(DocumentManagement.SharePointConstants.ResourceStrings.ALERT_UPLOAD_NOFILESELECTED));return}Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.FILEUPLOAD_CONTROL,fileContent);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.UPLOAD_DOCUMENT_FILENAME,fileName);Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.OVERWRITE_CONTROL,overwriteValue);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);Util.ClosePage()};SharePointDocumentUpload.getCallbackParams=function(gridControl){var callbackParams={};callbackParams[Constants.MDDConstants.GRID_CONTROL]=gridControl;return callbackParams};SharePointDocumentUpload.closeCallback=function(dialogResponse,callbackParams,parameters){Util.SetPerfMarker("UploadStart");if(dialogResponse!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){var gridControl=callbackParams[Constants.MDDConstants.GRID_CONTROL];dialogResponse[Constants.FormXMLControls.FILEUPLOAD_CONTROL]=parameters[Constants.FormXMLControls.FILEUPLOAD_CONTROL];dialogResponse[Constants.FormXMLControls.UPLOAD_DOCUMENT_FILENAME]=parameters[Constants.FormXMLControls.UPLOAD_DOCUMENT_FILENAME];dialogResponse[Constants.FormXMLControls.OVERWRITE_CONTROL]=parameters[Constants.FormXMLControls.OVERWRITE_CONTROL];var locationId=dialogResponse[Constants.MDDConstants.LOCATION_ID];if(!locationId)locationId=DocumentManagement.DialogUtilities.DialogConstants.DefaultGuidString;var relativeLocation=dialogResponse[Constants.MDDConstants.RELATIVE_LOCATION]==null?Util.Empty:dialogResponse[Constants.MDDConstants.RELATIVE_LOCATION];if(locationId==DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED)DocumentManagement.OneDriveForBusiness.CreateOneDriveFolder(dialogResponse,gridControl,true);else SharePointDocumentUpload.UploadDocumentRecord(dialogResponse,gridControl,true,relativeLocation)}};SharePointDocumentUpload.ExecuteSDKMessage=function(fileContent,documentRecord,overWriteValue,parentEntityReference,gridControl,isOneDriveLocationCreated,relativeLocation){Util.ShowProgressMessage();DocumentManagement.SdkMessage.UploadDocument(fileContent,documentRecord,overWriteValue,parentEntityReference,gridControl,isOneDriveLocationCreated,relativeLocation,SharePointDocumentUpload.UploadDocumentSuccessCallBack,SharePointDocumentUpload.UploadDocumentFailureCallBack)};SharePointDocumentUpload.UploadDocumentSuccessCallBack=function(gridControl,locationId,isOneDriveLocationCreated){SharePointUtil.ReloadParentGridSP(gridControl,locationId,isOneDriveLocationCreated);Util.HideProgressMessage();Util.SetPerfMarker("UploadSharePointDocumentEnd");var RuntimeContext=DocumentManagement.RuntimeContextFactory.getRuntimeContext();RuntimeContext.LogUsageTelemetry("SharePoint.UploadDocument");Util.CommandSuccessTelemetry(Constants.Commands.UPLOAD_SHAREPOINT_DOCUMENT_SUCCESS)};SharePointDocumentUpload.UploadDocumentFailureCallBack=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.UPLOAD_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};SharePointDocumentUpload.UploadDocumentRecord=function(dialogParams,gridControl,isOneDriveLocationCreated,relativeLocation){var documentRecord={};documentRecord[Constants.ODATA_TYPE_CONSTANTS]=Constants.ODATA_ENTITY_CONSTANTS+Constants.EntityNames.SHAREPOINT_DOCUMENT_ENTITY;if(dialogParams[Constants.MDDConstants.LOCATION_ID]!=null&&dialogParams[Constants.MDDConstants.LOCATION_ID]!=undefined)documentRecord[Constants.AttributeNames.LOCATION_ID]=dialogParams[Constants.MDDConstants.LOCATION_ID].toString();var fileContent=dialogParams[Constants.FormXMLControls.FILEUPLOAD_CONTROL],overWriteValue=dialogParams[Constants.FormXMLControls.OVERWRITE_CONTROL]==1;documentRecord[Constants.AttributeNames.SHAREPOINT_DOCUMENT_TITLE]=dialogParams[Constants.FormXMLControls.UPLOAD_DOCUMENT_FILENAME].toString();var parentEntityName=dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME].toString(),parentEntityId=dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID].toString(),parentEntityReference={id:parentEntityId,entityType:parentEntityName};SharePointDocumentUpload.ExecuteSDKMessage(fileContent,documentRecord,overWriteValue,parentEntityReference,gridControl,isOneDriveLocationCreated,relativeLocation)};return SharePointDocumentUpload}();DocumentManagement.SharePointDocumentUpload=SharePointDocumentUpload})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointNewDocument=function(){function SharePointNewDocument(){}SharePointNewDocument.NewSharePointDocument=function(gridControl,documentType){if(gridControl!=null){var eventParams=[],clientType=Util.GetClientType(),fileTypeParam={name:Constants.MDDConstants.FILE_TYPE,value:documentType};eventParams.push(fileTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.NEW_SHAREPOINT_DOCUMENT,eventParams);var locationId=Util.GetParameterFromGridControl(gridControl,Constants.GridParams.LOCATION_ID),relativeLocation=Util.GetParameterFromGridControl(gridControl,Constants.GridParams.RELATIVE_LOCATION),regardingEntityLogicalName=Util.GetEntityNameFromPage(),recordName=Util.GetRecordNameFromPage(),dialogOptions=Util.GetDialogOptions(252,600,1),dialogParams={};dialogParams[Constants.MDDConstants.ENTITY_NAME]=recordName;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID]=Util.GetIdFromPage();dialogParams[Constants.MDDConstants.DOCUMENT_TYPE]=documentType;dialogParams[Constants.MDDConstants.LOCATION_ID]=locationId;dialogParams[Constants.MDDConstants.RELATIVE_LOCATION]=relativeLocation;dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ENTITY_NAME]=regardingEntityLogicalName;var closeCallback=SharePointNewDocument.CloseCallback,callbackParams=SharePointNewDocument.getCallbackParams(gridControl);Util.OpenDialog(DocumentManagement.DialogUtilities.DialogName.SHAREPOINT_NEWDOCUMENT_DIALOG,dialogOptions,dialogParams,closeCallback,callbackParams)}};SharePointNewDocument.getCallbackParams=function(gridControl){var callbackParams={};callbackParams[Constants.MDDConstants.GRID_CONTROL]=gridControl;return callbackParams};SharePointNewDocument.CloseCallback=function(dialogParams,callbackParams,parameters){if(dialogParams!=null&&parameters!=null&&parameters[Constants.MDDConstants.LAST_BUTTON_CLICKED]===Constants.FormXMLControls.OK_BUTTON_CONTROL){var gridControl=callbackParams[Constants.MDDConstants.GRID_CONTROL],locationId=dialogParams[Constants.MDDConstants.LOCATION_ID],fileType=dialogParams[Constants.MDDConstants.DOCUMENT_TYPE];if(!locationId)locationId=DocumentManagement.DialogUtilities.DialogConstants.DefaultGuidString;if(locationId==DocumentManagement.DialogUtilities.DialogConstants.ONEDRIVE_LOCATION_NOT_CREATED){dialogParams[Constants.FormXMLControls.DOCUMENT_NAME_CONTROL]=parameters[Constants.FormXMLControls.DOCUMENT_NAME_CONTROL];DocumentManagement.OneDriveForBusiness.CreateOneDriveFolder(dialogParams,gridControl,false)}else{var filename=parameters[Constants.FormXMLControls.DOCUMENT_NAME_CONTROL],regardingObjectId=dialogParams[Constants.MDDConstants.REGARDING_OBJECT_ID],relativeLocation=dialogParams[Constants.MDDConstants.RELATIVE_LOCATION]==null?Util.Empty:dialogParams[Constants.MDDConstants.RELATIVE_LOCATION],regardingEntityReference=Xrm.Page.data.entity.getEntityReference(),parentEntityReference={id:regardingEntityReference.id,entityType:regardingEntityReference.entityType},isOneDriveLocationCreated=true;SharePointNewDocument.CreateNewSharePointDocument(filename,locationId,gridControl,isOneDriveLocationCreated,parentEntityReference,fileType,relativeLocation)}}};SharePointNewDocument.CreateNewSharePointDocument=function(fileName,locationId,gridControl,isOneDriveLocationCreated,parentEntityReference,fileType,relativeLocation){Util.ShowProgressMessage();DocumentManagement.SdkMessage.NewDocument(fileName,locationId,gridControl,isOneDriveLocationCreated,parentEntityReference,Util.EqualsIgnoreCase(fileType,Constants.FOLDER)?true:false,relativeLocation,SharePointNewDocument.NewDocumentCreateSuccessCallback,SharePointNewDocument.NewDocumentCreateFailureCallback)};SharePointNewDocument.OnLoadNewSharePointDocument=function(eventContext){var headerControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.HEADER_CONTROL_NEW_DOCUMENT_DIALOG),relativeLocation=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.RELATIVE_LOCATION),documentNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.DOCUMENT_NAME_CONTROL),documentType=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.DOCUMENT_TYPE),titleDescription;switch(documentType){case "Word Document":titleDescription=Util.GetResourceString(Constants.ResourceStrings.DIALOG_WORD_HEADER);headerControl.setLabel(titleDescription);break;case "Excel Document":titleDescription=Util.GetResourceString(Constants.ResourceStrings.DIALOG_EXCEL_HEADER);headerControl.setLabel(titleDescription);break;case "Power Point":titleDescription=Util.GetResourceString(Constants.ResourceStrings.DIALOG_POWERPOINT_HEADER);headerControl.setLabel(titleDescription);break;case "OneNote":titleDescription=Util.GetResourceString(Constants.ResourceStrings.DIALOG_ONENOTE_HEADER);headerControl.setLabel(titleDescription);break;case "Folder":titleDescription=Util.GetResourceString(Constants.ResourceStrings.DIALOG_NEWFOLDER_HEADER);headerControl.setLabel(titleDescription);break;default:break}};SharePointNewDocument.NewDocument=function(eventContext){var documentType=Util.GetAttributeFromPage(eventContext,Constants.MDDConstants.DOCUMENT_TYPE),extension="";if(!Util.EqualsIgnoreCase(documentType,"folder"))extension=SharePointUtil.DocumentExt(documentType);var documentNameControl=Util.GetControlFromPage(eventContext,Constants.FormXMLControls.DOCUMENT_NAME_CONTROL),documentNameControlValue=documentNameControl.getAttribute().getValue();if(!documentNameControlValue){documentNameControl.setFocus();return}documentNameControlValue=documentNameControlValue.toString();var prefix=SharePointUtil.ParseDocumentName(documentNameControl.getAttribute().getValue().toString(),extension),fileName=prefix+extension,result=SharePointUtil.ValidateDocumentName(prefix);switch(result){case 0:break;case 1:Util.OpenAlertDialog(Util.GetResourceString(Constants.ResourceStrings.LOCID_INVALID_FILE_NAME));return}Util.SetAttributeValueInDialogParams(eventContext,Constants.FormXMLControls.DOCUMENT_NAME_CONTROL,fileName);Util.SetAttributeValueInDialogParams(eventContext,Constants.MDDConstants.LAST_BUTTON_CLICKED,Constants.FormXMLControls.OK_BUTTON_CONTROL);Util.ClosePage()};SharePointNewDocument.NewDocumentCreateSuccessCallback=function(editLink,gridControl,locationId,isOneDriveLocationCreated){SharePointUtil.SharePointDocumentEditUrl(editLink,null);SharePointUtil.ReloadParentGridSP(gridControl,locationId,isOneDriveLocationCreated);Util.HideProgressMessage();var RuntimeContext=DocumentManagement.RuntimeContextFactory.getRuntimeContext();RuntimeContext.LogUsageTelemetry("SharePoint.NewDocument");Util.CommandSuccessTelemetry(Constants.Commands.NEW_SHAREPOINT_DOCUMENT_SUCCESS)};SharePointNewDocument.NewDocumentCreateFailureCallback=function(errorResponse){Util.HideProgressMessage();Util.HandleErrorMessage(errorResponse);Util.CommandErrorTelemetry(Constants.Commands.NEW_SHAREPOINT_DOCUMENT_FAILURE,errorResponse)};return SharePointNewDocument}();DocumentManagement.SharePointNewDocument=SharePointNewDocument})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointOpenLocation=function(){function SharePointOpenLocation(){}SharePointOpenLocation.OpenSharePointLocation=function(gridControl,records){Util.SetPerfMarker("OpenInSharepoint_RecordSelected_start");if(gridControl!=null&&records.length>0){var serviceType_1="";if(Util.GetClientType()==1){var selectedRecords=gridControl.getGrid().getSelectedRows();selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity){if(row.data.entity.attributes.get(Constants.AttributeNames.SERVICE_TYPE)!=null)serviceType_1=row.data.entity.attributes.get(Constants.AttributeNames.SERVICE_TYPE).getValue();if(row.data.entity.attributes.get(Constants.AttributeNames.LOCATION_ID).getValue()==Constants.Guids.SHARED_LOCATION_GUID&&serviceType_1=="")serviceType_1=(2).toString()}})}else{var selectedRow=Util.GetSelectedRow(gridControl);serviceType_1=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SERVICE_TYPE);if(Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.LOCATION_ID)==Constants.Guids.SHARED_LOCATION_GUID&&serviceType_1=="")serviceType_1=(2).toString()}var eventParams=[],clientType=Util.GetClientType(),serviceTypeParam={name:Constants.AttributeNames.SERVICE_TYPE,value:serviceType_1};eventParams.push(serviceTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.OPEN_LOCATION_SHAREPOINT_DOCUMENT,eventParams);if(parseInt(serviceType_1)==2)DocumentManagement.SdkMessage.RetrievePersonalSiteUrl(SharePointOpenLocation.RetrievePersonalSiteUrlSuccessCallBack,SharePointOpenLocation.RetrievePersonalSiteUrlFailureCallback);else{var openUrl_1="";if(Util.GetClientType()==1){var selectedRecords=gridControl.getGrid().getSelectedRows();selectedRecords&&selectedRecords.forEach(function(row){if(row&&row.data&&row.data.entity)openUrl_1=row.data.entity.attributes.get(Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL).getValue()})}else{var selectedRow=Util.GetSelectedRow(gridControl);openUrl_1=Util.GetGridCellValue(gridControl,selectedRow,Constants.AttributeNames.SHAREPOINT_SITE_ABSOLUTE_URL)}if(!Util.isNullOrEmpty(openUrl_1)){SharePointUtil.SharePointDocumentLocationtUrl(openUrl_1,"");Util.SetPerfMarker("OpenInSharepoint_RecordSelected_Opening_newWindow")}}}};SharePointOpenLocation.RetrievePersonalSiteUrlSuccessCallBack=function(personalSiteUrl){var SharedWithMeUrlFormat="{0}/Documents/Forms/SharedWithMe.aspx/#",openUrl=Util.Format(SharedWithMeUrlFormat,personalSiteUrl);SharePointUtil.SharePointDocumentLocationtUrl(openUrl,"");Util.SetPerfMarker("OpenInSharepoint_RecordSelected_Opening_newWindow")};SharePointOpenLocation.RetrievePersonalSiteUrlFailureCallback=function(errorResponse){Util.HandleErrorMessage(errorResponse)};return SharePointOpenLocation}();DocumentManagement.SharePointOpenLocation=SharePointOpenLocation})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointOpenLocationCommand=function(){function SharePointOpenLocationCommand(){}SharePointOpenLocationCommand.OpenSharePointLocation=function(locationId,commandProperties){var regardingObjectId=Util.GetIdFromPage();if(Util.GetClientType()==1)if(commandProperties!=null&&commandProperties.SourceControlId!=null)locationId=commandProperties.SourceControlId.substr(commandProperties.SourceControlId.length-36);var regardingEntityLogicalName=Util.GetEntityNameFromPage(),parentEntityReference={id:regardingObjectId,entityType:regardingEntityLogicalName};DocumentManagement.SdkMessage.FetchSiteUrl(locationId,parentEntityReference,function(url){var dialogOptions={openInNewWindow:false},encodedURL=DocumentManagement.OpenRecordUtil.encodeUrl(url);Xrm.Navigation.openUrl(encodedURL,dialogOptions)},function(errorResponse){Util.HandleErrorMessage(errorResponse)})};return SharePointOpenLocationCommand}();DocumentManagement.SharePointOpenLocationCommand=SharePointOpenLocationCommand})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var Constants=DocumentManagement.SharePointConstants,Util=DocumentManagement.GenericUtilities,SharePointUtil=DocumentManagement.SharePointUtilities,SharePointUpdateFolder=function(){function SharePointUpdateFolder(){}SharePointUpdateFolder.Invoker=function(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext){var updateFolderDialogObject=new SharePointUpdateFolder,confirmClickCallback=updateFolderDialogObject.createConfirmClickCallback(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext),dialogOptions=Util.GetDialogOptions(200,500,1),confirmDialogStrings=updateFolderDialogObject.getUpdateFolderDialogStrings(absUrl),cancelClickCallback=null;Util.OpenConfirmDialog(confirmDialogStrings,dialogOptions,confirmClickCallback,cancelClickCallback);var eventParams=[],clientType=Util.GetClientType(),parentTypeParam={name:Constants.AttributeNames.SHAREPOINT_LOCATION_TYPE,value:parentType};eventParams.push(parentTypeParam);Util.CommandSuccessTelemetry(Constants.Commands.UPDATE_FOLDER_SHAREPOINT_DOCUMENT,eventParams)};SharePointUpdateFolder.ConfirmCloseCallback=function(callbackParams){var eventContext=callbackParams[Constants.MDDConstants.EVENT_CONTEXT],locationName=callbackParams["locationName"],absoluteUrl=callbackParams["absUrl"],locationRelativePath=callbackParams["locationRelativePath"],parentType=callbackParams["parentType"],parentId=callbackParams["parentId"],isAddMode=callbackParams["isAddMode"]=="true",docId=callbackParams["docId"],parentEntityReference=callbackParams["parentEntityReference"],isCreateFolder=false;DocumentManagement.SharePointAddLocation.CreateOrUpdateSharePointDocument(locationName,absoluteUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext)};SharePointUpdateFolder.prototype.getUpdateFolderDialogStrings=function(folderPath){var confirmDialogStrings=Util.GetConfirmDialogStringObject();confirmDialogStrings.title=Util.GetResourceString(Constants.MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_TITLE);confirmDialogStrings.subtitle=Util.Format(Util.GetResourceString(Constants.MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_DESCRIPTION),folderPath);confirmDialogStrings.text=Util.GetResourceString(Constants.MDDConstants.DIALOG_SHAREPOINT_UPDATE_FOLDER_TEXT);confirmDialogStrings.confirmButtonLabel=Util.GetResourceString(Constants.ResourceStrings.BUTTON_LABEL_CONFIRM);return confirmDialogStrings};SharePointUpdateFolder.prototype.createConfirmClickCallback=function(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext){var parameters=this.getParametersForConfirmCallback(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext),updateDialogCloseCallback=Util.CreateCallbackFunctionFactory(SharePointUpdateFolder.ConfirmCloseCallback,parameters);return updateDialogCloseCallback};SharePointUpdateFolder.prototype.getParametersForConfirmCallback=function(locationName,absUrl,locationRelativePath,parentType,parentId,isAddMode,isCreateFolder,docId,parentEntityReference,eventContext){var parameters={};parameters["locationName"]=locationName;parameters["absUrl"]=absUrl;parameters["locationRelativePath"]=locationRelativePath;parameters["parentType"]=parentType.toString();parameters["parentId"]=parentId;parameters["isAddMode"]=isAddMode.toString();parameters["isCreateFolder"]=isCreateFolder.toString();parameters["docId"]=docId;parameters["parentEntityReference"]=parentEntityReference;parameters[Constants.MDDConstants.EVENT_CONTEXT]=eventContext;return [parameters]};return SharePointUpdateFolder}();DocumentManagement.SharePointUpdateFolder=SharePointUpdateFolder})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var FileTypeIcon=function(){function FileTypeIcon(){}FileTypeIcon.loadSharePointFileTypeIcon=function(dataJson){var data=JSON.parse(dataJson),filetype=data["filetype"],locationId="",checkedOut;checkedOut=data["ischeckedout_Value"];locationId=data["locationid"];var imgurl="SharePointIcon_",iconClassName=data["iconclassname"],tooltip="",index=iconClassName!=null?iconClassName.lastIndexOf(" "):-1;iconClassName=index!=-1?iconClassName.substring(index+1):iconClassName;if(locationId&&DocumentManagement.GenericUtilities.FormatGuid(DocumentManagement.DialogUtilities.DialogConstants.SHARED_LOCATION_GUID)===DocumentManagement.GenericUtilities.FormatGuid(locationId))imgurl+=iconClassName+"_s.svg";else if(checkedOut===true||checkedOut==="1")imgurl+=iconClassName+"_c.svg";else imgurl+=iconClassName+".svg";var resultarray=[imgurl,"SharePointGridIcon"];return resultarray};return FileTypeIcon}();DocumentManagement.FileTypeIcon=FileTypeIcon})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var AddOrEditLocationRequest=function(){function AddOrEditLocationRequest(locationName,absUrl,relativePath,parentType,parentId,isAddOrEditMode,isCreateFolder,documentId,parentEntityReference){this.LocationName=locationName;this.AbsUrl=absUrl;this.RelativePath=relativePath;this.ParentType=parentType;this.ParentId=parentId;this.IsAddOrEditMode=isAddOrEditMode;this.IsCreateFolder=isCreateFolder;this.DocumentId=documentId;this.ParentEntityReference=parentEntityReference}AddOrEditLocationRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{LocationName:{typeName:"Edm.String",structuralProperty:1},AbsUrl:{typeName:"Edm.String",structuralProperty:1},RelativePath:{typeName:"Edm.String",structuralProperty:1},ParentType:{typeName:"Edm.String",structuralProperty:1},ParentId:{typeName:"Edm.String",structuralProperty:1},IsAddOrEditMode:{typeName:"Edm.Boolean",structuralProperty:1},IsCreateFolder:{typeName:"Edm.Boolean",structuralProperty:1},DocumentId:{typeName:"Edm.String",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"AddOrEditLocation",operationType:0};return metadata};return AddOrEditLocationRequest}();DocumentManagement.AddOrEditLocationRequest=AddOrEditLocationRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var CheckInDocumentRequest=function(){function CheckInDocumentRequest(entity,checkInComments,retainCheckout,parentEntityReference){this.Entity=entity;this.CheckInComments=checkInComments;this.RetainCheckout=retainCheckout;this.ParentEntityReference=parentEntityReference}CheckInDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entity:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},CheckInComments:{typeName:"Edm.String",structuralProperty:1},RetainCheckout:{typeName:"Edm.Boolean",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"CheckInDocument",operationType:0};return metadata};return CheckInDocumentRequest}();DocumentManagement.CheckInDocumentRequest=CheckInDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var CheckoutDocumentRequest=function(){function CheckoutDocumentRequest(entity,parentEntityReference){this.Entity=entity;this.ParentEntityReference=parentEntityReference}CheckoutDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entity:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"CheckoutDocument",operationType:0};return metadata};return CheckoutDocumentRequest}();DocumentManagement.CheckoutDocumentRequest=CheckoutDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var DeleteDocumentRequest=function(){function DeleteDocumentRequest(entities,parentEntityReference){this.Entities=entities;this.ParentEntityReference=parentEntityReference}DeleteDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entities:{typeName:"mscrm.crmbaseentity",structuralProperty:4},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"DeleteDocument",operationType:0};return metadata};return DeleteDocumentRequest}();DocumentManagement.DeleteDocumentRequest=DeleteDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var DiscardDocumentCheckoutRequest=function(){function DiscardDocumentCheckoutRequest(entity,parentEntityReference){this.Entity=entity;this.ParentEntityReference=parentEntityReference}DiscardDocumentCheckoutRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entity:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"DiscardDocumentCheckout",operationType:0};return metadata};return DiscardDocumentCheckoutRequest}();DocumentManagement.DiscardDocumentCheckoutRequest=DiscardDocumentCheckoutRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var EditDocumentPropertiesRequest=function(){function EditDocumentPropertiesRequest(entity,parentEntityReference){this.Entity=entity;this.ParentEntityReference=parentEntityReference}EditDocumentPropertiesRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entity:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"EditDocumentProperties",operationType:0};return metadata};return EditDocumentPropertiesRequest}();DocumentManagement.EditDocumentPropertiesRequest=EditDocumentPropertiesRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var FetchSiteUrlRequest=function(){function FetchSiteUrlRequest(documentId,parentEntityReference){this.DocumentId=documentId;this.ParentEntityReference=parentEntityReference}FetchSiteUrlRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{DocumentId:{typeName:"Edm.String",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"FetchSiteUrl",operationType:0};return metadata};return FetchSiteUrlRequest}();DocumentManagement.FetchSiteUrlRequest=FetchSiteUrlRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var NewDocumentRequest=function(){function NewDocumentRequest(fileName,locationId,parentEntityReference,isFolder,folderPath){this.FileName=fileName;this.LocationId=locationId;this.ParentEntityReference=parentEntityReference;this.IsFolder=isFolder;this.FolderPath=folderPath}NewDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{FileName:{typeName:"Edm.String",structuralProperty:1},LocationId:{typeName:"Edm.String",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},IsFolder:{typeName:"Edm.Boolean",structuralProperty:1},FolderPath:{typeName:"Edm.String",structuralProperty:1}},operationName:"NewDocument",operationType:0};return metadata};return NewDocumentRequest}();DocumentManagement.NewDocumentRequest=NewDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var RetrievePersonalSiteUrlRequest=function(){function RetrievePersonalSiteUrlRequest(){}RetrievePersonalSiteUrlRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{},operationName:"RetrievePersonalSiteUrl",operationType:1};return metadata};return RetrievePersonalSiteUrlRequest}();DocumentManagement.RetrievePersonalSiteUrlRequest=RetrievePersonalSiteUrlRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var SearchDocumentRequest=function(){function SearchDocumentRequest(regardingObjectType,regardingObjectId,documentId){this.RegardingObjectType=regardingObjectType;this.RegardingObjectId=regardingObjectId;this.DocumentId=documentId}SearchDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{RegardingObjectType:{typeName:"Edm.Int32",structuralProperty:1},RegardingObjectId:{typeName:"Edm.String",structuralProperty:1},DocumentId:{typeName:"Edm.String",structuralProperty:1}},operationName:"SearchDocument",operationType:0};return metadata};return SearchDocumentRequest}();DocumentManagement.SearchDocumentRequest=SearchDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var UploadDocumentRequest=function(){function UploadDocumentRequest(content,entity,overwriteExisting,parentEntityReference,folderPath){this.Content=content;this.Entity=entity;this.OverwriteExisting=overwriteExisting;this.ParentEntityReference=parentEntityReference;this.FolderPath=folderPath}UploadDocumentRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Content:{typeName:"Edm.String",structuralProperty:1},Entity:{typeName:"Microsoft.Dynamics.CRM.sharepointdocument",structuralProperty:5},OverwriteExisting:{typeName:"Edm.Boolean",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},FolderPath:{typeName:"Edm.String",structuralProperty:1}},operationName:"UploadDocument",operationType:0};return metadata};return UploadDocumentRequest}();DocumentManagement.UploadDocumentRequest=UploadDocumentRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var CreateFolderRequest=function(){function CreateFolderRequest(folderName,parentEntityReference,siteType,validateFolder){this.FolderName=folderName;this.ParentEntityReference=parentEntityReference;this.SiteType=siteType;this.ValidateFolder=validateFolder}CreateFolderRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{FolderName:{typeName:"Edm.String",structuralProperty:1},ParentEntityReference:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},SiteType:{typeName:"Edm.Int32",structuralProperty:1},ValidateFolder:{typeName:"Edm.Boolean",structuralProperty:1}},operationName:"CreateFolder",operationType:0};return metadata};return CreateFolderRequest}();DocumentManagement.CreateFolderRequest=CreateFolderRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var RenameFolderNameForOneDriveRequest=function(){function RenameFolderNameForOneDriveRequest(folderName){this.FolderName=folderName}RenameFolderNameForOneDriveRequest.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{FolderName:{typeName:"Edm.String",structuralProperty:1}},operationName:"RenameFolderNameForOneDrive",operationType:0};return metadata};return RenameFolderNameForOneDriveRequest}();DocumentManagement.RenameFolderNameForOneDriveRequest=RenameFolderNameForOneDriveRequest})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var OpenRecordUtil;(function(OpenRecordUtil){OpenRecordUtil.Constants={WordProtocol:"ms-word",ExcelProtocol:"ms-excel",PowerPointProtocol:"ms-powerpoint",OneNoteProtocol:"onenote",CommonOfficeProtocolWin8:"office",WordPackageName:"com.microsoft.office.word",ExcelPackageName:"com.microsoft.office.excel",PowerPointPackageName:"com.microsoft.office.powerpoint",OneNotePackageName:"com.microsoft.office.onenote",WordAppleStoreId:"id586447913",ExcelAppleStoreId:"id586683407",PowerPointAppleStoreId:"id586449534",OneNoteAppleStoreId:"id410395246"}})(OpenRecordUtil=DocumentManagement.OpenRecordUtil||(DocumentManagement.OpenRecordUtil={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var OpenRecordUtil;(function(OpenRecordUtil){var MapperUtil=function(){function MapperUtil(){}MapperUtil.getFileType=function(fileType){fileType=fileType.toLowerCase();switch(fileType){case "one":case "onetoc":case "onetoc2":return OpenRecordUtil.FileType.OneNote;case "docx":case "docm":case "dotx":case "dotm":case "doc":return OpenRecordUtil.FileType.Word;case "pptx":case "pptm":case "potx":case "potm":case "ppam":case "ppsx":case "ppsm":case "ppt":return OpenRecordUtil.FileType.PowerPoint;case "xlsx":case "xlsm":case "xltx":case "xltm":case "xlsb":case "xlam":return OpenRecordUtil.FileType.Excel;default:return OpenRecordUtil.FileType.Other}};MapperUtil.getProtocol=function(fileType){switch(fileType){case OpenRecordUtil.FileType.Word:return OpenRecordUtil.Constants.WordProtocol;case OpenRecordUtil.FileType.Excel:return OpenRecordUtil.Constants.ExcelProtocol;case OpenRecordUtil.FileType.PowerPoint:return OpenRecordUtil.Constants.PowerPointProtocol;case OpenRecordUtil.FileType.OneNote:return OpenRecordUtil.Constants.OneNoteProtocol}};MapperUtil.getAppStoreId=function(fileType,platformType){switch(platformType){case DocumentManagement.PlatformType.Android:switch(fileType){case OpenRecordUtil.FileType.Word:return OpenRecordUtil.Constants.WordPackageName;case OpenRecordUtil.FileType.Excel:return OpenRecordUtil.Constants.ExcelPackageName;case OpenRecordUtil.FileType.PowerPoint:return OpenRecordUtil.Constants.PowerPointPackageName;case OpenRecordUtil.FileType.OneNote:return OpenRecordUtil.Constants.OneNotePackageName}break;case DocumentManagement.PlatformType.Ios:switch(fileType){case OpenRecordUtil.FileType.Word:return OpenRecordUtil.Constants.WordAppleStoreId;case OpenRecordUtil.FileType.Excel:return OpenRecordUtil.Constants.ExcelAppleStoreId;case OpenRecordUtil.FileType.PowerPoint:return OpenRecordUtil.Constants.PowerPointAppleStoreId;case OpenRecordUtil.FileType.OneNote:return OpenRecordUtil.Constants.OneNoteAppleStoreId}break}};return MapperUtil}();OpenRecordUtil.MapperUtil=MapperUtil})(OpenRecordUtil=DocumentManagement.OpenRecordUtil||(DocumentManagement.OpenRecordUtil={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var OpenRecordUtil;(function(OpenRecordUtil){(function(FileType){FileType[FileType["Word"]=0]="Word";FileType[FileType["Excel"]=1]="Excel";FileType[FileType["PowerPoint"]=2]="PowerPoint";FileType[FileType["OneNote"]=3]="OneNote";FileType[FileType["Other"]=4]="Other"})(OpenRecordUtil.FileType||(OpenRecordUtil.FileType={}));var FileType=OpenRecordUtil.FileType,OpenRecordWrapper=function(){function OpenRecordWrapper(absoluteUrl,wopiUrl,fileType,context){this.fileType=OpenRecordUtil.MapperUtil.getFileType(fileType);this.runtimeContext=DocumentManagement.RuntimeContextFactory.getRuntimeContext(context);this.urlOpener=OpenRecordUtil.UrlOpenerFactory.getUrlOpener(absoluteUrl,wopiUrl,this.fileType,this.runtimeContext)}OpenRecordWrapper.prototype.openUrl=function(){this.urlOpener.openUrl()};return OpenRecordWrapper}();function openUrl(absoluteUrl,wopiUrl,fileType,context){(new OpenRecordWrapper(absoluteUrl,wopiUrl,fileType,context)).openUrl()}OpenRecordUtil.openUrl=openUrl;function encodeUrl(urlToEncode){var decodedUrl=urlToEncode;while(decodedUrl!==decodeURI(decodedUrl))decodedUrl=decodeURI(decodedUrl);return encodeURI(decodedUrl)}OpenRecordUtil.encodeUrl=encodeUrl})(OpenRecordUtil=DocumentManagement.OpenRecordUtil||(DocumentManagement.OpenRecordUtil={}))})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var RuntimeContextFactory=function(){function RuntimeContextFactory(){}RuntimeContextFactory.getRuntimeContext=function(context){if(context)return new DocumentManagement.CustomControlContext(context);else return new DocumentManagement.WebResourceContext};return RuntimeContextFactory}();DocumentManagement.RuntimeContextFactory=RuntimeContextFactory;(function(PlatformType){PlatformType[PlatformType["Browser"]=0]="Browser";PlatformType[PlatformType["Windows8"]=1]="Windows8";PlatformType[PlatformType["Windows10"]=2]="Windows10";PlatformType[PlatformType["Android"]=3]="Android";PlatformType[PlatformType["Ios"]=4]="Ios";PlatformType[PlatformType["Unknown"]=5]="Unknown"})(DocumentManagement.PlatformType||(DocumentManagement.PlatformType={}));var PlatformType=DocumentManagement.PlatformType;(function(BrowserType){BrowserType[BrowserType["Chrome"]=0]="Chrome";BrowserType[BrowserType["Firefox"]=1]="Firefox";BrowserType[BrowserType["Edge"]=2]="Edge";BrowserType[BrowserType["Safari"]=3]="Safari";BrowserType[BrowserType["IE"]=4]="IE";BrowserType[BrowserType["Other"]=5]="Other"})(DocumentManagement.BrowserType||(DocumentManagement.BrowserType={}));var BrowserType=DocumentManagement.BrowserType})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var WebResourceContext=function(){function WebResourceContext(){this.initPlatform();this.initBrowser()}WebResourceContext.prototype.openUrl=function(url,options){Xrm.Navigation.openUrl(url,options)};WebResourceContext.prototype.canOpenUrl=function(url){return Xrm.Internal.canOpenUrl(url)};WebResourceContext.prototype.getPlatformType=function(){return this.platformType};WebResourceContext.prototype.getPlatformName=function(){switch(this.platformType){case DocumentManagement.PlatformType.Android:return "Android";case DocumentManagement.PlatformType.Browser:return "Browser";case DocumentManagement.PlatformType.Ios:return "Ios";case DocumentManagement.PlatformType.Unknown:return "Unknown";case DocumentManagement.PlatformType.Windows10:return "Windows10";case DocumentManagement.PlatformType.Windows8:return "Windows8"}};WebResourceContext.prototype.getBrowserType=function(){return this.browsertype};WebResourceContext.prototype.getBrowserName=function(){switch(this.browsertype){case DocumentManagement.BrowserType.Chrome:return "Chrome";case DocumentManagement.BrowserType.Firefox:return "Firefox";case DocumentManagement.BrowserType.Edge:return "Edge";case DocumentManagement.BrowserType.Safari:return "Safari";case DocumentManagement.BrowserType.IE:return "IE";case DocumentManagement.BrowserType.Other:return "Other"}};WebResourceContext.prototype.getResourceString=function(key){return DocumentManagement.GenericUtilities.GetResourceString(key)};WebResourceContext.prototype.openConfirmDialog=function(strings){return Xrm.Navigation.openConfirmDialog(strings)};WebResourceContext.prototype.initPlatform=function(){if(!this.IsUciOnMobile){this.platformType=DocumentManagement.PlatformType.Browser;return}var platform=window.navigator.platform,userAgent=window.navigator.userAgent,androidMatcher=new RegExp("Android|Linux","g"),iOsMatcher=new RegExp("iPhone|iPad|iPod","g"),windowsMatcher=new RegExp("Windows|Win16|Win32|WinCE","g"),windows10UserAgentMatcher=new RegExp("Windows 10.0|Windows NT 10.0","g");if(platform.search(windowsMatcher)>-1){this.platformType=DocumentManagement.PlatformType.Windows10;if(userAgent.search(windows10UserAgentMatcher)==-1)this.platformType=DocumentManagement.PlatformType.Windows8}else if(platform.search(iOsMatcher)>-1)this.platformType=DocumentManagement.PlatformType.Ios;else if(platform.search(androidMatcher)>-1)this.platformType=DocumentManagement.PlatformType.Android;else this.platformType=DocumentManagement.PlatformType.Unknown};WebResourceContext.prototype.initBrowser=function(){var userAgent=window.navigator.userAgent;if(userAgent.indexOf("Chrome")!=-1)this.browsertype=DocumentManagement.BrowserType.Chrome;else if(userAgent.indexOf("Firefox")!=-1)this.browsertype=DocumentManagement.BrowserType.Firefox;else if(userAgent.indexOf("Edge")!=-1)this.browsertype=DocumentManagement.BrowserType.Edge;else if(userAgent.indexOf("Safari")!=-1)this.browsertype=DocumentManagement.BrowserType.Safari;else if(userAgent.indexOf("MSIE")!=-1||userAgent.indexOf("Trident")!=-1)this.browsertype=DocumentManagement.BrowserType.IE;else this.browsertype=DocumentManagement.BrowserType.Other};Object.defineProperty(WebResourceContext.prototype,"IsUciOnMobile",{"get":function(){return Xrm.Internal.isUci&&Xrm.Utility.getGlobalContext().client.getClient()==Xrm.Constants.ClientNames.mobile},enumerable:true,configurable:true});WebResourceContext.prototype.LogUsageTelemetry=function(ComponentName,context){var Platform=this.getPlatformName(),Browser=this.getBrowserName();Xrm!=null&&Xrm.Reporting!=null&&Xrm.Reporting.reportSuccess(ComponentName,[{name:"client",value:Platform},{name:"browser",value:Browser}])};return WebResourceContext}();DocumentManagement.WebResourceContext=WebResourceContext})(DocumentManagement||(DocumentManagement={}));var DocumentManagement;(function(DocumentManagement){var OpenRecordUtil;(function(OpenRecordUtil){var BrowserUrlOpener=function(){function BrowserUrlOpener(params){this.absoluteUrl=params.absoluteUrl;this.wopiUrl=params.wopiUrl;this.runtimeContext=params.runtimeContext}BrowserUrlOpener.prototype.openUrl=function(){var urlToOpen=this.absoluteUrl;if(this.wopiUrl&&this.wopiUrl.length>0)urlToOpen=this.wopiUrl;this.runtimeContext.openUrl(urlToOpen,{openInNewWindow:false})};return BrowserUrlOpener}(),WindowsUrlOpener=function(_super){__extends(WindowsUrlOpener,_super);function WindowsUrlOpener(params){_super.call(this,params);this.protocol=params.protocol}WindowsUrlOpener.prototype.openUrl=function(){window.location.href=this.getDocumentUrl()};WindowsUrlOpener.prototype.getDocumentUrl=function(){return this.protocol+":"+OpenRecordUtil.encodeUrl(this.absoluteUrl)};return WindowsUrlOpener}(BrowserUrlOpener),NativeAppUrlOpener=function(_super){__extends(NativeAppUrlOpener,_super);function NativeAppUrlOpener(params){_super.call(this,params);this.appStoreUrl="market://details?id=";this.fileType=params.fileType;this.appStoreId=params.appStoreId}NativeAppUrlOpener.prototype.openUrl=function(){var self=this;this.runtimeContext.canOpenUrl(this.getDocumentUrl()).then(function(canOpenUrl){if(canOpenUrl)self.runtimeContext.openUrl(self.getDocumentUrl(),{openInNewWindow:false});else{var confirmDialogStrings=self.getConfirmDialogStrings(OpenRecordUtil.FileType[self.fileType],self.runtimeContext);self.runtimeContext.openConfirmDialog(confirmDialogStrings).then(function(response){response.confirmed&&self.runtimeContext.openUrl(self.getAppStoreUrl(),{openInNewWindow:false})})}})};NativeAppUrlOpener.prototype.getAppStoreUrl=function(){return ""+this.appStoreUrl+this.appStoreId};NativeAppUrlOpener.prototype.getConfirmDialogStrings=function(fileType,runtimeContext){return {text:runtimeContext.getResourceString(fileType+"InstallConfirmDialogTitle"),confirmButtonLabel:runtimeContext.getResourceString("Get"+fileType+"OkButtonText")}};return NativeAppUrlOpener}(WindowsUrlOpener),IosUrlOpener=function(_super){__extends(IosUrlOpener,_super);function IosUrlOpener(){_super.apply(this,arguments);this.appStoreUrl="https://itunes.apple.com/app/"}return IosUrlOpener}(NativeAppUrlOpener),PassbackUrlOpener=function(_super){__extends(PassbackUrlOpener,_super);function PassbackUrlOpener(){_super.apply(this,arguments)}PassbackUrlOpener.prototype.getDocumentUrl=function(){return OpenRecordUtil.encodeUrl(this.protocol+":ofe|u|"+this.absoluteUrl+"|p|ms-dynamcisxrm")};return PassbackUrlOpener}(IosUrlOpener),UrlOpenerFactory=function(){function UrlOpenerFactory(){}UrlOpenerFactory.getUrlOpener=function(absoluteUrl,wopiUrl,fileType,runtimeContext){var platformType=runtimeContext.getPlatformType(),urlOpenerParams={absoluteUrl:absoluteUrl,wopiUrl:wopiUrl,fileType:fileType,protocol:OpenRecordUtil.MapperUtil.getProtocol(fileType),runtimeContext:runtimeContext,appStoreId:OpenRecordUtil.MapperUtil.getAppStoreId(fileType,platformType)},_urlOpener=this.getOpenerType(fileType,platformType);return new _urlOpener(urlOpenerParams)};UrlOpenerFactory.getOpenerType=function(filetype,platformType){switch(platformType){case DocumentManagement.PlatformType.Windows10:switch(filetype){case OpenRecordUtil.FileType.Word:case OpenRecordUtil.FileType.Excel:case OpenRecordUtil.FileType.PowerPoint:case OpenRecordUtil.FileType.OneNote:return WindowsUrlOpener}break;case DocumentManagement.PlatformType.Android:switch(filetype){case OpenRecordUtil.FileType.Word:case OpenRecordUtil.FileType.Excel:case OpenRecordUtil.FileType.PowerPoint:case OpenRecordUtil.FileType.OneNote:return NativeAppUrlOpener}break;case DocumentManagement.PlatformType.Ios:switch(filetype){case OpenRecordUtil.FileType.Word:case OpenRecordUtil.FileType.Excel:case OpenRecordUtil.FileType.PowerPoint:return PassbackUrlOpener;case OpenRecordUtil.FileType.OneNote:return IosUrlOpener}break}return BrowserUrlOpener};return UrlOpenerFactory}();OpenRecordUtil.UrlOpenerFactory=UrlOpenerFactory})(OpenRecordUtil=DocumentManagement.OpenRecordUtil||(DocumentManagement.OpenRecordUtil={}))})(DocumentManagement||(DocumentManagement={}))