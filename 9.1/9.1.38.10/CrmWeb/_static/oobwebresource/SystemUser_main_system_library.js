Type.registerNamespace("Mscrm");Mscrm.ApplicationUserConstants=function(){};function assignControl(formContext,controlName,value){var $v_0=formContext.getControl(controlName);$v_0&&formContext.getAttribute(controlName).setValue(value)}function hideParentControl(formContext,controlName){var $v_0=formContext.getControl(controlName);if($v_0){var $v_1=$v_0.getParent();if($v_1){$v_1.setVisible(false);return true}}return false}function InitializeAccountInfo(globalContext,formContext){if(!globalContext.isOnPremises()){hideParentControl(formContext,"windowsliveid");formContext.getControl("caltype")&&formContext.getControl("caltype").setVisible(false)}else hideParentControl(formContext,"windowsliveid")}function InitializeEmailDelivery(formContext){var $v_0=0,$v_1=0;$v_0&&assignControl(formContext,"incomingemaildeliverymethod",$v_0);$v_1&&assignControl(formContext,"outgoingemaildeliverymethod",$v_1)}function domainNameOnChange(){var $v_0=Xrm.Page.getAttribute("domainname");if($v_0){var $v_1=$v_0.getValue();if($v_1){var $v_2=!Xrm.Page.context.isOnPremises(),$v_3=Xrm.Page.ui.formSelector.getCurrentItem(),$v_4=!$v_3?"":$v_3.getId();if(!$v_2&&$v_4.toLowerCase()!=="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8"){var $v_5=Xrm.Internal.retrieveADUserProperties($v_1);if($v_5){var $$dict_8=$v_5;for(var $$key_9 in $$dict_8){var $v_6={key:$$key_9,value:$$dict_8[$$key_9]},$v_7=Xrm.Page.getAttribute($v_6.key);$v_7&&$v_7.setValue($v_6.value)}}}}}}function applicationIdOnChange(){var $v_0=Xrm.Page.getAttribute("applicationid");if($v_0){var $v_1=$v_0.getValue();if($v_1){var $v_2=$v_0.controls.getByIndex(0),$v_3=new RegExp("^(\\{){0,1}[0-9a-fA-F]{8}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{4}\\-[0-9a-fA-F]{12}(\\}){0,1}$"),$v_4=$v_3.test($v_1);if(!$v_4){$v_2.setNotification(Xrm.Internal.getResourceString("LOCID_INVALID_APPLICATIONID"));$v_2.setFocus()}else $v_2.clearNotification()}}}function primaryemailOnChange(){var $v_0=Xrm.Page.ui.formSelector.getCurrentItem(),$v_1=Mscrm.InternalUtilities.JSTypes.isNull($v_0)?"":$v_0.getId();if($v_1.toLowerCase()==="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8"){var $v_2=Xrm.Page.getAttribute("internalemailaddress");if(!Mscrm.InternalUtilities.JSTypes.isNull($v_2)){var $v_3=$v_2.getValue(),$v_4=Xrm.Page.getAttribute("domainname");!Mscrm.InternalUtilities.JSTypes.isNull($v_4)&&!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($v_3)&&$v_4.setValue($v_3)}}}function $2($p0){var $v_0=$p0.getControlType();$v_0!=="iframe"&&$v_0!=="webresource"&&$v_0!=="subgrid"&&$p0.setDisabled(true)}function $1($p0,$p1,$p2){if($p0.getAttribute($p1)){var $v_0=$p2.length>0?$p0.getAttribute($p1).controls.getByName($p2):$p0.getAttribute($p1).controls.getByIndex(0);$v_0&&$2($v_0)}}function $3($p0){$p0.ui.controls.forEach(function($p1_0,$p1_1){$2($p1_0)})}function $0($p0,$p1){$p0.removeOption($p1)}function $4($p0,$p1){var $v_0=Xrm.Page.ui.tabs.get($p0);$v_0&&$v_0.setVisible($p1)}function onPageInitialized(globalContext,formContext){var $v_0=!globalContext.isOnPremises(),$v_1=null;if(!Xrm.Internal.isUci())$v_1=Xrm.Internal.getDisabledAttributes("systemuser");var $v_2=formContext.ui.formSelector.getCurrentItem(),$v_3=!$v_2?"":$v_2.getId();if($v_3.toLowerCase()==="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8"){var $v_6=formContext.getAttribute("applicationid"),$v_7=formContext.getAttribute("azureactivedirectoryobjectid");$v_6.setRequiredLevel("required");$v_7.setRequiredLevel("required");var $v_8=$v_6.getValue();if((!$v_8||$v_8==="")&&formContext.ui.getFormType()===2){var $v_9=formContext.getControl("applicationid");$2($v_9);$v_6.setRequiredLevel("none")}}if($v_0&&$v_3.toLowerCase()!=="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8")if(!formContext.data.entity.getId().length)$3(formContext);else if($v_1)for(var $$arr_A=$v_1,$$len_B=$$arr_A.length,$$idx_C=0;$$idx_C<$$len_B;++$$idx_C){var $v_A=$$arr_A[$$idx_C];if($v_A!=="NONE_USER_IS_HARD_DELETED"){$1(formContext,$v_A,"");$1(formContext,"firstname","fullname");$1(formContext,"address1_country","address1_composite")}}else{$1(formContext,"domainname","");$1(formContext,"windowsliveid","")}var $v_4=formContext.ui.controls.get("accessmode");if($v_4)if($v_0&&$v_3.toLowerCase()!=="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8"){$0($v_4,2);var $v_B=formContext.getAttribute("accessmode");if($v_B){var $v_C=$v_B.getValue();$v_C!==3&&$0($v_4,3);$v_C!==5&&$0($v_4,5);($v_C===3||$v_C===5)&&$2($v_4)}else $2($v_4)}else{$0($v_4,3);$0($v_4,4);$0($v_4,5);if(!Xrm.Internal.isUci()){var $v_D=Xrm.Internal.isMaxNoOfReadOnlyUsersReached();$v_D&&$0($v_4,2)}}$v_0&&$v_3.toLowerCase()!=="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8"&&$1(formContext,"setupuser","");var $v_5=Xrm.Internal.isFeatureEnabled("FCB.Moca.Offline");$4("MobileOfflineProfile_TAB",$v_5)}Mscrm.ApplicationUserConstants.registerClass("Mscrm.ApplicationUserConstants");Mscrm.ApplicationUserConstants.applicationUserFormId="d26924ef-4d80-46f7-ab1d-e6ae80a54ce8";Type.registerNamespace("Mscrm");var _gArrDependentPicklists=null;Mscrm.domainname_onchange=domainNameOnChange;Mscrm.applicationid_onchange=applicationIdOnChange;Mscrm.internalemailaddress_onchange=primaryemailOnChange;Mscrm.accessmode_onchange=function(){paramParentFieldId="accessmode";paramChildFieldId="caltype";for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList];if(DependentPicklist.ParentFieldId===paramParentFieldId&&DependentPicklist.ChildFieldId===paramChildFieldId){var ParentFieldControl=Xrm.Page.ui.controls.get(paramParentFieldId),ParentField=Xrm.Page.data.entity.attributes.get(paramParentFieldId),ChildFieldControl=Xrm.Page.ui.controls.get(DependentPicklist.ChildFieldId),ChildField=Xrm.Page.data.entity.attributes.get(DependentPicklist.ChildFieldId),CurrentChildFieldValue=ChildField.getValue();if(ParentField.getValue()==null){ChildField.setValue(null);ChildField.setSubmitMode("always");ChildField.fireOnChange();ChildFieldControl.setDisabled(true);return}for(var og in DependentPicklist.OptionsGroup){var OptionsGroup=DependentPicklist.OptionsGroup[og];if(ParentField.getValue()==OptionsGroup.ParentValue){ChildFieldControl.setDisabled(false);var bCurrentValueIsValid=false;ChildFieldControl.clearOptions();for(var i=0;i<OptionsGroup.Options.length;i++){ChildFieldControl.addOption(OptionsGroup.Options[i]);if(CurrentChildFieldValue==OptionsGroup.Options[i].value)bCurrentValueIsValid=true}ChildFieldControl.removeOption(0);if(bCurrentValueIsValid)ChildField.setValue(CurrentChildFieldValue);else{ChildField.setValue(OptionsGroup.Options[0].value);ChildField.setSubmitMode("always")}OptionsGroup.Options.length==1&&ChildFieldControl.setDisabled(true);break}}}}};Mscrm.Form_onload=function(){var formContext=Xrm.Page,globalContext=Xrm.Page.context,CRM_FORM_TYPE_CREATE=1,CRM_FORM_TYPE_UPDATE=2;InitializeAccountInfo(globalContext,formContext);onPageInitialized(globalContext,formContext);selectedForm=formContext.ui.formSelector.getCurrentItem(),selectedFormId=selectedForm==null?"":selectedForm.getId();if(selectedFormId.toLowerCase()===Mscrm.ApplicationUserConstants.applicationUserFormId)return;switch(formContext.ui.getFormType()){case CRM_FORM_TYPE_CREATE:case CRM_FORM_TYPE_UPDATE:_gArrDependentPicklists=[{ParentFieldId:"accessmode",ChildFieldId:"caltype",ChildFieldLabel:"License Type",OptionsGroup:[{ParentValue:"0",ChildOptionValues:["5","6","2","4","0","3","7","8","9","10","11","12"]},{ParentValue:"1",ChildOptionValues:["1"]},{ParentValue:"2",ChildOptionValues:["2","4"]}]}];for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList],options=formContext.data.entity.attributes.get(DependentPicklist.ChildFieldId).getOptions();for(var og in DependentPicklist.OptionsGroup){var OptionsGroup=DependentPicklist.OptionsGroup[og],aOptionGroup=[];for(var value in OptionsGroup.ChildOptionValues)for(var opt in options)OptionsGroup.ChildOptionValues[value]==options[opt].value&&aOptionGroup.push(options[opt]);OptionsGroup.Options=aOptionGroup}}for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList];formContext.data.entity.attributes.get(DependentPicklist.ParentFieldId).fireOnChange()}break}if(globalContext.client.getClient()==="Mobile")return;InitializeEmailDelivery(formContext)}