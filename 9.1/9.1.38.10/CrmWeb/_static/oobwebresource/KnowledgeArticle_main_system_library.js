var AppCommon;(function(AppCommon){var ODataUpdateRequest=function(){function ODataUpdateRequest(etn,id,payload){this.etn=etn;this.id=id;this.payload=payload}ODataUpdateRequest.prototype.getMetadata=function(){return {boundParameter:undefined,parameterTypes:{},operationName:"Update",operationType:2}};return ODataUpdateRequest}();AppCommon.ODataUpdateRequest=ODataUpdateRequest})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var RetrieveUserPrivilegeByPrivilegeNameODataContract=function(){function RetrieveUserPrivilegeByPrivilegeNameODataContract(entity,privilegeName){this.entity=entity;this.PrivilegeName=privilegeName}RetrieveUserPrivilegeByPrivilegeNameODataContract.prototype.getMetadata=function(){var metadata={boundParameter:"entity",parameterTypes:{entity:{typeName:"mscrm.systemuser",structuralProperty:5},PrivilegeName:{typeName:"Edm.String",structuralProperty:1}},operationName:"RetrieveUserPrivilegeByPrivilegeName",operationType:1};return metadata};return RetrieveUserPrivilegeByPrivilegeNameODataContract}();AppCommon.RetrieveUserPrivilegeByPrivilegeNameODataContract=RetrieveUserPrivilegeByPrivilegeNameODataContract})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var AssociateKnowledgeArticleODataContract=function(){function AssociateKnowledgeArticleODataContract(regardingObjectId,regardingObjectTypeCode,associationRelationshipName,knowledgeArticleId,entityName){this.RegardingObjectId=regardingObjectId;this.RegardingObjectTypeCode=regardingObjectTypeCode;this.AssociationRelationshipName=associationRelationshipName;this.KnowledgeArticleId=knowledgeArticleId;this.EntityName=entityName}AssociateKnowledgeArticleODataContract.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{RegardingObjectId:{typeName:"Edm.Guid",structuralProperty:1},RegardingObjectTypeCode:{typeName:"Edm.Int32",structuralProperty:1},AssociationRelationshipName:{typeName:"Edm.String",structuralProperty:1},KnowledgeArticleId:{typeName:"Edm.Guid",structuralProperty:1},EntityName:{typeName:"Edm.String",structuralProperty:1}},operationName:"AssociateKnowledgeArticle",operationType:0};return metadata};return AssociateKnowledgeArticleODataContract}();AppCommon.AssociateKnowledgeArticleODataContract=AssociateKnowledgeArticleODataContract})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var CreateKnowledgeArticleTranslationODataContract=function(){function CreateKnowledgeArticleTranslationODataContract(source,language,isMajor){this.Source=source;this.Language=language;this.IsMajor=isMajor}CreateKnowledgeArticleTranslationODataContract.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Source:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},Language:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},IsMajor:{typeName:"Edm.Boolean",structuralProperty:1}},operationName:"CreateKnowledgeArticleTranslation",operationType:0};return metadata};return CreateKnowledgeArticleTranslationODataContract}();AppCommon.CreateKnowledgeArticleTranslationODataContract=CreateKnowledgeArticleTranslationODataContract})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var CreateKnowledgeArticleVersionODataContract=function(){function CreateKnowledgeArticleVersionODataContract(source,isMajor){this.Source=source;this.IsMajor=isMajor}CreateKnowledgeArticleVersionODataContract.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Source:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},IsMajor:{typeName:"Edm.Boolean",structuralProperty:1}},operationName:"CreateKnowledgeArticleVersion",operationType:0};return metadata};return CreateKnowledgeArticleVersionODataContract}();AppCommon.CreateKnowledgeArticleVersionODataContract=CreateKnowledgeArticleVersionODataContract})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var PublishKnowledgeArticleODataContract=function(){function PublishKnowledgeArticleODataContract(entity,copyRelatedProductFromAssociatedPrimary,copyRelatedCategoryFromAssociatedPrimary,publishApprovedRelatedTranslations){this.Entity=entity;this.CopyRelatedProductFromAssociatedPrimary=copyRelatedProductFromAssociatedPrimary;this.CopyRelatedCategoryFromAssociatedPrimary=copyRelatedCategoryFromAssociatedPrimary;this.PublishApprovedRelatedTranslations=publishApprovedRelatedTranslations}PublishKnowledgeArticleODataContract.prototype.getMetadata=function(){var metadata={boundParameter:null,parameterTypes:{Entity:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},CopyRelatedProductFromAssociatedPrimary:{typeName:"Edm.Boolean",structuralProperty:1},CopyRelatedCategoryFromAssociatedPrimary:{typeName:"Edm.Boolean",structuralProperty:1},PublishApprovedRelatedTranslations:{typeName:"Edm.Boolean",structuralProperty:1}},operationName:"PublishKnowledgeArticle",operationType:0};return metadata};return PublishKnowledgeArticleODataContract}();AppCommon.PublishKnowledgeArticleODataContract=PublishKnowledgeArticleODataContract})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){AppCommon.WebResourceName="KnowledgeArticle_main_system_library";AppCommon.Warning="warning";AppCommon.IsPrimary="isprimary";AppCommon.Expiredreviewoptions="expiredreviewoptions";AppCommon.DefaultStatusCode=-1;AppCommon.DefaultStateCode=-1;AppCommon.KAReadOnlyNotificationId="ArticleReadOnlyNotification";AppCommon.BPFParentArticleContentId="header_process_parentarticlecontentid";AppCommon.BPFReviewId="header_process_review";AppCommon.BPFLanguageLocaleId="header_process_languagelocaleid";AppCommon.PrimaryAuthorId="primaryauthorid";AppCommon.OwnerId="ownerid";AppCommon.Review="review";AppCommon.ExpirationDate="expirationdate";AppCommon.PublishOn="publishon";AppCommon.LanguageLocaleId="languagelocaleid";AppCommon.KnowledgeArticleId="knowledgearticleid";AppCommon.Name="name";AppCommon.StateCode="statecode";AppCommon.StatusCode="statuscode";AppCommon.UpdateContentStageId="1926340e-b1a8-7702-b123-49e4884ed323";AppCommon.CreateKnowledgeArticleVersion="CreateKnowledgeArticleVersion";AppCommon.ProgressMaxValue=100;AppCommon.ProgressMinValue=0;AppCommon.ProgressValue=40;AppCommon.KnowledgeArticleOTC="9953";AppCommon.KnowldgeArticleTitle="title";AppCommon.HeaderLanguageLocaleId="header_languagelocaleid";AppCommon.CreateKnowledgeArticleTranslation="CreateKnowledgeArticleTranslation";AppCommon.Source="Source";AppCommon.Language="Language";AppCommon.mscrm_crmbaseentity="mscrm.crmbaseentity";AppCommon.IsMajor="IsMajor";AppCommon.Edm_Boolean="Edm.Boolean";AppCommon.MajorVersionNumber="majorversionnumber";AppCommon.MinorVersionNumber="minorversionnumber";AppCommon.KnowledgearticleId="knowledgearticleid";AppCommon.RootarticleId="rootarticleid";AppCommon.Logicalname="logicalname";AppCommon.RegardingObjectTypeCode=9959;AppCommon.OdataType="@odata.type";AppCommon.KnowledgeArticleOdataType="Microsoft.Dynamics.CRM.knowledgearticle";AppCommon.LanguageLocaleOdataType="Microsoft.Dynamics.CRM.languagelocale";AppCommon.ODataEntityId="odata-entityid";AppCommon.DefaultMajorVersion=1;AppCommon.DefaultMinorVersion=0;AppCommon.KnowledgeArticleEntity="knowledgearticle";AppCommon.LanguageLocaleEntity="languagelocale";AppCommon.NotesEntity="annotation";AppCommon.SystemUserEntity="systemuser";AppCommon.CategoryEntity="category";AppCommon.ConnectionRoleEntity="connectionrole";AppCommon.ConnectionEntity="connection";AppCommon.PrivilegeEntity="privilege";AppCommon.LogicalName="logicalname";AppCommon.Id="id";AppCommon.ObjectTypeCode="objecttypecode";AppCommon.KAAnnotationsBind="objectid_knowledgearticle@odata.bind";AppCommon.OwnerIdBind="ownerid@odata.bind";AppCommon.IsDocument="isdocument";AppCommon.Subject="subject";AppCommon.NoteText="notetext";AppCommon.OwnerIdType="owneridtype";AppCommon.EntityId="knowledgeArticleId";AppCommon.LastButtonClicked="lastButtonClicked";AppCommon.DialogOkId="ok_id";AppCommon.ArticlePublicNumber="articlepublicnumber";AppCommon.DialogCancelId="cancel_id";AppCommon.MarkInternalDialog="MarkInternal";AppCommon.MarkExternalDialog="MarkExternal";AppCommon.SelectVersions="selectversions_id";AppCommon.ParentarticleContentIdDataBindValue="ParentArticleContentId@odata.bind";AppCommon.AssociationType="associationType";AppCommon.AssociateEntityId="associateEntity_id";AppCommon.ArticleToArticleAssociationDialog="ArticleToArticleAssociation";AppCommon.ArticleToCategoryAssociationDialog="ArticleToCategoryAssociation";AppCommon.RelatedEntityRoleId="CFFE4A59-CE11-4FCA-B132-5985D3917D26";AppCommon.PrimaryEntityRoleId="5A18DFC8-0B8B-40C7-9381-CCE1C485822D";AppCommon.RelatedEntityLookup="relatedentitylookup";AppCommon.KnowledgearticleCategory="knowledgearticle_category";AppCommon.Knowledgearticles="knowledgearticles";AppCommon.Connections="connections";AppCommon.SystemUserEntitySet="systemusers";AppCommon.NotesEntitySet="annotations";AppCommon.Record1IdValue="_record1id_value";AppCommon.Record2IdValue="_record2id_value";AppCommon.Record1RoleIdValue="_record1roleid_value";AppCommon.Record2RoleIdValue="_record2roleid_value";AppCommon.Record1ObjectTypeCode="record1objecttypecode";AppCommon.Record2ObjectTypeCode="record2objecttypecode";AppCommon.RootarticleIdvalue="_rootarticleid_value";AppCommon.Record1IdDataBindValue="record1id_knowledgearticle@odata.bind";AppCommon.Record2IdDataBindValue="record2id_knowledgearticle@odata.bind";AppCommon.Record1RoleIdDataBindValue="record1roleid@odata.bind";AppCommon.Record2RoleIdDataBindValue="record2roleid@odata.bind";AppCommon.RecordObjectTypeCodeValue=9953;AppCommon.AssociateKnowledgeArticle="AssociateKnowledgeArticle";AppCommon.RegardingObjectId="RegardingObjectId";AppCommon.RegardingObjectTypeCodeValue="RegardingObjectTypeCode";AppCommon.AssociationRelationshipName="AssociationRelationshipName";AppCommon.AssociateKnowledgeArticleId="KnowledgeArticleId";AppCommon.TranslateArticleDialog="TranslateKnowledgeArticle";AppCommon.ParentArticleContentId="parentarticlecontentid";AppCommon.TranslateLanguageId="translateLanguageLocale_id";AppCommon.VersionTypeId="versionType_id";AppCommon.LatestVersionId="lbl_latestVersion";AppCommon.MajorVersionId="lbl_majorVersion";AppCommon.MinorVersionId="lbl_minorVersion";AppCommon.ParamEntityId="param_knowledgeArticleId";AppCommon.ParamLastButtonClicked="param_lastButtonClicked";AppCommon.ParamAssociationType="param_associationType";AppCommon.ParamArticlePublicNumber="param_articlePublicNumber";AppCommon.ParamIsPrimary="param_isprimary";AppCommon.ParamParentArticleContentId="param_parentarticlecontentid";AppCommon.ParamLanguageLocaleId="param_languagelocaleid";AppCommon.ParamMajorVersionNumber="param_majorversionnumber";AppCommon.ParamMinorVersionNumber="param_minorversionnumber";AppCommon.ParamIsBulkPublishAction="param_isbulkpublishaction";AppCommon.ParamSelectedRecords="param_selectedrecords";AppCommon.ParamPrimaryAuthorId="param_primaryauthorid";AppCommon.ParamReview="param_Review";AppCommon.ParamStateCode="param_statecode";AppCommon.ParamStatusCode="param_statuscode";AppCommon.ParamDateTimeFixOffset="param_datetimefixoffset";AppCommon.PublishKnowledgeArticlePrivilegeId="7c538e3d-8e82-4f73-922e-471472954c52";AppCommon.ApproveKnowledgeArticlePrivilegeId="bdf910f7-0c80-4e7b-8ac2-12e75790319f";AppCommon.PublishKnowledgeArticlePrivilegeName="prvPublishKnowledgeArticle";AppCommon.ApproveKnowledgeArticlePrivilegeName="prvApproveKnowledgeArticle";AppCommon.Draft="Draft";AppCommon.Approved="Approved";AppCommon.Scheduled="Scheduled";AppCommon.Published="Published";AppCommon.Expired="Expired";AppCommon.Archived="Archived";AppCommon.Discarded="Discarded";AppCommon.ExpiredBpfStageIdentifier_Review="e33cdd31-c568-4a14-8dcb-60d790cc85cb";AppCommon.ExpiredBpfStageIdentifier_UpdateContent="5c2b5c67-6ab5-4653-890b-b700bb5d5813";AppCommon.ExpiredBpfStageIdentifier_Publish="397596bd-de78-5384-9b5e-4e791a4eed61";AppCommon.ExpiredProcessId="bcd43793-5686-4fd4-b3b4-c0c26d6f7e40";AppCommon.NewProcessId="ab81c1af-1a45-48d9-8133-3edc033dbeef";AppCommon.TranslationProcess="bd57803e-0408-44d6-b21d-ae7158ec6555";AppCommon.PublishStatusControlId="publish_id";AppCommon.PublishDateTimeControlId="publishingdatetime_id";AppCommon.ScheduledStatusControlId="scheduledstatus_id";AppCommon.PublishedStatusControlId="publishedstatus_id";AppCommon.ExpirationDateControlId="expirationdate_id";AppCommon.UnpublishOnExpirationControlId="unpublishonexpiration_id";AppCommon.ExpirationStateControlId="expirationstate_id";AppCommon.ExpirationStatusControlId="expirationstatus_id";AppCommon.DefaultExpirationStatusControlId="defaultexpirationstatus_id";AppCommon.CopyRelatedControlId="copyrelated_id";AppCommon.CopyRelatedCategoryControlId="copyrelatedcategories_id";AppCommon.ApproveRelatedControlId="approverelated_id";AppCommon.PublishArticleDialog="PublishKnowledgeArticle";AppCommon.ExpirationDateFormId="expirationdate";AppCommon.PubishonDateFormId="publishon";AppCommon.ExpirationStateFormId="expirationstateid";AppCommon.ExpirationStatusFormId="expirationstatusid";AppCommon.PublishStatusFormId="publishstatusid";AppCommon.RejectKnowledgeArticleDialog="RejectKnowledgeArticle";AppCommon.ExpiredReviewOptions="expiredreviewoptions";AppCommon.ReasonForRejection="reasonforrejection";AppCommon.KnowledgeArticleTypeCode=9953;AppCommon.RelatedTranslationsGrid="RelatedTranslationsGrid";AppCommon.FeedbackEntity="feedback";AppCommon.Feedback="Feedback";AppCommon.RelatedCategoriesGrid="RelatedCategoriesGrid";AppCommon.RelatedArticlesGrid="RelatedArticlesGrid";AppCommon.RelatedArticlesViewId="{DDB43BE7-F7DA-4D90-845F-06552A446DA0}";AppCommon.RelatedTranslationsViewId="{AE82A232-1529-4BDE-9972-93CE21A095C6}";AppCommon.RelatedArticlesQuickFormName="relatedarticlequickform";AppCommon.IsLatestVersion="islatestversion";AppCommon.SelectMajorMinorVersions="?$select=majorversionnumber,minorversionnumber";AppCommon.FetchXML_ClosestNonArchivedArticle=function(rootArticleId){return "?fetchXml=<fetch mapping='logical' count='1'>\n\t\t\t<entity name='knowledgearticle'>\n\t\t\t\t<attribute name=\"knowledgearticleid\"/>\n\t\t\t\t<attribute name=\"title\"/>\n\t\t\t\t<attribute name=\"statecode\"/>\n\t\t\t\t<attribute name=\"islatestversion\"/>\n\t\t\t\t<attribute name=\"previousarticlecontentid\"/>\n\t\t\t\t<attribute name=\"rootarticleid\"/>\n\t\t\t\t<order attribute='majorversionnumber' descending='true' />\n\t\t\t\t<order attribute='minorversionnumber' descending='true' />\n\t\t\t\t<filter type='and'>\n\t\t\t\t\t<condition attribute='rootarticleid' operator='eq' value='"+rootArticleId+"' />\n\t\t\t\t\t<condition attribute='statecode' operator='ne' value='5' />\n\t\t\t\t</filter>\n\t\t\t</entity>\n\t\t</fetch>"};AppCommon.FetchXML_GetRootArticleIdForArticleId=function(articleId){return '?fetchXml=<fetch mapping=\'logical\' >\n\t\t\t<entity name="knowledgearticle" >\n\t\t\t<attribute name="islatestversion" />\n\t\t\t<attribute name="rootarticleid" />\n\t\t\t<filter>\n\t\t\t  <condition attribute="knowledgearticleid" operator="eq" value="'+articleId+'" />\n\t\t\t</filter>\n\t\t  </entity>\n\t\t</fetch>'};AppCommon.FetchXML_NonArchivedLatestVersionArticle=function(rootArticleId,articlePublicNumber,languageLocaleId){return "?fetchXml=<fetch mapping='logical' count='1'>\n\t\t\t<entity name='knowledgearticle'>\n\t\t\t\t<attribute name=\"knowledgearticleid\"/>\n\t\t\t\t<order attribute='majorversionnumber' descending='true' />\n\t\t\t\t<order attribute='minorversionnumber' descending='true' />\n\t\t\t\t<filter type='and'>\n\t\t\t\t\t<condition attribute='rootarticleid' operator='eq' value='"+rootArticleId+"' />\n\t\t\t\t\t<condition attribute='statecode' operator='ne' value='5' />\n\t\t\t\t\t<condition attribute='islatestversion' operator='eq' value='1' />\n\t\t\t\t\t<condition attribute='articlepublicnumber' operator='eq' value='"+articlePublicNumber+"' />\n\t\t\t\t\t<condition attribute='languagelocaleid' operator='eq' value='"+languageLocaleId+"' />\n\t\t\t\t</filter>\n\t\t\t</entity>\n\t\t</fetch>"}})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticleGridCommandActions=function(){function KnowledgeArticleGridCommandActions(){var _this=this;this.markInternal=function(gridControl,records){_this.bulkInternalExternalLogic(records,gridControl,true)};this.markExternal=function(gridControl,records){_this.bulkInternalExternalLogic(records,gridControl,false)};this.approve=function(gridControl,records){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkApprove_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkApprove_Confirmation_DialogText);_this.setStateConfirmationDialog(confirmDialogStrings,_this.defaultDialogOptions(),records,AppCommon.KnowledgeArticleFormState.Approved,AppCommon.DefaultStatusCode,gridControl,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,_this.defaultOnDialogCancelCallback,AppCommon.KnowledgeArticleGridRibbonCommands.Approve)};this.archive=function(gridControl,records){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkArchive_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkArchive_Confirmation_DialogText);_this.setStateConfirmationDialog(confirmDialogStrings,_this.defaultDialogOptions(),records,AppCommon.KnowledgeArticleFormState.Archived,AppCommon.DefaultStatusCode,gridControl,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,_this.defaultOnDialogCancelCallback,AppCommon.KnowledgeArticleGridRibbonCommands.Archive)};this.discard=function(gridControl,records){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkDiscard_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkDiscard_Confirmation_DialogText);_this.setStateConfirmationDialog(confirmDialogStrings,_this.defaultDialogOptions(),records,AppCommon.KnowledgeArticleFormState.Discarded,AppCommon.DefaultStatusCode,gridControl,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,_this.defaultOnDialogCancelCallback,AppCommon.KnowledgeArticleGridRibbonCommands.Discard)};this.revertToDraft=function(gridControl,records){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogText);_this.setStateConfirmationDialog(confirmDialogStrings,_this.defaultDialogOptions(),records,AppCommon.KnowledgeArticleFormState.Draft,AppCommon.DefaultStatusCode,gridControl,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,_this.defaultOnDialogCancelCallback,AppCommon.KnowledgeArticleGridRibbonCommands.RevertToDraft)};this.major=function(gridControl,records){_this.createKnowledgeArticleVersion(gridControl,records,true)};this.minor=function(gridControl,records){_this.createKnowledgeArticleVersion(gridControl,records,false)};this.CanApproveKnowledgeArticleGrid=function(gridControl,records){return _this.CanViewRibbonAction(gridControl,records,[AppCommon.Approved,AppCommon.Scheduled,AppCommon.Published,AppCommon.Expired,AppCommon.Archived,AppCommon.Discarded])};this.CanPublishKnowledgeArticleGrid=function(gridControl,records){return _this.CanViewRibbonAction(gridControl,records,[AppCommon.Published,AppCommon.Archived,AppCommon.Discarded])};this.CanRevertToDraftKnowledgeArticleGrid=function(gridControl,records){return _this.CanViewRibbonAction(gridControl,records,[AppCommon.Draft,AppCommon.Archived,AppCommon.Discarded])};this.CanArchiveKnowledgeArticleGrid=function(gridControl,records){return _this.CanViewRibbonAction(gridControl,records,[AppCommon.Archived,AppCommon.Discarded])};this.CanDiscardKnowledgeArticleGrid=function(gridControl,records){return _this.CanViewRibbonAction(gridControl,records,[AppCommon.Discarded])};this.checkForApproveMiscellaneousPrivilege=function(){var result=false,userPrivileges=Xrm.Utility.getGlobalContext().userSettings.securityRolePrivileges;if(userPrivileges&&userPrivileges.indexOf(AppCommon.ApproveKnowledgeArticlePrivilegeId)>-1)result=true;return result};this.checkForPublishMiscellaneousPrivilege=function(){var result=false,userPrivileges=Xrm.Utility.getGlobalContext().userSettings.securityRolePrivileges;if(userPrivileges&&userPrivileges.indexOf(AppCommon.PublishKnowledgeArticlePrivilegeId)>-1)result=true;return result};this.publish=function(gridControl,records){AppCommon.KnowledgeArticle.PublishCommands.openPublishArticleDialog(null,records,true,gridControl)};this.isRelatedTranslationsSubGrid=function(gridControl){if(gridControl!=null&&gridControl!=undefined){var viewId=gridControl.getViewSelector().getCurrentView().id;return viewId==AppCommon.RelatedTranslationsViewId}return false};this.CanViewRibbonAction=function(gridControl,selectedEntityReferences,blockedStates){return true};this.postSetStateForArchivedArticles=function(articleNotArchiveCount,res,state,gridControl,doneCallback){if(state==AppCommon.KnowledgeArticleFormState.Archived)_this.updateIsLatestVersionForParentArticleOfArchivedArticle(res.id).then(function(res){articleNotArchiveCount.records--;articleNotArchiveCount.records==0&&gridControl.refresh()});else doneCallback(res)};this.setStateConfirmationDialog=function(confirmDialogStrings,dialogOptions,records,state,status,gridControl,doneCallback,failCallback,onDialogCancelCallback,ribbonCommandId){var data={statecode:state,statuscode:status},onDialogConfirmCallback=function(){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var bulkActions=[],articleNotArchiveCount={records:records.length};if(records.length<=25){for(var _i=0,records_1=records;_i<records_1.length;_i++){var record=records_1[_i],currentAction=Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,record.Id,data);bulkActions.push(currentAction);currentAction.then(function(res){_this.postSetStateForArchivedArticles(articleNotArchiveCount,res,state,gridControl,doneCallback)},function(response){Xrm.Utility.closeProgressIndicator();failCallback(response)})}Xrm.Utility.closeProgressIndicator()}else{for(var requestsToExecute=[],respRecords_1=[],_a=0,records_2=records;_a<records_2.length;_a++){var record=records_2[_a];requestsToExecute.push(new AppCommon.ODataUpdateRequest(record.TypeName,record.Id,data));respRecords_1.push({entityType:record.TypeName,id:record.Id})}var bulkAction=Xrm.WebApi.online.executeMultiple(requestsToExecute).then(function(success){if(success.every(function(response){return response.ok})){for(var _i=0,respRecords_2=respRecords_1;_i<respRecords_2.length;_i++){var record=respRecords_2[_i];_this.postSetStateForArchivedArticles(articleNotArchiveCount,record,state,gridControl,doneCallback)}Xrm.Utility.closeProgressIndicator();return respRecords_1}Xrm.Utility.closeProgressIndicator()},function(error){Xrm.Utility.closeProgressIndicator();failCallback(error)});bulkActions.push(bulkAction)}_this.whenAllActionsAreCompleted(bulkActions,gridControl,ribbonCommandId,state)};Xrm.Navigation.openConfirmDialog(confirmDialogStrings,dialogOptions).then(function(successParameter){if(successParameter.confirmed)onDialogConfirmCallback();else onDialogCancelCallback(successParameter)})};this.defaultDialogOptions=function(){var dialogOptions={height:300,width:450,position:1};return dialogOptions};this.defaultDoneCallback=function(response){};this.defaultOnDialogCancelCallback=function(){};this.createKnowledgeArticleVersion=function(gridControl,records,isMajor){var confirmDialogStrings={text:""};if(isMajor){confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMajor_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMajor_Confirmation_DialogText)}else{confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMinor_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMinor_Confirmation_DialogText)}var onDialogConfirmCallback=function(){var recordsToCreateVersion=[];Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));for(var _i=0,records_3=records;_i<records_3.length;_i++){var record=records_3[_i];recordsToCreateVersion.push(record)}_this.chainVersionAction(recordsToCreateVersion,0,isMajor,gridControl)},onDialogCancelCallback=function(){};Xrm.Navigation.openConfirmDialog(confirmDialogStrings,_this.defaultDialogOptions()).then(function(successParameter){if(successParameter.confirmed)onDialogConfirmCallback();else onDialogCancelCallback()})};this.chainVersionAction=function(recordsToCreateVersion,currentIndex,isMajor,gridControl){if(recordsToCreateVersion.length>currentIndex){var articleReference={id:recordsToCreateVersion[currentIndex].Id,logicalName:AppCommon.KnowledgeArticleEntity},Source,IsMajor,request=new AppCommon.CreateKnowledgeArticleVersionODataContract(Source,IsMajor),entityReference={};entityReference[AppCommon.KnowledgeArticleId]=articleReference.id;entityReference[AppCommon.OdataType]=AppCommon.KnowledgeArticleOdataType;request.Source=entityReference;request.IsMajor=isMajor;Xrm.WebApi.online.execute(request).then(function(createVersionResponse){Xrm.Utility.closeProgressIndicator();createVersionResponse&&createVersionResponse.ok&&createVersionResponse.headers&&createVersionResponse.headers.has(AppCommon.ODataEntityId)&&_this.chainVersionAction(recordsToCreateVersion,currentIndex+1,isMajor,gridControl)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else{Xrm.Utility.closeProgressIndicator();if(gridControl!=null&&gridControl!=undefined){for(var result="",_i=0,recordsToCreateVersion_1=recordsToCreateVersion;_i<recordsToCreateVersion_1.length;_i++){var record=recordsToCreateVersion_1[_i];result+=record.Id+", "}var articleIds=result.substring(0,result.length-2),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(isMajor==true)AppCommon.KnowledgeArticleUtility.reportEvent(articleIds,AppCommon.DefaultStateCode,AppCommon.DefaultStatusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Major);else isMajor==false&&AppCommon.KnowledgeArticleUtility.reportEvent(articleIds,AppCommon.DefaultStateCode,AppCommon.DefaultStatusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Minor);gridControl.refresh()}}};this.bulkInternalExternalLogic=function(records,gridControl,isInternal){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,isInternal?AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMarkInternal_Confirmation_DialogTitle:AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMarkExternal_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,isInternal?AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMarkInternal_Confirmation_DialogText:AppCommon.KnowledgeArticleUtility.KnowledgeArticle_BulkMarkExternal_Confirmation_DialogText);var ribbonCommandId=isInternal?AppCommon.KnowledgeArticleGridRibbonCommands.MarkInternal:AppCommon.KnowledgeArticleGridRibbonCommands.MarkExternal,onDialogConfirmCallback=function(){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));for(var bulkInternalExternalActions=[],_i=0,records_4=records;_i<records_4.length;_i++){var record=records_4[_i],newrecord=AppCommon.KnowledgeArticle.CommandActions.getKnowledgeArticleRecord(record.Id,isInternal),currentAction=Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,record.Id,newrecord);bulkInternalExternalActions.push(currentAction);currentAction.then(function(response){},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}Xrm.Utility.closeProgressIndicator();this.whenAllActionsAreCompleted(bulkInternalExternalActions,gridControl,ribbonCommandId,0)};Xrm.Navigation.openConfirmDialog(confirmDialogStrings,_this.defaultDialogOptions()).then(function(successParameter){if(successParameter.confirmed)onDialogConfirmCallback();else this.defaultOnDialogCancelCallback(successParameter)})};this.whenAllActionsAreCompleted=function(bulkActions,gridControl,ribbonCommandId,state){bulkActions!=null&&bulkActions.length>0&&Promise.all(bulkActions).then(function(successResponse){if(ribbonCommandId!=null&&ribbonCommandId!=undefined){for(var result="",_i=0,successResponse_1=successResponse;_i<successResponse_1.length;_i++){var record=successResponse_1[_i];result+=record.id+", "}var articleIds=result.substring(0,result.length-2),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleIds,AppCommon.DefaultStateCode,AppCommon.DefaultStatusCode,screenDimensions.width,screenDimensions.height,ribbonCommandId)}if(gridControl!=null&&gridControl!=undefined)state!=AppCommon.KnowledgeArticleFormState.Archived&&gridControl.refresh()},function(error){})};this.updateIsLatestVersionForParentArticleOfArchivedArticle=function(articleId){return new Promise(function(resolve,reject){try{var updateCurrentArticle_1=function(articleId){var currentVersionData={islatestversion:false};Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,currentVersionData).then(function(response){resolve(articleId)})};Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,AppCommon.FetchXML_GetRootArticleIdForArticleId(articleId)).then(function(articles){if(articles&&articles.entities&&articles.entities.length>0&&articles.entities[0][AppCommon.IsLatestVersion]){var rootArticleId=articles.entities[0][AppCommon.RootarticleIdvalue];Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,AppCommon.FetchXML_ClosestNonArchivedArticle(rootArticleId)).then(function(collection){var articles=collection.entities,currentArticle,previousVersionData={islatestversion:true};if(articles.length>0){currentArticle=articles[0];Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,currentArticle[AppCommon.KnowledgeArticleId],previousVersionData).then(function(response){updateCurrentArticle_1(articleId)})}else updateCurrentArticle_1(articleId)})}else resolve(articleId)})}catch(ex){reject(ex)}})}}return KnowledgeArticleGridCommandActions}();AppCommon.KnowledgeArticleGridCommandActions=KnowledgeArticleGridCommandActions})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticleMainSystemLibraryWebResource=function(){function KnowledgeArticleMainSystemLibraryWebResource(){var _this=this;this.form_onload=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),notificationText=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Notify_Readonly),isWebClient=formContext.context.client.getClient()==Xrm.Constants.ClientNames.web;notificationText!=null&&isWebClient&&!Xrm.Internal.isUci()&&formContext.ui.setFormNotification(notificationText,AppCommon.Warning,AppCommon.KAReadOnlyNotificationId);formContext.data.addOnLoad(_this.data_onload);var articleId=formContext.data.entity.getId();_this.setLanguageOnNewArticle(formContext,articleId);_this.approvalFieldDisableBasedOnRole(formContext);var primaryAuthorLookupAttribute=formContext.data.entity.attributes.get(AppCommon.PrimaryAuthorId),ownerIdAttribute=formContext.data.entity.attributes.get(AppCommon.OwnerId);if(articleId===""&&primaryAuthorLookupAttribute&&ownerIdAttribute){var ownerIdValue=ownerIdAttribute.getValue();ownerIdValue&&ownerIdValue.length>0&&primaryAuthorLookupAttribute.setValue(ownerIdValue)}if(articleId!=""){_this.disablePrimaryArticleVersionFieldInProcess(formContext);_this.disableTranslationLanguageLocaleFieldInProcess(formContext);var currentBpfProcess=formContext.data.process.getActiveProcess(),knowledgeArticleState=formContext.data.entity.attributes.get(AppCommon.StateCode),isPrimaryArticleAttribute=formContext.data.entity.attributes.get(AppCommon.IsPrimary);formContext.data.process.addOnPreStageChange(_this.process_onStageChange);if(currentBpfProcess!=null)if(isPrimaryArticleAttribute&&isPrimaryArticleAttribute.getValue())knowledgeArticleState.getValue()==AppCommon.KnowledgeArticleFormState.Expired&&currentBpfProcess.getId()==AppCommon.NewProcessId&&formContext.data.process.setActiveProcess(AppCommon.ExpiredProcessId)}else _this.enableLanguageLookupFields(formContext);var reviewState=formContext.data.entity.attributes.get(AppCommon.Review);_this.reviewOptionSetPreviousSelection=reviewState.getValue()};this.form_onsave=function(eventContext){var eventArgs=eventContext.getEventArgs(),formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);if(_this.isScheduledOrPublishedState(formContext))if(!AppCommon.KnowledgeArticle.CommandActions.isUpdateAction){var saveMode=eventArgs.getSaveMode();if(saveMode==1){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_SaveBlockMessage);Xrm.Navigation.openAlertDialog(alert,null)}eventArgs.preventDefault();return}if(!_this.hasValidExpirationDate(formContext)||!_this.hasValidPublishDate(formContext)){var alert_1={text:""};alert_1.text=!_this.hasValidExpirationDate(formContext)?Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ExpireOn_DialogText):Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_PublishingDateTimeMessage);Xrm.Navigation.openAlertDialog(alert_1,null);eventArgs.preventDefault();return}};this.review_onchange=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),reviewState=formContext.data.entity.attributes.get(AppCommon.Review);if(reviewState.getValue()==AppCommon.KnowledgeArticleReviewState.Rejected){var primaryAuthorLookupAttribute=formContext.getAttribute(AppCommon.PrimaryAuthorId),guidForPrimaryAuthorId="";if(primaryAuthorLookupAttribute){var primaryAuthorLookupAttributeValue=primaryAuthorLookupAttribute.getValue();if(primaryAuthorLookupAttributeValue&&primaryAuthorLookupAttributeValue.length>0)guidForPrimaryAuthorId=primaryAuthorLookupAttributeValue[0].id}var options={height:500,width:400,position:2},dialogParams={};dialogParams[AppCommon.ParamEntityId]=formContext.data.entity.getId();dialogParams[AppCommon.ParamLastButtonClicked]=AppCommon.DialogOkId;dialogParams[AppCommon.ParamPrimaryAuthorId]=guidForPrimaryAuthorId;dialogParams[AppCommon.ParamReview]=reviewState.getValue();Xrm.Navigation.openDialog(AppCommon.RejectKnowledgeArticleDialog,options,dialogParams).then(function(successParameter){var reviewState=formContext.getAttribute(AppCommon.Review);if(reviewState)if(successParameter.parameters[AppCommon.ParamLastButtonClicked]==AppCommon.DialogOkId)_this.reviewOptionSetPreviousSelection=reviewState.getValue();else reviewState.setValue(_this.reviewOptionSetPreviousSelection)},null)}else if(reviewState.getValue()==AppCommon.KnowledgeArticleReviewState.Approved){var onApproveDialogCancelCallback=function(){var reviewOptionSet=reviewState;reviewOptionSet.setValue(_this.reviewOptionSetPreviousSelection)},onApproveDialogOkCallback=function(response){var reviewOptionSet=reviewState;_this.reviewOptionSetPreviousSelection=reviewOptionSet.getValue()};AppCommon.KnowledgeArticle.CommandActions.approveArticle(formContext,onApproveDialogOkCallback,onApproveDialogCancelCallback)}else _this.reviewOptionSetPreviousSelection=reviewState.getValue()};this.expirationdate_onchange=function(formContext){if(!_this.hasValidExpirationDate){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ExpireOn_DialogText);var options={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alert,options);var expirationDateTimeControl=formContext.getControl(AppCommon.ExpirationDateFormId),getExpirationdatetime=expirationDateTimeControl.getAttribute();getExpirationdatetime.setValue(null)}};this.expiredreviewoptions_onchange=function(formContext){if(formContext.data&&formContext.data.entity){var expiredReviewState=formContext.data.entity.attributes.get(AppCommon.ExpiredReviewOptions);if(expiredReviewState.getValue()){if(expiredReviewState.getValue()==AppCommon.KnowledgeArticleExpiredReviewState.NeedsUpdating){_this.expiredReviewOptionSetPreviousSelection=expiredReviewState.getValue();formContext.ui.process.reflow(true,AppCommon.ExpiredBpfStageIdentifier_Review,AppCommon.ExpiredBpfStageIdentifier_UpdateContent)}else if(expiredReviewState.getValue()==AppCommon.KnowledgeArticleExpiredReviewState.Republish){_this.expiredReviewOptionSetPreviousSelection=expiredReviewState.getValue();formContext.ui.process.reflow(true,AppCommon.ExpiredBpfStageIdentifier_Review,AppCommon.ExpiredBpfStageIdentifier_Publish)}else if(expiredReviewState.getValue()==AppCommon.KnowledgeArticleExpiredReviewState.Archive){formContext.ui.process.reflow(true,AppCommon.ExpiredBpfStageIdentifier_Review,"");AppCommon.KnowledgeArticle.CommandActions.archive(formContext)}}else{_this.expiredReviewOptionSetPreviousSelection=expiredReviewState.getValue();formContext.ui.process.reflow(true,AppCommon.ExpiredBpfStageIdentifier_Review,"")}}};this.publishdate_onchange=function(formContext){if(!_this.hasValidPublishDate){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_PublishingDateTimeMessage);var options={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alert,options);var publishonDateTimeControl=formContext.getControl(AppCommon.PubishonDateFormId),getpuPublishondatetime=publishonDateTimeControl.getAttribute();getpuPublishondatetime.setValue(null)}};this.reviewRejected=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),rejectReasonControl=formContext.getControl(AppCommon.ReasonForRejection);if(rejectReasonControl){var rejectReason=rejectReasonControl.getAttribute().getValue();if(rejectReason!=null){var entityAttribute=formContext.data.attributes.get(AppCommon.ParamEntityId),articleId=entityAttribute.getValue(),entityReference={id:articleId,logicalName:AppCommon.KnowledgeArticleEntity},fields={},primaryAuthorId=formContext.data.attributes.get(AppCommon.ParamPrimaryAuthorId);if(primaryAuthorId.getValue()!=null){var primaryAuthorIdValue=primaryAuthorId.getValue(),records={},ownerIdKey=AppCommon.OwnerIdBind,ownerIdValue=AppCommon.SystemUserEntitySet+"("+primaryAuthorIdValue.replace(/[{}]/g,"")+")",ownerData={};ownerData[ownerIdKey]=ownerIdValue;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,ownerData).then(function(successParameter){Xrm.Utility.closeProgressIndicator()},function(errorParameter){AppCommon.KnowledgeArticleUtility.actionFailedCallback()})}var annotationEntityReference={id:"",logicalName:AppCommon.NotesEntity},recordFields={};recordFields[AppCommon.LogicalName]=AppCommon.KnowledgeArticle,recordFields[AppCommon.Id]=articleId;var annotationFields={};annotationFields[AppCommon.ObjectTypeCode]=AppCommon.KnowledgeArticleEntity;annotationFields[AppCommon.KAAnnotationsBind]=AppCommon.Knowledgearticles+"("+articleId.replace(/[{}]/g,"")+")";annotationFields[AppCommon.IsDocument]=false;annotationFields[AppCommon.Subject]=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Reject_Note_Title);annotationFields[AppCommon.NoteText]=formContext.data.attributes.get(AppCommon.ReasonForRejection).getValue();Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var data={statecode:AppCommon.KnowledgeArticleFormState.Draft,statuscode:AppCommon.DefaultStatusCode};Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,data).then(function(){Xrm.WebApi.createRecord(AppCommon.NotesEntity,annotationFields).then(function(response){Xrm.Utility.closeProgressIndicator()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca);Xrm.Page.ui.close()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else{var alertDialogStrings={text:""};alertDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ReviewRejectReason_DialogText);var dialogOptions={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alertDialogStrings,dialogOptions)}var reviewState=formContext.data.attributes.get(AppCommon.ParamReview),reviewOptionSet=reviewState;if(reviewOptionSet.getValue()!=null)_this.reviewOptionSetPreviousSelection=reviewOptionSet.getValue()}};this.expirationDate=function(formContext){return formContext.ui.controls.get(AppCommon.ExpirationDate)?formContext.ui.controls.get(AppCommon.ExpirationDate).getAttribute():null};this.publishDate=function(formContext){return formContext.ui.controls.get(AppCommon.PublishOn)?formContext.ui.controls.get(AppCommon.PublishOn).getAttribute():null};this.isScheduledOrPublishedState=function(formContext){if(formContext.data){var knowledgeArticleState=formContext.data.entity.attributes.get(AppCommon.StateCode);return knowledgeArticleState.getValue()==AppCommon.KnowledgeArticleFormState.Published||knowledgeArticleState.getValue()==AppCommon.KnowledgeArticleFormState.Scheduled}return false};this.currentExpirationDate=function(formContext){var expirationDateAttribute=_this.expirationDate(formContext);return expirationDateAttribute?expirationDateAttribute.getValue():null};this.currentPublishDate=function(formContext){var publishDateAttribute=_this.publishDate(formContext);return publishDateAttribute?publishDateAttribute.getValue():null};this.hasValidExpirationDate=function(formContext){var expirationDate=_this.currentExpirationDate(formContext),publishDate=_this.currentPublishDate(formContext);return !expirationDate||(!publishDate||expirationDate>publishDate)};this.hasValidPublishDate=function(formContext){var expirationDate=_this.currentExpirationDate(formContext),publishDate=_this.currentPublishDate(formContext);return !publishDate||(!expirationDate||publishDate<expirationDate)};this.disablePrimaryArticleVersionFieldInProcess=function(formContext){var isPrimary=formContext.data.entity.attributes.get(AppCommon.IsPrimary);if(isPrimary.getValue()==1){var control=formContext.ui.controls.get(AppCommon.BPFParentArticleContentId);control&&control.setDisabled(true)}};this.approvalFieldDisableBasedOnRole=function(formContext){var userid=Xrm.Utility.getGlobalContext().userSettings.userId.replace("{","").replace("}",""),entityReference={};entityReference["entityType"]=AppCommon.SystemUserEntity;entityReference["id"]=userid;var request=new AppCommon.RetrieveUserPrivilegeByPrivilegeNameODataContract(entityReference,AppCommon.ApproveKnowledgeArticlePrivilegeName);Xrm.WebApi.online.execute(request).then(function(result){result.ok&&result.json().then(function(response){if(!response.RolePrivileges.some(function(role){return role["PrivilegeId"]===AppCommon.ApproveKnowledgeArticlePrivilegeId})){var approvalField=formContext.ui.controls.get(AppCommon.BPFReviewId);approvalField&&approvalField.setDisabled(true)}})},AppCommon.KnowledgeArticleUtility.actionFailedCallback)};this.canApproveOrPublishKnowledgeArticle=function(isApprove){var privilegeName=isApprove?AppCommon.ApproveKnowledgeArticlePrivilegeName:AppCommon.PublishKnowledgeArticlePrivilegeName,fetchXml="?fetchXml=<fetch mapping='logical' version='1.0'><entity name='privilege'><attribute name='accessright' /><attribute name='name' /><filter><condition attribute='name' operator='eq' value='"+privilegeName+"' /></filter><link-entity name='roleprivileges' from='privilegeid' to='privilegeid'><link-entity name='role' from='parentrootroleid' to='roleid'><link-entity name='systemuserroles' from='roleid' to='roleid'><filter><condition attribute='systemuserid' operator='eq' value='"+Xrm.Utility.getGlobalContext().userSettings.userId+"' /></filter></link-entity></link-entity></link-entity></entity></fetch>";return Xrm.WebApi.retrieveMultipleRecords(AppCommon.PrivilegeEntity,fetchXml)};this.hasPrivilege=function(isApprove,entityCollection){var result=false,privilegeName=isApprove?AppCommon.ApproveKnowledgeArticlePrivilegeName:AppCommon.PublishKnowledgeArticlePrivilegeName;if(entityCollection&&entityCollection.entities.length>0)if(entityCollection.entities[0][AppCommon.Name]==privilegeName)result=true;return result};this.disableTranslationLanguageLocaleFieldInProcess=function(formContext){var isPrimary=formContext.data.entity.attributes.get(AppCommon.IsPrimary);if(isPrimary.getValue()==0){var control=formContext.ui.controls.get(AppCommon.BPFLanguageLocaleId);control&&control.setDisabled(true)}};this.setLanguageOnNewArticle=function(formContext,articleId){if(articleId==""){var langLocaleAttribute=formContext.data.entity.attributes.get(AppCommon.LanguageLocaleId),lcid=formContext.context.userSettings.languageId,optionString="?$select=localeid,name&$filter=localeid eq "+lcid;Xrm.WebApi.retrieveMultipleRecords(AppCommon.LanguageLocaleEntity,optionString).then(function(entityCollection){if(!entityCollection)throw"Response cannot be null";if(entityCollection.entities.length>0){var items=[],langLocale=entityCollection.entities[0];if(langLocale){var lookupItem={entityType:AppCommon.LanguageLocaleEntity,id:langLocale[AppCommon.LanguageLocaleId],name:langLocale[AppCommon.Name]};items.push(lookupItem);langLocaleAttribute.setValue(items)}}}),AppCommon.KnowledgeArticleUtility.actionFailedCallback}};this.enableLanguageLookupFields=function(formContext){var attribute=formContext.getAttribute(AppCommon.LanguageLocaleId);if(attribute){var controls=attribute.controls;controls.forEach(function(ctrl,index){var control=ctrl;control.setDisabled(false)})}};this.data_onload=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);if(formContext.data.entity.getId()!=""){_this.disableControl(formContext,AppCommon.LanguageLocaleId,AppCommon.LanguageLocaleId);_this.disableControl(formContext,AppCommon.LanguageLocaleId,AppCommon.HeaderLanguageLocaleId)}else{var majorVersionAttribute=formContext.data.entity.attributes.get(AppCommon.MajorVersionNumber),minorVersionAttribute=formContext.data.entity.attributes.get(AppCommon.MinorVersionNumber);majorVersionAttribute.setValue(AppCommon.DefaultMajorVersion);minorVersionAttribute.setValue(AppCommon.DefaultMinorVersion)}};this.disableControl=function(formContext,attributeName,controlName){var attribute=formContext.getAttribute(attributeName);if(!attribute)return;var control=attribute.controls.getByName(controlName);if(!control)return;control.setDisabled(true)};this.process_onStageChange=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);if(_this.isScheduledOrPublishedState(formContext)){var eventArgs=eventContext.getEventArgs(),alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_SaveBlockMessage);Xrm.Navigation.openAlertDialog(alert,null);eventArgs.preventDefault();return}}}return KnowledgeArticleMainSystemLibraryWebResource}();AppCommon.KnowledgeArticleMainSystemLibraryWebResource=KnowledgeArticleMainSystemLibraryWebResource})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticleCommandActions=function(){function KnowledgeArticleCommandActions(){var _this=this;this.isUpdateAction=false;this.isScheduledArticle=false;this.defaultValue=-1;this.expiredstatusdefaultValue=-1;this.markInternalOpenDialog=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var dialogParams={};dialogParams[AppCommon.ParamEntityId]=formContext.data.entity.getId();dialogParams[AppCommon.ParamArticlePublicNumber]=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber.toLowerCase()).getValue();var options={height:500,width:400,position:1};Xrm.Navigation.openDialog(AppCommon.MarkInternalDialog,options,dialogParams).then(function(successParameter){if(successParameter&&successParameter.parameters)if(AppCommon.DialogOkId==successParameter.parameters[AppCommon.ParamLastButtonClicked]){var isInternal=true,selectVersionsOptions=successParameter.parameters[AppCommon.SelectVersions];selectVersionsOptions!=null&&selectVersionsOptions!=undefined&&selectVersionsOptions==AppCommon.MarkInternalExternalSelectVersions.ThisVersionOnly.toString()&&_this.confirmCallBack(formContext,isInternal,dialogParams);selectVersionsOptions!=null&&selectVersionsOptions!=undefined&&selectVersionsOptions==AppCommon.MarkInternalExternalSelectVersions.AllVersionsAndtranslations.toString()&&_this.confirmCascadingCallBack(formContext,isInternal,dialogParams)}},null)};this.markExternalOpenDialog=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var dialogParams={};dialogParams[AppCommon.ParamEntityId]=formContext.data.entity.getId();dialogParams[AppCommon.ParamArticlePublicNumber]=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber.toLowerCase()).getValue();var options={height:500,width:400,position:1};Xrm.Navigation.openDialog(AppCommon.MarkExternalDialog,options,dialogParams).then(function(successParameter){if(successParameter&&successParameter.parameters)if(AppCommon.DialogOkId==successParameter.parameters[AppCommon.ParamLastButtonClicked]){var isInternal=false,selectVersionsOptions=successParameter.parameters[AppCommon.SelectVersions];selectVersionsOptions!=null&&selectVersionsOptions!=undefined&&selectVersionsOptions==AppCommon.MarkInternalExternalSelectVersions.ThisVersionOnly.toString()&&_this.confirmCallBack(formContext,isInternal,dialogParams);selectVersionsOptions!=null&&selectVersionsOptions!=undefined&&selectVersionsOptions==AppCommon.MarkInternalExternalSelectVersions.AllVersionsAndtranslations.toString()&&_this.confirmCascadingCallBack(formContext,isInternal,dialogParams)}},null)};this.markInternalSubmitClick=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogOkId);formContext.ui.close()};this.markExternalSubmitClick=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogOkId);formContext.ui.close()};this.confirmCallBack=function(formContext,isInternal,dialogParams){var articleId=formContext.data.entity.getId();Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var record=_this.getKnowledgeArticleRecord(articleId,isInternal);Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,record).then(function(response){Xrm.Utility.closeProgressIndicator();var stateCode=formContext.getAttribute(AppCommon.StateCode).getValue(),statusCode=formContext.getAttribute(AppCommon.StatusCode).getValue(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(record["isinternal"]==true)AppCommon.KnowledgeArticleUtility.reportEvent(articleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.MarkInternal);else record["isinternal"]==false&&AppCommon.KnowledgeArticleUtility.reportEvent(articleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.MarkExternal);_this.refreshForm()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)};this.confirmCascadingCallBack=function(formContext,isInternal,dialogParams){var articlePublicNumber=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber).getValue(),fetchXml="?fetchXml=<fetch version='1.0' mapping='logical' distinct='false'><entity name='knowledgearticle'><attribute name='isinternal' /><attribute name='knowledgearticleid' /><attribute name='rootarticleid' /><filter type='and'><condition attribute='articlepublicnumber' operator='eq' value='"+articlePublicNumber+"' /></filter></entity></fetch>";Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,fetchXml).then(function(collection){Xrm.Utility.closeProgressIndicator();if(collection!=null){var articlescount=collection.entities.length;if(articlescount!=0){for(var count=0;count<articlescount;count++){var entityCollection=collection.entities[count];if(entityCollection!=null){var articleId=entityCollection["knowledgearticleid"],record={isinternal:isInternal};Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,record).then(function(response){Xrm.Utility.closeProgressIndicator();count==articlescount&&_this.refreshForm()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}}var knowledgeArticleId=formContext.data.entity.getId(),stateCode=formContext.getAttribute(AppCommon.StateCode).getValue(),statusCode=formContext.getAttribute(AppCommon.StatusCode).getValue(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(isInternal==true)AppCommon.KnowledgeArticleUtility.reportEvent(knowledgeArticleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.MarkInternal);else isInternal==false&&AppCommon.KnowledgeArticleUtility.reportEvent(knowledgeArticleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.MarkExternal)}}},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)};this.getKnowledgeArticleRecord=function(articleId,isInternal){var record={};record["knowledgearticleid"]=articleId;record["isinternal"]=isInternal;return record};this.approve=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var onApproveDialogConfirmCallback=function(response){Xrm.Page.getAttribute(AppCommon.Review);var reviewAttribute=formContext.getAttribute(AppCommon.Review);if(reviewAttribute!=null){AppCommon.KnowledgeArticle.Instance.reviewOptionSetPreviousSelection=reviewAttribute.getValue();reviewAttribute.setValue(AppCommon.KnowledgeArticleReviewState.Approved)}_this.defaultDoneCallback(response)},onApproveDialogCancelCallback=function(){var reviewAttribute=formContext.getAttribute(AppCommon.Review);reviewAttribute!=null&&reviewAttribute.setValue(AppCommon.KnowledgeArticle.Instance.reviewOptionSetPreviousSelection);_this.defaultOnDialogCancelCallback()},confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogText);_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Approved,AppCommon.KnowledgeArticleFormStatus.Approved,onApproveDialogConfirmCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,onApproveDialogCancelCallback)};this.discard=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Discard_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Discard_Confirmation_DialogText);_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Discarded,AppCommon.KnowledgeArticleFormStatus.Discarded,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca,_this.defaultOnDialogCancelCallback)};this.update=function(formContext){if(!formContext)formContext=Xrm.Page;var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Update_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Update_Confirmation_DialogText);var alwaysCallBack=function(){_this.isUpdateAction=false;var articleId=Xrm.Page.data.entity.attributes.get(AppCommon.KnowledgeArticleId).getValue(),stateCode=Xrm.Page.getAttribute(AppCommon.StateCode).getValue(),statusCode=Xrm.Page.getAttribute(AppCommon.StatusCode).getValue(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Update);_this.refreshForm()};Xrm.Navigation.openConfirmDialog(confirmDialogStrings,_this.defaultDialogOptions()).then(function(successParameter){if(successParameter.confirmed){if(!formContext.data.isValid())return;if(formContext.data.entity.getIsDirty()){_this.isUpdateAction=true;formContext.data.save().then(alwaysCallBack,alwaysCallBack)}}},_this.defaultOnDialogCancelCallback)};this.restore=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Restore_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Restore_Confirmation_DialogText);_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Draft,AppCommon.KnowledgeArticleFormStatus.Draft,function(response){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var articleId=formContext.data.entity.getId(),articlePublicNumber=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber).getValue(),languageLocaleId="",languageLocale=formContext.data.entity.attributes.get(AppCommon.LanguageLocaleId).getValue();if(languageLocale!=null&&languageLocale.length>0)languageLocaleId=languageLocale[0].id;var rootArticleId="",rootArticle=formContext.data.entity.attributes.get(AppCommon.RootarticleId).getValue();if(rootArticle!=null&&rootArticle.length>0)rootArticleId=rootArticle[0].id;_this.updateIsLatestVersionWhenRestoringArticle(articleId,rootArticleId,articlePublicNumber,languageLocaleId,function(){Xrm.Utility.closeProgressIndicator();var expiredReviewState=formContext.data.entity.attributes.get(AppCommon.Expiredreviewoptions);AppCommon.KnowledgeArticle.Instance.expiredReviewOptionSetPreviousSelection=expiredReviewState.getValue();_this.refreshForm()},function(e){Xrm.Utility.closeProgressIndicator();AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca(e)})},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca,_this.defaultOnDialogCancelCallback)};this.archive=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Archive_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Archive_Confirmation_DialogText);var articleId=formContext.data.entity.getId(),rootArticleId=formContext.data.entity.attributes.get(AppCommon.RootarticleId).getValue()[0].id;_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Archived,AppCommon.KnowledgeArticleFormStatus.Archived,function(response){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));_this.updateIsLatestVersionForParentArticleOfArchivedArticle(articleId,rootArticleId,function(){Xrm.Utility.closeProgressIndicator();var expiredReviewState=formContext.data.entity.attributes.get(AppCommon.Expiredreviewoptions);AppCommon.KnowledgeArticle.Instance.expiredReviewOptionSetPreviousSelection=expiredReviewState.getValue();_this.refreshForm()},function(e){Xrm.Utility.closeProgressIndicator();AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca(e)})},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca,function(){var expiredReviewState=formContext.data.entity.attributes.get(AppCommon.Expiredreviewoptions);expiredReviewState.setValue(AppCommon.KnowledgeArticle.Instance.expiredReviewOptionSetPreviousSelection)})};this.revertToDraft=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_RevertToDraft_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_RevertToDraft_Confirmation_DialogText);_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Draft,AppCommon.DefaultStatusCode,_this.defaultDoneCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca,_this.defaultOnDialogCancelCallback)};this.major=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges)return;var entity=formContext.data.entity.getEntityReference();_this.createKnowledgeArticleVersion(formContext,entity,true)};this.minor=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges)return;var entity=formContext.data.entity.getEntityReference();_this.createKnowledgeArticleVersion(formContext,entity,false)};this.viewContent=function(formContext){if(!formContext)formContext=Xrm.Page;var orgName=Xrm.Page.context.organizationSettings.uniqueName,id=Xrm.Page.data.entity.getId(),address="/KnowledgeArticleViewer/KnowledgeArticleContentViewer.aspx?id="+id;if(_this.IsBrowserChrome())window.open(address.toString());else window.open(address.toString(),"_blank","height=600,width=800,top=150,left=150,menubar=no,resizable=yes,status=yes,scrollbars=yes,titlebar=yes,toolbar=no,location=yes,directories=yes")};this.translateArticle=function(formContext){var isPrimary=null,parentArticleId=null,articlePublicNumber=null,attribArray=[];if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;if(formContext.getAttribute(AppCommon.IsPrimary)==null)attribArray.push(AppCommon.IsPrimary);else isPrimary=formContext.getAttribute(AppCommon.IsPrimary).getValue();if(formContext.getAttribute(AppCommon.ParentArticleContentId)==null)attribArray.push(AppCommon.ParentArticleContentId);else{var parentArticleLookup=formContext.getAttribute(AppCommon.ParentArticleContentId).getValue();parentArticleId=parentArticleLookup[0].id}if(formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber)==null)attribArray.push(AppCommon.ArticlePublicNumber);else articlePublicNumber=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber).getValue();if(attribArray.length>0){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var options="?$select="+attribArray.join(",");Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,formContext.data.entity.getId(),options).then(function(response){Xrm.Utility.closeProgressIndicator();if(!isPrimary)isPrimary=response[AppCommon.IsPrimary];if(parentArticleId==null)parentArticleId=response[AppCommon.ParentArticleContentId].toString();if(articlePublicNumber==null)articlePublicNumber=response[AppCommon.ArticlePublicNumber].toString();_this.translateArticleDialogOpen(isPrimary?formContext.data.entity.getId():parentArticleId,articlePublicNumber)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else _this.translateArticleDialogOpen(isPrimary?formContext.data.entity.getId():parentArticleId,articlePublicNumber)};this.translateKnowledgeArticle=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),entityAttribute=formContext.data.attributes.get(AppCommon.ParamEntityId),articleId="";if(entityAttribute)articleId=entityAttribute.getValue();var source={id:articleId,logicalName:AppCommon.KnowledgeArticleEntity},TranslateLanguageIdControl=formContext.getControl(AppCommon.TranslateLanguageId);if(TranslateLanguageIdControl){var TranslateLanguageIdAttribute=TranslateLanguageIdControl.getAttribute();if(TranslateLanguageIdAttribute&&TranslateLanguageIdAttribute.getValue()==null){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_TranslateLanguageMessage);var dialogOptions={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alert,dialogOptions);return}}if(TranslateLanguageIdAttribute)var languagelocale=TranslateLanguageIdAttribute.getValue(),languagelocaleid=languagelocale[0].id;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveRecord(AppCommon.LanguageLocaleEntity,languagelocaleid,"?$select=languagelocaleid").then(function(retrieveResponse){Xrm.Utility.closeProgressIndicator();var languageLocaleId=retrieveResponse[AppCommon.LanguageLocaleId],language={id:languageLocaleId,logicalName:AppCommon.LanguageLocaleEntity},versionType=0,optionsControl=formContext.getControl(AppCommon.VersionTypeId);if(optionsControl){var optionAttribute=optionsControl.getAttribute();if(optionAttribute&&optionAttribute.getSelectedOption())versionType=optionAttribute.getSelectedOption().value}var isMajor=versionType==AppCommon.TranslateDialogVersionPreference.Major;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var Source,Language,IsMajor,request=new AppCommon.CreateKnowledgeArticleTranslationODataContract(Source,Language,IsMajor),articleEntityReference={};articleEntityReference[AppCommon.KnowledgeArticleId]=source.id;articleEntityReference[AppCommon.OdataType]=AppCommon.KnowledgeArticleOdataType;request.Source=articleEntityReference;var langaugeEntityReference={};langaugeEntityReference[AppCommon.LanguageLocaleId]=languageLocaleId;langaugeEntityReference[AppCommon.OdataType]=AppCommon.LanguageLocaleOdataType;request.Language=langaugeEntityReference;request.IsMajor=isMajor;Xrm.WebApi.online.execute(request).then(function(response){Xrm.Utility.closeProgressIndicator();formContext.ui.close();if(response&&response.ok&&response.headers&&response.headers.has(AppCommon.ODataEntityId)){var entityIdUrl=response.headers.get(AppCommon.ODataEntityId);if(entityIdUrl){var entityId=entityIdUrl.slice(entityIdUrl.indexOf("(")+1,entityIdUrl.indexOf(")"));if(entityId){var screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleId,AppCommon.KnowledgeArticleFormState.Draft,AppCommon.KnowledgeArticleFormStatus.Draft,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Translate);Xrm.Utility.openEntityForm(AppCommon.KnowledgeArticleEntity,entityId)}}}},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)};this.getLatestVersion=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),TranslateLanguageIdControl=formContext.getControl(AppCommon.TranslateLanguageId);if(TranslateLanguageIdControl){var TranslateLanguageIdAttribute=TranslateLanguageIdControl.getAttribute();if(TranslateLanguageIdAttribute&&TranslateLanguageIdAttribute.getValue()==null){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_TranslateLanguageMessage);var options={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alert,options);return}}if(TranslateLanguageIdAttribute)var languagelocale=TranslateLanguageIdAttribute.getValue(),languagelocaleid=languagelocale[0].id;var lblLatestVersion=formContext.getControl(AppCommon.LatestVersionId),lblMajorVersion=formContext.getControl(AppCommon.MajorVersionId),lblMinorVersion=formContext.getControl(AppCommon.MinorVersionId),versionType=formContext.getControl(AppCommon.VersionTypeId),articlePublicNumber=null;if(formContext.data.attributes.get(AppCommon.ParamArticlePublicNumber))articlePublicNumber=formContext.data.attributes.get(AppCommon.ParamArticlePublicNumber).getValue().toString();var fetchXml="?fetchXml=<fetch version='1.0' mapping='logical' distinct='false' count='1'><entity name='knowledgearticle'><attribute name='majorversionnumber' /><attribute name='minorversionnumber' /><filter type='and'><condition attribute='languagelocaleid' operator='eq' value='"+languagelocaleid+"' /><condition attribute='articlepublicnumber' operator='eq' value='"+articlePublicNumber+"' /><condition attribute='isrootarticle' operator='eq' value='0' /></filter><order attribute='majorversionnumber' descending='true' /><order attribute='minorversionnumber' descending='true' /></entity></fetch>";Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,fetchXml).then(function(retrieveResponse){Xrm.Utility.closeProgressIndicator();if(retrieveResponse!=null)if(retrieveResponse.entities.length!=0){lblLatestVersion.setLabel(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_LatestVersion));lblMajorVersion.setLabel(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_MajorVersion)+retrieveResponse.entities[0][AppCommon.MajorVersionNumber].toString());lblMinorVersion.setLabel(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_MinorVersion)+retrieveResponse.entities[0][AppCommon.MinorVersionNumber].toString());versionType.setDisabled(false);lblLatestVersion.setVisible(true);lblMajorVersion.setVisible(true);lblMinorVersion.setVisible(true)}else{lblLatestVersion.setLabel(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_NoTranslations));versionType.setDisabled(true);lblLatestVersion.setVisible(true);lblMajorVersion.setLabel("");lblMajorVersion.setVisible(false);lblMinorVersion.setLabel("");lblMinorVersion.setVisible(false);versionType.getAttribute()&&versionType.getAttribute().setValue(0)}},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)};this.relateArticle=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var dialogOptions={height:500,width:400,position:1},dialogParams={};dialogParams[AppCommon.ParamEntityId]=formContext.data.entity.getId();dialogParams[AppCommon.ParamAssociationType]=AppCommon.KnowledgeArticleEntity;dialogParams[AppCommon.ParamStateCode]=formContext.getAttribute(AppCommon.StateCode).getValue();dialogParams[AppCommon.ParamStatusCode]=formContext.getAttribute(AppCommon.StatusCode).getValue();Xrm.Navigation.openDialog(AppCommon.ArticleToArticleAssociationDialog,dialogOptions,dialogParams).then(function(result){_this.refreshRelatedQuickFormSubGrid(result,AppCommon.RelatedArticlesGrid,AppCommon.RelatedArticlesQuickFormName)})};this.relateCategory=function(formContext){if(!formContext)formContext=Xrm.Page;if(!_this.saveCurrentChanges(formContext))return;var dialogOptions={height:500,width:400,position:1},dialogParams={};dialogParams[AppCommon.ParamEntityId]=formContext.data.entity.getId();dialogParams[AppCommon.ParamAssociationType]=AppCommon.CategoryEntity;dialogParams[AppCommon.ParamStateCode]=formContext.getAttribute(AppCommon.StateCode).getValue();dialogParams[AppCommon.ParamStatusCode]=formContext.getAttribute(AppCommon.StatusCode).getValue();Xrm.Navigation.openDialog(AppCommon.ArticleToCategoryAssociationDialog,dialogOptions,dialogParams).then(function(result){_this.refreshRelatedGrid(result,AppCommon.RelatedCategoriesGrid)})};this.refreshRelatedGrid=function(result,subGridName){if(result){var subGridControl=Xrm.Page.ui.controls.get(subGridName);subGridControl&&subGridControl.refresh()}};this.refreshRelatedQuickFormSubGrid=function(result,subGridName,quickFormName){if(result){var quickForm=Xrm.Page.ui.quickForms.get(quickFormName);if(quickForm){var subgridOnQuickForm=quickForm.getControl(subGridName);subgridOnQuickForm&&subgridOnQuickForm.refresh()}}};this.associate=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),primaryEntityAttribute=formContext.data.attributes.get(AppCommon.ParamEntityId),associationType=formContext.data.attributes.get(AppCommon.ParamAssociationType),primaryArticleId=primaryEntityAttribute.getValue(),relatedArticleControl=formContext.getControl(AppCommon.AssociateEntityId);if(relatedArticleControl){var relatedEntityAttribute=relatedArticleControl.getAttribute();if(relatedEntityAttribute){var relatedEntityLookup=relatedEntityAttribute.getValue(),primaryEntity={};primaryEntity[AppCommon.KnowledgearticleId]=primaryArticleId;primaryEntity[AppCommon.Logicalname]=AppCommon.KnowledgeArticleEntity;var association=associationType.getValue();_this.createConnection(formContext,association,primaryEntity,relatedEntityLookup)}}};this.approveArticle=function(formContext,onApproveDialogConfirmCallback,onApproveDialogCancelCallback){var confirmDialogStrings={text:""};confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogText);_this.setStateConfirmationDialog(formContext,confirmDialogStrings,_this.defaultDialogOptions(),AppCommon.KnowledgeArticleFormState.Approved,AppCommon.DefaultStatusCode,onApproveDialogConfirmCallback,AppCommon.KnowledgeArticleUtility.actionFailedCallback,onApproveDialogCancelCallback)};this.refreshForm=function(){Xrm.Page.data.refresh(true).then(function(){Xrm.Page.ui.refreshRibbon()},function(){})};this.saveCurrentChanges=function(formContext){if(formContext.data){var isDirty=formContext.data.entity.getIsDirty();if(isDirty)if(AppCommon.KnowledgeArticle.Instance.isScheduledOrPublishedState(formContext)){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Save_PublishedStatus_Notification_DialogText);var dialogOptions={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alert,dialogOptions);return false}else formContext.data.save()}return true};this.publish=function(formContext){var entities=[],entity={TypeName:AppCommon.KnowledgeArticleEntity,Id:formContext.data.entity.getId(),Name:formContext.data.entity.attributes.get(AppCommon.KnowldgeArticleTitle).getValue(),TypeCode:AppCommon.KnowledgeArticleOTC};entities.push(entity);AppCommon.KnowledgeArticle.PublishCommands.openPublishArticleDialog(formContext,entities,false,null)};this.articleOnLoad=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),publishStatusControl=formContext.getControl(AppCommon.PublishStatusControlId),publishStatusAttribute=publishStatusControl.getAttribute(),publishedStatusControl=formContext.getControl(AppCommon.PublishedStatusControlId),publishedStatusAttribute=publishedStatusControl.getAttribute(),publishDateTimeControl=formContext.getControl(AppCommon.PublishDateTimeControlId),expirationDateTimeControl=formContext.getControl(AppCommon.ExpirationDateControlId),getExpirationdatetime=expirationDateTimeControl.getAttribute(),getpublishdatetime=publishDateTimeControl.getAttribute(),expirationStateControl=formContext.getControl(AppCommon.ExpirationStateControlId),expirationStatusControl=formContext.getControl(AppCommon.ExpirationStatusControlId),scheduledStatusControl=formContext.getControl(AppCommon.ScheduledStatusControlId);_this.loadKnowledgeArticleStatusOptions(formContext,AppCommon.KnowledgeArticleFormState.Published,AppCommon.PublishedStatusControlId);var records=formContext.data.attributes.get(AppCommon.ParamSelectedRecords).getValue(),isBulkPublishAction=formContext.data.attributes.get(AppCommon.ParamIsBulkPublishAction).getValue();if(!isBulkPublishAction){var source=records[0];Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var options="?$select=publishon,expirationdate,expirationstateid,publishstatusid,expirationstatusid,statecode";Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,source.Id.toString(),options).then(function(retrieveResponse){Xrm.Utility.closeProgressIndicator();if(retrieveResponse){var record=retrieveResponse,statecode=record[AppCommon.StateCode],publishStatus=AppCommon.PublishDialogPublishPreference.Now;if(record[AppCommon.PubishonDateFormId]){getpublishdatetime&&getpublishdatetime.setValue(new Date(record[AppCommon.PubishonDateFormId]));publishStatus=AppCommon.PublishDialogPublishPreference.InFuture;publishDateTimeControl.setVisible(true)}publishStatusAttribute&&publishStatusAttribute.setValue(publishStatus);if(record[AppCommon.ExpirationDateFormId]){getExpirationdatetime&&getExpirationdatetime.setValue(new Date(record[AppCommon.ExpirationDateFormId]));var expirestate=AppCommon.KnowledgeArticleFormState.Expired;if(record[AppCommon.ExpirationStateFormId])expirestate=record[AppCommon.ExpirationStateFormId];switch(expirestate){case AppCommon.KnowledgeArticleFormState.Archived:formContext.data.attributes.get(AppCommon.ExpirationStateControlId).setValue(AppCommon.KnowledgeArticleFormState.Archived);break;case AppCommon.KnowledgeArticleFormState.Expired:formContext.data.attributes.get(AppCommon.ExpirationStateControlId).setValue(AppCommon.KnowledgeArticleFormState.Expired);break;case AppCommon.KnowledgeArticleFormState.Published:formContext.data.attributes.get(AppCommon.ExpirationStateControlId).setValue(AppCommon.KnowledgeArticleFormState.Published);break}_this.expiredstatusdefaultValue=record[AppCommon.ExpirationStatusFormId];_this.loadKnowledgeArticleStatusOptions(formContext,expirestate,AppCommon.ExpirationStatusControlId);expirationStateControl.setVisible(true);expirationStatusControl.setVisible(true)}if(statecode==AppCommon.KnowledgeArticleFormState.Scheduled){_this.isScheduledArticle=true;publishStatusControl.getAttribute().setValue(1);_this.defaultValue=record[AppCommon.PublishStatusFormId];publishedStatusAttribute&&publishedStatusAttribute.setValue(_this.defaultValue);if(getpublishdatetime&&getpublishdatetime.getValue()){scheduledStatusControl.setVisible(true);publishDateTimeControl.setVisible(true)}if(getExpirationdatetime&&getExpirationdatetime.getValue()){expirationStateControl.setVisible(true);expirationStatusControl.setVisible(true)}_this.loadKnowledgeArticleStatusOptions(formContext,AppCommon.KnowledgeArticleFormState.Scheduled,AppCommon.ScheduledStatusControlId)}}setTimeout(function(){publishStatusControl.setFocus()},250)}),AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca}else{_this.isScheduledArticle=false;setTimeout(function(){publishStatusControl.setFocus()},250)}_this.setVisibleRelatedControl(formContext)};this.scheduledStatusOnChange=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),returnValue,publishedStatusId=formContext.getControl(AppCommon.PublishStatusControlId),publishOptions=publishedStatusId.getAttribute(),publishDateTimeControl=formContext.getControl(AppCommon.PublishDateTimeControlId),scheduledStatusControl=formContext.getControl(AppCommon.ScheduledStatusControlId),getpublishdatetime=publishDateTimeControl.getAttribute();if(publishedStatusId&&publishOptions){var selectedOption=publishOptions.getSelectedOption();if(selectedOption)returnValue=selectedOption.value}if(returnValue==0){publishDateTimeControl.setVisible(false);scheduledStatusControl.setVisible(false);getpublishdatetime.setValue(null)}else{publishDateTimeControl.setVisible(true);scheduledStatusControl.setVisible(true);_this.loadKnowledgeArticleStatusOptions(formContext,AppCommon.KnowledgeArticleFormState.Scheduled,AppCommon.ScheduledStatusControlId)}};this.expirationDateOnChange=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),expirationStateControl=formContext.getControl(AppCommon.ExpirationStateControlId),expirationStatusControl=formContext.getControl(AppCommon.ExpirationStatusControlId),expirationStateOptions=expirationStateControl.getAttribute(),publishedStatusId=formContext.getControl(AppCommon.PublishStatusControlId),publishOptions=publishedStatusId.getAttribute();if(_this.currentExpirationDate(formContext)==null){expirationStateControl.setVisible(false);expirationStatusControl.setVisible(false)}else{expirationStateControl.setVisible(true);expirationStatusControl.setVisible(true);expirationStateOptions&&expirationStateOptions.getOptions()&&expirationStateOptions.getOptions().length>0&&expirationStateOptions.setValue(expirationStateOptions.getOptions()[0].value);_this.loadKnowledgeArticleStatusOptions(formContext,expirationStateOptions.getSelectedOption().value,AppCommon.ExpirationStatusControlId)}};this.publishDateOnChange=function(){return};this.expirationStateOnChange=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext),returnValue,expirationStateId=formContext.getControl(AppCommon.ExpirationStateControlId),expirationOptions=expirationStateId.getAttribute(),expirationStatusControl=formContext.getControl(AppCommon.ExpirationStatusControlId);if(expirationStateId&&expirationOptions){returnValue=expirationOptions.getSelectedOption().value;_this.loadKnowledgeArticleStatusOptions(formContext,expirationOptions.getSelectedOption().value,AppCommon.ExpirationStatusControlId)}};this.loadKnowledgeArticleStatusOptions=function(formContext,stateCodeValue,controlId){var attributes=[AppCommon.StateCode,AppCommon.StatusCode];Xrm.Utility.getEntityMetadata(AppCommon.KnowledgeArticleEntity,attributes).then(function(entityMetadata){if(entityMetadata&&entityMetadata.EnforceStateTransitions&&entityMetadata.IsStateModelAware){var entityAttribute=formContext.getAttribute(AppCommon.KnowledgeArticleId),articleId=entityAttribute.getValue();if(articleId==null)return;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,articleId,"?$select=statuscode").then(function(retrieveResponse){Xrm.Utility.closeProgressIndicator();var record=retrieveResponse,statusCode=record[AppCommon.StatusCode];Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.Utility.getAllowedStatusTransitions(AppCommon.KnowledgeArticleEntity,statusCode).then(function(allowedTransitions){Xrm.Utility.closeProgressIndicator();_this.getAndSetDefaultStatusForState(formContext,AppCommon.KnowledgeArticleEntity,stateCodeValue,controlId,allowedTransitions,entityMetadata)},function(){Xrm.Utility.closeProgressIndicator()})},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else _this.getAndSetDefaultStatusForState(formContext,AppCommon.KnowledgeArticleEntity,stateCodeValue,controlId,null,entityMetadata)},null)};this.getAndSetDefaultStatusForState=function(formContext,entityName,stateCode,controlId,allowedTransitions,entityMetadata){var defaultStatusCode=-1,stateAttributeMetadata=entityMetadata.Attributes.get(AppCommon.StateCode),statusOptions=stateAttributeMetadata.getStatusValuesForState(stateCode),status=stateAttributeMetadata.getDefaultStatus(stateCode);if(status!=null)defaultStatusCode=status;if(controlId==AppCommon.ExpirationStatusControlId)defaultStatusCode=_this.expiredstatusdefaultValue;else if(_this.isScheduledArticle)defaultStatusCode=_this.defaultValue;var statusReason=formContext.getControl(controlId),options=statusReason.getAttribute(),defaultStatusReason=formContext.getControl(AppCommon.DefaultExpirationStatusControlId),defaultOptions=defaultStatusReason.getAttribute();if(statusReason&&options){for(var items=options.getOptions(),allowedStatus=[],_i=0,items_1=items;_i<items_1.length;_i++){var option=items_1[_i];if(statusOptions.indexOf(option.value)!=-1&&(allowedTransitions==null||allowedTransitions.indexOf(option.value)!=-1))allowedStatus[allowedStatus.length]=option.value;else statusReason.removeOption(option.value)}if(controlId==AppCommon.ExpirationStatusControlId){for(var allowedStatus=[],defaultItems=defaultOptions.getOptions(),_a=0,defaultItems_1=defaultItems;_a<defaultItems_1.length;_a++){var defaultOption=defaultItems_1[_a];if(statusOptions.indexOf(defaultOption.value)!=-1&&(allowedTransitions==null||allowedTransitions.indexOf(defaultOption.value)!=-1))allowedStatus[allowedStatus.length]=defaultOption.value}statusReason.clearOptions();for(var _b=0,allowedStatus_1=allowedStatus;_b<allowedStatus_1.length;_b++)for(var item=allowedStatus_1[_b],_c=0,defaultItems_2=defaultItems;_c<defaultItems_2.length;_c++){var defaultOption=defaultItems_2[_c];if(item==defaultOption.value){statusReason.addOption(defaultOption);break}}}allowedStatus=allowedTransitions==null?statusOptions:allowedStatus;options.setValue(defaultStatusCode!=-1&&allowedStatus.indexOf(defaultStatusCode)!=-1?defaultStatusCode:allowedStatus[0])}};this.setVisibleRelatedControl=function(formContext){var isPrimaryAttribute=formContext.data.attributes.get(AppCommon.ParamIsPrimary),isBulkPublish=formContext.data.attributes.get(AppCommon.ParamIsBulkPublishAction),isPrimary=isPrimaryAttribute.getValue(),copyRelatedControl=formContext.getControl(AppCommon.CopyRelatedControlId),copyRelatedCategoryControl=formContext.getControl(AppCommon.CopyRelatedCategoryControlId),approveRelatedControl=formContext.getControl(AppCommon.ApproveRelatedControlId);if(copyRelatedControl&&approveRelatedControl&&copyRelatedCategoryControl)if(isBulkPublish.getValue()){copyRelatedControl.setVisible(true);copyRelatedCategoryControl.setVisible(true);approveRelatedControl.setVisible(true)}else if(isPrimary){copyRelatedControl.setVisible(false);copyRelatedCategoryControl.setVisible(false);approveRelatedControl.setVisible(true)}else{copyRelatedControl.setVisible(true);copyRelatedCategoryControl.setVisible(true);approveRelatedControl.setVisible(false)}};this.currentExpirationDate=function(formContext){var expirationDateTimeControl=formContext.getControl(AppCommon.ExpirationDateControlId),getExpirationdatetime=expirationDateTimeControl.getAttribute(),currentExpirationDateTime=getExpirationdatetime.getValue();if(currentExpirationDateTime)currentExpirationDateTime=new Date(currentExpirationDateTime.getFullYear(),currentExpirationDateTime.getMonth(),currentExpirationDateTime.getDate());return currentExpirationDateTime};this.currentPublishDate=function(formContext){var publishDateTimeControl=formContext.getControl(AppCommon.PublishDateTimeControlId),getpublishdatetime=publishDateTimeControl.getAttribute(),currentPublishDateTime=getpublishdatetime.getValue();if(currentPublishDateTime)currentPublishDateTime=new Date(currentPublishDateTime.getFullYear(),currentPublishDateTime.getMonth(),currentPublishDateTime.getDate());return currentPublishDateTime};this.closeDialog=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogCancelId);formContext.ui.close()};this.addNewTranslationFromSubGridStandard=function(gridControl){gridControl!=null&&gridControl!=undefined&&_this.translateArticle(Xrm.Page)};this.createFeedbackFromSubGridStandard=function(gridTypeName,gridControl){if(gridControl)if(gridTypeName==AppCommon.FeedbackEntity){var articleId=Xrm.Page.data.entity.getId(),entityRelationship=gridControl.getRelationship(),fromEntity={id:articleId,entityType:Xrm.Page.data.entity.getEntityName()},openOptions={entityName:gridTypeName,createFromEntity:fromEntity,useQuickCreateForm:true,relationship:entityRelationship};Xrm.Navigation.openForm(openOptions).then(function(response){gridControl.refresh()},null)}};this.relateCategoryFromSubGridStandard=function(gridControl){gridControl!=null&&gridControl!=undefined&&_this.relateCategory(Xrm.Page)};this.relateArticleFromSubgridStandard=function(){_this.relateArticle(Xrm.Page)};this.isRelatedArticlesSubGrid=function(gridControl){if(gridControl!=null&&gridControl!=undefined){var viewId=gridControl.getViewSelector().getCurrentView().id;return viewId==AppCommon.RelatedArticlesViewId}return false};this.defaultDialogOptions=function(){var dialogOptions={height:300,width:450,position:1};return dialogOptions};this.defaultDoneCallback=function(response){_this.refreshForm()};this.defaultOnDialogCancelCallback=function(){};this.setStateConfirmationDialog=function(formContext,confirmDialogStrings,dialogOptions,state,status,doneCallback,failCallback,onDialogCancelCallback){var data={statecode:state,statuscode:status},articleId=formContext.data.entity.getId(),currentState=formContext.getAttribute(AppCommon.StateCode).getValue(),onDialogConfirmCallback=function(){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,formContext.data.entity.getId(),data).then(function(response){Xrm.Utility.closeProgressIndicator();doneCallback(response);var currentBpfProcess=formContext.data.process.getActiveProcess(),isPrimaryArticle=formContext.data.entity.attributes.get(AppCommon.IsPrimary).getValue();if(currentBpfProcess!=null)if(isPrimaryArticle)state!=AppCommon.KnowledgeArticleFormState.Expired&&currentBpfProcess.getId()==AppCommon.ExpiredProcessId&&formContext.data.process.setActiveProcess(AppCommon.NewProcessId);var screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(currentState==AppCommon.KnowledgeArticleFormState.Discarded)AppCommon.KnowledgeArticleUtility.reportEvent(articleId,state,status,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Restore);else AppCommon.KnowledgeArticleUtility.reportEvent(articleId,state,status,screenDimensions.width,screenDimensions.height)},function(crmErrorResponse){Xrm.Utility.closeProgressIndicator();failCallback(crmErrorResponse)})};Xrm.Navigation.openConfirmDialog(confirmDialogStrings,dialogOptions).then(function(successParameter){if(successParameter.confirmed)onDialogConfirmCallback();else onDialogCancelCallback(successParameter)})};this.createConnection=function(formContext,associationType,primaryEntity,relatedEntityLookup){var record1RoleId={},record2RoleId={},relatedEntity={};if(relatedEntityLookup&&relatedEntityLookup.length>0){if(associationType==AppCommon.KnowledgeArticleEntity){record1RoleId[AppCommon.ConnectionRoleEntity]=AppCommon.ConnectionRoleEntity,record1RoleId[AppCommon.PrimaryEntityRoleId]=AppCommon.PrimaryEntityRoleId;record2RoleId[AppCommon.ConnectionRoleEntity]=AppCommon.ConnectionRoleEntity,record2RoleId[AppCommon.RelatedEntityRoleId]=AppCommon.RelatedEntityRoleId,relatedEntity[AppCommon.KnowledgeArticleEntity]=AppCommon.RelatedEntityRoleId;relatedEntity[AppCommon.RelatedEntityLookup]=relatedEntityLookup[0].id;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,primaryEntity[AppCommon.KnowledgearticleId],"?$select=_rootarticleid_value").then(function(response){Xrm.Utility.closeProgressIndicator();if(response==null)throw"Response cannot be null";var record=response[AppCommon.RootarticleIdvalue];if(record==null)throw"rootarticleid cannot be null";var rootEntity={id:record,logicalName:AppCommon.KnowledgeArticleEntity};_this.createConnectionEntityRecord(formContext,rootEntity,relatedEntity,record1RoleId,record2RoleId,AppCommon.RecordObjectTypeCodeValue,AppCommon.RecordObjectTypeCodeValue)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else if(associationType==AppCommon.CategoryEntity){var primaryEntityAttribute=formContext.data.attributes.get(AppCommon.ParamEntityId),primaryArticleId=primaryEntityAttribute.getValue(),RegardingObjectId={guid:relatedEntityLookup[0].id},primaryId={guid:primaryArticleId},request=new AppCommon.AssociateKnowledgeArticleODataContract(RegardingObjectId,AppCommon.RegardingObjectTypeCode,AppCommon.KnowledgearticleCategory,primaryId,AppCommon.CategoryEntity);Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.online.execute(request).then(function(response){Xrm.Utility.closeProgressIndicator();var articleId=formContext.data.attributes.get(AppCommon.ParamEntityId).getValue(),stateCode=formContext.data.attributes.get(AppCommon.ParamStateCode).getValue(),statusCode=formContext.data.attributes.get(AppCommon.ParamStatusCode).getValue(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.RelateCategory);formContext.ui.close();_this.refreshForm()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}}else{var alertDialogStrings={text:""};if(associationType==AppCommon.KnowledgeArticleEntity)alertDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_AssociateArticleArticle_DialogText);else if(associationType==AppCommon.CategoryEntity)alertDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_AssociateArticleCategory_DialogText);var dialogOptions={height:150,width:600,position:1};Xrm.Navigation.openAlertDialog(alertDialogStrings,dialogOptions)}};this.createConnectionEntityRecord=function(formContext,primaryEntity,relatedEntity,record1RoleId,record2RoleId,record1objecttypecode,record2objecttypecode){var attributeName="",record={};attributeName=AppCommon.Record1IdValue;record[AppCommon.Record1IdDataBindValue]=AppCommon.Knowledgearticles+"("+primaryEntity.id+")";attributeName=AppCommon.Record2IdValue;record[AppCommon.Record2IdDataBindValue]=AppCommon.Knowledgearticles+"("+relatedEntity[AppCommon.RelatedEntityLookup].replace(/[{}]/g,"")+")";attributeName=AppCommon.Record1RoleIdValue;record[AppCommon.Record1RoleIdDataBindValue]=AppCommon.Connections+"("+record1RoleId[AppCommon.PrimaryEntityRoleId]+")";attributeName=AppCommon.Record2RoleIdValue;record[AppCommon.Record2RoleIdDataBindValue]=AppCommon.Connections+"("+record2RoleId[AppCommon.RelatedEntityRoleId]+")";attributeName=AppCommon.Record1ObjectTypeCode;record[attributeName]=record1objecttypecode;attributeName=AppCommon.Record2ObjectTypeCode;record[attributeName]=record2objecttypecode;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.createRecord(AppCommon.ConnectionEntity,record).then(function(successParameter){Xrm.Utility.closeProgressIndicator();var articleId=formContext.data.attributes.get(AppCommon.ParamEntityId).getValue(),stateCode=formContext.data.attributes.get(AppCommon.ParamStateCode).getValue(),statusCode=formContext.data.attributes.get(AppCommon.ParamStatusCode).getValue(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleId,stateCode,statusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.RelateArticle);formContext.ui.close();_this.refreshForm()},function(errorParameter){AppCommon.KnowledgeArticleUtility.actionFailedCallback()})};this.createKnowledgeArticleVersion=function(formContext,source,isMajor){var currentMajor=formContext.data.entity.attributes.get(AppCommon.MajorVersionNumber).getValue(),currentMinor=formContext.data.entity.attributes.get(AppCommon.MinorVersionNumber).getValue(),columnSet=[],articlePublicNumber,languagelocale,articlePublicNumberAttribute=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber);if(articlePublicNumberAttribute)articlePublicNumber=articlePublicNumberAttribute.getValue();else columnSet[columnSet.length]=AppCommon.ArticlePublicNumber;var languagelocaleAttribute=formContext.data.entity.attributes.get(AppCommon.LanguageLocaleId);if(languagelocaleAttribute)languagelocale=formContext.data.entity.attributes.get(AppCommon.LanguageLocaleId).getValue();else columnSet[columnSet.length]=AppCommon.LanguageLocaleId;if(columnSet.length>0){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveRecord(source.entityType,source.id,"$select=articlepublicnumber,languagelocaleid").then(function(entity){Xrm.Utility.closeProgressIndicator();if(entity[AppCommon.ArticlePublicNumber])articlePublicNumber=entity[AppCommon.ArticlePublicNumber];if(entity[AppCommon.LanguageLocaleId])languagelocale=entity[AppCommon.LanguageLocaleId];_this.createKnowledgeArticleVersionHelper(formContext,source,languagelocale[0],articlePublicNumber,currentMajor,currentMinor,isMajor)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else _this.createKnowledgeArticleVersionHelper(formContext,source,languagelocale[0],articlePublicNumber,currentMajor,currentMinor,isMajor)};this.createKnowledgeArticleVersionHelper=function(formContext,source,languagelocale,articlePublicNumber,currentMajor,currentMinor,isMajor){if(languagelocale&&articlePublicNumber){var languagelocaleid=languagelocale.id,majorVersionToCreate=0,minorVersionToCreate=0,fetchXml="?fetchXml=<fetch version='1.0' mapping='logical' distinct='false' count='1'><entity name='knowledgearticle'><attribute name='majorversionnumber' /><attribute name='minorversionnumber' /><filter type='and'><condition attribute='articlepublicnumber' operator='eq' value='"+articlePublicNumber+"' /><condition attribute='languagelocaleid' operator='eq' value='"+languagelocaleid+"' /></filter><order attribute='majorversionnumber' descending='true' /><order attribute='minorversionnumber' descending='true' /></entity></fetch>",collection;Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,fetchXml).then(function(response){Xrm.Utility.closeProgressIndicator();if(response){if(response.entities[0]&&response.entities[0][AppCommon.MajorVersionNumber]!=null)majorVersionToCreate=response.entities[0][AppCommon.MajorVersionNumber]+1;if(response.entities[0]&&response.entities[0][AppCommon.MinorVersionNumber]!=null)minorVersionToCreate=response.entities[0][AppCommon.MinorVersionNumber]+1;var confirmDialogStrings={text:""},dialogOptions={height:300,width:450,position:1};if(isMajor){confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Create_Major_Confirmation_DialogTitle);confirmDialogStrings.text=AppCommon.StringUtil.format(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_CreateMajor_Confirmation_DialogText),majorVersionToCreate,currentMajor,currentMinor)}else{confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Create_Minor_Confirmation_DialogTitle);confirmDialogStrings.text=AppCommon.StringUtil.format(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_CreateMinor_Confirmation_DialogText),majorVersionToCreate-1,minorVersionToCreate,currentMajor,currentMinor)}}Xrm.Navigation.openConfirmDialog(confirmDialogStrings,dialogOptions).then(function(successParameter){if(successParameter.confirmed){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var Source,IsMajor=isMajor,request=new AppCommon.CreateKnowledgeArticleVersionODataContract(Source,IsMajor),entityReference={};entityReference[AppCommon.KnowledgeArticleId]=source.id;entityReference[AppCommon.OdataType]=AppCommon.KnowledgeArticleOdataType;request.Source=entityReference;request.IsMajor=isMajor;Xrm.WebApi.online.execute(request).then(function(createVersionResponse){Xrm.Utility.closeProgressIndicator();if(createVersionResponse&&createVersionResponse.ok&&createVersionResponse.headers&&createVersionResponse.headers.has(AppCommon.ODataEntityId)){var entityIdUrl=createVersionResponse.headers.get(AppCommon.ODataEntityId);if(entityIdUrl){var entityId=entityIdUrl.slice(entityIdUrl.indexOf("(")+1,entityIdUrl.indexOf(")"));if(entityId){var articleId=formContext.data.entity.getId(),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(IsMajor==true)AppCommon.KnowledgeArticleUtility.reportEvent(articleId,AppCommon.KnowledgeArticleFormState.Draft,AppCommon.KnowledgeArticleFormStatus.Draft,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Major);else IsMajor==false&&AppCommon.KnowledgeArticleUtility.reportEvent(articleId,AppCommon.KnowledgeArticleFormState.Draft,AppCommon.KnowledgeArticleFormStatus.Draft,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Minor);Xrm.Utility.openEntityForm(AppCommon.KnowledgeArticleEntity,entityId)}}}},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}},_this.defaultOnDialogCancelCallback)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}};this.translateArticleDialogOpen=function(knowledgeArticleId,articlePublicNumber){var dialogParams={};dialogParams[AppCommon.ParamEntityId]=knowledgeArticleId;dialogParams[AppCommon.ParamArticlePublicNumber]=articlePublicNumber;var options={height:500,width:400,position:1};Xrm.Navigation.openDialog(AppCommon.TranslateArticleDialog,options,dialogParams).then(function(result){_this.refreshRelatedGrid(result,AppCommon.RelatedTranslationsGrid)})};this.IsBrowserChrome=function(){return window.navigator.userAgent.indexOf("Chrome")!=-1?true:false};this.updateIsLatestVersionForParentArticleOfArchivedArticle=function(articleId,rootArticleId,onSuccess,onError){Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,articleId,"?$select=islatestversion").then(function(result){if(result[AppCommon.IsLatestVersion])Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,AppCommon.FetchXML_ClosestNonArchivedArticle(rootArticleId)).then(function(collection){var articles=collection.entities;if(articles.length>0){var currentArticle=articles[0];_this.updateLatestVersionOnArticle(currentArticle[AppCommon.KnowledgeArticleId],true,onSuccess,onError)}_this.updateLatestVersionOnArticle(articleId,false,onSuccess,onError)},onError);else onSuccess()},onError)};this.updateLatestVersionOnArticle=function(articleId,latestVersion,onSuccess,onError){var updateVersionData={islatestversion:latestVersion};Xrm.WebApi.updateRecord(AppCommon.KnowledgeArticleEntity,articleId,updateVersionData).then(function(response){onSuccess()},onError)};this.updateIsLatestVersionWhenRestoringArticle=function(articleId,rootArticleId,articlePublicNumber,languageLocaleId,onSuccess,onError){if(articleId==null||articleId==undefined||articleId=="")return;Xrm.WebApi.retrieveRecord(AppCommon.KnowledgeArticleEntity,articleId,AppCommon.SelectMajorMinorVersions).then(function(restoredArticle){Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,AppCommon.FetchXML_NonArchivedLatestVersionArticle(rootArticleId,articlePublicNumber,languageLocaleId)).then(function(collection){var articles=collection.entities;if(articles.length>0){var currentArticle=articles[0];if(currentArticle[AppCommon.MajorVersionNumber]<restoredArticle[AppCommon.MajorVersionNumber]||currentArticle[AppCommon.MajorVersionNumber]==restoredArticle[AppCommon.MajorVersionNumber]&&currentArticle[AppCommon.MinorVersionNumber]<restoredArticle[AppCommon.MinorVersionNumber]){_this.updateLatestVersionOnArticle(currentArticle[AppCommon.KnowledgeArticleId],false,onSuccess,onError);_this.updateLatestVersionOnArticle(articleId,true,onSuccess,onError)}else onSuccess()}else _this.updateLatestVersionOnArticle(articleId,true,onSuccess,onError)},onError)},onError)}}return KnowledgeArticleCommandActions}();AppCommon.KnowledgeArticleCommandActions=KnowledgeArticleCommandActions})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticlePublishCommands=function(){function KnowledgeArticlePublishCommands(){var _this=this;this.setLastButtonClicked=function(formContext,buttonId){var lastButtonClicked=formContext.data.attributes.get(AppCommon.ParamLastButtonClicked);lastButtonClicked&&lastButtonClicked.setValue(buttonId)};this.openPublishArticleDialog=function(formContext,records,isBulkPublishAction,gridControl){if(!formContext)formContext=Xrm.Page;if(!isBulkPublishAction&&!AppCommon.KnowledgeArticle.CommandActions.saveCurrentChanges(formContext))return;var dialogParams={};dialogParams[AppCommon.ParamSelectedRecords]=records;dialogParams[AppCommon.ParamIsBulkPublishAction]=isBulkPublishAction;dialogParams[AppCommon.ParamDateTimeFixOffset]="0";if(isBulkPublishAction)dialogParams[AppCommon.ParamIsPrimary]=isBulkPublishAction;else if(formContext.data!=null&&formContext.data.entity!=null){dialogParams[AppCommon.ParamIsPrimary]=formContext.data.entity.attributes.get(AppCommon.IsPrimary).getValue();dialogParams[AppCommon.ParamParentArticleContentId]=formContext.data.entity.attributes.get(AppCommon.ParentArticleContentId).getValue();dialogParams[AppCommon.ParamArticlePublicNumber]=formContext.data.entity.attributes.get(AppCommon.ArticlePublicNumber.toLowerCase()).getValue();dialogParams[AppCommon.ParamLanguageLocaleId]=formContext.data.entity.attributes.get(AppCommon.LanguageLocaleId).getValue();dialogParams[AppCommon.ParamMajorVersionNumber]=formContext.data.entity.attributes.get(AppCommon.MajorVersionNumber).getValue();dialogParams[AppCommon.ParamMinorVersionNumber]=formContext.data.entity.attributes.get(AppCommon.MinorVersionNumber).getValue()}var dialogOptions={height:500,width:400,position:2};Xrm.Navigation.openDialog(AppCommon.PublishArticleDialog,dialogOptions,dialogParams).then(function(successParameter){if(successParameter&&successParameter.parameters)AppCommon.DialogOkId==successParameter.parameters[AppCommon.ParamLastButtonClicked]&&AppCommon.KnowledgeArticle.PublishCommands.publishArticleCallback(formContext,successParameter.parameters,dialogOptions,gridControl)})};this.closeDialog=function(eventContext,dialogParams){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogOkId);if(formContext.data.attributes[AppCommon.ExpirationDateControlId]&&formContext.data.attributes[AppCommon.ExpirationDateControlId].getValue()!==formContext.data.attributes[AppCommon.ExpirationDateControlId].getUtcValue()){var offSetAmount=formContext.data.attributes[AppCommon.ExpirationDateControlId].getUtcValue()-formContext.data.attributes[AppCommon.ExpirationDateControlId].getValue();formContext.data.attributes[AppCommon.ParamDateTimeFixOffset].setValue(offSetAmount.toString())}var publishingDateTimeControl=formContext.getControl(AppCommon.PublishDateTimeControlId);if(publishingDateTimeControl!=null&&publishingDateTimeControl.getVisible()){var getPublishingdate=publishingDateTimeControl.getAttribute();if(getPublishingdate==null||getPublishingdate.getValue()==null){var alertStrings={text:""};alertStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Publish_PublishingDate);var dialogOptions=_this.getAlertDilaogOptionsForError();Xrm.Navigation.openAlertDialog(alertStrings,dialogOptions);return}}var expirationDateTimeControl=formContext.getControl(AppCommon.ExpirationDateControlId);if(expirationDateTimeControl!=null){var getExpirationdatetime=expirationDateTimeControl.getAttribute().getValue();if(getExpirationdatetime!=null){var expirationStateId=formContext.getControl(AppCommon.ExpirationStateControlId),expirationOptions=expirationStateId.getAttribute();if(expirationStateId!=null)if(!(expirationStateId==null&&expirationOptions==null)&&expirationOptions.getSelectedOption()==null){var alertStrings={text:""};alertStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Publish_ExpirationStateText);var dialogOptions=_this.getAlertDilaogOptionsForError();Xrm.Navigation.openAlertDialog(alertStrings,dialogOptions);return}var expirationStatusId=formContext.getControl(AppCommon.ExpirationStatusControlId),expirationStatusOptions=expirationStatusId.getAttribute();if(!(expirationStatusId==null&&expirationStatusOptions==null)&&expirationStatusOptions.getSelectedOption()==null){var alertStrings={text:""};alertStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_Publish_ExpirationStatusText);var dialogOptions=_this.getAlertDilaogOptionsForError();Xrm.Navigation.openAlertDialog(alertStrings,dialogOptions);return}}}if(!AppCommon.KnowledgeArticle.PublishCommands.validateDateTime(formContext))return;formContext.data.attributes.get(AppCommon.ParamIsBulkPublishAction).getValue()==false&&AppCommon.KnowledgeArticle.PublishCommands.setScheduledVersion(formContext,dialogParams);formContext.data.attributes.get(AppCommon.ParamIsBulkPublishAction).getValue()==true&&formContext.ui.close()};this.cancelDialog=function(eventContext){var formContext=AppCommon.KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogCancelId);formContext.ui.close();formContext.ui!=null&&formContext.ui.refreshRibbon()};this.validatePublishConfirmationDialog=function(formContext,confirmDialogStrings,dialogOptions){Xrm.Navigation.openConfirmDialog(confirmDialogStrings,dialogOptions).then(function(successParameter){successParameter.confirmed&&formContext.ui.close()})};this.publishArticleCallback=function(formContext,dialogParams,dialogOptions,gridControl){var isPrimary=dialogParams[AppCommon.ParamIsPrimary],records=dialogParams[AppCommon.ParamSelectedRecords],attributeValues={},attributeNames=[],attributeName,publishOptionSelected=dialogParams[AppCommon.PublishStatusControlId];if(publishOptionSelected!=null&&publishOptionSelected==AppCommon.PublishDialogPublishPreference.InFuture){if(dialogParams[AppCommon.PublishDateTimeControlId]){attributeName=AppCommon.PubishonDateFormId;var selectedPublishDatetime=dialogParams[AppCommon.PublishDateTimeControlId];if(selectedPublishDatetime&&!isNaN(selectedPublishDatetime)&&dialogParams[AppCommon.ParamDateTimeFixOffset])selectedPublishDatetime=new Date(selectedPublishDatetime.getTime()+parseInt(dialogParams[AppCommon.ParamDateTimeFixOffset],10));attributeValues[AppCommon.PubishonDateFormId]=selectedPublishDatetime;attributeNames[attributeNames.length]=attributeName;if(dialogParams[AppCommon.PublishedStatusControlId]){var publishedstatus_id=parseInt(dialogParams[AppCommon.PublishedStatusControlId]);attributeName=AppCommon.PublishStatusFormId;attributeValues[attributeName]=publishedstatus_id;attributeNames[attributeNames.length]=attributeName}attributeName=AppCommon.StateCode;attributeValues[attributeName]=AppCommon.KnowledgeArticleFormState.Scheduled;attributeNames[attributeNames.length]=attributeName;if(dialogParams[AppCommon.ScheduledStatusControlId]){attributeName=AppCommon.StatusCode;attributeValues[attributeName]=dialogParams[AppCommon.ScheduledStatusControlId];attributeNames[attributeNames.length]=attributeName}}}else{attributeName=AppCommon.StateCode;attributeValues[attributeName]=AppCommon.KnowledgeArticleFormState.Published;attributeNames[attributeNames.length]=attributeName;if(dialogParams[AppCommon.PublishedStatusControlId]){attributeName=AppCommon.StatusCode;attributeValues[attributeName]=dialogParams[AppCommon.PublishedStatusControlId];attributeNames[attributeNames.length]=attributeName}}if(dialogParams[AppCommon.ExpirationDateControlId]){attributeName=AppCommon.ExpirationDateFormId;var expirationdate_id=dialogParams[AppCommon.ExpirationDateControlId];if(expirationdate_id&&!isNaN(expirationdate_id)&&dialogParams[AppCommon.ParamDateTimeFixOffset])expirationdate_id=new Date(expirationdate_id.getTime()+parseInt(dialogParams[AppCommon.ParamDateTimeFixOffset],10));attributeValues[attributeName]=expirationdate_id;attributeNames[attributeNames.length]=attributeName;if(dialogParams[AppCommon.ExpirationStateControlId]){var expirationStateId=parseInt(dialogParams[AppCommon.ExpirationStateControlId]);attributeName=AppCommon.ExpirationStateFormId;attributeValues[attributeName]=expirationStateId;attributeNames[attributeNames.length]=attributeName}if(dialogParams[AppCommon.ExpirationStatusControlId]){var expirationStatusId=parseInt(dialogParams[AppCommon.ExpirationStatusControlId]);attributeName=AppCommon.ExpirationStatusFormId;attributeValues[attributeName]=expirationStatusId;attributeNames[attributeNames.length]=attributeName}}if(!isPrimary){var parentArticleLookupAttribute=dialogParams[AppCommon.ParamParentArticleContentId];if(parentArticleLookupAttribute!=null)if(parentArticleLookupAttribute!=null&&parentArticleLookupAttribute.length>0){var parentArticleId=parentArticleLookupAttribute[0].id;attributeName=AppCommon.ParentarticleContentIdDataBindValue;attributeNames[attributeNames.length]=attributeName;var parentArticleIdValue=AppCommon.Knowledgearticles+"("+parentArticleId.replace(/[{}]/g,"")+")";attributeValues[attributeName]=parentArticleIdValue}}for(var isBulkPublishAction=dialogParams[AppCommon.ParamIsBulkPublishAction],bulkPublishActions=[],recordsToPublish=[],publishRelatedApprovedTranslations=false,copyProductsFromAssociatedPrimary=false,copyCategoriesFromAssociatedPrimary=false,_i=0,records_5=records;_i<records_5.length;_i++){var record=records_5[_i],knowledgeArticle={};knowledgeArticle[AppCommon.KnowledgeArticleId]=record.Id;knowledgeArticle[AppCommon.OdataType]=AppCommon.KnowledgeArticleOdataType;for(var _a=0,attributeNames_1=attributeNames;_a<attributeNames_1.length;_a++){var attribute=attributeNames_1[_a];knowledgeArticle[attribute]=attributeValues[attribute]}if(dialogParams[AppCommon.ApproveRelatedControlId]!=null)publishRelatedApprovedTranslations=dialogParams[AppCommon.ApproveRelatedControlId]==1?true:false;if(dialogParams[AppCommon.CopyRelatedControlId]!=null)copyProductsFromAssociatedPrimary=dialogParams[AppCommon.CopyRelatedControlId]==1?true:false;if(dialogParams[AppCommon.CopyRelatedCategoryControlId]!=null)copyCategoriesFromAssociatedPrimary=dialogParams[AppCommon.CopyRelatedCategoryControlId]==1?true:false;if(isBulkPublishAction){Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));recordsToPublish.push(knowledgeArticle)}else{Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var Entity,CopyRelatedProductFromAssociatedPrimary,CopyRelatedCategoryFromAssociatedPrimary,PublishApprovedRelatedTranslations,request=new AppCommon.PublishKnowledgeArticleODataContract(Entity,CopyRelatedProductFromAssociatedPrimary,CopyRelatedCategoryFromAssociatedPrimary,PublishApprovedRelatedTranslations);request.Entity=knowledgeArticle;if(isPrimary){request.CopyRelatedProductFromAssociatedPrimary=false;request.CopyRelatedCategoryFromAssociatedPrimary=false;request.PublishApprovedRelatedTranslations=publishRelatedApprovedTranslations}else{request.CopyRelatedProductFromAssociatedPrimary=copyProductsFromAssociatedPrimary;request.CopyRelatedCategoryFromAssociatedPrimary=copyCategoriesFromAssociatedPrimary;request.PublishApprovedRelatedTranslations=false}Xrm.WebApi.online.execute(request).then(function(response){Xrm.Utility.closeProgressIndicator();if(response&&response.ok){var screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();if(publishOptionSelected==AppCommon.PublishDialogPublishPreference.Now)AppCommon.KnowledgeArticleUtility.reportEvent(knowledgeArticle[AppCommon.KnowledgeArticleId],AppCommon.KnowledgeArticleFormState.Published,AppCommon.KnowledgeArticleFormStatus.Published,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Publish);else publishOptionSelected==AppCommon.PublishDialogPublishPreference.InFuture&&AppCommon.KnowledgeArticleUtility.reportEvent(knowledgeArticle[AppCommon.KnowledgeArticleId],AppCommon.KnowledgeArticleFormState.Scheduled,AppCommon.KnowledgeArticleFormStatus.Scheduled,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleFormRibbonCommands.Publish);AppCommon.KnowledgeArticle.CommandActions.refreshForm()}},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}}AppCommon.KnowledgeArticle.PublishCommands.chainPublishAction(recordsToPublish,0,copyProductsFromAssociatedPrimary,copyCategoriesFromAssociatedPrimary,publishRelatedApprovedTranslations,gridControl)};this.chainPublishAction=function(recordsToPublish,currentIndex,copyRelatedProductFromAssociatedPrimary,copyRelatedCategoryFromAssociatedPrimary,publishApprovedRelatedTranslations,gridControl){if(recordsToPublish.length>currentIndex){var Entity,CopyRelatedProductFromAssociatedPrimary,CopyRelatedCategoryFromAssociatedPrimary,PublishApprovedRelatedTranslations,request=new AppCommon.PublishKnowledgeArticleODataContract(Entity,CopyRelatedProductFromAssociatedPrimary,CopyRelatedCategoryFromAssociatedPrimary,PublishApprovedRelatedTranslations);request.Entity=recordsToPublish[currentIndex];request.CopyRelatedProductFromAssociatedPrimary=copyRelatedProductFromAssociatedPrimary;request.CopyRelatedCategoryFromAssociatedPrimary=copyRelatedCategoryFromAssociatedPrimary;request.PublishApprovedRelatedTranslations=publishApprovedRelatedTranslations;Xrm.WebApi.online.execute(request).then(function(response){Xrm.Utility.closeProgressIndicator();response&&response.ok&&AppCommon.KnowledgeArticle.PublishCommands.chainPublishAction(recordsToPublish,currentIndex+1,copyRelatedProductFromAssociatedPrimary,copyRelatedCategoryFromAssociatedPrimary,publishApprovedRelatedTranslations,gridControl)},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}else{Xrm.Utility.closeProgressIndicator();if(gridControl!=null){for(var result="",_i=0,recordsToPublish_1=recordsToPublish;_i<recordsToPublish_1.length;_i++){var record=recordsToPublish_1[_i];result+=record[AppCommon.KnowledgeArticleId]+", "}var articleIds=result.substring(0,result.length-2),screenDimensions=AppCommon.KnowledgeArticleUtility.getScreenDimensions();AppCommon.KnowledgeArticleUtility.reportEvent(articleIds,AppCommon.DefaultStateCode,AppCommon.DefaultStatusCode,screenDimensions.width,screenDimensions.height,AppCommon.KnowledgeArticleGridRibbonCommands.Publish);gridControl.refresh()}}};this.setScheduledVersion=function(formContext,dialogParams){var articlePublicNumber=formContext.data.attributes.get(AppCommon.ParamArticlePublicNumber).getValue(),languagelocale=formContext.data.attributes.get(AppCommon.ParamLanguageLocaleId).getValue(),languagelocaleid=languagelocale[0].id,majorVersionNumber=formContext.data.attributes.get(AppCommon.ParamMajorVersionNumber).getValue(),minorVersionNumber=formContext.data.attributes.get(AppCommon.ParamMinorVersionNumber).getValue(),fetchXml="?fetchXml=<fetch version='1.0' mapping='logical'><entity name='knowledgearticle'><attribute name='knowledgearticleid' /><filter type='and'><condition attribute='articlepublicnumber' operator='eq' value='"+articlePublicNumber+"' /><condition attribute='languagelocaleid' operator='eq' value='"+languagelocaleid+"' /><condition attribute='statecode' operator='eq' value='"+AppCommon.KnowledgeArticleFormState.Published+"' /><filter type='or'><condition attribute='majorversionnumber' operator='gt' value='"+majorVersionNumber+"' /><filter type='and'><condition attribute='majorversionnumber' operator='eq' value='"+majorVersionNumber+"' /><condition attribute='minorversionnumber' operator='gt' value='"+minorVersionNumber+"' /></filter></filter></filter></entity></fetch>",collection=[];Xrm.Utility.showProgressIndicator(Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog));var confirmDialogStrings={text:""},dialogOptions={height:300,width:400,position:1};Xrm.WebApi.retrieveMultipleRecords(AppCommon.KnowledgeArticleEntity,fetchXml).then(function(response){Xrm.Utility.closeProgressIndicator();if(response!=null)if(response.entities.length!=0){confirmDialogStrings.title=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ChkPublish_Confirmation_DialogTitle);confirmDialogStrings.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ChkPublish_Confirmation_DialogText);AppCommon.KnowledgeArticle.PublishCommands.validatePublishConfirmationDialog(formContext,confirmDialogStrings,dialogOptions)}else formContext.ui.close()},AppCommon.KnowledgeArticleUtility.actionFailedCallbackForMoca)}}KnowledgeArticlePublishCommands.prototype.validateDateTime=function(formContext){var isValidDateTime=true,publishedStatusId=formContext.getControl(AppCommon.PublishStatusControlId),publishOptions=publishedStatusId.getAttribute(),expirationDateTimeControl=formContext.getControl(AppCommon.ExpirationDateControlId),getExpirationdatetime=expirationDateTimeControl.getAttribute(),publishDateTimeControl=formContext.getControl(AppCommon.PublishDateTimeControlId),getpublishdatetime=publishDateTimeControl.getAttribute();if(!AppCommon.KnowledgeArticle.PublishCommands.IsExpireDateValid(formContext,getExpirationdatetime,getpublishdatetime)){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_ExpireOn_DialogText);var options=this.getAlertDilaogOptionsForError();Xrm.Navigation.openAlertDialog(alert,options);isValidDateTime=false;return isValidDateTime}if(publishOptions.getSelectedOption().value==1&&getpublishdatetime!=null&&getpublishdatetime.getValue()!=null&&getpublishdatetime.getValue()<=AppCommon.KnowledgeArticle.PublishCommands.localDateTimeNow(formContext)){var alert={text:""};alert.text=Xrm.Utility.getResourceString(AppCommon.WebResourceName,AppCommon.KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_PublishingDateTimeMessage);var options=this.getAlertDilaogOptionsForError();Xrm.Navigation.openAlertDialog(alert,options);isValidDateTime=false;return isValidDateTime}return isValidDateTime};KnowledgeArticlePublishCommands.prototype.localDateTimeNow=function(formContext){var now=new Date;now.setMinutes(now.getMinutes()+now.getTimezoneOffset()+formContext.context.userSettings.getTimeZoneOffsetMinutes());return now};KnowledgeArticlePublishCommands.prototype.IsExpireDateValid=function(formContext,expirationDateTime,publishDateTime){if(expirationDateTime.getValue()!=null&&(expirationDateTime.getValue()<=AppCommon.KnowledgeArticle.PublishCommands.localDateTimeNow(formContext)||publishDateTime!=null&&publishDateTime.getValue()!=null&&expirationDateTime.getValue()<=publishDateTime.getValue()))return false;else return true};KnowledgeArticlePublishCommands.prototype.getAlertDilaogOptionsForError=function(){var options={height:150,width:600,position:1};return options};return KnowledgeArticlePublishCommands}();AppCommon.KnowledgeArticlePublishCommands=KnowledgeArticlePublishCommands})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticle=function(){function KnowledgeArticle(){}KnowledgeArticle.Instance=new AppCommon.KnowledgeArticleMainSystemLibraryWebResource;KnowledgeArticle.GridCommandActions=new AppCommon.KnowledgeArticleGridCommandActions;KnowledgeArticle.CommandActions=new AppCommon.KnowledgeArticleCommandActions;KnowledgeArticle.PublishCommands=new AppCommon.KnowledgeArticlePublishCommands;return KnowledgeArticle}();AppCommon.KnowledgeArticle=KnowledgeArticle})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){var KnowledgeArticleUtility=function(){function KnowledgeArticleUtility(){}KnowledgeArticleUtility.getFormContext=function(eventContext){var formContext;if(eventContext==undefined&&eventContext==null)return formContext=Xrm.Page;else return formContext=eventContext.getFormContext()};KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogTitle="KnowledgeArticle_Approve_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_Approve_Confirmation_DialogText="KnowledgeArticle_Approve_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_Discard_Confirmation_DialogTitle="KnowledgeArticle_Discard_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_Discard_Confirmation_DialogText="KnowledgeArticle_Discard_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_RevertToDraft_Confirmation_DialogTitle="KnowledgeArticle_RevertToDraft_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_RevertToDraft_Confirmation_DialogText="KnowledgeArticle_RevertToDraft_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_Save_PublishedStatus_Notification_DialogText="KnowledgeArticle_Save_PublishedStatus_Notification_DialogText";KnowledgeArticleUtility.Msg_Progress_MOCA_Dialog="Msg_Progress_MOCA_Dialog";KnowledgeArticleUtility.KnowledgeArticle_Archive_Confirmation_DialogTitle="KnowledgeArticle_Archive_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_Archive_Confirmation_DialogText="KnowledgeArticle_Archive_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkApprove_Confirmation_DialogTitle="KnowledgeArticle_BulkApprove_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkApprove_Confirmation_DialogText="KnowledgeArticle_BulkApprove_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkArchive_Confirmation_DialogTitle="KnowledgeArticle_BulkArchive_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkArchive_Confirmation_DialogText="KnowledgeArticle_BulkArchive_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkDiscard_Confirmation_DialogTitle="KnowledgeArticle_BulkDiscard_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkDiscard_Confirmation_DialogText="KnowledgeArticle_BulkDiscard_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogTitle="KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogText="KnowledgeArticle_BulkRevertToDraft_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_SaveBlockMessage="KnowledgeArticle_PublishDialog_SaveBlockMessage";KnowledgeArticleUtility.KnowledgeArticle_Notify_Readonly="KnowledgeArticle_Notify_Readonly";KnowledgeArticleUtility.KnowledgeArticle_Update_Confirmation_DialogTitle="KnowledgeArticle_Update_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_Update_Confirmation_DialogText="KnowledgeArticle_Update_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_Restore_Confirmation_DialogTitle="KnowledgeArticle_Restore_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_Restore_Confirmation_DialogText="KnowledgeArticle_Restore_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkMajor_Confirmation_DialogTitle="KnowledgeArticle_BulkMajor_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkMajor_Confirmation_DialogText="KnowledgeArticle_BulkMajor_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkMinor_Confirmation_DialogTitle="KnowledgeArticle_BulkMinor_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkMinor_Confirmation_DialogText="KnowledgeArticle_BulkMinor_Confirmation_DialogText";KnowledgeArticleUtility.Create_Major_Confirmation_DialogTitle="Create_Major_Confirmation_DialogTitle";KnowledgeArticleUtility.Create_Minor_Confirmation_DialogTitle="Create_Minor_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_CreateMajor_Confirmation_DialogText="KnowledgeArticle_CreateMajor_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_CreateMinor_Confirmation_DialogText="KnowledgeArticle_CreateMinor_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_AssociateArticleArticle_DialogText="KnowledgeArticle_AssociateArticleArticle_DialogText";KnowledgeArticleUtility.KnowledgeArticle_AssociateArticleCategory_DialogText="KnowledgeArticle_AssociateArticleCategory_DialogText";KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_TranslateLanguageMessage="KnowledgeArticle_TranslateDialog_TranslateLanguageMessage";KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_LatestVersion="KnowledgeArticle_TranslateDialog_LatestVersion";KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_MajorVersion="KnowledgeArticle_TranslateDialog_MajorVersion";KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_MinorVersion="KnowledgeArticle_TranslateDialog_MinorVersion";KnowledgeArticleUtility.KnowledgeArticle_TranslateDialog_NoTranslations="KnowledgeArticle_TranslateDialog_NoTranslations";KnowledgeArticleUtility.KnowledgeArticle_Publish_PublishingDate="KnowledgeArticle_Publish_PublishingDate";KnowledgeArticleUtility.KnowledgeArticle_Publish_ExpirationStateText="KnowledgeArticle_Publish_ExpirationStateText";KnowledgeArticleUtility.KnowledgeArticle_Publish_ExpirationStatusText="KnowledgeArticle_Publish_ExpirationStatusText";KnowledgeArticleUtility.KnowledgeArticle_ChkPublish_Confirmation_DialogTitle="KnowledgeArticle_ChkPublish_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_ChkPublish_Confirmation_DialogText="KnowledgeArticle_ChkPublish_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_ExpireOn_DialogText="KnowledgeArticle_ExpireOn_DialogText";KnowledgeArticleUtility.KnowledgeArticle_PublishDialog_PublishingDateTimeMessage="KnowledgeArticle_PublishDialog_PublishingDateTimeMessage";KnowledgeArticleUtility.KnowledgeArticle_Reject_Note_Title="KnowledgeArticle_Reject_Note_Title";KnowledgeArticleUtility.KnowledgeArticle_ReviewRejectReason_DialogText="KnowledgeArticle_ReviewRejectReason_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkMarkInternal_Confirmation_DialogTitle="KnowledgeArticle_BulkMarkInternal_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkMarkInternal_Confirmation_DialogText="KnowledgeArticle_BulkMarkInternal_Confirmation_DialogText";KnowledgeArticleUtility.KnowledgeArticle_BulkMarkExternal_Confirmation_DialogTitle="KnowledgeArticle_BulkMarkExternal_Confirmation_DialogTitle";KnowledgeArticleUtility.KnowledgeArticle_BulkMarkExternal_Confirmation_DialogText="KnowledgeArticle_BulkMarkExternal_Confirmation_DialogText";KnowledgeArticleUtility.closeDialog=function(eventContext){var formContext=KnowledgeArticleUtility.getFormContext(eventContext);AppCommon.KnowledgeArticle.PublishCommands.setLastButtonClicked(formContext,AppCommon.DialogCancelId);formContext.ui.close()};KnowledgeArticleUtility.getRibbonCommandId=function(stateCode){switch(stateCode){case KnowledgeArticleFormState.Approved:return KnowledgeArticleFormRibbonCommands.Approve;case KnowledgeArticleFormState.Archived:return KnowledgeArticleFormRibbonCommands.Archive;case KnowledgeArticleFormState.Discarded:return KnowledgeArticleFormRibbonCommands.Discard;case KnowledgeArticleFormState.Draft:return KnowledgeArticleFormRibbonCommands.RevertToDraft}};KnowledgeArticleUtility.reportEvent=function(articleId,state,status,screenWidth,screenHeight,ribbonCommandId){if(!ribbonCommandId)ribbonCommandId=KnowledgeArticleUtility.getRibbonCommandId(state);var event=new AppCommon.KnowledgeArticleRibbonActions(articleId,state,status,screenWidth,screenHeight,ribbonCommandId);Xrm.Reporting.reportEvent(event)};KnowledgeArticleUtility.getScreenDimensions=function(){var screenWidth=window.screen.width,screenHeight=window.screen.height,screenDimensions={width:screenWidth,height:screenHeight};return screenDimensions};KnowledgeArticleUtility.actionFailedCallbackForMoca=function(response){Xrm.Utility.closeProgressIndicator();KnowledgeArticleUtility.actionFailedCallback(response)};KnowledgeArticleUtility.actionFailedCallback=function(errorResponse){if(errorResponse){var dialogOptions={errorCode:errorResponse.errorCode,message:errorResponse.message};Xrm.Navigation.openErrorDialog(dialogOptions)}};return KnowledgeArticleUtility}();AppCommon.KnowledgeArticleUtility=KnowledgeArticleUtility;(function(PublishDialogPublishPreference){PublishDialogPublishPreference[PublishDialogPublishPreference["Now"]=0]="Now";PublishDialogPublishPreference[PublishDialogPublishPreference["InFuture"]=1]="InFuture"})(AppCommon.PublishDialogPublishPreference||(AppCommon.PublishDialogPublishPreference={}));var PublishDialogPublishPreference=AppCommon.PublishDialogPublishPreference;(function(KnowledgeArticleFormState){KnowledgeArticleFormState[KnowledgeArticleFormState["Draft"]=0]="Draft";KnowledgeArticleFormState[KnowledgeArticleFormState["Approved"]=1]="Approved";KnowledgeArticleFormState[KnowledgeArticleFormState["Scheduled"]=2]="Scheduled";KnowledgeArticleFormState[KnowledgeArticleFormState["Published"]=3]="Published";KnowledgeArticleFormState[KnowledgeArticleFormState["Expired"]=4]="Expired";KnowledgeArticleFormState[KnowledgeArticleFormState["Archived"]=5]="Archived";KnowledgeArticleFormState[KnowledgeArticleFormState["Discarded"]=6]="Discarded"})(AppCommon.KnowledgeArticleFormState||(AppCommon.KnowledgeArticleFormState={}));var KnowledgeArticleFormState=AppCommon.KnowledgeArticleFormState;(function(KnowledgeArticleFormStatus){KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Draft"]=1]="Draft";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Approved"]=5]="Approved";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Scheduled"]=6]="Scheduled";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Published"]=7]="Published";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Expired"]=10]="Expired";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Archived"]=12]="Archived";KnowledgeArticleFormStatus[KnowledgeArticleFormStatus["Discarded"]=13]="Discarded"})(AppCommon.KnowledgeArticleFormStatus||(AppCommon.KnowledgeArticleFormStatus={}));var KnowledgeArticleFormStatus=AppCommon.KnowledgeArticleFormStatus,KnowledgeArticleFormRibbonCommands=function(){function KnowledgeArticleFormRibbonCommands(){}KnowledgeArticleFormRibbonCommands.Approve="Mscrm.Form.KnowledgeArticle.Approve";KnowledgeArticleFormRibbonCommands.Archive="Mscrm.Form.KnowledgeArticle.Archive";KnowledgeArticleFormRibbonCommands.Discard="Mscrm.Form.KnowledgeArticle.Discard";KnowledgeArticleFormRibbonCommands.MarkInternal="Mscrm.Form.KnowledgeArticle.MarkInternal";KnowledgeArticleFormRibbonCommands.MarkExternal="Mscrm.Form.KnowledgeArticle.MarkExternal";KnowledgeArticleFormRibbonCommands.Major="Mscrm.Form.KnowledgeArticle.Major";KnowledgeArticleFormRibbonCommands.Minor="Mscrm.Form.KnowledgeArticle.Minor";KnowledgeArticleFormRibbonCommands.Publish="Mscrm.Form.KnowledgeArticle.Publish";KnowledgeArticleFormRibbonCommands.RelateArticle="Mscrm.Form.KnowledgeArticle.RelateArticle";KnowledgeArticleFormRibbonCommands.RelateCategory="Mscrm.Form.KnowledgeArticle.RelateCategory";KnowledgeArticleFormRibbonCommands.Restore="Mscrm.Form.knowledgearticle.Restore";KnowledgeArticleFormRibbonCommands.RevertToDraft="Mscrm.Form.KnowledgeArticle.RevertToDraft";KnowledgeArticleFormRibbonCommands.Translate="Mscrm.Form.KnowledgeArticle.Translate";KnowledgeArticleFormRibbonCommands.Update="Mscrm.Form.KnowledgeArticle.Update";return KnowledgeArticleFormRibbonCommands}();AppCommon.KnowledgeArticleFormRibbonCommands=KnowledgeArticleFormRibbonCommands;var KnowledgeArticleGridRibbonCommands=function(){function KnowledgeArticleGridRibbonCommands(){}KnowledgeArticleGridRibbonCommands.Approve="Mscrm.HomepageGrid.KnowledgeArticle.Approve";KnowledgeArticleGridRibbonCommands.Archive="Mscrm.HomepageGrid.KnowledgeArticle.Archive";KnowledgeArticleGridRibbonCommands.Discard="Mscrm.HomepageGrid.KnowledgeArticle.Discard";KnowledgeArticleGridRibbonCommands.MarkInternal="Mscrm.HomepageGrid.KnowledgeArticle.MarkInternal";KnowledgeArticleGridRibbonCommands.MarkExternal="Mscrm.HomepageGrid.KnowledgeArticle.MarkExternal";KnowledgeArticleGridRibbonCommands.Major="Mscrm.HomepageGrid.KnowledgeArticle.Major";KnowledgeArticleGridRibbonCommands.Minor="Mscrm.HomepageGrid.KnowledgeArticle.Minor";KnowledgeArticleGridRibbonCommands.Publish="Mscrm.HomepageGrid.KnowledgeArticle.Publish";KnowledgeArticleGridRibbonCommands.Restore="Mscrm.HomepageGrid.knowledgearticle.Restore";KnowledgeArticleGridRibbonCommands.RevertToDraft="Mscrm.HomepageGrid.KnowledgeArticle.RevertToDraft";return KnowledgeArticleGridRibbonCommands}();AppCommon.KnowledgeArticleGridRibbonCommands=KnowledgeArticleGridRibbonCommands;(function(KnowledgeArticleReviewState){KnowledgeArticleReviewState[KnowledgeArticleReviewState["Approved"]=0]="Approved";KnowledgeArticleReviewState[KnowledgeArticleReviewState["Rejected"]=1]="Rejected"})(AppCommon.KnowledgeArticleReviewState||(AppCommon.KnowledgeArticleReviewState={}));var KnowledgeArticleReviewState=AppCommon.KnowledgeArticleReviewState;(function(KnowledgeArticleExpiredReviewState){KnowledgeArticleExpiredReviewState[KnowledgeArticleExpiredReviewState["NeedsUpdating"]=0]="NeedsUpdating";KnowledgeArticleExpiredReviewState[KnowledgeArticleExpiredReviewState["Republish"]=1]="Republish";KnowledgeArticleExpiredReviewState[KnowledgeArticleExpiredReviewState["Archive"]=2]="Archive"})(AppCommon.KnowledgeArticleExpiredReviewState||(AppCommon.KnowledgeArticleExpiredReviewState={}));var KnowledgeArticleExpiredReviewState=AppCommon.KnowledgeArticleExpiredReviewState;(function(MarkInternalExternalSelectVersions){MarkInternalExternalSelectVersions[MarkInternalExternalSelectVersions["ThisVersionOnly"]=0]="ThisVersionOnly";MarkInternalExternalSelectVersions[MarkInternalExternalSelectVersions["AllVersionsAndtranslations"]=1]="AllVersionsAndtranslations"})(AppCommon.MarkInternalExternalSelectVersions||(AppCommon.MarkInternalExternalSelectVersions={}));var MarkInternalExternalSelectVersions=AppCommon.MarkInternalExternalSelectVersions;(function(TranslateDialogVersionPreference){TranslateDialogVersionPreference[TranslateDialogVersionPreference["Major"]=0]="Major";TranslateDialogVersionPreference[TranslateDialogVersionPreference["Minor"]=1]="Minor"})(AppCommon.TranslateDialogVersionPreference||(AppCommon.TranslateDialogVersionPreference={}));var TranslateDialogVersionPreference=AppCommon.TranslateDialogVersionPreference;(function(ODataStructuralProperty){ODataStructuralProperty[ODataStructuralProperty["Unknown"]=0]="Unknown";ODataStructuralProperty[ODataStructuralProperty["PrimitiveType"]=1]="PrimitiveType";ODataStructuralProperty[ODataStructuralProperty["ComplexType"]=2]="ComplexType";ODataStructuralProperty[ODataStructuralProperty["EnumerationType"]=3]="EnumerationType";ODataStructuralProperty[ODataStructuralProperty["Collection"]=4]="Collection";ODataStructuralProperty[ODataStructuralProperty["EntityType"]=5]="EntityType"})(AppCommon.ODataStructuralProperty||(AppCommon.ODataStructuralProperty={}));var ODataStructuralProperty=AppCommon.ODataStructuralProperty;(function(ODataOperationType){ODataOperationType[ODataOperationType["Action"]=0]="Action";ODataOperationType[ODataOperationType["Function"]=1]="Function";ODataOperationType[ODataOperationType["CRUD"]=2]="CRUD"})(AppCommon.ODataOperationType||(AppCommon.ODataOperationType={}));var ODataOperationType=AppCommon.ODataOperationType;(function(OwnershipTypes){OwnershipTypes[OwnershipTypes["None"]=0]="None";OwnershipTypes[OwnershipTypes["UserOwned"]=1]="UserOwned";OwnershipTypes[OwnershipTypes["TeamOwned"]=2]="TeamOwned";OwnershipTypes[OwnershipTypes["BusinessOwned"]=4]="BusinessOwned";OwnershipTypes[OwnershipTypes["OrganizationOwned"]=8]="OrganizationOwned";OwnershipTypes[OwnershipTypes["BusinessParented"]=16]="BusinessParented"})(AppCommon.OwnershipTypes||(AppCommon.OwnershipTypes={}));var OwnershipTypes=AppCommon.OwnershipTypes,StringUtil=function(){function StringUtil(){}StringUtil.format=function(format){for(var args=[],_i=1;_i<arguments.length;_i++)args[_i-1]=arguments[_i];for(var returnValue=format,i=1;i<arguments.length;i++){var actualValue=typeof arguments[i]=="undefined"||arguments[i]==null?"":arguments[i].toString();returnValue=returnValue.replace(new RegExp("\\{"+(i-1)+"\\}","g"),actualValue)}return returnValue};return StringUtil}();AppCommon.StringUtil=StringUtil})(AppCommon||(AppCommon={}));var AppCommon;(function(AppCommon){"use strict";var KnowledgeArticleRibbon="uciknowledgearticleribbonactions",KnowledgeArticleRibbonActions=function(){function KnowledgeArticleRibbonActions(articleId,stateId,statusId,screenWidth,screenHeight,ribbonCommandId){this.eventName=KnowledgeArticleRibbon;this.eventParameters=[{name:"articleId",value:articleId},{name:"stateId",value:stateId},{name:"statusId",value:statusId},{name:"screenWidth",value:screenWidth},{name:"screenHeight",value:screenHeight},{name:"ribbonCommandId",value:ribbonCommandId}]}return KnowledgeArticleRibbonActions}();AppCommon.KnowledgeArticleRibbonActions=KnowledgeArticleRibbonActions})(AppCommon||(AppCommon={}))