Type.registerNamespace("Microsoft.Crm.Client.Core.Offline");Microsoft.Crm.Client.Core.Offline.$FY=function(){};Microsoft.Crm.Client.Core.Offline.$FY.registerInterface("Microsoft.Crm.Client.Core.Offline.$FY");Microsoft.Crm.Client.Core.Offline.$FZ=function(){};Microsoft.Crm.Client.Core.Offline.$FZ.registerInterface("Microsoft.Crm.Client.Core.Offline.$FZ");Microsoft.Crm.Client.Core.Offline.$i=function(){};Microsoft.Crm.Client.Core.Offline.$i.$5t=function(n){return Xrm.Objects.AttributeType.toString(n)};Microsoft.Crm.Client.Core.Offline.$i.prototype={$2Z:function(){this.$2YU()},$2YU:function(){Microsoft.Crm.Client.Core.Offline.$i.$8U=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Microsoft.Crm.Client.Core.Offline.$Kh));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(21),new Microsoft.Crm.Client.Core.Offline.$Kh({attributelogicalname:String,entitylogicalname:String,attributetype:Xrm.Objects.AttributeType}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(1),new Microsoft.Crm.Client.Core.Offline.$Kh({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(6),new Microsoft.Crm.Client.Core.Offline.$Kh({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(9),new Microsoft.Crm.Client.Core.Offline.$Kh({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(13),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(12),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(0),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(11),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(2),new Microsoft.Crm.Client.Core.Offline.$Kh({"":Number}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(14),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(15),new Microsoft.Crm.Client.Core.Offline.$Kh({"":Microsoft.Crm.Client.Core.Framework.Guid}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(3),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(4),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(5),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(7),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(8),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(-1),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(10),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(16),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(17),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(18),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(19),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}));Microsoft.Crm.Client.Core.Offline.$i.$8U.set_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(20),new Microsoft.Crm.Client.Core.Offline.$Kh({"":String}))},$1bv:function(n){var t=Microsoft.Crm.Client.Core.Offline.$i.$5t(n);return!Microsoft.Crm.Client.Core.Framework.$3.$9(t)&&Microsoft.Crm.Client.Core.Offline.$i.$8U.$3F5(t)?Microsoft.Crm.Client.Core.Offline.$i.$8U.get_$R(t):null},$1bs:function(n){var t=Microsoft.Crm.Client.Core.Offline.$i.$5t(n);return!Microsoft.Crm.Client.Core.Framework.$3.$9(t)&&Microsoft.Crm.Client.Core.Offline.$i.$8U.$3F5(t)?Microsoft.Crm.Client.Core.Offline.$i.$8U.get_$R(t).$1XT:null},$2ek:function(n,t){return Microsoft.Crm.Client.Core.Offline.$i.$8U&&Microsoft.Crm.Client.Core.Offline.$i.$8U.$3F5(Microsoft.Crm.Client.Core.Offline.$i.$5t(n))?Microsoft.Crm.Client.Core.Offline.$i.$8U.get_$R(Microsoft.Crm.Client.Core.Offline.$i.$5t(n)).$jh.get_$R(t):null},$lK:function(n){switch(n){case 21:case 1:case 6:case 9:return!0;default:return!1}}};Microsoft.Crm.Client.Core.Offline.$v=function(){};Microsoft.Crm.Client.Core.Offline.$v.$2Z=function(n,t){Microsoft.Crm.Client.Core.Offline.$v.$CM=new Microsoft.Crm.Client.Core.Offline.$i;Microsoft.Crm.Client.Core.Offline.$v.$kO=new Microsoft.Crm.Client.Core.Offline.$5J;Microsoft.Crm.Client.Core.Offline.$v.$CM.$2Z();Microsoft.Crm.Client.Core.Offline.$v.$kO.$2Z(Microsoft.Crm.Client.Core.Offline.$v.$CM);Microsoft.Crm.Client.Core.Offline.$v.$276=new Microsoft.Crm.Client.Core.Offline.$25(Microsoft.Crm.Client.Core.Offline.$v.$CM);Microsoft.Crm.Client.Core.Offline.$v.$4V=n;Microsoft.Crm.Client.Core.Offline.$v.$1Q=t};Microsoft.Crm.Client.Core.Offline.$v.$2Wk=function(n,t){for(var v,f=n.$a.LogicalName,e=Microsoft.Crm.Client.Core.Offline.$v.$4V.$i(f),s=t,h=s.length,o=0;o<h;++o){var r=s[o],u=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(f,r),i={};switch(r){case"statecode":e.$KB&&(i.value=!$0.$0(u)&&!$0.$0(u.$CS)?u.$CS:0,n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1x.$2y(i),12));break;case"statuscode":if(e.$KB&&!$0.$0(n.getFieldObjectData("statecode"))){var c=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(f,"statecode"),l=n.getFieldObjectData("statecode").value,a=c.$6S.$21[l.toString()].$Xr;i.value=a;n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1x.$2y(i),13)}break;case"createdon":case"modifiedon":i[r]=new Date(Date.now());n.initializeValue(r,i[r],2);break;case"createdby":case"modifiedby":case"ownerid":(r!=="ownerid"||e.$v1===1)&&(i.id=Microsoft.Crm.Client.Core.Offline.$v.$1Q.$4Q.getObjectData(),i.logicalname="systemuser",i.name=Microsoft.Crm.Client.Core.Offline.$v.$1Q.$CD,v=$0.$0(u)?r==="ownerid"?9:6:u.$26,n.initializeValue(r,Xrm.Objects.EntityReference.createFromObjectData(i),6));break;default:u.$26!==11&&u.$26||(i.value=$0.$0(u.$CS)?u.$9h?1:0:u.$CS,n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1x.$2y(i),u.$26))}}return n};Microsoft.Crm.Client.Core.Offline.$v.$qZ=function(n,t,i,r){var u={},c={},p=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)),b=Microsoft.Crm.Client.Core.Offline.$v.$kO.$2g0(i.get_$2I(),t),l=Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),a=new String,v=n,o,f,s,h;for(o in v){f={key:o,value:v[o]};f.key===i.get_$ES()?l=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(f.value.toString().toUpperCase()):f.key===i.get_$Dn()&&(a=f.value);var e=f.key.split("!"),y=$0.$0(e[0])?"":e[0],w=e.length===2&&!$0.$0(e[1])?e[1]:"";Microsoft.Crm.Client.Core.Offline.$v.$2Wj(u,c,t[y],y,w.toLowerCase(),f.value,i.get_$2I())}return s=new Xrm.Objects.EntityReference(i.get_$2I(),l,a),i.$lQ&&"versionnumber"in u&&!$0.$0(u.versionnumber)&&s.setValue("RowVersion",u.versionnumber.toString()),u=Microsoft.Crm.Client.Core.Offline.$v.$2RZ(u,t),h=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(s,u,t,c,{},p),h.set_clientRetrieveOptions(r),h};Microsoft.Crm.Client.Core.Offline.$v.$2Wj=function(n,t,i,r,u,f,e){var l,a,o,c,s,h;if(Microsoft.Crm.Client.Core.Offline.$v.$1J7(i)&&(e!=="activityparty"||r!=="ownerid"))if(l=Microsoft.Crm.Client.Core.Offline.$v.$CM.$lK(i),a=Microsoft.Crm.Client.Core.Offline.$v.$CM.$2ek(i,u),l){r in n||(n[r]={});n[r][u]=a===Microsoft.Crm.Client.Core.Framework.Guid?!$0.$0(f)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(f.toString())?{rawguid:f.toString()}:null:f;switch(i){case 9:case 6:case 1:o=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(e,r);$0.$0(o)||$0.$0(o.$VN)||o.$VN.length!==1||(n[r].logicalname=o.$VN[0])}}else switch(i){case 11:case 12:case 13:case 0:$0.$0(f)?n[r]=null:(c="",s=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(e,r),!$0.$0(s)&&f.toString()in s.$6S.$21&&(c=s.$6S.$21[f.toString()].$1G),n[r]={value:Number.parseInvariant(f.toString()),label:c});break;case 15:n[r]=!$0.$0(f)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(f.toString())?{rawguid:f.toString()}:null;break;case 2:n[r]=!$0.$0(f)&&f.toString().length>0?Xrm.Soap.CrmDateTimeSerializer.$vA(f.toString()):null;break;case 20:$0.$0(f)?n[r]=null:(h=Microsoft.Crm.Client.Core.Offline.$v.$4V.$i(f.toString()),$0.$0(h)||(n[r]=h.$y,t[r]=h.$1q));break;default:n[r]=!$0.$0(f)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(f.toString())?f:null}};Microsoft.Crm.Client.Core.Offline.$v.$2RZ=function(n,t){var r={},f=n,u,i;for(u in f){i={key:u,value:f[u]};switch(t[i.key]){case 9:case 1:case 6:r[i.key]=$0.$0(i.value.id)?null:Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord.createSingleFieldFromObjectData(i.value,t[i.key]);break;default:r[i.key]=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord.createSingleFieldFromObjectData(i.value,t[i.key])}}return r};Microsoft.Crm.Client.Core.Offline.$v.$1J7=function(n){switch(n){case-1:case 3:case 4:case 5:case 7:case 8:case 14:case 15:case 18:case 9:case 1:case 6:case 2:case 11:case 12:case 13:case 0:case 20:return!0;default:return!1}};Microsoft.Crm.Client.Core.Offline.$v.$2xb=function(n,t,i,r,u){var c=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(Microsoft.Crm.Client.Core.Offline.$2C.get_$1Y4()),g,f,e,w,b,s,k,a,o,h,y;if(c.add("versionnumber"),c.remove("ownerid"),g=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),i===1){for(var p=n.get_fieldNames(),nt=p.length,l=0;l<nt;++l)if(f=p[l],!c.contains(f))if(e=t[f],$0.$0(e)||e!==6&&e!==1&&e!==9){if(!$0.$0(r[f])){if(e&&e!==11&&e!==12){if(e===13&&(a=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(n.$a.LogicalName,"statecode"),!$0.$0(a))){var tt=n.getValue("statecode").$1s,it=a.$6S.$21[tt.toString()].$Xr,rt=n.getValue(f).$1s;if(rt===it)continue}}else if(b=n.getValue(f).$1s,s=Microsoft.Crm.Client.Core.Offline.$v.$4V.$2q(n.$a.LogicalName,f),!$0.$0(s)&&(!$0.$0(s.$9h)||!$0.$0(s.$CS))&&(k=$0.$0(s.$CS)?s.$9h?1:0:s.$CS,k===b))continue;n.$4w.add(f)}}else w=Microsoft.Crm.Client.Core.Offline.$v.$2g8(f,r),$0.$0(w)||n.$4w.add(f)}else if(i===3)for(var d=n.get_fieldNames(),ut=d.length,v=0;v<ut;++v)o=d[v],c.contains(o)||(h=t[o],$0.$0(h)||h!==6&&h!==1&&h!==9?r[o]!==u[o]&&n.$4w.add(o):(y=o+"!id",r[y]!==u[y]&&n.$4w.add(o)));return n};Microsoft.Crm.Client.Core.Offline.$v.$2g8=function(n,t){var i=t[n+"!id"],r=t[n+"!logicalname"],u=t[n+"!name"];return!$0.$0(i)&&!$0.$0(r)?$0.$0(u)?new Xrm.Objects.EntityReference(r.toString(),i):new Xrm.Objects.EntityReference(r.toString(),i,u.toString()):null};Microsoft.Crm.Client.Core.Offline.$2K=function(){};Microsoft.Crm.Client.Core.Offline.$5J=function(){};Microsoft.Crm.Client.Core.Offline.$5J.prototype={$11Z:null,$2Z:function(n){this.$11Z=new(Microsoft.Crm.Client.Core.Framework.$AC.$$(Microsoft.Crm.Client.Core.Offline.$Kf))(1e4);Microsoft.Crm.Client.Core.Offline.$5J.$CM=n},$2XZ:function(){this.$11Z.$3F4()},$2g0:function(n,t){var h=this.$11Z.$3F3(n),r,u,i,f,s;if($0.$0(h))return this.$2RO(n,t);for(var a=this.$1zo(t),e=h.get_$R(0).$1CI,c=!1,l=a,v=l.length,o=0;o<v;++o)for(r=l[o],u=Microsoft.Crm.Client.Core.Offline.$5J.$CM.$1bs(t[r]),i=0;i<u.length;i++)f=r,u[i]!==""&&(f+="!"+u[i]),f in e||(c=!0,e[f]=r);return s=new Microsoft.Crm.Client.Core.Offline.$Kf(e),c&&this.$1qf(s,n),s},$2RO:function(n,t){for(var i,u,r,o,h=this.$1zo(t),f={},s=h,c=s.length,e=0;e<c;++e)for(i=s[e],u=Microsoft.Crm.Client.Core.Offline.$5J.$CM.$1bs(t[i]),r=0;r<u.length;r++)u[r]!==""?f[i+"!"+u[r]]=i:f[i]=i;return o=new Microsoft.Crm.Client.Core.Offline.$Kf(f),this.$1qf(o,n),o},$1qf:function(n,t){var i=new(Microsoft.Crm.Client.Core.Framework.$Z.$$(Microsoft.Crm.Client.Core.Offline.$Kf))(n);this.$11Z.$10E(t,i)},$1zo:function(n){var t=[],r=n,i,u;for(i in r)u={key:i,value:r[i]},t[t.length]=u.key;return t}};Microsoft.Crm.Client.Core.Offline.$Kh=function(n){this.$jh=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Type))(n);this.$1XT=this.$jh.get_$2ph()};Microsoft.Crm.Client.Core.Offline.$Kh.prototype={$1XT:null,$jh:null};Microsoft.Crm.Client.Core.Offline.$Kf=function(n){this.$1CI=n};Microsoft.Crm.Client.Core.Offline.$Kf.prototype={$1CI:null,$2NG:function(){return this.$1CI.toString().length}};Microsoft.Crm.Client.Core.Offline.$Kg=function(n,t){this.$1q2=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Objects.AttributeType))([17,10]);this.$1FE=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["activitypointer".toLowerCase()]);this.$4X=n;this.$F8=t;this.$RG=""};Microsoft.Crm.Client.Core.Offline.$Kg.prototype={$4X:null,$Hb:null,$RG:null,$F8:null,$2hl:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Object,Microsoft.Crm.Client.Core.Framework.$7),r=this,u=this;return this.$2NK(n,t).then(function(){r.$33t().then(function(){i.resolve(r.$Hb)},function(n){i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_CalculateMetadataMismatchEntities_Error",1032,"Calculation of offline disabled entities failed with error : "+n.$F);i.reject(n)}),i.promise()},$33t:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7);if(!$0.$0(this.$RG)&&!$0.$8J(this.$Hb)){var t=new Microsoft.Crm.Client.Core.Offline.$7J(this.$RG,this.$Hb),i=this,r=this;this.$4X.$bJ("offlinedisabledinfo",t.$20(),!1).then(function(){Microsoft.Crm.Client.Core.Framework.$8.$1E("OfflineMetadataManager_MetadataSchemaValidator",1032,"Successfully saved the offline disabled info as session state.");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,"Saving offline disabled info as session state failed with error : "+t.$F);n.reject()})}return n.promise()},$2NK:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),f,e,u,s,h,c,r,v,y;if(this.$Hb={},!$0.$1Y(n)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(n.userData)&&n.userData.split("#").length>1)if(this.$RG=t.toString(),f=n.userData.split("#"),f[0]===Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$vR&&f[1]===this.$RG)i.resolve(!0);else{e=[];u={};for(var l=n.tables,a=l.length,o=0;o<a;++o)s=l[o],u[s.name]=s;h=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$Ha;for(c in h)r={key:c,value:h[c]},r.key in u?Array.add(e,this.$2PS(u[r.key])):this.$1FE.contains(r.key)||(this.$Hb[r.key]=!0);v=this;y=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(){i.resolve(!0)},function(n){i.reject(n)})}else i.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Retrieved client model is corrupt or empty."));return i.promise()},$2PS:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i=this,r=this;return this.$4X.$5e(new Microsoft.Crm.Client.Core.Storage.DataApi.$5D(n.name),this.$F8).then(function(r){for(var o,u,h,f={},c=n.column,a=c.length,e=0;e<a;++e)o=c[e],f[o.name]=o.type;for(var l=r.$1mk(),v=l.length,s=0;s<v;++s)if(u=l[s],h=u.get_$4M()===6||u.get_$4M()===9||u.get_$4M()===1?u.get_$2I()+"!id":u.get_$2I(),!i.$1q2.contains(u.get_$4M())&&(!(h in f)||f[h]!==Microsoft.Crm.Client.Core.Offline.$AI.$2hh(u.get_$4M()))){i.$Hb[n.name]=!0;break}t.resolve().promise()},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,n.$F);t.reject().promise()}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$AI=function(){};Microsoft.Crm.Client.Core.Offline.$AI.$2hh=function(n){switch(n){case 1:case 6:case 7:case 9:case 14:case 15:case 20:return"text";case 4:return"real";case 8:case 3:return"fixed";case 2:return"datetime";case 18:case 5:case 0:case 11:case 12:case 13:case 19:return"integer";default:return""}};Microsoft.Crm.Client.Core.Offline.$7J=function(n,t){this.$RG=n;this.$Hb=t};Microsoft.Crm.Client.Core.Offline.$7J.$2y=function(n){var t="",i={};return $0.$0(n)||(Microsoft.Crm.Client.Core.Framework.$3.$9(n.metadataversionused.toString())||(t=n.metadataversionused.toString()),i=n.offlinedisabledentities),new Microsoft.Crm.Client.Core.Offline.$7J(t,i)};Microsoft.Crm.Client.Core.Offline.$7J.prototype={$RG:null,$Hb:null,$20:function(){var n={};return n.metadataversionused=this.$RG,n.offlinedisabledentities=this.$Hb,n}};Microsoft.Crm.Client.Core.Offline.$Ki=function(){this.$a3=!1;this.$ZR=!1;this.$Hb={}};Microsoft.Crm.Client.Core.Offline.$Ki.prototype={$gV:0,$gU:0,$dz:0,$4X:null,$F8:null,$ZR:!1,$a3:!1,$1JB:!1,$1DK:null,$Hb:null,$1gj:null,$1Ym:null,get_$1gi:function(){return this.$Hb},set_$1gi:function(n){var i,r,u,t;this.$Hb=n;i={};r=this.$Hb;for(u in r)t={key:u,value:r[u]},t.key in Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$1gh()&&(i[t.key]=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$1gh()[t.key]);return this.$1gj=i,this.$4X.get_$5a().get_$4K()&&this.$1D3(),n},get_$2sS:function(){return this.$1gj},get_$1DL:function(){return Number.parseInvariant(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$vR)},$2Z:function(n,t,i){this.$4X=t;this.$F8=i;this.$1Ym=n;this.$2EL();var r=this,u=this;this.$4X.$w3("offlinedisabledinfo").then(function(n){if(!$0.$0(n)){var t=Microsoft.Crm.Client.Core.Offline.$7J.$2y(n);r.set_$1gi(t.$Hb);Microsoft.Crm.Client.Core.Framework.$8.$1E("RetrieveSessionState_OfflineDisabledEntities_Success",1032,n.toString())}},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("RetrieveSessionState_OfflineDisabledEntities_Fail",1032,n.$F)})},$2yp:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i;return this.$ZR||n||this.$1JB?(i=this,this.$1qi().always(function(){t.resolve(!0)})):t.resolve(!1),t.promise()},$2kj:function(){this.$ZR&&!this.$a3&&this.$1Ym.$286(this,new Sys.EventArgs)},$2kh:function(){this.$ZR=!0},$2yX:function(n){this.$1JB=!0;this.$36o(n);this.$2El(n)&&this.$2OO()},$2kZ:function(n){var t,i,r;switch(n.$PR){case 0:case 1:case 5:case 3:case 2:case 6:case 4:this.$a3=!0;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as true. Stage : "+n.$PR);break;case 8:this.$ZR=!1;t=this;i=this;this.$2EL().always(function(){t.$1qj().always(function(){t.$a3=!1;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")})}).done(function(){i.$1D3()});break;case 7:r=this;this.$1qj().always(function(){r.$a3=!1;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")});break;case 9:this.$a3=!1;this.$ZR=!1;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")}},$1KE:function(){return this.$gV>this.get_$1DL()||this.$gU>this.$dz||this.$1eV()},$1qj:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return this.$38C().then(function(i){i?t.$1qi().always(function(){n.resolve()}):n.resolve()},function(){n.reject()}),n.promise()},$38C:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,i;return $0.$0(this.$4X)?n.resolve(!1).promise():(t=this,i=this,this.$4X.$w3("offlinedisabledinfo").then(function(i){if($0.$0(i))n.resolve(!0);else{var r=Microsoft.Crm.Client.Core.Offline.$7J.$2y(i);Microsoft.Crm.Client.Core.Framework.$3.$9(r.$RG)?n.resolve(!0):r.$RG===t.$dz.toString()?n.resolve(!1):n.resolve(!0)}},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_ShouldReCalculateAfterMetadataSync_Error",1032,"Retrieval of offline disabled info failed. Error: "+t.$F);n.reject()}),n.promise())},$1qi:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n,i;return Microsoft.Crm.Client.Core.Framework.$8.$1E("OfflineMetadataManager_CalculateDisabledOfflineEntities",1032,"Calculation of disabled offline entities started"),n=this,i=this,this.$21B().then(function(i){var r,u;!$0.$1Y(i)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(i.userData)&&i.userData.split("#").length>1?(r=i.userData.split("#"),n.$gV=Number.parseInvariant(r[0]),n.$gU=Number.parseInvariant(r[1]),u=new Microsoft.Crm.Client.Core.Offline.$Kg(n.$4X,n.$F8),u.$2hl(i,n.$dz).then(function(i){n.set_$1gi(i);n.$1JB=!1;t.resolve()},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataSync_CalculateDisabledOfflineEntities_Error",1032,n.$F);t.reject()})):t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Retrieved client model is corrupt or empty."))},function(n){t.reject(n)}),t.promise()},$2OO:function(){this.$gU===this.$dz&&this.$gV===this.get_$1DL()?this.$ZR=!1:(this.$ZR=!0,Microsoft.Crm.Client.Core.Framework.$8.$1E("OfflineMetadataManager_CheckIfMetadataSyncIsNeeded",1032,"Metadata updates available detected."))},$1D3:function(){var n=this;this.$2OX().done(function(t){t&&(Microsoft.Crm.Client.Core.Framework.$8.$1E("OfflineMetadataManager_CheckForMetadataOutofSyncForSyncStatus",1032,"Client Metadata Version: "+n.$dz+" Middleware Metadata Version: "+n.$gU+" Client Profile Version: "+n.get_$1DL()+" Middleware Profile Version: "+n.$gV),n.$dz!==n.$gU||n.get_$1DL()!==n.$gV||n.$1eV()?Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(2,3):Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(2))})},$2OX:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t;return this.$gV&&this.$gU?n.resolve(!0):(t=this,this.$21B().done(function(i){n.resolve(t.$2El(i))})),n.promise()},$2El:function(n){if($0.$0(n)||Microsoft.Crm.Client.Core.Framework.$3.$9(n.userData))Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_SetMiddlewareMetadataVersions_Error",1032,"Data model from middleware incomplete or corrupt.");else{var t=n.userData.split("#");if(!$0.$0(t)&&t.length>1)return this.$gV=Number.parseInvariant(t[0]),this.$gU=Number.parseInvariant(t[1]),Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_SetMiddlewareMetadataVersions",1032,"Middleware versions retrieved successfully."),!0;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_SetMiddlewareMetadataVersions_Error",1032,"Retrieval of Middleware versions failed.")}return!1},$2EL:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return this.$2ez().then(function(i){t.$dz=Number.parseInvariant(i);n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_SetClientMetadataVersion_Error",1032,t.$F);n.reject()}),n.promise()},$36o:function(n){var t=[],u;if(!$0.$0(n)&&!$0.$0(n.tables))for(var r=n.tables,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u.name.toString();this.$1DK=t},$2fk:function(n){try{return Sys.Serialization.JavaScriptSerializer.deserialize(n)}catch(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.message)}return null},$21B:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.NorsyncModel,Microsoft.Crm.Client.Core.Framework.$7),t=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(new Array(0)),i=this,r=this;return this.$4X.get_$5a().$1Om("_NORSYNC_SYSTEM_TABLE",t).then(function(t){if(!$0.$0(t)&&t.rows.length>0&&!$0.$0(t.rows.item(0).DATA_MODEL)){var r=t.rows.item(0).DATA_MODEL.toString(),u=i.$2fk(r);n.resolve(u)}else n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Error in the retrieved client model from offline db."))},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.$F);n.reject(t)}),n.promise()},$2ez:function(){var n=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),t,i;return $0.$0(this.$4X)?n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("parent datasource is null.")).promise():(t=this,i=this,this.$4X.$2C7().then(function(t){t.length>0?n.resolve(t.split("!")[0]).promise():n.reject()},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.$F);n.reject()}),n.promise())},$1eV:function(){return!Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s.$7K.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s.$7K.toString()!==Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString()?!0:!1}};Microsoft.Crm.Client.Core.Offline.$Kj=function(n,t){this.$jt=Microsoft.Crm.Client.Core.Framework.$3.$9(n)?Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString():n;this.$1Q=t;this.$gY=new Microsoft.Crm.Client.Core.Framework.Net.Uri(t.$1I.$15P);this.$do=Microsoft.Crm.Client.Core.Framework.AuthenticationManager.$C.get_$102();this.$7K=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString();this.$17Z=localStorage.getItem("MoCASessionID")};Microsoft.Crm.Client.Core.Offline.$Kj.prototype={$jt:null,$1Q:null,$7K:null,$do:null,$gY:null,$17Z:null,$2Oh:function(n){var i,t;if($0.$0(n))return Microsoft.Crm.Client.Core.Framework.$8.$u("CheckWhetherLoginParametersChanged",1031,"Login Parameters are empty"),!0;var u=n.$20(),f=this.$20(),r=u;for(i in r)if(t={key:i,value:r[i]},f[t.key]!==t.value)return Microsoft.Crm.Client.Core.Framework.$8.$u("CheckWhetherLoginParametersChanged",1031,"Login Parameter"+t.key+"Changed"),!0;return Microsoft.Crm.Client.Core.Framework.$8.$u("CheckWhetherLoginParametersChanged",1031,"Login Parameteres Didn't change"),!1},get_$i6:function(){return this.$1Q.$4Q.toString()},get_$1iU:function(){return Number.parseInvariant(this.$gY.$mg)},get_$1d7:function(){return this.$gY.$Z4},get_$1kv:function(){return!Microsoft.Crm.Client.Core.Framework.$3.$9(this.$gY.$WE)&&this.$gY.$WE.length>1?this.$gY.$WE.slice(1):this.$1Q.get_$UZ().toString()},get_$24r:function(){return this.$gY.$hY==="https"},$20:function(){var n={};return n.DataBaseName=this.$jt,n.UserId=this.get_$i6(),n.Host=this.get_$1d7(),n.Port=this.get_$1iU().toString(),n.IsSSL=this.get_$24r().toString(),n.ServerDataBaseName=this.get_$1kv(),n.ProfileId=this.$7K,n.AuthToken=this.$do,n.SessionId=this.$17Z,n}};Microsoft.Crm.Client.Core.Offline.$Y=function(n){this.$15V=new Microsoft.Crm.Client.Core.Offline.$K4(0);this.get_$14F=this.get_isMobileOfflineOptinFeatureEnabledInternal;this.set_$14F=this.set_isMobileOfflineOptinFeatureEnabledInternal;this.get_$t7=this.get_isMobileOfflineOptOutFeatureEnabledInternal;this.set_$t7=this.set_isMobileOfflineOptOutFeatureEnabledInternal;this.get_$1K1=this.get_isOfflineSyncTransitionStarted;this.set_$1K1=this.set_isOfflineSyncTransitionStarted;this.get_$6a=this.get_offlineProfile;this.set_$6a=this.set_offlineProfile;this.$AE=n};Microsoft.Crm.Client.Core.Offline.$Y.get_$5D=function(){return $0.$0(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3)||($0.$0(Microsoft.Crm.Client.Core.Offline.$Y.$3)||Microsoft.Crm.Client.Core.Offline.$Y.$3.get_$Hp()!==Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp())&&(Microsoft.Crm.Client.Core.Offline.$Y.$3=new Microsoft.Crm.Client.Core.Offline.$Y(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N()),Microsoft.Crm.Client.Core.Offline.$Y.$3.set_$Hp(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp())),Microsoft.Crm.Client.Core.Offline.$Y.$3};Microsoft.Crm.Client.Core.Offline.$Y.prototype={$AE:null,$4s:null,$1Q:null,$F3:!1,$15R:null,$1eQ:!1,get_offlineProfile:function(){return this.$4s},set_offlineProfile:function(n){return($0.$0(n)||$0.$0(this.$4s)||JSON.stringify(this.get_$E().$4s.$20())!==JSON.stringify(this.$4s.$20()))&&(this.$4s=n,this.$2G1()),n},get_$24Q:function(){return this.$1eQ},set_$24Q:function(n){return this.$1eQ=n,n},$37M:function(n){var t=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7);return $0.$0(n)||$0.$0(this.$4s)||JSON.stringify(this.get_$E().$4s.$20())!==JSON.stringify(this.$4s.$20())?(this.$4s=n,this.$2G1()):t.resolve()},get_$27B:function(){if($0.$0(this.$15V))throw Error.invalidOperation("OfflineSyncInfo has not been initialized yet.");return this.$15V},get_$2GK:function(){return this.get_$27B().$1R5},set_$2GK:function(n){return this.get_$27B().$1R5=n,n},get_$E:function(){if($0.$0(this.$1Q))if(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$G6())this.$1Q=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E();else throw Error.invalidOperation("UserContext is not initialized");return this.$1Q},set_$E:function(n){return this.$1Q=n,n},get_isMobileOfflineOptinFeatureEnabledInternal:function(){return this.$MG},set_isMobileOfflineOptinFeatureEnabledInternal:function(n){return this.$MG!==n&&(this.$MG=n,n||this.$1lQ(0),this.$2ND()),n},get_isMobileOfflineOptOutFeatureEnabledInternal:function(){return this.$R5},set_isMobileOfflineOptOutFeatureEnabledInternal:function(n){return this.$R5!==n&&(this.$R5=n,this.$2NE()),n},get_isOfflineSyncTransitionStarted:function(){return this.$tC},set_isOfflineSyncTransitionStarted:function(n){return this.$tC!==n&&(this.$tC=n,Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().get_PALEnabled()&&Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().$By&&this.$xP()),n},get_$lZ:function(){return $0.$0(this.$F3)&&(this.$F3=!1),this.$F3},set_$lZ:function(n){return this.$F3=n,n},get_$1gh:function(){return this.$15R},set_$1gh:function(n){return this.$15R=n,n},$MG:!1,$tC:!1,$R5:!1,$6o:null,$EO:null,$2Z:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i;return this.set_$E(n),i=this,this.$2OF().always(function(){i.$AE.$2mV(i.$1Q).then(function(n){t.resolve(n)},function(n){t.reject(n)})}),t.promise()},$2G1:function(){return this.$1qg("LastRetrievedOfflineProfileData",$0.$0(this.$4s)||Microsoft.Crm.Client.Core.Framework.$3.$9(this.$4s.toString())?null:JSON.stringify(this.$4s.$20()),!0)},$2ND:function(){this.$1qg("ismobileofflineoptedin",this.$MG,!0)},$2NE:function(){var n={};n.ismobileofflineoptedout=this.$R5;Microsoft.Crm.Client.Core.Framework.$V.get_$6().$bJ("ismobileofflineoptedout",n,!0)},$32x:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Hi("ismobileofflineoptedin").then(function(i){!$0.$0(i)&&"ismobileofflineoptedin"in i?(t.$MG=i.ismobileofflineoptedin,n.resolve(t.$MG)):(t.$MG=!1,n.resolve(t.$MG))},function(t){i.$MG=!1;n.reject(t)}),n.promise()},$32y:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Hi("ismobileofflineoptedout").then(function(i){!$0.$0(i)&&"ismobileofflineoptedout"in i?(t.$R5=i.ismobileofflineoptedout,n.resolve(t.$R5)):(t.$R5=!1,n.resolve(t.$R5))},function(t){i.$R5=!1;n.reject(t)}),n.promise()},get_$Hp:function(){return this.$6o},set_$Hp:function(n){return this.$6o=n,n},get_$US:function(){return Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1F()||$0.$0(this.$EO)||(this.$EO.$N1===-1&&this.$EO.$JC===1&&(this.$EO.$JC=0),this.$EO.$N1=this.$21t(this.$EO.$JC)),this.$EO},$2OF:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n=this,i=this;return this.$AE.$32v().then(function(i){$0.$0(i)?n.$AE.$2Cp(n.get_$E().$1I.$F3).then(function(){n.$F3=n.get_$E().$1I.$F3;Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_CheckForDeploymentChange",1005,"SaveOfflineDbDeploymentInformation succeeded. Value : "+n.get_$lZ());t.resolve()},function(i){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_CheckForDeploymentChange_Error",1005,"SaveOfflineDbDeploymentInformation failed. Value : "+n.get_$lZ()+". Details : "+i.$F);t.reject(i)}):(n.$F3=Boolean.parse(i.toString()),t.resolve())},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_CheckForDeploymentChange_Error",1005,"Error retrieving Offline db deployment info. Details : "+n.$F);t.reject(n)}),t.promise()},$1lQ:function(n,t){$0.$0(this.$EO)&&(this.$EO=new Microsoft.Crm.Client.Core.Framework.Offline.$Lv(n,t));$0.$0(this.$4s)||(this.$EO.$JC=n,this.$EO.$JC!==1&&this.$EO.$JC?(this.$EO.$r8=Microsoft.Crm.Client.Core.Framework.$1B.$s(this.$AE.get_$5a().get_$uE().get_$2sS()),this.$EO.$11U=Microsoft.Crm.Client.Core.Framework.$1B.$s(this.$15R)-this.$EO.$r8):(this.$EO.$r8=Microsoft.Crm.Client.Core.Framework.$1B.$s(this.$15R),this.$EO.$11U=0),this.$EO.$N1=$0.$0(t)?this.$21t(n):t);Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$5F().$2uX(this,null)},$AD:function(n){return this.get_$E().$1I.$HO&&this.$AE.get_$5a().get_$4K()&&n in this.$4s.$Ha&&!this.$142(n)},$142:function(n){return n in this.$AE.get_$5a().get_$uE().get_$1gi()},$1jB:function(n,t,i,r){var c=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$7),o={},w=t.$27,l,f,s,u,e,h,a,v,y,p,b,k,d;for(l in w)if(f={key:l,value:w[l]},s=f.value,(s===6||s===1||s===9)&&t.hasValue(f.key.toString())){if(u=t.getValue(f.key.toString()),$0.$0(u))continue;!u.equals(n)&&this.$AD(u.LogicalName)&&(e=u.LogicalName in o?o[u.LogicalName]:{},u.Id.toString()in e?(h=e[u.Id.toString()],h[h.length]=f.key,e[u.Id.toString()]=h):e[u.Id.toString()]=[f.key],o[u.LogicalName]=e)}a=[];v=o;for(y in v)p={key:y,value:v[y]},b=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Array))(p.value),Array.add(a,this.$AE.get_$5a().$2C9(b.get_$2ph(),p.key,r,i));return k=this,d=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(a).then(function(n){for(var h,l,i,y,s=n,p=s.length,r=0;r<p;++r){h=s[r];l=h;for(var a=l.get_entities(),w=a.length,u=0;u<w;++u){var f=a[u],v=f.$a,e=o[f.$a.LogicalName][f.$a.Id.toString()];for(i=0;i<e.length;i++)y=t.getValue(e[i]),y.equals(v)||t.setValue(e[i],v)}}c.resolve(t)},function(){c.resolve(t)}),c.promise()},$2Al:function(n,t,i){for(var w,l,a,u,f,s,v,p,d,g,h=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$7),e=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))),c=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),r=n.get_entities(),o=0;o<r.length;o++){w=r[o].$27;l=w;for(a in l)if(u={key:a,value:l[a]},(u.value===6||u.value===1||u.value===9)&&r[o].hasValue(u.key)){if(f=r[o].getValue(u.key),$0.$0(f))continue;this.$AD(f.LogicalName)&&(c.contains(u.key)||c.add(u.key),s=e.$3F5(f.LogicalName)?e.get_$R(f.LogicalName):new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),s.contains(f.get_identifier())||(s.add(f.get_identifier().toUpperCase()),e.set_$R(f.LogicalName,s)))}}v=[];for(var b=e.get_$2ph(),k=b.length,y=0;y<k;++y)p=b[y],Array.add(v,this.$AE.get_$5a().$2C9(e.get_$R(p).get_Items(),p,i,t));return d=this,g=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(v).then(function(t){for(var u,i,f,e,o,s={},y=t,w=y.length,l=0;l<w;++l){var b=y[l],k=b,a=k.get_entities();for(u=0;u<a.length;u++)s[a[u].get_key()]=a[u]}for(i=0;i<r.length;i++)for(var p=c.get_Items(),d=p.length,v=0;v<d;++v)f=p[v],r[i].hasValue(f)&&!$0.$0(r[i].getValue(f))&&(e=r[i].getValue(f),o=e.get_identifier()in s?s[e.get_identifier()].$a:null,$0.$0(o)||e.equals(o)||r[i].setValue(f,o));h.resolve(n)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineDataSource_RefreshRetrieveMultipleLookupData_OfflineError",1005,t.$F);h.resolve(n)}),h.promise()},$2gI:function(n){var t=MscrmComponents.DeferredPromiseFactory(Array,Microsoft.Crm.Client.Core.Framework.$7);if($0.$0(n.getValue("activityid"))||n.getValue("activityid")===Microsoft.Crm.Client.Core.Framework.Guid.get_empty())return Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineDataSource_GetExistingActivityParties",1005,"No activityparty data to retrieve for current entity"),t.resolve(new Array(0));var i=new Array(0),r=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("activityid!id",n.getValue("activityid").toString(),1,0)],u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(r),f=this,e=this;return this.$AE.get_$5a().$1Om("activityparty",u).then(function(n){for(var f=!$0.$0(n)&&!$0.$0(n.rows)?n.rows.length:0,u="activitypartyid",r=0;r<f;r++)$0.$0(n.rows.item(r))||$0.$0(n.rows.item(r)[u])||(i[i.length]=n.rows.item(r)[u].toUpperCase());Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineDataSource_GetExistingActivityParties",1005,"GetExistingActivityParties completed successfully");t.resolve(i)},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_GetExistingActivityParties - Failure",1005,n.$F);t.reject(n)}),t.promise()},$GU:function(n){Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineDataSource_OnMetadataSyncUpdated",1005,"Metadata Sync Updated");n.$PR!==8&&(n.$PR!==9||$0.$0(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s)||$0.$0(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s.$7K)||!Microsoft.Crm.Client.Core.Framework.Guid.$9(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s.$7K.toString()))||(Microsoft.Crm.Client.Core.Offline.$Y.$3.set_$6a(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$4s),Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().$By&&this.$xP());$0.$0(this.$AE.get_$5a().get_$uE())||this.$AE.get_$5a().get_$uE().$2kZ(n);n.$PR===8&&this.$AE.get_$5a().$1dK()},$xP:function(){var t,n,i;Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().get_PALEnabled()&&(t=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E(),n={},n.username=t.$CD,n.serverversion=t.$TO,n.databaseversion=t.$PK.$qt,n.userroles=t.$hV.join(", "),n.userculturelcid=t.get_$lj().toString(16),i=this.$1eY(),n.isoptincommandenabled=i,n.lastsyncdate=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1Kh(),n.isoptoutcommandenabled=this.$24b(),Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().$2l(Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().$17,Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().get_$1y().get_$2V(),new Microsoft.Crm.Client.Core.Framework.PAL.Dispatchers.$4u(n)))},$18O:function(){var t=MscrmComponents.DeferredPromiseFactory(Object,Microsoft.Crm.Client.Core.Framework.$7),n=this,i=this;return Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.when(this.$AE.$nD(),this.$32x(),this.$32w(),this.$32y()).then(function(i){i.length>0&&!$0.$0(i[0])?(n.set_$E(i[0]),n.get_$E().$1I.$HO&&$0.$0(n.$4s)?n.$37M(n.$1Q.$4s).then(function(){t.resolve()},function(){t.reject()}):t.resolve()):t.resolve();n.$MG&&n.$1lQ(0)},function(){t.reject(Microsoft.Crm.Client.Core.Framework.$7.$OQ(-2147094e3))}),t.promise()},$1eY:function(){return this.get_$E().$1I.$HO&&!this.$MG&&this.$4s.$ff&&!this.$tC},$24b:function(){return this.get_$E().$1I.$HO&&this.$MG&&this.$4s.$ff&&!this.$R5&&!this.$tC},$32w:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Hi("LastRetrievedOfflineProfileData").then(function(i){!$0.$0(i)&&"LastRetrievedOfflineProfileData"in i&&!$0.$0(i.LastRetrievedOfflineProfileData)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(i.LastRetrievedOfflineProfileData)?(t.$4s=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile.$2y(JSON.parse(i.LastRetrievedOfflineProfileData)),n.resolve(t.$4s)):(Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineDataSource.RetrieveOfflineProfileCache.Done",1005,"Profile Not Found"),t.$4s=null,n.resolve(t.$4s))},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_RetrieveOfflineProfileCache_LocalError",1005,t.$F);i.$4s=null;n.reject(t)}),n.promise()},$1qg:function(n,t,i){var r={};return r[n]=t,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$bJ(n,r,$0.$0(i)?!0:i)},$21t:function(n){switch(n){case 0:return this.$4s.$7K===Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?1:2;case 1:return 0;case 2:return 0}return 0},$1rh:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n=[],i,r;return Array.add(n,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Mh.$k8("ismobileofflineoptedin")),Array.add(n,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Mh.$k8("LastRetrievedOfflineProfileData")),Array.add(n,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Mh.$k8("ismobileofflineoptedout")),i=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(n).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()},$1rg:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=[],i,r;return Array.add(t,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Mh.$k8("LastRetrievedOfflineProfileData")),Array.add(t,Microsoft.Crm.Client.Core.Framework.$V.get_$6().$Mh.$k8("offlinedisabledinfo")),i=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).then(function(){n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineDataSource_ClearOfflineDataBaseState_LocalError",1005,t.$F);n.reject(t)}),n.promise()}};Microsoft.Crm.Client.Core.Offline.$G=function(){this.$$d_$2Iw=Function.createDelegate(this,this.$2Iw);this.$$d_$1oX=Function.createDelegate(this,this.$1oX);this.$$d_$1kf=Function.createDelegate(this,this.$1kf);this.$1FE=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["activitypointer".toLowerCase(),"syncerror".toLowerCase(),"activityparty".toLowerCase(),"postfollow".toLowerCase(),"businessdatalocalizedlabel".toLowerCase()]);this.$Iw=new Microsoft.Crm.Client.Core.Offline.$Ki;this.$UR=!1};Microsoft.Crm.Client.Core.Offline.$G.$25y=function(n){var t=n.code;switch(t){case 5:case 6:case 7:Microsoft.Crm.Client.Core.Offline.$G.$u("Sync.Progress",n.message);break;default:Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.Progress",n.message)}};Microsoft.Crm.Client.Core.Offline.$G.$VV=function(n,t,i){return function(n,r){Microsoft.Crm.Client.Core.Offline.$G.$u(i+".TxFailure",r);t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k(r))}};Microsoft.Crm.Client.Core.Offline.$G.$wo=function(n,t,i){return function(n){Microsoft.Crm.Client.Core.Offline.$G.$u(i+".SqlFailure",n);t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k(n))}};Microsoft.Crm.Client.Core.Offline.$G.$u=function(n,t){Microsoft.Crm.Client.Core.Framework.$8.$u(n,1031,t)};Microsoft.Crm.Client.Core.Offline.$G.$B=function(n,t){Microsoft.Crm.Client.Core.Framework.$8.$u(n,1031,t)};Microsoft.Crm.Client.Core.Offline.$G.$2i9=function(n){var t=[],u;t[t.length]=n.activityid.toString();t[t.length]=n.participationtypemask.toString();for(var r=n.resolvedparties,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u;return t};Microsoft.Crm.Client.Core.Offline.$G.$2iA=function(n){var t=[],u;t[t.length]=n.activityid.toString();t[t.length]=n.activityid.toString();t[t.length]=n.participationtypemask.toString();for(var r=n.resolvedparties,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u;return t};Microsoft.Crm.Client.Core.Offline.$G.prototype={$1R6:0,$GK:null,$4V:null,$Iw:null,$n0:!0,$F8:null,$PP:null,$EJ:!1,$D3:null,$kO:null,$xE:0,$nE:0,$1gP:6e4,$2CS:2,$1K7:!1,$UR:!1,$18R:null,get_$2sU:function(){return this.$UR},get_$uE:function(){return this.$Iw},get_$Mj:function(){return $0.$0(this.$GK)&&(this.$GK=norsyncPlugin.init("OfflineDataSource")),this.$GK},get_$4K:function(){return this.$EJ},set_$4K:function(n){return this.$EJ!==n&&(this.$EJ=n,n?this.$Iw.$1D3():Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(0)),n},$4X:null,$1Q:null,$2XY:function(){$0.$0(this.$kO)||this.$kO.$2XZ()},$2Z:function(n,t,i,r,u){var f,e,o;return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Initialize","Offline DataStore Initialize started"),f=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),this.$4V=t,this.$1R6=n.$1I.$1LS,this.$1Q=n,Microsoft.Crm.Client.Core.Offline.$v.$2Z(this.$4V,this.$1Q),this.$4X=r,this.$F8=u,this.$Iw.$2Z(i,r,u),e=this,o=this,this.$1dK().then(function(n){f.resolve(n)},function(n){f.reject(n)}),f.promise()},$1dK:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n;return Microsoft.Crm.Client.Core.Storage.DataApi.$D.get_$6().get_$F2()?(n=this,this.$2NC().always(function(){n.$EJ||Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(n.$4X.$sO()?1:0);n.$2mW().then(function(){n.$D3!==""?(n.$n0=!0,Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Initialize.InitializeOfflineDatabase","Database name - "+n.$D3),t.resolve(!0)):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Initialize.InitializeOfflineDatabase","Database name is null"),t.resolve(!1))},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Initialize.InitializeOfflineDatabase",n.$F);t.reject(n)})}),t.promise()):t.resolve(!1).promise()},$24V:function(){var n=!$0.$0(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a())&&!$0.$0(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K)&&!Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&!Microsoft.Crm.Client.Core.Framework.$3.$9(this.$1Q.$1I.$15P);return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.IsOfflineConfiguredForUser",n.toString()),n},$2mW:function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.InitializeOfflineDatabase","Offline DataStore InitializeOfflineDatabase started");var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n=this,i=this;return this.$4X.$2CE().then(function(i){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.InitializeOfflineDatabase","RetrieveOfflineDatabaseInformation succeeded. Database name - "+i);n.$D3=i;n.$1DF(!1).then(function(i){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.InitializeOfflineDatabase","CleanUpDatabases status :"+i.toString());n.$24V()?n.$2Cv().always(function(){t.resolve(i)}).fail(function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("Scheduling periodic sync job failed",n.$F)}):(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(0),n.$1m4().always(function(){t.resolve(i)}))},function(i){Microsoft.Crm.Client.Core.Offline.$G.$u("InitializeOfflineDatabase.CleanupFailure",n.$D3+" "+i.$F);t.reject(i)})},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("InitializeOfflineDatabase.RetrieveOfflineDatabaseInformation.Failure",n.$F);t.reject(n)}),t.promise()},$1DF:function(n){var i;if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","Offline DataStore CleanUpDatabases started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n||!this.$24V()||this.$1Q.$4s.$7K.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Storage.DataApi.$D.$I4||this.$D3!==Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString()||Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$lZ()!==this.$1Q.$1I.$F3){var r=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(this.$D3),u=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile(r,{},""),f=new Microsoft.Crm.Client.Core.Storage.DataApi.$2B(this.$1Q.$4Q,this.$1Q.$CD,this.$1Q.$Hx,this.$1Q.$mZ,this.$1Q.$1I,this.$1Q.$2U,this.$1Q.$FN,this.$1Q.$Sr,this.$1Q.$PK,this.$1Q.$hV,this.$1Q.$a0,this.$1Q.$Hv,this.$1Q.$jy,this.$1Q.$jz,this.$1Q.$k0,this.$1Q.$TO,u,this.$1Q.$K,this.$1Q.$D4),t=this,e=this;this.$1XA(this.$D3,f).then(function(n){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","Offline DataStore ClearStore succeeded. Status - "+n);n?(t.$1Q.$4s.$7K.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().set_$6a(t.$1Q.$4s),Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$lZ()!==t.$1Q.$1I.$F3&&t.$4X.$2Cp(t.$1Q.$1I.$F3).then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDbDeploymentInformation succeeded. Old value : "+Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$lZ()+". New Value : "+t.$1Q.$1I.$F3);Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().set_$lZ(t.$1Q.$1I.$F3)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDbDeploymentInformation failed. Old value : "+Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$lZ()+"New Value : "+t.$1Q.$1I.$F3+" Details : "+n.$F)}),t.$4X.$2Co("").then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDatabaseInformation succeeded");t.$D3="";Microsoft.Crm.Client.Core.Storage.DataApi.$D.get_$6().$1rg().then(function(){i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("CleanUpDatabases.ClearOfflineDataBaseState","Clear Offline Database State failed with error : "+n.$F);i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("CleanUpDatabases.CleanUpDatabases","Save offline info failed with error : "+n.$F);i.reject(n)})):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","Status - "+n),t.$D3="",i.resolve(!1))},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("CleanUpDatabases.CleanUpDatabases","cleanup database failed for database : "+e.$D3);i.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Could not delete database"))})}else Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CleanUpDatabases","database cleanup not required"),i.resolve(!0);return i.promise()},$2Cv:function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.SchedulePeriodicSyncJob","Offline DataStore SchedulePeriodicSyncJob started");var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n=this;return this.$1m4().always(function(){var i=!n.$4X.$sO();n.$2GG().always(function(){t.isResolved()||t.resolve(!0)}).fail(function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("SchedulePeriodicSyncJob.SyncFailed",n.$F)}).done(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.SchedulePeriodicSyncJob","Offline DataStore Immediate sync finished")});n.$xE||(n.$xE=window.setInterval(n.$$d_$1kf,n.$1R6));!i&&Microsoft.Crm.Client.Core.Storage.DataApi.$D.$I4&&t.resolve(!1)}),t.promise()},$1m4:function(){var n,t,i;return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.StopSync","Offline DataStore StopSync started"),n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),$0.$0(this.$PP)||this.$PP.get_$AT()||(this.$PP.$Wy(),this.$UR=!1),$0.$0(this.$xE)||(window.clearInterval(this.$xE),this.$xE=0),t=this,i=this,this.get_$Mj().abort(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.StopSync","Succesfully stopped the all running sync calls");n.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.StopSync","Couldnt stop the running sync call");n.resolve(!1)},!0),Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.StopSync","Offline DataStore StopSync finished"),this.$PP=null,n.promise()},$23F:function(n,t){var r,i,u,f;return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.InitAndLogin","Offline DataStore InitAndLogin started"),r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i=new Microsoft.Crm.Client.Core.Offline.$Kj(n,t),i.$2Oh(Microsoft.Crm.Client.Core.Offline.$G.$1L4)?(Microsoft.Crm.Client.Core.Offline.$G.$B("InitAndLogin.LoginParameters","UserId:- "+i.get_$i6()+" NorsyncServerEndpointHost:- "+i.get_$1d7()+" NorsyncServerPort:- "+i.get_$1iU()+" OfflineDatabasePath:- /data/data/no.norsync.cordova/databases ServerDatabaseName :- "+i.get_$1kv()+" ProfileId:- "+i.$7K+" ModelVersion:- -1 MocaSessionId:- "+i.$17Z),this.$GK=norsyncPlugin.init(i.$jt),u=this,f=this,this.get_$Mj().login(i.$jt,i.get_$i6(),"",i.get_$1d7(),i.get_$1iU(),"/data/data/no.norsync.cordova/databases",i.get_$24r(),function(){Microsoft.Crm.Client.Core.Offline.$G.$1L4=i;u.set_$4K(!Microsoft.Crm.Client.Core.Framework.$3.$9(n));Microsoft.Crm.Client.Core.Offline.$G.$B("InitAndLogin.LoginSuccess",i.$jt);r.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("InitAndLogin.LoginFailure",i.$jt);r.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline Store Initialize Failed"))},i.get_$1kv(),i.$7K,-1,i.$do,i.$17Z)):(Microsoft.Crm.Client.Core.Offline.$G.$B("InitAndLogin.LoginSuccess","Already Logged In"),r.resolve(!0)),r.promise()},$1kf:function(){if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ScheduleSync","Offline DataStore ScheduleSync started"),$0.$0(this.$PP))if(this.$UR)Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ScheduleSync","Offline DataStore Sync in progress, wait for completion");else{var n=this;this.$PP=Microsoft.Crm.Client.Core.Framework.Scheduler.Schedule(function(){n.$2GG()},0,"Norsync Sync")}else this.$PP.get_$AT()||(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ScheduleSync","Offline DataStore ScheduleSync priority increased"),this.$PP.set_$J3(13))},$2GG:function(){var n,t,i;return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Sync","Offline DataStore Sync started"),n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),Microsoft.Crm.Client.Core.Framework.$3.$9(this.$D3)||this.$D3===Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString()?this.$2GM(n):(t=this,i=this,this.$1DF(!1).then(function(){t.$2GM(n)},function(t){n.reject(t)})),n.promise()},$2GM:function(n){var i=new Microsoft.Crm.Client.Core.Framework.PerformanceStopwatch("DataSource_OfflineSync"),t;i.start();t=this;this.$23F(this.$D3,this.$1Q).done(function(){if(!t.$38H()){n.resolve(!1);t.$PP=null;return}t.$UR=!0;Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.Start","SyncStarted");var r=new Date,u=t.$2jX();t.get_$Mj().synchronize(Microsoft.Crm.Client.Core.Offline.$G.$25y,function(u){if(Microsoft.Crm.Client.Core.Offline.$G.$B("Sync","Offline DataStore Plugin Synchronize progress. Result - "+u.type),Microsoft.Crm.Client.Core.Offline.$G.$25y(u),u.type==="on-sync-complete")if(Microsoft.Crm.Client.Core.Offline.$G.$B("Sync","Offline DataStore Plugin Synchronize completed"),t.$1K7=!1,t.$nE=t.$1gP,t.$2OG().always(function(){var n=Microsoft.Crm.Client.Core.Framework.$3.$9(t.$D3)?!0:!1;t.$Iw.$2yp(n).always(function(){t.$EJ&&t.$Iw.$1D3();t.$UR=!1;t.$Iw.$2kj()}).done(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.ProcessSyncCompleteForSchemaChanges","offlineMetadataManager.ProcessSyncCompleteForSchemaChanges succeeded")}).fail(function(){Microsoft.Crm.Client.Core.Offline.$G.$u("Sync.ProcessSyncCompleteForSchemaChanges","offlineMetadataManager.ProcessSyncCompleteForSchemaChanges failed")})}).done(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.CheckForOfflineProfileChange","OfflineDataStore CheckForOfflineProfileChange succeeded")}).fail(function(){Microsoft.Crm.Client.Core.Offline.$G.$u("Sync.CheckForOfflineProfileChange","OfflineDataStore CheckForOfflineProfileChange failed")}),t.$n0&&t.$2QR(),t.$PP=null,Microsoft.Crm.Client.Core.Framework.$3.$9(t.$D3)){if(Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.Plugin.Synchronize","Initial Sync"),!t.$EJ){var f=new Date,o=f-r,s=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$PI("1002","MOCADataSyncInitialDownloadCompleted",r.toString(),f.toString(),o,"Success","Initial data downloaded successfully",Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),"","",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1T(s)}t.$4X.$2Co(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString()).done(function(){t.$D3=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString();t.set_$4K(!0);Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.SaveOfflineDatabaseInformation.Success",t.$D3)}).always(function(){i.stop();$(window).trigger("offlineSyncComplete");Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.SaveOfflineDatabaseInformation.Complete",t.$D3);n.resolve(!0)});Microsoft.Crm.Client.Core.Offline.$3s.get_$5D().$1qh(null)}else{i.stop();$(window).trigger("offlineSyncComplete");Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.Success",t.$D3);n.resolve(!0);var e=new Date,h=e-r,c=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$PI("1003","MOCADataSyncComplete",r.toString(),e.toString(),h,"Success","Delta sync completed successfully",Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),"","",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1T(c);Microsoft.Crm.Client.Core.Offline.$3s.get_$5D().$2o6().then(function(n){n&&t.$1DF(!0).then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("SyncInternal.CleanUpDatabases","Full sync because of fls change");t.$2Cv()},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("SyncInternal.CleanUpDatabases","Force sync did not happen, cleanup Error: "+n.$F.toString())})},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("SyncInternal.IsFullSyncRequired","Error: "+n.$F.toString())})}else t.$UR=!0},function(i){t.$PP=null;t.$UR=!1;Microsoft.Crm.Client.Core.Offline.$G.$u("Sync.Failure",t.$D3+" "+i.message);i.type==="on-sync-complete"&&(i.code===-35?Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$US().$JC,-2):Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$US().$N1===3&&t.$Iw.$1KE()||Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$1lQ(Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$US().$JC,-1),t.$33N(),n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k(i.message)))},-1,function(n){return t.$Iw.$a3?(Microsoft.Crm.Client.Core.Offline.$G.$u("Sync.Aborting","Returning false for syncing data model changes as metadata sync is in progress"),!1):(t.$UR=!0,t.$Iw.$2yX(n),t.$n0=!0,Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.ModelChanged",n.toString()),!0)},u)})},$33N:function(){if(this.$1K7||(this.$1K7=!0,this.$nE=this.$1gP),this.$nE<this.$1R6){var n=this;window.setTimeout(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.Retry","Retrying after failure");n.$1kf()},this.$nE);this.$nE=this.$2CS*this.$nE}},$2OG:function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CheckForOfflineProfileChange","Offline DataStore CheckForOfflineProfileChange started");var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("systemuserid",this.$1Q.$4Q.toString(),0,0)],r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(i),t=this,u=this;return this.$1Om("_systemuser",r).then(function(i){$0.$0(t.$18R)&&(t.$18R=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$7K.toString());$0.$0(i)||!i.rows.length?(Microsoft.Crm.Client.Core.Offline.$G.$u("CheckForOfflineProfileChange.NosystemUser","No system user records found in offline db."),n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("No system user records found in offline db."))):"mobileofflineprofileid!id"in i.rows.item(0)&&!$0.$0(i.rows.item(0)["mobileofflineprofileid!id"])&&!t.$1eV(i.rows.item(0)["mobileofflineprofileid!id"].toString())||(t.$Iw.$2kh(),Microsoft.Crm.Client.Core.Offline.$G.$B("CheckForOfflineProfileChange.Detected","Offline Profile Change detected on offline sync completion"));n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.$G.$u("CheckForOfflineProfileChange.RetrieveSystemUserFailed",t.$F);n.reject(t)}),n.promise()},$1eV:function(n){return n.toLowerCase()!==this.$18R.toLowerCase()?(this.$18R=n,!0):!1},$2NC:function(){var u,f,h,c;Microsoft.Crm.Client.Core.Offline.$G.$B("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities","Offline DataStore CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities started");var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),e=[],o={},s=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$Ha;for(u in s){var t={key:u,value:s[u]},n=Microsoft.Crm.Client.Core.Offline.$2C.get_$1Y4(),i=this.$4V.$i(t.key);$0.$0(i)||(i.$14B||this.$1FE.contains(t.key)||(o[t.key]=i.$1q),i.$KB&&n.push.apply(n,Microsoft.Crm.Client.Core.Offline.$2C.get_$2Fx()),1!==i.$v1&&Array.remove(n,"ownerid"));f=this.$4V.$fX(t.key,n);($0.$0(f)||f.length!==n.length)&&Array.add(e,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$5e(new Microsoft.Crm.Client.Core.Storage.DataApi.$5D(t.key,n),null))}return Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().set_$1gh(o),h=this,c=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities","Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities.Failure",n.$F);r.reject(n)}),r.promise()},$38H:function(){if(this.$4X.$sO())if(this.$Iw.$a3)Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.NotStarted","Sync not started because metadata sync is in progress.");else{if(Microsoft.Crm.Client.Core.Storage.DataApi.$D.$I4)return!0;Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.NotStarted","Sync not started because upsync is in progress.")}else Microsoft.Crm.Client.Core.Offline.$G.$B("Sync.NotStarted","Sync not started due to no network connectivity");return!1},$2jX:function(){var i=Microsoft.Crm.Client.Core.Storage.Common.DateTimeOperators.$O.$227(),u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().get_$C9(),r=Microsoft.Crm.Client.Core.Framework.$h.$sI(i,u),n=new Date(i.getTime()+r),f=this.$1Q.get_$FS()*6e4,t={};return t[Microsoft.Crm.Client.Core.Offline.$G.$PQ.$1u3]=String.format("'{0}-{1:D2}-{2:D2} {3:D2}:{4:D2}:{5:D2}.{6:D3}'",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),t[Microsoft.Crm.Client.Core.Offline.$G.$PQ.$27C]=f.toString(),t[Microsoft.Crm.Client.Core.Offline.$G.$PQ.$1v6]=r.toString(),t},$2hd:function(){var n={};return n.CommandOperation="CommandId",n.Command="Id",n.businessprocessflowinstance="businessprocessflowinstanceid",n},$10E:function(n,t){var i;if(Microsoft.Crm.Client.Core.Storage.DataApi.$D.$I4&&(i=this.$4V.$i(n.$a.LogicalName),n.hasValue(i.$4Y))){var u=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2Yq(n.$a,i.$4Y),f=[n.getValue(i.$4Y).toString()],r=this,e=this;this.$GK.transaction(function(i){i.executeSql(u,f,function(i,u){var f,c,e,o,l;if(!$0.$0(u.rows)&&u.rows.length===1){var a=u.rows.item(0),s=!1,h=a;for(f in h)c={key:f,value:h[f]},s=c.value;if(s){e=n.fields;for(o in e)l={key:o,value:e[o]},n.$4w.add(l.key);r.$9W(n.$a,n,!0,t,!0).done(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Cache.Success",n.$a.get_key())})}else r.$X(n,!0,t,!0).done(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Cache.Success",n.$a.get_key())})}},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Cache.SqlExecutionFailure",n)})},function(n,t){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Cache.TransactionFailure",t)},null)}},$X:function(n,t,i,r){var u,f;if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Create","Offline DataStore Create started"),u=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$7),f=this.$4V.$fX(n.$a.LogicalName,null),r=$0.$0(r)?!1:r,$0.$0(f)){var e=this,o=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$5e(new Microsoft.Crm.Client.Core.Storage.DataApi.$5D(n.$a.LogicalName,null),null).then(function(t){e.$4V.$Wp(n.$a.LogicalName,!0,t);e.$eC(n,u,r)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Create.RetrieveMultipleAttributeMetadata.Fail",n.$F);u.reject(n)})}else this.$eC(n,u,r);return u.promise()},$eC:function(n,t,i){$0.$0(n.$a)&&(Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Create.Fail","Entity Record Identifier cannot be null"),t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Entity Record Identifier cannot be null")));var u=this.$4V.$i(n.$a.LogicalName),f=$0.$0(n.$a.Id)||n.$a.Id===Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?$0.$0(n.fields[u.$4Y])?Microsoft.Crm.Client.Core.Framework.Guid.newGuid():n.fields[u.$4Y]:n.$a.Id,r=this,e=this;Microsoft.Crm.Client.Core.Offline.$2C.$21E(n,0,u.$4Y,f,this.$4V,this.$1Q).then(function(e){var o=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GH(n.$a,e.$4A),s=e.$9y;r.get_$Mj().transaction(function(s){var h=[],c;if(i&&(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CreateInternal","Create called with triggers suppressed"),Array.add(h,r.$D2(s,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GI(),null))),Array.add(h,r.$D2(s,o,e.$9y)),u.get_$7g()&&!$0.$0(e.$gw)){n.$a.Id=f;for(var a=e.$gw,v=a.length,l=0;l<v;++l)c=a[l],Array.add(h,r.$D2(s,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GH(c.entityreference,c.columns),c.values))}i&&Array.add(h,r.$D2(s,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GJ(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(h).then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Create","OfflineDataStore Create succeeded");n.$a.Id=f;t.resolve(n.$a)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Create.Fail",n.$F);t.reject(n)})},Microsoft.Crm.Client.Core.Offline.$G.$VV(Xrm.Objects.EntityReference,t,"Create"),null)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Create.GetOfflineQueryDataObject.Fail",n.$F);t.reject(n)})},$2W1:function(n){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ExecuteTransaction","Offline DataStore ExecuteTransaction started");var t=n.$18p,r=n.$1mC,i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),f=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),u=this,e=this;return this.$rm().then(function(n){var l=new Array(0),a=[],v=new Array(0),e,c,w,d,g,b,k,s;for(r&&(l.push(Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GI()),a.push(null),v.push("Transaction.SuppressTrigger.Failed")),e=0;e<t.get_Count();e++){var nt=$0.$0(t.get_$R(e).$TJ)?null:t.get_$R(e).$TJ.$oi,o=new Microsoft.Crm.Client.Core.Offline.$K7(t.get_$R(e).$190,nt),y="",p="",h=[];if(o.$E9.length>0||t.get_$R(e).$uu==="Delete"){switch(t.get_$R(e).$uu){case"Create":p="Transaction.Create";h=o.$ex;y=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GH(new Xrm.Objects.EntityReference(t.get_$R(e).$N3,n),o.$E9);break;case"Delete":p="Transaction.Delete";h=o.$ex;y=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1wv(new Xrm.Objects.EntityReference(t.get_$R(e).$N3,n),t.get_$R(e).$TJ);break;case"Update":for(p="Transaction.Update",c="",w=u.$2hd(),(t.get_$R(e).$N3 in w)&&!$0.$0(w[t.get_$R(e).$N3])?c=w[t.get_$R(e).$N3].toString():(d=t.get_$R(e).$N3.startsWith("_NORSYNC_LOG_")?t.get_$R(e).$N3.replace("_NORSYNC_LOG_",""):t.get_$R(e).$N3,g=u.$4V.$i(d),c=g.get_$ES()),b=new Array(0),k=-1,s=0;s<o.$E9.length;s++)o.$E9[s].toString()!==c?(b[b.length]=o.$E9[s].toString(),h.push(o.$ex[s])):k=s;k!==-1&&h.push(o.$ex[k]);y=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1x5(new Xrm.Objects.EntityReference(t.get_$R(e).$N3,n),b,c)}l.push(y);a.push(h);v.push(p)}}r&&(l.push(Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GJ()),a.push(null),v.push("Transaction.UnSuppressTrigger.Failed"));u.$GK.transaction(function(n){var u,i;for(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ExecuteTransaction.plugin.Transaction","Succeeded"),u=r?t.get_Count()+2:t.get_Count(),i=0;i<u;i++)n.executeSql(l[i],a[i],null,Microsoft.Crm.Client.Core.Offline.$G.$wo(Boolean,f,v[i]))},Microsoft.Crm.Client.Core.Offline.$G.$VV(Boolean,i,"Transaction failed!"),function(){i.resolve(!0)})},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.ExecuteTransaction.plugin.Transaction",n.$F);i.reject(n)}),i.promise()},$rm:function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.GenerateUID","Offline DataStore GenerateUID started");var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.Guid,Microsoft.Crm.Client.Core.Framework.$7),t=this;return this.get_$Mj().generateUUID(function(t){var i=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(t);i.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())?(Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.GenerateUID","Guid empty"),n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("invalid Guid generation"))):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.GenerateUID","Guid - "+i),n.resolve(i))},1),n.promise()},$1Om:function(n,t){var o=t,u=$0.$0(o)?null:o.$oi,i,f,r,s,e;if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLocalEntities","Offline DataStore RetrieveLocalEntities started"),i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$7),f=[],!$0.$0(u))for(r=0;r<u.length;r++)if(u[r].$I2===7)for(s=u[r].$4j,e=0;e<s.get_Items().length;e++)f.push(s.get_Items()[e]);else u[r].$I2!==6&&f.push(u[r].$4j);var h=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2ZD(n,o),c=this,l=this;return this.get_$Mj().transaction(function(n){n.executeSql(h,f,function(n,t){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLocalEntities.Plugin.Transaction","RetrieveLocalEntities succeeded");i.resolve(t)},Microsoft.Crm.Client.Core.Offline.$G.$wo(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,i,"Retrieve_DAL"))},Microsoft.Crm.Client.Core.Offline.$G.$VV(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,i,"Retrieve_Dal"),function(){i.isPending()&&i.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("No records found"))}),i.promise()},$7m:function(n,t,i,r){var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$7),f,e,o,s;return Microsoft.Crm.Client.Core.Offline.$G.$B("Retrieve.Start",n.get_key()),f=this.$4V.$i(n.LogicalName),e=Microsoft.Crm.Client.Core.Storage.Common.ColumnSet.isInstanceOfType(t)?t.$4A:null,e=this.$2Kt(f,e),o=this,s=this,this.$4V.$OY(n.LogicalName,e).then(function(t){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Retrieve.GetAttributeTypes","GetAttributeTypes succeeded");var s=o.$21S(t,r),h=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1aX(n,s,f.$4Y),e=[];e[e.length]=n.Id.toString().toUpperCase();o.get_$Mj().transaction(function(s){s.executeSql(h,e,function(e,s){if($0.$0(s.rows)||!s.rows.length)Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Retrieve.NoRecordsFound",n.get_key()),u.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("No records found"));else{var h=Microsoft.Crm.Client.Core.Offline.$v.$qZ(s.rows.item(0),t,f,i);f.get_$7g()?(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Retrieve","Entity metadata is activity"),o.$2Wd(h,t,i,r).then(function(n){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Retrieve.FillActivityParty","Succeeded");u.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Retrieve.FillActivityParty",n.$F);u.reject(n)})):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Retrieve","Entity metadata is not activity"),u.resolve(h))}},Microsoft.Crm.Client.Core.Offline.$G.$wo(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,u,"Retrieve"+n.get_key()))},Microsoft.Crm.Client.Core.Offline.$G.$VV(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,u,"Retrieve"+n.get_key()),null)},function(t){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.Retrieve.GetAttributeTypes.Failure",n.LogicalName+"."+t.$F);u.reject(t)}),u.promise()},$2C9:function(n,t,i,r){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$7),f=this.$4V.$i(t),e=[f.$4Y,f.$59],o=this,s=this;return this.$4V.$OY(t,e).then(function(i){var s=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2ZB(n.length,e,f);o.$GK.transaction(function(t){t.executeSql(s,n,function(n,t){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords succeeded");var e=o.$1ww(t,i,f,r);u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(e,!1,t.rows.length,!1))},function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLookupRecords","No records found");u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1))})},Microsoft.Crm.Client.Core.Offline.$G.$VV(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrieveLookupRecords"+t),null)},function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords failed");u.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline DB could not retrieve data for retreiveMultiple request"))}),u.promise()},$7y:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$7),r;if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveMultiple.Start",n.get_$2m().toString()),r=n.get_$9t(),Microsoft.Crm.Client.Core.Framework.$3.$9(r))return Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.RetrieveMultiple.SqlQueryNotFound",n.get_$2m().toString()),i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1,n)).promise();r=unescape(r);var f=Microsoft.Crm.Client.Core.Storage.Common.ColumnSet.isInstanceOfType(n.$4b)&&!n.$4b.get_$140()?n.$4b.$4A:null,u=this,e=this;return this.$4V.$OY(n.$P,f).then(function(f){var e,o,s;if(!("transactioncurrencyid"in f)){e=f;for(o in e)if(s={key:o,value:e[o]},s.value===8){f.transactioncurrencyid=6;break}}u.get_$Mj().transaction(function(e){e.executeSql(r,null,function(r,e){var o,s,h;Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrieveMultiple.SqlSuccess",n.get_$2m().toString());o=!1;s=u.$4V.$i(n.$P);e.rows.length>n.$4W&&(e.rows.length=n.$4W,o=!0);h=u.$1ww(e,f,s,t);i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(h,o,e.rows.length,!1,n))},Microsoft.Crm.Client.Core.Offline.$G.$wo(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,i,"OfflineDataStore.RetrieveMultiple.QueryId"+n.get_$2m().toString()))},Microsoft.Crm.Client.Core.Offline.$G.$VV(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,i,"OfflineDataStore.RetrieveMultiple.QueryId"+n.get_$2m().toString()),function(){i.isPending()&&(Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.RetrieveMultiple.TransactionSuccessWithExecuteSqlPending","QueryId"+n.get_$2m().toString()),i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1,n,t)));Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.RetrieveMultiple.TransactionSuccess","QueryId"+n.get_$2m().toString())})},function(){var t=String.format("Offline DB could not retrieve Attribute types for entity {0} from Metadata Cache",n.$P);Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.RetrieveMultiple.AttributeTypeRetrieveFailed",t+".QueryId"+n.get_$2m().toString());i.reject(Microsoft.Crm.Client.Core.Framework.$7.$k(t))}),i.promise()},$2C8:function(n){var t=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),i=this.$2iE(n),r;return i.length?(r=this,this.get_$Mj().transaction(function(n){r.$D2(n,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$32c(i.length),i).then(function(n){var r=null,u,i;!$0.$0(n.rows)&&n.rows.length>0&&(u=new Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteRecord,i={},i=n.rows.item(0),$0.$0(i)||$0.$0(i.lastdatasynctime)||(r=Xrm.Soap.CrmDateTimeSerializer.$vA(i.lastdatasynctime.toString())));t.resolve(r)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineDataStore.RetrieveLastSyncTime",n.$F);t.reject(n)})},Microsoft.Crm.Client.Core.Offline.$G.$VV(String,t,"RetrieveLastSyncTime"),null),t.promise()):t.resolve(null)},$9W:function(n,t,i,r,u){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Update","Update started");var e=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$7),o=this.$4V.$i(n.LogicalName),f=this,s=this;return Microsoft.Crm.Client.Core.Offline.$2C.$21E(t,1,o.$4Y,n.Id,this.$4V,this.$1Q).then(function(i){var r=i.$9y;u=$0.$0(u)?!1:u;f.get_$Mj().transaction(function(r){var s=[],l,w,h;if(Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1aX(n,[new Microsoft.Crm.Client.Core.Framework.Storage.$3l(o.$4Y)],o.$4Y),[n.Id.toString()])),u&&(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Update","Update called with triggers suppressed"),Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GI(),null))),Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1x5(n,i.$4A,o.$4Y),i.$9y)),o.get_$7g()){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Update","Entity metadata is activity");for(var p=i.$166,d=p.length,c=0;c<d;++c)l=p[c],w=l.resolvedparties.length,Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2Yk(w),Microsoft.Crm.Client.Core.Offline.$G.$2i9(l)));for(var b=i.$gw,g=b.length,a=0;a<g;++a)h=b[a],Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GH(h.entityreference,h.columns),h.values));for(var k=i.$166,nt=k.length,v=0;v<nt;++v){var y=k[v],it=y.activityid.toString(),tt=y.resolvedparties.length;Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$3Ab(tt),Microsoft.Crm.Client.Core.Offline.$G.$2iA(y)))}}u&&Array.add(s,f.$D2(r,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GJ(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(s).then(function(n){$0.$0(n[0])||!n[0].rows.length?(Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.Update.Failure","You cant update this record because it doesnt exist in the offline mode"),e.reject(Microsoft.Crm.Client.Core.Framework.$7.$f9(-2147093980))):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Update","Update succeeded"),e.resolve(t.$a))},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.Update.Failure",n.$F);e.reject(n)})},Microsoft.Crm.Client.Core.Offline.$G.$VV(Xrm.Objects.EntityReference,e,"Update"),null)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.Update.GetOfflineQueryDataObject.Failure",n.$F);e.reject(n)}),e.promise()},$D2:function(n,t,i){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ExecuteInternal","ExecuteInternal started");var r=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$7),u=this;return n.executeSql(t,i,function(n,t){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ExecuteInternal","ExecuteInternal succeeded");r.resolve(t)},Microsoft.Crm.Client.Core.Offline.$G.$wo(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,r,"ExecuteInternal")),r.promise()},Delete:function(n,t,i){var u,r;return Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Delete","Delete started"),u=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$7),i=$0.$0(i)?!1:i,r=this,this.get_$Mj().transaction(function(t){var e=r.$4V.$i(n.LogicalName),s=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8(e.$4Y,null,1,0)],h=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(s),c=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1wv(n,h),o=[n.Id.toString()],f=[];Array.add(f,r.$D2(t,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1aX(n,[new Microsoft.Crm.Client.Core.Framework.Storage.$3l(e.$4Y)],e.$4Y),[n.Id.toString()]));i&&(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Delete","Delete called with triggers suppressed"),Array.add(f,r.$D2(t,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GI(),null)));Array.add(f,r.$D2(t,c,o));e.get_$7g()&&(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Delete","Entity metadata is activity"),Array.add(f,r.$D2(t,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2Yj(),o)));i&&Array.add(f,r.$D2(t,Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1GJ(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(f).then(function(t){$0.$0(t[0])||!t[0].rows.length?(Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.Delete.Failure","You cant delete this record because it doesnt exist in the offline mode"),u.reject(Microsoft.Crm.Client.Core.Framework.$7.$f9(-2147093944))):(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.Delete","Delete succeeded"),u.resolve(n))},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.Delete.Failure",n.$F);u.reject(n)})},Microsoft.Crm.Client.Core.Offline.$G.$VV(Xrm.Objects.EntityReference,u,"Delete"),null),u.promise()},$1ww:function(n,t,i,r){for(var u,o=!$0.$0(n)&&!$0.$0(n.rows)?n.rows.length:0,f=[],e=0;e<o;e++)u=n.rows.item(e),$0.$0(u)||Microsoft.Crm.Client.Core.Framework.$3.$9(u[i.$4Y])||(f[f.length]=Microsoft.Crm.Client.Core.Offline.$v.$qZ(u,t,i,r));return f},$1XA:function(n,t){var i,r;return(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.ClearStore","ClearStore started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),Microsoft.Crm.Client.Core.Framework.$3.$9(n))?(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineStore.ClearStore","Database name is empty"),i.resolve(!1).promise()):(r=this,this.$1m4().always(function(){r.$EJ?r.$1uU(n,i):r.$23F(n,t).then(function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineStore.ClearStore","InitAndLogin succeeded");r.$1uU(n,i)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.ClearStore.InitAndLogin.Failure",n.$F);i.reject(n)})}),i.promise())},$1uU:function(n,t){var i=this,r=this;this.get_$Mj().deleteDatabase(n,function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineStore.DeleteDatabase","Database delete successful for database : "+n);i.set_$4K(!1);i.$n0=!0;Microsoft.Crm.Client.Core.Offline.$G.$1L4=null;t.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("OfflineStore.DeleteDatabase.Failure",n);t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Could not delete database"))})},$331:function(n,t,i,r){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrievePartyRecords","RetrievePartyRecords started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$7),f=this,e=this;return this.$4V.$OY("activityparty",Microsoft.Crm.Client.Core.Offline.$2K.$29K).then(function(e){var s,h,l;Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrievePartyRecords.GetAttributeTypes","GetAttributeTypes succeded");var a=f.$21S(e,r),c=f.$4V.$i("activityparty"),v=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2ZC(a,t,c.$y),o=[];o[o.length]=n.Id.toString().toUpperCase();s=t;for(h in s)l={key:h,value:s[h]},o[o.length]=l.key;f.$GK.transaction(function(n){n.executeSql(v,o,function(n,t){for(var o=t.rows.length,f=[],r=0;r<o;r++)$0.$0(t.rows.item(r))||(f[f.length]=Microsoft.Crm.Client.Core.Offline.$v.$qZ(t.rows.item(r),e,c,i));Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.RetrievePartyRecords","Executesql succeded");u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(f,!1,t.rows.length,!1))},Microsoft.Crm.Client.Core.Offline.$G.$wo(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrievePartyRecords"))},Microsoft.Crm.Client.Core.Offline.$G.$VV(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrievePartyRecords"),function(){Microsoft.Crm.Client.Core.Offline.$G.$u("RetreivePartyRecords.TransactionSuccess","Identifier"+n.get_key());u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1))})},function(t){Microsoft.Crm.Client.Core.Offline.$G.$u("Retrieve.GetAttributeTypes.Failure",n.LogicalName+"."+t.$F);u.reject(t)}),u.promise()},$2Wd:function(n,t,i,r){var o,e,c,l,a;Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.FillActivityParty","FillActivityParty started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$7),s=!1,f={},h=t;for(o in h)e={key:o,value:h[o]},e.value===10&&(c=Microsoft.Crm.Client.Core.Offline.$2K.$1Mn[e.key],f[c]=e.key,s=!0);return s?(l=this,a=this,this.$331(n.$a,f,i,r).then(function(t){var i,r,e;if(Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.FillActivityParty","RetrievePartyRecords succeeded"),!$0.$0(t.get_entities())&&t.get_entities().length>0){i=new Array(0);r="";for(var s=t.get_entities(),h=s.length,o=0;o<h;++o)e=s[o],r!==e.getValue("participationtypemask").get_$cW()&&(i.length>0&&(n.initializeValue(f[r].toString(),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(i,!1,i.length,!1),10),i=new Array(0)),r=e.getValue("participationtypemask").get_$cW()),i[i.length]=e;n.initializeValue(f[r].toString(),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(i,!1,i.length,!1),10)}Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.FillActivityParty","FillActivityparty succeeded");u.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("Retrieve.RetrievePartyRecords.Failure",n.$F);u.reject(n)}),u.promise()):(u.resolve(n),u.promise())},$21S:function(n,t){var f=Microsoft.Crm.Client.Core.Offline.$25.$32p(n,t),e=new Array(0),o=f,r,s,u,i;for(r in o)for(s={key:r,value:o[r]},u=f[s.key],i=0;i<u.length;i++)Array.add(e,new Microsoft.Crm.Client.Core.Framework.Storage.$3l(u[i].toString()));return e},$2Kt:function(n,t){var i=new Array(0),e,s;if($0.$0(n.$4Y)||(i[i.length]=n.$4Y),$0.$0(n.$59)||(i[i.length]=n.$59),i.length>0){for(var f=t,h=f.length,r=0;r<h;++r)if(e=f[r],Array.remove(i,e)&&!i.length)break;for(var o=i,c=o.length,u=0;u<c;++u)s=o[u],t[t.length]=s}return t},$1Lv:function(){var n=[],r=Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().get_$6a().$Ha,t,i;for(t in r)i={key:t,value:r[t]},Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$142(i.key)||(n[n.length]=i.key);return n},$2QR:function(){var n,t,i,r;Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CreateActivityPointerView","CreateActivityPointerView started");n=this.$Iw.$1DK;t=[];!$0.$0(n)&&n.length>0&&(Array.add(t,this.$1v5("activitypointer")),Array.add(t,this.$1v5("activityattachment")));i=this.$1Lv();Array.indexOf(i,"activitypointer".toLowerCase())===-1?Microsoft.Crm.Client.Core.Offline.$G.$B("CreateActivityPointerView","View not created as ActivityPointer is not offline available"):(r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).always(function(){r.$2QS(n,i)}))},$2QS:function(n,t){var i=this;Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2Ya(this.$4V,this.$F8,this.$4X,n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CreateActivityPointerView","CreateActivityPointerView query :"+n);i.$GK.transaction(function(t){t.executeSql(n,null,function(){Microsoft.Crm.Client.Core.Offline.$G.$B("view creation successful","CreateActivityPointerView");i.$2nU()?i.$2QO():i.$n0=!1},i.$$d_$1oX)},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("transaction failed while creating the view","CreateActivityPointerView")},null)},null)},$2nU:function(){var n=this.$1Lv();return Array.indexOf(n,"activitymimeattachment")===-1||Array.indexOf(n,"attachment")===-1||Array.indexOf(n,"activitypointer")===-1?(Microsoft.Crm.Client.Core.Offline.$G.$B("CreateActivityAttachmentView","View not created as ActivityAttachment or Attachment or ActivityPointer is not offline available"),!1):!0},$2QO:function(){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CreateActivityAttachmentView","CreateActivityAttachmentView started");var n=this;Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2YZ(this.$1Lv()).then(function(t){Microsoft.Crm.Client.Core.Offline.$G.$B("OfflineDataStore.CreateActivityAttachmentView","CreateActivityAttachmentView query :"+t);n.$GK.transaction(function(i){i.executeSql(t,null,function(){Microsoft.Crm.Client.Core.Offline.$G.$B("view creation successful","CreateActivityAttachmentView");n.$n0=!1},n.$$d_$2Iw)},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("transaction failed while creating the view","CreateActivityAttachmentView")},null)},null)},$1oX:function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("view creation/removal failed","ActivityPointerChangeFailed with error message : "+n)},$2Iw:function(n){Microsoft.Crm.Client.Core.Offline.$G.$u("view creation/removal failed","ActivityAttachmentView creation failed with error message : "+n)},$1v5:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i=this,r=this;return this.$GK.transaction(function(r){var u=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$2Ym(n);r.executeSql(u,null,function(){Microsoft.Crm.Client.Core.Offline.$G.$B("DropView: "+n,"success");t.resolve(!0)},function(n,r){i.$1oX(n,r);t.resolve(!1)})},function(){Microsoft.Crm.Client.Core.Offline.$G.$u("DropView: "+n,"transaction failed");t.resolve(!1)},null),t.promise()},$1bm:function(){var n=new Array(0),t=this.$1Lv(),i;return Array.contains(t,"activitypointer")&&(i=this.$Iw.$1DK,n=Microsoft.Crm.Client.Core.Offline.$j.get_$6().$1bm(this.$4V,this.$F8,i,t)),n},$2iE:function(n){var t=new Array(0);return n==="activitypointer"?t=this.$1bm():t[0]=n,t},$2Oy:function(n){this.$1Q=n;var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i=this,r=this;return this.$1DF(!0).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$G.$PQ=function(){};Microsoft.Crm.Client.Core.Offline.$25=function(n){Microsoft.Crm.Client.Core.Offline.$25.$CM=n};Microsoft.Crm.Client.Core.Offline.$25.$1HH=function(n,t){var i,u,f,o;if(!Microsoft.Crm.Client.Core.Offline.$25.$CM)return new Array(0);if(i=[],Microsoft.Crm.Client.Core.Offline.$v.$1J7(t))if(Microsoft.Crm.Client.Core.Offline.$25.$CM.$lK(t)){u=Microsoft.Crm.Client.Core.Offline.$25.$CM.$1bs(t);f=n+"!";for(var e=u,s=e.length,r=0;r<s;++r)o=e[r],i[i.length]=f+o}else i[i.length]=n;return i};Microsoft.Crm.Client.Core.Offline.$25.$32p=function(n){var r={},u=n,i,f,t;for(i in u)f={key:i,value:u[i]},t=f.key,r[t]=Microsoft.Crm.Client.Core.Offline.$25.$1HH(t,n[t]);return r};Microsoft.Crm.Client.Core.Offline.$25.$20a=function(n,t,i){var r,u,h,e,f;if(!Microsoft.Crm.Client.Core.Offline.$25.$CM)return{};if(r={},u=Microsoft.Crm.Client.Core.Offline.$25.$20(t,i),Microsoft.Crm.Client.Core.Offline.$25.$CM.$lK(t)){h=Microsoft.Crm.Client.Core.Offline.$25.$1HH(n,t);e=Microsoft.Crm.Client.Core.Offline.$25.$CM.$1bv(t).$jh;for(var s=e.get_$2ph(),c=s.length,o=0;o<c;++o)f=s[o],r[n+"!"+f]=e.get_$R(f)===Microsoft.Crm.Client.Core.Framework.Guid?f in u?Microsoft.Crm.Client.Core.Framework.Guid.createFromObjectData(u[f]).toString().toUpperCase():"":f in u?u[f]:""}else switch(t){case 13:case 12:case 0:case 11:r[n]=$0.$0(u.value)?-1:u.value;break;case 15:r[n]=!$0.$0(i)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(i.toString())?i.toString().toUpperCase():"";break;case 2:r[n]=$0.$0(i)?"":Xrm.Soap.CrmDateTimeSerializer.$18j(i.toISOString());break;case 10:break;default:r[n]=i}return r};Microsoft.Crm.Client.Core.Offline.$25.$20=function(n,t){var i={};if($0.$0(t))return i;switch(n){case 9:case 6:case 1:i=t.getObjectData();break;case 11:case 0:case 12:case 13:i=t.$20();break;case 21:i=t.$20();break;case 10:i=t.getObjectData();break;case 15:i=t.getObjectData()}return i};Microsoft.Crm.Client.Core.Offline.$2C=function(n,t,i,r){this.$4A=new Array(0);this.$9y=new Array(0);this.$gw=new Array(0);this.$166=new Array(0);this.$1Zs=new Array(0);this.$4V=i;this.$1Q=r;var u=this.$2fd(n,t);this.$5A=Microsoft.Crm.Client.Core.Offline.$v.$2Wk(n,u);this.$mU=t};Microsoft.Crm.Client.Core.Offline.$2C.get_$1Y4=function(){return["createdon","createdby","ownerid","modifiedon","modifiedby"]};Microsoft.Crm.Client.Core.Offline.$2C.get_$1uN=function(){return["modifiedon","modifiedby"]};Microsoft.Crm.Client.Core.Offline.$2C.get_$2Fx=function(){return["statecode","statuscode"]};Microsoft.Crm.Client.Core.Offline.$2C.get_$2x4=function(){return["activitypartyid","activityid!id","activityid!name","activityid!logicalname","participationtypemask","partyid!id","partyid!name","partyid!logicalname","ispartydeleted","partyobjecttypecode"]};Microsoft.Crm.Client.Core.Offline.$2C.$21E=function(n,t,i,r,u,f){var o=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.$2C,Microsoft.Crm.Client.Core.Framework.$7),e=new Microsoft.Crm.Client.Core.Offline.$2C(n,t,u,f),s=u.$i(n.$a.LogicalName);return!$0.$0(s)&&s.get_$7g()?Microsoft.Crm.Client.Core.Offline.$Y.get_$5D().$2gI(n).then(function(n){e.$1Zs=n;e.$2EM(i,r);Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineQueryData_GetOfflineQueryDataObject",1005,"GetOfflineQueryDataObject completed succesfully");o.resolve(e)},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("OfflineQueryData_GetOfflineQueryDataObject - Failure",1005,n.$F);o.reject(n)}):(e.$2EM(i,r),Microsoft.Crm.Client.Core.Framework.$8.$B("OfflineQueryData_GetOfflineQueryDataObject",1005,"GetOfflineQueryDataObject completed succesfully"),o.resolve(e)),o.promise()};Microsoft.Crm.Client.Core.Offline.$2C.prototype={$1Q:null,$5A:null,$mU:0,$4V:null,$2EM:function(n,t){var r=new Array(0),a,v,i,f,u,s,h,c,e,l;for(r=this.$mU===1?(a=this.$5A.$4w.toArray()).concat.apply(a,Microsoft.Crm.Client.Core.Offline.$2C.get_$1uN()):this.$5A.get_fieldNames(),v=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(this.$1Zs),i=0;i<r.length;i++)if(this.$5A.$27[r[i]]===10){f=new Array(0);for(var y=this.$5A.getValue(r[i]).get_entities(),w=y.length,o=0;o<w;++o)u=y[o],s=u.hasField("activitypartyid")?u.getValue("activitypartyid"):Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),this.$mU===1&&u.hasValue("activitypartyid")&&s!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()&&v.contains(s.toString().toUpperCase())?f[f.length]=u.getValue("activitypartyid").toString().toUpperCase():this.$gw[this.$gw.length]=this.$29n(r[i],u,t.toString());this.$mU===1&&(this.$166[this.$166.length]=this.$2yD(t.toString().toUpperCase(),f.length>0?f:[""],r[i]))}else{h=Microsoft.Crm.Client.Core.Offline.$25.$20a(r[i],this.$5A.$27[r[i]],this.$5A.getValue(r[i]));for(c in h)e={key:c,value:h[c]},this.$4A[this.$4A.length]=e.key,this.$9y[this.$9y.length]=$0.$0(e.value)?"":e.value.toString()}if(this.$5A.$a.LogicalName==="annotation"&&(this.$4A[this.$4A.length]="objecttypecode",this.$9y[this.$9y.length]=this.$5A.getValue("objectid").TypeCode.toString()),$0.$0(this.$5A.$a.$Nc)||(this.$4A[this.$4A.length]="versionnumber",this.$9y[this.$9y.length]=this.$5A.$a.$Nc),this.$mU)this.$mU===1&&(this.$9y[this.$9y.length]=t.toString().toUpperCase());else if(n in this.$5A.fields&&!$0.$0(this.$5A.$a)&&!$0.$0(this.$5A.$a.Id)&&this.$5A.$a.Id!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()||(this.$4A[this.$4A.length]=n,this.$9y[this.$9y.length]=t.toString().toUpperCase()),l=this.$4V.$i(this.$5A.$a.LogicalName),!$0.$0(l)&&l.get_$7g()){var b=new Xrm.Objects.EntityReference("activityparty",Microsoft.Crm.Client.Core.Framework.Guid.get_empty()),k=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)),p=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(b,{},{},{},{},k);p.initializeValue("partyid",this.$5A.getValue("ownerid"),6);this.$gw[this.$gw.length]=this.$29n("owner",p,t.toString())}},$2fd:function(n,t){var i=[],u,o,f,s,p,w,k,l,r;if(!t){u=Microsoft.Crm.Client.Core.Offline.$2C.get_$1Y4();u.push.apply(u,Microsoft.Crm.Client.Core.Offline.$2C.get_$2Fx());for(var v=u,g=v.length,e=0;e<g;++e)o=v[e],n.hasValue(o)||(i[i.length]=o);f=this.$4V.$i(n.$a.LogicalName);!$0.$0(f)&&f.get_$7g()&&(n.hasValue("activitytypecode")||n.initializeValue("activitytypecode",f.$y,14),n.hasValue("isregularactivity")||(s={},s.value=this.$2ow(n.$a.LogicalName)?"1":"0",n.initializeValue("isregularactivity",Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1x.$2y(s),0)))}if(!t||t===1){for(var y=Microsoft.Crm.Client.Core.Offline.$2C.get_$1uN(),nt=y.length,h=0;h<nt;++h)p=y[h],i[i.length]=p;if(w=this.$4V.$2q(n.$a.LogicalName,"fullname"),!$0.$0(w))for(var b=n.$4w.toArray(),tt=b.length,c=0;c<tt;++c)if(k=b[c],Array.contains(Microsoft.Crm.Client.Core.Offline.$2K.$1wn,k)){n.initializeValue("fullname",Mscrm.InternalUtilities.$4i.$2Yv(this.$1Q.$1I.$1GE,n.getValue("firstname"),n.getValue("middlename"),n.getValue("lastname")),14);n.$4w.add("fullname");break}}if(!t&&(l=this.$4V.$fX(n.$a.LogicalName,null),!$0.$0(l)))for(var d=l,it=d.length,a=0;a<it;++a)r=d[a],(!$0.$0(r.$9h)||!$0.$0(r.$CS))&&Array.indexOf(n.get_fieldNames(),r.$y)<0&&Array.indexOf(i,r.$y)<0&&(i[i.length]=r.$y);return i},$2ow:function(n){var t=this.$4V.$i(n);switch(t.$9p){case 4208:case 4209:case 4211:case 4206:case 4406:case 4251:return!1}return t.$zb?!0:!1},$29n:function(n,t,i){var r=t.getFieldObjectData("partyid"),u=this.$4V.$2q("activityparty","ispartydeleted"),f=t.hasField("activitypartyid")&&t.getValue("activitypartyid")!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?t.getValue("activitypartyid"):Microsoft.Crm.Client.Core.Framework.Guid.newGuid(),e=[f.toString().toUpperCase(),i.toUpperCase(),this.$5A.$a.Name,this.$5A.$a.LogicalName,Microsoft.Crm.Client.Core.Offline.$2K.$1Mn[n].toString(),Microsoft.Crm.Client.Core.Framework.Guid.createFromObjectData(r.id).toString().toUpperCase(),$0.$0(r.name)?"":r.name.toString(),r.logicalname.toString(),!$0.$0(u)&&u.$9h?"1":"0",this.$4V.$i(r.logicalname.toString()).$9p.toString()];return{entityreference:t.$a,columns:Microsoft.Crm.Client.Core.Offline.$2C.get_$2x4(),values:e}},$2yD:function(n,t,i){return{activityid:n,participationtypemask:Microsoft.Crm.Client.Core.Offline.$2K.$1Mn[i].toString(),resolvedparties:t}}};Microsoft.Crm.Client.Core.Offline.$j=function(){};Microsoft.Crm.Client.Core.Offline.$j.get_$6=function(){return Microsoft.Crm.Client.Core.Offline.$j.$C||(Microsoft.Crm.Client.Core.Offline.$j.$C=new Microsoft.Crm.Client.Core.Offline.$j),Microsoft.Crm.Client.Core.Offline.$j.$C};Microsoft.Crm.Client.Core.Offline.$j.$1sb=function(n){var t="";switch(n){case 0:t="=";break;case 1:t="<>";break;case 2:t="<";break;case 3:t="<=";break;case 4:t=">";break;case 5:t=">=";break;case 6:t="ISNULL";break;case 7:t="IN"}return t};Microsoft.Crm.Client.Core.Offline.$j.$2QA=function(n){var t="";switch(n){case 1:t="OR";break;case 0:t="AND"}return t};Microsoft.Crm.Client.Core.Offline.$j.prototype={$1GH:function(n,t){for(var r,u="",f="",i=0;i<t.length;i++)r=i>0?",":"",u+=r+"["+t[i]+"]",f+=r+"?";return"INSERT INTO ["+n.LogicalName+"] ("+u+") VALUES ("+f+")"},$1aX:function(n,t,i){var u=n.LogicalName,f=new Microsoft.Crm.Client.Core.Framework.Storage.$79(new Microsoft.Crm.Client.Core.Framework.Storage.$3l(i),n.get_key()),e=new Microsoft.Crm.Client.Core.Framework.Storage.$Lj(f,null),r=Microsoft.Crm.Client.Core.Storage.PhysicalAccess.Sql.$4w.$X(e,u,!0),o=$0.$0(t)?r.$1ko():r.$1PR.apply(r,t);return o+" COLLATE NOCASE"},$1x5:function(n,t,i){for(var u="UPDATE "+n.LogicalName+" SET ",r=0;r<t.length;r++)u+=(r>0?",":"")+"["+t[r]+"] = ?";return u+=" WHERE ["+i+"] = ?",u+" COLLATE NOCASE"},$1wv:function(n,t){var i=t.$oi,r="DELETE FROM ["+n.LogicalName+"] ";return i&&i.length>0&&(r=r+"WHERE "+this.$1tt(i)+" COLLATE NOCASE"),r},$2Yq:function(n,t){return"SELECT EXISTS(SELECT 1 FROM "+n.LogicalName+" WHERE ["+t+"] = ? LIMIT 1)"},$2ZB:function(n,t,i){for(var o,u,s,f="",e="",r=0;r<t.length;r++)o=r>0?",":"",f+=o+"["+t[r]+"]";for(u=0;u<n;u++)s=u>0?" OR":"",e+=s+"["+i.$4Y+"] = ?  COLLATE NOCASE";return"SELECT "+f+" FROM "+i.$y+" WHERE "+e},$2ZD:function(n,t){var i=t.$oi,r="SELECT * FROM "+n;return i&&i.length>0&&(r=r+" WHERE "+this.$1tt(i)+this.$2S9(t)+" COLLATE NOCASE"),r},$2S9:function(n){var t="",i;return!$0.$0(n.$xs)&&n.$xs>0&&(i=$0.$0(n.$19U)?"":" OFFSET "+n.$19U.toString(),t+=" LIMIT "+n.$xs.toString()+i),t},$1tt:function(n){for(var r,e,u,f,i="",t=0;t<n.length;t++){if(r=n[t].$1Ar?"":" (",e=n[t].$1Ar===1?" )":"",i+=t?" "+Microsoft.Crm.Client.Core.Offline.$j.$2QA(n[t].$1Th)+r+" ["+n[t].$1c+"] "+Microsoft.Crm.Client.Core.Offline.$j.$1sb(n[t].$I2):r+" ["+n[t].$1c+"] "+Microsoft.Crm.Client.Core.Offline.$j.$1sb(n[t].$I2),n[t].$I2===7){for(u=n[t].$4j.get_Items().length,i+=u>0?"(?":"(",f=1;f<u;f++)i+=", ?";i+=")"}else n[t].$I2!==6&&(i+=" ?");i+=e}return i},$2ZC:function(n,t,i){for(var o,s,h,r="",f="",u="",e=0;e<n.length;e++)r+="["+n[e].$1S+"],";r=r!==""?r.substr(0,r.length-1):r;f="[activityid!id] = ?";o=t;for(s in o)h={key:s,value:o[s]},u+="?,";return u!==""&&(u=u.substr(0,u.length-1),f+=" AND [participationtypemask] in ("+u+")"),"SELECT "+r+" FROM "+i+" WHERE "+f+" COLLATE NOCASE ORDER BY [participationtypemask]"},$2Yj:function(){return"DELETE FROM [activityparty] WHERE [activityid!id] = ? COLLATE NOCASE"},$2Yk:function(n){for(var i="",t=n;t>0;t--)i+=t>1?"?,":"?";return"DELETE FROM [activityparty] WHERE [activityid!id] = ? AND [participationtypemask] = ?  AND [activitypartyid] NOT IN ("+i+") COLLATE NOCASE"},$3Ab:function(n){for(var t="",i=n;i>0;i--)t+="?,";return t.length>1&&(t=t.substring(0,t.length-1)),"UPDATE [activityparty] SET [activityid!id] = ? WHERE [activityid!id] = ? AND [participationtypemask] = ?  AND [activitypartyid] IN ("+t+") COLLATE NOCASE"},$2Ya:function(n,t,i,r,u){var e="CREATE VIEW activitypointer AS ",o=this.$1bm(n,t,r,u),f=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),s=new Microsoft.Crm.Client.Core.Storage.DataApi.$5D("activitypointer".toLocaleLowerCase()),h=this;return i.$5e(s,t).then(function(n){h.$2ZG(n,o,t,i).then(function(n){e+=n;f.resolve(e)},function(){f.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline DB could not create view query."))})},null),f.promise()},$2YZ:function(n){var t="CREATE VIEW activityattachment AS ",r=Array.indexOf(n,"template")>-1,i=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7);return t+=this.$2ZF(r),i.resolve(t),i.promise()},$2Ym:function(n){return"DROP VIEW "+n},$2ZG:function(n,t,i,r){for(var v,y,p,e=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),o="",u="",s="",l="",h=0,f=new Microsoft.Crm.Client.Core.Offline.$i,a=[],c=0;c<t.length;c++)v=new Microsoft.Crm.Client.Core.Storage.DataApi.$5D(t[c].toString()),Array.add(a,r.$5e(v,i));return y=this,p=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(a).then(function(t){for(var k,v,i,y,r,p,c,d,g,w,a,it,nt,tt=t,rt=tt.length,b=0;b<rt;++b){for(k=tt[b],o="SELECT ",h=0,v=0;v<n.get_$3F6();v++)if(i=n.get_$R(v),i.$26!==17){for(y=0;y<k.get_$3F6();y++)if(u="",r=k.get_$R(y),!$0.$0(r.$lD)&&r.$lD===i.$y){if(f.$lK(r.$26))for(p=f.$1bv(r.$26).$jh,c=0;c<p.get_$2ph().length;c++)d=p.get_$2ph()[c],g="["+r.$y+"!"+d+"] AS ["+i.$y+"!"+d+"]",u+=c!==p.get_$2ph().length-1?g+", ":g;else u+=r.$y+" AS "+i.$y;l=r.$P;break}if(!u.length&&f.$lK(i.$26))for(w=f.$1bv(i.$26).$jh,a=0;a<w.get_$2ph().length;a++)it=w.get_$2ph()[a],nt="NULL AS ["+i.$y+"!"+it+"]",u+=a!==w.get_$2ph().length-1?nt+", ":nt;else u.length||(u+="NULL AS "+i.$y);o+=h>0?", "+u:u;h++}s+=(s.length>0?" UNION ALL ":"")+o+" FROM "+l}e.resolve(s)},function(){e.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline DB could not create view query."))}),e.promise()},$2ZF:function(n){return Microsoft.Crm.Client.Core.Framework.$3.$IY("select xxemail.activityid, xxattachment.body, xxattachment.filename, xxattachment.filesize, xxattachment.mimetype, xxattachment.subject,{0},{1},{2},{3},[xxactivitymimeattachment].[attachmentnumber],[xxactivitymimeattachment].[activitymimeattachmentid],[xxactivitymimeattachment].[versionnumber],[xxactivitymimeattachment].[attachmentid!id],[xxactivitymimeattachment].[attachmentid!name],[xxactivitymimeattachment].[attachmentid!logicalname],[xxactivitymimeattachment].[objectid!id],[xxactivitymimeattachment].[objectid!name],[xxactivitymimeattachment].[objectid!logicalname],[xxactivitymimeattachment].[objecttypecode],[xxactivitymimeattachment].[componentstate],[xxactivitymimeattachment].[overwritetime],[xxactivitymimeattachment].[solutionid],[xxactivitymimeattachment].[supportingsolutionid],[xxactivitymimeattachment].[activitymimeattachmentidunique],[xxactivitymimeattachment].[ismanaged],[xxactivitymimeattachment].[attachmentcontentid] from[activitymimeattachment][xxactivitymimeattachment] left join activitypointer xxemail on xxactivitymimeattachment.[objectid!id] = xxemail.activityid and xxemail.activitytypecode='email' {4} left join attachment xxattachment on xxactivitymimeattachment.[attachmentid!id] = xxattachment.attachmentid where datetime(xxactivitymimeattachment.overwritetime) = datetime('1900-01-01') and xxactivitymimeattachment.componentstate = 0","case when coalesce(xxemail.owneridtype, "+(n?"xxtemplate.owneridtype":'""')+") = 8 then coalesce(xxemail.[ownerid!id],"+(n?"xxtemplate.[ownerid!id]":'""')+") else null end as 'owninguser'","coalesce(xxemail.[ownerid!id], "+(n?"xxtemplate.[ownerid!id]":'""')+") as 'ownerid!id',coalesce(xxemail.[ownerid!logicalname], "+(n?"xxtemplate.[ownerid!logicalname]":'""')+") as 'ownerid!logicalname',coalesce(xxemail.[ownerid!name], "+(n?"xxtemplate.[ownerid!name]":'""')+") as 'ownerid!name'","coalesce(xxemail.owneridtype, "+(n?"xxtemplate.owneridtype":'""')+") as 'owneridtype'","coalesce(xxemail.[owningbusinessunit!id], "+(n?"xxtemplate.[owningbusinessunit!id]":'""')+") as 'owningbusinessunit!id',coalesce(xxemail.[owningbusinessunit!logicalname], "+(n?"xxtemplate.[owningbusinessunit!logicalname]":'""')+") as 'owningbusinessunit!logicalname',coalesce(xxemail.[owningbusinessunit!name], "+(n?"xxtemplate.[owningbusinessunit!name]":'""')+") as 'owningbusinessunit!name'",n?" left join template xxtemplate on xxactivitymimeattachment.[objectid!id] = xxtemplate.templateid":"")},$1bm:function(n,t,i,r){for(var s,u,f=[],o=r,h=o.length,e=0;e<h;++e)s=o[e],u=n.$i(s),!$0.$0(u)&&u.get_$7g()&&u.$y.toLowerCase()!=="activitypointer".toLowerCase()&&Array.indexOf(r,u.$y.toLowerCase())>=0&&($0.$0(i)||Array.indexOf(i,u.$y.toLowerCase())>=0)&&(f[f.length]=u.$y.toLowerCase());return f},$32c:function(n){for(var t="",i=n;i>0;i--)t+="?,";return t!==""&&(t=t.substr(0,t.length-1)),"SELECT MIN(lastdatasynctime) AS [lastdatasynctime] FROM entitysettings WHERE entitylogicalname IN ("+t+") COLLATE NOCASE"},$1GI:function(){return Microsoft.Crm.Client.Core.Offline.$j.$2GF},$1GJ:function(){return Microsoft.Crm.Client.Core.Offline.$j.$2GE}};Microsoft.Crm.Client.Core.Offline.$K5=function(n){this.$18p=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.$K6));this.$1mC=n};Microsoft.Crm.Client.Core.Offline.$K5.prototype={$1mC:!1,$2Jr:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$K6;i.$N3=n;i.$190=t;i.$uu="Create";this.$18p.add(i)},$2LI:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$K6;i.$N3=n;i.$190=t;i.$uu="Update";this.$18p.add(i)},$2Jx:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$K6;i.$N3=n;i.$TJ=t;i.$uu="Delete";this.$18p.add(i)}};Microsoft.Crm.Client.Core.Offline.$K6=function(){};Microsoft.Crm.Client.Core.Offline.$K6.prototype={$N3:null,$190:null,$TJ:null,$uu:null};Microsoft.Crm.Client.Core.Offline.$K7=function(n,t){var i,f,r,u,e,o,s;if(this.$E9=[],this.$ex=[],$0.$0(t)){u=0;e=n;for(o in e)s={key:o,value:e[o]},this.$E9[u]=s.key,this.$ex[u]=this.$sL(s.value),u++}else for(i=0;i<t.length;i++)if(t[i].$I2===7)for(f=t[i].$4j,r=0;r<f.get_Items().length;r++)this.$ex.push(this.$sL(f.get_Items()[r]));else this.$ex.push(this.$sL(t[i].$4j))};Microsoft.Crm.Client.Core.Offline.$K7.prototype={$sL:function(n){return Microsoft.Crm.Client.Core.Framework.Guid.isInstanceOfType(n)?n.toString():n}};Microsoft.Crm.Client.Core.Offline.$3s=function(){};Microsoft.Crm.Client.Core.Offline.$3s.get_$5D=function(){return $0.$0(Microsoft.Crm.Client.Core.Offline.$3s.$3)&&(Microsoft.Crm.Client.Core.Offline.$3s.$3=new Microsoft.Crm.Client.Core.Offline.$3s),Microsoft.Crm.Client.Core.Offline.$3s.$3};Microsoft.Crm.Client.Core.Offline.$3s.prototype={$2G3:function(n){var t=this,i=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N().$341(n,"MaxTime").then(function(){Microsoft.Crm.Client.Core.Framework.$8.$B("SecurityUtil",1005,"StoreMaxDate: New Date is "+n)},function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtilFailureErrors",1005,"StoreMaxDate Error: "+n.$F.toString())})},$32m:function(){var n=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N().$32o("MaxTime").then(function(t){Microsoft.Crm.Client.Core.Framework.$8.$B("SecurityUtil",1005,"RetrieveMaxDate: "+t);n.resolve(t)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtilFailureErrors",1005,"RetrieveMaxDate Error: "+t.$F.toString());n.reject(t)}),n.promise()},$2o6:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return this.$32m().then(function(i){Microsoft.Crm.Client.Core.Framework.$3.$9(i)&&(i=null);t.$1qh(i).then(function(t){Microsoft.Crm.Client.Core.Framework.$3.$9(i)||(i=Xrm.Soap.CrmDateTimeSerializer.$vA(i));!$0.$0(t)&&t>new Date(i)?n.resolve(!0):n.resolve(!1)},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtilFailureErrors",1005,"IsFullSyncRequired: CalculateAndStoreMaxDate Error: "+t.$F.toString());n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtilFailureErrors",1005,"IsFullSyncRequired: RetrieveMaxDate Error: "+t.$F.toString());n.reject(t)}),n.promise()},$1qh:function(n){var t=MscrmComponents.DeferredPromiseFactory(Date,Microsoft.Crm.Client.Core.Framework.$7),u=new Array(0),i=n;$0.$0(n)||(n=Xrm.Soap.CrmDateTimeSerializer.$vA(n),u[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("CreatedOn",i,1,4));var r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(u),f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t,e=this,o=this;return f.$7m("UserEntityAttributeMap",r).then(function(r){var o=new Date(n),u,f,s;if(r.rows.length>0)for(u=0;u<r.rows.length;u++)$0.$0(r.rows.item(u))||(f=r.rows.item(u).CreatedOn,Microsoft.Crm.Client.Core.Framework.$3.$9(f)?Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtil",1005,"CalculateAndStoreMaxDate date is not stored for row: "+u):(s=new Date(Xrm.Soap.CrmDateTimeSerializer.$vA(f)),o<s&&(o=s,i=f)));e.$2G3(i);t.resolve(o)},function(i){if($0.$0(n))Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtilFailureErrors",1005,"CalculateAndStoreMaxDate retrieve data was null Error: "+i.$F.toString()),t.reject(i);else{var u=new Array(0);r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(u);f.$7m("UserEntityAttributeMap",r).then(function(){Microsoft.Crm.Client.Core.Framework.$8.$u("SecurityUtil",1005,"CalculateAndStoreMaxDate retrieve data Error: "+i.$F.toString());t.reject(i)},function(){t.resolve(new Date);o.$2G3("1970-01-01 00:00:00.000")})}}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$4q=function(){};Microsoft.Crm.Client.Core.Offline.$4q.$qZ=function(n,t,i,r,u,f,e,o,s,h,c,l){var b=Microsoft.Crm.Client.Core.Offline.$4q.$2gG(h),k=b!==1&&t.toLowerCase()!=="create"?new Xrm.Objects.EntityReference(n,i,r):null,a={},v={},y=new Array(0),w,p;return y.push("name"),a.name=14,v.name=n,y.push("action"),a.action=14,v.action=t,$0.$0(k)||(y.push("regardingobjectid"),a.regardingobjectid=6,v.regardingobjectid=k,y.push("regardingobjectidname"),a.regardingobjectidname=14,v.regardingobjectidname=r,y.push("regardingobjecttypecode"),a.regardingobjecttypecode=20,v.regardingobjecttypecode=u),y.push("errormessage"),a.errormessage=14,v.errormessage=Microsoft.Crm.Client.Core.Offline.$4q.$2Gx("errormessage",f),y.push("actiondata"),a.actiondata=14,v.actiondata=e,y.push("errortime"),a.errortime=2,v.errortime=o,y.push("requestdata"),a.requestdata=14,v.requestdata=s,y.push("errorcode"),a.errorcode=14,v.errorcode=h.toString(),w={},w.value=b,y.push("errortype"),a.errortype=11,v.errortype=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1x.$2y(w),y.push("errordetail"),a.errordetail=14,v.errordetail=Microsoft.Crm.Client.Core.Offline.$4q.$2Gx("errordetail",c),p=l,$0.$0(p)&&(p=new Xrm.Objects.EntityReference("syncerror",Microsoft.Crm.Client.Core.Framework.Guid.newGuid())),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(p,v,a,{},{},new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)))};Microsoft.Crm.Client.Core.Offline.$4q.$2gG=function(n){var t;switch(n){case-2147220969:t=1;break;case-2147220685:case-2147220937:t=2;break;case-2147088254:case-2147088253:t=0;break;default:t=3}return t};Microsoft.Crm.Client.Core.Offline.$4q.$2Gx=function(n,t){var i=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q("syncerror",n);return!$0.$0(i)&&!$0.$0(t)&&t.length>i.$KP?t.substring(0,i.$KP):t};Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider=function(n){this.$AE=n;this.$15V=Microsoft.Crm.Client.Core.Storage.DataApi.$D.get_$6().$34;this.$6o=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp();this.$LT=new Microsoft.Crm.Client.Core.Framework.$MA("OfflineSyncErrorLogProvider.BatchedCallbackRunner",Microsoft.Crm.Client.Core.Framework.SchedulerPriorities.$1L2)};Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider.prototype={$6o:null,$LT:null,$15V:null,$AE:null,$2SU:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$7),r=this,u=this;return this.$AE.get_$5a().$X(n,!0,t).then(function(n){Microsoft.Crm.Client.Core.Framework.$8.$u("MOCADataSyncFailureErrors",1005,"CreateOfflineSyncErrorLog Success");i.resolve(n)},function(t){var r=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$PI("1005","MOCADataSyncFailureErrors","","",0,"",n.get_key().toString()+" "+t.$F.toString(),Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),(new Date).toString(),"",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1T(r);Microsoft.Crm.Client.Core.Framework.$8.$u("MOCADataSyncFailureErrors",1005,"CreateOfflineSyncErrorLog Error: "+t.$F.toString());i.reject(t)}),i.promise()},$1PA:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$7),r=this,u=this;return this.$AE.$bJ(n,t,!0).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise()},$w3:function(n){return this.$AE.$w3(n)},$24W:function(){return!$0.$0(this.$AE)&&!$0.$0(this.$AE.get_$5a())&&this.$AE.get_$5a().get_$4K()}};Microsoft.Crm.Client.Core.Offline.$K4=function(n){this.$1R5=n};Microsoft.Crm.Client.Core.Offline.$K4.prototype={$1R5:0};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q=function(){this.$2Z()};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.prototype={$2Z:function(){Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(15),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(0),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(14),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(11),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(12),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(13),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(20),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$lm,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mI,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$jQ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mG,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$kH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$mH,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(1),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(6),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1ZU,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1gb]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(9),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$UN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1ZU,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1gb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1vV,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$1vU]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(5),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(18),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(4),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(3),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(8),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.set_$R(this.$5t(2),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["on-or-after","on","on-or-before","today","tomorrow","yesterday","next-seven-days","last-seven-days","next-week","last-week","this-week","next-month","last-month","this-month","next-year","last-year","this-year","last-x-days","next-x-days","last-x-weeks","next-x-weeks","last-x-months","next-x-months","last-x-years","next-x-years","not-null",Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$GF,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Da,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$EN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$Tk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$fb,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$U2,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$E.$gL]))},$5t:function(n){return Xrm.Objects.AttributeType.toString(n)},get_$1q1:function(){return Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn.$1RT()}};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$Ol=function(){Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$Ol.initializeBase(this);this.$CM=new Microsoft.Crm.Client.Core.Offline.$i;this.$Bn=new Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$Ol.prototype={$CM:null,$Bn:null,$2Jk:function(n,t,i){this.$xB(n,"attributeName");this.$xB(t,"entityName");var r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q(t,n);this.$xB(r,Microsoft.Crm.Client.Core.Framework.$3.$IY("attributeMetadata: {0}.{1}",t,n));this.$CM.$lK(r.$26)&&this.$2Jl(n,r,t,i)},$2Jl:function(n,t,i,r){for(var f,o=Microsoft.Crm.Client.Core.Offline.$25.$1HH(n,t.$26),s=this.$sG(n,i),e=o,h=e.length,u=0;u<h;++u)f=e[u],f!==s&&this.$98.get_$nL().append(Microsoft.Crm.Client.Core.Framework.$3.$IY("{0} [{1}].[{2}] as [{2}]",Microsoft.Crm.Client.Core.Framework.$3.$9(this.$98.get_$nL().toString())?"":",",r,f))},$39Y:function(n){if(!Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$6G.$1dv(n))throw Error.create(Microsoft.Crm.Client.Core.Framework.$3.$IY("Attribute type {0} for attribute {1} not supported in offline",n.$26,n.$y));},$sG:function(n,t){if($0.$0(n)||$0.$0(t))throw Error.create("Attribute name or entity name cannot be null or undefined");var i=null,r,u;return n=(u=Microsoft.Crm.Client.Core.Storage.Common.$15.$rk(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W(),t,n,r={val:i}),i=r.val,u),n.endsWith("]")&&n.startsWith("[")&&(n=n.substring(1,n.length-1)),n},$39d:function(n,t,i){var r,u;if($0.$0(n)||$0.$0(t))throw Error.create("Attribute name or entity name cannot be null or undefined");if(r=Microsoft.Crm.Client.Core.Storage.Common.QueryGenerator.$26.$2q(n,t),!$0.$0(r)&&Xrm.Objects.AttributeType.toString(r.get_$4M())in this.$Bn.get_$1q1()&&(u=this.$Bn.get_$1q1()[Xrm.Objects.AttributeType.toString(r.get_$4M())],!u.contains(i)))throw Error.create(Microsoft.Crm.Client.Core.Framework.$3.$IY("Condition Operation {0} is not supported on Attribute Type {1}",i,Xrm.Objects.AttributeType.toString(r.get_$4M())));return},$210:function(n,t,i,r,u){var f=new Sys.StringBuilder;return f.append(String.format('\n left outer join {0} as "{1}" on ("{1}".[ObjectId!id] = "{2}".{3} and "{1}".LanguageId = {4} and "{1}".{5} like "%{6}%" )',"businessdatalocalizedlabel",r,n,t,i,"objectcolumnname",u)),f}};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$6G=function(){};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$6G.$1dv=function(n){var t=!0;return Microsoft.Crm.Client.Core.Offline.$v.$1J7(n.$26)&&$0.$0(n.$QD)||(t=!1),t};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Ef=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Ef.registerInterface("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Ef");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo.initializeBase(this,[n]);this.$Ga=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo.prototype={$X:function(n,t){this.$Ga.$X(n,t)},$7m:function(n,t){return this.$Ga.$7m(n,t)},$9W:function(n,t){this.$Ga.$9W(n,t)},Delete:function(n,t){this.$Ga.Delete(n,t)},$1qH:function(n){this.$Ga.$1qH(n)},Commit:function(n){return this.$Ga.Commit(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t.$29Q=function(n,t){for(var i,f,u,e,o,r=0;r<n.get_Count();r++)i=n.get_$R(r),i.$mV===1?Object.isInstanceOfType(i.$4C)&&(f=i.$4C,t.$X(i.$Lt,f)):i.$mV===2?(u=i.$4C,u&&(e=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(u),t.Delete(i.$Lt,e))):i.$mV===3&&Object.isInstanceOfType(i.$4C)&&(o=i.$4C,t.$9W(i.$Lt,o))};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t.prototype={$h1:function(n,t,i){var f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om,r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo(f);r.$1qH(i);!$0.$0(t)&&t.get_Count()>0&&Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t.$29Q(t,r);!$0.$0(n)&&n.get_Count()>0&&Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t.$29Q(n,r);var u=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),e=this,o=this;return r.Commit(f.$AP).then(function(){u.resolve(!0)},function(n){u.reject(n)}),u.promise()},$7m:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om;return i.$7m(n,t)},$rm:function(){var n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N().get_$5a();return n.$rm()},$2QB:function(n,t,i,r){var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$7),f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i),e=this,o=this;return this.$2g6(i,f,n,t,r).then(function(n){u.resolve(n)},function(n){u.reject(n)}),u.promise()},$2g6:function(n,t,i,r,u){var e=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$7),f,c,l,o,s,a,h,v,y;if($0.$0(i)||Microsoft.Crm.Client.Core.Framework.$3.$9(i[t.$4Y]))e.resolve(null);else{f=new Array(0);c=i;for(l in c)o={key:l,value:c[l]},s=o.key.toLowerCase(),s.indexOf("norsync")<0&&s.toLowerCase()!=="_MODIFIED_ON".toLowerCase()&&(s.indexOf("!")<0?f.push(o.key):(a=o.key.split("!"),h=Microsoft.Crm.Client.Core.Framework.$3.$9(a[0])?"":a[0],Microsoft.Crm.Client.Core.Framework.$3.$9(h)||Array.indexOf(f,h)!==-1||f.push(h)));v=this;y=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$OY(n,f).then(function(n){var o=u!==3?i:r,s=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$28(2,0),f=Microsoft.Crm.Client.Core.Offline.$v.$qZ(o,n,t,s);f=Microsoft.Crm.Client.Core.Offline.$v.$2xb(f,n,u,i,r);e.resolve(f)},function(){e.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline DB could not retrieve data"))})}return e.promise()}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om=function(){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om.initializeBase(this);this.$mK=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N().get_$5a()};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om.prototype={$AP:null,$mK:null,$X:function(n,t){this.$AP.$2Jr(n,t)},$7m:function(n,t){return this.$mK.$1Om(n,t)},$9W:function(n,t){this.$AP.$2LI(n,t)},Delete:function(n,t){this.$AP.$2Jx(n,t)},$1qH:function(n){this.$AP=new Microsoft.Crm.Client.Core.Offline.$K5(n)},Commit:function(n){return this.$mK.$2W1(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$KB=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On.initializeBase(this);this.$Ga=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On.prototype={$Ga:null};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l=function(n,t,i){this.$4C=n;this.$mV=t;this.$Lt=i};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l.prototype={$4C:null,$mV:0,$Lt:null,get_entity:function(){return this.$4C},set_entity:function(n){return this.$4C=n,n},get_operationPerformed:function(){return this.$mV},set_operationPerformed:function(n){return this.$mV=n,n},get_entityType:function(){return this.$Lt},set_entityType:function(n){return this.$Lt=n,n}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8=function(n,t,i,r,u){this.$1c=n;this.$4j=t;this.$1Th=i;this.$I2=r;this.$1Ar=$0.$0(u)?2:u};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8.prototype={$1c:null,$4j:null,$1Th:0,$I2:0,$1Ar:0};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn.initializeBase(this,[n]);this.$Ga=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn.prototype={$X:function(n,t){this.$Ga.$X(n,t)},$7m:function(n,t){return this.$Ga.$7m(n,t)},$9W:function(n,t){this.$Ga.$9W(n,t)},Delete:function(n,t){this.$Ga.Delete(n,t)},$1qH:function(n){this.$Ga.$1qH(n)},Commit:function(n){return this.$Ga.Commit(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9=function(n,t,i){this.$oi=n;$0.$0(i)||(this.$19U=i);$0.$0(t)||(this.$xs=t)};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9.prototype={$19U:0,$xs:0,$oi:null};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$KA=function(n){this.$em=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Xrm.Objects.EntityReference));this.$BL=n;this.$SS=!1;this.$9D=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70));this.$im=[];this.$pO={};this.$j2=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Number));this.$zM=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Number));this.$iQ=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String));this.$NO=Microsoft.Crm.Client.Core.Framework.Guid.get_empty()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$KA.prototype={$BL:null,$9D:null,$pO:null,$Fm:0,$2GL:3,$j2:null,$NO:null,$zM:null,$iQ:null,$im:null,$SS:!1,$29u:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,i;if(this.$SS)Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.NetworkFailure","ProcessPlaybackQueue Stopped"),Array.clear(this.$im),n.resolve(!1);else if(this.$im.length){var r=Array.dequeue(this.$im),u=this,f=this;this.$2A5(r,0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Success","BatchItem Processed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Failure",t.$F);n.reject(t)})}else this.$j2.get_Count()>0&&this.$BL.$1rf(this.$j2,this.$iQ,this.$NO),t=this,i=this,this.$1NA(!0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Success","ProcessPlaybackQueue Completed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Failure",t.$F);n.reject(t)});return n.promise()},$2A5:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList","ProcessUpSyncDataList Started"),$0.$0(n)||n.get_Count()===t||this.$SS?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Success","ProcessUpSyncDataList Completed"),i.resolve(!0)):(r=this,u=this,this.$2yr(n.get_Items()[t]).then(function(){r.$2A5(n,++t).then(function(){i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Failure",n.$F);i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Failure",n.$F);i.reject(n)})),i.promise()},$2yr:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i,r;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Started","ProcessUpSyncDataList Started"),$0.$0(n)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed"),t.resolve(!0)):(i=this,r=this,this.$2Vp(n).then(function(r){r&&!i.$SS?n.get_$e5()?i.$2yg(n).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$F);t.reject(n)}):i.$2yT(n).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$F);t.reject(n)}):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed"),t.resolve(!0))},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$F);t.reject(n)})),t.promise()},$2Vp:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i,r;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired","ExecuteActionDataListIfRequired Started"),i=n.get_$LR().$SY,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$1lo().contains(i))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Success","ExecuteActionDataListIfRequired Completed"),this.$zh(n.get_$LR()),t.resolve(!1);else{if(n.get_$e5())return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Non-CRUDActionEncountered","ExecuteActionDataListIfRequired Completed"),this.$1NA(!0);if(r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(n.get_$LR()),r!=="activityparty"&&this.$9D.get_Count()===Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance().get_$1LF())return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Success","ExecuteActionDataListIfRequired Completed"),this.$1NA(!0);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.CheckActionDataListForExecution.Success","CheckActionDataListForExecution Completed");t.resolve(!0)}return t.promise()},$2yT:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem","ProcessCRUDItem Started"),i=n.$Bi.$a.LogicalName,i==="activityparty")Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem.Success","ProcessCRUDItem Completed"),this.$2kF(n),t.resolve(!0);else return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem.Success","ProcessCRUDItem Completed"),this.$9D.add(n),this.$1NA(!1);return t.promise()},$1NA:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7);return(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList","ProcessActionDataList Started"),this.$9D.get_Count()>0&&(n||this.$9D.get_Count()===Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance().get_$1LF()&&!this.$2oJ()))?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList.Success","CRUD Criteria satisfied for Execution"),this.$2yS(),this.$1s6(0).always(this.$22L())):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList.Success","ProcessActionDataList Completed"),t.resolve(!0),t.promise())},$2yS:function(){var r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),i,n,t;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessCrudCommandAction","ProcessCrudCommandAction Started"),i=0;i<this.$9D.get_Count();i++)(n=this.$9D.get_Items()[i],$0.$0(n))||(r.contains(n.$Bi.get_key())?"versionnumber"in n.$Bi.fields&&(delete n.$Bi.fields.versionnumber,n.$j3===2&&(n.$Bi.$a.$Nc="")):(t=n.$Bi.get_key(),r.add(t),t in this.$pO&&(n.$Bi.initializeValue("versionnumber",this.$pO[t].toString(),14),n.$Bi.$a.$Nc=this.$pO[t].toString(),n.$Bi.$4w.remove("versionnumber"))));Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessCrudCommandAction.Success","ProcessCrudCommandAction Completed")},$2oJ:function(){var t=this.$9D.get_Items()[this.$9D.get_Count()-1],i,n;return $0.$0(t)?!1:(i=t.$Bi.$a.LogicalName,n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i),!$0.$0(n)&&n.get_$7g()?!0:!1)},$2kF:function(n){var t,i,e,o;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleActivityParty","HandleActivityParty Started"),t=this.$9D.get_Count()-1,t>=0&&!$0.$0(this.$9D.get_Items()[t])&&(i=this.$9D.get_Items()[t],!$0.$0(i))){var r=i.$Bi,u=n.$Bi,f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(r.$a.LogicalName);!$0.$0(f)&&f.get_$7g()&&(i.$Vh.add(n),r.hasField("activityid")&&(e=u.getValue("activityid"),o=r.getValue("activityid"),e.Id.toString()===o.toString()&&this.$2Ja(u,r)))}Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleActivityParty","HandleActivityParty Completed")},$2Ja:function(n,t){var u=n.getValue("participationtypemask"),i=Microsoft.Crm.Client.Core.Offline.$2K.$165[u.$1s.toString()],r;Microsoft.Crm.Client.Core.Framework.$3.$9(i)||(t.hasField(i)&&!$0.$0(t.getValue(i))?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.AddActivityPartyToActivity","Adding activity part to activity "+t.getValue("activitytypecode")),r=t.getValue(i),r.add(n)):(t.initializeValue(i,new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection([n],!1,1,!1),10),t.$4w.add(i)))},$2yg:function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessNonCRUDItem","ProcessNonCRUDItem Started"),this.$9D.add(n),this.$1s6(n.get_$e5()).always(this.$22L())},$1s6:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7);return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.CommandExecutor.Success","CommandExecutor Started"),n===2?Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.get_$6().$3Bu(this.$9D).then(this.$2l6(t),this.$22M(t)):Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.get_$6().$SD(n,this.$9D).then(this.$2l5(n,t),this.$22M(t)),t.promise()},$22L:function(){var n=this;return function(){n.$NO=Microsoft.Crm.Client.Core.Framework.Guid.get_empty();n.$9D.clear();n.$j2.clear();n.$iQ.clear();n.$zM.clear()}},$2l5:function(n,t){var i=this;return function(r){i.processSuccessResponse(n,r).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleSuccessResponse.Success","Command Execution succeeded");n?i.$1ij().then(function(){t.resolve(!0)},function(n){t.reject(n)}):t.resolve(!1)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.HandleSuccessResponse.Fail",n.$F);t.reject(n)})}},$2l6:function(n){var t=this;return function(i){t.processSuccessJsonResponse(i).then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleSuccssJSonResponse.Success","Command Execution succeeded");i?t.$1ij().then(function(){n.resolve(!0)},function(t){n.reject(t)}):n.resolve(!1)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.HandleSuccssJSonResponse.Fail",t.$F);n.reject(t)})}},$22M:function(n){var t=this;return function(i){t.processFailureResponse(i).then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleCrmErrorResponse.Success","Command Execution succeeded");i?t.$1ij().then(function(){n.resolve(!0)},function(t){n.reject(t)}):n.resolve(!1)},function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.HandleCrmErrorResponse.Failure",i.get_message());n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k(i.get_message()))})}},processFailureResponse:function(n){var t,r,u,i,f,e,o;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Start","Processing Failure Response Started"),t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),$0.$0(n)||$0.$0(n.$Ce))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded with no response"),t.resolve(!0);else if(n.$Ce.status&&n.$Ce.status!==503){for(r=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ,!$0.$0(n.$5b)&&!$0.$0(n.$5b.get_message())&&n.$5b.$Ab.get_Count()>0&&(n.$5b.$Ab.get_Items()[0]=n.$Ce.responseText),r=this.$1qd(n.$5b),u=[],i=this.$9D.get_Count()-1;i>=0;i--)this.$24u(this.$9D.get_Items()[i])?(this.$263(this.$9D.get_$R(i).get_$LR().$Fc),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Warning","One Sync Error Entity Failed to Upsync")):(f=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27(this.$BL),Array.add(u,f.$1Hw(this.$9D.get_Items()[i],r)));e=this;o=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(u).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Fail",n.$F);t.reject(n)})}else Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded with unknown status"),this.$SS=!0,t.resolve(!1);return t.promise()},processSuccessResponse:function(n,t){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),s,e,i,c,l,a,p;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse","ProcessSuccessResponse Started");this.$Fm=0;this.$em=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(Xrm.Objects.EntityReference));var u=[],f=t,v=f.responses.length;if(v||(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Command Execution Succeeded At Server"),r.resolve(!0)),f.isFaulted)for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.ServerFailure","Few Command Execution failed At Server"),e=f.responses.length-1;e>=0;e--)i=f.responses[e],!$0.$0(i.$DM)&&!$0.$0(i.$DM.$Ab)&&!$0.$0(i.$DM.$Ab.get_Items())&&i.$DM.$Ab.get_Count()>0?(c=this.$1qd(i.$DM),$0.$0(this.$9D.get_Items()[i.$Nb])||(this.$24u(this.$9D.get_Items()[i.$Nb])?this.$263(this.$9D.get_Items()[i.$Nb].get_$LR().$Fc):(l=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27(this.$BL),Array.add(u,l.$1Hw(this.$9D.get_Items()[i.$Nb],c))))):Array.add(u,this.processSuccessMultipleResponseItem(n,this.$9D.get_Items()[i.$Nb],i));else{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Command Execution Succeeded At Server");for(var h=f.responses,y=h.length,o=0;o<y;++o)s=h[o],Array.add(u,this.processSuccessMultipleResponseItem(n,this.$9D.get_Items()[s.$Nb],s))}return u.length?(a=this,p=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(u).then(function(){a.$2yl().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Processing Success Response succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Fail",n.$F);r.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Fail",n.$F);r.reject(n)})):r.resolve(!0),r.promise()},processSuccessMultipleResponseItem:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),u,e,f;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem","ProcessSuccessMultipleResponseItem Started"),n===1&&i.$9Y.name==="Retrieve")Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","ProcessSuccessMultipleResponseItem Completed"),u=i.$9Y.entity,$0.$0(u.$a.$Nc)||this.$em.set_$R(u.get_key(),u.$a),r.resolve(!0);else if(e=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ,$0.$0(t)||$0.$0(t.get_$LR()))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","Empty Data"),r.resolve(!1);else{f=t.get_$LR().$Fc;f.toString()in Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()&&delete Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()[f.toString()];var s=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc(this.$BL),o=this,h=this;s.$1Hw(t,e).then(function(){var u,f;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","ProcessSuccessMultipleResponseItem Completed");n||(t.get_$LR().$Vy===1||t.get_$LR().$Vy===3)&&(i.$9Y.name==="Create"&&(u=i.$9Y.entityReference,o.$em.set_$R(u.Id.toString(),u)),i.$9Y.name==="Update"&&(f=i.$9Y.entityReference,o.$em.set_$R(f.Id.toString(),f)));r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Failure",n.$F);r.reject(n)})}return r.promise()},processSuccessJsonResponse:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse","ProcessSuccessJsonResponse Started"),i=this.$9D.get_Items()[0],n.$Ch)Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.Success ","Command Execution Succeeded At Server Processed Sucessfully"),t.resolve(!0);else if($0.$0(i.get_$LR()))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.Success ","Command Execution Succeeded At Server Processed Sucessfully"),t.resolve(!1);else{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Start ","Command Execution Failed At Server Processing Started");var r=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ,u=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc(this.$BL),f=this,e=this;u.$1Hw(i,r).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Success ","Command Execution Failed At Server Processed Sucessfully");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Fail ",n.$F);t.reject(n)})}return t.promise()},$2yl:function(){var t,n,u;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Start","Process Returned Row Versions Started");t=[];n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7);this.$em.$s()||(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Success","Process Returned Row Versions succeeded"),n.resolve(!0));for(var r=this.$em.get_$2ph(),e=r.length,i=0;i<e;++i)u=r[i],Array.add(t,this.$3Bb(u));var f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l)),o=this,s=this;return Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).then(function(t){for(var r,e,u=t,s=u.length,i=0;i<s;++i)r=u[i],$0.$0(r)||(e=r,f.addRange(e.get_Items()));o.$BL.$h1(f,null,!0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Success","Updation of Row Version Succeeded");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Fail",t.$F);n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Fail",t.$F);n.reject(t)}),n.promise()},$3Bb:function(n){var i,t,r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Start","Updation of Row Version started"),i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l),Microsoft.Crm.Client.Core.Framework.$7),t=this.$em.get_$R(n),$0.$0(t)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Success","Updation of Row Version Succeeded"),i.resolve(null)):(r=this,u=this,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$7x(t.LogicalName,Microsoft.Crm.Client.Core.Framework.$q.$4t(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp(),"PlaybackBatchManager")).then(function(n){var u,f;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Success","Updation of Row Version Succeeded");u={};u.versionnumber=t.$Nc;u[n.get_$ES()]=t.get_identifier();r.$pO[t.get_key()]=t.$Nc;f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l))([new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(u,3,t.LogicalName),new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(u,3,"_NORSYNC_LOG_"+t.LogicalName)]);i.resolve(f)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Fail",n.$F);i.reject(n)})),i.promise()},$1qd:function(n){var i=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ,r,t,u,f;return i.$19q=!$0.$0(n)&&!$0.$0(n.$vw)?n.$vw.get_$6m():"",$0.$0(n)||$0.$0(n.$Ab)?(i.$F="",i.$oh=new Date):(r=Sys.Net.XMLDOM(n.$Ab.get_Items()[0]),r?(t=Microsoft.Crm.Client.Core.Storage.Common.Xml.$K.$X(r),t.$4R("d","http://schemas.microsoft.com/xrm/2011/Contracts/Services"),t.$4R("a","http://schemas.microsoft.com/xrm/2011/Contracts"),t.$4R("b","http://schemas.datacontract.org/2004/07/System.Collections.Generic"),t.$4R("c","http://schemas.microsoft.com/xrm/2012/Contracts"),t.$4R("i","http://www.w3.org/2001/XMLSchema-instance"),i.$m=$0.$0(t.$N(".//a:ErrorCode"))?$0.$0(n.$66)?-1:n.$66:Number.parseInvariant(t.$N(".//a:ErrorCode").get_$p()),i.$F=$0.$0(t.$N(".//a:Message"))?Microsoft.Crm.Client.Core.Framework.$3.$9(n.get_message())?"":n.get_message():t.$N(".//a:Message").get_$p(),u=$0.$0(t.$N(".//a:Timestamp"))?"":t.$N(".//a:Timestamp").get_$p(),f=Microsoft.Crm.Client.Core.Framework.$3.$9(u)?new Date:new Date(Date.parse(u.toString())),i.$oh=f):(i.$F=n.get_message(),i.$oh=new Date)),i},$1ij:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n,f,e;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete","ProcessActionDataListToDelete Started");for(var r=this.$9D.get_Items(),u=r.length,i=0;i<u;++i){n=r[i];switch(n.get_$e5()){case 0:this.$2yU(n);break;case 2:case 1:this.$2yh(n)}}return f=this,e=this,this.$BL.$1rf(this.$j2,this.$iQ,this.$NO).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete.Success","ProcessActionDataListToDelete Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete.Failure","ProcessActionDataListToDelete Failed");t.reject(n)}),t.promise()},$2yU:function(n){var i;if(this.$zh(n.$Pd),!$0.$0(n.$Vh))for(var r=n.$Vh.get_Items(),u=r.length,t=0;t<u;++t)i=r[t],$0.$0(i)||this.$zh(i.$Pd)},$2yh:function(n){var r;if(this.$zh(n.$Pd),!$0.$0(n.$iB)){this.$NO=n.$NO;for(var i=n.$iB.get_Items(),u=i.length,t=0;t<u;++t)r=i[t],this.$zh(r)}},$zh:function(n){$0.$0(n)||this.$zM.contains(n.$Fc)||(this.$j2.add(n.$Fc),this.$iQ.contains(n.$SY)||this.$iQ.add(n.$SY))},$24u:function(n){return $0.$0(n)||$0.$0(n.get_$LR())?!1:Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(n.get_$LR())==="_NORSYNC_LOG_syncerror"},$263:function(n){var t=n.toString()in Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()?Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()[n.toString()]:this.$2GL;t>0?(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()[n.toString()]=--t,this.$zM.add(n)):delete Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq()[n.toString()]}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager=function(){this.$BL=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jy};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance=function(){return $0.$0(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.set_DefaultInstance=function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=n,n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq=function(){return $0.$0(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$18N)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$18N={}),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$18N};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$1lo=function(){return new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["_NORSYNC_LOG_commandoperation","_NORSYNC_LOG_businessprocessflowinstance"])};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$23C=function(){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$WB++};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.prototype={$lk:0,$qL:0,$BL:null,$1Uh:null,$Px:null,$BJ:null,$iP:null,$Iu:null,$L1:null,get_$1LF:function(){return 10},$1Qk:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl,Microsoft.Crm.Client.Core.Framework.$7),t,i;return(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$WB=0,this.$lk=0,!Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$24W())?n.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Offline database is not available.")):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPlayback","Started Upsync"),t=this,i=this,this.$2mj().then(function(){t.$2yi().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1PA("SyncErrorFailureMap",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq());Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1kE("lastsuccessfulsaveoncrm").then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPlayback","Upsync successful");i&&!Microsoft.Crm.Client.Core.Framework.$1B.$140(i)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$dD=i.lastsuccessfulsaveoncrm);Microsoft.Crm.Client.Core.Storage.DataApi.$D.get_$6().$34.set_$2GK(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$WB);var r=!$0.$0(t.$Px)&&t.$Px.$SS?0:1;n.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl(r,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$WB,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$dD))},function(t){n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPlayback","Upsync failed");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1PA("SyncErrorFailureMap",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$hq());Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1kE("lastsuccessfulsaveoncrm").then(function(i){i&&!Microsoft.Crm.Client.Core.Framework.$1B.$140(i)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$dD=i.lastsuccessfulsaveoncrm);n.reject(t)},function(){n.reject(t)})})},function(t){n.reject(t)}),n.promise())},$1cx:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=new Array(0);t[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("SID",this.$lk,1,4);var i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(t),r=this,u=this;return this.$BL.getNorSyncMainLogs(i).then(function(t){$0.$0(t)||!t.length?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Success","No Items found for upsync"),n.resolve(!1)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Success","Found items for upsync"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Faliure",t.$F);n.reject(t)}),n.promise()},$2oL:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(n),f,r;if($0.$0(u))i.resolve(!1);else{f=u.$4Y;r=new Array(0);r[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8(f,t.toString(),1,0);var e=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(r),o=this,s=this;this.$BL.getNorSyncEntityLogs(e,n).then(function(n){!$0.$0(n)&&n.rows.length>0?i.resolve(!0):i.resolve(!1)},function(n){i.reject(n)})}return i.promise()},$2mj:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t=this,i=this;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1kE("SyncErrorFailureMap").then(function(t){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$18N=$0.$0(t)?{}:t;n.resolve(!0)},function(t){n.reject(t)}),n.promise()},$2yi:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack","I Pass Started"),t=this,i=this,this.$2Fu().then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","I Pass Completed");i?t.$Px.$SS?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.NetworkFailure","II Pass Not Started due to Network Issue"),n.resolve(!1)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack","II Pass Started"),t.$2Fu().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","II Pass Completed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.Faliure",t.$F);n.reject(t)})):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","Completed"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessPlayBack.Failure",t.$F);n.reject(t)}),n.promise()},$2Fu:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass","Started"),t=this,i=this,this.$1cx().then(function(i){i?(t.$Px=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$KA(t.$BL),t.$SD().then(function(){t.$Px.$SS?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass.NetworkFaliure","Faliure"),n.resolve(!0)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass.Success","StartPass Finished"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass.Failure",t.$F);n.reject(t)})):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass.Success","StartPass Completed"),n.resolve(!1))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.StartPass.Failure",t.$F);n.reject(t)}),n.promise()},$SD:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i,t,r;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync","UpSync Started"),i=[],Array.add(i,this.$Px.$29u()),Array.add(i,this.$2yC()),t=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(i).then(function(){t.$Px.$SS&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Warning","NetWork Issue Encountered while upsync"),n.resolve(!1));t.$Px.$im.length?t.$SD().then(function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Success","ManagePlayBackQueue Finished");n.resolve(t)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Failure",t.$F);n.reject(t)}):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Info","ManagePlayBackQueue PlayBack All Remaining Requests Started"),t.$Px.$29u().then(function(){n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Failure",t.$F);n.reject(t)}))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpSync.Success",t.$F);n.reject(t)}),n.promise()},$2yC:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch","ProcessBatch Started"),t=this,i=this,this.$2Bz(!0).then(function(){$0.$0(t.$BJ)||!t.$BJ.get_Count()?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch.Success","ProcessBatch Completed"),n.resolve(!1)):t.$2Qm().then(function(i){!$0.$0(i)&&i.get_Count()>0&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch","Batch Added to PlayBackBatchManager"),Array.enqueue(t.$Px.$im,i));Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch.Success","ProcessBatch Finished");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch.Failure",t.$F);n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PrepareNextBatch.Failure",t.$F);n.reject(t)}),n.promise()},$2y8:function(n){for(var t=0,i=!n,r,u;t<this.$Iu.length&&(this.$BJ.get_Count()<this.get_$1LF()||i);)r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(this.$Iu[t]),u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$20P(r),this.$BJ.add(this.$Iu[t]),this.$iP.contains(u)||this.$iP.add(u),i?r.toLowerCase()==="_NORSYNC_LOG_commandoperation".toLowerCase()?this.$qL++:(this.$qL--,this.$qL<=0&&(i=!1,this.$qL=0)):r.toLowerCase()==="_NORSYNC_LOG_Command".toLowerCase()&&(i=!0,this.$qL=0),t++;return this.$lk=this.$BJ.get_Items()[this.$BJ.get_Count()-1].$Fc,this.$Iu.splice(0,t),i},$2yB:function(){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),t,f,r,o,n,h;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveEntityLogs","RetrieveEntityLogs Started");this.$L1={};t=new Array(0);t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("NORSYNC_LOG_SID",this.$BJ.get_Items()[0].$Fc,0,5));t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("NORSYNC_LOG_SID",this.$lk,0,3));f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(t);r=[];for(var e=this.$iP.get_Items(),s=e.length,u=0;u<s;++u)o=e[u],Array.add(r,this.$BL.getNorSyncEntityLogs(f,o));return n=this,h=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(r).then(function(t){var r,o,s,u,e,f,h;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveEntityLogs.Success","RetrieveEntityLogs Completed"),r=0;r<n.$iP.get_Count();r++)if(o=n.$iP.get_Items()[r],$0.$0(t[r]))n.$L1[o]=null;else{for(s=t[r],u={},e=0;e<s.rows.length;e++)f=s.rows.item(e),h=f.NORSYNC_LOG_SID.toString()in u?u[f.NORSYNC_LOG_SID.toString()]:new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Object)),h.add(f),u[f.NORSYNC_LOG_SID.toString()]=h;n.$L1[o]=u}i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveEntityLogs.Failure",n.$F);i.reject(n)}),i.promise()},$2Qm:function(){var r=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70),Microsoft.Crm.Client.Core.Framework.$7),i,o,s;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.CreateBatchData","CreateBatchData Started");this.$1Uh=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jz(this.$BL,this.$BJ,this.$L1);for(var f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70)),e=[],n=0,t=0,u=!1;n<this.$BJ.get_Count();)i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(this.$BJ.get_Items()[n]),u?i.toLowerCase()==="_NORSYNC_LOG_commandoperation".toLowerCase()?(t++,n++):(n+=i.toLowerCase()==="_NORSYNC_LOG_businessprocessflowinstance".toLowerCase()&&!t?1:t,u=!1,t=0):(i.toLowerCase()==="_NORSYNC_LOG_Command".toLowerCase()&&(u=!0,t=0),Array.add(e,this.$1Uh.$2Qu(n)),n++);return o=this,s=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(n){var u;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.CreateBatchData.Success","CreateBatchData Completed");for(var i=n,e=i.length,t=0;t<e;++t)u=i[t],f.add(u);r.resolve(f)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.CreateBatchData.Failure",n.$F);r.reject(n)}),r.promise()},$2en:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),r=new Array(0);r[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("SID",this.$lk,1,4);var u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(r,n),i=this,f=this;return this.$BL.getNorSyncMainLogs(u).then(function(n){if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.GetBatch.Success","GetBatch Completed."),$0.$0(i.$Iu))i.$Iu=n;else{var r;(r=i.$Iu).push.apply(r,n)}t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackManager.GetBatch.Fail",n.$F);t.reject(n)}),t.promise()},$2Bz:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),r,i,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveBatch","RetrieveBatch Started."),n&&(this.$BJ=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3)),this.$iP=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))),r=this.get_$1LF(),!$0.$0(this.$Iu)&&this.$Iu.length>0&&(r-=this.$Iu.length,this.$lk=this.$Iu[this.$Iu.length-1].$Fc),i=this,u=this,this.$2en(r).then(function(){$0.$0(i.$Iu)||!i.$Iu.length?t.resolve(!0):i.$2y8(n)?i.$2Bz(!1).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveBatch.Force.Success","Force RetrieveBatch Completed.");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveBatch.Force.Failure",n.$F);t.reject(n)}):i.$2yB().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveBatch.Success","RetrieveBatch Completed.");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.RetrieveBatch.Failure",n.$F);t.reject(n)})},function(n){t.reject(n)}),t.promise()}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ee=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ee.registerInterface("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ee");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jy=function(){this.$115=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om;this.$gX=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn(this.$115);this.$1DT=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo(this.$115);this.$1o6=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jy.prototype={$115:null,$gX:null,$1DT:null,$1o6:null,getNorSyncMainLogs:function(n){var t=MscrmComponents.DeferredPromiseFactory(Array,Microsoft.Crm.Client.Core.Framework.$7),i=this,r=this;return this.$gX.$7m("_NORSYNC_MAIN_LOG_TABLE",n).then(function(n){t.resolve(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2QC(n))},function(n){t.reject(n)}),t.promise()},getNorSyncEntityLogs:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$7),r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2hg(t),u=this,f=this;return this.$gX.$7m(r,n).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise()},$h1:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),u=this,f=this;return this.$1o6.$h1(n,t,i).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.UpdateRowVersion.Success","Updation of Row Version Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackManager.UpdateRowVersion.Fail",n.$F);r.reject(n)}),r.promise()},$1rf:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),u,o,f,s,c,a,v;if(n.get_Count()){u=new Array(0);u.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("SID",n,1,7));o=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(u);f=new Array(0);f.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("NORSYNC_LOG_SID",n,1,7));s=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(f);this.$gX.$1qH(!0);for(var h=t.get_Items(),l=h.length,e=0;e<l;++e)c=h[e],this.deleteNorSyncEntityLog(c,s);this.deleteNorSyncMainLogs(o);i.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())||this.$r2(i);a=this;v=this;this.$gX.Commit(this.$115.$AP).then(function(){r.resolve(!0)},function(n){r.reject(n)})}else r.resolve(!0);return r.promise()},$2HI:function(n,t){if($0.$0(n))return null;var i=n.$1RT();return i.Status=t,new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(i,3,"Command")},$r2:function(n){var t=new Array(0),i,r,u;t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("Id",n.toString(),1,0));i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(t);r=new Array(0);r.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("CommandId",n.toString(),1,0));u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(t);this.$1DT.Delete("Command",i);this.$1DT.Delete("CommandOperation",u)},deleteNorSyncMainLogs:function(n){this.$gX.Delete("_NORSYNC_MAIN_LOG_TABLE",n)},deleteNorSyncEntityLog:function(n,t){this.$gX.Delete(n,t)}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jz=function(n,t,i){this.$BL=n;this.$BJ=t;this.$L1=i;this.$1Yf=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jz.prototype={$1Yf:null,$BJ:null,$L1:null,$BL:null,$xq:null,$xp:null,$19o:null,$2Qu:function(n){var t=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70,Microsoft.Crm.Client.Core.Framework.$7),i,r,u,f;return n>=this.$BJ.get_Count()?t.reject(Microsoft.Crm.Client.Core.Framework.$7.$k("Invalid index specified for batch logs")):(i=[],r=this.$BJ.get_Items()[n],r.$SY.toLowerCase()!=="_NORSYNC_LOG_Command".toLowerCase()?Array.add(i,this.$2fM(n)):Array.add(i,this.$2he(n)),u=this,f=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(i).then(function(n){var i=$0.$0(n[0])?null:n[0];$0.$0(i)?t.resolve(null):(i.set_$LR(r),i.set_$2Ly(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134(r,u.$L1)),t.resolve(i))},function(n){t.reject(n)})),t.promise()},$2fM:function(n){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70,Microsoft.Crm.Client.Core.Framework.$7),t=this.$BJ.get_Items()[n],r=t.$Vy;if(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$1lo().contains(t.$SY))i.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1(r,null));else{var u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134(t,this.$L1),f=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2j3(t,this.$L1),e=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(t),o=this,s=this;this.$1Yf.$2QB(u,f,e,r).then(function(n){i.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1(r,n))},function(n){i.reject(n)})}return i.promise()},$2he:function(n){var t=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70,Microsoft.Crm.Client.Core.Framework.$7),f=this.$BJ.get_Items()[n];this.$19o=new(Microsoft.Crm.Client.Core.Framework.$BM.$$(String));this.$xq=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3));this.$xp={};var r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134(f,this.$L1),e=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(r.Id.toString()),u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2f4(r),i=this,o=this;return this.$2ya(n,u).then(function(){t.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K2(e,u,i.$19o,i.$xq,i.$xp))},function(n){t.reject(n)}),t.promise()},$2f5:function(n){for(var t=0,i;n<this.$BJ.get_Count();){if(i=this.$BJ.get_Items()[n],i.$SY.toLowerCase()!=="_NORSYNC_LOG_commandoperation".toLowerCase())break;t++;n++}return t},$2ya:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),r,e,o,f,u,s,h;if(t.$1c.toLowerCase()==="ChangeProcessAndStage".toLowerCase())n+1>=this.$BJ.get_Count()?i.resolve(!0):(r=this.$BJ.get_$R(n+1),e=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(r),e==="_NORSYNC_LOG_businessprocessflowinstance"?(this.$xq.add(r),this.$xp[r.$Fc.toString()]=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134(r,this.$L1),i.resolve(!0)):i.resolve(!0));else{for(o=this.$2f5(n+1),f=[],u=1;u<=2*o;u++)Array.add(f,this.$2xf(n+u));s=this;h=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(f).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.ProcessEntitiesInNonCrud.Success","Processing of Entities in NonCrud Succeeded");i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackManager.ProcessEntitiesInNonCrud.Fail",n.$F);i.reject(n)})}return i.promise()},$2xf:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),s,r,e,h;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Start","Population of Entities in NonCrud Started"),n>=this.$BJ.get_Count())Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud Succeeded"),t.resolve(!1);else{var i=this.$BJ.get_Items()[n],o=i.$SY,u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(i),f=new Array(0);f.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("NORSYNC_LOG_SID",i.$Fc,1,0));s=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9(f);r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134(i,this.$L1);this.$xq.add(i);this.$xp[i.$Fc.toString()]=r;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$1lo().contains(o)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud is skipped"),t.resolve(!0)):(e=this,h=this,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$7x(u,Microsoft.Crm.Client.Core.Framework.$q.$4t(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp(),"UpSyncDataBuilder")).then(function(n){!$0.$0(n)&&n.get_$ES()in r?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud Succeeded"),e.$19o.set_$R(r[n.get_$ES()].toString(),u),t.resolve(!0)):t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Fail",n.$F);t.reject(n)}))}return t.promise()}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Jx=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27=function(n){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.initializeBase(this);this.$BL=n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq=function(n,t,i,r){var e,h,u,o,f,s;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:CreateActionData","Started"),e=r,($0.$0(e)||!e.get_Count())&&(e=n.$4w),h=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(n.$a.LogicalName),u=new Sys.StringBuilder,o=0;o<e.get_Count();o++)if(!Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1ln.contains(e.get_$R(o)))if(f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q(t,e.get_$R(o)),$0.$0(f)||f.$26===15)$0.$0(f)&&!$0.$0(r)&&(u.append(e.get_$R(o)),u.append(" - "),u.appendLine(n.getValue(e.get_$R(o)).toString()));else if($0.$0(n.getValue(e.get_$R(o))))u.append(f.$1q),u.append(" - "),u.appendLine("");else if(f.$26===6||f.$26===1||f.$26===9)u.append(f.$1q),u.append(" - "),u.appendLine(n.getValue(e.get_$R(o)).Name);else if(f.$26!==12&&f.$26!==13&&f.$26!==11&&f.$26)if(f.$26===20&&i==="create")continue;else f.$26===2?(u.append(f.$1q),u.append(" - "),u.appendLine($0.$0(n.getValue(e.get_$R(o)))?"":Xrm.Soap.CrmDateTimeSerializer.$Dv(n.getValue(e.get_$R(o))))):(u.append(f.$1q),u.append(" - "),u.appendLine(n.getValue(e.get_$R(o)).toString()));else{if(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$2FL(h,i,e.get_$R(o).toString()))continue;s=n.getValue(e.get_$R(o)).get_$cW();u.append(f.$1q);u.append(" - ");u.appendLine(s!=="-1"&&!$0.$0(f.$6S.$21[s])?f.$6S.$21[s].$1G.toString():"")}return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:CreateActionData","Completed"+u.toString()),u.toString()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$2wc=function(n,t,i){var f,y=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp(),p=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$1t(y),a,c,r,o,u,s,h,e,l,v;try{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","Started");a=Microsoft.Crm.Client.Core.Storage.Common.Xml.$K.$4g(p.$1Y0(t,t,n));c=Microsoft.Crm.Client.Core.Storage.Common.Xml.$K.$X(a);Xrm.Soap.Serializer.$AQ(c);f=Xrm.Soap.Serializer.$25g(c,t)}catch(w){return""}r=new Sys.StringBuilder;switch(t){case"WinOpportunity":return o=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq(o.opportunityClose,i,"WinOpportunity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(o.opportunityClose.get_fieldNames()))),u=o.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","WinOpportunityOperation:Completed "+r.toString()),r.toString();case"LoseOpportunity":return s=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq(s.opportunityClose,i,"LoseOpportunity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(s.opportunityClose.get_fieldNames()))),u=s.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","LoseOpportunityOperation:Completed "+r.toString()),r.toString();case"CloseIncident":return h=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq(h.incidentResolution,i,"CloseIncident",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(h.incidentResolution.get_fieldNames()))),u=h.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","CloseIncidentOperation:Completed "+r.toString()),r.toString();case"ConvertActivity":return e=f,r.appendLine(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq(e.targetEntity,e.targetEntityName,"ConvertActivity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(e.targetEntity.get_fieldNames()))),r.append("CreateCampaignResponse - "),r.append(e.createCampaignResponse.toString()),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","ConvertActivityOperation:Completed "+r.toString()),r.toString();case"SetState":return i!=="lead"&&(l=f,v=l.state,u=l.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj(i,v,"statecode")),r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj(i,u,"statuscode"))),r.toString();default:return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:ParseActionDataForNonCud","default:Completed "),""}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$zj=function(n,t,i){var r=new Sys.StringBuilder,u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q(n,i);return $0.$0(u)||u.$26!==13&&u.$26!==12||t===-1?t!==-1&&(i.toLowerCase()==="statuscode"?r.append("status - "):r.append("state - "),r.appendLine(t.toString())):(r.append(u.$1q),r.append(" - "),r.appendLine(u.$6S.$21[t.toString()].$1G.toString())),r.toString()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$2FL=function(n,t,i){return!$0.$0(n)&&t.toLowerCase()==="create"&&(n.get_$7g()&&i==="isregularactivity"||n.$CW&&i==="statecode")?!0:!1};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.prototype={$BL:null,get_$Y:function(){return Microsoft.Crm.Client.Core.Framework.$q.$4t(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp(),"RollBackHandler")},$1Hw:function(n,t){var i,r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.RollBackHandler.Handle.Start","Rollback of failed command started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n.get_$e5()?(u=this,this.$33W(n).always(function(){u.$1p9(n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.RollBackHandler.Handle.Success","Rollback of failed Non-CRUD command succeeded");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$23C();i.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.RollBackHandler.Handle.Failure",n.$F);i.reject(n)})})):(r=this,this.$33U(n).always(function(){r.$1p9(n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.RollBackHandler.Handle.Success","Rollback of failed CUD command succeeded");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$23C();i.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.RollBackHandler.Handle.Failure",n.$F);i.reject(n)})})),i.promise()},$33U:function(n){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l)),t=this.$1kV(n.$o9,n.$Bi.$a.LogicalName,n.$j3),f,s,h;if($0.$0(t))i.resolve(!1);else{if(r.add(t),!$0.$0(n.$Vh)&&n.$Vh.get_Count()>0)for(var e=n.$Vh.get_Items(),o=e.length,u=0;u<o;++u)f=e[u],t=this.$1kV(f.$o9,"activityparty",f.$j3),$0.$0(t)||r.add(t);s=this;h=this;this.$BL.$h1(r,null,!0).then(function(){i.resolve(!0)},function(n){i.reject(n)})}return i.promise()},$33W:function(n){for(var u,v,y,t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),h=n.$cu,f=n.$iB,c=n.$19M,e=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l)),o=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l)),i=f.get_Count()-1;i>=0;i--){var r=f.get_Items()[i],l=c[r.$Fc.toString()],a=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(r),s=this.$1kV(l,a,r.$Vy);$0.$0(s)||e.add(s)}return u=this.$BL.$2HI(h,3),$0.$0(u)||o.add(u),v=this,y=this,this.$BL.$h1(e,o,!0).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()},$1p9:function(n,t){var r,s,h,l;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Start","Sync Error Creation Started"),r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),n.get_$e5()){var u=n,f=u.$cu,i="",e=null,o=Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),c="";n.get_$e5()===2?(s=JSON.parse(f.$i9),i=s.entitylogicalname.toString(),o=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(s.entityid.toString()),e=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i)):(h=u.$iB.get_Items()[u.$iB.get_Count()-1],l=u.$19M[h.$Fc.toString()],i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(h),e=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i),o=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(l[e.$4Y].toString()),c=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$2wc(f.$i9,f.$1c,i));var a=Microsoft.Crm.Client.Core.Offline.$4q.$qZ(i,f.$1c,o,i,e.$y,t.$F,c,t.$oh,"",t.$m,t.$19q),v=this,y=this;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1YK(a,this.get_$Y()).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Success","Sync Error Creation Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Fail",n.$F);r.reject(n)})}else return this.$1YK(n,t);return r.promise()},$1YK:function(n,t){var e=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),p=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(n.$Pd),o=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$20P(p),i=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(o),r=n.$Bi,y=r.$a.Id,f,c,l,a,v;if($0.$0(r))e.resolve(!1);else{var w=!!i&&(i.get_$7g()||o==="activityparty"),u=n.$j3,s=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1Dq(r,o,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X.toString(u)),h=this.$1em(u)?this.$2Sy(r,i,y.toString(),u):null;if(w&&(f=this.$2eG(n,u,i),$0.$0(f.ActivityPartyActionData)||(s=s+f.ActivityPartyActionData),this.$1em(u)&&!$0.$0(f.ActivityPartyCollection))){c=JSON.parse(h);l=f.ActivityPartyCollection;for(a in l)v={key:a,value:l[a]},c[v.key]=v.value;h=this.$1sd(c)}var b=Microsoft.Crm.Client.Core.Offline.$4q.$qZ(o,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X.toString(u),y,$0.$0(r.getValue(i.$59))?"":r.getValue(i.$59).toString(),i.$y,t.$F,s,t.$oh,h,t.$m,t.$19q),k=this,d=this;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1YK(b,this.get_$Y()).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.RollBackHandler.CreateSyncErrorLog.Success","Sync Error Creation Succeeded");e.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u("OfflineUpSync.RollBackHandler.CreateSyncErrorLog.Fail",n.$F);e.reject(n)})}return e.promise()},$2eG:function(n,t,i){for(var y,p,s,f,h,w,b=n.$Vh,c=new Sys.StringBuilder,e={},u={},l=n.$Bi,a=b.get_Items(),k=a.length,o=0;o<k;++o){var v=a[o],d=v.$Pd,r=v.$Bi;i.get_$7g()&&t===1&&this.$2om(r)||(l.hasField("activityid")&&(y=r.getValue("activityid"),p=l.getValue("activityid"),y.Id.toString()===p.toString()&&c.appendLine(this.$2eF(r))),this.$1em(t)&&d.$Vy!==2&&(s=r.getValue("participationtypemask"),$0.$0(s)||(f=Microsoft.Crm.Client.Core.Offline.$2K.$165[s.$1s.toString()],h=r.getValue("partyid"),$0.$0(h)||(w=h.getObjectData(),$0.$0(u[f])&&(u[f]=[]),u[f].push(w)))))}return e.ActivityPartyCollection=u,e.ActivityPartyActionData=c.toString(),e},$2om:function(n){var t=n.getValue("participationtypemask"),i;return!$0.$0(t)&&(i=Microsoft.Crm.Client.Core.Offline.$2K.$165[t.$1s.toString()],i==="owner")?!0:!1},$2eF:function(n){var i=n.getValue("participationtypemask"),r,t,u;return!$0.$0(i)&&(r=Microsoft.Crm.Client.Core.Offline.$2K.$165[i.$1s.toString()],t=n.getValue("partyid"),!$0.$0(t))?(u=t,r+" - "+u.Name):""},$1kV:function(n,t,i){var r=null;return i===1?r=this.$33T(n,t):i===2?r=this.$33V(n,t):i===3&&(r=this.$33X(n,t)),r},$33T:function(n,t){var i=new Array(0),r;return t==="CommandOperation".toLowerCase()?i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("Id",n.Id.toString(),1,0):t==="businessprocessflowinstance".toLowerCase()?i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8("businessprocessflowinstanceid",n.businessprocessflowinstanceid.toString(),1,0):(r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(t),$0.$0(n)||$0.$0(r)||(i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8(r.$4Y,n[r.$4Y].toString(),1,0))),new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(i,2,t)},$33X:function(n,t){var i=null;return $0.$0(n)||(n=this.$2BR(n),i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(n,3,t)),i},$33V:function(n,t){var i=null;return $0.$0(n)||(n=this.$2BR(n),i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l(n,1,t)),i},$2BR:function(n){return delete n.NORSYNC_SID,delete n.NORSYNC_LOG_SID,delete n.NORSYNC_TABLE_ID,delete n.NORSYNC_LOG_TYPE,n},$2Sy:function(n,t,i,r){var f,u,l,s;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:CreateRequestData","Started");var e=n.$4w,o={},h=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1ln;for(r===1&&h.add(t.$4Y),o.syncerror__regardingentityid=i,o.entitylogicalname=t.$y,f=0;f<e.get_Count();f++)if(!h.contains(e.get_$R(f))&&(u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q(t.$y,e.get_$R(f)),!$0.$0(u)))if($0.$0(n.getValue(e.get_$R(f))))o[u.$y]="";else if(u.$26===6||u.$26===1||u.$26===9){var a=n.getValue(e.get_$R(f)),v=a.getObjectData(),c=[];c.push(v);o[u.$y]=c}else if(u.$26!==12&&u.$26!==13&&u.$26!==11&&u.$26)if(u.$26===20&&r===1)continue;else o[u.$y]=u.$26===2?$0.$0(n.getValue(e.get_$R(f)))?"":Xrm.Soap.CrmDateTimeSerializer.$Dv(n.getValue(e.get_$R(f))):n.getValue(e.get_$R(f)).toString();else{if(l=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2jI(r),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$2FL(t,l,e.get_$R(f).toString()))continue;s=n.getValue(e.get_$R(f)).get_$cW();o[u.$y]=s!=="-1"?s:""}return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B("RollbackHandler:CreateRequestData","Completed"+o.toString()),this.$1sd(o)},$1sd:function(n){return JSON.stringify(n)},$1em:function(n){return n===1||n===3?!0:!1}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc=function(n){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc.initializeBase(this);this.$1Ln=n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc.prototype={$1Ln:null,$1Hw:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$7),i,r,u,f,e;return n.get_$e5()?(i=n.$cu,$0.$0(i)?t.resolve(!1):(r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l)),u=this.$1Ln.$2HI(i,2),r.add(u),f=this,e=this,this.$1Ln.$h1(null,r,!0).then(function(){f.$2Ef();t.resolve(!0)},function(n){t.reject(n)}))):(this.$2Ef(),t.resolve(!0)),t.promise()},$2Ef:function(){var t=new Date,n={};n.lastsuccessfulsaveoncrm=Microsoft.Crm.Client.Core.Storage.Common.CrmFormatter.$C.$OP(t,0);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6().$1PA("lastsuccessfulsaveoncrm",n)}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.Common");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$4s=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$4s.prototype={failure:0,success:1};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$4s.registerEnum("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$4s",!1);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X.prototype={create:1,Delete:2,update:3,retrieve:4};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X.registerEnum("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X",!1);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l=function(n){this.$uF=new Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider(n)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.get_$6=function(){return $0.$0(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C)&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C=new Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1N())),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.prototype={$uF:null,$1YK:function(n,t){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C.$uF.$2SU(n,t)},$1PA:function(n,t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C.$uF.$1PA(n,t)},$1kE:function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C.$uF.$w3(n)},$24W:function(){return this.$uF.$24W()}};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2hg=function(n){return"_NORSYNC_LOG_"+n};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2QC=function(n){for(var i,t,u=new Array(n.rows.length),r=0;r<n.rows.length;r++)i=n.rows.item(r),t=new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3,t.$Fc=i.SID,t.$1oD=i.DEVICE_ID.toString(),t.$SY=i.LOG_TABLE_ID.toString(),t.$Vy=i.OPERATION_TYPE,t.$Sk=i.TIME_STAMP,u[r]=t;return u};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$u=function(n,t){Microsoft.Crm.Client.Core.Framework.$8.$u(n,1035,t)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$B=function(n,t){Microsoft.Crm.Client.Core.Framework.$8.$u(n,1035,t)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU=function(n){return n.$SY};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$20P=function(n){return n.replace("_NORSYNC_LOG_","")};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$134=function(n,t){var u,r;if($0.$0(n))return null;var i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(n),f=n.$Fc,e=n.$Vy;return!$0.$0(i)&&!$0.$0(t)&&i in t?(u=t[i],r=u[f.toString()],$0.$0(r)?null:r.get_Items()[0]):null};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2j3=function(n,t){var f,r;if($0.$0(n))return null;var i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx(n),e=n.$Fc,u=n.$Vy;return u!==1&&u!==2&&!$0.$0(i)&&!$0.$0(t)&&i in t?(f=t[i],r=f[e.toString()],$0.$0(r)?null:r.get_Items()[1]):null};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$kx=function(n){var t=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$sU(n);return t.replace("_NORSYNC_LOG_","")};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2f4=function(n){if($0.$0(n))return new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z(Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),null,1,null);var t=n.Id,i=n.Name.toString(),r=n.Status,u=n.ActionData.toString();return new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z(t,i,r,u)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.$2jI=function(n){var t="";switch(n){case 1:t="Create";break;case 2:t="Delete";break;case 3:t="Update";break;case 4:t="Retrieve"}return t};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.Entities");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70.registerInterface("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z=function(n,t,i,r){this.$2p=n;this.$1c=t;this.$j4=i;this.$i9=r;this.$cv=new Date};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z.prototype={$2p:null,$1c:null,$j4:0,$i9:null,$cv:null,$1RT:function(){var n={};return n.Id=this.$2p,n.Name=this.$1c,n.Status=this.$j4,n.ActionData=this.$i9,n.CreatedOn=this.$cv,n}};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K0=function(n,t,i,r){this.$2p=n;this.$NO=t;this.$6J=i;this.$1Tu=r};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K0.prototype={$2p:null,$NO:null,$6J:null,$1Tu:0,$1RT:function(){var n={};return n.Id=this.$2p,n.CommandId=this.$NO,n.EntityName=this.$6J,n.Operation=this.$1Tu,n}};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1=function(n,t){this.$oJ=0;this.$j3=n;this.$Bi=t;this.$Vh=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1))};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1.prototype={$oJ:0,get_$e5:function(){return this.$oJ},$Pd:null,get_$LR:function(){return this.$Pd},set_$LR:function(n){return this.$Pd=n,n},$o9:null,set_$2Ly:function(n){return this.$o9=n,n},$j3:0,$Bi:null,$Vh:null};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K2=function(n,t,i,r,u){this.$oJ=t.$1c.toLowerCase()==="ChangeProcessAndStage".toLowerCase()?2:1;this.$NO=n;this.$cu=t;this.$1Sx=i;this.$iB=r;this.$19M=u};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K2.prototype={$oJ:0,get_$e5:function(){return this.$oJ},$Pd:null,get_$LR:function(){return this.$Pd},set_$LR:function(n){return this.$Pd=n,n},$o9:null,set_$2Ly:function(n){return this.$o9=n,n},$NO:null,$cu:null,$1Sx:null,$iB:null,$19M:null};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3.prototype={$Fc:0,$Sk:null,$SY:null,$1oD:null,$Vy:0};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl=function(n,t,i){this.$j4=n;this.$19p=t;this.$dD=i};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl.prototype={$j4:0,$19p:0,$dD:null};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8w=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8w.$1sV=function(n,t){switch(n){case 0:return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8y.$1sW(t);case 1:return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H.$1sW(t.get_Items()[0]);default:return null}};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8y=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8y.$1sW=function(n){var u,o;Microsoft.Crm.Client.Core.Framework.Utils.$A.$16(n,"crudCommandActionData");u=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Sdk.Request));for(var e=n.get_Items(),s=e.length,f=0;f<s;++f){var h=e[f],i=h,c=$16.$Ae(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1X.toString(i.$j3)),r,t=null;switch(c){case 1:t=new Xrm.Gen.CreateRequest(i.$Bi);t.returnRowVersion=!0;break;case 3:r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i.$Bi.$a.LogicalName);t=new Xrm.Gen.UpdateRequest(i.$Bi);!$0.$0(r)&&r.$lQ&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$1I.$13t&&(t.concurrencyBehavior=1);t.returnRowVersion=!0;break;case 2:r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(i.$Bi.$a.LogicalName);o=i.$Bi;t=new Xrm.Gen.DeleteRequest(o.$a);!$0.$0(r)&&r.$lQ&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$E().$1I.$13t&&(t.concurrencyBehavior=1)}t&&u.add(t)}return new Xrm.Gen.ExecuteMultipleRequest(u.toArray(),new Xrm.Gen.ExecuteMultipleSettings(!0,!0))};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H.$1sW=function(n){var v=n.$cu.$i9,r=n.$cu.$1c,u,h,c,t,i,y,p,f,a,b;Microsoft.Crm.Client.Core.Framework.Utils.$A.$16(r,"commandName");Microsoft.Crm.Client.Core.Framework.Utils.$A.$16(v,"data");var e=n.$1Sx,k=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp(),d=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$1t(k),o=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Sdk.Request)),g=Microsoft.Crm.Client.Core.Storage.Common.Xml.$K.$4g(d.$1Y0(r,r,v)),s=Microsoft.Crm.Client.Core.Storage.Common.Xml.$K.$X(g);if(Xrm.Soap.Serializer.$AQ(s),u=Xrm.Soap.Serializer.$25g(s,r),Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H.$2Ji(u),h=s.$N(".//a:KeyValuePairOfstringanyType[b:key='OfflineData']/b:value"),!$0.$0(h)&&(c={},t=h.get_$9i(),!$0.$0(t))){for(i=0,y=t.childNodes.length;i<y;i++)c[t.childNodes[i].childNodes[0].textContent]=t.childNodes[i].childNodes[1].textContent;u.$RN=c}o.add(u);p=new Microsoft.Crm.Client.Core.Storage.Common.ColumnSet(["versionnumber"]);for(var w=e.get_$2ph(),nt=w.length,l=0;l<nt;++l)f=w[l],a=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$i(e.get_$R(f)),$0.$0(a)||(b=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$W().$2q(a.$y,"versionnumber"),$0.$0(b)||o.add(new Xrm.Gen.RetrieveRequest(new Xrm.Objects.EntityReference(e.get_$R(f),new Microsoft.Crm.Client.Core.Framework.Guid(f)),p)));return new Xrm.Gen.ExecuteMultipleRequest(o.toArray(),new Xrm.Gen.ExecuteMultipleSettings(!0,!0))};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H.$2Ji=function(n){var t=null,u,f,e,o,r;if(n.name==="ConvertActivity"?(u=n,t=u.targetEntity):n.name==="LoseOpportunity"?(f=n,t=f.opportunityClose):n.name==="WinOpportunity"?(e=n,t=e.opportunityClose):n.name==="CloseIncident"&&(o=n,t=o.incidentResolution),!$0.$0(t)&&!$0.$0(t.get_fieldNames()))for(var s=t.get_fieldNames(),h=s.length,i=0;i<h;++i)r=s[i],Microsoft.Crm.Client.Core.Framework.$3.$12(r)||t.$4w.add(r)};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.get_$6=function(){return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.$3||(Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.$3=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y),Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.$3};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.prototype={$AJ:null,get_$6T:function(){if(!this.$AJ){var n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Hp();this.$AJ=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$1t(n)}return this.$AJ},$SD:function(n,t){var i=Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8w.$1sV(n,t);return this.get_$6T().$1i(i,Microsoft.Crm.Client.Core.Framework.$q.$4t("","MobileClient-OfflineSync"))},$3Bu:function(n){var t=JSON.parse(n.get_Items()[0].$cu.$i9);return $0.$0(t)?null:this.get_$6T().$1Cz(t.entityid.toString(),t.entitylogicalname.toString(),t.processid.toString(),"",t.stageid.toString(),t.traversedpath.toString(),Microsoft.Crm.Client.Core.Framework.$q.$4t("","MobileClient-OfflineSync"))}};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ.prototype={$F:null,$19q:null,$m:0,$oh:null};Microsoft.Crm.Client.Core.Offline.$i.registerClass("Microsoft.Crm.Client.Core.Offline.$i",null,Microsoft.Crm.Client.Core.Offline.$FY);Microsoft.Crm.Client.Core.Offline.$v.registerClass("Microsoft.Crm.Client.Core.Offline.$v");Microsoft.Crm.Client.Core.Offline.$2K.registerClass("Microsoft.Crm.Client.Core.Offline.$2K");Microsoft.Crm.Client.Core.Offline.$5J.registerClass("Microsoft.Crm.Client.Core.Offline.$5J",null,Microsoft.Crm.Client.Core.Offline.$FZ);Microsoft.Crm.Client.Core.Offline.$Kh.registerClass("Microsoft.Crm.Client.Core.Offline.$Kh");Microsoft.Crm.Client.Core.Offline.$Kf.registerClass("Microsoft.Crm.Client.Core.Offline.$Kf",null,Microsoft.Crm.Client.Core.Framework.$GQ);Microsoft.Crm.Client.Core.Offline.$Kg.registerClass("Microsoft.Crm.Client.Core.Offline.$Kg");Microsoft.Crm.Client.Core.Offline.$AI.registerClass("Microsoft.Crm.Client.Core.Offline.$AI");Microsoft.Crm.Client.Core.Offline.$7J.registerClass("Microsoft.Crm.Client.Core.Offline.$7J",null,Microsoft.Crm.Client.Core.Framework.ISerializable);Microsoft.Crm.Client.Core.Offline.$Ki.registerClass("Microsoft.Crm.Client.Core.Offline.$Ki",null,Microsoft.Crm.Client.Core.Storage.DataApi.$Gj);Microsoft.Crm.Client.Core.Offline.$Kj.registerClass("Microsoft.Crm.Client.Core.Offline.$Kj");Microsoft.Crm.Client.Core.Offline.$Y.registerClass("Microsoft.Crm.Client.Core.Offline.$Y",null,Microsoft.Crm.Client.Core.Storage.DataApi.$Ge,Microsoft.Crm.Client.Core.Storage.DataApi.$Gu);Microsoft.Crm.Client.Core.Offline.$G.registerClass("Microsoft.Crm.Client.Core.Offline.$G",null,Microsoft.Crm.Client.Core.Storage.DataApi.$Gf);Microsoft.Crm.Client.Core.Offline.$G.$PQ.registerClass("Microsoft.Crm.Client.Core.Offline.$G.$PQ");Microsoft.Crm.Client.Core.Offline.$25.registerClass("Microsoft.Crm.Client.Core.Offline.$25");Microsoft.Crm.Client.Core.Offline.$2C.registerClass("Microsoft.Crm.Client.Core.Offline.$2C");Microsoft.Crm.Client.Core.Offline.$j.registerClass("Microsoft.Crm.Client.Core.Offline.$j");Microsoft.Crm.Client.Core.Offline.$K5.registerClass("Microsoft.Crm.Client.Core.Offline.$K5");Microsoft.Crm.Client.Core.Offline.$K6.registerClass("Microsoft.Crm.Client.Core.Offline.$K6");Microsoft.Crm.Client.Core.Offline.$K7.registerClass("Microsoft.Crm.Client.Core.Offline.$K7");Microsoft.Crm.Client.Core.Offline.$3s.registerClass("Microsoft.Crm.Client.Core.Offline.$3s");Microsoft.Crm.Client.Core.Offline.$4q.registerClass("Microsoft.Crm.Client.Core.Offline.$4q");Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider");Microsoft.Crm.Client.Core.Offline.$K4.registerClass("Microsoft.Crm.Client.Core.Offline.$K4");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$Ol.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$Ol",Microsoft.Crm.Client.Core.Storage.Common.QueryGenerator.$Jf);Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$6G.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$6G");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$KB.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$KB");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$KB);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qo",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6t",null,Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Ef);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Om",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$KB);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$5l");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K8");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qn",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$On);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$K9");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$KA.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$KA");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jy.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jy",null,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ee);Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jz.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Jz");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Jx.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Jx");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Jx);Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Oc",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Jx);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$F");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$2z");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K0.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K0");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K1",null,Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70);Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K2.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K2",null,Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$70);Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$K3");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Dl");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8w.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8w");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8y.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8y");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$7H");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$KJ");Microsoft.Crm.Client.Core.Offline.$i.$8U=null;Microsoft.Crm.Client.Core.Offline.$v.$kO=null;Microsoft.Crm.Client.Core.Offline.$v.$CM=null;Microsoft.Crm.Client.Core.Offline.$v.$276=null;Microsoft.Crm.Client.Core.Offline.$v.$4V=null;Microsoft.Crm.Client.Core.Offline.$v.$1Q=null;Microsoft.Crm.Client.Core.Offline.$2K.$1wn=["firstname","middlename","lastname"];Microsoft.Crm.Client.Core.Offline.$2K.$29K=["participationtypemask","activityid","activitypartyid","partyid","ispartydeleted","partyobjecttypecode"];Microsoft.Crm.Client.Core.Offline.$2K.$1Mn={from:"1",to:"2",cc:"3",bcc:"4",requiredattendees:"5",optionalattendees:"6",organizer:"7",regarding:"8",owner:"9",resources:"10",customer:"11",partner:"12"};Microsoft.Crm.Client.Core.Offline.$2K.$165={"1":"from","2":"to","3":"cc","4":"bcc","5":"requiredattendees","6":"optionalattendees","7":"organizer","8":"regarding","9":"owner","10":"resources","11":"customer","12":"partner"};Microsoft.Crm.Client.Core.Offline.$5J.$CM=null;Microsoft.Crm.Client.Core.Offline.$Y.$3=null;Microsoft.Crm.Client.Core.Offline.$G.$1L4=null;Microsoft.Crm.Client.Core.Offline.$G.$PQ.$1u3="$_NORSYNC_CURRENT_TIME";Microsoft.Crm.Client.Core.Offline.$G.$PQ.$27C="$_NORSYNC_TIMEZONE_OFFSET";Microsoft.Crm.Client.Core.Offline.$G.$PQ.$1v6="$_NORSYNC_DST_ADJUSTMENT";Microsoft.Crm.Client.Core.Offline.$25.$CM=null;Microsoft.Crm.Client.Core.Offline.$j.$C=null;Microsoft.Crm.Client.Core.Offline.$j.$2GF="INSERT INTO _NORSYNC_SUPPRESS_TRIGGERS(value) VALUES(1)";Microsoft.Crm.Client.Core.Offline.$j.$2GE="DELETE FROM _NORSYNC_SUPPRESS_TRIGGERS";Microsoft.Crm.Client.Core.Offline.$3s.$3=null;Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$1q.$Bn=null;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=null;this.$WB=0;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$18N=null;this.$dD=null;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$27.$1ln=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["traversedpath","stageid","processid"]);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$1l.$C=null;Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$3y.$3=null
//# sourceMappingURL=../../../../../../../../../../Symbols/retail/amd64/jsmin/Microsoft.Crm.Client.Core.Offline.js.srcmap
