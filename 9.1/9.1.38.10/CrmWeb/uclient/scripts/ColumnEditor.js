(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/ColumnEditor.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[32],{"12bH":function(e,t,i){"use strict";i.r(t),i.d(t,"ColumnEditor",(function(){return ye}));var n=i("nuS9"),o=i("YWpA"),r=i("u+q+"),s=i("H/hG"),a=i("4PNl");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const l=new Map([["string","TextField"],["datetime","DateTime"],["double","NumberField"],["integer","NumberField"],["decimal","NumberField"],["bigint","NumberField"],["boolean","CheckboxComposite"],["picklist","Dropdown"],["lookup","LookupEntities"],["memo","TextBox"],["money","Money"],["uniqueidentifier","GUID"],["status","Dropdown"],["image","PictureFill"],["state","Dropdown"],["virtual","Unknown"],["entityname","Unknown"],["owner","Contact"],["customer","LookupEntities"],["partylist","list"],["default","Unknown"]]);function d(e){var t;return null!==(t=l.get(e))&&void 0!==t?t:l.get("default")}var c;!function(e){e.Custom="custom",e.Default="default",e.All="all"}(c||(c={}));var p=i("SAYH"),u=i("TW2h"),m=i("OPrh"),h=i("p/2N"),g=i("iZ7K"),y=i("LbMF"),b=i("unFF"),E=i("IqkD");var f=i("MHA6"),S=i("d3i+");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const v={border:"1px gray",borderRadius:4,marginBottom:".5rem",backgroundColor:"#f3f2f1",width:"100%",display:"flex",cursor:"move"},C={marginLeft:"auto",marginRight:"8"};class w extends n.Component{constructor(e){super(e),this.render=()=>{const e=this.props.menuItems;this._isDragSourceIndex&&(this.setState({isHovering:!1}),this._isDragSourceIndex=!1);const t=this.state.isHovering&&!this.props.dragInProgress?n.createElement(f.IconButton,{tabIndex:0,style:Object.assign({},C),id:this._iconUniqueId,key:this._iconUniqueId,menuIconProps:{iconName:"More"},menuProps:{items:e},"aria-label":this.props.moreOptionsString,onMenuClick:()=>{this.setState({isContextMenuOpen:!0})},onAfterMenuDismiss:this._closeContextMenu,onBlur:this._onEllipsis}):null;return this.props.dragInProgress&&this.state.isHovering&&(this._isDragSourceIndex=!0),!this.props.dragInProgress&&this.state.isHovering&&this.props.setActiveEllipsis(this._iconUniqueId),n.createElement("div",{tabIndex:0,key:this._guid,style:v,autoFocus:!0,role:"menuitem","aria-label":this.props.displayName,onFocus:this._onMouseEnter,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,onKeyDown:this._onCardBlur,title:this.props.displayName},n.createElement(S.Icon,{iconName:this.props.displayIconName,style:Object.assign(Object.assign({},this.props.columnEditorStyles.attributeIcon),{margin:"8px"})}),n.createElement(s.a,{style:{margin:"8px"}},this.props.displayName),t)},this._onMouseEnter=()=>{this.setState({isHovering:!0})},this._onMouseLeave=()=>{this.setState({isHovering:!1})},this._closeContextMenu=()=>{this.setState({isContextMenuOpen:!1})},this._onEllipsis=()=>{this.state.isContextMenuOpen?this.setState({isHovering:!0}):this.setState({isHovering:!1})},this._onCardBlur=e=>{e.shiftKey&&9===e.keyCode&&this._onMouseLeave()},this.state={isHovering:!1,isContextMenuOpen:!1},this._guid=p.a.newGuid().guid.replace(/-/g,""),this._iconUniqueId="MoreOptions "+this.props.displayName+this._guid,this._isDragSourceIndex=!1}}var x=i("l2jD"),D=i("+Zeg");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const O=n.forwardRef(({displayName:e,displayIconName:t,menuItems:i,isDragging:o,columnEditorStyles:r,connectDragSource:s,connectDropTarget:a,dragInProgress:l,moreOptionsString:d,setActiveEllipsis:c},p)=>{const u=n.useRef(null);s(u),a(u),n.useImperativeHandle(p,()=>({getNode:()=>u.current}));const m=o?0:1;return n.createElement("div",{ref:u,style:{opacity:m}},n.createElement(w,{menuItems:i,columnEditorStyles:r,displayName:e,displayIconName:t,dragInProgress:l,moreOptionsString:d,setActiveEllipsis:c}))}),_=Object(x.a)("DragAndDropCard",{beginDrag:e=>({index:e.index})},(e,t)=>({connectDragSource:e.dragSource(),isDragging:t.isDragging(),dragInProgress:!!t.getItem()}));var N=Object(D.a)("DragAndDropCard",{hover(e,t,i){if(!i.getNode())return null;const n=t.getItem().index,o=e.index;if(n===o)return;const r=i.getNode().getBoundingClientRect(),s=(r.bottom-r.top)/2,a=t.getClientOffset().y-r.top;n<o&&a<s||n>o&&a>s||(e.moveField(n,o),t.getItem().index=o)}},e=>({connectDropTarget:e.dropTarget()}))(_(O)),A=i("p/Kg"),R=i("FZDd"),T=i("P6DH"),M=i("KBcj"),k=i("BFlg");const I=k.x+".ColumnEditor",L={name:"",width:150,relatedEntityName:"",isHidden:!1,imageProviderWebresource:"",imageProviderFunctionName:""};function j(e){try{return{fetchXML:(new XMLSerializer).serializeToString(e),errorMessage:null}}catch(e){return{fetchXML:null,errorMessage:e}}}function F(e){const t=new DOMParser;let i;const n=t.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI,o=t.parseFromString(e,"text/xml"),r=o.getElementsByTagNameNS(n,"parsererror");return r.length>0&&(i=r[0].textContent),{xml:o,errorMessage:i}}function B(e,t){if(t){return e?e+" "+t:t}}var V=i("Pqgs"),P=i("AfSU");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const X="related",H="entity",z=e=>n.createElement(o.a,{style:{marginBottom:"16"}},n.createElement(V.a,{onLinkClick:e.onClick,selectedKey:e.selectedKey,styles:e.pivotStyles},n.createElement(P.a,{itemKey:H,linkText:e.entityDisplayNameText,"aria-label":e.entityDisplayNameText,tabIndex:0}),n.createElement(P.a,{itemKey:X,linkText:e.relatedText,"aria-label":e.relatedText,tabIndex:0})));var U=i("UA/f"),G=i("6Cai"),$=i("syeT");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const K=e=>{const t={value:e.columnEditorSearchValue,onChange:e.onSearchValueChanged,placeholder:e.localizedStrings.search,ariaLabel:e.localizedStrings.search},i={selectedItem:e.searchFilter,onChangeDropdown:e.onSearchDropdownChanged,dropdownOptions:[{key:c.Default,text:e.localizedStrings.dropDownDefault,title:e.localizedStrings.dropDownDefault,ariaLabel:e.localizedStrings.dropDownDefault},{key:c.All,text:e.localizedStrings.dropDownAll,title:e.localizedStrings.dropDownAll,ariaLabel:e.localizedStrings.dropDownAll},{key:c.Custom,text:e.localizedStrings.dropDownCustom,title:e.localizedStrings.dropDownCustom,ariaLabel:e.localizedStrings.dropDownCustom}]};return n.createElement($.a,{horizontal:!0,style:{width:"302px",marginRight:"16px"}},n.createElement(o.a,{style:e.searchContainerStyle},n.createElement(G.a,Object.assign({},t,{style:e.searchBoxStyle}))),n.createElement(U.a,{selectedKey:i.selectedItem.key,onChanged:i.onChangeDropdown,styles:e.filterStyle,options:i.dropdownOptions,dropdownWidth:"auto","aria-label":e.localizedStrings.dropdown}))};var q=i("pk53"),Z=i("7meg"),W=i("8BKt");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const J=e=>{let t=!0;const i=e.entityAttributes,r=[];i&&Object.keys(i).forEach(n=>{const o=i[n];e.shouldRenderAttribute(o)&&(r.push(o),t=!1)});const s=t&&e.currentTab===H&&n.createElement(o.a,{style:{marginTop:"16px"}},e.emptyFieldsString);return r.sort((e,t)=>{var i;return null===(i=e.DisplayName)||void 0===i?void 0:i.localeCompare(t.DisplayName)}),n.createElement(o.a,null,n.createElement(q.a,{style:e.focusZoneStyle,direction:Z.a.vertical},n.createElement(a.a,null,e.currentTab===H&&n.createElement(W.a,{role:"menu",style:e.attributeListStyle,items:r,onRenderCell:t=>e.renderAttributes(t)}),s)),e.currentTab===X&&e.renderRelatedEntities(i))};var Y=i("URN4");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Q extends n.Component{_constructTree(){const e=this._getRelationAttributes(),t=[];return e.forEach(e=>{const i=this.props.getEntityAttributes(e.ReferencedEntity),n=[];if(i&&Object.keys(i).forEach(t=>{const o=i[t];if(e.IsValidForAdvancedFind&&this.props.shouldRenderAttribute(o,e)){const t=this.props.entityAttributes[e.ReferencingAttribute]?`${o.DisplayName} (${this.props.entityAttributes[e.ReferencingAttribute].DisplayName})`:"",i=`${o.LogicalName}.${e.ReferencingAttribute}`;n.push({label:t,ariaLabel:t,key:i,attribute:o,relation:e,iconProps:{iconName:d(o.Type)}})}}),n.sort((e,t)=>e.label.localeCompare(t.label)),n.length>0){const i=this.props.getEntityDisplayName(e.ReferencedEntity);if(i){const o=this.props.entityAttributes[e.ReferencingAttribute]?`${this.props.entityAttributes[e.ReferencingAttribute].DisplayName} (${i})`:"";t.push({label:o,ariaLabel:o,key:e.ReferencingEntityNavigationPropertyName+e.ReferencedEntity,relation:e,children:n})}}}),t.sort((e,t)=>e.label.localeCompare(t.label)),this._message=0===t.length&&n.createElement(o.a,{style:{margin:"16px"}},this.props.emptyFieldsString),t}_getRelationAttributes(){var e;if(!this._prevManyToOneRelationships||!this._prevRelationAttributes||this._prevManyToOneRelationships!==this.props.manyToOneRelationships){const t=this.props.manyToOneRelationships&&(null===(e=Object.keys(this.props.manyToOneRelationships))||void 0===e?void 0:e.map(e=>this.props.manyToOneRelationships[e]));return this._prevRelationAttributes=t,this._prevManyToOneRelationships=this.props.manyToOneRelationships,t}return this._prevRelationAttributes}render(){const e=this._constructTree();return n.createElement("div",{style:{width:"320px",height:"180px"}},this._message,n.createElement(Y.TreeView,{styles:this.props.treeViewStyle,items:e,strings:{listAriaLabel:this.props.listAriaLabelString},onItemSelected:this.props.onItemSelected}))}}var ee=i("X1rd"),te=i("BNdr"),ie=i("mZYD"),ne=i("QBtP"),oe=i("KMIC");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const re=k.x+".AttributesCallout.";class se extends n.Component{constructor(e){super(e),this._updateSearchStringTimeout=50,this.render=()=>n.createElement(ee.Callout,{hideOverflow:!0,target:"#AddColumnsBtn",role:"dialog",styles:{calloutMain:{maxHeight:"360",width:"320"}},DirectionalHint:ee.DirectionalHint.bottomLeftEdge,onDismiss:()=>{this.props.closeColumnEditorCallout()},ariaDescribedBy:this.props.columnEditorStrings.addColumn},n.createElement(oe.FocusTrapZone,null,n.createElement(o.a,null,n.createElement(o.a,{style:this.props.columnEditorStyles.addColumnHeaderRoot},n.createElement(s.a,{id:this.props.columnEditorStrings.addColumn,style:this.props.columnEditorStyles.addColumnHeaderTitle},this.props.columnEditorStrings.addColumn),n.createElement(f.IconButton,{role:"img",iconProps:{iconName:"Cancel"},style:this.props.columnEditorStyles.addColumncloseButton,onClick:()=>{this.props.closeColumnEditorCallout()},"aria-label":this.props.columnEditorStrings.close,title:this.props.columnEditorStrings.close,autoFocus:!0})),n.createElement(o.a,{style:this.props.columnEditorStyles.root},n.createElement(o.a,{style:this.props.columnEditorStyles.header},this._renderPivots()),this._renderSearchBox(),n.createElement(o.a,{style:this.props.columnEditorStyles.list},this._renderListContents()))))),this._getViewDescriptor=()=>JSON.parse(JSON.stringify(this.props.viewDescriptor)),this._getFetchXml=()=>this.props.viewDescriptor.fetchXML,this._renderSearchBox=()=>n.createElement(K,{searchBoxStyle:this.props.columnEditorStyles.searchBox,filterStyle:this.props.columnEditorStyles.filterStyle,searchContainerStyle:this.props.columnEditorStyles.searchContainer,columnEditorSearchValue:this.state.columnEditorsearchValue,onSearchValueChanged:this._onSearchValueChanged,searchFilter:this.state.searchFilter,onSearchDropdownChanged:this._onSearchDropdownChanged,localizedStrings:{search:this.props.columnEditorStrings.search,dropdown:this.props.columnEditorStrings.dropdown,dropDownDefault:this.props.columnEditorStrings.dropDownOptionsDefault,dropDownAll:this.props.columnEditorStrings.dropDownOptionsAll,dropDownCustom:this.props.columnEditorStrings.dropDownOptionsCustom}}),this._renderListContents=()=>{var e;return n.createElement(J,{entityAttributes:this.props.getEntityAttributes(null===(e=this.props.entityMetadata)||void 0===e?void 0:e.EntityLogicalName),shouldRenderAttribute:this._shouldRenderAttribute,focusZoneStyle:this.props.columnEditorStyles.focusZone,attributeListStyle:this.props.columnEditorStyles.attributeList,currentTab:this.state.currentTab,renderAttributes:this._renderAttributes,renderRelatedEntities:this._renderRelatedEntities,emptyFieldsString:this.props.columnEditorStrings.noFieldsToDisplay})},this._onSearchDropdownChanged=e=>{this.setState({searchFilter:e})},this._onItemSelected=e=>{var t;if(e.attribute){const i=function(e,t,i,n,o){var r,s;let a;const l=F(n),d=l.xml;a=B(a,l.errorMessage);let c=p.a.newGuid().guid.replace(/-/g,"");c="a_".concat(c);const u=d.querySelector(`[name="${t.ReferencedEntity}"][from="${t.ReferencedAttribute}"][to="${t.ReferencingAttribute}"]`);if(u){const t=d.createElement("attribute");t.setAttribute("name",e.LogicalName),u.append(t),c=u.getAttribute("alias")}else{const i=d.createElement("link-entity");i.setAttribute("name",t.ReferencedEntity),i.setAttribute("from",t.ReferencedAttribute),i.setAttribute("to",t.ReferencingAttribute),i.setAttribute("link-type","outer"),i.setAttribute("alias",c),i.setAttribute("visible","false");const n=d.createElement("attribute");n.setAttribute("name",e.LogicalName),i.append(n),d.getElementsByTagName("entity")[0].append(i)}L.name=c+"."+e.LogicalName,L.relatedEntityName=e.EntityLogicalName,null===(s=null===(r=null==i?void 0:i.grid)||void 0===r?void 0:r.rows[0])||void 0===s||s.cells.push(L);const m=j(d.documentElement);if(i.fetchXML=m.fetchXML,a=B(a,m.errorMessage),a){const i=[{name:"RelatedColumnToAdd",value:e.LogicalName},{name:"Relation",value:t.ReferencedEntity}];null==o||o.ReportComponentFailure(Object(k.G)(I+".AttributesCallout","AddRelatedColumn"),new Error(a),"",i)}return i}(e.attribute,e.relation,this._getViewDescriptor(),this._getFetchXml(),null===(t=this.context)||void 0===t?void 0:t.EventManager);i&&(this.props.addedColumnCallout(i.fetchXML,i),this.props.closeColumnEditorCallout())}},this._renderRelatedEntities=e=>n.createElement(Q,{entityAttributes:e,manyToOneRelationships:this.props.manyToOneRelationships,getEntityAttributes:this.props.getEntityAttributes,shouldRenderAttribute:this._shouldRenderAttribute,getEntityDisplayName:this.props.getEntityDisplayName,treeViewStyle:this.props.columnEditorStyles.treeView,onItemSelected:this._onItemSelected,listAriaLabelString:this.props.columnEditorStrings.listAriaLabel,emptyFieldsString:this.props.columnEditorStrings.noFieldsToDisplay}),this._shouldRenderAttribute=(e,t)=>{const i=Object(h.d)(this._getViewDescriptor());let n=!1;return i.forEach(i=>{i.relatedEntityName&&t?this._isRelatedEntityAttributeInFetchXml(i,e,t)&&(n=!0):t||i.name!==e.LogicalName||(n=!0)}),!(n||!e.DisplayName||this.state.columnEditorsearchValue&&!this._matchSearchString(e,this.state.columnEditorsearchValue)||this.state.searchFilter.key===c.Custom&&!e.IsCustomAttribute||t&&this.state.searchFilter.key===c.Custom&&!t.IsCustomRelationship||this.state.searchFilter.key===c.Default&&e.IsCustomAttribute||!e.IsValidForGrid)},this._isRelatedEntityAttributeInFetchXml=(e,t,i)=>{const n=e.name.split(".");if(2!==n.length)return!1;const o=n[0],r=n[1],s=(new DOMParser).parseFromString(this._getFetchXml(),"text/xml").getElementsByTagName("attribute");if(r!==t.LogicalName)return!1;for(let e=0;e<s.length;e++)if(s[e].getAttribute("name")===r){const t=s[e].parentNode,n=s[e].parentElement;if("link-entity"===t.nodeName&&n.getAttribute("name")===(null==i?void 0:i.ReferencedEntity)&&n.getAttribute("from")===(null==i?void 0:i.ReferencedAttribute)&&n.getAttribute("to")===(null==i?void 0:i.ReferencingAttribute)&&n.getAttribute("alias")===o)return!0}return!1},this._renderPivots=()=>n.createElement(z,{entityDisplayNameText:this.props.entityMetadata.DisplayName,relatedText:this.props.columnEditorStrings.related,onClick:this._onLinkClick,selectedKey:this.state.currentTab,pivotStyles:this.props.columnEditorStyles.pivot}),this._onLinkClick=e=>{e&&this.setState({currentTab:e.props.itemKey})},this._renderAttributes=e=>{const t=d(e.Type),i=Object(ie.b)({itemCell:[{boxSizing:"border-box",display:"flex",selectors:{"&:hover":{background:"#f3f2f1"},"&:focus":{background:"#f3f2f1"}}}]});return n.createElement("div",{"data-is-focusable":!0,style:this.props.columnEditorStyles.attributeContainer,role:"menuitem",className:i.itemCell,onClick:()=>{var t;const i=function(e,t,i,n){var o,r;let s;const a=F(i),l=a.xml;s=B(s,a.errorMessage);const d=l.createElement("attribute");d.setAttribute("name",e),l.getElementsByTagName("entity")[0].append(d),L.name=e,L.relatedEntityName="",null===(r=null===(o=null==t?void 0:t.grid)||void 0===o?void 0:o.rows[0])||void 0===r||r.cells.push(L);const c=j(l.documentElement);if(t.fetchXML=c.fetchXML,s=B(s,c.errorMessage),s){const t=[{name:"ColumnToAdd",value:e}];null==n||n.ReportComponentFailure(Object(k.G)(I+".AttributesCallout","AddColumn"),new Error(s),"",t)}return t}(e.LogicalName,this._getViewDescriptor(),this._getFetchXml(),null===(t=this.context)||void 0===t?void 0:t.EventManager);i&&(this.props.addedColumnCallout(i.fetchXML,i),this.props.closeColumnEditorCallout())},key:e.LogicalName,tabIndex:0,"aria-label":e.DisplayName},n.createElement(S.Icon,{iconName:t,style:this.props.columnEditorStyles.attributeIcon}),n.createElement(te.a,{style:this.props.columnEditorStyles.attributeLabel},e.DisplayName))},this._onSearchValueChanged=(e,t)=>{this._updateSearchStringTimer&&window.clearTimeout(this._updateSearchStringTimer),this._updateSearchStringTimer=window.setTimeout(()=>{this._updateSearchStringTimer=null,this.setState({columnEditorsearchValue:t||""})},this._updateSearchStringTimeout)},this.state={columnEditorsearchValue:"",currentTab:H,searchFilter:{key:c.Default,text:this.props.columnEditorStrings.dropDownOptionsDefault}}}componentDidMount(){var e;null===(e=this.context)||void 0===e||e.EventManager.ReportComponentSuccess(Object(k.G)(re,"AddColumn"))}_matchSearchString(e,t){const i=e.DisplayName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return i.match(new RegExp(n,"i"))}}se.contextType=ne.a;var ae=i("Gtuy"),le=i("4+ZN"),de=i("LuuA"),ce=i("Hlh+"),pe=i("JwRZ"),ue=i("b41/"),me=i("YxC/");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const he=k.x+".ColumnEditor";class ge extends n.Component{constructor(e){super(e),this._addButtonElement=n.createRef(),this._resourceStringsDictionary=new Map,this._renderPanelHeader=()=>n.createElement(o.a,{style:this.props.columnEditorStyles.panelNavigationContainerStyle},n.createElement(s.a,{style:this.props.columnEditorStyles.panelNavigationHeaderStyle},this.props.columnEditorStrings.editColumns),n.createElement(f.IconButton,{ref:this._addButtonElement,style:{root:this.props.columnEditorStyles.addButton},"aria-label":this.props.columnEditorStrings.close,iconProps:{iconName:"Cancel"},title:this.props.columnEditorStrings.close,onClick:this._onCancelClick})),this._getViewDescriptor=()=>{var e;return null!==(e=this.state.editedViewDescriptor)&&void 0!==e?e:JSON.parse(JSON.stringify(this.props.viewDescriptor))},this._getView=()=>JSON.parse(JSON.stringify(this.props.view)),this._getFetchXml=()=>this.state.editedFetchXml||this.props.fetchXML,this._renderPanelBody=()=>{const e=Object(h.d)(this._getViewDescriptor());return this.props.entityMetadata&&this.props.retrieveEntity(this.props.entityMetadata.EntityLogicalName),this.props.manyToOneRelationships&&Object.keys(this.props.manyToOneRelationships).forEach(e=>{this.props.retrieveEntity(this.props.manyToOneRelationships[e].ReferencedEntity)}),n.createElement(o.a,null,n.createElement(le.CommandButton,{tabIndex:0,autoFocus:!0,id:"AddColumnsBtn",styles:this.props.columnEditorStyles.addColumnButton,iconProps:{iconName:"Add"},text:this.props.columnEditorStrings.addColumn,title:this.props.columnEditorStrings.addColumn,"aria-label":this.props.columnEditorStrings.addColumn,onClick:()=>this.setState({columnEditorCalloutOpen:!0})}),n.createElement(le.CommandButton,{tabIndex:0,id:"ResetToDefaultBtn",styles:this.props.columnEditorStyles.addColumnButton,iconProps:{iconName:"Undo"},text:this.props.columnEditorStrings.resetToDefault,title:this.props.columnEditorStrings.resetToDefault,"aria-label":this.props.columnEditorStrings.resetToDefault,disabled:!this.state.resetToDefaultEnabled,onClick:()=>{var e,t,i;const n=function(e,t,i,n){let o,r=Object(h.d)(e);const s=Object(h.d)(t),a=new Set,l=new Set,d=new Set;for(let e=0;e<r.length;e++){let t=!1;for(let i=0;i<s.length;i++)if(s[i].name===r[e].name){t=!0;break}d.add(r[e].name),t||a.add(e)}for(let e=0;e<s.length;e++)d.has(s[e].name)||l.add(s[e]);let c="";return a.forEach(e=>{let t=""!==c?c:i;const s=F(t),a=s.xml;o=B(o,s.errorMessage);const l=a.getElementsByTagName("attribute");let d="";d=r[e].relatedEntityName?r[e].name.split(".")[1]:r[e].name;for(let e=0;e<l.length;e++)if(l[e].getAttribute("name")===d){const t=l[e].parentNode;null!==t&&("link-entity"===t.nodeName?t.parentNode.removeChild(t):t.removeChild(l[e]))}const p=a.querySelectorAll(`[attribute="${d}"]`);for(let e=0;e<p.length;e++)p[e].parentNode.removeChild(p[e]);const u=j(a.documentElement);t=u.fetchXML,o=B(o,u.errorMessage),o&&(null==n||n.ReportComponentFailure(Object(k.G)(I,"ResetToDefault"),new Error(o))),c=t}),l.forEach(e=>{const n=F(""!==c?c:i),r=n.xml;if(o=B(o,n.errorMessage),e.relatedEntityName){const i=F(t.fetchXML),n=i.xml;o=B(o,i.errorMessage);const s=e.name.split(".")[0],a=n.querySelector(`[alias="${s}"]`);r.getElementsByTagName("entity")[0].append(a)}else{const t=r.createElement("attribute");t.setAttribute("name",e.name),r.getElementsByTagName("entity")[0].append(t)}const s=j(r.documentElement);c=s.fetchXML,o=B(o,s.errorMessage)}),r=s,e.grid.rows[0].cells=r,c&&(e.fetchXML=c),e}(this._getViewDescriptor(),this._getView(),this._getFetchXml(),null===(e=this.context)||void 0===e?void 0:e.EventManager);n&&(this.setState({editedViewDescriptor:n,editedFetchXml:n.fetchXML,viewEdited:!0,resetToDefaultEnabled:!1,resetClick:!0}),null===(i=null===(t=this.context)||void 0===t?void 0:t.EventManager)||void 0===i||i.ReportComponentSuccess(Object(k.G)(he,"ResetToDefault")))}}),n.createElement(o.a,{style:this.props.columnEditorStyles.panelBody},this.state.columnEditorCalloutOpen&&this._renderAttributesCallout(),n.createElement(m.a,{backend:u.a},n.createElement(a.a,{accessibilityRole:"menu"},null==e?void 0:e.map((e,t)=>this._renderFieldForEditor(e,t)))),n.createElement($.a,{horizontal:!0,tokens:{childrenGap:20},style:this.props.columnEditorStyles.applyCancelStack},n.createElement(de.PrimaryButton,{text:this.props.columnEditorStrings.apply,onClick:()=>{this._applyChangesToView()},allowDisabledFocus:!0,disabled:!this.state.viewEdited,checked:!1,title:this.props.columnEditorStrings.apply,"aria-label":this.props.columnEditorStrings.apply}),n.createElement(ce.DefaultButton,{text:this.props.columnEditorStrings.cancel,onClick:this._onCancelClick,allowDisabledFocus:!0,checked:!1,title:this.props.columnEditorStrings.cancel,"aria-label":this.props.columnEditorStrings.cancel}))))},this._onCancelClick=()=>{if(this.state.viewEdited){const e=this.props.columnChanges;this.setState({viewEdited:!1,editedViewDescriptor:null,editedFetchXml:"",resetToDefaultEnabled:e,resetClick:!1}),this.props.columnEditorPanelDismiss()}else this.props.columnEditorPanelDismiss()},this._renderAttributesCallout=()=>n.createElement(se,{columnEditorStyles:this.props.columnEditorStyles,entityMetadata:this.props.entityMetadata,getEntityAttributes:this.props.getEntityAttributes,manyToOneRelationships:this.props.manyToOneRelationships,viewDescriptor:this._getViewDescriptor(),getEntityDisplayName:this.props.getEntityDisplayName,closeColumnEditorCallout:()=>{this.setState({columnEditorCalloutOpen:!1})},addedColumnCallout:(e,t)=>{this.setState({editedFetchXml:e,editedViewDescriptor:t,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},columnEditorStrings:this.props.columnEditorStrings}),this._renderFieldForEditor=(e,t)=>{let i="",o="";const r=Object(h.d)(this._getViewDescriptor());if(e.isHidden)return;if(e.relatedEntityName){i=this.props.getLinkedEntityAttributeDisplayName(e,this._getViewDescriptor(),this._getFetchXml());const t=e.name.split(".")[1],n=this.props.getAttributeDescriptor(e.relatedEntityName,t);o=d(null==n?void 0:n.Type)}else{const t=this.props.getAttributeDescriptor(this.props.entityTypeName,e.name);i=null==t?void 0:t.DisplayName,o=d(null==t?void 0:t.Type)}e.labelId&&(this._resourceStringsDictionary.get(e.labelId)?i=this._resourceStringsDictionary.get(e.labelId):(i=this.props.getResourceStringById(e.labelId),this._resourceStringsDictionary.set(e.labelId,i)));const s=[];return e.disableMetaDataBinding||s.push({key:"Remove"+e.name,text:this.props.columnEditorStrings.fieldContextMenuRemove,onClick:()=>{var e;const i=function(e,t,i,n){let o;const r=Object(h.d)(t);let s="";s=r[e].relatedEntityName?r[e].name.split(".")[1]:r[e].name;let a=i;const l=F(a),d=l.xml;o=B(o,l.errorMessage);const c=d.getElementsByTagName("attribute");for(let e=0;e<c.length;e++)if(c[e].getAttribute("name")===s){const t=c[e].parentNode;"link-entity"===t.nodeName?(t.removeChild(c[e]),0===t.children.length&&t.parentNode.removeChild(t)):t.removeChild(c[e])}const p=j(d.documentElement);if(a=p.fetchXML,o=B(o,p.errorMessage),r.splice(e,1),t.grid.rows[0].cells=r,t.fetchXML=a,o){const t=[{name:"FailedToRemoveIndex",value:e}];null==n||n.ReportComponentFailure(Object(k.G)(I,"RemoveColumn"),new Error(o),"",t)}return t}(t,this._getViewDescriptor(),this._getFetchXml(),null===(e=this.context)||void 0===e?void 0:e.EventManager);this.setState({editedViewDescriptor:i,editedFetchXml:i.fetchXML,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},iconProps:{iconName:"Delete"},ariaLabel:this.props.columnEditorStrings.fieldContextMenuRemove}),t>0&&s.push({key:"MoveUp"+e.name,text:this.props.columnEditorStrings.moveUp,onClick:()=>this._updateColumnOrder(t,t-1),iconProps:{iconName:"Up"},ariaLabel:this.props.columnEditorStrings.moveUp}),t!==r.length-1&&s.push({key:"MoveDown"+e.name,text:this.props.columnEditorStrings.moveDown,onClick:()=>{this._updateColumnOrder(t,t+1),document.getElementById(this._activeEllipsisId).focus()},iconProps:{iconName:"Down"},ariaLabel:this.props.columnEditorStrings.moveDown}),n.createElement(N,{key:e.name,index:t,moveField:this._updateColumnOrder,menuItems:s,columnEditorStyles:this.props.columnEditorStyles,displayName:i,displayIconName:o,moreOptionsString:this.props.columnEditorStrings.moreOptions,setActiveEllipsis:this._setActiveEllipsis})},this._updateColumnOrder=(e,t)=>{const i=this._getViewDescriptor(),n=Object(h.d)(i);n.splice(t,0,n.splice(e,1)[0]),i.grid.rows[0].cells=n,this.setState({editedViewDescriptor:i,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},this._setActiveEllipsis=e=>{this._activeEllipsisId=e},this.state={columnEditorCalloutOpen:!1,editedViewDescriptor:null,editedFetchXml:"",viewEdited:!1,resetToDefaultEnabled:!1,resetClick:!1}}componentDidMount(){var e;null===(e=this.context)||void 0===e||e.EventManager.ReportComponentSuccess(he,"Open")}render(){return n.createElement(ae.a,{isOpen:this.props.columnEditorPanelOpen,title:this.props.columnEditorStrings.editColumns,closeButtonAriaLabel:this.props.columnEditorStrings.close,onRenderNavigation:this._renderPanelHeader,onDismiss:this.props.columnEditorPanelDismiss,onRenderBody:this._renderPanelBody,layerProps:{eventBubblingEnabled:!0}})}_applyChangesToView(){var e,t;const i=this._getViewDescriptor(),n=this.props.gridInput.pageToEditedViewMapId?this.props.gridInput.pageToEditedViewMapId:p.a.newGuid(),o=Object.assign(Object.assign({},this.props.gridInput),{pageToEditedViewMapId:n});this.props.updatePageInput(o,this.props.pageId);let r=!0;if(this.state.resetClick){r=!1;const e=this._getFetchXml();this.props.removeEditedViewPageMap(n.guid,this.props.viewId),this.props.isAdvancedFindFilterEdited&&this.props.updateEditedViewPageMap(n.guid,this.props.viewId,e)}else this.props.updateEditedViewPageMap(n.guid,this.props.viewId,this._getFetchXml(),i.grid);this.props.onViewChanged(this.props.viewId.guid,this.props.entityTypeName),this.setState({editedViewDescriptor:null,viewEdited:!1,editedFetchXml:"",resetToDefaultEnabled:r,resetClick:!1}),this.props.columnEditorPanelDismiss(),null===(t=null===(e=this.context)||void 0===e?void 0:e.EventManager)||void 0===t||t.ReportComponentSuccess(Object(k.G)(he,"Apply"))}}const ye=Object(r.a)((e,t)=>{var i,n;const o=Object(g.h)(e,t.entityTypeName),r=Object(T.qb)(e,t.viewId,t.pageId),s=Object(M.c)(e,t.viewId),a=
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function(){let e=null;const t={panelNavigationContainerStyle:{display:"flex",flexDirection:"row"},panelNavigationHeaderStyle:{fontWeight:600,fontSize:"20px",width:"100%"},root:{width:"100%",display:"flex",flexDirection:"column",paddingLeft:"0px",paddingRight:"0px",overflowY:"auto"},header:{paddingLeft:"16px",paddingRight:"16px",display:"flex",flexDirection:"column"},addButton:{},searchContainer:{display:"inline",minHeight:"32px",width:"180px",marginBottom:"12px",background:"white"},list:{display:"flex",minHeight:"5em",flexDirection:"column",flexGrow:1,overflowY:"auto",overflowX:"hidden",borderTop:"1px solid #c8c6c4"},addColumnHeaderRoot:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:"16px",borderBottomColor:"#f3f2f1"},addColumnHeaderTitle:{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#201f1e",fontSize:"14px",fontWeight:"bold"},addColumncloseButton:{color:"#201f1e",width:"16px",height:"16px",fontSize:"16px"},focusZone:{display:"flex",flex:"1 0 auto"},panelBody:{flexDirection:"column"},applyCancelStack:{position:"absolute",bottom:"10px"},attributeList:{overflowY:"auto",maxHeight:"180px",mariginBottom:"16px",display:"flex",flexDirection:"column"},attributeIcon:{fontSize:"16px",marginTop:"8px"},attributeLabel:{fontSize:"14px",whiteSpace:"nowrap",TextOverflow:"ellipsis",textAlign:"left",flexGrow:1,overflow:"hidden",cursor:"pointer"},attributeContainer:{display:"flex",":hover":{backgroundColor:"#f3f2f1"},":focus":{backgroundColor:"#f3f2f1"},cursor:"pointer"},searchBox:{minWidth:0,background:"white",width:"180px",borderRight:"0px",borderRadius:"0px",selectors:{"&:after":{content:'""',position:"absolute",right:"0px",top:"5px",bottom:"5px",borderRight:"1px solid #a19f9d"},"&:hover":{borderRight:"1px solid #323130"},"&.is-active, &:focus":{borderRight:"1px solid #742774"},"&:hover:after, &.is-active:after, &:focus:after":{display:"none"}}},treeView:{root:{backgroundColor:"white"},scrollView:{overflowX:"hidden"}},filterStyle:{root:{width:"101px",left:"-1px",position:"relative",selectors:{"&:hover .ms-Dropdown-title":{borderLeft:"1px solid '#323130'"},"&:focus .ms-Dropdown-title":{borderLeft:"1px solid #742774"}}},title:{borderLeft:"1px solid transparent",background:"transparent"}},addColumnButton:{root:{marginLeft:"10px"}},pivot:{link:{lineHeight:30,height:30,maxWidth:150},linkIsSelected:{paddingLeft:0,lineHeight:30,height:30,selectors:{":before":{borderRadius:1,left:0}},maxWidth:150},text:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}}};return function(i,n){const o=Object.assign(Object.assign({},t.panelNavigationContainerStyle),{margin:n?"24px 16px 0 24px":"24px 24px 0 16px"}),r=Object.assign(Object.assign({},t.searchContainer),{["margin"+(n?"Right":"Left")]:"16px"}),s=Object.assign(Object.assign({},t.panelBody),{margin:n?"0 16px 24px 25px":"0 25px 24px 16px"}),a=Object.assign(Object.assign({},t.applyCancelStack),{[n?"left":"right"]:"10px"}),l=Object.assign(Object.assign({},t.attributeList),{["margin"+(n?"Right":"Left")]:"16px"}),d=Object.assign(Object.assign({},t.attributeIcon),{["margin"+(n?"Left":"Right")]:"6px"}),c=Object.assign(Object.assign({},t.attributeLabel),{textAlign:n?"right":"left"}),p=Object.assign(Object.assign({},t.addButton),{margin:n?"0 auto 0 0":"0 0 0 auto"});return t.pivot.link=Object.assign(Object.assign({},t.pivot.link),{["padding"+(n?"Right":"Left")]:"0px"}),e=Object.assign(Object.assign({},t),{panelNavigationContainerStyle:o,searchContainer:r,panelBody:s,applyCancelStack:a,attributeList:l,attributeIcon:d,attributeLabel:c,addButton:p}),e}}(),l=Object(b.a)(e),d=Object(E.g)(e),c=function(){const e=Object(me.h)();let t,i;return(n,o)=>{const r=e(n,o);if(!t||r!==t){const e={};for(const t in ue.a)e[t]=Object(me.c)(r,ue.a[t]);t=r,i=e}return i}}()(e,ue.e),p=!!(null===(n=Object(T.rb)(e,null===(i=t.gridInput.pageToEditedViewMapId)||void 0===i?void 0:i.guid,t.viewId.guid))||void 0===n?void 0:n.gridDescriptor);return{manyToOneRelationships:Object(g.A)(e,null==o?void 0:o.EntityLogicalName),viewDescriptor:r,getEntityAttributes:(t=o&&o.EntityLogicalName)=>Object(y.d)(e,t),entityMetadata:o,getAttributeDescriptor:(t,i)=>Object(y.a)(e,t,i),getEntityDisplayName:t=>{const i=Object(g.h)(e,t);return(null==i?void 0:i.DisplayName)||""},getLinkedEntityAttributeDisplayName:(t,i,n)=>{const o=Object(T.E)(e,i),r=(new DOMParser).parseFromString(n,"text/xml"),s=r?r.getElementsByTagName("link-entity"):null,a=Object(y.d)(e,t.relatedEntityName);return Object(pe.w)(e,t,o,s,a)},columnEditorStyles:a(l,d),view:s,columnEditorStrings:c,columnChanges:p,getResourceStringById:t=>Object(me.b)(e,t)}},(function(e,t){return{retrieveEntity:t=>{e(Object(R.f)(t,!0,[])).then(e=>e)},updateEditedViewPageMap:(t,i,n,o)=>e(Object(A.d)(t,i.guid,n,o)),removeEditedViewPageMap:(t,i)=>e(Object(A.c)(t,i.guid))}}))(ge);ge.contextType=ne.a}}]),window.bundleExecutionMarkers["scripts/ColumnEditor.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();