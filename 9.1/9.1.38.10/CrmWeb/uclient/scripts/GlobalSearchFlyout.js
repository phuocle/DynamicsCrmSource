(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/GlobalSearchFlyout.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[34],{"0EST":function(e,t,n){"use strict";n.r(t),n.d(t,"GlobalSearchFlyout",(function(){return ne}));var s=n("c/eZ"),r=n("nuS9"),o=n("pk53"),i=n("cQ/l"),a=n("1AYO"),c=n("u+q+"),l=n("QBtP"),u=n("YxC/"),m=n("EY5k"),h=n("nJrx"),d=n("ruPX"),p=n("unFF"),g=n("IqkD"),y=n("Xi8U"),E=n("FZDd"),b=n("YWpA"),R=n("X37l"),v=n("m2kE"),S=n("JQqP"),w=n("7sMj"),f=n("H/hG"),I=n("LVbe"),k=n("evW+");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function O({onItemClick:e,theme:t,height:n=I.g,children:s}){const o=Object(I.s)(t),i=Object(I.q)(n),a=Object(I.t)(t);return r.createElement(k.a,{style:o,onClick:e,role:"row"},r.createElement(b.a,{key:"grouped-item-content-row",style:i,role:"cell"},s),r.createElement(b.a,{key:"grouped-item-separator",style:a}))}var j=n("KZqt"),T=n("dvLT"),C=n("B5cQ");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function M({isDataLoaded:e,children:t}){const n=r.createElement(x,null),s=e?null:{root:{overflow:"hidden"}};return r.createElement(j.a,{isDataLoaded:e,styles:s,customElementsGroup:n},t)}function x(){return r.createElement(r.Fragment,null,r.createElement(T.a,{rowHeight:I.f,shimmerElements:[{type:C.a.gap,width:I.h,height:I.f},{type:C.a.line,width:"33%",height:I.e},{type:C.a.gap,width:"67%",height:I.f}]}),r.createElement(_,null),r.createElement(_,null),r.createElement(_,null))}function _(){return r.createElement(b.a,{style:Object(I.B)()},r.createElement(T.a,{key:"circle-shimmer",rowHeight:I.g,shimmerElements:[{type:C.a.gap,width:I.h,height:I.g},{type:C.a.circle,height:I.b},{type:C.a.gap,width:I.d,height:I.g}]}),r.createElement(T.a,{key:"line-shimmer",rowHeight:I.g,width:"100%",shimmerElements:[{type:C.a.line,height:I.c,width:"100%",verticalAlign:"center"}]}),r.createElement(T.a,{key:"right-spacing-shimmer",shimmerElements:[{type:C.a.gap,width:I.h,height:I.g}]}))}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function F(e){const t=r.useContext(l.a).EventManager,{items:n,groups:s,entitiesMetadata:o,onEntityRecordClick:i,theme:a,isRTL:c,searchSessionId:u}=e,m=n.every(e=>o.has(e.EntityTypeName));return r.createElement(M,{isDataLoaded:m},r.createElement(v.a,{items:n,onRenderCell:(e,n,s)=>{const o=Object(I.p)(a,c),l=Object(I.u)(),m="mru-item-"+s;return r.createElement(O,{key:m,onItemClick:()=>{i(n.EntityTypeName,n.ObjectId);const e=`${S.a}${S.b.clickRecentlyAccessedRecord}`,s=[{name:S.b.sessionId,value:u},{name:S.b.entityName,value:n.EntityTypeName},{name:S.b.recordId,value:n.ObjectId.guid}];t.ReportComponentSuccess(e,s)},theme:a,isRTL:c},r.createElement(w.a,{key:"mru-item-image",alt:n.Title,style:o,hasPrimaryImageField:!0,entityPrimaryField:n.Title}),r.createElement(f.a,{key:"mru-item-text",style:l},n.Title))},groups:s,groupProps:{onRenderHeader:e=>{var t,n,s;const i=Object(I.n)(a),c=(null===(n=o.get(null===(t=e.group)||void 0===t?void 0:t.name))||void 0===n?void 0:n.DisplayCollectionName)||(null===(s=e.group)||void 0===s?void 0:s.name);return r.createElement(b.a,{style:i},c)}},styles:Object(I.o)()}))}var L=n("WePp"),N=n("XIN1"),P=n("znb3");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function G(e){const t=r.useContext(l.a).EventManager,{items:n,groups:s,theme:o,isRTL:i,searchSessionId:a}=e;if(0===n.length)return null;return r.createElement(v.a,{items:n,onRenderCell:(n,s,c)=>{const l=Object(I.r)(i),u=Object(I.u)(),m="search-item-"+c;return r.createElement(O,{key:m,onItemClick:()=>{e.onItemClick(s);const n=`${S.a}${S.b.clickRecentlyTypedQuery}`,r=[{name:S.b.sessionId,value:a}];t.ReportComponentSuccess(n,r);const o=new L.a("GlobalSearchFlyout.SearchItems.ItemClicked");t.ReportEvent(o)},theme:o,isRTL:i,height:I.k},r.createElement(N.b,{key:"search-item-icon",type:P.a.History,style:l}),r.createElement(f.a,{key:"search-item-text",style:u},s))},groups:s,groupProps:{onRenderHeader:e=>{var t;const n=Object(I.n)(o);return r.createElement(b.a,{style:n},null===(t=e.group)||void 0===t?void 0:t.name)}},styles:Object(I.o)()})}var D=n("ANvc"),A=n("Zvo8"),U=n("bwbe");class Z extends r.Component{render(){const{mostRecentUsedItems:e,entitiesMetadata:t,onSearchItemClick:n,onEntityRecordClick:s,theme:o,isRTL:i,searchSessionId:a}=this.props,{groups:c,items:l}=this._populateMRUGroups(e),{groups:u,items:m}=this._populateSearchItemsGroup(this._getRecentSearchItems());return r.createElement(r.Fragment,null,r.createElement(G,{items:m,groups:u,onItemClick:n,theme:o,isRTL:i,searchSessionId:a}),r.createElement(F,{items:l,groups:c,entitiesMetadata:t,onEntityRecordClick:s,theme:o,isRTL:i,searchSessionId:a}))}_getRecentSearchItems(){const e=Object(A.b)(D.a);return e?e.split(D.c):[]}_populateSearchItemsGroup(e=[]){const t=Array.from(new Set(e)).filter(e=>""!==e.trim()),n=t.length,s=Math.min(n,3);return{groups:[{count:s,key:"Search_Group",name:this.props.recentSearchesDisplayText,startIndex:0}],items:t.slice(0,s)}}_populateMRUGroups(e){const t={groups:new Array,items:new Array},n=e.filter(e=>e.RecordType===R.a.Entity&&e.EntityTypeName!==U.b&&e.EntityTypeName!==U.c).sort((e,t)=>t.LastAccessed.getTime()-e.LastAccessed.getTime());let s=0;const r={},o=Math.min(6,n.length);for(let e=0;e<o;e++){const s=n[e].EntityTypeName;t.groups.find(e=>e.name===s)||t.groups.push({count:0,key:s,name:s,startIndex:0})}for(let e=0;e<o;e++){const t=n[e].EntityTypeName;let s=r[t];s||(s=new Array,r[t]=s),s.push(n[e])}for(let e=0;e<t.groups.length;e++){const n=t.groups[e],o=r[n.name].length;n.count=o,n.startIndex=s,s+=o,t.items.push(...r[n.name])}return t}}var H=n("PMTb");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function $(e){const t=r.useContext(l.a).EventManager,{suggestions:n,entitiesMetadata:s,suggestionsRetrievalPending:o,onShowMoreResults:i,onEntityRecordClick:a,theme:c,isRTL:u,showMoreResultsDisplayText:m,searchSessionId:h}=e,{items:d,groups:p}=function(e){const t=e.reduce((e,t,n)=>{const s=t.suggestionInfo.entityName;return e.has(s)?e.get(s).count+=1:e.set(s,{key:s,name:s,startIndex:n,count:1}),e},new Map);return{groups:Array.from(t.values()),items:e}}(n),g=!(o&&0===n.length)&&n.every(e=>s.has(e.suggestionInfo.entityName));return r.createElement(M,{isDataLoaded:g},r.createElement(v.a,{items:d,onRenderCell:(e,n,o)=>{var i;const l=Object(I.p)(c,u),m=Object(I.A)(),{entityName:d,objectId:p,entityImageUrl:g,crmHitText:y}=n.suggestionInfo,E=y.replace(new RegExp("{crmhit}(.*?){/crmhit}","gm"),""),b=null===(i=s.get(d))||void 0===i?void 0:i.PrimaryNameAttribute,R=n.record[b]||E,v="suggestion-item-"+o;return r.createElement(O,{key:v,onItemClick:()=>{a(d,p);const e=`${S.a}${S.b.clickSuggestionRecord}`,n=[{name:S.b.sessionId,value:h},{name:S.b.entityName,value:d},{name:S.b.recordId,value:p.guid}];t.ReportComponentSuccess(e,n)},theme:c,isRTL:u},r.createElement(w.a,{key:"suggestion-item-image",src:g,alt:R,style:l,hasPrimaryImageField:!0,entityPrimaryField:R}),r.createElement(H.a,{key:"suggestion-item-text",style:m},function(e,t,n){const s=Object(I.u)(!1),o=[],i=new RegExp("{crmhit}(.*?){/crmhit}","gm").exec(t),a=i&&i.length>0?i[1]:"";if(!a)return o.push(r.createElement(H.a,{key:"only",style:s},e)),o;const c=(u=a,u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),l=new RegExp(`(${c}).*?`,"gm");var u;let m=0;for(;m<e.length;){const t=l.exec(e);if(!t){o.push(r.createElement(H.a,{key:o.length,style:s},e.substr(m)));break}let i=e.substr(m,t.index-m);o.push(r.createElement(H.a,{key:o.length,style:s},i)),i=t[0],o.push(r.createElement(H.a,{key:o.length,style:n},i)),m=l.lastIndex}return o}(R,y,Object(I.z)(c))))},groups:p,groupProps:{onRenderHeader:e=>{var t,n,o;const i=Object(I.n)(c),a=(null===(n=s.get(null===(t=e.group)||void 0===t?void 0:t.name))||void 0===n?void 0:n.DisplayCollectionName)||(null===(o=e.group)||void 0===o?void 0:o.name);return r.createElement(b.a,{style:i},a)}},styles:Object(I.o)()}),r.createElement(k.a,{style:Object(I.y)(c,g),onClick:()=>{i();const e=new L.a("GlobalSearchFlyout.Suggestions.ShowMoreResultsClicked");t.ReportEvent(e)}},r.createElement(f.a,{style:Object(I.x)(c)},m)))}var B=n("8fsw"),Q=n("ORLm"),K=n("cfbi"),q=n("iZ7K");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const X=["GlobalSearch.ZeroQuery.RecentSearches","GlobalSearch.Suggestions.ShowMoreResults"];var z=n("3rse"),J=n("zmaG"),Y=n.n(J),W=n("pEXn");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const V=Object(h.b)("globalSearchFlyout");class ee extends r.Component{constructor(e,t){super(e),this._focusZoneRef=r.createRef(),this._onKeyDownHandler=e=>{e.keyCode===z.a.Escape&&(this.props.dismissFlyout(),e.stopPropagation())},this._onSearchItemClick=e=>{this.props.onSearch(e),this.props.dismissFlyout()},this._onEntityRecordClick=(e,t)=>{this.props.onEntityRecordClick(e,t),this.props.dismissFlyout()},this._onShowMoreSearchResults=()=>{this.props.onShowMoreSearchResults(),this.props.dismissFlyout()},this._onFlyoutOutsideClick=e=>{this._isSearchBoxClick(e)||this.props.dismissFlyout()},te(e)||e.retrieveEntityMetadata(),Object(u.c)(e.resourceStrings,"GlobalSearch.ZeroQuery.RecentSearches")||e.retrieveResourceStrings(),Object(i.a)(this)}componentDidUpdate(){te(this.props)||this.props.retrieveEntityMetadata()}render(){const{theme:e,width:t}=this.props,n=Object(I.m)(e),s=Object(I.l)(e);return r.createElement(a.a,{id:V,key:V,groupId:V,relativeToElementId:this.props.relativeToDomId,relativeToElementIdSelector:this.props.relativeToElementIdSelector,positionType:"relative",size:{width:t},flyoutDirection:this.props.isRTL?a.b.down:a.b.downleft,onOutsideClick:this._onFlyoutOutsideClick,parentFlyoutRoot:D.b,flyoutStyle:n},r.createElement(b.a,{style:s,onKeyDown:this._onKeyDownHandler},r.createElement(o.a,{componentRef:this._focusZoneRef},this._renderFlyoutContent())))}focus(){var e;null===(e=this._focusZoneRef.current)||void 0===e||e.focus()}focusLast(){var e;null===(e=this._focusZoneRef.current)||void 0===e||e.focusLast()}_renderFlyoutContent(){const{suggestions:e,suggestionsRetrievalPending:t,entitiesMetadata:n,theme:s,isRTL:o,mostRecentUsedItems:i,resourceStrings:a,searchSessionId:c}=this.props,l=e.length>0||t,m={};return m[W.b.SearchParameters.SearchSessionId]=c,m[W.b.SearchParameters.UsingSuggestion]=l?"True":"False",Y.a.addKeyPerformanceIndicatorOnIdle("GlobalSearchFlyout",m),l?r.createElement($,{suggestions:e,entitiesMetadata:n,suggestionsRetrievalPending:t,onEntityRecordClick:this._onEntityRecordClick,onShowMoreResults:this._onShowMoreSearchResults,theme:s,isRTL:o,showMoreResultsDisplayText:Object(u.c)(a,"GlobalSearch.Suggestions.ShowMoreResults"),searchSessionId:c}):r.createElement(Z,{mostRecentUsedItems:i,entitiesMetadata:n,onSearchItemClick:this._onSearchItemClick,onEntityRecordClick:this._onEntityRecordClick,theme:s,isRTL:o,recentSearchesDisplayText:Object(u.c)(a,"GlobalSearch.ZeroQuery.RecentSearches"),searchSessionId:c})}_isSearchBoxClick(e){if(e){let t=e.target;do{if(t.classList.contains(this.props.searchBoxRootClassName))return!0;t=t.parentElement}while(t)}return!1}}function te(e){const{suggestions:t,mostRecentUsedItems:n,entitiesMetadata:s}=e;return t.every(e=>s.has(e.suggestionInfo.entityName))&&n.every(e=>s.has(e.EntityTypeName))}ee.contextType=l.a;const ne=Object(c.a)((function(){const e=Object(u.h)();return function(t){const n=Object(Q.b)(t);let s=new Map;const r=n.suggestions,o=Object(y.h)(t);let i=!1;function a(e){const n=Object(q.h)(t,e);n||(i=!0),s.set(e,n)}return r.forEach(e=>a(e.suggestionInfo.entityName)),o.forEach(e=>a(e.EntityTypeName)),i&&(s=new Map),{theme:Object(p.a)(t),isRTL:Object(g.g)(t),mostRecentUsedItems:o,suggestions:r,suggestionsRetrievalPending:n.suggestionsRetrievalPending,entitiesMetadata:s,width:Object(B.a)(t).width,resourceStrings:e(t,X)}}}),(function(e){return{onEntityRecordClick:(t,n)=>{const s={entityTypeName:t,id:n};e(Object(d.a)(K.a,s))},retrieveEntityMetadataInternal:t=>{const n=t.reduce((e,t)=>(e[t]=[],e),{});e(Object(E.e)(n))},retrieveResourceStrings:()=>{e(Object(m.e)(X))}}}),(function(e,t,n){const{retrieveEntityMetadataInternal:r}=t,o=Object(s.__rest)(t,["retrieveEntityMetadataInternal"]);return Object.assign(Object.assign(Object.assign(Object.assign({},n),e),o),{retrieveEntityMetadata:()=>{const t=[];e.suggestions.forEach(e=>t.push(e.suggestionInfo.entityName)),e.mostRecentUsedItems.forEach(e=>t.push(e.EntityTypeName)),r(t)}})}))(ee)}}]),window.bundleExecutionMarkers["scripts/GlobalSearchFlyout.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();