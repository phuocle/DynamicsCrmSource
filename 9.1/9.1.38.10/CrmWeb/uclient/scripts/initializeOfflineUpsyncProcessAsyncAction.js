(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/initializeOfflineUpsyncProcessAsyncAction.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[69],{"6u68":function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return o}));var r=t("/D1P");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */const c="offline.upsync.pending";function o(){const e={upSyncStatus:r.a.Pending};return{type:c,payload:e}}},VKvO:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return o}));var r=t("/D1P");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */const c="offline.upsync.completed";function o(){const e={upSyncStatus:r.a.Completed};return{type:c,payload:e}}},wje5:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return o}));var r=t("/D1P");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */const c="offline.upsync.start";function o(){const e={upSyncStatus:r.a.InProgress};return{type:c,payload:e}}},zmAS:function(e,n,t){"use strict";t.r(n),t.d(n,"OFFLINE_UPSYNC_HANDLE_ACTION",(function(){return E})),t.d(n,"initializeOfflineUpsyncProcessAsyncAction",(function(){return U}));var r=t("6u68"),c=t("TBkx"),o=t("YxC/"),i=t("Nzmy"),s=t("0uKS"),a=t("pgSX"),l=t("tICD"),u=t("EY5k"),f=t("si7p"),p=t("vONk"),y=t("504W");var d=t("wje5"),O=t("VKvO"),_=t("ybGo"),b=t("/D1P"),m=t("umme"),w=t("bvqZ"),j=t("Lyxw"),v=t("3/02"),S=t("xM/W"),g=t("6fj+");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const E="offline.upsync.process.async";let P=null;function U(e=!1){return{type:E,async execute({dispatch:n,getState:t},w){const j=Object(_.b)(t());if(!e&&j===b.a.Completed)return Promise.resolve();if(null!=P)await P;else try{await(P=async function(e,n,t){const _=new Date,b="Offline: Upsync";try{if(await t.OfflineProvider.hasItemsToUpsync().nativePromise()){i.c.info("OFFLINE : OfflineUpsyncHandler : Has Items To Upsync"),n(Object(d.b)());try{const r=await t.OfflineProvider.startPlayback().nativePromise();return n(Object(O.b)()),Object(y.a)(r)||0!==r.get_errorCount()?(i.c.warn("OFFLINE : OfflineUpsyncHandler : Upsync done with conflict"),n((m=String(r.get_lastSuccessfulSaveOnCrm()),{type:"offline.syncerror.dialog.async",execute({dispatch:e,getState:n},t){const r=["L_Show_Details_Text","Sync_Status_Error_Message","L_Last_Save_To_CRM_Server_Text","Sync_Status_Dialog_Title","Dialog_Button_Ok"];return e(Object(u.e)(r)).then(()=>{const t=Object(o.e)(n(),r),u=Object(o.c)(t,"L_Show_Details_Text"),d=Object(o.c)(t,"Sync_Status_Error_Message"),O=Object(o.c)(t,"L_Last_Save_To_CRM_Server_Text"),_=Object(o.c)(t,"Sync_Status_Dialog_Title"),b=Object(o.c)(t,"Dialog_Button_Ok"),w=d+"\n"+O;let j="";return j=Object(y.b)(p.a.get_OverallSyncErrorMessage())?w.replace("{0}",m):p.a.get_OverallSyncErrorMessage(),e(Object(a.a)(f.c,j,{},u,_,"",b)).then(n=>0===n.status?e(Object(l.a)(n.pageId)).then(t=>{t.value.confirmed&&e(Object(s.a)("syncerror",n.pageId,null,null,null,null,null))}):(i.c.error("Offline: Error in Sync error dialog creation "+Object(c.e)(n.error)),Promise.reject(n.error)))}).catch(e=>(i.c.error("Offline: Error in Sync error dialog creation "+Object(c.e)(e)),Promise.reject(e)))}}))):(await T(e,n),i.c.info("OFFLINE : OfflineUpsyncHandler : Upsync done without conflict")),t.EventManager.ReportComponentSuccess(b),void t.EventManager.ReportComponentPerformance(b,"Time Taken in ms",+new Date-+_)}catch(e){return i.c.error("OFFLINE : OfflineUpsyncHandler : Upsync Error"),n(Object(r.b)()),t.EventManager.ReportComponentFailure(b,e),t.EventManager.ReportComponentPerformance(b,"Time Taken in ms",+new Date-+_),Promise.reject(e)}}i.c.info("OFFLINE : OfflineUpsyncHandler : Upsync has no items to sync"),n(Object(O.b)()),await T(e,n)}catch(e){return i.c.error("OFFLINE : OfflineUpsyncHandler : hasItemsToUpsync Handler Failed"),Promise.reject(e)}var m}(t,n,w))}catch(e){if(!(e instanceof m.a)){const n=(null==e?void 0:e.message)||"Unexpected upsync error";e=m.a.FromMessage(n)}throw e}finally{P=null}}}}async function T(e,n){if(Object(j.c)(e(),v.l)&&Object(g.e)(e())){const t=["offline_notification_reconnect_success_text"];await n(Object(u.e)(t));const r={id:"upsync_complete_toast",level:1,message:Object(o.b)(e(),t[0]),title:null,type:1,onCloseHandler:null};n(Object(S.b)(!1)),n(Object(w.b)(r))}}}}]),window.bundleExecutionMarkers["scripts/initializeOfflineUpsyncProcessAsyncAction.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();