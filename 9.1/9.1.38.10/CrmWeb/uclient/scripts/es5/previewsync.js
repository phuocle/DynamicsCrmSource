(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/es5/previewsync.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[26],{"+6eZ":function(t,e,n){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function a(t){var e=null;try{e=JSON.parse(t)}catch(t){}return e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function r(t){var e="";try{e=JSON.stringify(t)}catch(t){}return e}n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}))},"2ojE":function(t,e,n){"use strict";n.d(e,"a",(function(){return p})),n.d(e,"c",(function(){return g})),n.d(e,"b",(function(){return h}));var a=n("VcAV"),r=n("/j9Z"),i=n("yHpA"),o=n("LhJP"),s=n("9r0m"),c=n("TCcM"),u=n("T576"),l=n("sOTk"),d=n("WS0f");function p(t,e,n,a){var r=[];try{var i=e&&Object(c.e)(t,e)?Object(c.e)(t,e):s.a.EMPTY,o=e&&Object(c.f)(t,e)?Object(c.f)(t,e):s.a.EMPTY,d=i&&!s.a.equals(i,s.a.EMPTY)?function(t,e){var n=Object(u.a)(t,e);if(n)return n.businessProcessFlowProcessState;return null}(t,i):0,p=Object(l.l)(t,n),g={name:"ProcessId",value:i?s.a.toString(i):s.a.EMPTYGUIDSTRING},h={name:"ProcessInstanceId",value:o?s.a.toString(o):s.a.EMPTYGUIDSTRING},f={name:"CurrentFormEntityType",value:e&&e.etn?e.etn:""},v={name:"CurrentFormEntityId",value:e&&e.id?s.a.toString(e.id):""},_={name:"ProcessState",value:d},m={name:"PageId",value:n||""},b={name:"PageType",value:p};r.push(g),r.push(h),r.push(f),r.push(v),r.push(_),r.push(m),r.push(b)}catch(t){a.TraceManager.getTracer("BusinessProcessFlow.TelemetryGeneration").error("Exception while generating businessprocess telemetry parameters: "+t.message,r)}return r}function g(t,e,n){n.EventManager.ReportComponentSuccess(t,e)}function h(t,e,n,s,c,u,l){!function(t,e){if(!Object(a.c)(t)){var n=Object(r.c)(t);if(!Object(a.c)(n)){var i=n.errorCode;if(!Object(a.c)(i)){var o={name:"ErrorCode",value:"0x"+i.toString(16)};e.push(o)}}}}(e,s),function(t,e,n,s){if(!Object(a.c)(t)){var c=Object(r.c)(t);if(!Object(a.c)(c)&&!Object(a.c)(c.FaultedSnapshotId)){var u={name:o.p,value:c.FaultedSnapshotId};if(e.push(u),!Object(a.c)(n)&&!Object(a.c)(s)){var l=Object(i.c)(s,n);if(!Object(a.c)(l)){var p=l.snapshotId;if(!Object(a.c)(p)&&!Object(d.b)(p)&&p===c.FaultedSnapshotId){var g={name:o.q,value:"serverSideCurrentForm"};e.push(g)}}}}}}(e,s,u,l),c.EventManager.ReportComponentFailure(t,e,n,s)}},"3INI":function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("90Ov"),r=n("WS0f"),i=function(){function t(t){this.path=t}return Object.defineProperty(t.prototype,"path",{get:function(){return this._traversedPath},set:function(t){for(this._traversedPath=Object(a.a)(t);this._traversedPath&&this._traversedPath.indexOf("}")>0;)this._traversedPath=Object(a.a)(this._traversedPath)},enumerable:!1,configurable:!0}),t.getCandidateTraversedPathFromStagStep=function(t,e){e=Object(a.a)(e);var n=!1;if(!t||t.length)return null;for(var r=0;r<t.length;r++){var i=Object(a.a)(t[r].get_stageId());if("".concat(i,","),e===i){n=!0;break}}return n?"".substring(0,"".length-2):null},t.prototype.isInTraversedPath=function(t){return!Object(r.b)(t)&&this._traversedPath.indexOf(Object(a.a)(t))>-1},t}()},"4HtA":function(t,e,n){"use strict";n.d(e,"a",(function(){return ce}));var a,r=n("c/eZ"),i=n("DRVD"),o=n.n(i),s=n("sOTk"),c=n("r0tX"),u=n("6FBX"),l=n("UGbr"),d=n("UTiY"),p=n("c3W+"),g=n("EGdP"),h=n("/j9Z"),f=n("9r0m"),v=n("T576"),_=n("Y70o");!function(t){t[t.None=0]="None",t[t.Processing=1]="Processing",t[t.Completed=2]="Completed",t[t.Failure=3]="Failure",t[t.Invalid=4]="Invalid"}(a||(a={}));var m=function(){function t(t,e){this._getState=t,this._processId=e}return t.prototype.GenerateMessageForAction=function(t){var e="",n="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources",r=this._getState(),i=Object(_.a)(r,n,"ProcessControl_ActionExecuter_ExecutionTimeTooltip"),o=Object(_.a)(r,n,"ProcessControl_ActionExecuter_ErrorMessageTooltip"),s=Object(_.a)(r,n,"Crm_GenericErrorMessage");switch(t){case a.Completed:e=String.format(i,(new Date).toLocaleString());break;case a.Failure:e=String.format(i,(new Date).toLocaleString())+"\n"+String.format(o,s)}return e},t.prototype.GetActionMetadata=function(t){var e,n=Object(v.a)(this._getState(),new f.a(this._processId.guid));return n&&n.businessProcessFlowActions&&n.businessProcessFlowActions[t]&&(e=n.businessProcessFlowActions[t]),e},t.prototype.InvokeProcessAction=function(t,e,n){return Xrm.Utility.invokeProcessActionInternal(t,n,e)},t}(),b=n("HSdq");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function y(t){if(!t)return null;var e=function(t){var e=[];return t.forEach((function(t){var n={id:f.a.tryParse(t.Id),primaryField:t.PrimaryField,entityTypeCode:t.EntityTypeCode,entityLogicalName:t.EntityLogicalName,primaryKeyName:t.PrimaryKeyName};e.push(n)})),e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */(t.NavigationEntities);return{entityDisplayName:t.EntityDisplayName,entityLogicalName:t.EntityLogicalName,entityTypeCode:t.entityTypeCode,showCreate:t.ShowCreate,navigationEntities:e}}function P(t,e,n,a){return{type:"businessProcessFlow.retrieveNavigationEntities.async",execute:function(r,i){r.dispatch,r.getState;return function(t,e,n,a,r){return t.retrieveNavigationEntities(e,n,a,r,null).nativePromise().then(y,h.b)}(i.DataSource,t,e,n,a)}}}var S=n("mLFd"),I=n("GWjq"),O=n("phfH"),C=function(){function t(t,e){this.Target=t,this.NewProcess=e}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}},t}(),w=function(){function t(t,e,n){this.Target=t,this.NewProcess=e,this.NewProcessInstance=n}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcessInstance:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}},t}(),F=n("RVz9"),j=n("IBKq");function E(t,e,n,a,r,i){return{type:"businessProcessFlow.navigateToNextEntity.async",execute:function(o,s){o.dispatch,o.getState;return function(t,e,n,a,r,i,o){var s=new j.a(f.a.toLegacyGuid(e.id),e.etn,f.a.toLegacyGuid(n.id),n.etn,f.a.toLegacyGuid(a),r,f.a.toLegacyGuid(i),f.a.toLegacyGuid(o));return t.execute(s,null).nativePromise()}(s.DataSource,t,e,n,a,r,i)}}}var N=n("Ia1G"),M=function(){function t(t,e){this.EntityId=t,this.EntityLogicalName=e}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{EntityId:{typeName:"Edm.Guid",structuralProperty:1},EntityLogicalName:{typeName:"Edm.String",structuralProperty:1}},operationName:"RetrieveProcessInstances",operationType:1}},t}();var T=function(){function t(t,e){this.EntityLogicalName=t,this.AppModuleId=e}return t.prototype.getMetadata=function(){return{boundParameter:null,parameterTypes:{EntityLogicalName:{typeName:"Edm.String",structuralProperty:1},AppModuleId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:"RetrieveFilteredProcesses",operationType:1}},t}(),D=n("4tno");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var A,x=function(){function t(t,e,n){this._name=t,this._uniqueName=e,this._workflowId=n}return Object.defineProperty(t.prototype,"workflowId",{get:function(){return this._workflowId},set:function(t){this._workflowId=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueName",{get:function(){return this._uniqueName},set:function(t){this._uniqueName=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),t}(),B=n("9rlF"),R=function(){function t(){}return Object.defineProperty(t.prototype,"activeStageId",{get:function(){return this._activeStageId},set:function(t){this._activeStageId=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"businessProcessInstanceId",{get:function(){return this._businessProcessInstanceId},set:function(t){this._businessProcessInstanceId=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"businessProcessInstanceName",{get:function(){return this._businessProcessInstanceName},set:function(t){this._businessProcessInstanceName=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"businessProcessState",{get:function(){return this._businessProcessState},set:function(t){this._businessProcessState=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"businessProcessStatus",{get:function(){return this._businessProcessStatus},set:function(t){this._businessProcessStatus=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"navigationEntities",{get:function(){return this._navigationEntities},set:function(t){this._navigationEntities=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"traversedPath",{get:function(){return this._traversedPath},set:function(t){this._traversedPath=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bpfDefinitionVersionNumber",{get:function(){return this._bpfDefinitionVersionNumber},set:function(t){this._bpfDefinitionVersionNumber=t},enumerable:!1,configurable:!0}),t}(),k=n("3INI"),L=function(){function t(){}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryField",{get:function(){return this._primaryField},set:function(t){this._primaryField=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"entityTypeCode",{get:function(){return this._entityTypeCode},set:function(t){this._entityTypeCode=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"entityLogicalName",{get:function(){return this._entityLogicalName},set:function(t){this._entityLogicalName=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"primaryKeyName",{get:function(){return this._primaryKeyName},set:function(t){this._primaryKeyName=t},enumerable:!1,configurable:!0}),t}(),V=n("/eCp");!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive"}(A||(A={}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var q,W=function(){function t(t){this._stageManager=t,this._populateTraversedPath()}return t.prototype.getTraversedPath=function(){return this._traversedPath},t.prototype._populateTraversedPath=function(){this._traversedPath=this._stageManager.globalPathAndActiveStage.traversedPath.path},t}(),U=n("7kKV"),H=n("AqA3"),G=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.invalid,a.stageInvalidReason=H.a.invalid,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),z=(function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.crossEntity,a.stageInvalidReason=H.a.crossEntity,Object.setPrototypeOf(a,e.prototype),a}Object(r.__extends)(e,t)}(Error),function(t){function e(n){var a=t.call(this,n)||this;return a.stageInvalidReason=H.a.unreachable,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error)),Y=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.dirtyForm,a.stageInvalidReason=H.a.dirtyForm,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),X=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.end,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),K=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.beginning,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),Q=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.stageGate,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),J=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.invalidProcess,a.stageInvalidReason=H.a.invalidProcess,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),Z=function(t){function e(n){var a=t.call(this,n)||this;return a.navigationStatus=U.a.dirtyForm,a.stageInvalidReason=H.a.dirtyForm,Object.setPrototypeOf(a,e.prototype),a}return Object(r.__extends)(e,t),e}(Error),$=n("QAhb"),tt=n("TVue"),et=n("rQCE"),nt=n("lFQy"),at=n("Jcuz"),rt=n("690X"),it=n("eA/s"),ot=n("jJRu"),st=n("g9bv"),ct=n("r454"),ut=n("OROb"),lt=n("qYad"),dt=n("TCcM"),pt=n("cAHA"),gt=n("Sscr"),ht=n("yHpA"),ft=n("LteD"),vt=n("BFwB"),_t=function(t){function e(e,n,a){var r=t.call(this,"BusinessProcessFlow_"+e)||this;return r.addEventParameter("ProcessId",n),r.addEventParameter("ProcessInstanceId",a),r}return Object(r.__extends)(e,t),e}(vt.a),mt=function(t){function e(e,n){return t.call(this,"Initialized",e,n)||this}return Object(r.__extends)(e,t),e}(_t),bt=function(t){function e(e,n,a){var r=t.call(this,"SetActiveStageEvent",e,n)||this;return r.addEventParameter("ActiveStageId",a),r}return Object(r.__extends)(e,t),e}(_t),yt=function(t){function e(e,n,a){var r=t.call(this,"DisplayStateEvent",e,n)||this;return r.addEventParameter("CurrentDisplayState",a),r}return Object(r.__extends)(e,t),e}(_t),Pt=function(t){function e(e,n,a,r){var i=t.call(this,"StatusEvent",e,n)||this;return i.addEventParameter("ProcessStatus",a),i.addEventParameter("CurrentDisplayState",r),i}return Object(r.__extends)(e,t),e}(_t),St=n("txwV"),It=n("WS0f"),Ot=function(){function t(){}return t.prototype.getMetadata=function(){return{boundParameter:"entity",operationName:"ExecuteWorkflow",operationType:0,parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.workflow",structuralProperty:5},EntityId:{typeName:"Edm.Guid",structuralProperty:1},InputArguments:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}}}},t}(),Ct=function(){function t(){}return t.prototype.getMetadata=function(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Type:{typeName:"Edm.String",structuralProperty:1},Value:{typeName:"Edm.String",structuralProperty:1}}}},t}(),wt=function(){function t(){}return t.prototype.getMetadata=function(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Count:{typeName:"Edm.Int32",structuralProperty:1},IsReadOnly:{typeName:"Edm.Boolean",structuralProperty:1},Keys:{typeName:"Edm.String",structuralProperty:4},Values:{typeName:"mscrm.AnyComplexType",structuralProperty:4}}}},t}(),Ft=function(){function t(){}return t.prototype.getMetadata=function(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Arguments:{typeName:"Microsoft.Dynamics.CRM.InputArgument",structuralProperty:2}}}},t}(),jt=n("K1ho"),Et=n("ObKm"),Nt=n("uwKl"),Mt=n("ed60");!function(t){t[t.ProcessAction=0]="ProcessAction",t[t.TaskFlow=1]="TaskFlow",t[t.SyncWorkflow=2]="SyncWorkflow",t[t.AsyncWorkflow=3]="AsyncWorkflow",t[t.MessageAction=4]="MessageAction"}(q||(q={}));var Tt=n("2ojE"),Dt=n("LhJP"),At=n("lMVv"),xt=n("GHPx"),Bt=n("h82J"),Rt=n("VcAV"),kt=function(){function t(t,e){this._getState=t,this._applicationContext=e}return t.prototype.setBpfInstance=function(t){return this._processInstance=t,this},t.prototype.setBpfInstanceName=function(t){return this._processInstanceName=t,this},t.prototype.setProcess=function(t){return this._process=t,this},t.prototype.setProcessId=function(t){return this._processId=t,this},t.prototype.setFormEntity=function(t){return this._formEntity=t,this},t.prototype.GetFlowStepMetadata=function(t,e){var n=e.TraceManager.getTracer("businessProcessFlow.flowStepManager"),a=this._processId&&this._processId.guid||null,r=Object(v.a)(this._getState(),f.a.tryParse(a));if(Object(Rt.c)(r))return n.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined bpfDescriptor: "+r),null;var i=r.businessProcessFlowFlows;if(Object(Rt.c)(i))return n.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined businessProcessFlowFlows: "+i),null;var o=i[t];return Object(Rt.c)(i)?(n.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined flowStepDescriptor: "+o),null):o},t.prototype.openFlowWidget=function(t,e){if(f.a.tryParse(t.flowStepId)===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStepId: "+t.flowStepId);var n=this._populateFlowDialogParams(t,e),a={height:600,width:600};Xrm.Navigation.openDialog("MicrosoftFlowsDialog",a,n)},t.prototype._populateFlowDialogParams=function(e,n){var a=this.GetFlowStepMetadata(e.flowStepId,this._applicationContext);if(Object(Rt.c)(a))throw new Error("BPF Flow Step Failure: null metadata");var r={},i=a.flowId;if(Object(Rt.c)(i))throw new Error("BPF Flow Step Failure: null metadata.flowId");if(!this._processInstance&&!this._processInstance.id){var o=[];o.push(this._processInstance.id.guid);var s=JSON.stringify(o);r.entity_ids=s}r.flow_id=i,r.org_unique_name=Xrm.Utility.getGlobalContext().getOrgUniqueName(),r.bpf_step_id=e.flowStepId;var c=Xrm.Page.data.entity.getEntityName(),u=this._getState().metadata.entities[c].EntitySetName,l=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowDestinationUrl");r.entity_logical_collection_name=u,r.entity_logical_name=c,r.flows_destination_url=l,r.dynamics365_access_token=sessionStorage.getItem("dynamics365AccessToken");var d=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowFirstPartyIntegrationSiteUrl");r.flows_fpi_site_url=d+"&flowsEnableWidgetV2=true",r.flows_authentication_string=this._getLocalizedLabel("SystemCustomization.SystemSettingsDialog.PreviewTab.IsMicrosoftFlowEnabled.AuthenticateButton.Text"),r.flows_enable_widget_v2=!0,t.UpdateEventParameter(n,"flows_destination_url",l),t.UpdateEventParameter(n,"flow_id",i),Object(Rt.c)(e.workflowLogId)||e.workflowLogId===f.a.EMPTY||(r.flows_wflog_id=f.a.toString(e.workflowLogId));var p=this._processInstance&&this._processInstance.id;if(Object(Rt.c)(p)||p===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceId: "+p);r.bpf_instance_id=f.a.toString(p);var g=this._processInstance&&this._processInstance.etn;if(Object(It.b)(g))throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceEntityLogicalName: "+g);r.bpf_instance_entity_name=g;var h=this._processId&&this._processId.guid||null;if(f.a.tryParse(h)===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processId: "+h);r.bpf_definition_id=h,r.bpf_definition_entity_name="workflow";var v=this._process&&this._process.get_Name();if(Object(It.b)(v))throw new Error("BPF Flow Step On-Click Failure: null or undefined bpfDefinitionName: "+v);if(r.bpf_definition_name=v,Object(It.b)(this._processInstanceName))throw new Error("BPF Flow Step On-Click Failure: null or undefined processInstanceName: "+this._processInstanceName);r.bpf_instance_name=this._processInstanceName;var _=e.selectedStage&&e.selectedStage.get_Description();if(Object(It.b)(_))throw new Error("BPF Flow Step On-Click Failure: null or undefined flowStageName: "+_);r.bpf_flowstage_localized_name=_,r.bpf_flowstage_entity_name=c,r.bpf_flowstage_entity_collection_name=u;var m=this._formEntity&&this._formEntity.id;if(Object(Rt.c)(m)||m===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStageRecordId: "+m);r.bpf_flowstage_entity_record_id=f.a.toString(m);var b=f.a.tryParseOrNull(e.activeStage&&e.activeStage.get_Id()||"");if(Object(Rt.c)(b)||b===f.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty activeStageId: "+b);r.bpf_activestage_id=f.a.toString(b);var y=e.activeStage&&e.activeStage.get_Description();if(Object(It.b)(y))throw new Error("BPF Flow Step On-Click Failure: null or undefined activeStageName: "+y);return r.bpf_activestage_localized_name=y,r.bpf_activestageentity_name="processstage",r},t.prototype._getLocalizedLabel=function(t){return Xrm.Utility.getResourceString("Main_system_library",t)},t.getTelemetryParamsForFlowStep=function(t,e,n,a,r){var i=r||[],o={name:"flow_id",value:t},s={name:"environment_id",value:e},c={name:"flows_destination_url",value:n},u={name:"bpf_step_id",value:a};return i.push(o),i.push(s),i.push(c),i.push(u),i},t.UpdateEventParameter=function(t,e,n){t&&0!==t.length&&t.some((function(t){if(t.name===e)return t.value=n,!0}))},t}(),Lt=n("qC0c"),Vt=n("pflg"),qt=n("UWFM"),Wt=n("b1hT"),Ut=n("tvev"),Ht=n("RK8T"),Gt=n("xc1f"),zt=n("yZTI"),Yt=n("UVKb"),Xt=n("j+yI"),Kt=n("OTOS"),Qt=n("uQP8"),Jt=n("lKeh"),Zt=n("IQF2"),$t=n("buKK"),te=n("+D0h"),ee=n("YEEA"),ne=n("2nMH"),ae=o.a.createEvent("Initialize","BusinessProcessFlow.ProcessManager"),re=o.a.createEvent("SetActiveStage","BusinessProcessFlow.ProcessManager"),ie=o.a.createEvent("ValidateRequiredFields","BusinessProcessFlow.ProcessManager"),oe=o.a.createEvent("CreateActiveStageSnapshot","BusinessProcessFlow.ProcessManager"),se=o.a.createEvent("SaveFormAndActiveStage","BusinessProcessFlow.ProcessManager"),ce=function(){function t(t,e,n,a,r){this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isUserSelectedStage=!1,this._isBpfFormValid=null,this._applicationContext=t,this._getState=e,this._dispatch=n,this._stageMetadata=a,this._activeStageManager=r}return t.prototype.initilaizeWithProcessAndFormEntity=function(t,e,n,a,r,i){var o=this,s=ae.startStopwatch({processId:f.a.toString(a),processInstanceId:f.a.toString(r.id)});this._currentPageId=i,this._processId=a,this._version=e.businessProcessFlowProcessVersion,this._currentFormEntity=n,this._currentBpfInstance=r,this._stageMetadata.setPrimaryModel(this._currentFormEntity.etn),this._stageMetadata.setObjectModel(e);var c=this._createGlobalNavigationData(t);this._activeStageManager.InitGlobalPathAndActiveStage(c),this._stageMetadata.initializeDefaultPathManager(new W(this._activeStageManager),this),this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null;var u={};if(this._isUserSelectedStage)u.selectedStageId=f.a.tryParseOrNull(this.getSelectedStageId());else{var l=this.getActiveStageId();this._isActiveStageInCurrentEntity(l)?u.selectedStageId=f.a.tryParseOrNull(l):u.selectedStageId=this._getDefaultSelectedStageId()||f.a.tryParseOrNull(l)}this._dispatch(Object(nt.a)(u,this._currentBpfInstance));var d=new mt(f.a.toString(a),f.a.toString(r.id));this._applicationContext.EventManager.ReportEvent(d),this._savedPageId!==i&&(this._savedPageId=i,this.getScriptContainerPromise().then((function(t){t&&t.getEventManager().addOnProcessChangeEvent(o.getContextToken(),(function(){o._saveCrossEntityBpf()}))}))),Object(Wt.f)(this._getState())||this._updateProcessInstanceModifiedTime(),this._actionStepManager=new m(this._getState,a),this._flowStepManager=new kt(this._getState,this._applicationContext).setBpfInstance(this._currentBpfInstance).setProcess(this.getProcess()).setProcessId(this.getProcessId()).setFormEntity(this._currentFormEntity).setBpfInstanceName(this.getProcessInstanceName()),this._instanceModifiedTimestamp=Object(v.f)(this._getState(),this._currentFormEntity),this._instanceModifiedTimestamp||(this._instanceModifiedTimestamp=(new Date).getTime()),Object(Wt.f)(this._getState())&&qt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);var p=this.getTelemetryParams();this._currentFormEntity||this._applicationContext.TraceManager.getTracer(Dt.g).error("ProcessManager is initialized with current entity as null",p);Object(Tt.c)(Dt.g,p,this._applicationContext),s()},t.prototype._saveCrossEntityBpf=function(){var t=this._getState(),e=Object(s.g)(t,this._currentPageId),n=Object(Vt.a)(e),a=Object(Vt.b)(e);if(n&&a){var r=new $.a(e.data.parentrecordtype,new f.a(e.data.parentrecordid)),i=new $.a(e.entityTypeName,e.id);this._dispatch(Object(Nt.b)(n,i)),this._dispatch(Object(Mt.b)(a,i)),this.navigateToNextEntityForCrossEntityBpf(r,i,n,a)}},t.prototype.initilaizeWithFormEntityOnly=function(t,e){this._currentPageId=e,this._currentFormEntity=t,this._processId=null,this._version=-1,this._currentBpfInstance=null,this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null,Object(Wt.f)(this._getState())||this._updateProcessInstanceModifiedTime(),Object(Wt.f)(this._getState())&&qt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);var n=this.getTelemetryParams();this._currentFormEntity||this._applicationContext.TraceManager.getTracer(Dt.f).error("ProcessManager is initialized with current entity as null",n);Object(Tt.c)(Dt.f,n,this._applicationContext)},t.prototype.setActiveProcess=function(t){var e=this;return new Promise((function(n,a){var r=e.getTelemetryParams();if(!e.getCurrentFormEntity()){var i=new h.a("Current form entity is not initialized.",2147877745);return Object(Tt.b)(Dt.m,i,null,r,e._applicationContext,null,e._getState()),void a(new h.a("Current form entity is not initialized",2147877745))}var o=f.a.tryParseOrNull(t);if(!o)return Object(Tt.c)(Dt.m,r,e._applicationContext),void a(new Error("Invalid process id"));if(f.a.isNullOrEmpty(e.getCurrentFormEntity().id))return Object(Tt.c)(Dt.m,r,e._applicationContext),void a(new h.a("Not supported on new records",2147877748));var s=new C({id:f.a.toString(e.getCurrentFormEntity().id),entityType:e.getCurrentFormEntity().etn},{id:f.a.toString(o),entityType:u.fc});e._dispatch(Object(F.b)(s)).then((function(){e._executePostEvent("runOnProcessChange","setActiveProcess"),Object(Tt.c)(Dt.m,r,e._applicationContext),n()}),(function(t){e._dispatch(Object(d.b)(t,!0)).then((function(){return a(t)})),Object(Tt.b)(Dt.m,t,null,r,e._applicationContext,null,e._getState())}))}))},t.prototype.setActiveProcessInstance=function(t){var e=this;return new Promise((function(n,a){var r=e.getTelemetryParams();if(!e.getCurrentFormEntity()){var i=new h.a("Current form entity is not initialized.",2147877745);return Object(Tt.b)(Dt.n,i,null,r,e._applicationContext,null,e._getState()),void a(new h.a("Current form entity is not initialized",2147877745))}var o=f.a.tryParseOrNull(t);o?e.getProcessInstances().then((function(t){if(t&&t.value){for(var r="",i=0,s=t.value;i<s.length;i++){var c=s[i];if(c&&c.businessprocessflowinstanceid&&c.businessprocessflowinstanceid.toLowerCase()===f.a.toString(o).toLowerCase()){r=c["a_processid_value".substring(1)];break}}if(Object(It.b)(r))a(new h.a("Supplied process instance does not match any existing instance on this entity",2147877744));else{var l=f.a.tryParseOrNull(r);if(l){var p=new w({id:f.a.toString(e.getCurrentFormEntity().id),entityType:e.getCurrentFormEntity().etn},{id:f.a.toString(l),entityType:u.fc},{id:f.a.toString(o),entityType:u.fc});e._dispatch(Object(F.b)(p)).then((function(){e._executePostEvent("runOnProcessChange","setActiveProcessInstance"),n(r)}),(function(t){e._dispatch(Object(d.b)(t,!0)).then((function(){return a(t)}))}))}else a(new Error("Invalid process id"))}}else a(new Error("No process instances found for current entity"))}),(function(t){e._dispatch(Object(d.b)(t,!0)).then((function(){return a(t)}))})):a(new Error("Invalid process instance id"))}))},t.prototype.setCurrentInstance=function(t){this._currentBpfInstance=t},t.prototype.setStatus=function(t){var e=this;return new Promise((function(n,a){var r;if(t||a(new Error("setStatus can only be called with a valid status (active, finished, aborted")),t===V.a.Active)r=e.reactivateProcess();else if(t===V.a.Finished)r=e.completeProcess();else{if(t!==V.a.Aborted)return a(new Error("Invalid status passed to setStatus"));r=e.abandonProcess()}r.then((function(){var a=new Pt(f.a.toString(e._processId),f.a.toString(e.getProcessInstanceId()),t,e.getDisplayState());e._applicationContext.EventManager.ReportEvent(a),n()}),(function(t){a(t)}))}))},t.prototype.setVisible=function(t){if(!(Object(It.a)(this._currentBpfInstance)||Object(It.a)(this._currentFormEntity)||Object(It.a)(this._currentFormEntity.etn))){var e=Object(gt.h)(this._currentFormEntity.etn);this._dispatch(Object(ft.b)(this._currentPageId,St.a,e,!0===t)),this._updateProcessInstanceModifiedTime()}},t.prototype.isVisible=function(){if(!this._currentBpfInstance)return!1;var t=Object(gt.h)(this._currentFormEntity.etn);return!0===Object(b.G)(this._getState(),{id:this._currentPageId,controlName:St.a},t)},t.prototype.getCurrentFormEntity=function(){return this._currentFormEntity},t.prototype.getActiveStageEntityRef=function(){var t=this._getStage(this.getActiveStageId()),e=t&&t.get_parent()&&t.get_parent().get_Name()||null,n=this._getNavigationEntityIdsByEntityLogicalName();return e&&n&&n.hasOwnProperty(e)?new $.a(e,n[e]):null},t.prototype.getProcess=function(){return this._currentBpfInstance&&this._stageMetadata.getProcessObjectModel()},t.prototype.getProcessInstanceName=function(){return this._currentBpfInstance&&Object(I.e)(this._getState(),this._currentBpfInstance)},t.prototype.getTraversedPath=function(){return Object(I.h)(this._getState(),this._currentBpfInstance)},t.prototype.getProcessId=function(){return this._processId},t.prototype.getVersion=function(){return this._version},t.prototype.getProcessInstanceId=function(){return this._currentBpfInstance&&this._currentBpfInstance.id},t.prototype.getBpfEntityLogicalName=function(){return this._currentBpfInstance&&this._currentBpfInstance.etn},t.prototype.getEntityStages=function(){return this._stageMetadata.getEntityStages()},t.prototype.getActiveStage=function(){return this._getStage(this.getActiveStageId())},t.prototype.getProcessInstances=function(){var t=this;return new Promise((function(e,n){var a,r;t._dispatch((a=t._currentFormEntity.id,r=t._currentFormEntity.etn,{type:"businessProcessFlow.retrieveProcessInstancesRequest.async",execute:function(t,e){t.dispatch;var n=t.getState,i=e.DataSource.get_WebAPIService(),o=new M(a,r),s=Object(N.a)(n(),o);return i.sendRequest(s).then((function(t){return t.json()}),h.b)}})).then((function(t){e(t)}),(function(t){n(t)}))}))},t.prototype.getSelectedStage=function(){return this._getStage(this.getSelectedStageId())},t.prototype.isCrossEntityNavigation=function(t){var e=t?this._stageMetadata.getNextStageId(this.getActiveStageId()):this._stageMetadata.getPreviousStageId(this.getActiveStageId());if(!e)return!1;var n=this._stageMetadata.getStage(e);if(!n)return!1;var a=n.get_parent();return this._currentFormEntity&&this._currentFormEntity.etn&&a&&a.get_EntityLogicalName()!==this._currentFormEntity.etn},t.prototype._isStageOnPath=function(t,e){for(var n=0,a=e;n<a.length;n++){var r=a[n];if(f.a.equals(r,t))return!0}return!1},t.prototype.getProcessState=function(){var t=Object(v.a)(this._getState(),this.getProcessId());return t?t.businessProcessFlowProcessState:null},t.prototype.getState=function(){if(this._currentBpfInstance){var t=Object(I.f)(this._getState(),this._currentBpfInstance);if(t){var e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null},t.prototype.getStatusName=function(){if(this._currentBpfInstance){var t=Object(I.g)(this._getState(),this._currentBpfInstance);if(t)return t.label}return null},t.prototype.getStatus=function(){if(this._currentBpfInstance){var t=Object(I.g)(this._getState(),this._currentBpfInstance);if(t){var e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null},t.prototype.getActiveStageId=function(){if(this._currentBpfInstance){var t=this._currentBpfInstance&&Object(I.a)(this._getState(),this._currentBpfInstance);if(f.a.isNullOrEmpty(t)&&this._currentBpfInstance&&this._activeStageManager&&this._activeStageManager.globalPathAndActiveStage){var e=this._activeStageManager.globalPathAndActiveStage.stageId;e&&(t=f.a.tryParseOrNull(e))}if(!f.a.isNullOrEmpty(t)){var n=this.getActivePath();if(n&&n.length>0)return this._isStageOnPath(t,n)?t.guid:n[0].guid}}return null},t.prototype.getActivePathStages=function(){var t=this.getActivePath();if(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=this._getStage(t[n].guid);return e}return null},t.prototype.getActivePath=function(){if(!this._currentBpfInstance)return null;var t=Object(O.c)(this._getState(),this.getProcessInstanceId());return t||(t=this._getDefaultActivePath()),t},t.prototype.getDisplayState=function(){return this._currentBpfInstance?Object(O.d)(this._getState())||c.a.getDefaultDisplayState():null},t.prototype.getSelectedStageId=function(){if(!this._currentBpfInstance)return null;var t=Object(O.g)(this._getState(),this.getProcessInstanceId());return t?t.guid:this.getActiveStageId()},t.prototype._getDefaultSelectedStageId=function(){if(!this._currentBpfInstance)return null;var t=Object(O.g)(this._getState(),f.a.EMPTY);return t&&!this._stageMetadata.getStage(t.guid)?null:t},t.prototype._isActiveStageInCurrentEntity=function(t){try{return this._stageMetadata.getStage(t).get_parent().get_Name()===this._currentFormEntity.etn}catch(t){this._applicationContext.EventManager.ReportComponentFailure("ProcessManager._isActiveStageInCurrentEntity",t)}return!0},t.prototype.getStageMetadata=function(){return this._stageMetadata},t.prototype.isBusinessProcessAborted=function(){return this.getStatus()===V.a.Aborted},t.prototype.isBusinessProcessCompleted=function(){return this.getStatus()===V.a.Finished},t.prototype.moveToNextStage=function(){var t=this,e=this.getTelemetryParams(),n=new Promise((function(e,n){if(Object(It.a)(t._currentBpfInstance))return n(new h.a("Process Control does not exist on form.",2147877746));var a=t._stageMetadata.getNextStageId(t.getActiveStageId());if(a){e(t._saveMainFormIfImmersiveBpfAndNewRecord().then((function(){return t._saveFormDataAndActiveStage(f.a.tryParseOrNull(a),0,"MoveToNextStage")})))}else n(new X("Last stage in the active path reached. Next stage does not exist."))}));return n.then((function(){Object(Tt.c)(Dt.h,e,t._applicationContext)}),(function(n){t._shouldReportErrorAsSuccess(n)?Object(Tt.c)(Dt.h,e,t._applicationContext):Object(Tt.b)(Dt.h,n,null,e,t._applicationContext,t.getCurrentFormEntity(),t._getState())})),n},t.prototype.moveToPreviousStage=function(){var t=this,e=this.getTelemetryParams(),n=new Promise((function(e,n){if(Object(It.a)(t._currentBpfInstance))return n(new h.a("Process Control does not exist on form.",2147877746));var a=t._stageMetadata.getPreviousStageId(t.getActiveStageId());if(!a)return n(new K("The first stage in the traversed path reached. Previous stage does not exist."));e(t._saveFormDataAndActiveStage(f.a.tryParseOrNull(a),1,"MoveToPreviousStage"))})).then((function(){t._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(t.getActiveStageId())}));return n.then((function(){Object(Tt.c)(Dt.i,e,t._applicationContext)}),(function(n){t._shouldReportErrorAsSuccess(n)?Object(Tt.c)(Dt.i,e,t._applicationContext):Object(Tt.b)(Dt.i,n,null,e,t._applicationContext,t.getCurrentFormEntity(),t._getState())})),n},t.prototype.setActiveStage=function(t){var e=this,n=re.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId()),stageId:t}),a=this.getTelemetryParams(),r=new Promise((function(n,a){var r=f.a.tryParseOrNull(t),i=e.getTraversedPath();if(Object(It.a)(e._currentBpfInstance))return a(new h.a("Process Control does not exist on form.",2147877746));if(!r)return a(new G("setActiveStage can only be called with a valid stage id"));if(!e._stageMetadata.getStage(r.guid))return a(new G("stage id does not exist on any path of the instance"));if(!i)return a(new G("Traversed Path is not present"));if(e.getActiveStageId()===r.guid)return n();var o=new k.a(i);if(!o||!o.isInTraversedPath(t))return a(e.getActivePath().some((function(t){return f.a.equals(t,r)}))?new G("The stage is not in traversed path. Only navigating backwards is supported."):new z("stage id does not exist on the current acitve path of the instance."));n(e._saveFormDataAndActiveStage(r,1,"SetActiveStage"))})).then((function(){var n=new bt(f.a.toString(e._processId),f.a.toString(e.getProcessInstanceId()),t);e._applicationContext.EventManager.ReportEvent(n),e._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(t)}));return r.then((function(){n(),Object(Tt.c)(Dt.o,a,e._applicationContext)}),(function(t){n(),e._shouldReportErrorAsSuccess(t)?Object(Tt.c)(Dt.o,a,e._applicationContext):Object(Tt.b)(Dt.o,t,null,a,e._applicationContext,e.getCurrentFormEntity(),e._getState())})),r},t.prototype.switchProcess=function(){},t.prototype.abandonProcess=function(){var t=this,e=this.getTelemetryParams(),n=new Promise((function(e,n){return Object(It.a)(t._currentBpfInstance)?n(new h.a("Process Control does not exist on form.",2147877746)):t.isBusinessProcessAborted()?e():void e(t._updateStateAndStatusOfProcess(V.a.Aborted,A.Inactive,"AbandonProcess"))}));return n.then((function(){Object(Tt.c)(Dt.a,e,t._applicationContext)}),(function(n){t._shouldReportErrorAsSuccess(n)?Object(Tt.c)(Dt.a,e,t._applicationContext):Object(Tt.b)(Dt.a,n,null,e,t._applicationContext,t.getCurrentFormEntity(),t._getState())})),n},t.prototype.reactivateProcess=function(){var t=this,e=this.getTelemetryParams(),n=new Promise((function(e,n){return Object(It.a)(t._currentBpfInstance)?n(new h.a("Process Control does not exist on form.",2147877746)):t.getStatus()===V.a.Active?e():void e(t._updateStateAndStatusOfProcess(V.a.Active,A.Active,"ReactivateProcess"))}));return n.then((function(){Object(Tt.c)(Dt.j,e,t._applicationContext)}),(function(n){t._shouldReportErrorAsSuccess(n)?Object(Tt.c)(Dt.j,e,t._applicationContext):Object(Tt.b)(Dt.j,n,null,e,t._applicationContext,t.getCurrentFormEntity(),t._getState())})),n},t.prototype.completeProcess=function(){var t=this,e=this.getTelemetryParams(),n=new Promise((function(e,n){return Object(It.a)(t._currentBpfInstance)?n(new h.a("Process Control does not exist on form.",2147877746)):t.isBusinessProcessCompleted()?e():f.a.tryParseOrNull(t._stageMetadata.getNextStageId(t.getActiveStageId()))?n(new h.a("Attempt to finish a process not on last stage.",2148081666)):void e(t._saveMainFormIfImmersiveBpfAndNewRecord().then((function(){return t._updateStateAndStatusOfProcess(V.a.Finished,A.Inactive,"CompleteProcess")})))}));return n.then((function(){Object(Tt.c)(Dt.c,e,t._applicationContext)}),(function(n){t._shouldReportErrorAsSuccess(n)?Object(Tt.c)(Dt.c,e,t._applicationContext):Object(Tt.b)(Dt.c,n,null,e,t._applicationContext,t.getCurrentFormEntity(),t._getState())})),n},t.prototype._shouldReportErrorAsSuccess=function(t){return t instanceof J||(t instanceof Q||(t instanceof X||(t instanceof K||(t instanceof G||(t instanceof z||t instanceof Z)))))},t.prototype.triggerActionStepClick=function(t){var e=this;if(Object(It.b)(t)){var n=new Error("BPF Action Step Failure: null ControlId");throw Object(Tt.b)(Dt.b,n,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),n}var a=this._actionStepManager.GetActionMetadata(t);if(Object(It.a)(a)){n=new Error("BPF Action Step Failure: null metadata");throw Object(Tt.b)(Dt.b,n,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),n}var r=this._getState();if(Object(It.a)(r)){n=new Error("BPF Action Step Failure: null state");throw Object(Tt.b)(Dt.b,n,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),n}var i=this._getTelemetryParamsForActionStep(a.actionType,t,a.actionId);try{var o=new f.a(a.actionId);if(a.actionType===q.AsyncWorkflow||a.actionType===q.SyncWorkflow){var s=[this._processId.guid,f.a.toString(this.getProcessInstanceId()),o.guid].map((function(t){var e=new Ct;return e.Type="System.String",e.Value=t,e})),c=new wt;c.Keys=["BusinessProcessFlowId","BusinessProcessFlowInstanceId","ActionStepId"],c.Values=s,c.Count=3,c.IsReadOnly=!0;var u=new Ft;u.Arguments=c;var l=new Ot;l.EntityId=this._currentFormEntity.id,l.InputArguments=u,l.entity={id:a.workflowId,entityType:"workflow"},this.UpdateActionLog(o,1),this._dispatch(Object(F.b)(l)).then((function(){Object(jt.a)(e._currentPageId,e.getContextToken(),t),e.UpdateActionLog(o,2,e._actionStepManager.GenerateMessageForAction(2)),Object(Tt.c)(Dt.b,i,e._applicationContext)}),(function(n){Object(jt.a)(e._currentPageId,e.getContextToken(),t),e.UpdateActionLog(o,3,e._actionStepManager.GenerateMessageForAction(3)),Object(Tt.b)(Dt.b,n,null,i,e._applicationContext,e.getCurrentFormEntity(),e._getState()),e._dispatch(Object(d.b)(n,!0)).then()}))}else if(a.actionType===q.ProcessAction){var p=function(n){Object(jt.a)(e._currentPageId,e.getContextToken(),t),e.UpdateActionLog(o,3,e._actionStepManager.GenerateMessageForAction(3)),Object(Tt.b)(Dt.b,n,null,i,e._applicationContext,e.getCurrentFormEntity(),e._getState()),e._dispatch(Object(d.b)(n,!0)).then()},g=function(n){Object(jt.a)(e._currentPageId,e.getContextToken(),t),e.UpdateActionLog(o,2,e._actionStepManager.GenerateMessageForAction(2));var r=n.get_outputParameters();a.outputBindings.forEach((function(t){if(t.parameterName in r){var n=r[t.parameterName],a=t.boundAttributeName,i={};i[a]={key:a,value:n},e._dispatch(Object(Et.a)(e._currentPageId,i,!1,!0,e._currentFormEntity.etn,e._currentFormEntity.id.guid,null,e.getContextToken()))}})),Object(Tt.c)(Dt.b,i,e._applicationContext)},h={};a.inputBindings.forEach((function(t){var n=Object(B.c)(Object(dt.j)(e._getState(),e.getCurrentFormEntity(),t.boundAttributeName));h["ProcessUnification_Arguments_"+t.parameterName]=n})),this._addInputParametersToParamList(a.inputParameters,h),this.UpdateActionLog(o,1),Xrm.Navigation.openDialog(a.workflowId,this._getDialogOptions(),h).then((function(n){if(n=n?n.parameters:{},e._filterInputArguments(n)){var r={id:f.a.toString(e.getCurrentFormEntity().id),entityType:e.getCurrentFormEntity().etn};n.Target=r,n.BusinessProcessFlowId=e._processId.guid,n.BusinessProcessFlowInstanceId=f.a.toString(e.getProcessInstanceId()),n.ActionStepId=a.actionId,e._actionStepManager.InvokeProcessAction(a.uniqueName,a,n).then(g,p)}else Object(jt.a)(e._currentPageId,e.getContextToken(),t),e.UpdateActionLog(o,3,e._actionStepManager.GenerateMessageForAction(3))}),p)}}catch(t){throw 0===i.length&&(i=this.getTelemetryParams()),Object(Tt.b)(Dt.b,t,null,i,this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}},t.prototype.triggerFlowStepClick=function(t,e){e=e;var n=kt.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams());try{var a=f.a.newGuid(),r={activeStage:this.getActiveStage(),selectedStage:this.getSelectedStage(),flowStepId:t,workflowLogId:a};this._flowStepManager.openFlowWidget(r,n),this.UpdateActionLog(new f.a(t),1,void 0,a);var i=this.getActionLog(new f.a(t));this.createWorkflowLogRecord(i),Object(Tt.c)(Dt.d,n,this._applicationContext)}catch(t){Object(Tt.b)(Dt.d,t,null,n,this._applicationContext,this.getCurrentFormEntity(),this._getState())}},t.prototype.refreshFlowStepClick=function(t){var e=this,n=kt.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams()),a=this._dispatch(Object(Yt.a)(this._processId,this._currentBpfInstance));Promise.resolve(a).then((function(){e._updateProcessInstanceModifiedTime(),Object(Tt.c)(Dt.k,n,e._applicationContext)})).catch((function(t){Object(Tt.b)(Dt.k,t,null,n,e._applicationContext,e.getCurrentFormEntity(),e._getState())}))},t.prototype._addInputParametersToParamList=function(t,e){for(var n=0,a=Object.keys(t);n<a.length;n++){var r=a[n];"ProcessUnification_Arguments_"+t[r].parameterName in e||(e["ProcessUnification_Arguments_"+t[r].parameterName]=null)}},t.prototype._filterInputArguments=function(t){if(t&&"last_button_clicked"in t&&"ok_id"===t.last_button_clicked){for(var e in t){var n=t[e];if(e.startsWith("ProcessUnification_Arguments_"))t[e.substring("ProcessUnification_Arguments_".length,e.length)]=n;delete t[e]}return!0}return!1},t.prototype._getDialogOptions=function(){return{height:450,width:450,position:1}},t.prototype._createSnapshotRequest=function(t,e){if(!t)throw new Error("Active stage cannot be null or undefined.");var n=new $.a("processstage",t),a=this._calculateNewTraversedPath(t),r={activestageid:{reference:n,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:t.guid}},traversedpath:{value:a,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:""}}};return this._addFieldsToBPFSnapshotForCreate(r,e)},t.prototype._addFieldsToBPFSnapshotForCreate=function(t,e){if(!t||!this._hasBpfInstance())return t;var n=Object(Xt.b)(this._getState(),this._currentFormEntity.etn,this._currentBpfInstance.etn);return n&&(t[n.ReferencingAttribute]={reference:new $.a(this._currentFormEntity.etn,e),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}),t.processid={reference:new $.a("workflow",this.getProcessId()),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}},t},t.prototype.generateBPFInstanceSnapshotId=function(){if(this.isImmersiveBPF()||!Object(Lt.c)(this._getState(),"FCB.SplitBPFEntityAndParticipatingEntityCreates"))return null;var t=[],e=null;try{var n=Object(b.ac)(this._getState(),this._currentPageId,this.getContextToken()),a=Object(ht.b)(this._getState(),n),r=a.identifier&&a.identifier.id||this._currentFormEntity.id,i=Object(s.g)(this._getState(),this._currentPageId);if(Object(Xt.e)(i))return Object(Xt.f)(this._getState(),n,r,this._dispatch),null;if(!this._hasBpfInstance()||f.a.isNullOrEmpty(this.getProcessId()))return null;if(t=this.getTelemetryParams(),Object(Xt.d)(this._getState(),a.identifier,this._currentPageId))return Object(Xt.f)(this._getState(),n,r,this._dispatch),null;f.a.isNullOrEmpty(r)&&(r=f.a.newGuid(),Object(Xt.f)(this._getState(),n,r,this._dispatch)),e=this._createActiveStageSnapshot(f.a.tryParse(this.getActiveStageId()),r);var o=Object(ht.b)(this._getState(),e);t.push({name:"SnapshotId",value:e}),t.push({name:"Snapshot active changes",value:o&&o.activeChanges&&Object.keys(o.activeChanges).map((function(t){return"Property: "+t})).join("; ")}),this._applicationContext.EventManager.ReportComponentSuccess("ProcessManager.generateBPFInstanceSnapshotId",t)}catch(e){this._applicationContext.EventManager.ReportComponentFailure("ProcessManager.generateBPFInstanceSnapshotId",e,null,t)}return e},t.prototype._calculateNewTraversedPath=function(t){for(var e="",n=0,a=this.getActivePath();n<a.length;n++){var r=a[n];if(e+=","+r.guid,f.a.equals(r,t))return e.substring(1)}return(e+=","+t.guid).substring(1)},t.prototype._createActiveStageSnapshot=function(t,e){var n=this._createSnapshotRequest(t,e),a=oe.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())}),r=Object(ht.c)(this._getState(),this.getCurrentFormEntity());if(this.isImmersiveBPF()&&!Object(It.a)(r)){var i=Object(st.b)(this._getState(),r.snapshotId,n);return this._dispatch(i),r=Object(ht.c)(this._getState(),this.getCurrentFormEntity()),a(),r.snapshotId}var o=Object(gt.h)(this._currentFormEntity.etn),s=Object(gt.x)(o),c=Object(ot.b)(this._getState(),this._currentBpfInstance,n,s,this._hasBpfInstance()?pt.a.Create:pt.a.Update),u=c.payload.snapshotId;return this._dispatch(c),a(),u},t.prototype._hasBpfInstance=function(){return!this._currentBpfInstance||f.a.isNullOrEmpty(this._currentBpfInstance.id)},t.prototype._updateStateAndStatusOfProcess=function(t,e,n){var a=this;return new Promise((function(r,i){var o=a._createStatusAndStateUpdateRequest(t,e),s=Object(ht.c)(a._getState(),a.getCurrentFormEntity()),c=null;if(a.isImmersiveBPF()&&!Object(It.a)(s)){var u=Object(st.b)(a._getState(),s.snapshotId,o);a._dispatch(u),s=Object(ht.c)(a._getState(),a.getCurrentFormEntity())}else{var l=Object(gt.h)(a.getCurrentFormEntity().etn),p=Object(gt.x)(l),g=Object(ot.b)(a._getState(),a._currentBpfInstance,o,p);c=g.payload.snapshotId,a._dispatch(g)}if(!a.executePreEvent("runOnPreProcessStatusChange",n,null,t))if(a._shouldPerformFormSave()){var f=a._validateSnapshot(s).then((function(){return a._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(n)})).then((function(){return a._saveFormEntityAndBPFEntitySnapshots(c,s,!1)})).then((function(){a._executePostEvent("runOnProcessStatusChange",n,null,t)})).catch((function(t){var e=Object(h.c)(t);return a._handleDuplicateDetection(e,c)})).catch((function(t){throw a._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t})).catch((function(t){a._dispatch(Object(d.b)(t,!0)).then((function(){return i(t)}))}));r(f)}else a._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(n).then((function(){var e=null;e=a.isImmersiveBPF()&&!Object(It.a)(s)?s.snapshotId:c;a._dispatch(Object(ut.c)(e,!0,["statuscode","statecode","activestagestartedon","completedon"])).then((function(){a._dispatch(Object(lt.a)(a._currentPageId,a.getCurrentFormEntity(),a._getColumnsToRefresh())).then((function(){a._updateProcessInstanceModifiedTime(),a._executePostEvent("runOnProcessStatusChange",n,null,t)})),r()})).catch((function(t){a._dispatch(Object(d.b)(t,!0)).then((function(){return i(t)}))}))}));r()}))},t.prototype._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures=function(t){var e=this;return new Promise((function(n,a){if("CompleteProcess"===t||"MoveToNextStage"===t){var r=e.ValidateRequiredFieldsForNavigation();if(r&&!r.isValid)if("MoveToNextStage"===t)a(new Q("Unable to navigate to next stage as required fields have not been set"));else{if("CompleteProcess"===t)return a(new Q("Unable to complete process as required fields have not been set"));a(new Error("validation failed for unexpected BPF operation: "+t))}}return n()}))},t.prototype._saveFormChangesBeforeNavigation=function(){var t=this;if(this._shouldPerformFormSave()){var e=Object(ht.c)(this._getState(),this.getCurrentFormEntity());return this._validateSnapshot(e).then((function(){return t._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures("MoveToNextStage")})).then((function(){var n=t._getColumnsToRefresh();return t._dispatch(Object(ut.c)(e.snapshotId,!0,n))})).catch((function(n){return t._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(n,e.snapshotId),t._dispatch(Object(d.b)(n,!0))}))}return Promise.resolve()},t.prototype._shouldPerformFormSave=function(){var t=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ShouldPerformFormSave"),e=this.getTelemetryParams(),n=this._getState();if(Object(b.kb)(n,{id:this._currentPageId},this.getContextToken()))return t.info("Skip main form save for BPF state or stage change due to read only form",e),!1;var a=this._dispatch(Object(Bt.b)(this._currentPageId,this.getContextToken()));if(a&&a.data&&a.data.getIsDirty){var r=a.data.getIsDirty(),i={name:"shouldPerformMainFormSave",value:r};return e.push(i),t.info("Checking if main form save should be performed due to dirty form",e),r}return t.error("Unable to determine dirty state of main form - skipping save of main form",e),!1},t.prototype._saveMainFormIfImmersiveBpfAndNewRecord=function(){var t=this,e=Object(s.l)(this._getState(),this._currentPageId);if(this.isImmersiveBPF()&&e===Gt.a&&f.a.isNullOrEmpty(this.getCurrentFormEntity().id)){return this._dispatch(Object(l.f)(this._currentPageId,e,!1,1,!1,!1)).then((function(e){t._currentFormEntity=e}))}return Promise.resolve(void 0)},t.prototype._validateSnapshot=function(t){var e=this;return new Promise((function(n,a){var r=e._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation"),i=e._getSnapshotStateTelemetryParams(t),o=e._currentPageId,s=e.getContextToken(),c=e._dispatch(e._getEventManager().runOnSave(s,1));for(var u in c&&(e._dispatch(Object(p.b)(o,s,2)),e._dispatch(Object(g.b)(o,s,!1)),r.warn("BPF ProcessManager: Unable to save form data due to web resource registered onSave invoking preventDefault",i),a(new h.a("Unable to save form data due to web resource registered onSave invoking preventDefault",2147877737))),t.activeChanges){var l=t.activeChanges[u],d=e._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(t.identifier.etn,u),f=Object(It.a)(d)?null:d.get_logicalName(),v=Object(It.a)(d)?Ut.a.get_empty():d.get_id();if(Object(It.a)(l))return r.error("BPF ProcessManager: unexpected null or undefined fieldValue for attribute "+f+" with ID: "+v,i),a(new Error("Internal Client Error - null fieldValue"));var _=l.validationResult;if(Object(It.a)(_)){if(f===xt.c){r.info("BPF ProcessManager: skipping formEntitySnapshot validation for atttribute: "+f+" with ID: "+v,i);continue}return r.error("BPF ProcessManager: unexpected null or undefined validationResult for atttribute: "+f+" with ID: "+v,i),a(new Error("Internal Client Error - null validatorResult"))}var m=_.isValueValid;if(Object(It.a)(m))return r.error("BPF ProcessManager: unexpected null or undefined validationResult.isValidValue for atttribute: "+f+" with ID: "+v,i),a(new Error("Internal Client Error - null validationResult.isValidValue"));if(!m){var b={name:Dt.q,value:"clientSideCurrentForm"};return i.push(b),r.warn("BPF ProcessManager: unable to save form due to invalid value for attribute: "+f+" with ID: "+v,i),a(new Y("Unable to save form data due to validation errors"))}}return n(!0)}))},t.prototype._createStatusAndStateUpdateRequest=function(t,e){var n;return(n={}).statuscode={label:V.a[t],valueString:t.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}},n.statecode={label:A[e],valueString:e.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}},n},t.prototype.ValidateRequiredFieldsForNavigation=function(){for(var t=ie.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())}),e=this._getState(),n=this._stageMetadata.getRequiredAttributesForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),e),a=this._stageMetadata.getRequiredFlowStepsForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),e),r={emptySteps:[],errorSteps:[]},i=Object(ht.c)(this._getState(),this.getCurrentFormEntity()),o=this._getSnapshotStateTelemetryParams(i),c=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation"),u=0,d=n;u<d.length;u++){var p=d[u];c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: validating attribute: "+p,o);var g=Object(dt.j)(this._getState(),this.getCurrentFormEntity(),p);i&&i.activeChanges&&p in i.activeChanges&&(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: fieldIsDirty: "+p,o),g=i.activeChanges[p]),Object(O.h)(g,this._getState(),this.getCurrentFormEntity().etn,p)?(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: emptyField: "+p,o),r.emptySteps.push(p)):g.validationResult.isValueValid||(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: !fieldValue.validationResult.isValueValid: "+p,o),r.errorSteps.push(p))}for(var h=0,v=a;h<v.length;h++){var _=v[h],m=f.a.tryParse(_);if(f.a.isNullOrEmpty(m))c.error("BPF ProcessManager ValidateRequiredFieldsForNavigation: invalid Flow Step ID GUID: "+_,o);else{var y=this.getActionLog(m);if(y){var P=y.status;2!==P&&(c.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+_+". The Flow Step Action Log has stauts of : "+P,o),r.errorSteps.push(_))}else c.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+_+". No action logs were found for this Flow Step",o),r.errorSteps.push(_)}}r.isValid=0===r.emptySteps.length&&0===r.errorSteps.length;var S=Object(Qt.a)(e,this._currentPageId);if(!Object(b.Gb)(S,e,this._currentPageId,this.getContextToken())){c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: form is not valid - "+this._currentPageId,o);var I=Object(s.l)(this._getState(),this._currentPageId);this._dispatch(Object(l.f)(this._currentPageId,I,!1,1,!1,!1)),r.isValid=!1}if(!r.isValid){var C=String.format("BPF ProcessManager: ValidateRequiredFieldsForNavigation returned invalid");c.warn(C,o)}return t(),r},t.prototype.setSelectedStage=function(t,e){var n=this;return void 0===e&&(e=!1),new Promise((function(a,r){var i=f.a.tryParseOrNull(t);if(!i)return r("setSelectedStage can only be called with a valid stage id");var o={selectedStageId:i};n._updateBusinessProcessFlowData(n._currentBpfInstance,o),n._isUserSelectedStage=e,e&&n._executePostEvent("runOnStageSelected","setSelectedStage"),a()}))},t.prototype.setDisplayState=function(t){if(this._currentBpfInstance&&(t===c.a.collapsed||t===c.a.expanded||t===c.a.floating)){this._updateDisplayState(this._currentBpfInstance,t);var e=new yt(f.a.toString(this._processId),f.a.toString(this.getProcessInstanceId()),t);this._applicationContext.EventManager.ReportEvent(e)}},t.prototype.setActivePath=function(t){if(t&&0!==t.length){for(var e=[],n=0;n<t.length;n++)e[n]=new f.a(t[n]);var a={activePath:e};this._updateBusinessProcessFlowData(this._currentBpfInstance,a)}},t.prototype.setBpfNavigationBehavior=function(t){var e={processNavigationBehavior:{navigationBehavior:t,navigationBehaviorPageId:this._currentPageId}};this._updateBusinessProcessFlowData(this._currentBpfInstance,e)},t.prototype.getBpfNavigationBehavior=function(){return this._currentBpfInstance&&Object(O.e)(this._getState(),this.getProcessInstanceId())},t.prototype.shouldReInitializeNavigationBehavior=function(){return!(!this._currentBpfInstance||!(null==this.getBpfNavigationBehavior()&&Object(It.a)(Object(O.b)(this._getState(),this.getProcessInstanceId()))||Object(O.f)(this._getState(),this.getProcessInstanceId())!==this._currentPageId))},t.prototype.getBpfNavigationBehaviorAllowCreateNew=function(t){var e=this._currentBpfInstance&&Object(O.b)(this._getState(),this.getProcessInstanceId());return!e||!t||e(t)},t.prototype.createWorkflowLogRecord=function(t){var e;if(Object(It.a)(t))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined actionLog");var n=this._getState();if(Object(It.a)(n))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined state");var a=n.metadata;if(Object(It.a)(a))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined metadata");var r=a.entities;if(Object(It.a)(r))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined entities");var i=this._currentBpfInstance.etn;if(Object(It.b)(i))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entityLogicalName");var o=r[i];if(Object(It.a)(o))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined bpfEntity");var s=o.EntitySetName;if(Object(It.b)(s))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entitySetName");var c=Object(At.z)(n,"workflowlog",o.EntityLogicalName,"asyncoperationid");if(Object(It.a)(c))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined relationshipMetadata");if(Object(It.b)(c.ReferencingEntityNavigationPropertyName))throw new Error("BPF Create WorkflowLog Record Failure: null or empty relationshipMetadata.ReferencingEntityNavigationPropertyName");var u=c.ReferencingEntityNavigationPropertyName+"@odata.bind",l="/"+s+"("+t.processInstanceid.guid+")",d=((e={workflowlogid:t.actionLogId.guid,stepname:t.stepId.guid})[u]=l,e.activityname=t.processDefinitionid.guid,e.status=t.status,e);Xrm.WebApi.createRecord("workflowlog",d)},t.prototype._getTracer=function(){return Object(It.a)(this._applicationContext)||Object(It.a)(this._applicationContext.TraceManager)?null:this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManager")},t.prototype._getDefaultActivePath=function(){var t=this._getTracer();if(Object(It.a)(this._stageMetadata))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined _stageMetadata"),null;var e=this._stageMetadata.getDefaultPathManager();if(Object(It.a)(e))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined defaultPathManager"),null;var n=e.getDefaultPath();if(Object(It.a)(n))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined stringPath"),null;var a=[];for(var r in n){var i=f.a.parse(n[r]);a.push(i)}return a},t.prototype._updateBusinessProcessFlowData=function(t,e){t&&(this._dispatch(Object(nt.a)(e,t)),this._updateProcessInstanceModifiedTime())},t.prototype._updateDisplayState=function(t,e){this._dispatch(Object(at.a)(e,t)),this._updateProcessInstanceModifiedTime()},t.prototype.getForwardNavigationEntities=function(t,e,n,a){var r=this;return this._saveFormChangesBeforeNavigation().then((function(){return r._dispatch(P(t,e,n,a||null))}))},t.prototype.navigateToNextEntity=function(t,e,n,a){var r=this;return new Promise((function(i,o){var s=r.ValidateRequiredFieldsForNavigation();if(s&&!s.isValid)return o(new Q("Unable to navigate to next stage as required fields have not been set"));var c=r._stageMetadata.getNextStageId(r.getActiveStageId());if(!c)return o(new X("Last stage in the active path reached. Next stage does not exist."));var u=new f.a(c),l=r.getTraversedPath()+","+c;return r._saveFormChangesBeforeNavigation().then((function(){return r._dispatch(E(t,e,u,l,n,a))})).then((function(){return r.setSelectedStage(c)})).then((function(){r._executePostEvent("runOnStageChange","navigateToNextEntity",0),i()})).catch((function(t){r._dispatch(Object(d.b)(t,!0)).then((function(){return o(t)}))}))}))},t.prototype.navigateToNextEntityForCrossEntityBpf=function(t,e,n,a){var r=this;return new Promise((function(i,o){r._dispatch(E(t,e,new f.a(r.getActiveStageId()),r.getTraversedPath(),n,a)).then((function(){r._dispatch(Object(it.b)(e,r._currentBpfInstance)),r._executePostEvent("runOnStageChange","navigateToNextEntityForCrossEntityBpf",0),i()})).catch((function(t){r._dispatch(Object(d.b)(t,!0)).then((function(){return o(t)}))}))}))},t.prototype.getActiveStageActiveFor=function(){if(this._currentBpfInstance){var t=Object(I.b)(this._getState(),this._currentBpfInstance);if(t)return(new Date).valueOf()-t.valueOf()}return null},t.prototype.getBpfInstanceActiveFor=function(){if(this._currentBpfInstance){var t=Object(I.d)(this._getState(),this._currentBpfInstance);if(t)return(new Date).valueOf()-t.valueOf()}return null},t.prototype.getBpfInstanceCompletedIn=function(){if(this._currentBpfInstance){var t=Object(I.d)(this._getState(),this._currentBpfInstance),e=Object(I.c)(this._getState(),this._currentBpfInstance);if(e&&t)return e.valueOf()-t.valueOf()}return null},t.prototype.getActionLogCollection=function(){return this._currentBpfInstance?Object(O.a)(this._getState(),this.getProcessInstanceId()):null},t.prototype.getActionLog=function(t){var e=this.getActionLogCollection();return e&&e[t.guid]?e[t.guid]:null},t.prototype.UpdateActionLog=function(t,e,n,a){if(!this._currentBpfInstance)return null;var i=Object(O.a)(this._getState(),this.getProcessInstanceId()),o=i&&i[t.guid]?i[t.guid]:null,s=(f.a.EMPTY,{actionLogId:Object(It.a)(a)||a===f.a.EMPTY?o?o.actionLogId:f.a.newGuid():a,status:e,modifiedOn:(new Date).toLocaleString(),stepId:t,processDefinitionid:this._processId,processInstanceid:this.getProcessInstanceId(),message:n}),c=Object(r.__assign)({},i);c[t.guid]=s;var u={actionLogCollection:c};return this._updateBusinessProcessFlowData(this._currentBpfInstance,u),"success"},t.prototype.getEnabledProcesses=function(){var t=this,e=[];return new Promise((function(n,a){var r;t._currentFormEntity&&t._currentFormEntity.etn?t._dispatch((r=t._currentFormEntity.etn,{type:"businessProcessFlow.retrieveFilteredProcesses.async",execute:function(t,e){t.dispatch;var n=t.getState,a=e.DataSource.get_WebAPIService(),i=n(),o=f.a.tryParse(Object(D.i)(i)),s=new T(r,o),c=Object(N.a)(n(),s);return a.sendRequest(c).then((function(t){return t.json()}),h.b)}})).then((function(t){for(var a=0,r=t.value;a<r.length;a++){var i=r[a];e.push(new x(i.name,i.uniquename,i.workflowid))}n(e)}),(function(t){a(t)})):a(new h.a("Current Form Entity cannot be NULL",2147877745))}))},t.prototype.getNavigationEntities=function(){return this._activeStageManager.navigationEntities},t.prototype._getNavigationEntityIdsByEntityLogicalName=function(){return this._activeStageManager.navigationEntityIdsByEntityLogicalName},t.prototype._updateGlobalActiveStage=function(t,e){this._activeStageManager.UpdateGlobalPathAndActiveStage(t,e)},t.prototype._createGlobalNavigationData=function(t){var e=new R,n=Object(B.b)(t.activestageid);e.activeStageId=f.a.toString(n);var a=Object(B.c)(t.traversedpath);Object(It.b)(a)&&(a=k.a.getCandidateTraversedPathFromStagStep(this._stageMetadata.businessProcessFlowVisitor.get_stages(),e.activeStageId)),e.traversedPath=a,e.navigationEntities=[];for(var r=0,i=this._getNavigationEntityTypesFromWorkflowObjectModel();r<i.length;r++){var o=i[r],s=new L;for(var c in s.entityLogicalName=o,s.id=f.a.EMPTY.guid,t)if(Object(B.k)(t[c])){var u=t[c],l=[];if(Object(It.a)(u.reference)||Object(It.a)(u.reference.etn))l.push({name:"entityReference.reference",value:"NULL"}),this._applicationContext.TraceManager.getTracer("CreateGlobalNavigationData").info("Navigation entity should not be null .",l);u&&u.reference&&u.reference.etn===o&&(s.id=u.reference.id.guid)}e.navigationEntities.push(s)}t.hasOwnProperty("businessprocessflowinstanceid")&&(e.businessProcessInstanceId=Object(B.c)(t.businessprocessflowinstanceid));t.hasOwnProperty("name")&&(e.businessProcessInstanceName=Object(B.c)(t.name));t.hasOwnProperty("statecode")&&(e.businessProcessState=Object(B.c)(t.statecode));t.hasOwnProperty("statuscode")&&(e.businessProcessStatus=Object(B.c)(t.statuscode));return t.hasOwnProperty("bpfDefinitionVersioNumber")&&(e.bpfDefinitionVersionNumber=Object(B.c)(t.bpfDefinitionVersioNumber)),e},t.prototype._getNavigationEntityTypesFromWorkflowObjectModel=function(){var t={};if(!Object(It.a)(this.getProcess()))for(var e=0;e<this.getProcess().get_Steps().get_Count();e++){var n=this.getProcess().get_Steps().get_item(e);if(n instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep){var a=n.get_Description();t[a]||(t[a]=a)}}return Object.keys(t)},t.prototype.reflow=function(t,e,n){var a=this._stageMetadata.getDefaultPathManager();if(e||n){if(e){e=new f.a(e).guid;var r=this.getTraversedPath(),i=this.getActiveStageId();r&&i&&(i===e||r.indexOf(e)<0)&&(a.updateDefaultPath(e,n),this._updateProcessInstanceModifiedTime())}}else this._reflowInternal()},t.prototype._reflowInternal=function(t,e){var n=this._stageMetadata.getDefaultPathManager();t||e||(e=this.getActiveStageId(),t=this._stageMetadata.getPreviousStageId(e)),t&&(n.updateDefaultPath(t,e),this._updateProcessInstanceModifiedTime())},t.prototype.callPblToEvaluateBranching=function(t){var e=this,n=this._getState();if(!this._currentPageId)throw new Error("The current page Id should not be null when callPblToEvaluateBranching has been called. Because the reflow logic should be triggered for a particular page.");var a=Object(tt.a)(n,this._currentPageId);this.getScriptContainerPromise().then((function(n){a<et.a.EditReady&&n.getEventManager().addOnLoadEvent(e.getContextToken(),(function(){n.execute(t,[])})),a>=et.a.OnLoadReady&&n.execute(t,[])}))},t.prototype.update=function(t){!Object(It.a)(this._currentBpfInstance)&&this._isSelectedStageControl(t.Id)&&this._updateProcessInstanceModifiedTime()},t.prototype.waitForOngoingWork=function(){return Zt.a.getInstance().checkForOutstandingWork(this._getState())},t.prototype._getEventManager=function(){var t=this.getScriptContainer();return t?t.getEventManager():null},t.prototype.getScriptContainer=function(){if(!this._applicationContext||!this._applicationContext.ScriptManager)return null;var t=null;try{t=this._applicationContext.ScriptManager.getContainer(this._currentPageId)}catch(t){this._logTraceFailureForScriptContainer()}return t},t.prototype.getScriptContainerPromise=function(){return this._applicationContext&&this._applicationContext.ScriptManager?this._applicationContext.ScriptManager.initializeContainer(this._currentPageId):Promise.reject("The current container should be created before invoking handlers.")},t.prototype._executePostEvent=function(t,e,n,a){if(void 0===n&&(n=null),void 0===a&&(a=null),Object(zt.n)(this._getState(),this._currentPageId)||!this._getEventManager())this._logTraceFailureForProcessEvent(e,t,t);else switch(t){case"runOnProcessChange":this._dispatch(this._getEventManager().runOnProcessChange(this.getContextToken(),this));break;case"runOnProcessStatusChange":this._dispatch(this._getEventManager().runOnProcessStatusChange(this.getContextToken(),V.a[a],this));break;case"runOnStageChange":this._dispatch(this._getEventManager().runOnStageChange(this.getContextToken(),this,n));break;case"runOnStageSelected":this._dispatch(this._getEventManager().runOnStageSelected(this.getContextToken(),this))}},t.prototype.executePreEvent=function(t,e,n,a){void 0===n&&(n=null),void 0===a&&(a=null);var r=!1;if(!Object(zt.n)(this._getState(),this._currentPageId)&&this._getEventManager()){switch(t){case"runOnPreProcessStatusChange":r=this._dispatch(this._getEventManager().runOnPreProcessStatusChange(this.getContextToken(),V.a[a],this));break;case"runOnPreStageChange":r=this._dispatch(this._getEventManager().runOnPreStageChange(this.getContextToken(),this,n))}return this._logTraceInfoForProcessPreEvent(r,t,e,e),r}return this._logTraceFailureForProcessEvent(e,t,t),r},t.prototype._saveFormDataAndActiveStage=function(t,e,n){var a=this,r=se.startStopwatch({processId:f.a.toString(this.getProcessId()),processInstanceId:f.a.toString(this.getProcessInstanceId())}),i=this.executePreEvent("runOnPreStageChange",n,e),o=Object(ht.c)(this._getState(),this.getCurrentFormEntity());if(!i){var s=new Promise((function(e,r){if(!t)return r(new G("Attemping to save invalid stage id"));for(var i,s,c=["traversedpath","activestageid","activestagestartedon","completedon"],u=a.getNavigationEntities(),l=Object(v.b)(a._getState(),a._currentBpfInstance),d=0,p=u;d<p.length;d++){var g=p[d];for(var f in l)if(f.includes(g.entityLogicalName)){c.push(f);break}}if(a._shouldPerformFormSave()){var _=a._getState();i=a._validateSnapshot(o).then((function(){return a._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(n)})).then((function(){return s=a._createActiveStageSnapshot(t),a._saveFormEntityAndBPFEntitySnapshots(s,o,!1)})).then((function(){var t=a.getCurrentFormEntity();a._dispatch(Object(ne.a)(a._currentPageId,_,a.getContextToken(),t.etn,t.id))})).catch((function(t){var e=Object(h.c)(t);return a._handleDuplicateDetection(e,s)}))}else i=a._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(n).then((function(){return s=a._createActiveStageSnapshot(t),a._dispatch(Object(ut.c)(s,!0,c,a._getRetrieveProcessControlDataRequest())).then((function(){a._dispatch(Object(lt.a)(a._currentPageId,a.getCurrentFormEntity(),a._getColumnsToRefresh(),a._getRetrieveProcessControlDataRequest())),a._dispatch(Object(S.b)(!0,a._currentFormEntity))}))}));e(i)})).then((function(){var t=a.getTraversedPath(),r=a.getActiveStageId();a._updateGlobalActiveStage(t,r),a.setSelectedStage(r),a._executePostEvent("runOnStageChange",n,e)}),(function(t){throw a._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t}));return s.then(c,c),s}function c(){r()}},t.prototype._handleDuplicateDetection=function(t,e){var n=this;if(Object(ee.e)(t))return this._dispatch(Object($t.a)(this._currentPageId,t,this._currentFormEntity)).then((function(t){return 0===t.status?n._dispatch(Object(te.a)(t.pageId)).then((function(t){return t.value.param_lastButtonClicked===l.a?Promise.resolve("success"):Promise.resolve("aborted")})):Promise.resolve("noop")})).then((function(t){if("success"===t){var a=Object(ht.c)(n._getState(),n.getCurrentFormEntity());return n._saveFormEntityAndBPFEntitySnapshots(e,a,!0)}}));throw t},t.prototype._saveFormEntityAndBPFEntitySnapshots=function(t,e,n){var a={};a[e.identifier.etn]=this._getColumnsToRefresh();var r=null;return r=this.isImmersiveBPF()?[e.snapshotId]:[e.snapshotId,t],this._dispatch(Object(ut.d)(r,n,a,this._getRetrieveProcessControlDataRequest()))},t.prototype._logTraceInfoForProcessPreEvent=function(t,e,n,a){var r=this._applicationContext.TraceManager.getTracer(a),i=this.getTelemetryParams(),o={name:"BpfOperationName",value:n};i.push(o);var s={name:"eventName",value:e};i.push(s);var c={name:"preventDefaultInvokedByWebResource",value:t};i.push(c),r.info("BPF ProcessManager executed scripts registered to event "+e,i)},t.prototype._logTraceFailureForProcessEvent=function(t,e,n){var a=this._applicationContext.TraceManager.getTracer(n),r=this.getTelemetryParams(),i={name:"BpfOperationName",value:t};r.push(i);r.push({name:"preventDefaultInvokedByWebResource",value:null});var o={name:"eventName",value:e};r.push(o);var s={name:"isPageDead",value:Object(zt.n)(this._getState(),this._currentPageId)};r.push(s);var c={name:"currentPageId",value:this._currentPageId};r.push(c),a.error("BPF ProcessManager not able to to execute scripts registered on event "+e+" does not exist",r)},t.prototype._logTraceFailureForScriptContainer=function(){var t=this._applicationContext.TraceManager.getTracer("GET_SCRIPT_CONTAINER"),e=this.getTelemetryParams();e.push({name:"BpfOperationName",value:"GetScriptContainer"});var n={name:"IsPageDead",value:Object(zt.n)(this._getState(),this._currentPageId)};e.push(n);e.push({name:"IsSciptContainerAvailable",value:!1}),t.error("BPF ProcessManager not able to to execute scripts as the script container does not exist",e)},t.prototype._getStage=function(t){var e=this,n=null;if(t){var a=this.getEntityStages();a&&a.some((function(a){for(var r=0;r<a.get_Steps().get_Count();r++){var i=a.get_Steps().get_item(r);if(e._equalsIgnoreCase(t,i.get_Id()))return n=i,!0}}))}return n},t.prototype.getContextToken=function(){return Object(gt.j)(this._getState(),this._currentPageId)},t.prototype._updateProcessInstanceModifiedTime=function(){this._dispatch(Object(rt.b)(this.getCurrentFormEntity()))},t.prototype._isSelectedStageControl=function(t){if(!Object(It.a)(this.getSelectedStage()))for(var e=this.getSelectedStage().get_Steps(),n=0;n<e.get_Count();n++)if(this._equalsIgnoreCase(e.get_item(n).get_Id(),t))return!0;return!1},t.prototype._equalsIgnoreCase=function(t,e){return!!t&&!!e&&t.toUpperCase()===e.toUpperCase()},t.prototype._getSnapshotStateTelemetryParams=function(t){var e=[];if(Object(It.a)(t))return e;var n={name:"mode",value:t.mode},a={name:"identifierId",value:Object(It.a)(t.identifier)||Object(It.a)(t.identifier.id)?null:f.a.toString(t.identifier.id)},r=this._applicationContext.DataSource.get_MetadataCache().getEntityMetadata(t.identifier.etn),i={name:"identifierEntityId",value:Object(It.a)(r)?null:f.a.fromLegacyGuid(r.get_id()).guid},o={name:"identifierEntityObjectTypeCode",value:Object(It.a)(r)?null:r.get_objectTypeCode()},s={name:"activeChanges",value:Object(It.a)(r)?null:this._getIFieldValuesString(t.activeChanges,r.get_logicalName())},c={name:"lockedChanges",value:Object(It.a)(r)?null:this._getIFieldValuesString(t.lockedChanges,r.get_logicalName())};return e.push(n),e.push(i),e.push(o),e.push(a),e.push(s),e.push(c),e},t.prototype._getTelemetryParamsForActionStep=function(t,e,n){var a=this.getTelemetryParams(),r={name:"ActionStepType",value:t},i={name:"ControlId",value:e},o={name:"ActionStepId",value:n};return a.push(r),a.push(i),a.push(o),a},t.prototype.getTelemetryParams=function(){var t=[];try{var e={name:"ProcessId",value:f.a.toString(this.getProcessId())},n={name:"ProcessInstanceId",value:f.a.toString(this.getProcessInstanceId())},a={name:"ActiveStageId",value:this.getActiveStageId()},r={name:"SelectedStageId",value:this.getSelectedStageId()},i={name:"TraversedPath",value:this.getTraversedPath()},o={name:"ActivePath",value:this._getActivePathString()},c={name:"CurrentFormEntityType",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().etn?this.getCurrentFormEntity().etn:""},u={name:"CurrentFormEntityId",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().id?f.a.toString(this.getCurrentFormEntity().id):""},l={name:"ProcessState",value:this.getProcessState()},d={name:"PageId",value:this._currentPageId},p={name:"PageType",value:Object(s.l)(this._getState(),this._currentPageId)},g={name:"SavedPageId",value:this._savedPageId},h={name:"SavedPageType",value:Object(s.l)(this._getState(),this._savedPageId)};if(Object(Lt.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){var v={name:"CustomControlsPresent",value:this.getCustomControlIndicator()},_={name:"RenderedFromFormXML",value:this.getFormXmlRenderingIndicator()};t.push(v),t.push(_)}var m={name:"IsImmersiveBPF",value:this.isImmersiveBPF()};t.push(e),t.push(n),t.push(a),t.push(i),t.push(o),t.push(r),t.push(c),t.push(u),t.push(l),t.push(d),t.push(p),t.push(g),t.push(h),t.push(m)}catch(e){this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManagerTelemetryGeneration").error("Exception while generating Process Manager telemetry parameters: "+e.message,t)}return t},t.prototype._getIFieldValuesString=function(t,e){var n="";if(!Object(It.a)(t))for(var a in t)if(Object(It.a)(a))n+=String.format("[fieldName: {0}]",null);else{var r=this._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(e,a),i=t[a];if(Object(It.a)(i)||Object(It.a)(r))n+=String.format("[attributeId is null: {0}, attributeMetadata is null: {1}]",Object(It.a)(i),Object(It.a)(r));else{var o="";Object(It.a)(i.timestamp)||(o=i.timestamp.toUTCString());var s="",c="",u=null,l=null;Object(It.a)(i.validationResult)||(s=i.validationResult.errorId,c=i.validationResult.errorMessage,u=i.validationResult.isOfflineSyncError,l=i.validationResult.isValueValid);var d=r.get_id();n+=String.format("[attributeId: {0}, timeStamp: {1}, validationResultErrorId: {2}, validationResultErrorMessage: {3}, validationResultIsOfflineSyncError: {4}, validationResultIsValueValid: {5}]",d,o,s,c,u,l)}}return n},t.prototype._getActivePathString=function(){var t=this.getActivePath(),e="";if(t&&t.length>0){for(var n=0;n<t.length-1;n++)e=e+t[n].guid+",";e+=t[t.length-1].guid}return e},t.prototype.isImmersiveBPF=function(){return this.getCurrentFormEntity()&&this._currentBpfInstance&&this.getCurrentFormEntity().etn===this._currentBpfInstance.etn},t.prototype._getColumnsToRefresh=function(){var t=Object(Kt.b)(this._getState(),this._currentPageId),e=Object(s.g)(this._getState(),this._currentPageId);if(Object(It.a)(e)){var n=Object(ht.c)(this._getState(),this.getCurrentFormEntity()),a=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SaveAndRefresh"),r=this._getSnapshotStateTelemetryParams(n);return a.warn("Columns To Refresh is not set as PageInput is null. Primary entity not refreshed after save",r),[]}var i=Object(At.E)(this._getState(),e.entityTypeName),o=Object(l.g)(this._getState(),t,e,i,null);return o&&o.hasOwnProperty(e.entityTypeName)?o[e.entityTypeName]:[]},t.prototype._getRetrieveProcessControlDataRequest=function(){var t=this.getProcessId()&&!f.a.equals(this.getProcessId(),f.a.EMPTY)?$.a.toLegacyEntityReference(new $.a("businessprocessflowinstance",this.getProcessId())):null,e=this.getProcessInstanceId()&&!f.a.equals(this.getProcessInstanceId(),f.a.EMPTY)?$.a.toLegacyEntityReference(new $.a("businessprocessflowinstance",this.getProcessInstanceId())):null;return this.getCurrentFormEntity()&&t&&e?new Ht.a($.a.toLegacyEntityReference(this.getCurrentFormEntity()),t,e):this.getCurrentFormEntity()?new Ht.a($.a.toLegacyEntityReference(this.getCurrentFormEntity()),null,null):null},t.prototype.getCustomControlIndicator=function(){return this._customControlsPresent},t.prototype.setCustomControlIndicator=function(t){this._customControlsPresent=t},t.prototype.getFormXmlRenderingIndicator=function(){return this._renderedFromFormXml},t.prototype.setFormXmlRenderingIndicator=function(t){this._renderedFromFormXml=t},t.prototype.getInstanceModifiedTimestamp=function(){return this._instanceModifiedTimestamp},t.prototype.isBpfFormDescriptorValid=function(t,e,n,a){return null===this._isBpfFormValid&&(this._isBpfFormValid=Object(Jt.f)(t,e,n,a)),this._isBpfFormValid},t.prototype._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure=function(t,e){var n=e;if(Object(It.a)(e)){var a=Object(h.c)(t);n=!Object(It.a)(a)&&a.FaultedSnapshotId}!Object(It.b)(n)&&this._dispatch(Object(ct.b)(n,!1));var r=Object(ht.c)(this._getState(),this.getCurrentFormEntity());r&&!Object(It.a)(r.snapshotId)&&r.snapshotId!==n&&this._dispatch(Object(ct.b)(r.snapshotId,!1))},t}()},"7z0H":function(t,e,n){"use strict";n.d(e,"f",(function(){return yt})),n.d(e,"h",(function(){return at})),n.d(e,"i",(function(){return dt})),n.d(e,"j",(function(){return pt})),n.d(e,"k",(function(){return gt})),n.d(e,"c",(function(){return ot})),n.d(e,"d",(function(){return st})),n.d(e,"a",(function(){return et})),n.d(e,"b",(function(){return nt})),n.d(e,"e",(function(){return rt})),n.d(e,"g",(function(){return bt}));var a=n("wQXd"),r=n("9r0m"),i=n("i8/j"),o=n("/j9Z"),s=n("HSdq"),c=n("2OIc"),u=n("sOTk"),l=n("QAhb"),d=n("F2uj"),p=n("7EJx"),g=n("ObKm"),h=n("CpQy"),f=n("gBKR"),v=n("jJRu"),_=n("cAHA"),m=n("lMVv"),b=n("TCcM"),y=n("GWjY"),P=n("DJ9D");var S=n("VWqI"),I=n("Cfob"),O=n("Qeyq"),C=n("r4Uk"),w=n("T2Xs"),F="CustomControlFramework.Selectors.DynamicDataSelectors.CustomControlTimelineWallSelector";var j=n("aUuu"),E=n("Sscr"),N=n("mGpW"),M=n("RNNy"),T=n("WACO"),D=n("M6d0"),A=n("n+eO"),x=n("yHpA"),B=n("+l2M"),R=n("YHw6"),k=n("IfuP"),L=n("cL6R"),V=n("YEEA"),q=n("Ww2r"),W=n("EcZf"),U=n("BRt1"),H=n("U0B9"),G=n("jm5F"),z=n("TiXY"),Y=n("wUng"),X=n("cZkS"),K=n("qC0c"),Q=n("AfKB"),J=n("455M"),Z=n("ZEX9"),$=n("yZTI"),tt=n("uQP8"),et="form.initialize",nt="form.xrmready";function at(t,e,n,a,c){var h=[{name:"formId",value:r.a.toString(t)},{name:"pageId",value:e},{name:"contextKey",value:Object(E.v)(n)}];return{type:"form.initialize.async",execute:function(f,v,_){var b,y=f.dispatch,P=f.getState,I=P(),O=Object(u.g)(I,e),N=O.entityTypeName,M=O.data,x=O.recordSetQueryKey,k=v.TraceManager.getTracer("Forms.InitializeForm"),q=[];if(h.push({name:"isPreview",value:O&&O.isPreview}),h.push({name:"EntityName",value:O&&O.entityTypeName}),k.info("initializeForm started.",h),Object(Z.b)(function(t){return function(){var e={},n={},a={};return function(r,i,o,s,c){w.a.info(F+o.controlId+": createGetTimelineWallData started");var u=!1;n.hasOwnProperty(r)&&n[r]||(n[r]=new C.a(t,r,o.id));var l=n[r],d=l.retrieveTimelineWallObject(i,o,s,c,t);a.hasOwnProperty(r)&&a[r]&&d===a[r]||(a[r]=d,u=!0);var p=l;return u&&(e[r]=p),w.a.info(F+o.controlId+": createGetTimelineWallData finished"),e[r]}}}(y),J.a.TimelineWall),k.info("BusinessProcessWrapperManager.Instance.init started.",h),q.push(A.a.Instance.init(v,P,y).then((function(){return k.info("BusinessProcessWrapperManager.Instance.init completed.",h)}))),Object(S.a)(I,t))if(Object(u.m)(I,e)){if(!Object(S.g)(I,N,1,0)&&!(null==O?void 0:O.isPreview))return it(22e8,y,k,_,I,e)}else if(!Object(S.g)(I,N,2,0))return it(2147746342,y,k,_,I,e);var H=Object(i.j)(I,t),$=bt(I,H,t),tt=vt(I,N,H),et=function(t,e,n,a){var r={};if(e&&e.RelatedEntityAttributes&&a)for(var i in e.RelatedEntityAttributes){var o=Object(m.x)(t,a,i);if(o&&o.ReferencedEntity){var s={},c=_t(t,o.ReferencedEntity,e.RelatedEntityAttributes[i]),u=Object(E.m)(n,i);r[Object(E.v)(u)]={attributes:c,submitModes:s}}}return r}(I,H,n,N),nt=Object(U.a)(I),at=Object(p.s)(I);for(var rt in Pt(I,y,t,$,tt,e,n,et,at),x&&!nt&&y(Object(W.g)(e,x)),k.info("Update quick view forms started.",h),H.InlineQuickForms){var ot=H.InlineQuickForms[rt];for(var st in ot){var dt=ot[st],pt=Object(i.j)(I,dt),gt=bt(I,pt,dt),mt=vt(I,st,pt),yt=Object(E.l)(n,rt,st);Pt(I,y,t,gt,mt,e,yt,null,at)}}if(k.info("Update quick view forms completed.",h),M&&0!==Object.keys(M).length){var St=O,It=St.createFromEntity,Ot=St.createFromRelationship,Ct=O.initWithEntity,wt=It;!wt&&Ct&&(wt=Ct),b=function(t,e,n,a,i,c,p,h,f,v,_){n&&n.info("initializeFormWithDefaultValue started.",a);var b,y,P=Object(d.d)(t,c),S=null,I={},O=Object(u.m)(t,i),C=r.a.toString(h),w=[];C&&(S=Object(d.k)(t,C));for(var F=0,j=Object.keys(p);F<j.length;F++){var N=j[F];if("processid"!==N){var M=P[N];if(!M&&S&&(M=S[N]),M&&!M.AttributeOf){var T=M.Type;switch(T){case"customer":case"owner":case"lookup":case"regarding":if("string"==typeof p[N]){var A=ct(p,N,M);if(!A){lt(n,N);continue}if(I[N]=A,!r.a.equals(r.a.EMPTY,A.id)&&"owner"!==T&&O&&(v||_))if(y){var x=y.then((function(){return e(Object(G.b)(i,h)).then((function(){n&&n.info("updateSnapshotWithOptions completed (1).",a)}))}));w.push(x)}else y=ft(t,e,A,c,i,n,a,v,_),w.push(y)}else{var B=void 0;(B=Array.isArray(p[N])?p[N][0]:p[N])&&B.id&&r.a.tryParseOrNull(B.id)&&B.entityType&&(I[N]=new l.a(B.entityType,new r.a(B.id),B.name))}break;case"partylist":var R=p[N],k=R,L=[];try{"string"==typeof R&&(k=JSON.parse(R));for(var q=0,W=k;q<W.length;q++){var U=W[q];L.push(new l.a(U.entityType,new r.a(U.id),U.name))}}catch(t){lt(n,N,"partylist")}I[N]=L;break;case"boolean":case"picklist":case"status":I[N]=p[N];break;case"uniqueidentifier":I[N]=new r.a(p[N]);break;default:I[N]=p[N]}}else if(-1!==N.indexOf(Q.d)||"_CreateFromId"===N){var H=null;if(-1!==N.indexOf(Q.d)&&(H=ct(p,Q.d,M)),!H&&"_CreateFromId"===N){var J=Object(m.m)(t,p._CreateFromType),Z=Object(m.h)(t,J);Z&&(H=ut(J,p._CreateFromId,Z.DisplayName))}if(!H){lt(n,Q.d);continue}if(!b&&(b=H,O))if(y){x=y.then((function(){return e(Object(G.b)(i,h)).then((function(){n&&n.info("updateSnapshotWithOptions completed (2).",a)}))}));w.push(x)}else y=ft(t,e,b,c,i,n,a,v,_),w.push(y);if(Object(m.h)(t,c).IsActivity&&-1===Object.keys(I).indexOf(D.t)&&Object(m.z)(t,c,b.etn,D.t)){var $=Object(s.ab)(t,i,f);$&&$[D.t]&&(I[D.t]=H)}}else{if(lt(n,N),Object(K.c)(t,X.Rc))return Promise.reject(Object(V.b)(t,i,2200000009))}}}var tt=Object(K.c)(t,X.L),et=I;tt&&(et=function(t,e,n,a,r){var i={},o=Object(E.w)(a),c=Object(s.P)(t,o,e,n);for(var u in r)if(c&&c.hasOwnProperty(u)){var l=Object(d.a)(t,e,u);if(!(l&&l.ParentPicklistLogicalName)&&!Object(z.a)(t,a,n,e,c,u,{name:u,value:0})){i[u]=r[u];var p=[];for(l&&l.ChildPicklistLogicalNames&&(p=p.concat(l.ChildPicklistLogicalNames));p&&p.length>0;){var g=p.pop();if(r.hasOwnProperty(g)){var h=Object(d.a)(t,e,g),f=JSON.parse(r[h.ParentPicklistLogicalName]),v=JSON.parse(r[g]);Object(Y.a)(t,n,a,h,e,f,v)&&(i[g]=r[g],h.ChildPicklistLogicalNames&&h.ChildPicklistLogicalNames.length>0&&(p=p.concat(h.ChildPicklistLogicalNames)))}}}}else i[u]=r[u];return i}(t,c,i,f,I));var nt=ht(et);if(w.length>0)return Promise.all(w).catch((function(t){if(2147749377===t.errorCode||-2147093999===t.errorCode)return Promise.resolve(null);Object(o.b)(t)})).then((function(){return e(Object(g.a)(i,nt,!0,!0)),n&&n.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length > 0.",a),Promise.resolve(null)}));return e(Object(g.a)(i,nt,!0,!0)),n&&n.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length == 0.",a),Promise.resolve(null)}(P(),y,k,h,e,N,M,t,n,wt,Ot)}if(H&&H.Controls&&H.Controls.notescontrol){var Ft=Object(u.g)(I,e);k.info("loadTimelineConfigAndMetaData started.",h),y(Object(j.b)(H.Controls.notescontrol,Ft,a)).then((function(){k.info("loadTimelineConfigAndMetaData completed.",h)}))}if(H&&H.Controls)for(var jt in H.Controls)if(H.Controls[jt]){if(H.Controls[jt].Id&&H.Controls[jt].Id.startsWith("WebResource"))for(var Et=0,Nt=H.Controls[jt].Parameters;Et<Nt.length;Et++){var Mt=Nt[Et];if("Url"===Mt.Name){var Tt=!1;if(c)for(var Dt=0,At=c;Dt<At.length;Dt++){var xt=At[Dt],Bt=Mt.Value&&Mt.Value.toLowerCase()||"";if(Bt.length>=xt.length&&Bt.length-xt.length===Bt.lastIndexOf(xt)){Tt=!0;break}}if(!Tt){var Rt=Object(T.j)(I,Mt.Value);Rt&&!Rt.Name&&(k.info("retrieveWebResourceDescriptorByName started.",h),y(Object(L.c)(Mt.Value)).then((function(){k.info("retrieveWebResourceDescriptorByName completed.",h)})))}}}r.a.equals(H.Controls[jt].ClassId,B.rb)&&I&&void 0===I.currentServerTime.serverTimeDiffInSeconds&&(k.info("retrieveServerTime started.",h),y(Object(R.b)(new l.a(N))).then((function(){k.info("retrieveServerTime completed.",h)})))}return null!=b?b:(k.info("initializeForm completed.",h),Promise.all(q))},getFailureParameters:function(t,e){return h}}}function rt(t,e,n,r,i,o,s){var c=e(Object(f.f)(o,!1,[])).then((function(){var n=Object(m.h)(t(),o);if(n.IsChildEntity){var a=Object(S.d)(t(),n);return e(Object(f.f)(a.EntityLogicalName,!1,[]))}})),l=function(){var i=t();if(!Object(S.b)(i,o))return it(2200000001,e,n,r,i,s);var c=Object(S.c)(i,o),l=Object(a.d)(i);return c&&Object(u.m)(i,s)&&!l?it(2200000002,e,n,r,i,s):void 0};return c?c.then(l):Promise.resolve(l())}function it(t,e,n,a,r,i){var o=Object(V.d)(t);return e(Object(N.e)(o)).then((function(){var e=Object(V.c)(t);if(n){var s=[{name:"CorrelationId",value:a.correlationId},{name:"ContextId",value:a.contextId},{name:"ActionStack",value:a.stack}];n.debug(e,s)}var c=Object(q.e)(r,o),u=Object(q.c)(c,o[0]),l=Object(q.c)(c,o[1]);throw Object(V.b)(r,i,t,e,u,l)}))}function ot(t,e,n,a,r,i,o,c,h){h.push({name:"AutoPopulateFieldsTimeStamp",value:Date.now()}),c&&c.info("autoPopulateFields started.",h);var f=Object(d.d)(t,n);if(f){for(var v=function(t){return t&&t.OptionSet&&Object.keys(t.OptionSet).length>0},_=Object(u.g)(t,a).id,m=new l.a(n,_),b={},y=Object(s.ac)(t,a,o),P=function(e){var n=f[e];if(n&&(r.indexOf(e)>=0&&i.indexOf(e)>=0||v(n))&&!Object(s.X)(t,a,o,y,m,n.LogicalName)){switch(e){case D.q:var c=Object(p.q)(t),u=Object(p.t)(t);if(c&&u){var d=new l.a(M.a,c,u);b[e]=d}break;case D.w:if(!Object(x.d)(t,y,null,D.w)){var g=Object(p.b)(t);if(g){var h=new l.a(M.b,g.transactionCurrencyId,g.currencyName);b[e]=h}}}if(v(n)){var _=Object(x.d)(t,y,new l.a(n.EntityLogicalName),e),P=_?parseInt(_.valueString,10):null!=n.DefaultValue?n.DefaultValue:e===D.u?0:void 0;if(void 0===P||P<0||(b[e]=P),e===D.u&&-1!==r.indexOf(D.v)){var S=f[e];if(S&&S.OptionSet&&Object.keys(S.OptionSet).length>0){var I=n.OptionSet.find((function(t){return t.Value===P})),O=I?I.DefaultStatus:f[D.v].DefaultValue||0;O<0||(b[D.v]=O)}}}}},S=0,I=r.concat(i);S<I.length;S++){P(I[S])}var O=ht(b);e(Object(g.a)(a,O,!0,!0)),c.info("autoPopulateFields completed.",h)}else c&&c.warn("attributes is null.",h)}function st(t,e,n,a,i,o,s){var c=Object(u.g)(t,a).id,d=new l.a(n,c),p={};if(r.a.isNullOrEmpty(d.id)&&!s)return function(t,e,n,a,i){var o=Object(b.d)(t,n);if(null!=o)return Promise.resolve(o);return e(Object(k.a)(r.a.EMPTY,new l.a(n,r.a.EMPTY))).then((function(t){return t&&t.businessProcessFlows?Promise.resolve(r.a.tryParse(Object.keys(t.businessProcessFlows)[0])):Promise.resolve(null)})).catch((function(t){var e=[{name:"CorrelationId",value:i.correlationId},{name:"ContextId",value:i.contextId},{name:"ActionStack",value:i.stack},{name:"entityName",value:n},{name:"reason",value:t&&t.message?t.message:JSON.stringify(t)}];return a.EventManager.ReportComponentFailure("Forms.InitializeForm",Error("Catch block of InitializeForm.retrieveBusinessProcessFlow"),void 0,e),a.TraceManager.getTracer("Forms.InitializeForm").error("Error while executing getBusinessProcessFlowDefaultIdForEntity in the retrieveBusinessProcessFlow promise.",e),Promise.resolve(null)}))}(t,e,n,i,o).then((function(t){t&&(p.processid=t.guid);var n=ht(p);return e(Object(g.a)(a,n,!0,!0)),Promise.resolve()}));s&&(p.processid=s);var h=ht(p);return e(Object(g.a)(a,h,!0,!0)),Promise.resolve()}function ct(t,e,n){var a=e;!e.match(/id$/i)&&e.indexOf(Q.d)>-1&&(a+="id");var i=t[a];if(null!=i){if(r.a.validate(i)){var o=i,s=t[e+"name"],c=t[e+"type"]||t[e+"target"];return!c&&n.Targets&&n.Targets.length>0&&(c=n.Targets[0]),ut(c,o,s)}try{var u=JSON.parse(i);if(u)return ut(u.entityType,u.id,u.name)}catch(t){}}return null}function ut(t,e,n){if(t&&e&&r.a.validate(e)){var a=new r.a(e);if(!r.a.isNullOrEmpty(a))return new l.a(t,a,n)}return null}function lt(t,e,n){if(t){var a=[{name:"key",value:e},{name:"source",value:n}];t.warn("Value passed is not in correct syntax.",a)}}function dt(t,e,n,a,r,i,o,s){return pt(t,e,n,a,i,o,s).then((function(){return gt(t,e,n,r,i,o,s)}))}function pt(t,e,n,a,r,i,o){return!Object(s.Eb)(t,r)&&Object($.n)(t,r)?(i&&i.warn("pageId"+r+" is dead so rejecting loadScripts"),Promise.reject(Object(V.b)(t,r,2200000008,"Page has expired."))):(i&&i.info("loadScripts started.",o),n(e.ScriptManager.getContainer(r).getEventManager().loadScripts(a,r)).then((function(){i&&i.info("loadScripts completed",o)})))}function gt(t,e,n,a,r,i,o){if(Object(s.Eb)(t,r)||!Object($.n)(t,r)){i&&i.info("runFormOnLoadScripts started.",o);var c=e.ScriptManager.getContainer(r).getEventManager();n(c.addPblEvent(a)),n(c.runOnLoad(a,1)),n(c.runOnDataLoad(a,1)),i&&i.info("runFormOnLoadScripts completed.",o)}else i&&i.warn("pageId "+r+" is dead so won't run runFormOnLoadScripts",o)}function ht(t){var e={};for(var n in t){var a={fieldName:n,value:t[n]};e[n]=a}return e}function ft(t,e,n,a,r,i,s,c,u){var d=Object(E.j)(t,r),p=Object(E.x)(d);return i&&i.info("createAndSetDataSnapshotFrom started.",s),e(function(t,e,n,a,r){return{type:"snapshot.from.async",execute:function(i,s){var c=i.dispatch,u=i.getState,d=s.DataSource,p=l.a.toLegacyEntityReference(t),g=new y.a(p,e,P.a.All),S=d.execute(g,null).nativePromise(),I=null,O=null,C=null;return S.then((function(t){var n=t.get_entity();return I=Object(h.a)(n),O=I.fields,C=I.identifier,c(Object(f.f)(e,!1,Object.keys(I.fields)))}),(function(t){var n=Object(o.c)(t);if(t&&t.get_ErrorCode&&(-2147093999===t.get_ErrorCode()||n&&-2147217919===n.getNegativeErrorCode())&&a){var i=[];if(O={},a.etn){var s=Object(m.c)(u(),a.etn,e);if(s)for(var d=0,p=s;d<p.length;d++){var g=p[d];g.ReferencingAttribute&&i.push(g.ReferencingAttribute)}}else r&&i.push(r.attributeName);for(var h=0,v=i;h<v.length;h++){var _=v[h];if(!a.name&&a.id){var y=Object(b.h)(u(),a.etn,a.id.guid);if(y&&y.fields){var P=Object(m.E)(u(),a.etn),S=y.fields[P];S&&S.value||(S=y.fields.name),S&&S.value&&(a={etn:a.etn,id:a.id,name:S.value})}}O[_]={reference:a,timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}}return C=new l.a(e),c(Object(f.f)(e,!1,i))}Object(o.b)(t)})).then((function(){var t=Object(v.b)(u(),C,O,n,_.a.Create),e=t.payload.snapshotId;return c(t),e}))}}}(n,a,p,c,u)).then((function(t){i&&(s.push({name:"newSnapshotId",value:t?t.toString():"<null>"}),i.info("initializeCreateDataSnapshotFrom completed.",s)),e(Object(I.b)(r,t,d)).then((function(){i&&i.info("createAndSetDataSnapshotFrom completed.",s)}))}))}function vt(t,e,n){var a={};if(n&&n.Attributes&&e){var r=Object(T.d)(t,n.FormLibraries,[e]);if(n.Attributes||r){var i=[].concat(n.Attributes,r);-1===i.indexOf(D.u)&&i.push(D.u),a=_t(t,e,i)}}return{attributes:a,submitModes:{}}}function _t(t,e,n){var a={};if(n&&e)for(var r=0;r<n.length;r++){var i=n[r];if(i){var o=Object(s.L)(t,e,i);o&&(a[i]=o)}}return a}function mt(t){return Array.isArray(t)?t:t.Controls?t.Controls:null}function bt(t,e,n){var a={},r={},i={},o={bodyVisible:!0,commandBarVisible:!0,tabNavigatorVisible:!0},u={visible:!0},l={navBarAreas:{},navPaneIsvItems:{},navBarByRelationshipItems:{},navBarItems:{}};if(e&&e.Tabs&&e.TabNames)for(var d=!1,p=0,g=Object(s.m)(t,e);p<g.length;p++){var h=g[p],f={collapsed:!!d||!(h.Expanded&&h.Visible),visible:h.Visible,label:h.Label,sectionNames:[],domId:h.DomId,showLabel:h.ShowLabel,contentType:null};switch(h.ContentType){case"expandAvailableSpace":case"singleComponent":f.contentType="singleComponent";break;default:f.contentType="cardSections"}d=d||h.Expanded&&h.Visible;var v=[];if(h.Columns)for(var _=0;_<h.Columns.length;_++){var m=h.Columns[_];if(m.SectionNames)for(var b=0;b<m.SectionNames.length;b++){var y=m.SectionNames[b];if(e.Sections[y]){var P=e.Sections[y];v.push(y);for(var S=[],I=0,C=e.Sections[y].Rows;I<C.length;I++)for(var w=0,F=C[I].Cells;w<F.length;w++){var j=F[w];j.ControlName&&S.push(j.ControlName)}var E={parentTabId:h.Id,visible:P.Visible,label:P.Label,controlNames:S,domId:P.DomId,semanticZoomDomId:P.SemanticZoomDomId};r[y]=E;for(var N=0;N<S.length;N++){var M=S[N];if(e.Controls[M]){var T=e.Controls[M],D=yt(T,y,!0),A=Object(c.a)(T,e,Object(H.b)(t));null!=A&&(D.visible=D.visible||A.ShouldOverrideControlVisible),St(D),i[M]=D}}}}}if(h.Header)for(var x=0,B=h.Header;x<B.length;x++){i[(W=B[x]).Name]=yt(W,null,!0)}if(h.Footer)for(var R=0,k=h.Footer;R<k.length;R++){i[(Y=k[R]).Name]=yt(Y,null,!0)}f.sectionNames=v,a[h.Id]=f}if(e&&e.Navigation&&(l=e.Navigation),e&&e.Header){var L=mt(e.Header);if(L)for(var V=0,q=L;V<q.length;V++){var W;i[(W=q[V]).Name]=yt(W,null,!0),St(i[W.Name])}o.bodyVisible=!1!==e.Header.BodyVisible,o.commandBarVisible=!1!==e.Header.CommandBarVisible,o.tabNavigatorVisible=!1!==e.Header.TabNavigatorVisible}if(e&&e.Footer){var U=mt(e.Footer);if(U)for(var G=0,z=U;G<z.length;G++){var Y;i[(Y=z[G]).Name]=yt(Y,null,!0),St(i[Y.Name])}u.visible=!1!==e.Footer.Visible}return{formId:n,tabs:a,sections:r,controls:i,selectedTab:Object(O.a)(),selectedRelatedEntity:null,isSaving:!1,invalidControls:{},invalidAttributes:{},controlUnboundOutputs:{},inlineQuickForms:e&&e.InlineQuickForms?e.InlineQuickForms:null,xrmReady:!1,label:"",navigation:l,viewportWidth:0,viewportHeight:0,showHeaderFieldsInSection:!1,headerFieldsInFlyout:new Set,isAutoSaving:!1,header:o,footer:u}}function yt(t,e,n){return t?{parentSectionName:e,visible:t.Visible,label:t.Label,valid:n,labelSource:t.LabelSource,domId:t.DomId,parameters:t.Parameters,dataFieldName:t.DataFieldName,relationship:t.Relationship}:null}function Pt(t,e,n,a,i,o,c,u,l){void 0===u&&(u=null);var d=Object(s.cb)(t,o,c),p=Object(tt.a)(t,o);r.a.equals(null==d?void 0:d.formId,null==a?void 0:a.formId)&&r.a.equals(n,null==p?void 0:p.formId)||e(function(t,e,n,a,r,i,o){void 0===i&&(i=null);return{type:et,payload:{formId:t,formUIState:e,formMetadataState:n,relatedEntityMetadataState:i,currentLanguageId:o},meta:{pageId:a,contextToken:r}}}(n,a,i,o,c,u,l))}function St(t){t&&t.parameters&&t.parameters.DefaultViewId&&(t.parameters.defaultviewid=t.parameters.DefaultViewId)}},"90Ov":function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("WS0f");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function r(t){return Object(a.b)(t)?null:("{"===(t=t.trim())[0]&&"}"===t[t.length-1]&&(t=t.substring(1,t.length-1)),t.toLowerCase())}},"A/RO":function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));var a,r=n("9r0m"),i=n("/eCp");!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive",t[t.Completed=2]="Completed"}(a||(a={}));var o=n("nbQV"),s=n("lKeh"),c=n("QAhb"),u=n("VnpK"),l=n("S2mk"),d=n("F2uj"),p=n("T576"),g=n("HSdq"),h=n("Sscr"),f=n("lMVv"),v=n("WS0f"),_=n("qC0c"),m=n("U0B9"),b=n("sOTk"),y=n("MSdU"),P=n("r0s4"),S=function(){function t(t,e,n){this._memorizedExtraFilters=[],this._getState=t,this._businessProcessFlowWrapperIdentifierFactory=e,this._context=n}return t.prototype.generate=function(t,e){return e?this._getBusinessProcessFlowWrapper(t,e):null},t.prototype._getBusinessProcessFlowWrapper=function(t,e){var n=this._getState(),a=this._businessProcessFlowWrapperIdentifierFactory.generate(t,e);if(!a||!e||!e.getProcessId())return null;var i=e.getCurrentFormEntity(),c=Object(b.g)(n,t);this._navigationEntities=e.getNavigationEntities();var u=Object(p.f)(n,i);return{id:e.getProcessId(),instanceId:e.getProcessInstanceId(),name:Object(o.c)(n,e.getProcessId()),bpfEntityLogicalName:e.getBpfEntityLogicalName(),stages:this._getStages(a.data.activePath,a.activeStageId,a.data.selectedStageId,t,e),relationships:Object(s.e)(this._getState(),e.getProcessId()),activeStageId:a.activeStageId,selectedStageId:a.data.selectedStageId,activePath:a.data.activePath,displayState:a.displayState,currentEntity:new y.a(i.etn,r.a.toLegacyGuid(i.id)),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),statusName:e.getStatusName(),isFormInactive:Object(g.Lb)(n,c.entityTypeName,c.id),delegates:this._getActions(e),isVisible:e.isVisible(),actionLogs:a.data.actionLogCollection,instanceModifiedTimestamp:u,instanceName:e.getProcessInstanceName(),isCustomControlsPresent:e.getCustomControlIndicator(),isRenderedFromFormXml:e.getFormXmlRenderingIndicator(),isImmersiveBPF:e.isImmersiveBPF()}},t.prototype._getStages=function(t,e,n,a,i){var o=this;if(!t||0===t.length)return null;var s={},c=[];return t.forEach((function(t,u){s[t.guid]=u;var l=r.a.equals(t,n),d=o._getStageWrapper(t,l,e,s,a,i);d&&c.push(d)})),c},t.prototype._getStageWrapper=function(t,e,n,a,i,o){var c=this,u=Object(s.c)(this._getState(),o.getProcessId(),t);if(!u)return null;var l=e&&this._getSteps(u,i,o)||[];if(Object(_.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){var d="BusinessProcessFlow.CustomControlConfiguration",p=this._context.TraceManager.getTracer(d),g=Object(s.a)(this._getState(),o.getProcessId(),p);if(!Object(v.a)(g)&&!Object(v.a)(g.ControlConfigurations)){var h=o.getTelemetryParams();if(h.push({name:"BPFEntityFormId",value:g.Id.guid},{name:"BPFEntityFormType",value:g.FormType}),Object(v.a)(g.ControlConfigurations)||h.push({name:"CustomControls",value:Object.keys(g.ControlConfigurations).length}),o.isBpfFormDescriptorValid(this._getState(),o.getProcessId(),g,p))try{if(!Object(v.a)(g.ControlConfigurations)){var m=Object(s.b)(g,p),b=g.ControlConfigurations,y=this._getNonDefaultControlConfiguration(b);if(Object(_.c)(this._getState(),"FCB.EnableBPFCCPhase3")){var P=this._buildStepsFromFormXml(u,g,y,h,i,o);P&&P.length>0&&(l=P,o.setFormXmlRenderingIndicator(!0),this._context.EventManager.ReportComponentSuccess(d,h))}else Object(v.a)(m)||Object.keys(m).forEach((function(t){if(m[t].ParentCellId){var e=new r.a(m[t].ParentCellId);if((u&&u.stage&&u.stage.steps?u.stage.steps.map((function(t){return t.stepId.guid})).indexOf(e.guid):-1)>=0&&e){var n=[];n.push({name:"StepId",value:e.guid},{name:"NonDefaultControlUniqueId",value:m[t].UniqueId}),p.info("Non-default control found for step",n);var a=null;y&&m[t].UniqueId&&(o.setFormXmlRenderingIndicator(!0),a=y[m[t].UniqueId]?y[m[t].UniqueId]:null);var i={attributeName:m[t].DataFieldName,isRequired:c._getIsStepRequired(e.guid,u),name:m[t].Label,stepId:new r.a(e.guid),stepType:"field",attributeType:c._getMetadataTypeByAttribute(u.entityLogicalName,m[t].DataFieldName),controlName:"header_process_"+m[t].Label,isVisible:m[t].Visible,isControlDisabled:m[t].Disabled,nonDefaultConfiguration:a};l.push(i),Object(v.a)(i.stepId.guid)||i.stepId.guid===r.a.EMPTY.guid||h.push({name:"StepId",value:i.stepId.guid}),h.push({name:"AttributeName",value:i.attributeName},{name:"AttributeType",value:i.attributeType},{name:"IsRequired",value:i.isRequired},{name:"NonDefaultControlUniqueId",value:m[t].UniqueId}),Object(v.a)(a)?c._context.EventManager.ReportComponentFailure(d,new Error("CustomControlConfiguration is null or undefined even though the BPF entity form XML is valid and contains non-default custom control descriptors"),null,h):(o.setCustomControlIndicator(!0),h.push({name:"CustomControlId",value:a.CustomControlId}),!Object(v.a)(a.Name)&&a.Name.indexOf("MscrmControls")>=0&&h.push({name:"CustomControlName",value:a.Name}),c._context.EventManager.ReportComponentSuccess(d,h))}}}))}}catch(t){p.error("Message: "+t.message+", Stack: "+t.stack,h),this._context.EventManager.ReportComponentFailure(d,t,null,h)}else this._context.EventManager.ReportComponentFailure(d,new Error("Invalid FormXML - Fallback invoked"),null,h)}}return{id:u.stage.stageId,name:u.stage.stageDisplayName,entityName:u.entityLogicalName,entityDisplayName:Object(f.f)(this._getState(),u.entityLogicalName)||u.entityDisplayName,relatedEntityReference:this._getRelatedEntityReference(u.entityLogicalName),referencingAttributeName:u.referencingAttributeName,status:this._getStageStatus(a[t.guid],a[n.guid],o),steps:l}},t.prototype._buildStepsFromFormXml=function(t,e,n,a,i,o){var s=this,c=[],u=e.Controls;return!Object(v.a)(u)&&this._areStepsValid(t,e,a)&&Object.keys(u).forEach((function(l){if(!Object(v.a)(u[l])&&u[l].ParentCellId){var d=new r.a(u[l].ParentCellId),p=e.Tabs.find((function(t){return t.Id===u[l].ParentTabId}));if(p&&!Object(v.a)(p.RawTabId)&&t.stage.stageId.guid===new r.a(p.RawTabId).guid){var h=null;n&&u[l].UniqueId!==r.a.EMPTY.guid&&(h=n[u[l].UniqueId]?n[u[l].UniqueId]:null);var f=s._retrieveControlName(u[l],t.stage.steps),_=s._getUIControl(i,f),m={attributeName:u[l].DataFieldName,isRequired:u[l].IsRequired,name:s._retrieveStepLabel(u[l],_,t.stage.steps),stepId:new r.a(d.guid),stepType:s._getStepTypeFromControlKey(l),attributeType:s._getMetadataTypeByAttribute(t.entityLogicalName,u[l].DataFieldName),controlName:f,isVisible:_&&!Object(v.a)(_.visible)?_.visible:u[l].Visible,isControlDisabled:u[l].Disabled||Object(g.t)(s._getState(),{id:i,controlName:f},o.getContextToken()),viewId:_&&_.parameters&&_.parameters.defaultviewid?_.parameters.defaultviewid:null,nonDefaultConfiguration:Object(v.a)(h)?null:h};m.config=s._getConfig(e,o,u[l],i,a),m.viewId&&m.config&&m.config.Parameters&&m.config.Parameters.value&&(m.config.Parameters.value.ViewId=m.viewId,_&&_.customFilter&&_.customFilter.length>0&&(s._applyLookupFilter(m,_),m.config.Parameters.value.ExtraFilters=m.extraFilters)),c.push(m),a.push({name:"StepId",value:m.stepId.guid},{name:"AttributeName",value:m.attributeName},{name:"AttributeType",value:m.attributeType},{name:"IsRequired",value:m.isRequired},{name:"NonDefaultControlUniqueId",value:u[l].UniqueId}),Object(v.a)(h)||u[l].UniqueId===r.a.EMPTY.guid||(o.setCustomControlIndicator(!0),a.push({name:"CustomControlId",value:h.CustomControlId}),!Object(v.a)(h.Name)&&h.Name.indexOf("MscrmControls")>=0&&a.push({name:"CustomControlName",value:h.Name}))}}})),c},t.prototype._areStepsValid=function(t,e,n){if(!(Object(v.a)(e)||Object(v.a)(t)||Object(v.a)(t.stage)||Object(v.a)(t.stage.stageId))){var a=e.Controls,i=t.stage.stageId.guid.toLowerCase(),o=t.stage.steps,s=[];if(!Object(v.a)(a)){if(Object.keys(a).forEach((function(t){if(!Object(v.a)(a[t].ParentCellId)){var n=new r.a(a[t].ParentCellId).guid.toLowerCase(),o=e.Tabs.find((function(e){return e.Id===a[t].ParentTabId}));if(!Object(v.a)(o)&&!Object(v.a)(o.RawTabId)){var c=new r.a(o.RawTabId).guid.toLowerCase();i===c&&s.indexOf(n)<0&&s.push(n)}}})),o.length!==s.length)return n.push({name:"StepFallback",value:"No. of steps in BPF stage don't match no. of cells in corresponding tab"},{name:"BPFStageStepCount",value:o.length},{name:"TabCellCount",value:s.length}),!1;for(var c=0;c<o.length;c++)if(s.indexOf(o[c].stepId.guid.toLowerCase())<0)return n.push({name:"StepFallback",value:"BPF stage stepId does not match corresponding tab's cellId"},{name:"MissingBPFStepId",value:o[c].stepId.guid.toLowerCase()}),!1;return!0}}return!1},t.prototype._retrieveStepLabel=function(t,e,n){if(!Object(v.a)(e)&&!Object(v.a)(e.label)&&""!==e.label)return e.label;if(!Object(v.a)(t.Label)&&""!==t.Label)return t.Label;if(!Object(v.a)(n)&&n.length>0)for(var a=0,i=n;a<i.length;a++){var o=i[a];if(o.stepId.guid===new r.a(t.ParentCellId).guid&&!Object(v.a)(o.label)&&""!==o.label)return o.label}return""},t.prototype._retrieveControlName=function(t,e){if(!Object(v.a)(e)&&e.length>0)for(var n=0,a=e;n<a.length;n++){var i=a[n];if(i.stepId.guid===new r.a(t.ParentCellId).guid&&!Object(v.b)(i.controlName))return i.controlName}return Object(v.a)(t.DataFieldName)||""===t.DataFieldName?"":"header_process_"+t.DataFieldName},t.prototype._getConfig=function(t,e,n,a,r){try{var i=Object(g.h)(),o=t&&t.Id,s=e.getCurrentFormEntity();r.push({name:"ControlDescriptorName",value:n&&n.Name});var c=i(this._getState(),n,a,o,s&&s.name,!1);return r.push({name:"CCFControlConfigID",value:c&&c.CustomControlId},{name:"CCFControlConfigName",value:c&&c.Name},{name:"CCFControlConfigParams",value:c&&c.Parameters&&Object.keys(c.Parameters).join(",")}),c}catch(t){r.push({name:"CCFControlConfigError",value:t})}return null},t.prototype._getStageStatus=function(t,e,n){return null==e||t<e?a.Completed:t===e?n.getStatus()===i.a.Finished?a.Completed:a.Active:a.Inactive},t.prototype._getSteps=function(t,e,n){var a=[];if(!t.stage||!t.stage.steps||0===t.stage.steps.length)return null;for(var r=0,i=t.stage.steps;r<i.length;r++){var o=i[r],c=this._getUIControl(e,o.controlName),u=null;if(o.name&&o.stepType&&"field"===o.stepType.toLowerCase()){if(!(u=this._getMetadataTypeByAttribute(t.entityLogicalName,o.name)))continue;if(Object(_.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){var l=this._context.TraceManager.getTracer("BpfCustomControlSupport"),d=Object(s.a)(this._getState(),n.getProcessId(),l);if(!Object(v.a)(d)&&!Object(v.a)(d.ControlConfigurations)&&n.isBpfFormDescriptorValid(this._getState(),n.getProcessId(),d,l)){var p=Object(s.b)(d,l),h=this._getNonDefaultControlStepIds(p);if(!Object(v.a)(h)&&h.map((function(t){return t.guid})).indexOf(o.stepId.guid)>=0)continue}}}var f=this._getState(),m={attributeName:o.name,controlName:o.controlName,isRequired:o.required,isVisible:!c||c.visible,name:c?c.label:o.label,stepId:o.stepId,stepType:o.stepType,attributeType:u,viewId:c&&c.parameters&&c.parameters.defaultviewid?c.parameters.defaultviewid:o.viewId,isControlDisabled:Object(g.t)(f,{id:e,controlName:o.controlName},n.getContextToken())};m.viewId&&c&&c.customFilter&&c.customFilter&&c.customFilter.length>0&&this._applyLookupFilter(m,c),a.push(m)}return a},t.prototype._applyLookupFilter=function(t,e){var n;n=!1;var a=[];if(t&&e){for(var r=0;r<e.customFilter.length;r++){if("END_FLAG"===e.customFilter[r].customFilter){n=!0;break}if("START_FLAG"!==e.customFilter[r].customFilter){var i=Object(u.i)(Object(P.CrmHtmlDecode)(e.customFilter[r].customFilter));i&&(i.conditions&&i.conditions.length>0||i.filters&&i.filters.length>0)&&a.push(JSON.stringify(i))}}n?(this._memorizedExtraFilters=a,t.extraFilters=this._memorizedExtraFilters):t.extraFilters=this._memorizedExtraFilters?this._memorizedExtraFilters:[]}},t.prototype._getMetadataTypeByAttribute=function(t,e){var n=this._getState(),a=Object(d.a)(n,t,e);if(!a)return null;var r=a.Type+"."+a.Format;return Object(l.n)(r)},t.prototype._getActions=function(t){return{completeProcess:function(){return t.completeProcess()},moveNext:function(){return t.moveToNextStage()},movePrevious:function(){return t.moveToPreviousStage()},setActiveStage:function(e){return t.setActiveStage(e.guid)},setSelectedStage:function(e,n){void 0===n&&(n=!1),t.setSelectedStage(e?e.guid:null,n)},triggerActionStepClick:function(e){t.triggerActionStepClick(e)},triggerFlowStepClick:function(e,n){t.triggerFlowStepClick(e,n)},refreshFlowStepClick:function(e){t.refreshFlowStepClick(e)},setDisplayState:function(e){t.setDisplayState(e)},getForwardNavigationEntities:function(e,n,a,r){return t.getForwardNavigationEntities(e,n,a,r)},navigateToNextEntity:function(e,n,a,r){return t.navigateToNextEntity(c.a.fromLegacyEntityReference(e),c.a.fromLegacyEntityReference(n),a,r)},executePreEvent:function(e,n,a,r){return t.executePreEvent(e,n,a,r)},validateRequiredFieldsForNavigation:function(){return t.ValidateRequiredFieldsForNavigation()},waitForOngoingWork:function(){return t.waitForOngoingWork()},getActiveStageActiveFor:function(){return t.getActiveStageActiveFor()},getBpfInstanceActiveFor:function(){return t.getBpfInstanceActiveFor()},getBpfInstanceCompletedIn:function(){return t.getBpfInstanceCompletedIn()},getBpfNavigationBehavior:function(){return t.getBpfNavigationBehavior()},setBpfNavigationBehavior:function(e){t.setBpfNavigationBehavior(e)},getBpfNavigationBehaviorAllowCreateNew:function(e){return t.getBpfNavigationBehaviorAllowCreateNew(e)},getActiveStage:function(){var e=t.getContextToken(),n=t.getScriptContainer().getEventManager().getClientApiForm(e);return n?n.data.process.getActiveStage():null}}},t.prototype._getRelatedEntityReference=function(t){if(!this._navigationEntities)return null;var e=this._navigationEntities.find((function(e){return e.entityLogicalName===t}));return e?new y.a(e.entityLogicalName,r.a.toLegacyGuid(r.a.parse(e.id))):null},t.prototype._getUIControl=function(t,e){if(e){var n=this._getState(),a=Object(h.j)(n,t),r={controlName:e,id:t};return Object(g.Mc)(this._getState(),r,a)}return null},t.prototype._getNonDefaultControlConfiguration=function(t){var e={};if(t)for(var n=Object.keys(t),a=0;a<n.length;a++){var r,i=Object(m.b)(this._getState());(r=t[n[a]].CustomControls[i])&&(e[n[a]]={FormFactor:r.FormFactor,CustomControlId:r.CustomControlId,Name:r.Name,Version:r.Version,Parameters:r.Parameters,ShouldOverrideControlVisible:r.ShouldOverrideControlVisible,DisplayNameKey:r.DisplayNameKey})}return e},t.prototype._getNonDefaultControlStepIds=function(t){var e=[];return t&&Object.keys(t).forEach((function(n){t[n].ParentCellId&&e.push(new r.a(t[n].ParentCellId))})),e},t.prototype._getIsStepRequired=function(t,e){var n=e.stage.steps,a=n?n.map((function(t){return t.stepId.guid})).indexOf(t):-1;return a>=0&&!Object(v.a)(n[a].required)&&n[a].required},t.prototype._getStepTypeFromControlKey=function(t){return t.endsWith("_actionstep")?"action":t.endsWith("_flowstep")?"modernflow":"field"},t}()},DkMl:function(t,e,n){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a;n.r(e),n.d(e,"UCISyncMessageType",(function(){return v})),n.d(e,"PreviewSync",(function(){return y})),function(t){t[t.SyncMessageRequest=0]="SyncMessageRequest",t[t.SyncMessageResponse=1]="SyncMessageResponse",t[t.HandshakeRequest=2]="HandshakeRequest",t[t.HandshakeAck=3]="HandshakeAck"}(a||(a={}));var r=function(){function t(t,e,n,r,i){var o=this;this._outboundMessageHandlers={},this._targetDomain=e,this._channelId=t,this._targetWindow=r,this._displayName=n,this._logger=i,this.Ready=new Promise((function(t,e){o._onReady={resolve:t,reject:e}})),this._outboundMessageId=1,window.addEventListener("message",(function(t){if(o._validateMessageOrigin(t)&&t.data&&void 0!==t.data.messageType&&t.data.messageType in a){var e=t.data;switch(o._logInfo(o._displayName,"received message of type"+e.messageType+", message id is"+e.messageId),e.messageType){case a.HandshakeRequest:if(e.messageData&&e.messageData.channelId===o._channelId){o._targetWindow=t.source;var r=o._createMessage({channelId:o._channelId},a.HandshakeAck);r.sourceId=e.messageId,o._logInfo(o._displayName,"Sending handshake ack"),o._send(r),o._onReady.resolve("")}break;case a.HandshakeAck:e.messageData&&e.messageData.channelId===o._channelId&&e.sourceId&&o._outboundMessageHandlers[e.sourceId]&&(o._outboundMessageHandlers[e.sourceId].resolve(e.messageData),o._onReady.resolve(""));break;case a.SyncMessageRequest:o._messageHandler.call({},e.messageData).then((function(t){var n=o._createMessage(t,a.SyncMessageResponse);n.sourceId=e.messageId,o._logInfo(o._displayName,"Sending response"+n.messageId),o._send(n)}));break;case a.SyncMessageResponse:e.sourceId&&o._outboundMessageHandlers[e.sourceId]&&(o._logInfo(o._displayName,"Received response"+e.messageData),o._outboundMessageHandlers[e.sourceId].resolve(e.messageData),delete o._outboundMessageHandlers[e.sourceId]);break;default:throw o._logger.info.apply(void 0,["Channel:"+n+" => "+e]),"Unsupported message type"}}})),r&&this._handshake()}return t.prototype._logInfo=function(t,e){this._logger&&this._logger.info&&this._logger.info.apply(void 0,["Channel:"+t+" => "+e])},t.prototype._logError=function(t,e){this._logger&&this._logger.error&&this._logger.error.apply(void 0,["Channel:"+t+" => "+e])},t.prototype.send=function(t){var e=this;return this.Ready.then((function(){var n=e._createMessage(t,a.SyncMessageRequest),r=new Promise((function(t,a){e._outboundMessageHandlers[n.messageId]={resolve:t,reject:a}}));return e._logInfo(e._displayName,"sending message Id "+n.messageId+"of type "+n.messageType),e._send(n),r}))},t.prototype.onReceive=function(t){this._messageHandler=t},t.prototype._validateMessageOrigin=function(t){return"*"===this._targetDomain||t.origin===this._targetDomain},t.prototype._handshake=function(){var t=this,e={channelId:this._channelId},n=this._createMessage(e,a.HandshakeRequest),r=new Promise((function(e,a){t._outboundMessageHandlers[n.messageId]={resolve:e,reject:a}}));return this._send(n),r},t.prototype._createMessage=function(t,e){return{messageId:this._outboundMessageId++,messageType:e,messageData:t}},t.prototype._send=function(t){if(!this._targetWindow)throw this._logError(this._displayName,"The channel lost the target window"),"The channel lost the target window";this._targetWindow.postMessage(t,this._targetDomain)},t}(),i=n("84Pd"),o=n("HSdq"),s=n("Xlzu"),c=n("zVkW"),u=n("oj0s"),l=n("9r0m"),d=n("Sscr"),p=n("oUmu"),g=n("yZTI"),h=n("sOTk");function f(t){return{type:"preview.metadata.update",execute:function(e,n,a){var r=e.dispatch,f=e.getState,v=n.TraceManager.getTracer(Object(o.S)(!1,"preview.metadata.update"));if(v.info("Updating form preview metadata"),t){var _=Object(i.g)([t],i.b.Form,f(),void 0,void 0,void 0,void 0),m=void 0;if(_&&_.forms)for(var b in _.forms){m=b;break}v.info("serializeFormDescriptors done. ");var y=new l.a(m),P="0";switch(t.FormType){case 2:P=Object(g.c)(f());break;case 9:P=Object(g.b)(f());break;default:P="0"}var S=Object(h.g)(f(),P).entityTypeName;return function(t,e,n,a,r,i,o){t.info("Loading custom control manifests for new added custom control.");var s=Object(u.b)(e,n,a,r,i,o);return Promise.all(s).then((function(){return t.info("Custom control manifests loading done for new added custom control."),Promise.resolve()})).catch((function(e){var n="Loading manifests for new added custom control failed.";return t.error(n,e),Promise.reject(n)}))}(v,f(),r,_.forms[t.FormId],S,n,a).then((function(){var t;r((t=_,{type:s.a,payload:t})),r(Object(c.a)(y)).then((function(){var t=Object(d.j)(f(),P);return r(Object(p.b)(y,P,t)).then((function(){}))}))}))}v.error("No descriptor to update")}}}var v,_=n("L6jw"),m=n("LWFb"),b=n("KT6S");!function(t){t[t.UCISyncMessage=0]="UCISyncMessage"}(v||(v={}));var y=function(){function t(t,e){var n=this;this._store=t,this._tracer=e,this._domElementCache={},setInterval((function(){n._domElementCache={}}),18e5),this._debouncedSendDimensions=this._debounce(this.SendDimensions,this,100)}return t.prototype.initializeChannel=function(t){var e=this;if(this._tracer.info("PreviewSync: Initializing sync channel with id"+t),!this._previewChannel||this._channelId!==t){var n={info:function(t){e._tracer.info.apply(e._tracer,[t])},error:function(t){e._tracer.error.apply(e._tracer,[t])}};return this._previewChannel=new r(t,"*","UCI_Sync",window.parent,n),this._previewChannel.onReceive(this.HandleRequest.bind(this)),this.RegisterMutationObserver(),this._previewChannel}},t.prototype.HandleRequest=function(t){var e=this;return new Promise((function(n,a){if(t&&t.type===v.UCISyncMessage&&t.actionName)switch(e._tracer.info("PreviewSync: Received request with action name: "+t.actionName),t.actionName){case"GetDimensions":n(e.GetDimensions());break;case"ScrollUpdated":e._updateScrollPosition(t.actionData),n({actionName:t.actionName,actionData:{},success:!0,type:v.UCISyncMessage}),e._debouncedSendDimensions(),n(void 0);break;case"ElementClicked":e._handleElementClick(t.actionData),n({actionName:t.actionName,actionData:{},success:!0,type:v.UCISyncMessage});break;case"FormMetadataUpdated":e._store&&(t.actionData.consistencyStrong?(e._store.dispatch(Object(_.b)(!0)),e._store.dispatch(Object(b.a)()).then((function(){e._store.dispatch(Object(_.b)(!0)),e._store.dispatch(f(t.actionData.formDescriptor)),n({actionName:t.actionName,actionData:{},success:!0,type:v.UCISyncMessage})}))):(e._store.dispatch(f(t.actionData)),n({actionName:t.actionName,actionData:{},success:!0,type:v.UCISyncMessage})));break;default:e._tracer.error("PreviewSync: Received request with unsupported action "),n(void 0)}else n(void 0)}))},t.prototype.GetDimensions=function(){this._tracer.info("PreviewSync: Getting Dimensions ");var t={},e=document.documentElement.scrollLeft,n=document.documentElement.scrollTop,a=document.querySelectorAll("[data-"+m.b);if(a&&a.length)for(var r=0;r<a.length;r++){var i=a[r],o=void 0,s=void 0,c=void 0;if(i){var u=i.attributes.getNamedItem("data-"+m.c),l=i.attributes.getNamedItem("data-"+m.b),d=i.attributes.getNamedItem("role");if(l&&(o=l.value,s=u?parseInt(u.value,10):1,c=d?d.value:"none"),o){o=o.replace(m.a,"");var p=i.getBoundingClientRect(),g={top:p.top+n,left:p.left+e,height:p.bottom-p.top,width:p.right-p.left,scrollTop:0,scrollLeft:0,scrollHeight:0,scrollWidth:0,zIndex:s,role:c};if(i.scrollHeight>g.height||i.scrollWidth>g.width){var h=window.getComputedStyle(i),f=h.getPropertyValue("overflow-x"),_=h.getPropertyValue("overflow-y");"hidden"!==f&&(g.scrollLeft=i.scrollLeft,g.scrollWidth=i.scrollWidth),"hidden"!==_&&(g.scrollTop=i.scrollTop,g.scrollHeight=i.scrollHeight)}var b=o.indexOf(m.d);if(b>0){var y=o.substring(0,b-1);t[y]||(t[y]={});var P={id:o,dimensions:g};t[y].subIds?t[y].subIds.push(P):t[y].subIds=[P]}else t[o]||(t[o]={}),t[o].dimensions=g}}}return{actionName:"DimensionsUpdated",actionData:t,type:v.UCISyncMessage}},t.prototype.RegisterMutationObserver=function(){var t=this;this._previewChannel.Ready.then((function(){var e=document;new MutationObserver(t._debouncedSendDimensions).observe(e,{attributes:!0,childList:!0,subtree:!0})}))},t.prototype.SendDimensions=function(){this._previewChannel.send(this.GetDimensions())},t.prototype._updateScrollPosition=function(e){var n=t._isNumber(e.scrollLeft),a=t._isNumber(e.scrollTop);if(e&&e.id&&(n||a)){var r=this._findDOMElement(e.id);r&&(n&&(r.scrollLeft=e.scrollLeft),a&&(r.scrollTop=e.scrollTop))}},t._isNumber=function(t){return!isNaN(parseFloat(t))},t.prototype._handleElementClick=function(t){var e=this._findDOMElement(t.id);e&&e.click()},t.prototype._findDOMElement=function(t){var e=this._domElementCache[t];if(e&&e.clientWidth)return e;var n=""+m.a+t,a=document.querySelector("#"+n+", [data-"+m.b+"="+n+"]");return this._domElementCache[t]=a,a},t.prototype._debounce=function(t,e,n){var a;return function(){var r=e,i=arguments,o=function(){a=null,t.apply(r,i)};clearTimeout(a),a=setTimeout(o,n)}},t}()},Jcuz:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("5fD4");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function r(t,e){var n={displayState:t};return{type:a.c,payload:n}}},Kdvm:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("9r0m"),r=function(){function t(){}return t.prototype.generate=function(t,e){return e&&e.getProcessId()?{businessProcessFlowInstanceId:e.getProcessInstanceId(),activeStageId:a.a.tryParseOrNull(e.getActiveStageId()),displayState:e.getDisplayState(),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),isVisible:e.isVisible(),data:{activePath:e.getActivePath(),selectedStageId:a.a.tryParseOrNull(e.getSelectedStageId()),businessProcessFlowId:e.getProcessId(),actionLogCollection:e.getActionLogCollection(),processNavigationBehavior:{navigationBehavior:e.getBpfNavigationBehavior()}}}:null},t}();
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */},LdMy:function(t,e,n){"use strict";n.d(e,"a",(function(){return C}));var a=n("90Ov"),r=n("WS0f"),i=function(){function t(){}return Object.defineProperty(t.prototype,"invocationSource",{get:function(){return this._invocationSource},set:function(t){this._invocationSource=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"workflowStep",{get:function(){return this._workflowStep},set:function(t){this._workflowStep=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"businessProcessFlowVisitor",{get:function(){return this._businessProcessFlowVisitor},set:function(t){this._businessProcessFlowVisitor=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentEntityName",{get:function(){return this._currentEntityName},set:function(t){this._currentEntityName=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"processManager",{get:function(){return this._processManager},set:function(t){this._processManager=t},enumerable:!1,configurable:!0}),t.prototype.getStageStep=function(t){if(Object(r.b)(t)||!this._businessProcessFlowVisitor)return null;var e=this._businessProcessFlowVisitor.get_stagesById()[Object(a.a)(t)];return e||null},t}(),o=n("c/eZ"),s=function(t){function e(e){return t.call(this,Object(a.a)(e))||this}return Object(o.__extends)(e,t),e}(function(){function t(t){this.value=t,this._next=null}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!1,configurable:!0}),t.prototype.getNext=function(){return this._next},t.prototype.setNext=function(t){this._next=t},t}()),c=function(){function t(){this._latestDefaultPathCalculated=!1,this._rootNodes=[],this._rootNodesValue=[],this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash()}return t.prototype.find=function(t,e){if(t=Object(a.a)(t),e){for(var n in this._rootNodesValue)if(t===this._rootNodesValue[n])return this._rootNodes[n];return null}for(var n in this._rootNodes){var r=this._rootNodes[n];if(r.value===t)return r;for(;null!=r.getNext();)if((r=r.getNext()).value===t)return r}return null},t.prototype.getNode=function(t){return this._rootNodes[t]},t.prototype.setNode=function(t,e){this._latestDefaultPathCalculated=!1,this._rootNodes[t]=e,this._rootNodesValue[t]=e.value},t.prototype.getDefaultPath=function(){return this._ensureLatestDefaultPathIsCalculated(),this._defaultPathArray},t.prototype.addAfter=function(t,e){this.find(e.value,!0)?this._addAfterInternal(t,new s(null)):this._addAfterInternal(t,e)},t.prototype.getDefaultPathHash=function(){return this._ensureLatestDefaultPathIsCalculated(),this._lastDefaultPathCalculatedTimeHash},t.prototype._ensureLatestDefaultPathIsCalculated=function(){this._latestDefaultPathCalculated||(this._defaultPathArray=this._recaculateDefaultPath(),this._latestDefaultPathCalculated=!0,this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash())},t.prototype._recaculateDefaultPath=function(){this._defaultPathArray=[];for(var t=0;t<this._rootNodes.length;t++){var e=this._rootNodes[t];for(this._defaultPathArray[this._defaultPathArray.length]=e.value;e.getNext();){var n=e.getNext();n.value&&(this._defaultPathArray[this._defaultPathArray.length]=n.value),e=n}}return this._defaultPathArray},t.prototype._addAfterInternal=function(t,e){t.setNext(e),this._latestDefaultPathCalculated=!1},t.prototype._generateDefaultPathCalculatedTimeHash=function(){var t=Math.floor(1e4*Math.random());try{t=crypto.getRandomValues(new Uint32Array(1))[0]}catch(t){}return Date.now().toString()+t},t}(),u=function(){function t(){}return t.prototype.pathChanged=function(t){this._handler&&!Object(r.b)(t.parentStage)&&this._handler.handleChange(t.parentStage,t.nextStage)},t.prototype.getHandler=function(){return this._handler},t.prototype.setHandler=function(t){this._handler=t},t}(),l=function(){function t(t,e){this._nextStage=e,this._parentStage=t}return Object.defineProperty(t.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextStage",{get:function(){return this._nextStage},enumerable:!1,configurable:!0}),t}(),d=function(){function t(t,e,n){this._context=t,this._defaultPath=e,this._staticPath=n}return t.prototype.calculate=function(){for(var t=this._startingNodeInDefaultPath(),e=0;e<this._staticPath.length;e++){var n=this._staticPath[e];if(this._context.businessProcessFlowVisitor.get_stagesById().hasOwnProperty(n)){var a=this._defaultPath.find(n,!0);a?t=a:(this._defaultPath.addAfter(t,new s(n)),t=t.getNext())}}this._lastEvaluatedNode=t},t.prototype.getLastEvaluatedNodeInDefaultPath=function(){return this._lastEvaluatedNode},t.prototype.getDefaultPath=function(){return this._defaultPath},t.prototype._startingNodeInDefaultPath=function(){return this._startNode||(this._startNode=this._defaultPath.getNode(0)),this._startNode},t}(),p=function(){function t(t,e){this._defaultPath=e,this._context=t}return t.prototype.calculate=function(){this._staticPathToDefaultPathCalculator.calculate(),this._defaultPath=this._staticPathToDefaultPathCalculator.getDefaultPath()},t.prototype.getLastDefaultNode=function(){return this._staticPathToDefaultPathCalculator.getLastEvaluatedNodeInDefaultPath()},Object.defineProperty(t.prototype,"traversedPath",{get:function(){return this._traversedPath||(this._traversedPath=[]),this._traversedPath},set:function(t){this._traversedPath=t},enumerable:!1,configurable:!0}),t.prototype.getDefaultPath=function(){return this._defaultPath},Object.defineProperty(t.prototype,"_staticPathToDefaultPathCalculator",{get:function(){return this.__staticPathToDefaultPathCalculator||(this.__staticPathToDefaultPathCalculator=new d(this._context,this._defaultPath,this._traversedPath)),this.__staticPathToDefaultPathCalculator},enumerable:!1,configurable:!0}),t}(),g=function(){function t(t,e){this._context=t,this._defaultPath=e}return t.prototype.calculate=function(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()&&this._calculateForTraveresedStages()},Object.defineProperty(t.prototype,"traversedPath",{get:function(){return this._traversedPath},set:function(t){this._traversedPath=t},enumerable:!1,configurable:!0}),t.prototype.getLastCalculatedDefaultNode=function(){return this._traversedDefaultPathCalculator?this._traversedDefaultPathCalculator.getLastDefaultNode():null},t.prototype.getDefaultPath=function(){return this._defaultPath},t.prototype._calculateForTraveresedStages=function(){this._traversedDefaultPathCalculator.traversedPath=this._traversedPath.split(","),this._traversedDefaultPathCalculator.calculate()},Object.defineProperty(t.prototype,"_traversedDefaultPathCalculator",{get:function(){return this.__traversedDefaultPathCalculator||(this.__traversedDefaultPathCalculator=new p(this._context,this._defaultPath)),this.__traversedDefaultPathCalculator},enumerable:!1,configurable:!0}),t}(),h=function(){function t(t){this.context=t}return Object.defineProperty(t.prototype,"stage",{get:function(){return this._stageStep},set:function(t){this._stageStep=t},enumerable:!1,configurable:!0}),t.prototype.tryExecute=function(){var t=Object(a.a)(this.stage.get_stageId());return!!this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t]&&(this.executeCondition(),!0)},t}(),f=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.__extends)(e,t),e.prototype.executeCondition=function(){var t="bpf_"+this._sanitizeGuidForFunctionName(this.stage.get_stageId());this.context.processManager.callPblToEvaluateBranching(t)},e.prototype._sanitizeGuidForFunctionName=function(t){if(Object(r.b)(t))return t;for(t=Object(a.a)(t);t.indexOf("-")>-1;)t=t.replace("-","");return t},e}(h),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.__extends)(e,t),e.prototype.executeCondition=function(){var t=Object(a.a)(this.stage.get_stageId()),e=this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t];if(e){var n=e.findElseBranch(),r=null;if(n&&n.get_Steps().get_Count()>0)r=n.get_Steps().get_item(0).get_stageId();this._invokeReflowFunction(t,r)}},e.prototype._invokeReflowFunction=function(t,e){this.context.processManager.reflow(!1,t,e)},e}(h),_=function(){function t(){}return t.prototype.getStageCommand=function(t,e){var n=t.businessProcessFlowVisitor.get_parentEntityStepByStageId()[Object(a.a)(e.get_stageId())];return t.currentEntityName!==n.get_EntityLogicalName()?new v(t):new f(t)},t}(),m=function(){function t(t,e,n){this._defaultPath=e,this._cascadeUpdate=n,this._context=t,this._businessRuleCommandFactory=new _}return t.prototype.handleChange=function(t,e){var n=this._defaultPath.find(t,!1);if(null!=n){var a=Object(r.b)(e)?null:e,i=new s(a);this._defaultPath.addAfter(n,i),a&&this.triggerSubsequentDefaultPathCalculation(i)}},t.prototype.triggerSubsequentDefaultPathCalculation=function(t){if(t){var e=t.value;if(e&&!this._tryExecuteConditionForStage(t)){var n=this._context.getStageStep(e).get_nextStageId();if(!n)return;var a=this._defaultPath.find(n,!0);if(a)return void(this._cascadeUpdate&&this.triggerSubsequentDefaultPathCalculation(a));this._defaultPath.addAfter(t,new s(n)),this.triggerSubsequentDefaultPathCalculation(t.getNext())}}},t.prototype._tryExecuteConditionForStage=function(t){var e=this._context.invocationSource;try{this._context.invocationSource="internal";var n=this._context.getStageStep(t.value),a=this._businessRuleCommandFactory.getStageCommand(this._context,n);if(a.stage=n,!a.tryExecute())return!1;if(t.getNext())return!0}finally{this._context.invocationSource=e}return!1},t}(),b=function(){function t(t,e,n){this._context=t,this._listener=e,this._defaultPath=n}return t.prototype.calculate=function(){var t=this._pathChangeHandler;this._listener.setHandler(t),t.triggerSubsequentDefaultPathCalculation(this._startNode)},Object.defineProperty(t.prototype,"startingNodeInDefaultPath",{get:function(){return this._startNode},set:function(t){this._startNode=t},enumerable:!1,configurable:!0}),t.prototype.getDefaultPath=function(){return this._defaultPath},Object.defineProperty(t.prototype,"_pathChangeHandler",{get:function(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!0)),this.__pathChangeHandler},enumerable:!1,configurable:!0}),t}(),y=function(){function t(t,e,n){this._context=t,this._listener=e,this._initialDefaultPath=n}return t.prototype.calculate=function(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()||(this._defaultPath=this._initialDefaultPath),this._calculateForTraversedStages(),this._calculateForNonTraversedStages()},Object.defineProperty(t.prototype,"startingNodeInDefaultPath",{get:function(){return this._startingNodeInDefaultPath},set:function(t){this._startingNodeInDefaultPath=t},enumerable:!1,configurable:!0}),t.prototype.getDefaultPath=function(){return this._defaultPath},t.prototype._calculateForTraversedStages=function(){this._defaultPath=this._initialDefaultPath},t.prototype._calculateForNonTraversedStages=function(){this._nonTraversedDefaultPathCalculator.startingNodeInDefaultPath=this.startingNodeInDefaultPath,this._nonTraversedDefaultPathCalculator.calculate()},Object.defineProperty(t.prototype,"_nonTraversedDefaultPathCalculator",{get:function(){return this.__nonTraversedDefaultPathCalculator||(this.__nonTraversedDefaultPathCalculator=new b(this._context,this._listener,this._defaultPath)),this.__nonTraversedDefaultPathCalculator},enumerable:!1,configurable:!0}),t}(),P=function(){function t(t,e,n){this._context=t,this._changeListener=e,this._defaultPath=n}return t.prototype.calculate=function(){var t=this._pathChangeHandler;this._changeListener.setHandler(t)},t.prototype.getDefaultPath=function(){return this._defaultPath},Object.defineProperty(t.prototype,"_pathChangeHandler",{get:function(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!1)),this.__pathChangeHandler},enumerable:!1,configurable:!0}),t}(),S=n("9r0m"),I=function(){function t(t,e){this._context=e,this._traversedPathProvider=t,this._changeListener=new u,this._initializeDefaultPathFromRootStages()}return t.prototype.initializeComplete=function(){var t=this.defaultPathHash();this._initializeTraversedPath(),this._initializeNonTraversedPath();var e=this._context.processManager.getSelectedStageId(),n=this._context.processManager.getActivePath(),a=!Object(r.a)(e)&&!Object(r.a)(n),i=a&&n.findIndex((function(t){return t.guid.toString()===e}))<0,o=a&&this.getDefaultPath().indexOf(e)>=0;this.getDefaultPath()&&(t!==this.defaultPathHash()||i&&o)&&this._context.processManager.setActivePath(this.getDefaultPath())},t.prototype.updateDefaultPath=function(t,e){if(t){var n=null;if("internal"!==this._context.invocationSource&&(n=this.defaultPathHash()),this._changeListener.pathChanged(new l(t,e)),"internal"!==this._context.invocationSource)if(n!==this.defaultPathHash()){var a=this.getDefaultPath();this._context.processManager.setActivePath(a)}}},t.prototype.triggerSubsequentDefaultPathCalculation=function(t){if(!!S.a.tryParseOrNull(t)&&!!this.getDefaultPath().find((function(e){return e.toLowerCase()===t.toLowerCase()}))){var e=null;if("internal"!==this._context.invocationSource&&(e=this.defaultPathHash()),this._changeListener.getHandler().triggerSubsequentDefaultPathCalculation(new s(t)),"internal"!==this._context.invocationSource)if(e!==this.defaultPathHash()){var n=this.getDefaultPath();this._context.processManager.setActivePath(n)}}},t.prototype.getDefaultPath=function(){return this._defaultPath.getDefaultPath()},t.prototype.defaultPathHash=function(){return this._defaultPath.getDefaultPathHash()},t.prototype.getNextStage=function(t){var e=this.getDefaultPath(),n=e.indexOf(Object(a.a)(t));return-1!==n&&n<e.length-1?e[n+1]:null},t.prototype.getPreviousStage=function(t){var e=this.getDefaultPath(),n=e.indexOf(Object(a.a)(t));return n<=0?null:e[n-1]},t.prototype._initializeDefaultPathFromRootStages=function(){this._defaultPath=new c;var t=this._context.businessProcessFlowVisitor.get_firstLevelStages(),e=0;for(var n in t)this._defaultPath.setNode(e,new s(n)),e++},t.prototype._initializeTraversedPath=function(){this._loadTimeDefaultPathCalculator.traversedPath=this._traversedPathProvider.getTraversedPath(),this._loadTimeDefaultPathCalculator.calculate(),this._defaultPath=this._loadTimeDefaultPathCalculator.getDefaultPath()},t.prototype._initializeNonTraversedPath=function(){this._afterLoadPathCalculator.startingNodeInDefaultPath=this._loadTimeDefaultPathCalculator.getLastCalculatedDefaultNode(),this._afterLoadPathCalculator.calculate(),this._defaultPath=this._afterLoadPathCalculator.getDefaultPath(),this._runTimePathCalculator.calculate()},Object.defineProperty(t.prototype,"_loadTimeDefaultPathCalculator",{get:function(){return this._loadTimePathCalculator||(this._loadTimePathCalculator=new g(this._context,this._defaultPath)),this._loadTimePathCalculator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_afterLoadPathCalculator",{get:function(){return this.__afterLoadPathCalculator||(this.__afterLoadPathCalculator=new y(this._context,this._changeListener,this._defaultPath)),this.__afterLoadPathCalculator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_runTimePathCalculator",{get:function(){return this.__runTimePathCalculator||(this.__runTimePathCalculator=new P(this._context,this._changeListener,this._defaultPath)),this.__runTimePathCalculator},enumerable:!1,configurable:!0}),t}(),O=n("HSdq"),C=function(){function t(){}return t.prototype.setPrimaryModel=function(t){this._primaryModelName=t},t.prototype.getDefaultPathManager=function(){return this._defaultPathManager},t.prototype.setObjectModel=function(t){var e=this,n=new Microsoft.Crm.Workflow.ObjectModel.WorkflowStep("",0),a={};t.businessProcessFlowEntities.forEach((function(t){if(e._isRelationshipStep(t)){var r=e._createRelationshipCollectionStep(n,t);r&&n.appendStep(r)}else{var i=e._createEntity(n,t);i&&(n.appendStep(i),a.hasOwnProperty(i.get_EntityLogicalName())||(a[i.get_EntityLogicalName()]=!0))}})),n.set_Name(t.businessProcessFlowName),n.set_Id(t.businessProcessFlowId?t.businessProcessFlowId.guid:""),this._processObjectModel=n,this._initializeVisitor()},t.prototype.initializeDefaultPathManager=function(t,e){var n=new i;n.processManager=e,n.businessProcessFlowVisitor=this._businessProcessFlowVisitor,n.workflowStep=this._processObjectModel,n.currentEntityName=this._primaryModelName,this._defaultPathManager=new I(t,n),this._defaultPathManager.initializeComplete()},Object.defineProperty(t.prototype,"businessProcessFlowVisitor",{get:function(){return this._businessProcessFlowVisitor},enumerable:!1,configurable:!0}),t.prototype.getEntityStages=function(){if(!this._processObjectModel)return null;var t=this._processObjectModel.get_Steps(),e=[];if(t){for(var n=0;n<t.get_Count();n++){var a=t.get_item(n);a&&a instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep&&(e[e.length]=t.get_item(n))}return e}return null},t.prototype.getRequiredFlowStepsForStage=function(t,e,n,a){var r=[],i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");var o=i.get_Steps();if(!o)throw new Error(t+" does not include valid steps");for(var s=0;s<o.get_Count();s++)if(o.get_item(s)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){var c=o.get_item(s);this._isFlowStep(c)&&c.get_isProcessRequired()&&r.push(c.get_Id())}return r},t.prototype.getRequiredAttributesForStage=function(t,e,n,a){var r=[],i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");var o=i.get_Steps();if(!o)throw new Error(t+" does not include valid steps");for(var s=0;s<o.get_Count();s++)if(o.get_item(s)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){var c=o.get_item(s);if(!this._isActionStep(c)&&!this._isFlowStep(c))if(c.get_isProcessRequired())r.push(c.get_Description());else{var u=this._getDataFieldNameFromStepStep(c);u&&this._isRequiredAttribute(u,e,n,a)&&r.push(c.get_Description())}}return r},t.prototype._getDataFieldNameFromStepStep=function(t){if(this._isActionStep(t)||this._isFlowStep(t))return null;if(this._isControlStep(t)){var e=t.get_Steps().get_item(0);return!e||e.get_isSystemControl()?null:e.get_dataFieldName()}return null},t.prototype._isRequiredAttribute=function(t,e,n,a){return null!=t&&2===Object(O.pc)(a,e,n,t)},t.prototype._isFlowStep=function(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0&&t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.FlowStep)return!0;return!1},t.prototype._isActionStep=function(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0&&t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ActionStep)return!0;return!1},t.prototype._isControlStep=function(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0&&t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ControlStep)return!0;return!1},t.prototype._initializeVisitor=function(){this._businessProcessFlowVisitor=new ProcessObjectModel.Visitors.BusinessProcessFlowVisitor,this._businessProcessFlowVisitor.visit(this._processObjectModel)},t.prototype._isRelationshipStep=function(t){return!(!t||!t.hasOwnProperty("relationships"))},t.prototype._createEntity=function(t,e){var n=new Microsoft.Crm.Workflow.ObjectModel.EntityStep(t,e.entityLogicalName);n.set_Name(e.entityLogicalName),n.set_Description(e.entityDisplayName),n.set_relationshipName(e.relationshipName),n.set_attributeName(e.referencingAttributeName),n.set_parent(t);var a=this._createStage(t,e.stage);n&&a&&n.appendStep(a);for(var r=0;r<e.stage.steps.length;r++){var i=this._createStep(t,e.stage.steps[r]);i&&a.appendStep(i)}var o=this._createConditionStep(t,a,e.stage);return o&&a.appendStep(o),n},t.prototype._createRelationshipCollectionStep=function(t,e){var n=new Microsoft.Crm.Workflow.ObjectModel.RelationshipCollectionStep(t);if(n.set_workflow(t),e.relationships)for(var a=0;a<e.relationships.length;a++){var r=this._createRelationshipStep(t,e.relationships[a]);n.appendStep(r)}return n},t.prototype._createRelationshipStep=function(t,e){var n=new Microsoft.Crm.Workflow.ObjectModel.RelationshipStep(t);return n.set_workflow(t),n.set_sourceStageId(e.sourceStageId.guid),n.set_targetStageId(e.targetStageId.guid),n.set_attributeName(e.attributeName),n.set_relationshipName(e.relationshipName),n},t.prototype._createStage=function(t,e){var n=new Microsoft.Crm.Workflow.ObjectModel.StageStep(t,e.stageDisplayName||"dummy");return n.set_Id(e.stageId.guid),n.set_stageId(e.stageId.guid),n.set_nextStageId(e.nextStageId?e.nextStageId.guid:""),n.set_stageCategory(e.stageCategory),n},t.prototype._createStep=function(t,e){var n="action"===e.stepType.toLowerCase()?e.label:e.name,a=new Microsoft.Crm.Workflow.ObjectModel.StepStep(t,n||"dummy");a.set_isProcessRequired(e.required),a.set_Name(e.label),a.set_Id(e.stepId?e.stepId.guid:""),a.set_workflow(t);var r=new Microsoft.Crm.Workflow.ObjectModel.ControlStep(t);if(r.set_dataFieldName(n),"action"===e.stepType.toLowerCase()){var i=new Microsoft.Crm.Workflow.ObjectModel.ActionStep(t);i.set_Name(n),i.set_actionControl(r),a.appendStep(i)}else if("modernflow"===e.stepType.toLowerCase()){var o=new Microsoft.Crm.Workflow.ObjectModel.FlowStep(t);o.set_Name(n),o.set_flowControl(r),a.appendStep(o)}else a.appendStep(r);return a},t.prototype._createConditionStep=function(t,e,n){if(!n.conditionJson)return null;var a=new Microsoft.Crm.Workflow.ObjectModel.ConditionStep(t);return a.set_parent(e),a.initializeFromDynamic(JSON.parse(n.conditionJson)),a.fixLinks(),a},t.prototype.getProcessObjectModel=function(){return this._processObjectModel},t.prototype.getStage=function(t){return Object(r.a)(t)||!this._processObjectModel?null:this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(t)?this._businessProcessFlowVisitor.get_stagesById()[t]:null},t.prototype.getPreviousStageId=function(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){var e=this._defaultPathManager.getPreviousStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null},t.prototype.getNextStageId=function(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){var e=this._defaultPathManager.getNextStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null},t}()},LhJP:function(t,e,n){"use strict";n.d(e,"h",(function(){return a})),n.d(e,"i",(function(){return r})),n.d(e,"o",(function(){return i})),n.d(e,"a",(function(){return o})),n.d(e,"j",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"f",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"b",(function(){return g})),n.d(e,"d",(function(){return h})),n.d(e,"k",(function(){return f})),n.d(e,"l",(function(){return v})),n.d(e,"e",(function(){return _})),n.d(e,"q",(function(){return m})),n.d(e,"p",(function(){return b})),n.d(e,"m",(function(){return d})),n.d(e,"n",(function(){return p}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a="BusinessProcessFlow.MoveToNextStage",r="BusinessProcessFlow.MoveToPreviousStage",i="BusinessProcessFlow.SetActiveStage",o="BusinessProcessFlow.AbandonProcess",s="BusinessProcessFlow.ReactivateProcess",c="BusinessProcessFlow.CompleteProcess",u="BusinessProcessFlow.InitilaizeWithFormEntityOnly",l="BusinessProcessFlow.InitilaizeWithProcessAndFormEntity",d="BusinessProcessFlow.SetActiveProcess",p="BusinessProcessFlow.SetActiveProcessInstance",g="BusinessProcessFlow.ActionStep",h="BusinessProcessFlow.FlowStepWidget",f="BusinessProcessFlow.RefreshFlowStep",v="BusinessProcessFlow.RenderProcessControl",_="BusinessProcessFlow.HideProcessControlForUciOffline",m="SaveFailureReason",b="faultedSnapshotId"},Qeyq:function(t,e,n){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function a(){return{tabId:"",navigationStack:[]}}n.d(e,"a",(function(){return a}))},UVKb:function(t,e,n){"use strict";n.d(e,"a",(function(){return h}));var a,r=n("qC0c"),i=n("lFQy"),o=n("t8f4"),s=n("Y70o"),c=n("WS0f"),u="ProcessControl_ActionExecuter_ExecutionTimeTooltip",l="ProcessControl_ActionExecuter_ErrorMessageTooltip",d="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources";function p(t){switch(t){case a.InProgress:case a.Waiting:return 1;case a.Succeeded:return 2;case a.Failed:case a.Canceled:return 3;default:return 0}}function g(t,e,n,r){var i="";if(Object(c.b)(t)||(i=String.format(r[u],new Date(t).toLocaleString())),n===a.Failed){var o=Object(c.b)(e)?r.Crm_GenericErrorMessage:e;i+="\n"+String.format(r[l],o)}return""===i?e:i}function h(t,e){return{type:"businessProcessFlow.actionLogs.retrieve",execute:function(n,a){var c=n.dispatch,h=n.getState,f=String.format("?$select=workflowlogid,message,status,modifiedon,stepname,activityname,_asyncoperationid_value&$filter=activityname%20eq%20'{0}'%20and%20_asyncoperationid_value%20eq%20{1}&$orderby=modifiedon%20desc&$top=500",t.guid,e.id.guid),v=h();if(function(t){return Object(r.b)(t,"BpfActionSupportActionQuerying")}(v))return c(Object(o.e)("workflowlog",f)).then((function(t){if(t.value&&t.value.length){var n={};n[u]=Object(s.a)(v,d,u),n[l]=Object(s.a)(v,d,l),n.Crm_GenericErrorMessage=Object(s.a)(v,d,"Crm_GenericErrorMessage");var a={};t.value.forEach((function(t){if(t.stepname&&-1===Object.keys(a).indexOf(t.stepname)){var e={actionLogId:t.workflowlogid,status:p(t.status),modifiedOn:t.modifiedon,stepId:t.stepname,processDefinitionid:t.activityname,processInstanceid:t._asyncoperationid_value,message:g(t.modifiedon,t.message,t.status,n)};a[t.stepname]=e}}));var r={actionLogCollection:a};return c(Object(i.a)(r,e))}}))}}}!function(t){t[t.InProgress=1]="InProgress",t[t.Succeeded=2]="Succeeded",t[t.Failed=3]="Failed",t[t.Canceled=4]="Canceled",t[t.Waiting=5]="Waiting"}(a||(a={}))},lFQy:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n("9r0m"),r=n("5fD4");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function i(t,e){var n,i={dataById:(n={},n[a.a.toString(e.id)]=t,n)};return{type:r.a,payload:i}}},"n+eO":function(t,e,n){"use strict";n.d(e,"a",(function(){return N}));var a=n("r0tX"),r=n("9r0m"),i=n("WS0f"),o=n("9rlF"),s=n("nbQV"),c=n("TCcM"),u=n("T576"),l=n("QAhb"),d=n("A/RO"),p=n("Kdvm"),g=n("4HtA"),h=n("r3Bs"),f=n("LdMy"),v=n("sOTk"),_=n("mLFd"),m=n("G7N+"),b=n("ed60"),y=n("uwKl"),P=n("DUDQ"),S=n("lFQy"),I=n("gk6Q"),O=n("HSdq"),C=n("pflg"),w=n("b1hT"),F=n("lMVv"),j=n("2ojE"),E=n("LhJP"),N=function(){function t(){}return Object.defineProperty(t,"Instance",{get:function(){return t._instance||(t._instance=new t,Object(I.c)(t._instance)),t._instance},enumerable:!1,configurable:!0}),t.prototype.init=function(t,e,a){var r=this;return this._getState&&this._businessProcessPerPageWrapper?Promise.resolve():(this._applicationContext=t,this._reloadDataCount=0,this._getState=e,this._dispatch=a,this._processManager=new g.a(t,e,a,new f.a,new h.a),this._businessProcessFlowWrapperIdentifierFactory=new p.a,this._businessProcessFlowWrapperFactory=new d.a(e,this._businessProcessFlowWrapperIdentifierFactory,t),n.e(49).then(n.bind(null,"pG8E")).then((function(t){var e=t.BusinessProcessPageWrapper;return r._businessProcessPerPageWrapper=new e(r._applicationContext,r._getState,r._dispatch),Promise.resolve()})))},t.prototype.getBusinessProcessFlowWrapper=function(t,e){return Object(w.f)(this._getState())?this._businessProcessPerPageWrapper.getBusinessProcessFlowWrapper(t,e):(this._reloadDataIfRequired(t,e),this._businessProcessFlowWrapperFactory.generate(t,this._processManager))},t.prototype.getProcessManager=function(t,e){return Object(w.f)(this._getState())?this._businessProcessPerPageWrapper.getProcessManager(t,e):(this._reloadDataIfRequired(t,e),this._processManager)},t.prototype.getCurrentProcessManagerWithoutInit=function(t){if(!Object(w.f)(this._getState()))return this._processManager;if(this._businessProcessPerPageWrapper)return this._businessProcessPerPageWrapper.getCurrentProcessManagerWithoutInit(t);var e=Object(v.g)(this._getState(),t),n=e&&e.entityTypeName?new l.a(e.entityTypeName,e.id):null,a=this._applicationContext.TraceManager.getTracer("BusinessProcessWrapperManager.GetProcessManagerWithoutinit"),r=Object(j.a)(this._getState(),n,t,this._applicationContext);return a.warn("BusinessProcessWrapperManager: BusinessProcessPerPageWrapper is not initialized",r),null},t.prototype.hasChanged=function(t,e,n,a){if(!Object(w.f)(this._getState())){if(Object(w.g)(t)&&(!Object(w.d)(t)||Object(w.c)(t,a)))return!0;if(!e)return!1;var r=new l.a(e.entityTypeName,e.id),o=Object(u.f)(t,r);return!Object(i.a)(o)&&(!n||o>n.instanceModifiedTimestamp)||this._needsDockedModeRefresh(n,e)}return this._businessProcessPerPageWrapper.hasChanged(t,e,n,a)},t.prototype._needsDockedModeRefresh=function(t,e){return this._processManager.getDisplayState()===a.a.expanded&&t.isFormInactive!==Object(O.Lb)(this._getState(),e.entityTypeName,e.id)},t.prototype._reloadData=function(t,e){var n=this,a=this._getState();this._pageId=t,this._pageInfo=e;var d=Object(v.g)(a,t);if(d){var p=d.id,g=new l.a(d.entityTypeName,p);if(this._processIdInState=Object(c.e)(a,g),Object(w.g)(a)&&(!Object(w.d)(a)||Object(w.c)(a,t))){var h=this._processManager.getTelemetryParams();return this._processManager.isVisible()&&this._processManager.setVisible(!1),this._processManager.initilaizeWithFormEntityOnly(g,t),void Object(j.c)(E.e,h,this._applicationContext)}var f=Object(C.a)(d),_=Object(C.b)(d);if(r.a.equals(g.id,r.a.EMPTY)&&f&&_){var I=Object(s.b)(a,f),O=new l.a(I.businessProcessFlowUniqueName,_),N=Object(u.b)(a,O);return Object(i.a)(this._lastPageEntityFromCrossEntity)||Object(i.a)(g)||this._lastPageEntityFromCrossEntity.etn===g.etn||this._moveToNextStageForCrossEntityBPF(N,d),void this._processManager.initilaizeWithProcessAndFormEntity(N,I,g,f,O,t)}if(this._processIdInState){I=Object(s.b)(a,this._processIdInState);if(!Object(i.a)(I)&&Object(m.b)(I.initialized)){O=new l.a(I.businessProcessFlowUniqueName,Object(c.f)(a,g)),N=Object(u.b)(a,O);if(r.a.equals(g.id,r.a.EMPTY)){var M=Object(w.b)(I);if(this._lastPageIdInNewForm!==t&&(this._lastPageIdInNewForm=t,this._dispatch(Object(S.a)(null,O))),M&&M.stage&&M.stage.stageId){var T=Object(w.a)(M);return this._dispatch(Object(P.b)(O,T)),void this._processManager.initilaizeWithProcessAndFormEntity(T.fields,I,g,this._processIdInState,O,t)}}else if(Object(i.a)(N))return;var D=Object(F.h)(a,g.etn);if(D&&D.IsBPFEntity)return void this._processManager.initilaizeWithProcessAndFormEntity(N,I,g,this._processIdInState,O,t);for(var A in N)if(Object(o.k)(N[A])&&N[A].reference&&N[A].reference.id&&N[A].reference.etn===g.etn&&(r.a.equals(N[A].reference.id,g.id)||r.a.equals(N[A].reference.id,r.a.EMPTY))&&Object(w.e)(A))return void this._processManager.initilaizeWithProcessAndFormEntity(N,I,g,this._processIdInState,O,t);var x=this._dispatch(Object(b.b)(r.a.EMPTY,g)),B=this._dispatch(Object(y.b)(r.a.EMPTY,g));Promise.all([x,B]).then((function(e){n._processManager.initilaizeWithFormEntityOnly(g,t)}))}else this._processManager.initilaizeWithFormEntityOnly(g,t)}else this._processManager.initilaizeWithFormEntityOnly(g,t)}},t.prototype._reloadDataIfRequired=function(t,e){var n=this._getState(),a=this._processManager.getCurrentFormEntity();this._lastPageEntityFromCrossEntity=a;var i=null,o=!1;if(a&&(i=Object(c.b)(a)(n,a.etn))&&(o=i.refreshGlobalNavigationData),!Object(w.g)(n)&&(!this._pageInfo||!r.a.equals(this._pageInfo.id,e.id)||this._pageId!==t||this._hasProcessChanged(e)||o)||Object(w.g)(n)&&this._processManager.getProcessId()){if(i&&i.refreshGlobalNavigationData&&this._dispatch(Object(_.b)(!1,a)),this._reloadDataCount<30)this._reloadData(t,e);else if(this._pageId!==t&&(this._reloadDataCount=0),30===this._reloadDataCount){var s=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ReachMaxBpfReloadDataCount"),u=this._processManager.getTelemetryParams();s.error("Max BPF reloadData count reached limit of 30. Root cause may be infinite loop when rendering the ProcessControl.",u)}this._reloadDataCount++}else this._reloadDataCount=0},t.prototype._hasProcessChanged=function(t){var e=this._processIdInState||r.a.EMPTY,n=this._getState(),a=new l.a(t.entityTypeName,t.id),i=Object(v.g)(n,this._pageId),o=Object(C.a)(i),u=r.a.equals(a.id,r.a.EMPTY)&&o?o:Object(c.e)(n,a)||r.a.EMPTY;if(!r.a.equals(u,e))return!0;if(r.a.equals(u,r.a.EMPTY))return!1;var d=Object(s.b)(n,u);return!!d&&this._processManager.getVersion()<d.businessProcessFlowProcessVersion},t.prototype._moveToNextStageForCrossEntityBPF=function(t,e){var n=t.activestageid,a=t.traversedpath,i=e.data.nextStageId;if(!i){var o=Object(C.a)(e),s=Object(C.b)(e);if(!r.a.equals(o,this._processManager.getProcessId())||!r.a.equals(s,this._processManager.getProcessInstanceId()))return;i=this._processManager.getStageMetadata().getNextStageId(this._processManager.getActiveStageId())}r.a.equals(n.reference.id,new r.a(i))||(n.reference=new l.a("processstage",new r.a(i)),a.value=a.value+","+i,t.activestagestartedon.value=new Date)},t}()},nBkV:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n("odkg");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function r(t,e,n){var r=Object(a.b)(t,e);return r&&r.injectedXML&&r.injectedXML[n]||null}},oUmu:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return i}));var a=n("i8/j"),r=n("7z0H"),i="form.ui.metadata.update";function o(t,e,n){return{type:"form.ui.metadata.update.async",execute:function(o,s,c){var u=o.dispatch,l=(0,o.getState)(),d=Object(a.j)(l,t),p=Object(r.g)(l,d,t);return u(function(t,e,n,a){return{type:i,payload:{formId:t,formUIState:e},meta:{pageId:n,contextToken:a}}}(t,p,e,n)),Promise.resolve()}}}},r0tX:function(t,e,n){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a;n.d(e,"a",(function(){return a})),function(t){t.collapsed="collapsed",t.expanded="expanded",t.floating="floating",t.getDefaultDisplayState=function(){return t.collapsed}}(a||(a={}))},r3Bs:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a=function(){function t(t,e){this._traversedPath=t,this._stageId=e}return Object.defineProperty(t.prototype,"traversedPath",{get:function(){return this._traversedPath},set:function(t){this._traversedPath=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stageId",{get:function(){return this._stageId},set:function(t){this._stageId=t},enumerable:!1,configurable:!0}),t}(),r=n("3INI"),i=n("9r0m"),o=function(){function t(){}return Object.defineProperty(t.prototype,"globalPathAndActiveStage",{get:function(){return this._globalPathAndActiveStage},set:function(t){(t||this._globalPathAndActiveStage||this._globalPathAndActiveStage.stageId===t.stageId)&&(this._globalPathAndActiveStage=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"navigationEntities",{get:function(){return this._navigationEntities},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"navigationEntityIdsByEntityLogicalName",{get:function(){return this._navigationEntityIdsByEntityLogicalName},enumerable:!1,configurable:!0}),t.prototype.InitGlobalPathAndActiveStage=function(t){this._updateNavigationDictionary(t.navigationEntities),this.UpdateGlobalPathAndActiveStage(t.traversedPath,t.activeStageId)},t.prototype.UpdateGlobalPathAndActiveStage=function(t,e){this.globalPathAndActiveStage=new a(new r.a(t),e)},t.prototype._updateNavigationDictionary=function(t){if(t){this._navigationEntities=t,this._navigationEntityIdsByEntityLogicalName={};for(var e=0;e<t.length;e++)this._navigationEntityIdsByEntityLogicalName[t[e].entityLogicalName]=new i.a(t[e].id)}},t}()}}]),window.bundleExecutionMarkers["scripts/es5/previewsync.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();