(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/es5/GlobalSearchFlyout.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[35],{jLN0:function(e,t,n){"use strict";n.r(t),n.d(t,"GlobalSearchFlyout",(function(){return ne}));var r=n("c/eZ"),o=n("nuS9"),i=n("pk53"),s=n("cQ/l"),a=n("1AYO"),c=n("4E+q"),l=n("kyRo"),u=n("Ww2r"),m=n("mGpW"),p=n("lU69"),h=n("Z1aD"),d=n("wV3W"),y=n("7EJx"),g=n("Ff8i"),f=n("gBKR"),v=n("YWpA"),E=n("okRr"),b=n("m2kE"),R=n("g3s8"),S=n("7sMj"),w=n("H/hG"),I=n("aW2Y"),k=n("evW+");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function j(e){var t=e.onItemClick,n=e.theme,r=e.height,i=void 0===r?I.g:r,s=e.children,a=Object(I.s)(n),c=Object(I.q)(i),l=Object(I.t)(n);return o.createElement(k.a,{style:a,onClick:t,role:"row"},o.createElement(v.a,{key:"grouped-item-content-row",style:c,role:"cell"},s),o.createElement(v.a,{key:"grouped-item-separator",style:l}))}var O=n("KZqt"),T=n("dvLT"),C=n("B5cQ");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function _(e){var t=e.isDataLoaded,n=e.children,r=o.createElement(M,null),i=t?null:{root:{overflow:"hidden"}};return o.createElement(O.a,{isDataLoaded:t,styles:i,customElementsGroup:r},n)}function M(){return o.createElement(o.Fragment,null,o.createElement(T.a,{rowHeight:I.f,shimmerElements:[{type:C.a.gap,width:I.h,height:I.f},{type:C.a.line,width:"33%",height:I.e},{type:C.a.gap,width:"67%",height:I.f}]}),o.createElement(x,null),o.createElement(x,null),o.createElement(x,null))}function x(){return o.createElement(v.a,{style:Object(I.B)()},o.createElement(T.a,{key:"circle-shimmer",rowHeight:I.g,shimmerElements:[{type:C.a.gap,width:I.h,height:I.g},{type:C.a.circle,height:I.b},{type:C.a.gap,width:I.d,height:I.g}]}),o.createElement(T.a,{key:"line-shimmer",rowHeight:I.g,width:"100%",shimmerElements:[{type:C.a.line,height:I.c,width:"100%",verticalAlign:"center"}]}),o.createElement(T.a,{key:"right-spacing-shimmer",shimmerElements:[{type:C.a.gap,width:I.h,height:I.g}]}))}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function F(e){var t=o.useContext(l.a).EventManager,n=e.items,r=e.groups,i=e.entitiesMetadata,s=e.onEntityRecordClick,a=e.theme,c=e.isRTL,u=e.searchSessionId,m=n.every((function(e){return i.has(e.EntityTypeName)}));return o.createElement(_,{isDataLoaded:m},o.createElement(b.a,{items:n,onRenderCell:function(e,n,r){var i=Object(I.p)(a,c),l=Object(I.u)(),m="mru-item-"+r;return o.createElement(j,{key:m,onItemClick:function(){s(n.EntityTypeName,n.ObjectId);var e=""+R.a+R.b.clickRecentlyAccessedRecord,r=[{name:R.b.sessionId,value:u},{name:R.b.entityName,value:n.EntityTypeName},{name:R.b.recordId,value:n.ObjectId.guid}];t.ReportComponentSuccess(e,r)},theme:a,isRTL:c},o.createElement(S.a,{key:"mru-item-image",alt:n.Title,style:i,hasPrimaryImageField:!0,entityPrimaryField:n.Title}),o.createElement(w.a,{key:"mru-item-text",style:l},n.Title))},groups:r,groupProps:{onRenderHeader:function(e){var t,n,r,s=Object(I.n)(a),c=(null===(n=i.get(null===(t=e.group)||void 0===t?void 0:t.name))||void 0===n?void 0:n.DisplayCollectionName)||(null===(r=e.group)||void 0===r?void 0:r.name);return o.createElement(v.a,{style:s},c)}},styles:Object(I.o)()}))}var N=n("BFwB"),L=n("XIN1"),G=n("znb3");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function P(e){var t=o.useContext(l.a).EventManager,n=e.items,r=e.groups,i=e.theme,s=e.isRTL,a=e.searchSessionId;if(0===n.length)return null;return o.createElement(b.a,{items:n,onRenderCell:function(n,r,c){var l=Object(I.r)(s),u=Object(I.u)(),m="search-item-"+c;return o.createElement(j,{key:m,onItemClick:function(){e.onItemClick(r);var n=""+R.a+R.b.clickRecentlyTypedQuery,o=[{name:R.b.sessionId,value:a}];t.ReportComponentSuccess(n,o);var i=new N.a("GlobalSearchFlyout.SearchItems.ItemClicked");t.ReportEvent(i)},theme:i,isRTL:s,height:I.k},o.createElement(L.b,{key:"search-item-icon",type:G.a.History,style:l}),o.createElement(w.a,{key:"search-item-text",style:u},r))},groups:r,groupProps:{onRenderHeader:function(e){var t,n=Object(I.n)(i);return o.createElement(v.a,{style:n},null===(t=e.group)||void 0===t?void 0:t.name)}},styles:Object(I.o)()})}var D=n("5ExI"),U=n("eRQ2"),A=n("T35U"),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(r.__extends)(t,e),t.prototype.render=function(){var e=this.props,t=e.mostRecentUsedItems,n=e.entitiesMetadata,r=e.onSearchItemClick,i=e.onEntityRecordClick,s=e.theme,a=e.isRTL,c=e.searchSessionId,l=this._populateMRUGroups(t),u=l.groups,m=l.items,p=this._populateSearchItemsGroup(this._getRecentSearchItems()),h=p.groups,d=p.items;return o.createElement(o.Fragment,null,o.createElement(P,{items:d,groups:h,onItemClick:r,theme:s,isRTL:a,searchSessionId:c}),o.createElement(F,{items:m,groups:u,entitiesMetadata:n,onEntityRecordClick:i,theme:s,isRTL:a,searchSessionId:c}))},t.prototype._getRecentSearchItems=function(){var e=Object(U.b)(D.a);return e?e.split(D.c):[]},t.prototype._populateSearchItemsGroup=function(e){void 0===e&&(e=[]);var t=Array.from(new Set(e)).filter((function(e){return""!==e.trim()})),n=t.length,r=Math.min(n,3);return{groups:[{count:r,key:"Search_Group",name:this.props.recentSearchesDisplayText,startIndex:0}],items:t.slice(0,r)}},t.prototype._populateMRUGroups=function(e){for(var t,n={groups:new Array,items:new Array},r=e.filter((function(e){return e.RecordType===E.a.Entity&&e.EntityTypeName!==A.b&&e.EntityTypeName!==A.c})).sort((function(e,t){return t.LastAccessed.getTime()-e.LastAccessed.getTime()})),o=0,i={},s=Math.min(6,r.length),a=function(e){var t=r[e].EntityTypeName;n.groups.find((function(e){return e.name===t}))||n.groups.push({count:0,key:t,name:t,startIndex:0})},c=0;c<s;c++)a(c);for(c=0;c<s;c++){var l=r[c].EntityTypeName,u=i[l];u||(u=new Array,i[l]=u),u.push(r[c])}for(c=0;c<n.groups.length;c++){var m=n.groups[c],p=i[m.name].length;m.count=p,m.startIndex=o,o+=p,(t=n.items).push.apply(t,i[m.name])}return n},t}(o.Component),B=n("PMTb");function Z(e){var t=o.useContext(l.a).EventManager,n=e.suggestions,r=e.entitiesMetadata,i=e.suggestionsRetrievalPending,s=e.onShowMoreResults,a=e.onEntityRecordClick,c=e.theme,u=e.isRTL,m=e.showMoreResultsDisplayText,p=e.searchSessionId,h=function(e){var t=e.reduce((function(e,t,n){var r=t.suggestionInfo.entityName;return e.has(r)?e.get(r).count+=1:e.set(r,{key:r,name:r,startIndex:n,count:1}),e}),new Map);return{groups:Array.from(t.values()),items:e}}(n),d=h.items,y=h.groups,g=!(i&&0===n.length)&&n.every((function(e){return r.has(e.suggestionInfo.entityName)}));return o.createElement(_,{isDataLoaded:g},o.createElement(b.a,{items:d,onRenderCell:function(e,n,i){var s,l=Object(I.p)(c,u),m=Object(I.A)(),h=n.suggestionInfo,d=h.entityName,y=h.objectId,g=h.entityImageUrl,f=h.crmHitText,v=f.replace(new RegExp("{crmhit}(.*?){/crmhit}","gm"),""),E=null===(s=r.get(d))||void 0===s?void 0:s.PrimaryNameAttribute,b=n.record[E]||v,w="suggestion-item-"+i;return o.createElement(j,{key:w,onItemClick:function(){a(d,y);var e=""+R.a+R.b.clickSuggestionRecord,n=[{name:R.b.sessionId,value:p},{name:R.b.entityName,value:d},{name:R.b.recordId,value:y.guid}];t.ReportComponentSuccess(e,n)},theme:c,isRTL:u},o.createElement(S.a,{key:"suggestion-item-image",src:g,alt:b,style:l,hasPrimaryImageField:!0,entityPrimaryField:b}),o.createElement(B.a,{key:"suggestion-item-text",style:m},function(e,t,n){var r=Object(I.u)(!1),i=[],s=new RegExp("{crmhit}(.*?){/crmhit}","gm").exec(t),a=s&&s.length>0?s[1]:"";if(!a)return i.push(o.createElement(B.a,{key:"only",style:r},e)),i;var c=(m=a,m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")),l=new RegExp("("+c+").*?","gm"),u=0;var m;for(;u<e.length;){var p=l.exec(e);if(!p){i.push(o.createElement(B.a,{key:i.length,style:r},e.substr(u)));break}var h=e.substr(u,p.index-u);i.push(o.createElement(B.a,{key:i.length,style:r},h)),h=p[0],i.push(o.createElement(B.a,{key:i.length,style:n},h)),u=l.lastIndex}return i}(b,f,Object(I.z)(c))))},groups:y,groupProps:{onRenderHeader:function(e){var t,n,i,s=Object(I.n)(c),a=(null===(n=r.get(null===(t=e.group)||void 0===t?void 0:t.name))||void 0===n?void 0:n.DisplayCollectionName)||(null===(i=e.group)||void 0===i?void 0:i.name);return o.createElement(v.a,{style:s},a)}},styles:Object(I.o)()}),o.createElement(k.a,{style:Object(I.y)(c,g),onClick:function(){s();var e=new N.a("GlobalSearchFlyout.Suggestions.ShowMoreResultsClicked");t.ReportEvent(e)}},o.createElement(w.a,{style:Object(I.x)(c)},m)))}var Q=n("4CeN"),K=n("2o2Y"),W=n("xc1f"),q=n("lMVv"),z=["GlobalSearch.ZeroQuery.RecentSearches","GlobalSearch.Suggestions.ShowMoreResults"],Y=n("9rQ4"),J=n("zmaG"),V=n.n(J),$=n("7pqb"),X=Object(p.b)("globalSearchFlyout"),ee=function(e){function t(t,n){var r=e.call(this,t)||this;return r._focusZoneRef=o.createRef(),r._onKeyDownHandler=function(e){e.keyCode===Y.a.Escape&&(r.props.dismissFlyout(),e.stopPropagation())},r._onSearchItemClick=function(e){r.props.onSearch(e),r.props.dismissFlyout()},r._onEntityRecordClick=function(e,t){r.props.onEntityRecordClick(e,t),r.props.dismissFlyout()},r._onShowMoreSearchResults=function(){r.props.onShowMoreSearchResults(),r.props.dismissFlyout()},r._onFlyoutOutsideClick=function(e){r._isSearchBoxClick(e)||r.props.dismissFlyout()},te(t)||t.retrieveEntityMetadata(),Object(u.c)(t.resourceStrings,"GlobalSearch.ZeroQuery.RecentSearches")||t.retrieveResourceStrings(),Object(s.a)(r),r}return Object(r.__extends)(t,e),t.prototype.componentDidUpdate=function(){te(this.props)||this.props.retrieveEntityMetadata()},t.prototype.render=function(){var e=this.props,t=e.theme,n=e.width,r=Object(I.m)(t),s=Object(I.l)(t);return o.createElement(a.a,{id:X,key:X,groupId:X,relativeToElementId:this.props.relativeToDomId,relativeToElementIdSelector:this.props.relativeToElementIdSelector,positionType:"relative",size:{width:n},flyoutDirection:this.props.isRTL?a.b.down:a.b.downleft,onOutsideClick:this._onFlyoutOutsideClick,parentFlyoutRoot:D.b,flyoutStyle:r},o.createElement(v.a,{style:s,onKeyDown:this._onKeyDownHandler},o.createElement(i.a,{componentRef:this._focusZoneRef},this._renderFlyoutContent())))},t.prototype.focus=function(){var e;null===(e=this._focusZoneRef.current)||void 0===e||e.focus()},t.prototype.focusLast=function(){var e;null===(e=this._focusZoneRef.current)||void 0===e||e.focusLast()},t.prototype._renderFlyoutContent=function(){var e=this.props,t=e.suggestions,n=e.suggestionsRetrievalPending,r=e.entitiesMetadata,i=e.theme,s=e.isRTL,a=e.mostRecentUsedItems,c=e.resourceStrings,l=e.searchSessionId,m=t.length>0||n,p={};return p[$.b.SearchParameters.SearchSessionId]=l,p[$.b.SearchParameters.UsingSuggestion]=m?"True":"False",V.a.addKeyPerformanceIndicatorOnIdle("GlobalSearchFlyout",p),m?o.createElement(Z,{suggestions:t,entitiesMetadata:r,suggestionsRetrievalPending:n,onEntityRecordClick:this._onEntityRecordClick,onShowMoreResults:this._onShowMoreSearchResults,theme:i,isRTL:s,showMoreResultsDisplayText:Object(u.c)(c,"GlobalSearch.Suggestions.ShowMoreResults"),searchSessionId:l}):o.createElement(H,{mostRecentUsedItems:a,entitiesMetadata:r,onSearchItemClick:this._onSearchItemClick,onEntityRecordClick:this._onEntityRecordClick,theme:i,isRTL:s,recentSearchesDisplayText:Object(u.c)(c,"GlobalSearch.ZeroQuery.RecentSearches"),searchSessionId:l})},t.prototype._isSearchBoxClick=function(e){if(e){var t=e.target;do{if(t.classList.contains(this.props.searchBoxRootClassName))return!0;t=t.parentElement}while(t)}return!1},t}(o.Component);function te(e){var t=e.suggestions,n=e.mostRecentUsedItems,r=e.entitiesMetadata;return t.every((function(e){return r.has(e.suggestionInfo.entityName)}))&&n.every((function(e){return r.has(e.EntityTypeName)}))}ee.contextType=l.a;var ne=Object(c.a)((function(){var e=Object(u.h)();return function(t){var n=Object(K.b)(t),r=new Map,o=n.suggestions,i=Object(g.h)(t),s=!1;function a(e){var n=Object(q.h)(t,e);n||(s=!0),r.set(e,n)}return o.forEach((function(e){return a(e.suggestionInfo.entityName)})),i.forEach((function(e){return a(e.EntityTypeName)})),s&&(r=new Map),{theme:Object(d.a)(t),isRTL:Object(y.g)(t),mostRecentUsedItems:i,suggestions:o,suggestionsRetrievalPending:n.suggestionsRetrievalPending,entitiesMetadata:r,width:Object(Q.a)(t).width,resourceStrings:e(t,z)}}}),(function(e){return{onEntityRecordClick:function(t,n){var r={entityTypeName:t,id:n};e(Object(h.a)(W.a,r))},retrieveEntityMetadataInternal:function(t){var n=t.reduce((function(e,t){return e[t]=[],e}),{});e(Object(f.e)(n))},retrieveResourceStrings:function(){e(Object(m.e)(z))}}}),(function(e,t,n){var o=t.retrieveEntityMetadataInternal,i=Object(r.__rest)(t,["retrieveEntityMetadataInternal"]);return Object(r.__assign)(Object(r.__assign)(Object(r.__assign)(Object(r.__assign)({},n),e),i),{retrieveEntityMetadata:function(){var t=[];e.suggestions.forEach((function(e){return t.push(e.suggestionInfo.entityName)})),e.mostRecentUsedItems.forEach((function(e){return t.push(e.EntityTypeName)})),o(t)}})}))(ee)}}]),window.bundleExecutionMarkers["scripts/es5/GlobalSearchFlyout.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();