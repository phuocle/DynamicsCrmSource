(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/es5/ColumnEditor.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[33],{"pnQ/":function(e,t,r){"use strict";r.r(t),r.d(t,"ColumnEditor",(function(){return he}));var n,i=r("c/eZ"),o=r("nuS9"),a=r("YWpA"),l=r("4E+q"),s=r("H/hG"),d=r("4PNl"),c=new Map([["string","TextField"],["datetime","DateTime"],["double","NumberField"],["integer","NumberField"],["decimal","NumberField"],["bigint","NumberField"],["boolean","CheckboxComposite"],["picklist","Dropdown"],["lookup","LookupEntities"],["memo","TextBox"],["money","Money"],["uniqueidentifier","GUID"],["status","Dropdown"],["image","PictureFill"],["state","Dropdown"],["virtual","Unknown"],["entityname","Unknown"],["owner","Contact"],["customer","LookupEntities"],["partylist","list"],["default","Unknown"]]);function u(e){var t;return null!==(t=c.get(e))&&void 0!==t?t:c.get("default")}!function(e){e.Custom="custom",e.Default="default",e.All="all"}(n||(n={}));var p=r("9r0m"),m=r("TW2h"),g=r("OPrh"),f=r("kl3Z"),y=r("lMVv"),h=r("F2uj"),b=r("wV3W"),E=r("7EJx");var v=r("MHA6"),S=r("d3i+"),C={border:"1px gray",borderRadius:4,marginBottom:".5rem",backgroundColor:"#f3f2f1",width:"100%",display:"flex",cursor:"move"},w={marginLeft:"auto",marginRight:"8"},x=function(e){function t(t){var r=e.call(this,t)||this;return r.render=function(){var e=r.props.menuItems;r._isDragSourceIndex&&(r.setState({isHovering:!1}),r._isDragSourceIndex=!1);var t=r.state.isHovering&&!r.props.dragInProgress?o.createElement(v.IconButton,{tabIndex:0,style:Object(i.__assign)({},w),id:r._iconUniqueId,key:r._iconUniqueId,menuIconProps:{iconName:"More"},menuProps:{items:e},"aria-label":r.props.moreOptionsString,onMenuClick:function(){r.setState({isContextMenuOpen:!0})},onAfterMenuDismiss:r._closeContextMenu,onBlur:r._onEllipsis}):null;return r.props.dragInProgress&&r.state.isHovering&&(r._isDragSourceIndex=!0),!r.props.dragInProgress&&r.state.isHovering&&r.props.setActiveEllipsis(r._iconUniqueId),o.createElement("div",{tabIndex:0,key:r._guid,style:C,autoFocus:!0,role:"menuitem","aria-label":r.props.displayName,onFocus:r._onMouseEnter,onMouseEnter:r._onMouseEnter,onMouseLeave:r._onMouseLeave,onKeyDown:r._onCardBlur,title:r.props.displayName},o.createElement(S.Icon,{iconName:r.props.displayIconName,style:Object(i.__assign)(Object(i.__assign)({},r.props.columnEditorStyles.attributeIcon),{margin:"8px"})}),o.createElement(s.a,{style:{margin:"8px"}},r.props.displayName),t)},r._onMouseEnter=function(){r.setState({isHovering:!0})},r._onMouseLeave=function(){r.setState({isHovering:!1})},r._closeContextMenu=function(){r.setState({isContextMenuOpen:!1})},r._onEllipsis=function(){r.state.isContextMenuOpen?r.setState({isHovering:!0}):r.setState({isHovering:!1})},r._onCardBlur=function(e){e.shiftKey&&9===e.keyCode&&r._onMouseLeave()},r.state={isHovering:!1,isContextMenuOpen:!1},r._guid=p.a.newGuid().guid.replace(/-/g,""),r._iconUniqueId="MoreOptions "+r.props.displayName+r._guid,r._isDragSourceIndex=!1,r}return Object(i.__extends)(t,e),t}(o.Component),_=r("l2jD"),D=r("+Zeg"),O=o.forwardRef((function(e,t){var r=e.displayName,n=e.displayIconName,i=e.menuItems,a=e.isDragging,l=e.columnEditorStyles,s=e.connectDragSource,d=e.connectDropTarget,c=e.dragInProgress,u=e.moreOptionsString,p=e.setActiveEllipsis,m=o.useRef(null);s(m),d(m),o.useImperativeHandle(t,(function(){return{getNode:function(){return m.current}}}));var g=a?0:1;return o.createElement("div",{ref:m,style:{opacity:g}},o.createElement(x,{menuItems:i,columnEditorStyles:l,displayName:r,displayIconName:n,dragInProgress:c,moreOptionsString:u,setActiveEllipsis:p}))})),N=Object(_.a)("DragAndDropCard",{beginDrag:function(e){return{index:e.index}}},(function(e,t){return{connectDragSource:e.dragSource(),isDragging:t.isDragging(),dragInProgress:!!t.getItem()}})),A=Object(D.a)("DragAndDropCard",{hover:function(e,t,r){if(!r.getNode())return null;var n=t.getItem().index,i=e.index;if(n!==i){var o=r.getNode().getBoundingClientRect(),a=(o.bottom-o.top)/2,l=t.getClientOffset().y-o.top;n<i&&l<a||n>i&&l>a||(e.moveField(n,i),t.getItem().index=i)}}},(function(e){return{connectDropTarget:e.dropTarget()}}))(N(O)),R=r("RrHr"),T=r("gBKR"),k=r("Gemh"),M=r("RlP9"),I=r("uO/V"),L=I.x+".ColumnEditor",j={name:"",width:150,relatedEntityName:"",isHidden:!1,imageProviderWebresource:"",imageProviderFunctionName:""};function F(e){try{return{fetchXML:(new XMLSerializer).serializeToString(e),errorMessage:null}}catch(e){return{fetchXML:null,errorMessage:e}}}function B(e){var t,r=new DOMParser,n=r.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI,i=r.parseFromString(e,"text/xml"),o=i.getElementsByTagNameNS(n,"parsererror");return o.length>0&&(t=o[0].textContent),{xml:i,errorMessage:t}}function V(e,t){if(t)return e?e+" "+t:t}var P=r("Pqgs"),X=r("AfSU"),H="related",z="entity",U=function(e){return o.createElement(a.a,{style:{marginBottom:"16"}},o.createElement(P.a,{onLinkClick:e.onClick,selectedKey:e.selectedKey,styles:e.pivotStyles},o.createElement(X.a,{itemKey:z,linkText:e.entityDisplayNameText,"aria-label":e.entityDisplayNameText,tabIndex:0}),o.createElement(X.a,{itemKey:H,linkText:e.relatedText,"aria-label":e.relatedText,tabIndex:0})))},G=r("UA/f"),K=r("6Cai"),W=r("syeT"),q=function(e){var t={value:e.columnEditorSearchValue,onChange:e.onSearchValueChanged,placeholder:e.localizedStrings.search,ariaLabel:e.localizedStrings.search},r={selectedItem:e.searchFilter,onChangeDropdown:e.onSearchDropdownChanged,dropdownOptions:[{key:n.Default,text:e.localizedStrings.dropDownDefault,title:e.localizedStrings.dropDownDefault,ariaLabel:e.localizedStrings.dropDownDefault},{key:n.All,text:e.localizedStrings.dropDownAll,title:e.localizedStrings.dropDownAll,ariaLabel:e.localizedStrings.dropDownAll},{key:n.Custom,text:e.localizedStrings.dropDownCustom,title:e.localizedStrings.dropDownCustom,ariaLabel:e.localizedStrings.dropDownCustom}]};return o.createElement(W.a,{horizontal:!0,style:{width:"302px",marginRight:"16px"}},o.createElement(a.a,{style:e.searchContainerStyle},o.createElement(K.a,Object(i.__assign)({},t,{style:e.searchBoxStyle}))),o.createElement(G.a,{selectedKey:r.selectedItem.key,onChanged:r.onChangeDropdown,styles:e.filterStyle,options:r.dropdownOptions,dropdownWidth:"auto","aria-label":e.localizedStrings.dropdown}))},Z=r("pk53"),J=r("7meg"),Y=r("8BKt"),$=function(e){var t=!0,r=e.entityAttributes,n=[];r&&Object.keys(r).forEach((function(i){var o=r[i];e.shouldRenderAttribute(o)&&(n.push(o),t=!1)}));var i=t&&e.currentTab===z&&o.createElement(a.a,{style:{marginTop:"16px"}},e.emptyFieldsString);return n.sort((function(e,t){var r;return null===(r=e.DisplayName)||void 0===r?void 0:r.localeCompare(t.DisplayName)})),o.createElement(a.a,null,o.createElement(Z.a,{style:e.focusZoneStyle,direction:J.a.vertical},o.createElement(d.a,null,e.currentTab===z&&o.createElement(Y.a,{role:"menu",style:e.attributeListStyle,items:n,onRenderCell:function(t){return e.renderAttributes(t)}}),i)),e.currentTab===H&&e.renderRelatedEntities(r))},Q=r("URN4"),ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.__extends)(t,e),t.prototype._constructTree=function(){var e=this,t=this._getRelationAttributes(),r=[];return t.forEach((function(t){var n=e.props.getEntityAttributes(t.ReferencedEntity),i=[];if(n&&Object.keys(n).forEach((function(r){var o=n[r];if(t.IsValidForAdvancedFind&&e.props.shouldRenderAttribute(o,t)){var a=e.props.entityAttributes[t.ReferencingAttribute]?o.DisplayName+" ("+e.props.entityAttributes[t.ReferencingAttribute].DisplayName+")":"",l=o.LogicalName+"."+t.ReferencingAttribute;i.push({label:a,ariaLabel:a,key:l,attribute:o,relation:t,iconProps:{iconName:u(o.Type)}})}})),i.sort((function(e,t){return e.label.localeCompare(t.label)})),i.length>0){var o=e.props.getEntityDisplayName(t.ReferencedEntity);if(o){var a=e.props.entityAttributes[t.ReferencingAttribute]?e.props.entityAttributes[t.ReferencingAttribute].DisplayName+" ("+o+")":"";r.push({label:a,ariaLabel:a,key:t.ReferencingEntityNavigationPropertyName+t.ReferencedEntity,relation:t,children:i})}}})),r.sort((function(e,t){return e.label.localeCompare(t.label)})),this._message=0===r.length&&o.createElement(a.a,{style:{margin:"16px"}},this.props.emptyFieldsString),r},t.prototype._getRelationAttributes=function(){var e,t=this;if(!this._prevManyToOneRelationships||!this._prevRelationAttributes||this._prevManyToOneRelationships!==this.props.manyToOneRelationships){var r=this.props.manyToOneRelationships&&(null===(e=Object.keys(this.props.manyToOneRelationships))||void 0===e?void 0:e.map((function(e){return t.props.manyToOneRelationships[e]})));return this._prevRelationAttributes=r,this._prevManyToOneRelationships=this.props.manyToOneRelationships,r}return this._prevRelationAttributes},t.prototype.render=function(){var e=this._constructTree();return o.createElement("div",{style:{width:"320px",height:"180px"}},this._message,o.createElement(Q.TreeView,{styles:this.props.treeViewStyle,items:e,strings:{listAriaLabel:this.props.listAriaLabelString},onItemSelected:this.props.onItemSelected}))},t}(o.Component),te=r("X1rd"),re=r("BNdr"),ne=r("mZYD"),ie=r("kyRo"),oe=r("KMIC"),ae=I.x+".AttributesCallout.",le=function(e){function t(t){var r=e.call(this,t)||this;return r._updateSearchStringTimeout=50,r.render=function(){return o.createElement(te.Callout,{hideOverflow:!0,target:"#AddColumnsBtn",role:"dialog",styles:{calloutMain:{maxHeight:"360",width:"320"}},DirectionalHint:te.DirectionalHint.bottomLeftEdge,onDismiss:function(){r.props.closeColumnEditorCallout()},ariaDescribedBy:r.props.columnEditorStrings.addColumn},o.createElement(oe.FocusTrapZone,null,o.createElement(a.a,null,o.createElement(a.a,{style:r.props.columnEditorStyles.addColumnHeaderRoot},o.createElement(s.a,{id:r.props.columnEditorStrings.addColumn,style:r.props.columnEditorStyles.addColumnHeaderTitle},r.props.columnEditorStrings.addColumn),o.createElement(v.IconButton,{role:"img",iconProps:{iconName:"Cancel"},style:r.props.columnEditorStyles.addColumncloseButton,onClick:function(){r.props.closeColumnEditorCallout()},"aria-label":r.props.columnEditorStrings.close,title:r.props.columnEditorStrings.close,autoFocus:!0})),o.createElement(a.a,{style:r.props.columnEditorStyles.root},o.createElement(a.a,{style:r.props.columnEditorStyles.header},r._renderPivots()),r._renderSearchBox(),o.createElement(a.a,{style:r.props.columnEditorStyles.list},r._renderListContents())))))},r._getViewDescriptor=function(){return JSON.parse(JSON.stringify(r.props.viewDescriptor))},r._getFetchXml=function(){return r.props.viewDescriptor.fetchXML},r._renderSearchBox=function(){return o.createElement(q,{searchBoxStyle:r.props.columnEditorStyles.searchBox,filterStyle:r.props.columnEditorStyles.filterStyle,searchContainerStyle:r.props.columnEditorStyles.searchContainer,columnEditorSearchValue:r.state.columnEditorsearchValue,onSearchValueChanged:r._onSearchValueChanged,searchFilter:r.state.searchFilter,onSearchDropdownChanged:r._onSearchDropdownChanged,localizedStrings:{search:r.props.columnEditorStrings.search,dropdown:r.props.columnEditorStrings.dropdown,dropDownDefault:r.props.columnEditorStrings.dropDownOptionsDefault,dropDownAll:r.props.columnEditorStrings.dropDownOptionsAll,dropDownCustom:r.props.columnEditorStrings.dropDownOptionsCustom}})},r._renderListContents=function(){var e;return o.createElement($,{entityAttributes:r.props.getEntityAttributes(null===(e=r.props.entityMetadata)||void 0===e?void 0:e.EntityLogicalName),shouldRenderAttribute:r._shouldRenderAttribute,focusZoneStyle:r.props.columnEditorStyles.focusZone,attributeListStyle:r.props.columnEditorStyles.attributeList,currentTab:r.state.currentTab,renderAttributes:r._renderAttributes,renderRelatedEntities:r._renderRelatedEntities,emptyFieldsString:r.props.columnEditorStrings.noFieldsToDisplay})},r._onSearchDropdownChanged=function(e){r.setState({searchFilter:e})},r._onItemSelected=function(e){var t;if(e.attribute){var n=function(e,t,r,n,i){var o,a,l,s=B(n),d=s.xml;l=V(l,s.errorMessage);var c=p.a.newGuid().guid.replace(/-/g,"");c="a_".concat(c);var u=d.querySelector('[name="'+t.ReferencedEntity+'"][from="'+t.ReferencedAttribute+'"][to="'+t.ReferencingAttribute+'"]');if(u)(m=d.createElement("attribute")).setAttribute("name",e.LogicalName),u.append(m),c=u.getAttribute("alias");else{var m,g=d.createElement("link-entity");g.setAttribute("name",t.ReferencedEntity),g.setAttribute("from",t.ReferencedAttribute),g.setAttribute("to",t.ReferencingAttribute),g.setAttribute("link-type","outer"),g.setAttribute("alias",c),g.setAttribute("visible","false"),(m=d.createElement("attribute")).setAttribute("name",e.LogicalName),g.append(m),d.getElementsByTagName("entity")[0].append(g)}j.name=c+"."+e.LogicalName,j.relatedEntityName=e.EntityLogicalName,null===(a=null===(o=null==r?void 0:r.grid)||void 0===o?void 0:o.rows[0])||void 0===a||a.cells.push(j);var f=F(d.documentElement);if(r.fetchXML=f.fetchXML,l=V(l,f.errorMessage)){var y=[{name:"RelatedColumnToAdd",value:e.LogicalName},{name:"Relation",value:t.ReferencedEntity}];null==i||i.ReportComponentFailure(Object(I.G)(L+".AttributesCallout","AddRelatedColumn"),new Error(l),"",y)}return r}(e.attribute,e.relation,r._getViewDescriptor(),r._getFetchXml(),null===(t=r.context)||void 0===t?void 0:t.EventManager);n&&(r.props.addedColumnCallout(n.fetchXML,n),r.props.closeColumnEditorCallout())}},r._renderRelatedEntities=function(e){return o.createElement(ee,{entityAttributes:e,manyToOneRelationships:r.props.manyToOneRelationships,getEntityAttributes:r.props.getEntityAttributes,shouldRenderAttribute:r._shouldRenderAttribute,getEntityDisplayName:r.props.getEntityDisplayName,treeViewStyle:r.props.columnEditorStyles.treeView,onItemSelected:r._onItemSelected,listAriaLabelString:r.props.columnEditorStrings.listAriaLabel,emptyFieldsString:r.props.columnEditorStrings.noFieldsToDisplay})},r._shouldRenderAttribute=function(e,t){var i=Object(f.d)(r._getViewDescriptor()),o=!1;return i.forEach((function(n){n.relatedEntityName&&t?r._isRelatedEntityAttributeInFetchXml(n,e,t)&&(o=!0):t||n.name!==e.LogicalName||(o=!0)})),!(o||!e.DisplayName||r.state.columnEditorsearchValue&&!r._matchSearchString(e,r.state.columnEditorsearchValue)||r.state.searchFilter.key===n.Custom&&!e.IsCustomAttribute||t&&r.state.searchFilter.key===n.Custom&&!t.IsCustomRelationship||r.state.searchFilter.key===n.Default&&e.IsCustomAttribute||!e.IsValidForGrid)},r._isRelatedEntityAttributeInFetchXml=function(e,t,n){var i=e.name.split(".");if(2!==i.length)return!1;var o=i[0],a=i[1],l=(new DOMParser).parseFromString(r._getFetchXml(),"text/xml").getElementsByTagName("attribute");if(a!==t.LogicalName)return!1;for(var s=0;s<l.length;s++)if(l[s].getAttribute("name")===a){var d=l[s].parentNode,c=l[s].parentElement;if("link-entity"===d.nodeName&&c.getAttribute("name")===(null==n?void 0:n.ReferencedEntity)&&c.getAttribute("from")===(null==n?void 0:n.ReferencedAttribute)&&c.getAttribute("to")===(null==n?void 0:n.ReferencingAttribute)&&c.getAttribute("alias")===o)return!0}return!1},r._renderPivots=function(){return o.createElement(U,{entityDisplayNameText:r.props.entityMetadata.DisplayName,relatedText:r.props.columnEditorStrings.related,onClick:r._onLinkClick,selectedKey:r.state.currentTab,pivotStyles:r.props.columnEditorStyles.pivot})},r._onLinkClick=function(e){e&&r.setState({currentTab:e.props.itemKey})},r._renderAttributes=function(e){var t=u(e.Type),n=Object(ne.b)({itemCell:[{boxSizing:"border-box",display:"flex",selectors:{"&:hover":{background:"#f3f2f1"},"&:focus":{background:"#f3f2f1"}}}]});return o.createElement("div",{"data-is-focusable":!0,style:r.props.columnEditorStyles.attributeContainer,role:"menuitem",className:n.itemCell,onClick:function(){var t,n=function(e,t,r,n){var i,o,a,l=B(r),s=l.xml;a=V(a,l.errorMessage);var d=s.createElement("attribute");d.setAttribute("name",e),s.getElementsByTagName("entity")[0].append(d),j.name=e,j.relatedEntityName="",null===(o=null===(i=null==t?void 0:t.grid)||void 0===i?void 0:i.rows[0])||void 0===o||o.cells.push(j);var c=F(s.documentElement);if(t.fetchXML=c.fetchXML,a=V(a,c.errorMessage)){var u=[{name:"ColumnToAdd",value:e}];null==n||n.ReportComponentFailure(Object(I.G)(L+".AttributesCallout","AddColumn"),new Error(a),"",u)}return t}(e.LogicalName,r._getViewDescriptor(),r._getFetchXml(),null===(t=r.context)||void 0===t?void 0:t.EventManager);n&&(r.props.addedColumnCallout(n.fetchXML,n),r.props.closeColumnEditorCallout())},key:e.LogicalName,tabIndex:0,"aria-label":e.DisplayName},o.createElement(S.Icon,{iconName:t,style:r.props.columnEditorStyles.attributeIcon}),o.createElement(re.a,{style:r.props.columnEditorStyles.attributeLabel},e.DisplayName))},r._onSearchValueChanged=function(e,t){r._updateSearchStringTimer&&window.clearTimeout(r._updateSearchStringTimer),r._updateSearchStringTimer=window.setTimeout((function(){r._updateSearchStringTimer=null,r.setState({columnEditorsearchValue:t||""})}),r._updateSearchStringTimeout)},r.state={columnEditorsearchValue:"",currentTab:z,searchFilter:{key:n.Default,text:r.props.columnEditorStrings.dropDownOptionsDefault}},r}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){var e;null===(e=this.context)||void 0===e||e.EventManager.ReportComponentSuccess(Object(I.G)(ae,"AddColumn"))},t.prototype._matchSearchString=function(e,t){var r=e.DisplayName.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return r.match(new RegExp(n,"i"))},t}(o.Component);le.contextType=ie.a;var se=r("Gtuy"),de=r("4+ZN"),ce=r("LuuA"),ue=r("Hlh+"),pe=r("8xrh"),me=r("/U1C"),ge=r("Ww2r"),fe=I.x+".ColumnEditor",ye=function(e){function t(t){var r=e.call(this,t)||this;return r._addButtonElement=o.createRef(),r._resourceStringsDictionary=new Map,r._renderPanelHeader=function(){return o.createElement(a.a,{style:r.props.columnEditorStyles.panelNavigationContainerStyle},o.createElement(s.a,{style:r.props.columnEditorStyles.panelNavigationHeaderStyle},r.props.columnEditorStrings.editColumns),o.createElement(v.IconButton,{ref:r._addButtonElement,style:{root:r.props.columnEditorStyles.addButton},"aria-label":r.props.columnEditorStrings.close,iconProps:{iconName:"Cancel"},title:r.props.columnEditorStrings.close,onClick:r._onCancelClick}))},r._getViewDescriptor=function(){var e;return null!==(e=r.state.editedViewDescriptor)&&void 0!==e?e:JSON.parse(JSON.stringify(r.props.viewDescriptor))},r._getView=function(){return JSON.parse(JSON.stringify(r.props.view))},r._getFetchXml=function(){return r.state.editedFetchXml||r.props.fetchXML},r._renderPanelBody=function(){var e=Object(f.d)(r._getViewDescriptor());return r.props.entityMetadata&&r.props.retrieveEntity(r.props.entityMetadata.EntityLogicalName),r.props.manyToOneRelationships&&Object.keys(r.props.manyToOneRelationships).forEach((function(e){r.props.retrieveEntity(r.props.manyToOneRelationships[e].ReferencedEntity)})),o.createElement(a.a,null,o.createElement(de.CommandButton,{tabIndex:0,autoFocus:!0,id:"AddColumnsBtn",styles:r.props.columnEditorStyles.addColumnButton,iconProps:{iconName:"Add"},text:r.props.columnEditorStrings.addColumn,title:r.props.columnEditorStrings.addColumn,"aria-label":r.props.columnEditorStrings.addColumn,onClick:function(){return r.setState({columnEditorCalloutOpen:!0})}}),o.createElement(de.CommandButton,{tabIndex:0,id:"ResetToDefaultBtn",styles:r.props.columnEditorStyles.addColumnButton,iconProps:{iconName:"Undo"},text:r.props.columnEditorStrings.resetToDefault,title:r.props.columnEditorStrings.resetToDefault,"aria-label":r.props.columnEditorStrings.resetToDefault,disabled:!r.state.resetToDefaultEnabled,onClick:function(){var e,t,n,i=function(e,t,r,n){for(var i,o=Object(f.d)(e),a=Object(f.d)(t),l=new Set,s=new Set,d=new Set,c=0;c<o.length;c++){for(var u=!1,p=0;p<a.length;p++)if(a[p].name===o[c].name){u=!0;break}d.add(o[c].name),u||l.add(c)}for(c=0;c<a.length;c++)d.has(a[c].name)||s.add(a[c]);var m="";return l.forEach((function(e){var t=""!==m?m:r,a=B(t),l=a.xml;i=V(i,a.errorMessage);var s=l.getElementsByTagName("attribute"),d="";d=o[e].relatedEntityName?o[e].name.split(".")[1]:o[e].name;for(var c=0;c<s.length;c++)if(s[c].getAttribute("name")===d){var u=s[c].parentNode;null!==u&&("link-entity"===u.nodeName?u.parentNode.removeChild(u):u.removeChild(s[c]))}var p=l.querySelectorAll('[attribute="'+d+'"]');for(c=0;c<p.length;c++)p[c].parentNode.removeChild(p[c]);var g=F(l.documentElement);t=g.fetchXML,(i=V(i,g.errorMessage))&&(null==n||n.ReportComponentFailure(Object(I.G)(L,"ResetToDefault"),new Error(i))),m=t})),s.forEach((function(e){var n=B(""!==m?m:r),o=n.xml;if(i=V(i,n.errorMessage),e.relatedEntityName){var a=B(t.fetchXML),l=a.xml;i=V(i,a.errorMessage);var s=e.name.split(".")[0],d=l.querySelector('[alias="'+s+'"]');o.getElementsByTagName("entity")[0].append(d)}else{var c=o.createElement("attribute");c.setAttribute("name",e.name),o.getElementsByTagName("entity")[0].append(c)}var u=F(o.documentElement);m=u.fetchXML,i=V(i,u.errorMessage)})),o=a,e.grid.rows[0].cells=o,m&&(e.fetchXML=m),e}(r._getViewDescriptor(),r._getView(),r._getFetchXml(),null===(e=r.context)||void 0===e?void 0:e.EventManager);i&&(r.setState({editedViewDescriptor:i,editedFetchXml:i.fetchXML,viewEdited:!0,resetToDefaultEnabled:!1,resetClick:!0}),null===(n=null===(t=r.context)||void 0===t?void 0:t.EventManager)||void 0===n||n.ReportComponentSuccess(Object(I.G)(fe,"ResetToDefault")))}}),o.createElement(a.a,{style:r.props.columnEditorStyles.panelBody},r.state.columnEditorCalloutOpen&&r._renderAttributesCallout(),o.createElement(g.a,{backend:m.a},o.createElement(d.a,{accessibilityRole:"menu"},null==e?void 0:e.map((function(e,t){return r._renderFieldForEditor(e,t)})))),o.createElement(W.a,{horizontal:!0,tokens:{childrenGap:20},style:r.props.columnEditorStyles.applyCancelStack},o.createElement(ce.PrimaryButton,{text:r.props.columnEditorStrings.apply,onClick:function(){r._applyChangesToView()},allowDisabledFocus:!0,disabled:!r.state.viewEdited,checked:!1,title:r.props.columnEditorStrings.apply,"aria-label":r.props.columnEditorStrings.apply}),o.createElement(ue.DefaultButton,{text:r.props.columnEditorStrings.cancel,onClick:r._onCancelClick,allowDisabledFocus:!0,checked:!1,title:r.props.columnEditorStrings.cancel,"aria-label":r.props.columnEditorStrings.cancel}))))},r._onCancelClick=function(){if(r.state.viewEdited){var e=r.props.columnChanges;r.setState({viewEdited:!1,editedViewDescriptor:null,editedFetchXml:"",resetToDefaultEnabled:e,resetClick:!1}),r.props.columnEditorPanelDismiss()}else r.props.columnEditorPanelDismiss()},r._renderAttributesCallout=function(){return o.createElement(le,{columnEditorStyles:r.props.columnEditorStyles,entityMetadata:r.props.entityMetadata,getEntityAttributes:r.props.getEntityAttributes,manyToOneRelationships:r.props.manyToOneRelationships,viewDescriptor:r._getViewDescriptor(),getEntityDisplayName:r.props.getEntityDisplayName,closeColumnEditorCallout:function(){r.setState({columnEditorCalloutOpen:!1})},addedColumnCallout:function(e,t){r.setState({editedFetchXml:e,editedViewDescriptor:t,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},columnEditorStrings:r.props.columnEditorStrings})},r._renderFieldForEditor=function(e,t){var n="",i="",a=Object(f.d)(r._getViewDescriptor());if(!e.isHidden){if(e.relatedEntityName){n=r.props.getLinkedEntityAttributeDisplayName(e,r._getViewDescriptor(),r._getFetchXml());var l=e.name.split(".")[1];i=u(null==(s=r.props.getAttributeDescriptor(e.relatedEntityName,l))?void 0:s.Type)}else{var s;n=null==(s=r.props.getAttributeDescriptor(r.props.entityTypeName,e.name))?void 0:s.DisplayName,i=u(null==s?void 0:s.Type)}e.labelId&&(r._resourceStringsDictionary.get(e.labelId)?n=r._resourceStringsDictionary.get(e.labelId):(n=r.props.getResourceStringById(e.labelId),r._resourceStringsDictionary.set(e.labelId,n)));var d=[];return e.disableMetaDataBinding||d.push({key:"Remove"+e.name,text:r.props.columnEditorStrings.fieldContextMenuRemove,onClick:function(){var e,n=function(e,t,r,n){var i,o=Object(f.d)(t),a="";a=o[e].relatedEntityName?o[e].name.split(".")[1]:o[e].name;var l=r,s=B(l),d=s.xml;i=V(i,s.errorMessage);for(var c=d.getElementsByTagName("attribute"),u=0;u<c.length;u++)if(c[u].getAttribute("name")===a){var p=c[u].parentNode;"link-entity"===p.nodeName?(p.removeChild(c[u]),0===p.children.length&&p.parentNode.removeChild(p)):p.removeChild(c[u])}var m=F(d.documentElement);if(l=m.fetchXML,i=V(i,m.errorMessage),o.splice(e,1),t.grid.rows[0].cells=o,t.fetchXML=l,i){var g=[{name:"FailedToRemoveIndex",value:e}];null==n||n.ReportComponentFailure(Object(I.G)(L,"RemoveColumn"),new Error(i),"",g)}return t}(t,r._getViewDescriptor(),r._getFetchXml(),null===(e=r.context)||void 0===e?void 0:e.EventManager);r.setState({editedViewDescriptor:n,editedFetchXml:n.fetchXML,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},iconProps:{iconName:"Delete"},ariaLabel:r.props.columnEditorStrings.fieldContextMenuRemove}),t>0&&d.push({key:"MoveUp"+e.name,text:r.props.columnEditorStrings.moveUp,onClick:function(){return r._updateColumnOrder(t,t-1)},iconProps:{iconName:"Up"},ariaLabel:r.props.columnEditorStrings.moveUp}),t!==a.length-1&&d.push({key:"MoveDown"+e.name,text:r.props.columnEditorStrings.moveDown,onClick:function(){r._updateColumnOrder(t,t+1),document.getElementById(r._activeEllipsisId).focus()},iconProps:{iconName:"Down"},ariaLabel:r.props.columnEditorStrings.moveDown}),o.createElement(A,{key:e.name,index:t,moveField:r._updateColumnOrder,menuItems:d,columnEditorStyles:r.props.columnEditorStyles,displayName:n,displayIconName:i,moreOptionsString:r.props.columnEditorStrings.moreOptions,setActiveEllipsis:r._setActiveEllipsis})}},r._updateColumnOrder=function(e,t){var n=r._getViewDescriptor(),i=Object(f.d)(n);i.splice(t,0,i.splice(e,1)[0]),n.grid.rows[0].cells=i,r.setState({editedViewDescriptor:n,viewEdited:!0,resetToDefaultEnabled:!0,resetClick:!1})},r._setActiveEllipsis=function(e){r._activeEllipsisId=e},r.state={columnEditorCalloutOpen:!1,editedViewDescriptor:null,editedFetchXml:"",viewEdited:!1,resetToDefaultEnabled:!1,resetClick:!1},r}return Object(i.__extends)(t,e),t.prototype.componentDidMount=function(){var e;null===(e=this.context)||void 0===e||e.EventManager.ReportComponentSuccess(fe,"Open")},t.prototype.render=function(){return o.createElement(se.a,{isOpen:this.props.columnEditorPanelOpen,title:this.props.columnEditorStrings.editColumns,closeButtonAriaLabel:this.props.columnEditorStrings.close,onRenderNavigation:this._renderPanelHeader,onDismiss:this.props.columnEditorPanelDismiss,onRenderBody:this._renderPanelBody,layerProps:{eventBubblingEnabled:!0}})},t.prototype._applyChangesToView=function(){var e,t,r=this._getViewDescriptor(),n=this.props.gridInput.pageToEditedViewMapId?this.props.gridInput.pageToEditedViewMapId:p.a.newGuid(),o=Object(i.__assign)(Object(i.__assign)({},this.props.gridInput),{pageToEditedViewMapId:n});this.props.updatePageInput(o,this.props.pageId);var a=!0;if(this.state.resetClick){a=!1;var l=this._getFetchXml();this.props.removeEditedViewPageMap(n.guid,this.props.viewId),this.props.isAdvancedFindFilterEdited&&this.props.updateEditedViewPageMap(n.guid,this.props.viewId,l)}else this.props.updateEditedViewPageMap(n.guid,this.props.viewId,this._getFetchXml(),r.grid);this.props.onViewChanged(this.props.viewId.guid,this.props.entityTypeName),this.setState({editedViewDescriptor:null,viewEdited:!1,editedFetchXml:"",resetToDefaultEnabled:a,resetClick:!1}),this.props.columnEditorPanelDismiss(),null===(t=null===(e=this.context)||void 0===e?void 0:e.EventManager)||void 0===t||t.ReportComponentSuccess(Object(I.G)(fe,"Apply"))},t}(o.Component);var he=Object(l.a)((function(e,t){var r,n,o,a,l,s,d=Object(y.h)(e,t.entityTypeName),c=Object(k.qb)(e,t.viewId,t.pageId),u=Object(M.c)(e,t.viewId),p=(o={panelNavigationContainerStyle:{display:"flex",flexDirection:"row"},panelNavigationHeaderStyle:{fontWeight:600,fontSize:"20px",width:"100%"},root:{width:"100%",display:"flex",flexDirection:"column",paddingLeft:"0px",paddingRight:"0px",overflowY:"auto"},header:{paddingLeft:"16px",paddingRight:"16px",display:"flex",flexDirection:"column"},addButton:{},searchContainer:{display:"inline",minHeight:"32px",width:"180px",marginBottom:"12px",background:"white"},list:{display:"flex",minHeight:"5em",flexDirection:"column",flexGrow:1,overflowY:"auto",overflowX:"hidden",borderTop:"1px solid #c8c6c4"},addColumnHeaderRoot:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"hidden",padding:"16px",borderBottomColor:"#f3f2f1"},addColumnHeaderTitle:{flex:"1",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#201f1e",fontSize:"14px",fontWeight:"bold"},addColumncloseButton:{color:"#201f1e",width:"16px",height:"16px",fontSize:"16px"},focusZone:{display:"flex",flex:"1 0 auto"},panelBody:{flexDirection:"column"},applyCancelStack:{position:"absolute",bottom:"10px"},attributeList:{overflowY:"auto",maxHeight:"180px",mariginBottom:"16px",display:"flex",flexDirection:"column"},attributeIcon:{fontSize:"16px",marginTop:"8px"},attributeLabel:{fontSize:"14px",whiteSpace:"nowrap",TextOverflow:"ellipsis",textAlign:"left",flexGrow:1,overflow:"hidden",cursor:"pointer"},attributeContainer:{display:"flex",":hover":{backgroundColor:"#f3f2f1"},":focus":{backgroundColor:"#f3f2f1"},cursor:"pointer"},searchBox:{minWidth:0,background:"white",width:"180px",borderRight:"0px",borderRadius:"0px",selectors:{"&:after":{content:'""',position:"absolute",right:"0px",top:"5px",bottom:"5px",borderRight:"1px solid #a19f9d"},"&:hover":{borderRight:"1px solid #323130"},"&.is-active, &:focus":{borderRight:"1px solid #742774"},"&:hover:after, &.is-active:after, &:focus:after":{display:"none"}}},treeView:{root:{backgroundColor:"white"},scrollView:{overflowX:"hidden"}},filterStyle:{root:{width:"101px",left:"-1px",position:"relative",selectors:{"&:hover .ms-Dropdown-title":{borderLeft:"1px solid '#323130'"},"&:focus .ms-Dropdown-title":{borderLeft:"1px solid #742774"}}},title:{borderLeft:"1px solid transparent",background:"transparent"}},addColumnButton:{root:{marginLeft:"10px"}},pivot:{link:{lineHeight:30,height:30,maxWidth:150},linkIsSelected:{paddingLeft:0,lineHeight:30,height:30,selectors:{":before":{borderRadius:1,left:0}},maxWidth:150},text:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}}},function(e,t){var r,n,a,l,s,d=Object(i.__assign)(Object(i.__assign)({},o.panelNavigationContainerStyle),{margin:t?"24px 16px 0 24px":"24px 24px 0 16px"}),c=Object(i.__assign)(Object(i.__assign)({},o.searchContainer),((r={})["margin"+(t?"Right":"Left")]="16px",r)),u=Object(i.__assign)(Object(i.__assign)({},o.panelBody),{margin:t?"0 16px 24px 25px":"0 25px 24px 16px"}),p=Object(i.__assign)(Object(i.__assign)({},o.applyCancelStack),((n={})[t?"left":"right"]="10px",n)),m=Object(i.__assign)(Object(i.__assign)({},o.attributeList),((a={})["margin"+(t?"Right":"Left")]="16px",a)),g=Object(i.__assign)(Object(i.__assign)({},o.attributeIcon),((l={})["margin"+(t?"Left":"Right")]="6px",l)),f=Object(i.__assign)(Object(i.__assign)({},o.attributeLabel),{textAlign:t?"right":"left"}),y=Object(i.__assign)(Object(i.__assign)({},o.addButton),{margin:t?"0 auto 0 0":"0 0 0 auto"});return o.pivot.link=Object(i.__assign)(Object(i.__assign)({},o.pivot.link),((s={})["padding"+(t?"Right":"Left")]="0px",s)),Object(i.__assign)(Object(i.__assign)({},o),{panelNavigationContainerStyle:d,searchContainer:c,panelBody:u,applyCancelStack:p,attributeList:m,attributeIcon:g,attributeLabel:f,addButton:y})}),m=Object(b.a)(e),g=Object(E.g)(e),f=(s=Object(ge.h)(),function(e,t){var r=s(e,t);if(!a||r!==a){var n={};for(var i in me.a)n[i]=Object(ge.c)(r,me.a[i]);a=r,l=n}return l})(e,me.e),v=!!(null===(n=Object(k.rb)(e,null===(r=t.gridInput.pageToEditedViewMapId)||void 0===r?void 0:r.guid,t.viewId.guid))||void 0===n?void 0:n.gridDescriptor);return{manyToOneRelationships:Object(y.A)(e,null==d?void 0:d.EntityLogicalName),viewDescriptor:c,getEntityAttributes:function(t){return void 0===t&&(t=d&&d.EntityLogicalName),Object(h.d)(e,t)},entityMetadata:d,getAttributeDescriptor:function(t,r){return Object(h.a)(e,t,r)},getEntityDisplayName:function(t){var r=Object(y.h)(e,t);return(null==r?void 0:r.DisplayName)||""},getLinkedEntityAttributeDisplayName:function(t,r,n){var i=Object(k.E)(e,r),o=(new DOMParser).parseFromString(n,"text/xml"),a=o?o.getElementsByTagName("link-entity"):null,l=Object(h.d)(e,t.relatedEntityName);return Object(pe.w)(e,t,i,a,l)},columnEditorStyles:p(m,g),view:u,columnEditorStrings:f,columnChanges:v,getResourceStringById:function(t){return Object(ge.b)(e,t)}}}),(function(e,t){return{retrieveEntity:function(t){e(Object(T.f)(t,!0,[])).then((function(e){return e}))},updateEditedViewPageMap:function(t,r,n,i){return e(Object(R.d)(t,r.guid,n,i))},removeEditedViewPageMap:function(t,r){return e(Object(R.c)(t,r.guid))}}}))(ye);ye.contextType=ie.a}}]),window.bundleExecutionMarkers["scripts/es5/ColumnEditor.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();