(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/es5/businessprocesspagewrapper.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[49],{pG8E:function(e,t,a){"use strict";a.r(t),a.d(t,"BusinessProcessPageWrapper",(function(){return B}));var s=a("r0tX"),r=a("9r0m"),i=a("WS0f"),n=a("9rlF"),o=a("nbQV"),c=a("TCcM"),p=a("T576"),d=a("QAhb"),l=a("A/RO"),g=a("Kdvm"),u=a("4HtA"),h=a("r3Bs"),y=a("LdMy"),b=a("sOTk"),P=a("mLFd"),f=a("G7N+"),_=a("ed60"),w=a("uwKl"),I=a("DUDQ"),m=a("lFQy"),C=a("HSdq"),O=a("UWFM"),v=a("fFhm"),E=a("b1hT"),F=a("lMVv"),j=a("2ojE"),T=a("LhJP"),M="BusinessProcessPageWrapper.ShouldPerformFormSave",B=function(){function e(e,t,a){this._getState||(this._applicationContext=e,this._getState=t,this._dispatch=a,this._businessProcessFlowWrapperIdentifierFactory=new g.a,this._businessProcessFlowWrapperFactory=new l.a(t,this._businessProcessFlowWrapperIdentifierFactory,e))}return e.prototype.getBusinessProcessFlowWrapper=function(e,t){if(this._reloadDataIfRequired(e,t),O.a.Instance.getProcessManagerByPageId(e))return this._businessProcessFlowWrapperFactory.generate(e,O.a.Instance.getProcessManagerByPageId(e));var a=this._applicationContext.TraceManager.getTracer(M),s=this._getCurrentFormEntity(t),r=Object(j.a)(this._getState(),s,e,this._applicationContext);return a.warn("BusinessprocessPageWrapper: Not able to generate BusinessProcessFlowWrapper",r),null},e.prototype.getProcessManager=function(e,t){return this._reloadDataIfRequired(e,t),O.a.Instance.getProcessManagerByPageId(e)},e.prototype.getCurrentProcessManagerWithoutInit=function(e){var t=O.a.Instance.getProcessManagerByPageId(e);if(!t){t=new u.a(this._applicationContext,this._getState,this._dispatch,new y.a,new h.a),O.a.Instance.setProcessManagerByPageId(e,t);var a=this._applicationContext.TraceManager.getTracer(M),s=[],r={name:"PageId",value:e};s.push(r),a.warn("BusinessprocessPageWrapper: currentprocessmanager is not available in the collection.Generated a processmanager.",s)}return t},e.prototype.hasChanged=function(e,t,a,s){if(Object(E.g)(e)&&(!Object(E.d)(e)||Object(E.c)(e,s)))return!0;if(!t)return!1;var r=new d.a(t.entityTypeName,t.id),n=Object(p.f)(e,r);return!Object(i.a)(n)&&(!a||!a.instanceModifiedTimestamp||n>a.instanceModifiedTimestamp)||this._needsDockedModeRefresh(a,t,s)},e.prototype._reloadDataIfRequired=function(e,t){var a,s,n=this._getState(),o=null,p=null,l=!1;if(Object(C.Kb)(n,e)){var g=this._applicationContext.TraceManager.getTracer(M),b=this._getCurrentFormEntity(t),f=Object(j.a)(this._getState(),b,e,this._applicationContext);g.info("BusinessprocessPageWrapper: BPF supported only for editform. ProcessManager not initialized",f)}else(o=O.a.Instance.getProcessManagerByPageId(e))||(o=new u.a(this._applicationContext,this._getState,this._dispatch,new y.a,new h.a)),a=o.getCurrentFormEntity()&&o.getCurrentFormEntity().id&&!r.a.equals(o.getCurrentFormEntity().id,r.a.EMPTY)?o.getCurrentFormEntity():new d.a(t.entityTypeName,t.id),Object(i.a)(a)||(p=Object(c.b)(a)(n,a.etn))&&(l=p.refreshGlobalNavigationData),s=!!(o.getCurrentFormEntity()&&o.getCurrentFormEntity().id&&t&&r.a.equals(o.getCurrentFormEntity().id,a.id)),(l||!o.getInstanceModifiedTimestamp()||!s||this._hasProcessChanged(e,t,o)||Object(E.g)(n)&&(!Object(E.d)(n)||Object(E.c)(n,e)))&&(p&&p.refreshGlobalNavigationData&&this._dispatch(Object(P.b)(!1,a)),this._reloadData(e))},e.prototype._reloadData=function(e){var t=this._getState(),a=null;(a=O.a.Instance.getProcessManagerByPageId(e))||(a=new u.a(this._applicationContext,this._getState,this._dispatch,new y.a,new h.a));var s=Object(b.g)(t,e);if(s){var i=s.id,n=new d.a(s.entityTypeName,i),o=Object(v.a)(s,t);if(!o||!s.processId||s.processInstanceId||!o.processId||r.a.equals(o.processId,r.a.tryParseOrNull(s.processId)))if(o&&o.processId&&!r.a.equals(o.processId,r.a.EMPTY))if(!Object(E.g)(t)||Object(E.d)(t)&&!Object(E.c)(t,e))this._reloadProcessManager(a,e,o,s);else{var c=Object(j.a)(this._getState(),n,e,this._applicationContext);a.isVisible()&&a.setVisible(!1),a.initilaizeWithFormEntityOnly(n,e),Object(j.c)(T.e,c,this._applicationContext)}else{this._dispatch(Object(_.b)(r.a.EMPTY,n)),this._dispatch(Object(w.b)(r.a.EMPTY,n));var p=this._applicationContext.TraceManager.getTracer(M),l=Object(j.a)(this._getState(),n,e,this._applicationContext);p.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",l),a.initilaizeWithFormEntityOnly(n,e)}}},e.prototype._reloadProcessManager=function(e,t,a,s){var n,c=this._getState(),l=new d.a(s.entityTypeName,s.id),g=Object(o.b)(c,a.processId);if(Object(i.a)(g)||Object(i.a)(g.businessProcessFlowUniqueName)||!Object(f.b)(g.initialized)){b=this._applicationContext.TraceManager.getTracer(M),P=Object(j.a)(this._getState(),l,t,this._applicationContext);a&&a.processId&&!r.a.equals(a.processId,r.a.EMPTY)?b.info("BusinessprocessPageWrapper: BPF not available for the record since BPF is not included in appmodule . Processmanager initialized with entity only.",P):b.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",P),e.initilaizeWithFormEntityOnly(l,t)}else{var u=new d.a(g.businessProcessFlowUniqueName,a.processInstanceId);if(n=Object(p.b)(c,u),a.isCrossEntityCreate&&!a.isEntityCreate&&a.processId&&a.processInstanceId&&this._moveToNextStageForCrossEntityBPF(n,s,t),!a.isCrossEntityCreate&&a.isEntityCreate&&r.a.equals(a.processInstanceId,r.a.EMPTY)){var h=Object(E.b)(g);if(e.getProcessInstanceId()||this._dispatch(Object(m.a)(null,u)),h&&h.stage&&h.stage.stageId){var y=Object(E.a)(h);this._dispatch(Object(I.b)(u,y)),n=y.fields}}if(n&&(a.isCrossEntityCreate&&!r.a.equals(a.processId,r.a.EMPTY)&&!r.a.equals(a.processInstanceId,r.a.EMPTY)||!a.isCrossEntityCreate&&a.isEntityCreate&&r.a.equals(a.processInstanceId,r.a.EMPTY)||a.isCrossEntityNavigate||this._CheckifRecordHasAssociatedBPF(n,l,c))&&e.initilaizeWithProcessAndFormEntity(n,g,l,a.processId,u,t),Object(i.a)(n)||a.isEditRecord&&!this._CheckifRecordHasAssociatedBPF(n,l,c)){var b=this._applicationContext.TraceManager.getTracer(M),P=Object(j.a)(this._getState(),l,t,this._applicationContext);b.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",P),e.initilaizeWithFormEntityOnly(l,t)}}},e.prototype._hasProcessChanged=function(e,t,a){var s=a.getProcessId()||r.a.EMPTY,i=this._getState(),n=new d.a(t.entityTypeName,t.id),p=Object(b.g)(i,e),l=r.a.EMPTY;if(l=p.processId?p.processId?new r.a(p.processId):Object(c.e)(i,n)||r.a.EMPTY:p.data&&p.data.processid?new r.a(p.data.processid):Object(c.e)(i,n)||r.a.EMPTY,!r.a.equals(l,s))return!0;if(r.a.equals(l,r.a.EMPTY))return!1;var g=Object(o.b)(i,l);return!!g&&a.getVersion()<g.businessProcessFlowProcessVersion},e.prototype._needsDockedModeRefresh=function(e,t,a){var r=O.a.Instance.getProcessManagerByPageId(a);return(!r||r.getDisplayState()===s.a.expanded)&&e.isFormInactive!==Object(C.Lb)(this._getState(),t.entityTypeName,t.id)},e.prototype._moveToNextStageForCrossEntityBPF=function(e,t,a){var s=e.activestageid,i=e.traversedpath,n=t.data.nextStageId;if(n&&!r.a.equals(s.reference.id,new r.a(n))){s.reference=new d.a("processstage",new r.a(n)),i.value=i.value+","+n,e.activestagestartedon.value=new Date;var o=this._applicationContext.TraceManager.getTracer(M),c=this._getCurrentFormEntity(t),p=Object(j.a)(this._getState(),c,a,this._applicationContext);o.info("BusinessprocessPageWrapper: crossentity create scenario. set the new travseredpath on client side",p)}},e.prototype._CheckifRecordHasAssociatedBPF=function(e,t,a){var s=Object(F.h)(a,t.etn);if(s&&s.IsBPFEntity)return!0;for(var i in e)if(Object(n.k)(e[i])&&e[i].reference&&e[i].reference.id&&e[i].reference.etn===t.etn&&(r.a.equals(e[i].reference.id,t.id)||r.a.equals(e[i].reference.id,r.a.EMPTY))&&Object(E.e)(i))return!0;return!1},e.prototype._getCurrentFormEntity=function(e){return e&&e.entityTypeName?new d.a(e.entityTypeName,e.id):null},e}()}}]),window.bundleExecutionMarkers["scripts/es5/businessprocesspagewrapper.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();