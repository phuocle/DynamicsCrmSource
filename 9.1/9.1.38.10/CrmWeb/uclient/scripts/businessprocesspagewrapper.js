(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/businessprocesspagewrapper.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[48],{esKF:function(e,t,s){"use strict";s.r(t),s.d(t,"BusinessProcessPageWrapper",(function(){return x}));var a=s("TAjd"),i=s("SAYH"),n=s("504W"),r=s("WPtp"),o=s("CPoS"),c=s("5Oca"),p=s("+nNZ"),d=s("odYE"),l=s("0PSL"),g=s("23K5"),h=s("bJaF"),u=s("KGWS"),P=s("ccIw"),b=s("arV0"),_=s("rodW"),y=s("eXjw"),w=s("k1f1"),f=s("AFlp"),I=s("c7jw"),m=s("53SR"),C=s("i1f0"),O=s("ftQm"),j=s("fpVH"),E=s("2Ct/"),F=s("iZ7K"),T=s("D4Jo"),M=s("JF0K");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const B="BusinessProcessPageWrapper.ShouldPerformFormSave";class x{constructor(e,t,s){this._getState||(this._applicationContext=e,this._getState=t,this._dispatch=s,this._businessProcessFlowWrapperIdentifierFactory=new g.a,this._businessProcessFlowWrapperFactory=new l.a(t,this._businessProcessFlowWrapperIdentifierFactory,e))}getBusinessProcessFlowWrapper(e,t){if(this._reloadDataIfRequired(e,t),O.a.Instance.getProcessManagerByPageId(e))return this._businessProcessFlowWrapperFactory.generate(e,O.a.Instance.getProcessManagerByPageId(e));const s=this._applicationContext.TraceManager.getTracer(B),a=this._getCurrentFormEntity(t),i=Object(T.a)(this._getState(),a,e,this._applicationContext);return s.warn("BusinessprocessPageWrapper: Not able to generate BusinessProcessFlowWrapper",i),null}getProcessManager(e,t){return this._reloadDataIfRequired(e,t),O.a.Instance.getProcessManagerByPageId(e)}getCurrentProcessManagerWithoutInit(e){let t=O.a.Instance.getProcessManagerByPageId(e);if(!t){t=new h.a(this._applicationContext,this._getState,this._dispatch,new P.a,new u.a),O.a.Instance.setProcessManagerByPageId(e,t);const s=this._applicationContext.TraceManager.getTracer(B),a=[],i={name:"PageId",value:e};a.push(i),s.warn("BusinessprocessPageWrapper: currentprocessmanager is not available in the collection.Generated a processmanager.",a)}return t}hasChanged(e,t,s,a){if(Object(E.g)(e)&&(!Object(E.d)(e)||Object(E.c)(e,a)))return!0;if(!t)return!1;const i=new d.a(t.entityTypeName,t.id),r=Object(p.f)(e,i);return!Object(n.a)(r)&&(!s||!s.instanceModifiedTimestamp||r>s.instanceModifiedTimestamp)||this._needsDockedModeRefresh(s,t,a)}_reloadDataIfRequired(e,t){const s=this._getState();let a=null,r=null,o=null,p=!1,l=!1;if(Object(C.Kb)(s,e)){const s=this._applicationContext.TraceManager.getTracer(B),a=this._getCurrentFormEntity(t),i=Object(T.a)(this._getState(),a,e,this._applicationContext);s.info("BusinessprocessPageWrapper: BPF supported only for editform. ProcessManager not initialized",i)}else a=O.a.Instance.getProcessManagerByPageId(e),a||(a=new h.a(this._applicationContext,this._getState,this._dispatch,new P.a,new u.a)),r=a.getCurrentFormEntity()&&a.getCurrentFormEntity().id&&!i.a.equals(a.getCurrentFormEntity().id,i.a.EMPTY)?a.getCurrentFormEntity():new d.a(t.entityTypeName,t.id),Object(n.a)(r)||(o=Object(c.b)(r)(s,r.etn),o&&(p=o.refreshGlobalNavigationData)),l=!!(a.getCurrentFormEntity()&&a.getCurrentFormEntity().id&&t&&i.a.equals(a.getCurrentFormEntity().id,r.id)),(p||!a.getInstanceModifiedTimestamp()||!l||this._hasProcessChanged(e,t,a)||Object(E.g)(s)&&(!Object(E.d)(s)||Object(E.c)(s,e)))&&(o&&o.refreshGlobalNavigationData&&this._dispatch(Object(_.b)(!1,r)),this._reloadData(e))}_reloadData(e){const t=this._getState();let s=null;s=O.a.Instance.getProcessManagerByPageId(e),s||(s=new h.a(this._applicationContext,this._getState,this._dispatch,new P.a,new u.a));const a=Object(b.g)(t,e);if(!a)return;const n=a.id,r=new d.a(a.entityTypeName,n),o=Object(j.a)(a,t);if(!o||!a.processId||a.processInstanceId||!o.processId||i.a.equals(o.processId,i.a.tryParseOrNull(a.processId)))if(o&&o.processId&&!i.a.equals(o.processId,i.a.EMPTY))if(!Object(E.g)(t)||Object(E.d)(t)&&!Object(E.c)(t,e))this._reloadProcessManager(s,e,o,a);else{const t=Object(T.a)(this._getState(),r,e,this._applicationContext);s.isVisible()&&s.setVisible(!1),s.initilaizeWithFormEntityOnly(r,e),Object(T.c)(M.e,t,this._applicationContext)}else{this._dispatch(Object(w.b)(i.a.EMPTY,r)),this._dispatch(Object(f.b)(i.a.EMPTY,r));const t=this._applicationContext.TraceManager.getTracer(B),a=Object(T.a)(this._getState(),r,e,this._applicationContext);t.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",a),s.initilaizeWithFormEntityOnly(r,e)}}_reloadProcessManager(e,t,s,a){const r=this._getState();let c;const l=new d.a(a.entityTypeName,a.id),g=Object(o.b)(r,s.processId);if(Object(n.a)(g)||Object(n.a)(g.businessProcessFlowUniqueName)||!Object(y.b)(g.initialized)){const a=this._applicationContext.TraceManager.getTracer(B),n=Object(T.a)(this._getState(),l,t,this._applicationContext);s&&s.processId&&!i.a.equals(s.processId,i.a.EMPTY)?a.info("BusinessprocessPageWrapper: BPF not available for the record since BPF is not included in appmodule . Processmanager initialized with entity only.",n):a.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",n),e.initilaizeWithFormEntityOnly(l,t)}else{const o=new d.a(g.businessProcessFlowUniqueName,s.processInstanceId);if(c=Object(p.b)(r,o),s.isCrossEntityCreate&&!s.isEntityCreate&&s.processId&&s.processInstanceId&&this._moveToNextStageForCrossEntityBPF(c,a,t),!s.isCrossEntityCreate&&s.isEntityCreate&&i.a.equals(s.processInstanceId,i.a.EMPTY)){const t=Object(E.b)(g);if(e.getProcessInstanceId()||this._dispatch(Object(m.a)(null,o)),t&&t.stage&&t.stage.stageId){const e=Object(E.a)(t);this._dispatch(Object(I.b)(o,e)),c=e.fields}}if(c&&(s.isCrossEntityCreate&&!i.a.equals(s.processId,i.a.EMPTY)&&!i.a.equals(s.processInstanceId,i.a.EMPTY)||!s.isCrossEntityCreate&&s.isEntityCreate&&i.a.equals(s.processInstanceId,i.a.EMPTY)||s.isCrossEntityNavigate||this._CheckifRecordHasAssociatedBPF(c,l,r))&&e.initilaizeWithProcessAndFormEntity(c,g,l,s.processId,o,t),Object(n.a)(c)||s.isEditRecord&&!this._CheckifRecordHasAssociatedBPF(c,l,r)){const s=this._applicationContext.TraceManager.getTracer(B),a=Object(T.a)(this._getState(),l,t,this._applicationContext);s.info("BusinessprocessPageWrapper: BPF not available for the record. Processmanager initialized with entity only.",a),e.initilaizeWithFormEntityOnly(l,t)}}}_hasProcessChanged(e,t,s){const a=s.getProcessId()||i.a.EMPTY,n=this._getState(),r=new d.a(t.entityTypeName,t.id),p=Object(b.g)(n,e);let l=i.a.EMPTY;if(l=p.processId?p.processId?new i.a(p.processId):Object(c.e)(n,r)||i.a.EMPTY:p.data&&p.data.processid?new i.a(p.data.processid):Object(c.e)(n,r)||i.a.EMPTY,!i.a.equals(l,a))return!0;if(i.a.equals(l,i.a.EMPTY))return!1;const g=Object(o.b)(n,l);return!!g&&s.getVersion()<g.businessProcessFlowProcessVersion}_needsDockedModeRefresh(e,t,s){const i=O.a.Instance.getProcessManagerByPageId(s);return(!i||i.getDisplayState()===a.a.expanded)&&e.isFormInactive!==Object(C.Lb)(this._getState(),t.entityTypeName,t.id)}_moveToNextStageForCrossEntityBPF(e,t,s){const a=e.activestageid,n=e.traversedpath,r=t.data.nextStageId;if(r&&!i.a.equals(a.reference.id,new i.a(r))){a.reference=new d.a("processstage",new i.a(r)),n.value=n.value+","+r;e.activestagestartedon.value=new Date;const o=this._applicationContext.TraceManager.getTracer(B),c=this._getCurrentFormEntity(t),p=Object(T.a)(this._getState(),c,s,this._applicationContext);o.info("BusinessprocessPageWrapper: crossentity create scenario. set the new travseredpath on client side",p)}}_CheckifRecordHasAssociatedBPF(e,t,s){const a=Object(F.h)(s,t.etn);if(a&&a.IsBPFEntity)return!0;for(const s in e)if(Object(r.k)(e[s])&&e[s].reference&&e[s].reference.id&&e[s].reference.etn===t.etn&&(i.a.equals(e[s].reference.id,t.id)||i.a.equals(e[s].reference.id,i.a.EMPTY))&&Object(E.e)(s))return!0;return!1}_getCurrentFormEntity(e){return e&&e.entityTypeName?new d.a(e.entityTypeName,e.id):null}}}}]),window.bundleExecutionMarkers["scripts/businessprocesspagewrapper.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();