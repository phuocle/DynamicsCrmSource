(window.bundleExecutionMarkers=window.bundleExecutionMarkers||{})["scripts/previewsync.js?v=1.4.9962-v91onpremise"]={begin:performance.now()},(window.__wpJsonpUci=window.__wpJsonpUci||[]).push([[26],{"0PSL":function(t,e,s){"use strict";s.d(e,"a",(function(){return y}));var a,n=s("SAYH"),i=s("hvSt");!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive",t[t.Completed=2]="Completed"}(a||(a={}));var r=s("CPoS"),o=s("xMtD"),c=s("odYE"),l=s("VnpK"),u=s("S2mk"),h=s("LbMF"),d=s("+nNZ"),g=s("i1f0"),p=s("dHD5"),f=s("iZ7K"),_=s("504W"),m=s("Lyxw"),b=s("9fGf"),P=s("arV0"),v=s("WRF3"),S=s("fU7K");class y{constructor(t,e,s){this._memorizedExtraFilters=[],this._getState=t,this._businessProcessFlowWrapperIdentifierFactory=e,this._context=s}generate(t,e){return e?this._getBusinessProcessFlowWrapper(t,e):null}_getBusinessProcessFlowWrapper(t,e){const s=this._getState(),a=this._businessProcessFlowWrapperIdentifierFactory.generate(t,e);if(!a||!e||!e.getProcessId())return null;const i=e.getCurrentFormEntity(),c=Object(P.g)(s,t);this._navigationEntities=e.getNavigationEntities();const l=Object(d.f)(s,i);return{id:e.getProcessId(),instanceId:e.getProcessInstanceId(),name:Object(r.c)(s,e.getProcessId()),bpfEntityLogicalName:e.getBpfEntityLogicalName(),stages:this._getStages(a.data.activePath,a.activeStageId,a.data.selectedStageId,t,e),relationships:Object(o.e)(this._getState(),e.getProcessId()),activeStageId:a.activeStageId,selectedStageId:a.data.selectedStageId,activePath:a.data.activePath,displayState:a.displayState,currentEntity:new v.a(i.etn,n.a.toLegacyGuid(i.id)),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),statusName:e.getStatusName(),isFormInactive:Object(g.Lb)(s,c.entityTypeName,c.id),delegates:this._getActions(e),isVisible:e.isVisible(),actionLogs:a.data.actionLogCollection,instanceModifiedTimestamp:l,instanceName:e.getProcessInstanceName(),isCustomControlsPresent:e.getCustomControlIndicator(),isRenderedFromFormXml:e.getFormXmlRenderingIndicator(),isImmersiveBPF:e.isImmersiveBPF()}}_getStages(t,e,s,a,i){if(!t||0===t.length)return null;const r={},o=[];return t.forEach((t,c)=>{r[t.guid]=c;const l=n.a.equals(t,s),u=this._getStageWrapper(t,l,e,r,a,i);u&&o.push(u)}),o}_getStageWrapper(t,e,s,a,i,r){const c=Object(o.c)(this._getState(),r.getProcessId(),t);if(!c)return null;let l=e&&this._getSteps(c,i,r)||[];if(Object(m.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){const t="BusinessProcessFlow.CustomControlConfiguration",e=this._context.TraceManager.getTracer(t),s=Object(o.a)(this._getState(),r.getProcessId(),e);if(!Object(_.a)(s)&&!Object(_.a)(s.ControlConfigurations)){const a=r.getTelemetryParams();if(a.push({name:"BPFEntityFormId",value:s.Id.guid},{name:"BPFEntityFormType",value:s.FormType}),Object(_.a)(s.ControlConfigurations)||a.push({name:"CustomControls",value:Object.keys(s.ControlConfigurations).length}),r.isBpfFormDescriptorValid(this._getState(),r.getProcessId(),s,e))try{if(!Object(_.a)(s.ControlConfigurations)){const u=Object(o.b)(s,e),h=s.ControlConfigurations,d=this._getNonDefaultControlConfiguration(h);if(Object(m.c)(this._getState(),"FCB.EnableBPFCCPhase3")){const e=this._buildStepsFromFormXml(c,s,d,a,i,r);e&&e.length>0&&(l=e,r.setFormXmlRenderingIndicator(!0),this._context.EventManager.ReportComponentSuccess(t,a))}else Object(_.a)(u)||Object.keys(u).forEach(s=>{if(u[s].ParentCellId){const i=new n.a(u[s].ParentCellId);if((c&&c.stage&&c.stage.steps?c.stage.steps.map(t=>t.stepId.guid).indexOf(i.guid):-1)>=0&&i){const o=[];o.push({name:"StepId",value:i.guid},{name:"NonDefaultControlUniqueId",value:u[s].UniqueId}),e.info("Non-default control found for step",o);let h=null;d&&u[s].UniqueId&&(r.setFormXmlRenderingIndicator(!0),h=d[u[s].UniqueId]?d[u[s].UniqueId]:null);const g={attributeName:u[s].DataFieldName,isRequired:this._getIsStepRequired(i.guid,c),name:u[s].Label,stepId:new n.a(i.guid),stepType:"field",attributeType:this._getMetadataTypeByAttribute(c.entityLogicalName,u[s].DataFieldName),controlName:"header_process_"+u[s].Label,isVisible:u[s].Visible,isControlDisabled:u[s].Disabled,nonDefaultConfiguration:h};l.push(g),Object(_.a)(g.stepId.guid)||g.stepId.guid===n.a.EMPTY.guid||a.push({name:"StepId",value:g.stepId.guid}),a.push({name:"AttributeName",value:g.attributeName},{name:"AttributeType",value:g.attributeType},{name:"IsRequired",value:g.isRequired},{name:"NonDefaultControlUniqueId",value:u[s].UniqueId}),Object(_.a)(h)?this._context.EventManager.ReportComponentFailure(t,new Error("CustomControlConfiguration is null or undefined even though the BPF entity form XML is valid and contains non-default custom control descriptors"),null,a):(r.setCustomControlIndicator(!0),a.push({name:"CustomControlId",value:h.CustomControlId}),!Object(_.a)(h.Name)&&h.Name.indexOf("MscrmControls")>=0&&a.push({name:"CustomControlName",value:h.Name}),this._context.EventManager.ReportComponentSuccess(t,a))}}})}}catch(s){e.error(`Message: ${s.message}, Stack: ${s.stack}`,a),this._context.EventManager.ReportComponentFailure(t,s,null,a)}else this._context.EventManager.ReportComponentFailure(t,new Error("Invalid FormXML - Fallback invoked"),null,a)}}return{id:c.stage.stageId,name:c.stage.stageDisplayName,entityName:c.entityLogicalName,entityDisplayName:Object(f.f)(this._getState(),c.entityLogicalName)||c.entityDisplayName,relatedEntityReference:this._getRelatedEntityReference(c.entityLogicalName),referencingAttributeName:c.referencingAttributeName,status:this._getStageStatus(a[t.guid],a[s.guid],r),steps:l}}_buildStepsFromFormXml(t,e,s,a,i,r){const o=[],c=e.Controls;return!Object(_.a)(c)&&this._areStepsValid(t,e,a)&&Object.keys(c).forEach(l=>{if(!Object(_.a)(c[l])&&c[l].ParentCellId){const u=new n.a(c[l].ParentCellId),h=e.Tabs.find(t=>t.Id===c[l].ParentTabId);if(h&&!Object(_.a)(h.RawTabId)&&t.stage.stageId.guid===new n.a(h.RawTabId).guid){let h=null;s&&c[l].UniqueId!==n.a.EMPTY.guid&&(h=s[c[l].UniqueId]?s[c[l].UniqueId]:null);const d=this._retrieveControlName(c[l],t.stage.steps),p=this._getUIControl(i,d),f={attributeName:c[l].DataFieldName,isRequired:c[l].IsRequired,name:this._retrieveStepLabel(c[l],p,t.stage.steps),stepId:new n.a(u.guid),stepType:this._getStepTypeFromControlKey(l),attributeType:this._getMetadataTypeByAttribute(t.entityLogicalName,c[l].DataFieldName),controlName:d,isVisible:p&&!Object(_.a)(p.visible)?p.visible:c[l].Visible,isControlDisabled:c[l].Disabled||Object(g.t)(this._getState(),{id:i,controlName:d},r.getContextToken()),viewId:p&&p.parameters&&p.parameters.defaultviewid?p.parameters.defaultviewid:null,nonDefaultConfiguration:Object(_.a)(h)?null:h};f.config=this._getConfig(e,r,c[l],i,a),f.viewId&&f.config&&f.config.Parameters&&f.config.Parameters.value&&(f.config.Parameters.value.ViewId=f.viewId,p&&p.customFilter&&p.customFilter.length>0&&(this._applyLookupFilter(f,p),f.config.Parameters.value.ExtraFilters=f.extraFilters)),o.push(f),a.push({name:"StepId",value:f.stepId.guid},{name:"AttributeName",value:f.attributeName},{name:"AttributeType",value:f.attributeType},{name:"IsRequired",value:f.isRequired},{name:"NonDefaultControlUniqueId",value:c[l].UniqueId}),Object(_.a)(h)||c[l].UniqueId===n.a.EMPTY.guid||(r.setCustomControlIndicator(!0),a.push({name:"CustomControlId",value:h.CustomControlId}),!Object(_.a)(h.Name)&&h.Name.indexOf("MscrmControls")>=0&&a.push({name:"CustomControlName",value:h.Name}))}}}),o}_areStepsValid(t,e,s){if(!(Object(_.a)(e)||Object(_.a)(t)||Object(_.a)(t.stage)||Object(_.a)(t.stage.stageId))){const a=e.Controls,i=t.stage.stageId.guid.toLowerCase(),r=t.stage.steps,o=[];if(!Object(_.a)(a)){if(Object.keys(a).forEach(t=>{if(!Object(_.a)(a[t].ParentCellId)){const s=new n.a(a[t].ParentCellId).guid.toLowerCase(),r=e.Tabs.find(e=>e.Id===a[t].ParentTabId);if(!Object(_.a)(r)&&!Object(_.a)(r.RawTabId)){const t=new n.a(r.RawTabId).guid.toLowerCase();i===t&&o.indexOf(s)<0&&o.push(s)}}}),r.length!==o.length)return s.push({name:"StepFallback",value:"No. of steps in BPF stage don't match no. of cells in corresponding tab"},{name:"BPFStageStepCount",value:r.length},{name:"TabCellCount",value:o.length}),!1;for(let t=0;t<r.length;t++)if(o.indexOf(r[t].stepId.guid.toLowerCase())<0)return s.push({name:"StepFallback",value:"BPF stage stepId does not match corresponding tab's cellId"},{name:"MissingBPFStepId",value:r[t].stepId.guid.toLowerCase()}),!1;return!0}}return!1}_retrieveStepLabel(t,e,s){if(!Object(_.a)(e)&&!Object(_.a)(e.label)&&""!==e.label)return e.label;if(!Object(_.a)(t.Label)&&""!==t.Label)return t.Label;if(!Object(_.a)(s)&&s.length>0)for(const e of s)if(e.stepId.guid===new n.a(t.ParentCellId).guid&&!Object(_.a)(e.label)&&""!==e.label)return e.label;return""}_retrieveControlName(t,e){if(!Object(_.a)(e)&&e.length>0)for(const s of e)if(s.stepId.guid===new n.a(t.ParentCellId).guid&&!Object(_.b)(s.controlName))return s.controlName;return Object(_.a)(t.DataFieldName)||""===t.DataFieldName?"":"header_process_"+t.DataFieldName}_getConfig(t,e,s,a,n){try{const i=Object(g.h)(),r=t&&t.Id,o=e.getCurrentFormEntity();n.push({name:"ControlDescriptorName",value:s&&s.Name});const c=i(this._getState(),s,a,r,o&&o.name,!1);return n.push({name:"CCFControlConfigID",value:c&&c.CustomControlId},{name:"CCFControlConfigName",value:c&&c.Name},{name:"CCFControlConfigParams",value:c&&c.Parameters&&Object.keys(c.Parameters).join(",")}),c}catch(t){n.push({name:"CCFControlConfigError",value:t})}return null}_getStageStatus(t,e,s){if(null==e||t<e)return a.Completed;if(t===e){return s.getStatus()===i.a.Finished?a.Completed:a.Active}return a.Inactive}_getSteps(t,e,s){const a=[];if(!t.stage||!t.stage.steps||0===t.stage.steps.length)return null;for(const n of t.stage.steps){const i=this._getUIControl(e,n.controlName);let r=null;if(n.name&&n.stepType&&"field"===n.stepType.toLowerCase()){if(r=this._getMetadataTypeByAttribute(t.entityLogicalName,n.name),!r)continue;if(Object(m.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){const t="BpfCustomControlSupport",e=this._context.TraceManager.getTracer(t),a=Object(o.a)(this._getState(),s.getProcessId(),e);if(!Object(_.a)(a)&&!Object(_.a)(a.ControlConfigurations)&&s.isBpfFormDescriptorValid(this._getState(),s.getProcessId(),a,e)){const t=Object(o.b)(a,e),s=this._getNonDefaultControlStepIds(t);if(!Object(_.a)(s)&&s.map(t=>t.guid).indexOf(n.stepId.guid)>=0)continue}}}const c=this._getState(),l={attributeName:n.name,controlName:n.controlName,isRequired:n.required,isVisible:!i||i.visible,name:i?i.label:n.label,stepId:n.stepId,stepType:n.stepType,attributeType:r,viewId:i&&i.parameters&&i.parameters.defaultviewid?i.parameters.defaultviewid:n.viewId,isControlDisabled:Object(g.t)(c,{id:e,controlName:n.controlName},s.getContextToken())};l.viewId&&i&&i.customFilter&&i.customFilter&&i.customFilter.length>0&&this._applyLookupFilter(l,i),a.push(l)}return a}_applyLookupFilter(t,e){let s;s=!1;const a=[];if(t&&e){for(let t=0;t<e.customFilter.length;t++){if("END_FLAG"===e.customFilter[t].customFilter){s=!0;break}if("START_FLAG"!==e.customFilter[t].customFilter){const s=Object(l.i)(Object(S.CrmHtmlDecode)(e.customFilter[t].customFilter));s&&(s.conditions&&s.conditions.length>0||s.filters&&s.filters.length>0)&&a.push(JSON.stringify(s))}}s?(this._memorizedExtraFilters=a,t.extraFilters=this._memorizedExtraFilters):t.extraFilters=this._memorizedExtraFilters?this._memorizedExtraFilters:[]}}_getMetadataTypeByAttribute(t,e){const s=this._getState(),a=Object(h.a)(s,t,e);if(!a)return null;const n=`${a.Type}.${a.Format}`;return Object(u.n)(n)}_getActions(t){return{completeProcess:()=>t.completeProcess(),moveNext:()=>t.moveToNextStage(),movePrevious:()=>t.moveToPreviousStage(),setActiveStage:e=>t.setActiveStage(e.guid),setSelectedStage:(e,s=!1)=>{t.setSelectedStage(e?e.guid:null,s)},triggerActionStepClick:e=>{t.triggerActionStepClick(e)},triggerFlowStepClick:(e,s)=>{t.triggerFlowStepClick(e,s)},refreshFlowStepClick:e=>{t.refreshFlowStepClick(e)},setDisplayState:e=>{t.setDisplayState(e)},getForwardNavigationEntities:(e,s,a,n)=>t.getForwardNavigationEntities(e,s,a,n),navigateToNextEntity:(e,s,a,n)=>t.navigateToNextEntity(c.a.fromLegacyEntityReference(e),c.a.fromLegacyEntityReference(s),a,n),executePreEvent:(e,s,a,n)=>t.executePreEvent(e,s,a,n),validateRequiredFieldsForNavigation:()=>t.ValidateRequiredFieldsForNavigation(),waitForOngoingWork:()=>t.waitForOngoingWork(),getActiveStageActiveFor:()=>t.getActiveStageActiveFor(),getBpfInstanceActiveFor:()=>t.getBpfInstanceActiveFor(),getBpfInstanceCompletedIn:()=>t.getBpfInstanceCompletedIn(),getBpfNavigationBehavior:()=>t.getBpfNavigationBehavior(),setBpfNavigationBehavior:e=>{t.setBpfNavigationBehavior(e)},getBpfNavigationBehaviorAllowCreateNew:e=>t.getBpfNavigationBehaviorAllowCreateNew(e),getActiveStage:()=>{const e=t.getContextToken(),s=t.getScriptContainer().getEventManager().getClientApiForm(e);return s?s.data.process.getActiveStage():null}}}_getRelatedEntityReference(t){if(!this._navigationEntities)return null;const e=this._navigationEntities.find(e=>e.entityLogicalName===t);return e?new v.a(e.entityLogicalName,n.a.toLegacyGuid(n.a.parse(e.id))):null}_getUIControl(t,e){if(e){const s=this._getState(),a=Object(p.j)(s,t),n={controlName:e,id:t};return Object(g.Mc)(this._getState(),n,a)}return null}_getNonDefaultControlConfiguration(t){const e={};if(t){const s=Object.keys(t);for(let a=0;a<s.length;a++){let n=null;const i=Object(b.b)(this._getState());n=t[s[a]].CustomControls[i],n&&(e[s[a]]={FormFactor:n.FormFactor,CustomControlId:n.CustomControlId,Name:n.Name,Version:n.Version,Parameters:n.Parameters,ShouldOverrideControlVisible:n.ShouldOverrideControlVisible,DisplayNameKey:n.DisplayNameKey})}}return e}_getNonDefaultControlStepIds(t){const e=[];return t&&Object.keys(t).forEach(s=>{t[s].ParentCellId&&e.push(new n.a(t[s].ParentCellId))}),e}_getIsStepRequired(t,e){const s=e.stage.steps,a=s?s.map(t=>t.stepId.guid).indexOf(t):-1;return a>=0&&!Object(_.a)(s[a].required)&&s[a].required}_getStepTypeFromControlKey(t){return t.endsWith("_actionstep")?"action":t.endsWith("_flowstep")?"modernflow":"field"}}},"23K5":function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("SAYH");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class n{generate(t,e){if(!e||!e.getProcessId())return null;return{businessProcessFlowInstanceId:e.getProcessInstanceId(),activeStageId:a.a.tryParseOrNull(e.getActiveStageId()),displayState:e.getDisplayState(),processState:e.getProcessState(),state:e.getState(),status:e.getStatus(),isVisible:e.isVisible(),data:{activePath:e.getActivePath(),selectedStageId:a.a.tryParseOrNull(e.getSelectedStageId()),businessProcessFlowId:e.getProcessId(),actionLogCollection:e.getActionLogCollection(),processNavigationBehavior:{navigationBehavior:e.getBpfNavigationBehavior()}}}}}},"53SR":function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var a=s("SAYH"),n=s("Kvn0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function i(t,e){const s={dataById:{[a.a.toString(e.id)]:t}};return{type:n.a,payload:s}}},"59++":function(t,e,s){"use strict";s.d(e,"b",(function(){return r})),s.d(e,"a",(function(){return i}));var a=s("y60j"),n=s("OWbt");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const i="form.ui.metadata.update";function r(t,e,s){return{type:"form.ui.metadata.update.async",execute({dispatch:r,getState:o},c,l){const u=o(),h=Object(a.j)(u,t),d=Object(n.g)(u,h,t);return r(function(t,e,s,a){return{type:i,payload:{formId:t,formUIState:e},meta:{pageId:s,contextToken:a}}}(t,d,e,s)),Promise.resolve()}}}},"8O0c":function(t,e,s){"use strict";s.d(e,"a",(function(){return p}));var a=s("Lyxw"),n=s("53SR"),i=s("Nb1E"),r=s("7tM0"),o=s("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const c="ProcessControl_ActionExecuter_ExecutionTimeTooltip",l="ProcessControl_ActionExecuter_ErrorMessageTooltip",u="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources";var h;function d(t){switch(t){case h.InProgress:case h.Waiting:return 1;case h.Succeeded:return 2;case h.Failed:case h.Canceled:return 3;default:return 0}}function g(t,e,s,a){let n="";if(Object(o.b)(t)||(n=String.format(a[c],new Date(t).toLocaleString())),s===h.Failed){const t=Object(o.b)(e)?a.Crm_GenericErrorMessage:e;n+="\n"+String.format(a[l],t)}return""===n?e:n}function p(t,e){return{type:"businessProcessFlow.actionLogs.retrieve",execute({dispatch:s,getState:o},h){const p=String.format("?$select=workflowlogid,message,status,modifiedon,stepname,activityname,_asyncoperationid_value&$filter=activityname%20eq%20'{0}'%20and%20_asyncoperationid_value%20eq%20{1}&$orderby=modifiedon%20desc&$top=500",t.guid,e.id.guid),f=o();if(function(t){return Object(a.b)(t,"BpfActionSupportActionQuerying")}(f))return s(Object(i.e)("workflowlog",p)).then(t=>{if(t.value&&t.value.length){const a={};a[c]=Object(r.a)(f,u,c),a[l]=Object(r.a)(f,u,l),a.Crm_GenericErrorMessage=Object(r.a)(f,u,"Crm_GenericErrorMessage");const i={};t.value.forEach(t=>{if(t.stepname&&-1===Object.keys(i).indexOf(t.stepname)){const e={actionLogId:t.workflowlogid,status:d(t.status),modifiedOn:t.modifiedon,stepId:t.stepname,processDefinitionid:t.activityname,processInstanceid:t._asyncoperationid_value,message:g(t.modifiedon,t.message,t.status,a)};i[t.stepname]=e}});const o={actionLogCollection:i};return s(Object(n.a)(o,e))}})}}}!function(t){t[t.InProgress=1]="InProgress",t[t.Succeeded=2]="Succeeded",t[t.Failed=3]="Failed",t[t.Canceled=4]="Canceled",t[t.Waiting=5]="Waiting"}(h||(h={}))},Co7m:function(t,e,s){"use strict";s.d(e,"a",(function(){return N}));var a=s("TAjd"),n=s("SAYH"),i=s("504W"),r=s("WPtp"),o=s("CPoS"),c=s("5Oca"),l=s("+nNZ"),u=s("odYE"),h=s("0PSL"),d=s("23K5"),g=s("bJaF"),p=s("KGWS"),f=s("ccIw"),_=s("arV0"),m=s("rodW"),b=s("eXjw"),P=s("k1f1"),v=s("AFlp"),S=s("c7jw"),y=s("53SR"),I=s("PUjk"),O=s("i1f0"),C=s("7LBy"),w=s("2Ct/"),F=s("iZ7K"),j=s("D4Jo"),E=s("JF0K");class N{static get Instance(){return N._instance||(N._instance=new N,Object(I.c)(N._instance)),N._instance}init(t,e,a){return this._getState&&this._businessProcessPerPageWrapper?Promise.resolve():(this._applicationContext=t,this._reloadDataCount=0,this._getState=e,this._dispatch=a,this._processManager=new g.a(t,e,a,new f.a,new p.a),this._businessProcessFlowWrapperIdentifierFactory=new d.a,this._businessProcessFlowWrapperFactory=new h.a(e,this._businessProcessFlowWrapperIdentifierFactory,t),s.e(48).then(s.bind(null,"esKF")).then(({BusinessProcessPageWrapper:t})=>(this._businessProcessPerPageWrapper=new t(this._applicationContext,this._getState,this._dispatch),Promise.resolve())))}getBusinessProcessFlowWrapper(t,e){return Object(w.f)(this._getState())?this._businessProcessPerPageWrapper.getBusinessProcessFlowWrapper(t,e):(this._reloadDataIfRequired(t,e),this._businessProcessFlowWrapperFactory.generate(t,this._processManager))}getProcessManager(t,e){return Object(w.f)(this._getState())?this._businessProcessPerPageWrapper.getProcessManager(t,e):(this._reloadDataIfRequired(t,e),this._processManager)}getCurrentProcessManagerWithoutInit(t){if(!Object(w.f)(this._getState()))return this._processManager;if(this._businessProcessPerPageWrapper)return this._businessProcessPerPageWrapper.getCurrentProcessManagerWithoutInit(t);const e=Object(_.g)(this._getState(),t),s=e&&e.entityTypeName?new u.a(e.entityTypeName,e.id):null,a=this._applicationContext.TraceManager.getTracer("BusinessProcessWrapperManager.GetProcessManagerWithoutinit"),n=Object(j.a)(this._getState(),s,t,this._applicationContext);return a.warn("BusinessProcessWrapperManager: BusinessProcessPerPageWrapper is not initialized",n),null}hasChanged(t,e,s,a){if(!Object(w.f)(this._getState())){if(Object(w.g)(t)&&(!Object(w.d)(t)||Object(w.c)(t,a)))return!0;if(!e)return!1;const n=new u.a(e.entityTypeName,e.id),r=Object(l.f)(t,n);return!Object(i.a)(r)&&(!s||r>s.instanceModifiedTimestamp)||this._needsDockedModeRefresh(s,e)}return this._businessProcessPerPageWrapper.hasChanged(t,e,s,a)}_needsDockedModeRefresh(t,e){return this._processManager.getDisplayState()===a.a.expanded&&t.isFormInactive!==Object(O.Lb)(this._getState(),e.entityTypeName,e.id)}_reloadData(t,e){const s=this._getState();this._pageId=t,this._pageInfo=e;const a=Object(_.g)(s,t);if(!a)return;const h=a.id,d=new u.a(a.entityTypeName,h);if(this._processIdInState=Object(c.e)(s,d),Object(w.g)(s)&&(!Object(w.d)(s)||Object(w.c)(s,t))){const e=this._processManager.getTelemetryParams();return this._processManager.isVisible()&&this._processManager.setVisible(!1),this._processManager.initilaizeWithFormEntityOnly(d,t),void Object(j.c)(E.e,e,this._applicationContext)}const g=Object(C.a)(a),p=Object(C.b)(a);if(n.a.equals(d.id,n.a.EMPTY)&&g&&p){const e=Object(o.b)(s,g),n=new u.a(e.businessProcessFlowUniqueName,p),r=Object(l.b)(s,n);return Object(i.a)(this._lastPageEntityFromCrossEntity)||Object(i.a)(d)||this._lastPageEntityFromCrossEntity.etn===d.etn||this._moveToNextStageForCrossEntityBPF(r,a),void this._processManager.initilaizeWithProcessAndFormEntity(r,e,d,g,n,t)}if(this._processIdInState){const e=Object(o.b)(s,this._processIdInState);if(!Object(i.a)(e)&&Object(b.b)(e.initialized)){const a=new u.a(e.businessProcessFlowUniqueName,Object(c.f)(s,d)),o=Object(l.b)(s,a);if(n.a.equals(d.id,n.a.EMPTY)){const s=Object(w.b)(e);if(this._lastPageIdInNewForm!==t&&(this._lastPageIdInNewForm=t,this._dispatch(Object(y.a)(null,a))),s&&s.stage&&s.stage.stageId){const n=Object(w.a)(s);return this._dispatch(Object(S.b)(a,n)),void this._processManager.initilaizeWithProcessAndFormEntity(n.fields,e,d,this._processIdInState,a,t)}}else if(Object(i.a)(o))return;const h=Object(F.h)(s,d.etn);if(h&&h.IsBPFEntity)return void this._processManager.initilaizeWithProcessAndFormEntity(o,e,d,this._processIdInState,a,t);for(const s in o)if(Object(r.k)(o[s])&&o[s].reference&&o[s].reference.id&&o[s].reference.etn===d.etn&&(n.a.equals(o[s].reference.id,d.id)||n.a.equals(o[s].reference.id,n.a.EMPTY))&&Object(w.e)(s))return void this._processManager.initilaizeWithProcessAndFormEntity(o,e,d,this._processIdInState,a,t);const g=this._dispatch(Object(P.b)(n.a.EMPTY,d)),p=this._dispatch(Object(v.b)(n.a.EMPTY,d));Promise.all([g,p]).then(e=>{this._processManager.initilaizeWithFormEntityOnly(d,t)})}else this._processManager.initilaizeWithFormEntityOnly(d,t)}else this._processManager.initilaizeWithFormEntityOnly(d,t)}_reloadDataIfRequired(t,e){const s=this._getState(),a=this._processManager.getCurrentFormEntity();this._lastPageEntityFromCrossEntity=a;let i=null,r=!1;if(a&&(i=Object(c.b)(a)(s,a.etn),i&&(r=i.refreshGlobalNavigationData)),!Object(w.g)(s)&&(!this._pageInfo||!n.a.equals(this._pageInfo.id,e.id)||this._pageId!==t||this._hasProcessChanged(e)||r)||Object(w.g)(s)&&this._processManager.getProcessId()){if(i&&i.refreshGlobalNavigationData&&this._dispatch(Object(m.b)(!1,a)),this._reloadDataCount<30)this._reloadData(t,e);else if(this._pageId!==t&&(this._reloadDataCount=0),30===this._reloadDataCount){const t=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ReachMaxBpfReloadDataCount"),e=this._processManager.getTelemetryParams();t.error("Max BPF reloadData count reached limit of 30. Root cause may be infinite loop when rendering the ProcessControl.",e)}this._reloadDataCount++}else this._reloadDataCount=0}_hasProcessChanged(t){const e=this._processIdInState||n.a.EMPTY,s=this._getState(),a=new u.a(t.entityTypeName,t.id),i=Object(_.g)(s,this._pageId),r=Object(C.a)(i),l=n.a.equals(a.id,n.a.EMPTY)&&r?r:Object(c.e)(s,a)||n.a.EMPTY;if(!n.a.equals(l,e))return!0;if(n.a.equals(l,n.a.EMPTY))return!1;const h=Object(o.b)(s,l);return!!h&&this._processManager.getVersion()<h.businessProcessFlowProcessVersion}_moveToNextStageForCrossEntityBPF(t,e){const s=t.activestageid,a=t.traversedpath;let i=e.data.nextStageId;if(!i){const t=Object(C.a)(e),s=Object(C.b)(e);if(!n.a.equals(t,this._processManager.getProcessId())||!n.a.equals(s,this._processManager.getProcessInstanceId()))return;i=this._processManager.getStageMetadata().getNextStageId(this._processManager.getActiveStageId())}if(!n.a.equals(s.reference.id,new n.a(i))){s.reference=new u.a("processstage",new n.a(i)),a.value=a.value+","+i;t.activestagestartedon.value=new Date}}}},D4Jo:function(t,e,s){"use strict";s.d(e,"a",(function(){return d})),s.d(e,"c",(function(){return g})),s.d(e,"b",(function(){return p}));var a=s("VcAV"),n=s("Uv1Y"),i=s("bT7G"),r=s("JF0K"),o=s("SAYH"),c=s("5Oca"),l=s("+nNZ"),u=s("arV0"),h=s("504W");function d(t,e,s,a){const n=[];try{const a=e&&Object(c.e)(t,e)?Object(c.e)(t,e):o.a.EMPTY,i=e&&Object(c.f)(t,e)?Object(c.f)(t,e):o.a.EMPTY,r=a&&!o.a.equals(a,o.a.EMPTY)?function(t,e){const s=Object(l.a)(t,e);if(s)return s.businessProcessFlowProcessState;return null}(t,a):0,h=Object(u.l)(t,s),d={name:"ProcessId",value:a?o.a.toString(a):o.a.EMPTYGUIDSTRING},g={name:"ProcessInstanceId",value:i?o.a.toString(i):o.a.EMPTYGUIDSTRING},p={name:"CurrentFormEntityType",value:e&&e.etn?e.etn:""},f={name:"CurrentFormEntityId",value:e&&e.id?o.a.toString(e.id):""},_={name:"ProcessState",value:r},m={name:"PageId",value:s||""},b={name:"PageType",value:h};n.push(d),n.push(g),n.push(p),n.push(f),n.push(_),n.push(m),n.push(b)}catch(t){a.TraceManager.getTracer("BusinessProcessFlow.TelemetryGeneration").error("Exception while generating businessprocess telemetry parameters: "+t.message,n)}return n}function g(t,e,s){s.EventManager.ReportComponentSuccess(t,e)}function p(t,e,s,o,c,l,u){!function(t,e){if(!Object(a.c)(t)){const s=Object(n.c)(t);if(!Object(a.c)(s)){const t=s.errorCode;if(!Object(a.c)(t)){const s={name:"ErrorCode",value:"0x"+t.toString(16)};e.push(s)}}}}(e,o),function(t,e,s,o){if(!Object(a.c)(t)){const c=Object(n.c)(t);if(!Object(a.c)(c)&&!Object(a.c)(c.FaultedSnapshotId)){const t={name:r.p,value:c.FaultedSnapshotId};if(e.push(t),!Object(a.c)(s)&&!Object(a.c)(o)){const t=Object(i.c)(o,s);if(!Object(a.c)(t)){const s=t.snapshotId;if(!Object(a.c)(s)&&!Object(h.b)(s)&&s===c.FaultedSnapshotId){const t={name:r.q,value:"serverSideCurrentForm"};e.push(t)}}}}}}(e,o,l,u),c.EventManager.ReportComponentFailure(t,e,s,o)}},JF0K:function(t,e,s){"use strict";s.d(e,"h",(function(){return a})),s.d(e,"i",(function(){return n})),s.d(e,"o",(function(){return i})),s.d(e,"a",(function(){return r})),s.d(e,"j",(function(){return o})),s.d(e,"c",(function(){return c})),s.d(e,"f",(function(){return l})),s.d(e,"g",(function(){return u})),s.d(e,"b",(function(){return g})),s.d(e,"d",(function(){return p})),s.d(e,"k",(function(){return f})),s.d(e,"l",(function(){return _})),s.d(e,"e",(function(){return m})),s.d(e,"q",(function(){return b})),s.d(e,"p",(function(){return P})),s.d(e,"m",(function(){return h})),s.d(e,"n",(function(){return d}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const a="BusinessProcessFlow.MoveToNextStage",n="BusinessProcessFlow.MoveToPreviousStage",i="BusinessProcessFlow.SetActiveStage",r="BusinessProcessFlow.AbandonProcess",o="BusinessProcessFlow.ReactivateProcess",c="BusinessProcessFlow.CompleteProcess",l="BusinessProcessFlow.InitilaizeWithFormEntityOnly",u="BusinessProcessFlow.InitilaizeWithProcessAndFormEntity",h="BusinessProcessFlow.SetActiveProcess",d="BusinessProcessFlow.SetActiveProcessInstance",g="BusinessProcessFlow.ActionStep",p="BusinessProcessFlow.FlowStepWidget",f="BusinessProcessFlow.RefreshFlowStep",_="BusinessProcessFlow.RenderProcessControl",m="BusinessProcessFlow.HideProcessControlForUciOffline",b="SaveFailureReason",P="faultedSnapshotId"},KGWS:function(t,e,s){"use strict";s.d(e,"a",(function(){return r}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class a{constructor(t,e){this._traversedPath=t,this._stageId=e}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}get stageId(){return this._stageId}set stageId(t){this._stageId=t}}var n=s("sxfa"),i=s("SAYH");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class r{get globalPathAndActiveStage(){return this._globalPathAndActiveStage}get navigationEntities(){return this._navigationEntities}get navigationEntityIdsByEntityLogicalName(){return this._navigationEntityIdsByEntityLogicalName}set globalPathAndActiveStage(t){(t||this._globalPathAndActiveStage||this._globalPathAndActiveStage.stageId===t.stageId)&&(this._globalPathAndActiveStage=t)}InitGlobalPathAndActiveStage(t){this._updateNavigationDictionary(t.navigationEntities),this.UpdateGlobalPathAndActiveStage(t.traversedPath,t.activeStageId)}UpdateGlobalPathAndActiveStage(t,e){this.globalPathAndActiveStage=new a(new n.a(t),e)}_updateNavigationDictionary(t){if(t){this._navigationEntities=t,this._navigationEntityIdsByEntityLogicalName={};for(let e=0;e<t.length;e++)this._navigationEntityIdsByEntityLogicalName[t[e].entityLogicalName]=new i.a(t[e].id)}}}},OWbt:function(t,e,s){"use strict";s.d(e,"f",(function(){return vt})),s.d(e,"h",(function(){return at})),s.d(e,"i",(function(){return ht})),s.d(e,"j",(function(){return dt})),s.d(e,"k",(function(){return gt})),s.d(e,"c",(function(){return rt})),s.d(e,"d",(function(){return ot})),s.d(e,"a",(function(){return et})),s.d(e,"b",(function(){return st})),s.d(e,"e",(function(){return nt})),s.d(e,"g",(function(){return Pt}));var a=s("4leG"),n=s("SAYH"),i=s("y60j"),r=s("Uv1Y"),o=s("i1f0"),c=s("Z/4N"),l=s("arV0"),u=s("odYE"),h=s("LbMF"),d=s("IqkD"),g=s("mIxf"),p=s("1qQb"),f=s("FZDd"),_=s("WY/A"),m=s("Dea/"),b=s("iZ7K"),P=s("5Oca"),v=s("Jj4w"),S=s("IVVt");var y=s("3hnk"),I=s("qTme"),O=s("dMZy"),C=s("lLEV"),w=s("5ZBI");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const F="CustomControlFramework.Selectors.DynamicDataSelectors.CustomControlTimelineWallSelector";var j=s("E5qG"),E=s("dHD5"),N=s("EY5k"),M=s("YGjz"),T=s("3mEc"),D=s("8nT0"),x=s("Co7m"),A=s("bT7G"),B=s("AF/G"),R=s("1usl"),k=s("4Us1"),L=s("99zj"),V=s("E8F2"),q=s("YxC/"),W=s("HfZT"),U=s("74Tm"),G=s("9fGf"),H=s("/qEh"),z=s("ldGr"),Y=s("NUHF"),K=s("3/02"),X=s("Lyxw"),J=s("N6E8"),Z=s("455M"),$=s("p8cR"),Q=s("pF61"),tt=s("jq7Z");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const et="form.initialize",st="form.xrmready";function at(t,e,s,a,c){const p=[{name:"formId",value:n.a.toString(t)},{name:"pageId",value:e},{name:"contextKey",value:Object(E.v)(s)}];return{type:"form.initialize.async",execute({dispatch:f,getState:_},m,P){const v=_(),S=Object(l.g)(v,e),{entityTypeName:I,data:O,recordSetQueryKey:N}=S,M=m.TraceManager.getTracer("Forms.InitializeForm"),A=[];let k;if(p.push({name:"isPreview",value:S&&S.isPreview}),p.push({name:"EntityName",value:S&&S.entityTypeName}),M.info("initializeForm started.",p),Object($.b)(function(t){return()=>{const e={},s={},a={};return(n,i,r,o,c)=>{w.a.info(F+r.controlId+": createGetTimelineWallData started");let l=!1;s.hasOwnProperty(n)&&s[n]||(s[n]=new C.a(t,n,r.id));const u=s[n],h=u.retrieveTimelineWallObject(i,r,o,c,t);a.hasOwnProperty(n)&&a[n]&&h===a[n]||(a[n]=h,l=!0);const d=u;return l&&(e[n]=d),w.a.info(F+r.controlId+": createGetTimelineWallData finished"),e[n]}}}(f),Z.a.TimelineWall),M.info("BusinessProcessWrapperManager.Instance.init started.",p),A.push(x.a.Instance.init(m,_,f).then(()=>M.info("BusinessProcessWrapperManager.Instance.init completed.",p))),Object(y.a)(v,t))if(Object(l.m)(v,e)){if(!Object(y.g)(v,I,1,0)&&!(null==S?void 0:S.isPreview))return it(22e8,f,M,P,v,e)}else{if(!Object(y.g)(v,I,2,0))return it(2147746342,f,M,P,v,e)}const q=Object(i.j)(v,t),G=Pt(v,q,t),Q=_t(v,I,q),tt=function(t,e,s,a){const n={};if(e&&e.RelatedEntityAttributes&&a)for(const i in e.RelatedEntityAttributes){const r=Object(b.x)(t,a,i);if(r&&r.ReferencedEntity){const a={},o=mt(t,r.ReferencedEntity,e.RelatedEntityAttributes[i]),c=Object(E.m)(s,i);n[Object(E.v)(c)]={attributes:o,submitModes:a}}}return n}(v,q,s,I),et=Object(U.a)(v),st=Object(d.s)(v);St(v,f,t,G,Q,e,s,tt,st),N&&!et&&f(Object(W.g)(e,N)),M.info("Update quick view forms started.",p);for(const a in q.InlineQuickForms){const n=q.InlineQuickForms[a];for(const r in n){const o=n[r],c=Object(i.j)(v,o),l=Pt(v,c,o),u=_t(v,r,c),h=Object(E.l)(s,a,r);St(v,f,t,l,u,e,h,null,st)}}if(M.info("Update quick view forms completed.",p),O&&0!==Object.keys(O).length){const{createFromEntity:a,createFromRelationship:i}=S,{initWithEntity:c}=S;let d=a;!d&&c&&(d=c),k=function(t,e,s,a,i,c,d,p,f,_,m){s&&s.info("initializeFormWithDefaultValue started.",a);const P=Object(h.d)(t,c);let v=null;const S={},y=Object(l.m)(t,i),I=n.a.toString(p);let O,C;const w=[];I&&(v=Object(h.k)(t,I));for(const r of Object.keys(d)){if("processid"===r)continue;let l=P[r];if(!l&&v&&(l=v[r]),l&&!l.AttributeOf){const o=l.Type;switch(o){case"customer":case"owner":case"lookup":case"regarding":if("string"==typeof d[r]){const u=ct(d,r,l);if(!u){ut(s,r);continue}if(S[r]=u,!n.a.equals(n.a.EMPTY,u.id)&&"owner"!==o&&y&&(_||m))if(C){const t=C.then(()=>e(Object(H.b)(i,p)).then(()=>{s&&s.info("updateSnapshotWithOptions completed (1).",a)}));w.push(t)}else C=ft(t,e,u,c,i,s,a,_,m),w.push(C)}else{let t;t=Array.isArray(d[r])?d[r][0]:d[r],t&&t.id&&n.a.tryParseOrNull(t.id)&&t.entityType&&(S[r]=new u.a(t.entityType,new n.a(t.id),t.name))}break;case"partylist":const h=d[r];let g=h;const f=[];try{"string"==typeof h&&(g=JSON.parse(h));for(const t of g)f.push(new u.a(t.entityType,new n.a(t.id),t.name))}catch(t){ut(s,r,"partylist")}S[r]=f;break;case"boolean":case"picklist":case"status":S[r]=d[r];break;case"uniqueidentifier":S[r]=new n.a(d[r]);break;default:S[r]=d[r]}}else if(-1!==r.indexOf(J.d)||"_CreateFromId"===r){let n=null;if(-1!==r.indexOf(J.d)&&(n=ct(d,J.d,l)),!n&&"_CreateFromId"===r){const e=Object(b.m)(t,d._CreateFromType),s=Object(b.h)(t,e);s&&(n=lt(e,d._CreateFromId,s.DisplayName))}if(!n){ut(s,J.d);continue}if(!O&&(O=n,y))if(C){const t=C.then(()=>e(Object(H.b)(i,p)).then(()=>{s&&s.info("updateSnapshotWithOptions completed (2).",a)}));w.push(t)}else C=ft(t,e,O,c,i,s,a,_,m),w.push(C);if(Object(b.h)(t,c).IsActivity&&-1===Object.keys(S).indexOf(D.t)&&Object(b.z)(t,c,O.etn,D.t)){const e=Object(o.ab)(t,i,f);e&&e[D.t]&&(S[D.t]=n)}}else{ut(s,r);if(Object(X.c)(t,K.Rc))return Promise.reject(Object(V.b)(t,i,2200000009))}}const F=Object(X.c)(t,K.L);let j=S;F&&(j=function(t,e,s,a,n){const i={},r=Object(E.w)(a),c=Object(o.P)(t,r,e,s);for(const r in n){if(!c||!c.hasOwnProperty(r)){i[r]=n[r];continue}const o=Object(h.a)(t,e,r);if(!(o&&o.ParentPicklistLogicalName)&&!Object(z.a)(t,a,s,e,c,r,{name:r,value:0})){i[r]=n[r];let c=[];for(o&&o.ChildPicklistLogicalNames&&(c=c.concat(o.ChildPicklistLogicalNames));c&&c.length>0;){const r=c.pop();if(n.hasOwnProperty(r)){const o=Object(h.a)(t,e,r),l=JSON.parse(n[o.ParentPicklistLogicalName]),u=JSON.parse(n[r]);Object(Y.a)(t,s,a,o,e,l,u)&&(i[r]=n[r],o.ChildPicklistLogicalNames&&o.ChildPicklistLogicalNames.length>0&&(c=c.concat(o.ChildPicklistLogicalNames)))}}}}return i}(t,c,i,f,S));const N=pt(j);if(w.length>0)return Promise.all(w).catch(t=>{if(2147749377===t.errorCode||-2147093999===t.errorCode)return Promise.resolve(null);Object(r.b)(t)}).then(()=>(e(Object(g.a)(i,N,!0,!0)),s&&s.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length > 0.",a),Promise.resolve(null)));return e(Object(g.a)(i,N,!0,!0)),s&&s.info("initializeFormWithDefaultValue completed at snapshotPromiseList.length == 0.",a),Promise.resolve(null)}(_(),f,M,p,e,I,O,t,s,d,i)}if(q&&q.Controls&&q.Controls.notescontrol){const t=Object(l.g)(v,e);M.info("loadTimelineConfigAndMetaData started.",p),f(Object(j.b)(q.Controls.notescontrol,t,a)).then(()=>{M.info("loadTimelineConfigAndMetaData completed.",p)})}if(q&&q.Controls)for(const t in q.Controls)if(q.Controls[t]){if(q.Controls[t].Id&&q.Controls[t].Id.startsWith("WebResource"))for(const e of q.Controls[t].Parameters)if("Url"===e.Name){let t=!1;if(c)for(const s of c){const a=e.Value&&e.Value.toLowerCase()||"";if(a.length>=s.length&&a.length-s.length===a.lastIndexOf(s)){t=!0;break}}if(!t){const t=Object(T.j)(v,e.Value);t&&!t.Name&&(M.info("retrieveWebResourceDescriptorByName started.",p),f(Object(L.c)(e.Value)).then(()=>{M.info("retrieveWebResourceDescriptorByName completed.",p)}))}}n.a.equals(q.Controls[t].ClassId,B.rb)&&v&&void 0===v.currentServerTime.serverTimeDiffInSeconds&&(M.info("retrieveServerTime started.",p),f(Object(R.b)(new u.a(I))).then(()=>{M.info("retrieveServerTime completed.",p)}))}return null!=k?k:(M.info("initializeForm completed.",p),Promise.all(A))},getFailureParameters:(t,e)=>p}}function nt(t,e,s,n,i,r,o){const c=e(Object(f.f)(r,!1,[])).then(()=>{const s=Object(b.h)(t(),r);if(s.IsChildEntity){const a=Object(y.d)(t(),s);return e(Object(f.f)(a.EntityLogicalName,!1,[]))}}),u=()=>{const i=t();if(!Object(y.b)(i,r))return it(2200000001,e,s,n,i,o);const c=Object(y.c)(i,r),u=Object(a.d)(i);return c&&Object(l.m)(i,o)&&!u?it(2200000002,e,s,n,i,o):void 0};return c?c.then(u):Promise.resolve(u())}function it(t,e,s,a,n,i){const r=Object(V.d)(t);return e(Object(N.e)(r)).then(()=>{const e=Object(V.c)(t);if(s){const t=[{name:"CorrelationId",value:a.correlationId},{name:"ContextId",value:a.contextId},{name:"ActionStack",value:a.stack}];s.debug(e,t)}const o=Object(q.e)(n,r),c=Object(q.c)(o,r[0]),l=Object(q.c)(o,r[1]);throw Object(V.b)(n,i,t,e,c,l)})}function rt(t,e,s,a,n,i,r,c,p){p.push({name:"AutoPopulateFieldsTimeStamp",value:Date.now()}),c&&c.info("autoPopulateFields started.",p);const f=Object(h.d)(t,s);if(!f)return void(c&&c.warn("attributes is null.",p));const _=t=>t&&t.OptionSet&&Object.keys(t.OptionSet).length>0,{id:m}=Object(l.g)(t,a),b=new u.a(s,m),P={},v=Object(o.ac)(t,a,r);for(const e of n.concat(i)){const s=f[e];if(s&&(n.indexOf(e)>=0&&i.indexOf(e)>=0||_(s))){if(!Object(o.X)(t,a,r,v,b,s.LogicalName)){switch(e){case D.q:const s=Object(d.q)(t),a=Object(d.t)(t);if(s&&a){const t=new u.a(M.a,s,a);P[e]=t}break;case D.w:if(!Object(A.d)(t,v,null,D.w)){const s=Object(d.b)(t);if(s){const t=new u.a(M.b,s.transactionCurrencyId,s.currencyName);P[e]=t}}}if(_(s)){const a=Object(A.d)(t,v,new u.a(s.EntityLogicalName),e),i=a?parseInt(a.valueString,10):null!=s.DefaultValue?s.DefaultValue:e===D.u?0:void 0;if(void 0===i||i<0||(P[e]=i),e===D.u&&-1!==n.indexOf(D.v)){const t=f[e];if(t&&t.OptionSet&&Object.keys(t.OptionSet).length>0){const t=s.OptionSet.find(t=>t.Value===i),e=t?t.DefaultStatus:f[D.v].DefaultValue||0;e<0||(P[D.v]=e)}}}}}}const S=pt(P);e(Object(g.a)(a,S,!0,!0)),c.info("autoPopulateFields completed.",p)}function ot(t,e,s,a,i,r,o){const{id:c}=Object(l.g)(t,a),h=new u.a(s,c),d={};if(n.a.isNullOrEmpty(h.id)&&!o)return function(t,e,s,a,i){const r=Object(P.d)(t,s);if(null!=r)return Promise.resolve(r);return e(Object(k.a)(n.a.EMPTY,new u.a(s,n.a.EMPTY))).then(t=>t&&t.businessProcessFlows?Promise.resolve(n.a.tryParse(Object.keys(t.businessProcessFlows)[0])):Promise.resolve(null)).catch(t=>{const e=[{name:"CorrelationId",value:i.correlationId},{name:"ContextId",value:i.contextId},{name:"ActionStack",value:i.stack},{name:"entityName",value:s},{name:"reason",value:t&&t.message?t.message:JSON.stringify(t)}];return a.EventManager.ReportComponentFailure("Forms.InitializeForm",Error("Catch block of InitializeForm.retrieveBusinessProcessFlow"),void 0,e),a.TraceManager.getTracer("Forms.InitializeForm").error("Error while executing getBusinessProcessFlowDefaultIdForEntity in the retrieveBusinessProcessFlow promise.",e),Promise.resolve(null)})}(t,e,s,i,r).then(t=>{t&&(d.processid=t.guid);const s=pt(d);return e(Object(g.a)(a,s,!0,!0)),Promise.resolve()});o&&(d.processid=o);const p=pt(d);return e(Object(g.a)(a,p,!0,!0)),Promise.resolve()}function ct(t,e,s){let a=e;!e.match(/id$/i)&&e.indexOf(J.d)>-1&&(a+="id");const i=t[a];if(null!=i){if(n.a.validate(i)){const a=i,n=t[e+"name"];let r=t[e+"type"]||t[e+"target"];return!r&&s.Targets&&s.Targets.length>0&&(r=s.Targets[0]),lt(r,a,n)}try{const t=JSON.parse(i);if(t)return lt(t.entityType,t.id,t.name)}catch(t){}}return null}function lt(t,e,s){if(t&&e&&n.a.validate(e)){const a=new n.a(e);if(!n.a.isNullOrEmpty(a))return new u.a(t,a,s)}return null}function ut(t,e,s){if(t){const a=[{name:"key",value:e},{name:"source",value:s}];t.warn("Value passed is not in correct syntax.",a)}}function ht(t,e,s,a,n,i,r,o){return dt(t,e,s,a,i,r,o).then(()=>gt(t,e,s,n,i,r,o))}function dt(t,e,s,a,n,i,r){if(!Object(o.Eb)(t,n)&&Object(Q.n)(t,n))return i&&i.warn("pageId"+n+" is dead so rejecting loadScripts"),Promise.reject(Object(V.b)(t,n,2200000008,"Page has expired."));i&&i.info("loadScripts started.",r);return s(e.ScriptManager.getContainer(n).getEventManager().loadScripts(a,n)).then(()=>{i&&i.info("loadScripts completed",r)})}function gt(t,e,s,a,n,i,r){if(!Object(o.Eb)(t,n)&&Object(Q.n)(t,n))return void(i&&i.warn("pageId "+n+" is dead so won't run runFormOnLoadScripts",r));i&&i.info("runFormOnLoadScripts started.",r);const c=e.ScriptManager.getContainer(n).getEventManager();s(c.addPblEvent(a)),s(c.runOnLoad(a,1)),s(c.runOnDataLoad(a,1)),i&&i.info("runFormOnLoadScripts completed.",r)}function pt(t){const e={};for(const s in t){const a={fieldName:s,value:t[s]};e[s]=a}return e}function ft(t,e,s,a,n,i,o,c,l){const h=Object(E.j)(t,n),d=Object(E.x)(h);return i&&i.info("createAndSetDataSnapshotFrom started.",o),e(function(t,e,s,a,n){return{type:"snapshot.from.async",execute({dispatch:i,getState:o},c){const l=c.DataSource,h=u.a.toLegacyEntityReference(t),d=new v.a(h,e,S.a.All),g=l.execute(d,null).nativePromise();let y=null,I=null,O=null;return g.then(t=>{const s=t.get_entity();return y=Object(p.a)(s),I=y.fields,O=y.identifier,i(Object(f.f)(e,!1,Object.keys(y.fields)))},t=>{const s=Object(r.c)(t);if(t&&t.get_ErrorCode&&(-2147093999===t.get_ErrorCode()||s&&-2147217919===s.getNegativeErrorCode())&&a){const t=[];if(I={},a.etn){const s=Object(b.c)(o(),a.etn,e);if(s)for(const e of s)e.ReferencingAttribute&&t.push(e.ReferencingAttribute)}else n&&t.push(n.attributeName);for(const e of t){if(!a.name&&a.id){const t=Object(P.h)(o(),a.etn,a.id.guid);if(t&&t.fields){const e=Object(b.E)(o(),a.etn);let s=t.fields[e];s&&s.value||(s=t.fields.name),s&&s.value&&(a={etn:a.etn,id:a.id,name:s.value})}}I[e]={reference:a,timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}}return O=new u.a(e),i(Object(f.f)(e,!1,t))}Object(r.b)(t)}).then(()=>{const t=Object(_.b)(o(),O,I,s,m.a.Create),e=t.payload.snapshotId;return i(t),e})}}}(s,a,d,c,l)).then(t=>{i&&(o.push({name:"newSnapshotId",value:t?t.toString():"<null>"}),i.info("initializeCreateDataSnapshotFrom completed.",o)),e(Object(I.b)(n,t,h)).then(()=>{i&&i.info("createAndSetDataSnapshotFrom completed.",o)})})}function _t(t,e,s){let a={};if(s&&s.Attributes&&e){const n=Object(T.d)(t,s.FormLibraries,[e]);if(s.Attributes||n){const i=[].concat(s.Attributes,n);-1===i.indexOf(D.u)&&i.push(D.u),a=mt(t,e,i)}}return{attributes:a,submitModes:{}}}function mt(t,e,s){const a={};if(s&&e)for(let n=0;n<s.length;n++){const i=s[n];if(i){const s=Object(o.L)(t,e,i);s&&(a[i]=s)}}return a}function bt(t){return Array.isArray(t)?t:t.Controls?t.Controls:null}function Pt(t,e,s){const a={},n={},i={},r={bodyVisible:!0,commandBarVisible:!0,tabNavigatorVisible:!0},l={visible:!0};let u={navBarAreas:{},navPaneIsvItems:{},navBarByRelationshipItems:{},navBarItems:{}};if(e&&e.Tabs&&e.TabNames){const s=Object(o.m)(t,e);let r=!1;for(const o of s){const s={collapsed:!!r||!(o.Expanded&&o.Visible),visible:o.Visible,label:o.Label,sectionNames:[],domId:o.DomId,showLabel:o.ShowLabel,contentType:null};switch(o.ContentType){case"expandAvailableSpace":case"singleComponent":s.contentType="singleComponent";break;default:s.contentType="cardSections"}r=r||o.Expanded&&o.Visible;const l=[];if(o.Columns)for(let s=0;s<o.Columns.length;s++){const a=o.Columns[s];if(a.SectionNames)for(let s=0;s<a.SectionNames.length;s++){const r=a.SectionNames[s];if(e.Sections[r]){const s=e.Sections[r];l.push(r);const a=[];for(const t of e.Sections[r].Rows)for(const e of t.Cells)e.ControlName&&a.push(e.ControlName);const u={parentTabId:o.Id,visible:s.Visible,label:s.Label,controlNames:a,domId:s.DomId,semanticZoomDomId:s.SemanticZoomDomId};n[r]=u;for(let s=0;s<a.length;s++){const n=a[s];if(e.Controls[n]){const s=e.Controls[n],a=vt(s,r,!0),o=Object(c.a)(s,e,Object(G.b)(t));null!=o&&(a.visible=a.visible||o.ShouldOverrideControlVisible),yt(a),i[n]=a}}}}}if(o.Header)for(const t of o.Header)i[t.Name]=vt(t,null,!0);if(o.Footer)for(const t of o.Footer)i[t.Name]=vt(t,null,!0);s.sectionNames=l,a[o.Id]=s}}if(e&&e.Navigation&&(u=e.Navigation),e&&e.Header){const t=bt(e.Header);if(t)for(const e of t)i[e.Name]=vt(e,null,!0),yt(i[e.Name]);r.bodyVisible=!1!==e.Header.BodyVisible,r.commandBarVisible=!1!==e.Header.CommandBarVisible,r.tabNavigatorVisible=!1!==e.Header.TabNavigatorVisible}if(e&&e.Footer){const t=bt(e.Footer);if(t)for(const e of t)i[e.Name]=vt(e,null,!0),yt(i[e.Name]);l.visible=!1!==e.Footer.Visible}return{formId:s,tabs:a,sections:n,controls:i,selectedTab:Object(O.a)(),selectedRelatedEntity:null,isSaving:!1,invalidControls:{},invalidAttributes:{},controlUnboundOutputs:{},inlineQuickForms:e&&e.InlineQuickForms?e.InlineQuickForms:null,xrmReady:!1,label:"",navigation:u,viewportWidth:0,viewportHeight:0,showHeaderFieldsInSection:!1,headerFieldsInFlyout:new Set,isAutoSaving:!1,header:r,footer:l}}function vt(t,e,s){return t?{parentSectionName:e,visible:t.Visible,label:t.Label,valid:s,labelSource:t.LabelSource,domId:t.DomId,parameters:t.Parameters,dataFieldName:t.DataFieldName,relationship:t.Relationship}:null}function St(t,e,s,a,i,r,c,l=null,u){const h=Object(o.cb)(t,r,c),d=Object(tt.a)(t,r);n.a.equals(null==h?void 0:h.formId,null==a?void 0:a.formId)&&n.a.equals(s,null==d?void 0:d.formId)||e(function(t,e,s,a,n,i=null,r){return{type:et,payload:{formId:t,formUIState:e,formMetadataState:s,relatedEntityMetadataState:i,currentLanguageId:r},meta:{pageId:a,contextToken:n}}}(s,a,i,r,c,l,u))}function yt(t){t&&t.parameters&&t.parameters.DefaultViewId&&(t.parameters.defaultviewid=t.parameters.DefaultViewId)}},RD1j:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("UIlN");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t,e,s){const n=Object(a.b)(t,e);return n&&n.injectedXML&&n.injectedXML[s]||null}},TAjd:function(t,e,s){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a;s.d(e,"a",(function(){return a})),function(t){t.collapsed="collapsed",t.expanded="expanded",t.floating="floating",t.getDefaultDisplayState=function(){return t.collapsed}}(a||(a={}))},WRDA:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){return Object(a.b)(t)?null:("{"===(t=t.trim())[0]&&"}"===t[t.length-1]&&(t=t.substring(1,t.length-1)),t.toLowerCase())}},bJaF:function(t,e,s){"use strict";s.d(e,"a",(function(){return oe}));var a,n=s("DRVD"),i=s.n(n),r=s("arV0"),o=s("TAjd"),c=s("uNu9"),l=s("uNLT"),u=s("tT9w"),h=s("ofgb"),d=s("+hq9"),g=s("Uv1Y"),p=s("SAYH"),f=s("+nNZ"),_=s("7tM0");!function(t){t[t.None=0]="None",t[t.Processing=1]="Processing",t[t.Completed=2]="Completed",t[t.Failure=3]="Failure",t[t.Invalid=4]="Invalid"}(a||(a={}));class m{constructor(t,e){this._getState=t,this._processId=e}GenerateMessageForAction(t){let e="";const s="cc_MscrmControls.Containers.ProcessBreadCrumb/strings/ProcessControlResources",n=this._getState(),i=Object(_.a)(n,s,"ProcessControl_ActionExecuter_ExecutionTimeTooltip"),r=Object(_.a)(n,s,"ProcessControl_ActionExecuter_ErrorMessageTooltip"),o=Object(_.a)(n,s,"Crm_GenericErrorMessage");switch(t){case a.Completed:e=String.format(i,(new Date).toLocaleString());break;case a.Failure:e=String.format(i,(new Date).toLocaleString())+"\n"+String.format(r,o)}return e}GetActionMetadata(t){const e=Object(f.a)(this._getState(),new p.a(this._processId.guid));let s;return e&&e.businessProcessFlowActions&&e.businessProcessFlowActions[t]&&(s=e.businessProcessFlowActions[t]),s}InvokeProcessAction(t,e,s){return Xrm.Utility.invokeProcessActionInternal(t,s,e)}}var b=s("i1f0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function P(t){if(!t)return null;const e=function(t){const e=[];return t.forEach(t=>{const s={id:p.a.tryParse(t.Id),primaryField:t.PrimaryField,entityTypeCode:t.EntityTypeCode,entityLogicalName:t.EntityLogicalName,primaryKeyName:t.PrimaryKeyName};e.push(s)}),e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */(t.NavigationEntities);return{entityDisplayName:t.EntityDisplayName,entityLogicalName:t.EntityLogicalName,entityTypeCode:t.entityTypeCode,showCreate:t.ShowCreate,navigationEntities:e}}function v(t,e,s,a){return{type:"businessProcessFlow.retrieveNavigationEntities.async",execute:({dispatch:n,getState:i},r)=>function(t,e,s,a,n){return t.retrieveNavigationEntities(e,s,a,n,null).nativePromise().then(P,g.b)}(r.DataSource,t,e,s,a)}}var S=s("rodW"),y=s("bCAK"),I=s("LFkE");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class O{constructor(t,e){this.Target=t,this.NewProcess=e}getMetadata(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class C{constructor(t,e,s){this.Target=t,this.NewProcess=e,this.NewProcessInstance=s}getMetadata(){return{boundParameter:null,parameterTypes:{Target:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcess:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5},NewProcessInstance:{typeName:"Microsoft.Dynamics.CRM.crmbaseentity",structuralProperty:5}},operationName:"SetProcess",operationType:0}}}var w=s("w72X"),F=s("EHQq");function j(t,e,s,a,n,i){return{type:"businessProcessFlow.navigateToNextEntity.async",execute:({dispatch:r,getState:o},c)=>function(t,e,s,a,n,i,r){const o=new F.a(p.a.toLegacyGuid(e.id),e.etn,p.a.toLegacyGuid(s.id),s.etn,p.a.toLegacyGuid(a),n,p.a.toLegacyGuid(i),p.a.toLegacyGuid(r));return t.execute(o,null).nativePromise()}(c.DataSource,t,e,s,a,n,i)}}var E=s("sNgR");class N{constructor(t,e){this.EntityId=t,this.EntityLogicalName=e}getMetadata(){return{boundParameter:null,parameterTypes:{EntityId:{typeName:"Edm.Guid",structuralProperty:1},EntityLogicalName:{typeName:"Edm.String",structuralProperty:1}},operationName:"RetrieveProcessInstances",operationType:1}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class M{constructor(t,e){this.EntityLogicalName=t,this.AppModuleId=e}getMetadata(){return{boundParameter:null,parameterTypes:{EntityLogicalName:{typeName:"Edm.String",structuralProperty:1},AppModuleId:{typeName:"Edm.Guid",structuralProperty:1}},operationName:"RetrieveFilteredProcesses",operationType:1}}}var T=s("E5IU");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class D{constructor(t,e,s){this._name=t,this._uniqueName=e,this._workflowId=s}get workflowId(){return this._workflowId}set workflowId(t){this._workflowId=t}get uniqueName(){return this._uniqueName}set uniqueName(t){this._uniqueName=t}get name(){return this._name}set name(t){this._name=t}}var x=s("WPtp");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class A{get activeStageId(){return this._activeStageId}set activeStageId(t){this._activeStageId=t}set businessProcessInstanceId(t){this._businessProcessInstanceId=t}get businessProcessInstanceId(){return this._businessProcessInstanceId}get businessProcessInstanceName(){return this._businessProcessInstanceName}set businessProcessInstanceName(t){this._businessProcessInstanceName=t}get businessProcessState(){return this._businessProcessState}set businessProcessState(t){this._businessProcessState=t}get businessProcessStatus(){return this._businessProcessStatus}set businessProcessStatus(t){this._businessProcessStatus=t}get navigationEntities(){return this._navigationEntities}set navigationEntities(t){this._navigationEntities=t}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}get bpfDefinitionVersionNumber(){return this._bpfDefinitionVersionNumber}set bpfDefinitionVersionNumber(t){this._bpfDefinitionVersionNumber=t}}var B=s("sxfa");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class R{get id(){return this._id}set id(t){this._id=t}get primaryField(){return this._primaryField}set primaryField(t){this._primaryField=t}get entityTypeCode(){return this._entityTypeCode}set entityTypeCode(t){this._entityTypeCode=t}get entityLogicalName(){return this._entityLogicalName}set entityLogicalName(t){this._entityLogicalName=t}get primaryKeyName(){return this._primaryKeyName}set primaryKeyName(t){this._primaryKeyName=t}}var k,L=s("hvSt");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */!function(t){t[t.Active=0]="Active",t[t.Inactive=1]="Inactive"}(k||(k={}));
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class V{constructor(t){this._stageManager=t,this._populateTraversedPath()}getTraversedPath(){return this._traversedPath}_populateTraversedPath(){this._traversedPath=this._stageManager.globalPathAndActiveStage.traversedPath.path}}var q=s("blB4"),W=s("UuJw");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class U extends Error{constructor(t){super(t),this.navigationStatus=q.a.invalid,this.stageInvalidReason=W.a.invalid,Object.setPrototypeOf(this,U.prototype)}}Error;class G extends Error{constructor(t){super(t),this.stageInvalidReason=W.a.unreachable,Object.setPrototypeOf(this,G.prototype)}}class H extends Error{constructor(t){super(t),this.navigationStatus=q.a.dirtyForm,this.stageInvalidReason=W.a.dirtyForm,Object.setPrototypeOf(this,H.prototype)}}class z extends Error{constructor(t){super(t),this.navigationStatus=q.a.end,Object.setPrototypeOf(this,z.prototype)}}class Y extends Error{constructor(t){super(t),this.navigationStatus=q.a.beginning,Object.setPrototypeOf(this,Y.prototype)}}class K extends Error{constructor(t){super(t),this.navigationStatus=q.a.stageGate,Object.setPrototypeOf(this,K.prototype)}}class X extends Error{constructor(t){super(t),this.navigationStatus=q.a.invalidProcess,this.stageInvalidReason=W.a.invalidProcess,Object.setPrototypeOf(this,X.prototype)}}class J extends Error{constructor(t){super(t),this.navigationStatus=q.a.dirtyForm,this.stageInvalidReason=W.a.dirtyForm,Object.setPrototypeOf(this,J.prototype)}}var Z=s("odYE"),$=s("mL5Q"),Q=s("f/sd"),tt=s("53SR"),et=s("nexV"),st=s("quej"),at=s("ijzp"),nt=s("WY/A"),it=s("sX6v"),rt=s("P+kM"),ot=s("YYhu"),ct=s("srnJ"),lt=s("5Oca"),ut=s("Dea/"),ht=s("dHD5"),dt=s("bT7G"),gt=s("e3W2"),pt=s("WePp");class ft extends pt.a{constructor(t,e,s){super("BusinessProcessFlow_"+t),this.addEventParameter("ProcessId",e),this.addEventParameter("ProcessInstanceId",s)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class _t extends ft{constructor(t,e){super("Initialized",t,e)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class mt extends ft{constructor(t,e,s){super("SetActiveStageEvent",t,e),this.addEventParameter("ActiveStageId",s)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class bt extends ft{constructor(t,e,s){super("DisplayStateEvent",t,e),this.addEventParameter("CurrentDisplayState",s)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Pt extends ft{constructor(t,e,s,a){super("StatusEvent",t,e),this.addEventParameter("ProcessStatus",s),this.addEventParameter("CurrentDisplayState",a)}}var vt=s("uzi5"),St=s("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class yt{getMetadata(){return{boundParameter:"entity",operationName:"ExecuteWorkflow",operationType:0,parameterTypes:{entity:{typeName:"Microsoft.Dynamics.CRM.workflow",structuralProperty:5},EntityId:{typeName:"Edm.Guid",structuralProperty:1},InputArguments:{typeName:"Microsoft.Dynamics.CRM.InputArgumentCollection",structuralProperty:2}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class It{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Type:{typeName:"Edm.String",structuralProperty:1},Value:{typeName:"Edm.String",structuralProperty:1}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Ot{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Count:{typeName:"Edm.Int32",structuralProperty:1},IsReadOnly:{typeName:"Edm.Boolean",structuralProperty:1},Keys:{typeName:"Edm.String",structuralProperty:4},Values:{typeName:"mscrm.AnyComplexType",structuralProperty:4}}}}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Ct{getMetadata(){return{boundParameter:null,operationName:null,operationType:null,parameterTypes:{Arguments:{typeName:"Microsoft.Dynamics.CRM.InputArgument",structuralProperty:2}}}}}var wt,Ft=s("+XGO"),jt=s("mIxf"),Et=s("AFlp"),Nt=s("k1f1");!function(t){t[t.ProcessAction=0]="ProcessAction",t[t.TaskFlow=1]="TaskFlow",t[t.SyncWorkflow=2]="SyncWorkflow",t[t.AsyncWorkflow=3]="AsyncWorkflow",t[t.MessageAction=4]="MessageAction"}(wt||(wt={}));var Mt=s("D4Jo"),Tt=s("JF0K"),Dt=s("iZ7K"),xt=s("JP46");var At=s("ghNp");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */var Bt=s("VcAV");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class Rt{constructor(t,e){this._getState=t,this._applicationContext=e}setBpfInstance(t){return this._processInstance=t,this}setBpfInstanceName(t){return this._processInstanceName=t,this}setProcess(t){return this._process=t,this}setProcessId(t){return this._processId=t,this}setFormEntity(t){return this._formEntity=t,this}GetFlowStepMetadata(t,e){const s=e.TraceManager.getTracer("businessProcessFlow.flowStepManager"),a=this._processId&&this._processId.guid||null,n=Object(f.a)(this._getState(),p.a.tryParse(a));if(Object(Bt.c)(n))return s.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined bpfDescriptor: "+n),null;const i=n.businessProcessFlowFlows;if(Object(Bt.c)(i))return s.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined businessProcessFlowFlows: "+i),null;const r=i[t];return Object(Bt.c)(i)?(s.warn("Failure in FlowStepManager GetFlowStepMetadata: IsNullOrUndefined flowStepDescriptor: "+r),null):r}openFlowWidget(t,e){if(p.a.tryParse(t.flowStepId)===p.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStepId: "+t.flowStepId);const s=this._populateFlowDialogParams(t,e),a={height:600,width:600};Xrm.Navigation.openDialog("MicrosoftFlowsDialog",a,s)}_populateFlowDialogParams(t,e){const s=this.GetFlowStepMetadata(t.flowStepId,this._applicationContext);if(Object(Bt.c)(s))throw new Error("BPF Flow Step Failure: null metadata");const a={},n=s.flowId;if(Object(Bt.c)(n))throw new Error("BPF Flow Step Failure: null metadata.flowId");if(!this._processInstance&&!this._processInstance.id){const t=[];t.push(this._processInstance.id.guid);const e=JSON.stringify(t);a.entity_ids=e}a.flow_id=n,a.org_unique_name=Xrm.Utility.getGlobalContext().getOrgUniqueName(),a.bpf_step_id=t.flowStepId;const i=Xrm.Page.data.entity.getEntityName(),r=this._getState().metadata.entities[i].EntitySetName,o=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowDestinationUrl");a.entity_logical_collection_name=r,a.entity_logical_name=i,a.flows_destination_url=o,a.dynamics365_access_token=sessionStorage.getItem("dynamics365AccessToken");const c=Xrm.Utility.getGlobalContext().getAdvancedConfigSetting("MicrosoftFlowFirstPartyIntegrationSiteUrl");a.flows_fpi_site_url=c+"&flowsEnableWidgetV2=true",a.flows_authentication_string=this._getLocalizedLabel("SystemCustomization.SystemSettingsDialog.PreviewTab.IsMicrosoftFlowEnabled.AuthenticateButton.Text"),a.flows_enable_widget_v2=!0,Rt.UpdateEventParameter(e,"flows_destination_url",o),Rt.UpdateEventParameter(e,"flow_id",n),Object(Bt.c)(t.workflowLogId)||t.workflowLogId===p.a.EMPTY||(a.flows_wflog_id=p.a.toString(t.workflowLogId));const l=this._processInstance&&this._processInstance.id;if(Object(Bt.c)(l)||l===p.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceId: "+l);a.bpf_instance_id=p.a.toString(l);const u=this._processInstance&&this._processInstance.etn;if(Object(St.b)(u))throw new Error("BPF Flow Step On-Click Failure: null or empty processInstanceEntityLogicalName: "+u);a.bpf_instance_entity_name=u;const h=this._processId&&this._processId.guid||null;if(p.a.tryParse(h)===p.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty processId: "+h);a.bpf_definition_id=h,a.bpf_definition_entity_name="workflow";const d=this._process&&this._process.get_Name();if(Object(St.b)(d))throw new Error("BPF Flow Step On-Click Failure: null or undefined bpfDefinitionName: "+d);if(a.bpf_definition_name=d,Object(St.b)(this._processInstanceName))throw new Error("BPF Flow Step On-Click Failure: null or undefined processInstanceName: "+this._processInstanceName);a.bpf_instance_name=this._processInstanceName;const g=t.selectedStage&&t.selectedStage.get_Description();if(Object(St.b)(g))throw new Error("BPF Flow Step On-Click Failure: null or undefined flowStageName: "+g);a.bpf_flowstage_localized_name=g,a.bpf_flowstage_entity_name=i,a.bpf_flowstage_entity_collection_name=r;const f=this._formEntity&&this._formEntity.id;if(Object(Bt.c)(f)||f===p.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty flowStageRecordId: "+f);a.bpf_flowstage_entity_record_id=p.a.toString(f);const _=p.a.tryParseOrNull(t.activeStage&&t.activeStage.get_Id()||"");if(Object(Bt.c)(_)||_===p.a.EMPTY)throw new Error("BPF Flow Step On-Click Failure: null or empty activeStageId: "+_);a.bpf_activestage_id=p.a.toString(_);const m=t.activeStage&&t.activeStage.get_Description();if(Object(St.b)(m))throw new Error("BPF Flow Step On-Click Failure: null or undefined activeStageName: "+m);return a.bpf_activestage_localized_name=m,a.bpf_activestageentity_name="processstage",a}_getLocalizedLabel(t){return Xrm.Utility.getResourceString("Main_system_library",t)}static getTelemetryParamsForFlowStep(t,e,s,a,n){const i=n||[],r={name:"flow_id",value:t},o={name:"environment_id",value:e},c={name:"flows_destination_url",value:s},l={name:"bpf_step_id",value:a};return i.push(r),i.push(o),i.push(c),i.push(l),i}static UpdateEventParameter(t,e,s){t&&0!==t.length&&t.some(t=>{if(t.name===e)return t.value=s,!0})}}var kt=s("Lyxw"),Lt=s("7LBy"),Vt=s("ftQm"),qt=s("2Ct/"),Wt=s("84PK"),Ut=s("Exmh"),Gt=s("cfbi"),Ht=s("pF61");var zt=s("8O0c"),Yt=s("g6bs"),Kt=s("zmL5"),Xt=s("jq7Z"),Jt=s("xMtD"),Zt=s("7Sr4"),$t=s("1uZV"),Qt=s("tICD"),te=s("E8F2"),ee=s("UqQu");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
const se=i.a.createEvent("Initialize","BusinessProcessFlow.ProcessManager"),ae=i.a.createEvent("SetActiveStage","BusinessProcessFlow.ProcessManager"),ne=i.a.createEvent("ValidateRequiredFields","BusinessProcessFlow.ProcessManager"),ie=i.a.createEvent("CreateActiveStageSnapshot","BusinessProcessFlow.ProcessManager"),re=i.a.createEvent("SaveFormAndActiveStage","BusinessProcessFlow.ProcessManager");class oe{constructor(t,e,s,a,n){this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isUserSelectedStage=!1,this._isBpfFormValid=null,this._applicationContext=t,this._getState=e,this._dispatch=s,this._stageMetadata=a,this._activeStageManager=n}initilaizeWithProcessAndFormEntity(t,e,s,a,n,i){const r=se.startStopwatch({processId:p.a.toString(a),processInstanceId:p.a.toString(n.id)});this._currentPageId=i,this._processId=a,this._version=e.businessProcessFlowProcessVersion,this._currentFormEntity=s,this._currentBpfInstance=n,this._stageMetadata.setPrimaryModel(this._currentFormEntity.etn),this._stageMetadata.setObjectModel(e);const o=this._createGlobalNavigationData(t);this._activeStageManager.InitGlobalPathAndActiveStage(o),this._stageMetadata.initializeDefaultPathManager(new V(this._activeStageManager),this),this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null;const c={};if(this._isUserSelectedStage)c.selectedStageId=p.a.tryParseOrNull(this.getSelectedStageId());else{const t=this.getActiveStageId();this._isActiveStageInCurrentEntity(t)?c.selectedStageId=p.a.tryParseOrNull(t):c.selectedStageId=this._getDefaultSelectedStageId()||p.a.tryParseOrNull(t)}this._dispatch(Object(tt.a)(c,this._currentBpfInstance));const l=new _t(p.a.toString(a),p.a.toString(n.id));this._applicationContext.EventManager.ReportEvent(l),this._savedPageId!==i&&(this._savedPageId=i,this.getScriptContainerPromise().then(t=>{t&&t.getEventManager().addOnProcessChangeEvent(this.getContextToken(),()=>{this._saveCrossEntityBpf()})})),Object(qt.f)(this._getState())||this._updateProcessInstanceModifiedTime(),this._actionStepManager=new m(this._getState,a),this._flowStepManager=new Rt(this._getState,this._applicationContext).setBpfInstance(this._currentBpfInstance).setProcess(this.getProcess()).setProcessId(this.getProcessId()).setFormEntity(this._currentFormEntity).setBpfInstanceName(this.getProcessInstanceName()),this._instanceModifiedTimestamp=Object(f.f)(this._getState(),this._currentFormEntity),this._instanceModifiedTimestamp||(this._instanceModifiedTimestamp=(new Date).getTime()),Object(qt.f)(this._getState())&&Vt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);const u=this.getTelemetryParams();if(!this._currentFormEntity){this._applicationContext.TraceManager.getTracer(Tt.g).error("ProcessManager is initialized with current entity as null",u)}Object(Mt.c)(Tt.g,u,this._applicationContext),r()}_saveCrossEntityBpf(){const t=this._getState(),e=Object(r.g)(t,this._currentPageId),s=Object(Lt.a)(e),a=Object(Lt.b)(e);if(s&&a){const t=new Z.a(e.data.parentrecordtype,new p.a(e.data.parentrecordid)),n=new Z.a(e.entityTypeName,e.id);this._dispatch(Object(Et.b)(s,n)),this._dispatch(Object(Nt.b)(a,n)),this.navigateToNextEntityForCrossEntityBpf(t,n,s,a)}}initilaizeWithFormEntityOnly(t,e){this._currentPageId=e,this._currentFormEntity=t,this._processId=null,this._version=-1,this._currentBpfInstance=null,this._customControlsPresent=!1,this._renderedFromFormXml=!1,this._isBpfFormValid=null,Object(qt.f)(this._getState())||this._updateProcessInstanceModifiedTime(),Object(qt.f)(this._getState())&&Vt.a.Instance.setProcessManagerByPageId(this._currentPageId,this);const s=this.getTelemetryParams();if(!this._currentFormEntity){this._applicationContext.TraceManager.getTracer(Tt.f).error("ProcessManager is initialized with current entity as null",s)}Object(Mt.c)(Tt.f,s,this._applicationContext)}setActiveProcess(t){return new Promise((e,s)=>{const a=this.getTelemetryParams();if(!this.getCurrentFormEntity()){const t=new g.a("Current form entity is not initialized.",2147877745);return Object(Mt.b)(Tt.m,t,null,a,this._applicationContext,null,this._getState()),void s(new g.a("Current form entity is not initialized",2147877745))}const n=p.a.tryParseOrNull(t);if(!n)return Object(Mt.c)(Tt.m,a,this._applicationContext),void s(new Error("Invalid process id"));if(p.a.isNullOrEmpty(this.getCurrentFormEntity().id))return Object(Mt.c)(Tt.m,a,this._applicationContext),void s(new g.a("Not supported on new records",2147877748));const i=new O({id:p.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn},{id:p.a.toString(n),entityType:c.fc});this._dispatch(Object(w.b)(i)).then(()=>{this._executePostEvent("runOnProcessChange","setActiveProcess"),Object(Mt.c)(Tt.m,a,this._applicationContext),e()},t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>s(t)),Object(Mt.b)(Tt.m,t,null,a,this._applicationContext,null,this._getState())})})}setActiveProcessInstance(t){return new Promise((e,s)=>{const a=this.getTelemetryParams();if(!this.getCurrentFormEntity()){const t=new g.a("Current form entity is not initialized.",2147877745);return Object(Mt.b)(Tt.n,t,null,a,this._applicationContext,null,this._getState()),void s(new g.a("Current form entity is not initialized",2147877745))}const n=p.a.tryParseOrNull(t);n?this.getProcessInstances().then(t=>{if(!t||!t.value)return void s(new Error("No process instances found for current entity"));let a="";for(const e of t.value)if(e&&e.businessprocessflowinstanceid&&e.businessprocessflowinstanceid.toLowerCase()===p.a.toString(n).toLowerCase()){a=e["a_processid_value".substring(1)];break}if(Object(St.b)(a))return void s(new g.a("Supplied process instance does not match any existing instance on this entity",2147877744));const i=p.a.tryParseOrNull(a);if(!i)return void s(new Error("Invalid process id"));const r=new C({id:p.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn},{id:p.a.toString(i),entityType:c.fc},{id:p.a.toString(n),entityType:c.fc});this._dispatch(Object(w.b)(r)).then(()=>{this._executePostEvent("runOnProcessChange","setActiveProcessInstance"),e(a)},t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>s(t))})},t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>s(t))}):s(new Error("Invalid process instance id"))})}setCurrentInstance(t){this._currentBpfInstance=t}setStatus(t){return new Promise((e,s)=>{let a;if(t||s(new Error("setStatus can only be called with a valid status (active, finished, aborted")),t===L.a.Active)a=this.reactivateProcess();else if(t===L.a.Finished)a=this.completeProcess();else{if(t!==L.a.Aborted)return s(new Error("Invalid status passed to setStatus"));a=this.abandonProcess()}a.then(()=>{const s=new Pt(p.a.toString(this._processId),p.a.toString(this.getProcessInstanceId()),t,this.getDisplayState());this._applicationContext.EventManager.ReportEvent(s),e()},t=>{s(t)})})}setVisible(t){if(Object(St.a)(this._currentBpfInstance)||Object(St.a)(this._currentFormEntity)||Object(St.a)(this._currentFormEntity.etn))return;const e=Object(ht.h)(this._currentFormEntity.etn);this._dispatch(Object(gt.b)(this._currentPageId,vt.a,e,!0===t)),this._updateProcessInstanceModifiedTime()}isVisible(){if(!this._currentBpfInstance)return!1;const t=Object(ht.h)(this._currentFormEntity.etn);return!0===Object(b.G)(this._getState(),{id:this._currentPageId,controlName:vt.a},t)}getCurrentFormEntity(){return this._currentFormEntity}getActiveStageEntityRef(){const t=this._getStage(this.getActiveStageId()),e=t&&t.get_parent()&&t.get_parent().get_Name()||null,s=this._getNavigationEntityIdsByEntityLogicalName();return e&&s&&s.hasOwnProperty(e)?new Z.a(e,s[e]):null}getProcess(){return this._currentBpfInstance&&this._stageMetadata.getProcessObjectModel()}getProcessInstanceName(){return this._currentBpfInstance&&Object(y.e)(this._getState(),this._currentBpfInstance)}getTraversedPath(){return Object(y.h)(this._getState(),this._currentBpfInstance)}getProcessId(){return this._processId}getVersion(){return this._version}getProcessInstanceId(){return this._currentBpfInstance&&this._currentBpfInstance.id}getBpfEntityLogicalName(){return this._currentBpfInstance&&this._currentBpfInstance.etn}getEntityStages(){return this._stageMetadata.getEntityStages()}getActiveStage(){return this._getStage(this.getActiveStageId())}getProcessInstances(){return new Promise((t,e)=>{var s,a;this._dispatch((s=this._currentFormEntity.id,a=this._currentFormEntity.etn,{type:"businessProcessFlow.retrieveProcessInstancesRequest.async",execute({dispatch:t,getState:e},n){const i=n.DataSource.get_WebAPIService(),r=new N(s,a),o=Object(E.a)(e(),r);return i.sendRequest(o).then(t=>t.json(),g.b)}})).then(e=>{t(e)},t=>{e(t)})})}getSelectedStage(){return this._getStage(this.getSelectedStageId())}isCrossEntityNavigation(t){const e=t?this._stageMetadata.getNextStageId(this.getActiveStageId()):this._stageMetadata.getPreviousStageId(this.getActiveStageId());if(!e)return!1;const s=this._stageMetadata.getStage(e);if(!s)return!1;const a=s.get_parent();return this._currentFormEntity&&this._currentFormEntity.etn&&a&&a.get_EntityLogicalName()!==this._currentFormEntity.etn}_isStageOnPath(t,e){for(const s of e)if(p.a.equals(s,t))return!0;return!1}getProcessState(){const t=Object(f.a)(this._getState(),this.getProcessId());return t?t.businessProcessFlowProcessState:null}getState(){if(this._currentBpfInstance){const t=Object(y.f)(this._getState(),this._currentBpfInstance);if(t){const e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null}getStatusName(){if(this._currentBpfInstance){const t=Object(y.g)(this._getState(),this._currentBpfInstance);if(t){return t.label}}return null}getStatus(){if(this._currentBpfInstance){const t=Object(y.g)(this._getState(),this._currentBpfInstance);if(t){const e=parseInt(t.valueString,10);return isNaN(e)?null:e}}return null}getActiveStageId(){if(this._currentBpfInstance){let t=this._currentBpfInstance&&Object(y.a)(this._getState(),this._currentBpfInstance);if(p.a.isNullOrEmpty(t)&&this._currentBpfInstance&&this._activeStageManager&&this._activeStageManager.globalPathAndActiveStage){const e=this._activeStageManager.globalPathAndActiveStage.stageId;e&&(t=p.a.tryParseOrNull(e))}if(!p.a.isNullOrEmpty(t)){const e=this.getActivePath();if(e&&e.length>0)return this._isStageOnPath(t,e)?t.guid:e[0].guid}}return null}getActivePathStages(){const t=this.getActivePath();if(t){const e=new Array(t.length);for(let s=0;s<t.length;s++)e[s]=this._getStage(t[s].guid);return e}return null}getActivePath(){if(!this._currentBpfInstance)return null;let t=Object(I.c)(this._getState(),this.getProcessInstanceId());return t||(t=this._getDefaultActivePath()),t}getDisplayState(){return this._currentBpfInstance?Object(I.d)(this._getState())||o.a.getDefaultDisplayState():null}getSelectedStageId(){if(!this._currentBpfInstance)return null;const t=Object(I.g)(this._getState(),this.getProcessInstanceId());return t?t.guid:this.getActiveStageId()}_getDefaultSelectedStageId(){if(!this._currentBpfInstance)return null;const t=Object(I.g)(this._getState(),p.a.EMPTY);return t&&!this._stageMetadata.getStage(t.guid)?null:t}_isActiveStageInCurrentEntity(t){try{return this._stageMetadata.getStage(t).get_parent().get_Name()===this._currentFormEntity.etn}catch(t){this._applicationContext.EventManager.ReportComponentFailure("ProcessManager._isActiveStageInCurrentEntity",t)}return!0}getStageMetadata(){return this._stageMetadata}isBusinessProcessAborted(){return this.getStatus()===L.a.Aborted}isBusinessProcessCompleted(){return this.getStatus()===L.a.Finished}moveToNextStage(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>{if(Object(St.a)(this._currentBpfInstance))return e(new g.a("Process Control does not exist on form.",2147877746));const s=this._stageMetadata.getNextStageId(this.getActiveStageId());if(!s)return void e(new z("Last stage in the active path reached. Next stage does not exist."));t(this._saveMainFormIfImmersiveBpfAndNewRecord().then(()=>this._saveFormDataAndActiveStage(p.a.tryParseOrNull(s),0,"MoveToNextStage")))});return e.then(()=>{Object(Mt.c)(Tt.h,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(Mt.c)(Tt.h,t,this._applicationContext):Object(Mt.b)(Tt.h,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}moveToPreviousStage(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>{if(Object(St.a)(this._currentBpfInstance))return e(new g.a("Process Control does not exist on form.",2147877746));const s=this._stageMetadata.getPreviousStageId(this.getActiveStageId());if(!s)return e(new Y("The first stage in the traversed path reached. Previous stage does not exist."));t(this._saveFormDataAndActiveStage(p.a.tryParseOrNull(s),1,"MoveToPreviousStage"))}).then(()=>{this._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(this.getActiveStageId())});return e.then(()=>{Object(Mt.c)(Tt.i,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(Mt.c)(Tt.i,t,this._applicationContext):Object(Mt.b)(Tt.i,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}setActiveStage(t){const e=ae.startStopwatch({processId:p.a.toString(this.getProcessId()),processInstanceId:p.a.toString(this.getProcessInstanceId()),stageId:t}),s=this.getTelemetryParams(),a=new Promise((e,s)=>{const a=p.a.tryParseOrNull(t),n=this.getTraversedPath();if(Object(St.a)(this._currentBpfInstance))return s(new g.a("Process Control does not exist on form.",2147877746));if(!a)return s(new U("setActiveStage can only be called with a valid stage id"));if(!this._stageMetadata.getStage(a.guid))return s(new U("stage id does not exist on any path of the instance"));if(!n)return s(new U("Traversed Path is not present"));if(this.getActiveStageId()===a.guid)return e();const i=new B.a(n);if(!i||!i.isInTraversedPath(t)){return s(this.getActivePath().some(t=>p.a.equals(t,a))?new U("The stage is not in traversed path. Only navigating backwards is supported."):new G("stage id does not exist on the current acitve path of the instance."))}e(this._saveFormDataAndActiveStage(a,1,"SetActiveStage"))}).then(()=>{const e=new mt(p.a.toString(this._processId),p.a.toString(this.getProcessInstanceId()),t);this._applicationContext.EventManager.ReportEvent(e),this._stageMetadata.getDefaultPathManager().triggerSubsequentDefaultPathCalculation(t)});return a.then(()=>{e(),Object(Mt.c)(Tt.o,s,this._applicationContext)},t=>{e(),this._shouldReportErrorAsSuccess(t)?Object(Mt.c)(Tt.o,s,this._applicationContext):Object(Mt.b)(Tt.o,t,null,s,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),a}switchProcess(){}abandonProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(St.a)(this._currentBpfInstance)?e(new g.a("Process Control does not exist on form.",2147877746)):this.isBusinessProcessAborted()?t():void t(this._updateStateAndStatusOfProcess(L.a.Aborted,k.Inactive,"AbandonProcess")));return e.then(()=>{Object(Mt.c)(Tt.a,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(Mt.c)(Tt.a,t,this._applicationContext):Object(Mt.b)(Tt.a,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}reactivateProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(St.a)(this._currentBpfInstance)?e(new g.a("Process Control does not exist on form.",2147877746)):this.getStatus()===L.a.Active?t():void t(this._updateStateAndStatusOfProcess(L.a.Active,k.Active,"ReactivateProcess")));return e.then(()=>{Object(Mt.c)(Tt.j,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(Mt.c)(Tt.j,t,this._applicationContext):Object(Mt.b)(Tt.j,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}completeProcess(){const t=this.getTelemetryParams(),e=new Promise((t,e)=>Object(St.a)(this._currentBpfInstance)?e(new g.a("Process Control does not exist on form.",2147877746)):this.isBusinessProcessCompleted()?t():p.a.tryParseOrNull(this._stageMetadata.getNextStageId(this.getActiveStageId()))?e(new g.a("Attempt to finish a process not on last stage.",2148081666)):void t(this._saveMainFormIfImmersiveBpfAndNewRecord().then(()=>this._updateStateAndStatusOfProcess(L.a.Finished,k.Inactive,"CompleteProcess"))));return e.then(()=>{Object(Mt.c)(Tt.c,t,this._applicationContext)},e=>{this._shouldReportErrorAsSuccess(e)?Object(Mt.c)(Tt.c,t,this._applicationContext):Object(Mt.b)(Tt.c,e,null,t,this._applicationContext,this.getCurrentFormEntity(),this._getState())}),e}_shouldReportErrorAsSuccess(t){return t instanceof X||(t instanceof K||(t instanceof z||(t instanceof Y||(t instanceof U||(t instanceof G||t instanceof J)))))}triggerActionStepClick(t){if(Object(St.b)(t)){const t=new Error("BPF Action Step Failure: null ControlId");throw Object(Mt.b)(Tt.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}const e=this._actionStepManager.GetActionMetadata(t);if(Object(St.a)(e)){const t=new Error("BPF Action Step Failure: null metadata");throw Object(Mt.b)(Tt.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}const s=this._getState();if(Object(St.a)(s)){const t=new Error("BPF Action Step Failure: null state");throw Object(Mt.b)(Tt.b,t,null,this.getTelemetryParams(),this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}let a=this._getTelemetryParamsForActionStep(e.actionType,t,e.actionId);try{const s=new p.a(e.actionId);if(e.actionType===wt.AsyncWorkflow||e.actionType===wt.SyncWorkflow){const n=["BusinessProcessFlowId","BusinessProcessFlowInstanceId","ActionStepId"],i=[this._processId.guid,p.a.toString(this.getProcessInstanceId()),s.guid].map(t=>{const e=new It;return e.Type="System.String",e.Value=t,e}),r=new Ot;r.Keys=n,r.Values=i,r.Count=3,r.IsReadOnly=!0;const o=new Ct;o.Arguments=r;const c=new yt;c.EntityId=this._currentFormEntity.id,c.InputArguments=o,c.entity={id:e.workflowId,entityType:"workflow"},this.UpdateActionLog(s,1),this._dispatch(Object(w.b)(c)).then(()=>{Object(Ft.a)(this._currentPageId,this.getContextToken(),t),this.UpdateActionLog(s,2,this._actionStepManager.GenerateMessageForAction(2)),Object(Mt.c)(Tt.b,a,this._applicationContext)},e=>{Object(Ft.a)(this._currentPageId,this.getContextToken(),t),this.UpdateActionLog(s,3,this._actionStepManager.GenerateMessageForAction(3)),Object(Mt.b)(Tt.b,e,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState()),this._dispatch(Object(u.b)(e,!0)).then()})}else if(e.actionType===wt.ProcessAction){const n=e=>{Object(Ft.a)(this._currentPageId,this.getContextToken(),t),this.UpdateActionLog(s,3,this._actionStepManager.GenerateMessageForAction(3)),Object(Mt.b)(Tt.b,e,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState()),this._dispatch(Object(u.b)(e,!0)).then()},i=n=>{Object(Ft.a)(this._currentPageId,this.getContextToken(),t),this.UpdateActionLog(s,2,this._actionStepManager.GenerateMessageForAction(2));const i=n.get_outputParameters();e.outputBindings.forEach(t=>{if(t.parameterName in i){const e=i[t.parameterName],s=t.boundAttributeName,a={};a[s]={key:s,value:e},this._dispatch(Object(jt.a)(this._currentPageId,a,!1,!0,this._currentFormEntity.etn,this._currentFormEntity.id.guid,null,this.getContextToken()))}}),Object(Mt.c)(Tt.b,a,this._applicationContext)},r=a=>{if(a=a?a.parameters:{},this._filterInputArguments(a)){const t={id:p.a.toString(this.getCurrentFormEntity().id),entityType:this.getCurrentFormEntity().etn};a.Target=t,a.BusinessProcessFlowId=this._processId.guid,a.BusinessProcessFlowInstanceId=p.a.toString(this.getProcessInstanceId()),a.ActionStepId=e.actionId,this._actionStepManager.InvokeProcessAction(e.uniqueName,e,a).then(i,n)}else Object(Ft.a)(this._currentPageId,this.getContextToken(),t),this.UpdateActionLog(s,3,this._actionStepManager.GenerateMessageForAction(3))},o={};e.inputBindings.forEach(t=>{const e=Object(x.c)(Object(lt.j)(this._getState(),this.getCurrentFormEntity(),t.boundAttributeName));o["ProcessUnification_Arguments_"+t.parameterName]=e}),this._addInputParametersToParamList(e.inputParameters,o),this.UpdateActionLog(s,1),Xrm.Navigation.openDialog(e.workflowId,this._getDialogOptions(),o).then(r,n)}}catch(t){throw 0===a.length&&(a=this.getTelemetryParams()),Object(Mt.b)(Tt.b,t,null,a,this._applicationContext,this.getCurrentFormEntity(),this._getState()),t}}triggerFlowStepClick(t,e){e=e;const s=Rt.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams());try{const e=p.a.newGuid(),a={activeStage:this.getActiveStage(),selectedStage:this.getSelectedStage(),flowStepId:t,workflowLogId:e};this._flowStepManager.openFlowWidget(a,s),this.UpdateActionLog(new p.a(t),1,void 0,e);const n=this.getActionLog(new p.a(t));this.createWorkflowLogRecord(n),Object(Mt.c)(Tt.d,s,this._applicationContext)}catch(t){Object(Mt.b)(Tt.d,t,null,s,this._applicationContext,this.getCurrentFormEntity(),this._getState())}}refreshFlowStepClick(t){const e=Rt.getTelemetryParamsForFlowStep(null,null,null,t,this.getTelemetryParams()),s=this._dispatch(Object(zt.a)(this._processId,this._currentBpfInstance));Promise.resolve(s).then(()=>{this._updateProcessInstanceModifiedTime(),Object(Mt.c)(Tt.k,e,this._applicationContext)}).catch(t=>{Object(Mt.b)(Tt.k,t,null,e,this._applicationContext,this.getCurrentFormEntity(),this._getState())})}_addInputParametersToParamList(t,e){for(const s of Object.keys(t))"ProcessUnification_Arguments_"+t[s].parameterName in e||(e["ProcessUnification_Arguments_"+t[s].parameterName]=null)}_filterInputArguments(t){if(t&&"last_button_clicked"in t&&"ok_id"===t.last_button_clicked){const e="ProcessUnification_Arguments_";for(const s in t){const a=t[s];if(s.startsWith(e)){t[s.substring(e.length,s.length)]=a}delete t[s]}return!0}return!1}_getDialogOptions(){return{height:450,width:450,position:1}}_createSnapshotRequest(t,e){if(!t)throw new Error("Active stage cannot be null or undefined.");const s=new Z.a("processstage",t),a=this._calculateNewTraversedPath(t),n={activestageid:{reference:s,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:t.guid}},traversedpath:{value:a,timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null,userInput:""}}};return this._addFieldsToBPFSnapshotForCreate(n,e)}_addFieldsToBPFSnapshotForCreate(t,e){if(!t||!this._hasBpfInstance())return t;const s=Object(Yt.b)(this._getState(),this._currentFormEntity.etn,this._currentBpfInstance.etn);return s&&(t[s.ReferencingAttribute]={reference:new Z.a(this._currentFormEntity.etn,e),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}}),t.processid={reference:new Z.a("workflow",this.getProcessId()),timestamp:new Date,validationResult:{errorId:null,errorMessage:null,isValueValid:!0,userInput:null,isOfflineSyncError:!1}},t}generateBPFInstanceSnapshotId(){if(this.isImmersiveBPF()||!Object(kt.c)(this._getState(),"FCB.SplitBPFEntityAndParticipatingEntityCreates"))return null;let t=[],e=null;try{const s=Object(b.ac)(this._getState(),this._currentPageId,this.getContextToken()),a=Object(dt.b)(this._getState(),s);let n=a.identifier&&a.identifier.id||this._currentFormEntity.id;const i=Object(r.g)(this._getState(),this._currentPageId);if(Object(Yt.e)(i))return Object(Yt.f)(this._getState(),s,n,this._dispatch),null;if(!this._hasBpfInstance()||p.a.isNullOrEmpty(this.getProcessId()))return null;if(t=this.getTelemetryParams(),Object(Yt.d)(this._getState(),a.identifier,this._currentPageId))return Object(Yt.f)(this._getState(),s,n,this._dispatch),null;p.a.isNullOrEmpty(n)&&(n=p.a.newGuid(),Object(Yt.f)(this._getState(),s,n,this._dispatch)),e=this._createActiveStageSnapshot(p.a.tryParse(this.getActiveStageId()),n);const o=Object(dt.b)(this._getState(),e);t.push({name:"SnapshotId",value:e}),t.push({name:"Snapshot active changes",value:o&&o.activeChanges&&Object.keys(o.activeChanges).map(t=>"Property: "+t).join("; ")}),this._applicationContext.EventManager.ReportComponentSuccess("ProcessManager.generateBPFInstanceSnapshotId",t)}catch(e){this._applicationContext.EventManager.ReportComponentFailure("ProcessManager.generateBPFInstanceSnapshotId",e,null,t)}return e}_calculateNewTraversedPath(t){let e="";for(const s of this.getActivePath())if(e+=","+s.guid,p.a.equals(s,t))return e.substring(1);return e+=","+t.guid,e.substring(1)}_createActiveStageSnapshot(t,e){const s=this._createSnapshotRequest(t,e),a=ie.startStopwatch({processId:p.a.toString(this.getProcessId()),processInstanceId:p.a.toString(this.getProcessInstanceId())});let n=Object(dt.c)(this._getState(),this.getCurrentFormEntity());if(this.isImmersiveBPF()&&!Object(St.a)(n)){const t=Object(it.b)(this._getState(),n.snapshotId,s);return this._dispatch(t),n=Object(dt.c)(this._getState(),this.getCurrentFormEntity()),a(),n.snapshotId}const i=Object(ht.h)(this._currentFormEntity.etn),r=Object(ht.x)(i),o=Object(nt.b)(this._getState(),this._currentBpfInstance,s,r,this._hasBpfInstance()?ut.a.Create:ut.a.Update),c=o.payload.snapshotId;return this._dispatch(o),a(),c}_hasBpfInstance(){return!this._currentBpfInstance||p.a.isNullOrEmpty(this._currentBpfInstance.id)}_updateStateAndStatusOfProcess(t,e,s){return new Promise((a,n)=>{const i=this._createStatusAndStateUpdateRequest(t,e);let r=Object(dt.c)(this._getState(),this.getCurrentFormEntity()),o=null;if(this.isImmersiveBPF()&&!Object(St.a)(r)){const t=Object(it.b)(this._getState(),r.snapshotId,i);this._dispatch(t),r=Object(dt.c)(this._getState(),this.getCurrentFormEntity())}else{const t=Object(ht.h)(this.getCurrentFormEntity().etn),e=Object(ht.x)(t),s=Object(nt.b)(this._getState(),this._currentBpfInstance,i,e);o=s.payload.snapshotId,this._dispatch(s)}if(!this.executePreEvent("runOnPreProcessStatusChange",s,null,t))if(this._shouldPerformFormSave()){const e=this._validateSnapshot(r).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(s)).then(()=>this._saveFormEntityAndBPFEntitySnapshots(o,r,!1)).then(()=>{this._executePostEvent("runOnProcessStatusChange",s,null,t)}).catch(t=>{const e=Object(g.c)(t);return this._handleDuplicateDetection(e,o)}).catch(t=>{throw this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t}).catch(t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>n(t))});a(e)}else this._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(s).then(()=>{let e=null;e=this.isImmersiveBPF()&&!Object(St.a)(r)?r.snapshotId:o;this._dispatch(Object(ot.c)(e,!0,["statuscode","statecode","activestagestartedon","completedon"])).then(()=>{this._dispatch(Object(ct.a)(this._currentPageId,this.getCurrentFormEntity(),this._getColumnsToRefresh())).then(()=>{this._updateProcessInstanceModifiedTime(),this._executePostEvent("runOnProcessStatusChange",s,null,t)}),a()}).catch(t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>n(t))})});a()})}_validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(t){return new Promise((e,s)=>{if("CompleteProcess"===t||"MoveToNextStage"===t){const e=this.ValidateRequiredFieldsForNavigation();if(e&&!e.isValid)if("MoveToNextStage"===t)s(new K("Unable to navigate to next stage as required fields have not been set"));else{if("CompleteProcess"===t)return s(new K("Unable to complete process as required fields have not been set"));s(new Error("validation failed for unexpected BPF operation: "+t))}}return e()})}_saveFormChangesBeforeNavigation(){if(this._shouldPerformFormSave()){const t=Object(dt.c)(this._getState(),this.getCurrentFormEntity());return this._validateSnapshot(t).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures("MoveToNextStage")).then(()=>{const e=this._getColumnsToRefresh();return this._dispatch(Object(ot.c)(t.snapshotId,!0,e))}).catch(e=>(this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(e,t.snapshotId),this._dispatch(Object(u.b)(e,!0))))}return Promise.resolve()}_shouldPerformFormSave(){const t=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ShouldPerformFormSave"),e=this.getTelemetryParams(),s=this._getState();if(Object(b.kb)(s,{id:this._currentPageId},this.getContextToken()))return t.info("Skip main form save for BPF state or stage change due to read only form",e),!1;const a=this._dispatch(Object(At.b)(this._currentPageId,this.getContextToken()));if(a&&a.data&&a.data.getIsDirty){const s=a.data.getIsDirty(),n={name:"shouldPerformMainFormSave",value:s};return e.push(n),t.info("Checking if main form save should be performed due to dirty form",e),s}return t.error("Unable to determine dirty state of main form - skipping save of main form",e),!1}_saveMainFormIfImmersiveBpfAndNewRecord(){const t=Object(r.l)(this._getState(),this._currentPageId);if(this.isImmersiveBPF()&&t===Gt.a&&p.a.isNullOrEmpty(this.getCurrentFormEntity().id)){const e=1;return this._dispatch(Object(l.f)(this._currentPageId,t,!1,e,!1,!1)).then(t=>{this._currentFormEntity=t})}return Promise.resolve(void 0)}_validateSnapshot(t){return new Promise((e,s)=>{const a=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation"),n=this._getSnapshotStateTelemetryParams(t),i=this._currentPageId,r=this.getContextToken();this._dispatch(this._getEventManager().runOnSave(r,1))&&(this._dispatch(Object(h.b)(i,r,2)),this._dispatch(Object(d.b)(i,r,!1)),a.warn("BPF ProcessManager: Unable to save form data due to web resource registered onSave invoking preventDefault",n),s(new g.a("Unable to save form data due to web resource registered onSave invoking preventDefault",2147877737)));for(const e in t.activeChanges){const i=t.activeChanges[e],r=this._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(t.identifier.etn,e),o=Object(St.a)(r)?null:r.get_logicalName(),c=Object(St.a)(r)?Wt.a.get_empty():r.get_id();if(Object(St.a)(i))return a.error("BPF ProcessManager: unexpected null or undefined fieldValue for attribute "+o+" with ID: "+c,n),s(new Error("Internal Client Error - null fieldValue"));const l=i.validationResult;if(Object(St.a)(l)){if(o===xt.c){a.info("BPF ProcessManager: skipping formEntitySnapshot validation for atttribute: "+o+" with ID: "+c,n);continue}return a.error("BPF ProcessManager: unexpected null or undefined validationResult for atttribute: "+o+" with ID: "+c,n),s(new Error("Internal Client Error - null validatorResult"))}const u=l.isValueValid;if(Object(St.a)(u))return a.error("BPF ProcessManager: unexpected null or undefined validationResult.isValidValue for atttribute: "+o+" with ID: "+c,n),s(new Error("Internal Client Error - null validationResult.isValidValue"));if(!u){const t={name:Tt.q,value:"clientSideCurrentForm"};return n.push(t),a.warn("BPF ProcessManager: unable to save form due to invalid value for attribute: "+o+" with ID: "+c,n),s(new H("Unable to save form data due to validation errors"))}}return e(!0)})}_createStatusAndStateUpdateRequest(t,e){return{statuscode:{label:L.a[t],valueString:t.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}},statecode:{label:k[e],valueString:e.toString(),timestamp:new Date,validationResult:{isValueValid:!0,errorMessage:null,errorId:null}}}}ValidateRequiredFieldsForNavigation(){const t=ne.startStopwatch({processId:p.a.toString(this.getProcessId()),processInstanceId:p.a.toString(this.getProcessInstanceId())}),e=this._getState(),s=this._stageMetadata.getRequiredAttributesForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),e),a=this._stageMetadata.getRequiredFlowStepsForStage(this.getActiveStageId(),this._currentPageId,this.getContextToken(),e),n={emptySteps:[],errorSteps:[]},i=Object(dt.c)(this._getState(),this.getCurrentFormEntity()),o=this._getSnapshotStateTelemetryParams(i),c=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SnapshotValidation");for(const t of s){c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: validating attribute: "+t,o);let e=Object(lt.j)(this._getState(),this.getCurrentFormEntity(),t);i&&i.activeChanges&&t in i.activeChanges&&(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: fieldIsDirty: "+t,o),e=i.activeChanges[t]);Object(I.h)(e,this._getState(),this.getCurrentFormEntity().etn,t)?(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: emptyField: "+t,o),n.emptySteps.push(t)):e.validationResult.isValueValid||(c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: !fieldValue.validationResult.isValueValid: "+t,o),n.errorSteps.push(t))}for(const t of a){const e=p.a.tryParse(t);if(p.a.isNullOrEmpty(e)){c.error("BPF ProcessManager ValidateRequiredFieldsForNavigation: invalid Flow Step ID GUID: "+t,o);continue}const s=this.getActionLog(e);if(s){const e=s.status;2!==e&&(c.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+t+". The Flow Step Action Log has stauts of : "+e,o),n.errorSteps.push(t))}else c.info("BPF ProcessManager ValidateRequiredFieldsForNavigation: Required Flow Step not completed for stepId "+t+". No action logs were found for this Flow Step",o),n.errorSteps.push(t)}n.isValid=0===n.emptySteps.length&&0===n.errorSteps.length;const u=Object(Xt.a)(e,this._currentPageId);if(!Object(b.Gb)(u,e,this._currentPageId,this.getContextToken())){c.warn("BPF ProcessManager ValidateRequiredFieldsForNavigation: form is not valid - "+this._currentPageId,o);const t=Object(r.l)(this._getState(),this._currentPageId);this._dispatch(Object(l.f)(this._currentPageId,t,!1,1,!1,!1)),n.isValid=!1}if(!n.isValid){const t=String.format("BPF ProcessManager: ValidateRequiredFieldsForNavigation returned invalid");c.warn(t,o)}return t(),n}setSelectedStage(t,e=!1){return new Promise((s,a)=>{const n=p.a.tryParseOrNull(t);if(!n)return a("setSelectedStage can only be called with a valid stage id");const i={selectedStageId:n};this._updateBusinessProcessFlowData(this._currentBpfInstance,i),this._isUserSelectedStage=e,e&&this._executePostEvent("runOnStageSelected","setSelectedStage"),s()})}setDisplayState(t){if(this._currentBpfInstance&&(t===o.a.collapsed||t===o.a.expanded||t===o.a.floating)){this._updateDisplayState(this._currentBpfInstance,t);const e=new bt(p.a.toString(this._processId),p.a.toString(this.getProcessInstanceId()),t);this._applicationContext.EventManager.ReportEvent(e)}}setActivePath(t){if(!t||0===t.length)return;const e=[];for(let s=0;s<t.length;s++)e[s]=new p.a(t[s]);const s={activePath:e};this._updateBusinessProcessFlowData(this._currentBpfInstance,s)}setBpfNavigationBehavior(t){const e={processNavigationBehavior:{navigationBehavior:t,navigationBehaviorPageId:this._currentPageId}};this._updateBusinessProcessFlowData(this._currentBpfInstance,e)}getBpfNavigationBehavior(){return this._currentBpfInstance&&Object(I.e)(this._getState(),this.getProcessInstanceId())}shouldReInitializeNavigationBehavior(){return!(!this._currentBpfInstance||!(null==this.getBpfNavigationBehavior()&&Object(St.a)(Object(I.b)(this._getState(),this.getProcessInstanceId()))||Object(I.f)(this._getState(),this.getProcessInstanceId())!==this._currentPageId))}getBpfNavigationBehaviorAllowCreateNew(t){const e=this._currentBpfInstance&&Object(I.b)(this._getState(),this.getProcessInstanceId());return!e||!t||e(t)}createWorkflowLogRecord(t){if(Object(St.a)(t))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined actionLog");const e=this._getState();if(Object(St.a)(e))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined state");const s=e.metadata;if(Object(St.a)(s))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined metadata");const a=s.entities;if(Object(St.a)(a))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined entities");const n=this._currentBpfInstance.etn;if(Object(St.b)(n))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entityLogicalName");const i=a[n];if(Object(St.a)(i))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined bpfEntity");const r=i.EntitySetName;if(Object(St.b)(r))throw new Error("BPF Create WorkflowLog Record Failure: null or empty entitySetName");const o=Object(Dt.z)(e,"workflowlog",i.EntityLogicalName,"asyncoperationid");if(Object(St.a)(o))throw new Error("BPF Create WorkflowLog Record Failure: null or undefined relationshipMetadata");if(Object(St.b)(o.ReferencingEntityNavigationPropertyName))throw new Error("BPF Create WorkflowLog Record Failure: null or empty relationshipMetadata.ReferencingEntityNavigationPropertyName");const c=o.ReferencingEntityNavigationPropertyName+"@odata.bind",l="/"+r+"("+t.processInstanceid.guid+")",u={workflowlogid:t.actionLogId.guid,stepname:t.stepId.guid,[c]:l,activityname:t.processDefinitionid.guid,status:t.status};Xrm.WebApi.createRecord("workflowlog",u)}_getTracer(){return Object(St.a)(this._applicationContext)||Object(St.a)(this._applicationContext.TraceManager)?null:this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManager")}_getDefaultActivePath(){const t=this._getTracer();if(Object(St.a)(this._stageMetadata))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined _stageMetadata"),null;const e=this._stageMetadata.getDefaultPathManager();if(Object(St.a)(e))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined defaultPathManager"),null;const s=e.getDefaultPath();if(Object(St.a)(s))return t&&t.error("ProcessManager _getDefaultActivePath method: NullOrUndefined stringPath"),null;const a=[];for(const t in s){const e=p.a.parse(s[t]);a.push(e)}return a}_updateBusinessProcessFlowData(t,e){t&&(this._dispatch(Object(tt.a)(e,t)),this._updateProcessInstanceModifiedTime())}_updateDisplayState(t,e){this._dispatch(Object(et.a)(e,t)),this._updateProcessInstanceModifiedTime()}getForwardNavigationEntities(t,e,s,a){return this._saveFormChangesBeforeNavigation().then(()=>this._dispatch(v(t,e,s,a||null)))}navigateToNextEntity(t,e,s,a){return new Promise((n,i)=>{const r=this.ValidateRequiredFieldsForNavigation();if(r&&!r.isValid)return i(new K("Unable to navigate to next stage as required fields have not been set"));const o=this._stageMetadata.getNextStageId(this.getActiveStageId());if(!o)return i(new z("Last stage in the active path reached. Next stage does not exist."));const c=new p.a(o),l=this.getTraversedPath()+","+o;return this._saveFormChangesBeforeNavigation().then(()=>this._dispatch(j(t,e,c,l,s,a))).then(()=>this.setSelectedStage(o)).then(()=>{this._executePostEvent("runOnStageChange","navigateToNextEntity",0),n()}).catch(t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>i(t))})})}navigateToNextEntityForCrossEntityBpf(t,e,s,a){return new Promise((n,i)=>{this._dispatch(j(t,e,new p.a(this.getActiveStageId()),this.getTraversedPath(),s,a)).then(()=>{this._dispatch(Object(at.b)(e,this._currentBpfInstance)),this._executePostEvent("runOnStageChange","navigateToNextEntityForCrossEntityBpf",0),n()}).catch(t=>{this._dispatch(Object(u.b)(t,!0)).then(()=>i(t))})})}getActiveStageActiveFor(){if(this._currentBpfInstance){const t=Object(y.b)(this._getState(),this._currentBpfInstance);if(t){return(new Date).valueOf()-t.valueOf()}}return null}getBpfInstanceActiveFor(){if(this._currentBpfInstance){const t=Object(y.d)(this._getState(),this._currentBpfInstance);if(t)return(new Date).valueOf()-t.valueOf()}return null}getBpfInstanceCompletedIn(){if(this._currentBpfInstance){const t=Object(y.d)(this._getState(),this._currentBpfInstance),e=Object(y.c)(this._getState(),this._currentBpfInstance);if(e&&t)return e.valueOf()-t.valueOf()}return null}getActionLogCollection(){return this._currentBpfInstance?Object(I.a)(this._getState(),this.getProcessInstanceId()):null}getActionLog(t){const e=this.getActionLogCollection();return e&&e[t.guid]?e[t.guid]:null}UpdateActionLog(t,e,s,a){if(!this._currentBpfInstance)return null;const n=Object(I.a)(this._getState(),this.getProcessInstanceId()),i=n&&n[t.guid]?n[t.guid]:null;let r=p.a.EMPTY;r=Object(St.a)(a)||a===p.a.EMPTY?i?i.actionLogId:p.a.newGuid():a;const o={actionLogId:r,status:e,modifiedOn:(new Date).toLocaleString(),stepId:t,processDefinitionid:this._processId,processInstanceid:this.getProcessInstanceId(),message:s},c=Object.assign({},n);c[t.guid]=o;const l={actionLogCollection:c};return this._updateBusinessProcessFlowData(this._currentBpfInstance,l),"success"}getEnabledProcesses(){const t=[];return new Promise((e,s)=>{var a;this._currentFormEntity&&this._currentFormEntity.etn?this._dispatch((a=this._currentFormEntity.etn,{type:"businessProcessFlow.retrieveFilteredProcesses.async",execute({dispatch:t,getState:e},s){const n=s.DataSource.get_WebAPIService(),i=e(),r=p.a.tryParse(Object(T.i)(i)),o=new M(a,r),c=Object(E.a)(e(),o);return n.sendRequest(c).then(t=>t.json(),g.b)}})).then(s=>{for(const e of s.value)t.push(new D(e.name,e.uniquename,e.workflowid));e(t)},t=>{s(t)}):s(new g.a("Current Form Entity cannot be NULL",2147877745))})}getNavigationEntities(){return this._activeStageManager.navigationEntities}_getNavigationEntityIdsByEntityLogicalName(){return this._activeStageManager.navigationEntityIdsByEntityLogicalName}_updateGlobalActiveStage(t,e){this._activeStageManager.UpdateGlobalPathAndActiveStage(t,e)}_createGlobalNavigationData(t){const e=new A,s=Object(x.b)(t.activestageid);e.activeStageId=p.a.toString(s);let a=Object(x.c)(t.traversedpath);Object(St.b)(a)&&(a=B.a.getCandidateTraversedPathFromStagStep(this._stageMetadata.businessProcessFlowVisitor.get_stages(),e.activeStageId)),e.traversedPath=a,e.navigationEntities=[];const n=this._getNavigationEntityTypesFromWorkflowObjectModel();for(const s of n){const a=new R;a.entityLogicalName=s,a.id=p.a.EMPTY.guid;for(const e in t)if(Object(x.k)(t[e])){const n=t[e],i=[],r="NULL";if(Object(St.a)(n.reference)||Object(St.a)(n.reference.etn)){i.push({name:"entityReference.reference",value:r});this._applicationContext.TraceManager.getTracer("CreateGlobalNavigationData").info("Navigation entity should not be null .",i)}n&&n.reference&&n.reference.etn===s&&(a.id=n.reference.id.guid)}e.navigationEntities.push(a)}t.hasOwnProperty("businessprocessflowinstanceid")&&(e.businessProcessInstanceId=Object(x.c)(t.businessprocessflowinstanceid));t.hasOwnProperty("name")&&(e.businessProcessInstanceName=Object(x.c)(t.name));t.hasOwnProperty("statecode")&&(e.businessProcessState=Object(x.c)(t.statecode));t.hasOwnProperty("statuscode")&&(e.businessProcessStatus=Object(x.c)(t.statuscode));return t.hasOwnProperty("bpfDefinitionVersioNumber")&&(e.bpfDefinitionVersionNumber=Object(x.c)(t.bpfDefinitionVersioNumber)),e}_getNavigationEntityTypesFromWorkflowObjectModel(){const t={};if(!Object(St.a)(this.getProcess()))for(let e=0;e<this.getProcess().get_Steps().get_Count();e++){const s=this.getProcess().get_Steps().get_item(e);if(!(s instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep))continue;const a=s.get_Description();t[a]||(t[a]=a)}return Object.keys(t)}reflow(t,e,s){const a=this._stageMetadata.getDefaultPathManager();if(!e&&!s)return void this._reflowInternal();if(!e)return;e=new p.a(e).guid;const n=this.getTraversedPath(),i=this.getActiveStageId();n&&i&&(i===e||n.indexOf(e)<0)&&(a.updateDefaultPath(e,s),this._updateProcessInstanceModifiedTime())}_reflowInternal(t,e){const s=this._stageMetadata.getDefaultPathManager();t||e||(e=this.getActiveStageId(),t=this._stageMetadata.getPreviousStageId(e)),t&&(s.updateDefaultPath(t,e),this._updateProcessInstanceModifiedTime())}callPblToEvaluateBranching(t){const e=this._getState();if(!this._currentPageId)throw new Error("The current page Id should not be null when callPblToEvaluateBranching has been called. Because the reflow logic should be triggered for a particular page.");const s=Object($.a)(e,this._currentPageId);this.getScriptContainerPromise().then(e=>{s<Q.a.EditReady&&e.getEventManager().addOnLoadEvent(this.getContextToken(),()=>{e.execute(t,[])}),s>=Q.a.OnLoadReady&&e.execute(t,[])})}update(t){!Object(St.a)(this._currentBpfInstance)&&this._isSelectedStageControl(t.Id)&&this._updateProcessInstanceModifiedTime()}waitForOngoingWork(){return Zt.a.getInstance().checkForOutstandingWork(this._getState())}_getEventManager(){const t=this.getScriptContainer();return t?t.getEventManager():null}getScriptContainer(){if(!this._applicationContext||!this._applicationContext.ScriptManager)return null;let t=null;try{t=this._applicationContext.ScriptManager.getContainer(this._currentPageId)}catch(t){this._logTraceFailureForScriptContainer()}return t}getScriptContainerPromise(){return this._applicationContext&&this._applicationContext.ScriptManager?this._applicationContext.ScriptManager.initializeContainer(this._currentPageId):Promise.reject("The current container should be created before invoking handlers.")}_executePostEvent(t,e,s=null,a=null){if(Object(Ht.n)(this._getState(),this._currentPageId)||!this._getEventManager())this._logTraceFailureForProcessEvent(e,t,t);else switch(t){case"runOnProcessChange":this._dispatch(this._getEventManager().runOnProcessChange(this.getContextToken(),this));break;case"runOnProcessStatusChange":this._dispatch(this._getEventManager().runOnProcessStatusChange(this.getContextToken(),L.a[a],this));break;case"runOnStageChange":this._dispatch(this._getEventManager().runOnStageChange(this.getContextToken(),this,s));break;case"runOnStageSelected":this._dispatch(this._getEventManager().runOnStageSelected(this.getContextToken(),this))}}executePreEvent(t,e,s=null,a=null){let n=!1;if(!Object(Ht.n)(this._getState(),this._currentPageId)&&this._getEventManager()){switch(t){case"runOnPreProcessStatusChange":n=this._dispatch(this._getEventManager().runOnPreProcessStatusChange(this.getContextToken(),L.a[a],this));break;case"runOnPreStageChange":n=this._dispatch(this._getEventManager().runOnPreStageChange(this.getContextToken(),this,s))}return this._logTraceInfoForProcessPreEvent(n,t,e,e),n}return this._logTraceFailureForProcessEvent(e,t,t),n}_saveFormDataAndActiveStage(t,e,s){const a=re.startStopwatch({processId:p.a.toString(this.getProcessId()),processInstanceId:p.a.toString(this.getProcessInstanceId())}),n=this.executePreEvent("runOnPreStageChange",s,e),i=Object(dt.c)(this._getState(),this.getCurrentFormEntity());if(!n){const a=new Promise((e,a)=>{if(!t)return a(new U("Attemping to save invalid stage id"));const n=["traversedpath","activestageid","activestagestartedon","completedon"],r=this.getNavigationEntities(),o=Object(f.b)(this._getState(),this._currentBpfInstance);for(const t of r)for(const e in o)if(e.includes(t.entityLogicalName)){n.push(e);break}let c,l;if(this._shouldPerformFormSave()){const e=this._getState();c=this._validateSnapshot(i).then(()=>this._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(s)).then(()=>(l=this._createActiveStageSnapshot(t),this._saveFormEntityAndBPFEntitySnapshots(l,i,!1))).then(()=>{const t=this.getCurrentFormEntity();this._dispatch(Object(ee.a)(this._currentPageId,e,this.getContextToken(),t.etn,t.id))}).catch(t=>{const e=Object(g.c)(t);return this._handleDuplicateDetection(e,l)})}else c=this._validateRequiredFieldsForNavigationOrStateChangeAndRejectOnFailures(s).then(()=>(l=this._createActiveStageSnapshot(t),this._dispatch(Object(ot.c)(l,!0,n,this._getRetrieveProcessControlDataRequest())).then(()=>{this._dispatch(Object(ct.a)(this._currentPageId,this.getCurrentFormEntity(),this._getColumnsToRefresh(),this._getRetrieveProcessControlDataRequest())),this._dispatch(Object(S.b)(!0,this._currentFormEntity))})));e(c)}).then(()=>{const t=this.getTraversedPath(),a=this.getActiveStageId();this._updateGlobalActiveStage(t,a),this.setSelectedStage(a),this._executePostEvent("runOnStageChange",s,e)},t=>{throw this._unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t),t});return a.then(r,r),a}function r(){a()}}_handleDuplicateDetection(t,e){if(Object(te.e)(t)){return this._dispatch(Object($t.a)(this._currentPageId,t,this._currentFormEntity)).then(t=>0===t.status?this._dispatch(Object(Qt.a)(t.pageId)).then(t=>t.value.param_lastButtonClicked===l.a?Promise.resolve("success"):Promise.resolve("aborted")):Promise.resolve("noop")).then(t=>{if("success"===t){const t=Object(dt.c)(this._getState(),this.getCurrentFormEntity());return this._saveFormEntityAndBPFEntitySnapshots(e,t,!0)}})}throw t}_saveFormEntityAndBPFEntitySnapshots(t,e,s){const a={};a[e.identifier.etn]=this._getColumnsToRefresh();let n=null;return n=this.isImmersiveBPF()?[e.snapshotId]:[e.snapshotId,t],this._dispatch(Object(ot.d)(n,s,a,this._getRetrieveProcessControlDataRequest()))}_logTraceInfoForProcessPreEvent(t,e,s,a){const n=this._applicationContext.TraceManager.getTracer(a),i=this.getTelemetryParams(),r={name:"BpfOperationName",value:s};i.push(r);const o={name:"eventName",value:e};i.push(o);const c={name:"preventDefaultInvokedByWebResource",value:t};i.push(c),n.info("BPF ProcessManager executed scripts registered to event "+e,i)}_logTraceFailureForProcessEvent(t,e,s){const a=this._applicationContext.TraceManager.getTracer(s),n=this.getTelemetryParams(),i={name:"BpfOperationName",value:t};n.push(i);n.push({name:"preventDefaultInvokedByWebResource",value:null});const r={name:"eventName",value:e};n.push(r);const o={name:"isPageDead",value:Object(Ht.n)(this._getState(),this._currentPageId)};n.push(o);const c={name:"currentPageId",value:this._currentPageId};n.push(c),a.error(`BPF ProcessManager not able to to execute scripts registered on event ${e} does not exist`,n)}_logTraceFailureForScriptContainer(){const t=this._applicationContext.TraceManager.getTracer("GET_SCRIPT_CONTAINER"),e=this.getTelemetryParams();e.push({name:"BpfOperationName",value:"GetScriptContainer"});const s={name:"IsPageDead",value:Object(Ht.n)(this._getState(),this._currentPageId)};e.push(s);e.push({name:"IsSciptContainerAvailable",value:!1}),t.error("BPF ProcessManager not able to to execute scripts as the script container does not exist",e)}_getStage(t){let e=null;if(t){const s=this.getEntityStages();s&&s.some(s=>{for(let a=0;a<s.get_Steps().get_Count();a++){const n=s.get_Steps().get_item(a);if(this._equalsIgnoreCase(t,n.get_Id()))return e=n,!0}})}return e}getContextToken(){return Object(ht.j)(this._getState(),this._currentPageId)}_updateProcessInstanceModifiedTime(){this._dispatch(Object(st.b)(this.getCurrentFormEntity()))}_isSelectedStageControl(t){if(!Object(St.a)(this.getSelectedStage())){const e=this.getSelectedStage().get_Steps();for(let s=0;s<e.get_Count();s++)if(this._equalsIgnoreCase(e.get_item(s).get_Id(),t))return!0}return!1}_equalsIgnoreCase(t,e){return!!t&&!!e&&t.toUpperCase()===e.toUpperCase()}_getSnapshotStateTelemetryParams(t){const e=[];if(Object(St.a)(t))return e;const s={name:"mode",value:t.mode},a={name:"identifierId",value:Object(St.a)(t.identifier)||Object(St.a)(t.identifier.id)?null:p.a.toString(t.identifier.id)},n=this._applicationContext.DataSource.get_MetadataCache().getEntityMetadata(t.identifier.etn),i={name:"identifierEntityId",value:Object(St.a)(n)?null:p.a.fromLegacyGuid(n.get_id()).guid},r={name:"identifierEntityObjectTypeCode",value:Object(St.a)(n)?null:n.get_objectTypeCode()},o={name:"activeChanges",value:Object(St.a)(n)?null:this._getIFieldValuesString(t.activeChanges,n.get_logicalName())},c={name:"lockedChanges",value:Object(St.a)(n)?null:this._getIFieldValuesString(t.lockedChanges,n.get_logicalName())};return e.push(s),e.push(i),e.push(r),e.push(a),e.push(o),e.push(c),e}_getTelemetryParamsForActionStep(t,e,s){const a=this.getTelemetryParams(),n={name:"ActionStepType",value:t},i={name:"ControlId",value:e},r={name:"ActionStepId",value:s};return a.push(n),a.push(i),a.push(r),a}getTelemetryParams(){const t=[];try{const e={name:"ProcessId",value:p.a.toString(this.getProcessId())},s={name:"ProcessInstanceId",value:p.a.toString(this.getProcessInstanceId())},a={name:"ActiveStageId",value:this.getActiveStageId()},n={name:"SelectedStageId",value:this.getSelectedStageId()},i={name:"TraversedPath",value:this.getTraversedPath()},o={name:"ActivePath",value:this._getActivePathString()},c={name:"CurrentFormEntityType",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().etn?this.getCurrentFormEntity().etn:""},l={name:"CurrentFormEntityId",value:this.getCurrentFormEntity()&&this.getCurrentFormEntity().id?p.a.toString(this.getCurrentFormEntity().id):""},u={name:"ProcessState",value:this.getProcessState()},h={name:"PageId",value:this._currentPageId},d={name:"PageType",value:Object(r.l)(this._getState(),this._currentPageId)},g={name:"SavedPageId",value:this._savedPageId},f={name:"SavedPageType",value:Object(r.l)(this._getState(),this._savedPageId)};if(Object(kt.c)(this._getState(),"FCB.EnableBPFNonDefaultCustomControls")){const e={name:"CustomControlsPresent",value:this.getCustomControlIndicator()},s={name:"RenderedFromFormXML",value:this.getFormXmlRenderingIndicator()};t.push(e),t.push(s)}const _={name:"IsImmersiveBPF",value:this.isImmersiveBPF()};t.push(e),t.push(s),t.push(a),t.push(i),t.push(o),t.push(n),t.push(c),t.push(l),t.push(u),t.push(h),t.push(d),t.push(g),t.push(f),t.push(_)}catch(e){this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.ProcessManagerTelemetryGeneration").error("Exception while generating Process Manager telemetry parameters: "+e.message,t)}return t}_getIFieldValuesString(t,e){let s="";if(!Object(St.a)(t))for(const a in t)if(Object(St.a)(a))s+=String.format("[fieldName: {0}]",null);else{const n=this._applicationContext.DataSource.get_MetadataCache().getAttributeMetadata(e,a),i=t[a];if(Object(St.a)(i)||Object(St.a)(n))s+=String.format("[attributeId is null: {0}, attributeMetadata is null: {1}]",Object(St.a)(i),Object(St.a)(n));else{let t="";Object(St.a)(i.timestamp)||(t=i.timestamp.toUTCString());let e="",a="",r=null,o=null;Object(St.a)(i.validationResult)||(e=i.validationResult.errorId,a=i.validationResult.errorMessage,r=i.validationResult.isOfflineSyncError,o=i.validationResult.isValueValid);const c=n.get_id();s+=String.format("[attributeId: {0}, timeStamp: {1}, validationResultErrorId: {2}, validationResultErrorMessage: {3}, validationResultIsOfflineSyncError: {4}, validationResultIsValueValid: {5}]",c,t,e,a,r,o)}}return s}_getActivePathString(){const t=this.getActivePath();let e="";if(t&&t.length>0){for(let s=0;s<t.length-1;s++)e=e+t[s].guid+",";e+=t[t.length-1].guid}return e}isImmersiveBPF(){return this.getCurrentFormEntity()&&this._currentBpfInstance&&this.getCurrentFormEntity().etn===this._currentBpfInstance.etn}_getColumnsToRefresh(){const t=Object(Kt.b)(this._getState(),this._currentPageId),e=Object(r.g)(this._getState(),this._currentPageId);if(Object(St.a)(e)){const t=Object(dt.c)(this._getState(),this.getCurrentFormEntity()),e=this._applicationContext.TraceManager.getTracer("BusinessProcessFlow.SaveAndRefresh"),s=this._getSnapshotStateTelemetryParams(t);return e.warn("Columns To Refresh is not set as PageInput is null. Primary entity not refreshed after save",s),[]}const s=Object(Dt.E)(this._getState(),e.entityTypeName),a=Object(l.g)(this._getState(),t,e,s,null);return a&&a.hasOwnProperty(e.entityTypeName)?a[e.entityTypeName]:[]}_getRetrieveProcessControlDataRequest(){const t=this.getProcessId()&&!p.a.equals(this.getProcessId(),p.a.EMPTY)?Z.a.toLegacyEntityReference(new Z.a("businessprocessflowinstance",this.getProcessId())):null,e=this.getProcessInstanceId()&&!p.a.equals(this.getProcessInstanceId(),p.a.EMPTY)?Z.a.toLegacyEntityReference(new Z.a("businessprocessflowinstance",this.getProcessInstanceId())):null;return this.getCurrentFormEntity()&&t&&e?new Ut.a(Z.a.toLegacyEntityReference(this.getCurrentFormEntity()),t,e):this.getCurrentFormEntity()?new Ut.a(Z.a.toLegacyEntityReference(this.getCurrentFormEntity()),null,null):null}getCustomControlIndicator(){return this._customControlsPresent}setCustomControlIndicator(t){this._customControlsPresent=t}getFormXmlRenderingIndicator(){return this._renderedFromFormXml}setFormXmlRenderingIndicator(t){this._renderedFromFormXml=t}getInstanceModifiedTimestamp(){return this._instanceModifiedTimestamp}isBpfFormDescriptorValid(t,e,s,a){return null===this._isBpfFormValid&&(this._isBpfFormValid=Object(Jt.f)(t,e,s,a)),this._isBpfFormValid}_unlockPrimaryEntityActiveChangesIfMainFormSaveFailure(t,e){let s=e;if(Object(St.a)(e)){const e=Object(g.c)(t);s=!Object(St.a)(e)&&e.FaultedSnapshotId}!Object(St.b)(s)&&this._dispatch(Object(rt.b)(s,!1));const a=Object(dt.c)(this._getState(),this.getCurrentFormEntity());a&&!Object(St.a)(a.snapshotId)&&a.snapshotId!==s&&this._dispatch(Object(rt.b)(a.snapshotId,!1))}}},ccIw:function(t,e,s){"use strict";s.d(e,"a",(function(){return O}));var a=s("WRDA"),n=s("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class i{get invocationSource(){return this._invocationSource}set invocationSource(t){this._invocationSource=t}get workflowStep(){return this._workflowStep}set workflowStep(t){this._workflowStep=t}get businessProcessFlowVisitor(){return this._businessProcessFlowVisitor}set businessProcessFlowVisitor(t){this._businessProcessFlowVisitor=t}get currentEntityName(){return this._currentEntityName}set currentEntityName(t){this._currentEntityName=t}get processManager(){return this._processManager}set processManager(t){this._processManager=t}getStageStep(t){if(Object(n.b)(t)||!this._businessProcessFlowVisitor)return null;const e=this._businessProcessFlowVisitor.get_stagesById()[Object(a.a)(t)];return e||null}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class r extends
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class{constructor(t){this.value=t,this._next=null}get value(){return this._value}set value(t){this._value=t}getNext(){return this._next}setNext(t){this._next=t}}{constructor(t){super(Object(a.a)(t))}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class o{constructor(){this._latestDefaultPathCalculated=!1,this._rootNodes=[],this._rootNodesValue=[],this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash()}find(t,e){if(t=Object(a.a)(t),e){for(const e in this._rootNodesValue)if(t===this._rootNodesValue[e])return this._rootNodes[e];return null}for(const e in this._rootNodes){let s=this._rootNodes[e];if(s.value===t)return s;for(;null!=s.getNext();)if(s=s.getNext(),s.value===t)return s}return null}getNode(t){return this._rootNodes[t]}setNode(t,e){this._latestDefaultPathCalculated=!1,this._rootNodes[t]=e,this._rootNodesValue[t]=e.value}getDefaultPath(){return this._ensureLatestDefaultPathIsCalculated(),this._defaultPathArray}addAfter(t,e){this.find(e.value,!0)?this._addAfterInternal(t,new r(null)):this._addAfterInternal(t,e)}getDefaultPathHash(){return this._ensureLatestDefaultPathIsCalculated(),this._lastDefaultPathCalculatedTimeHash}_ensureLatestDefaultPathIsCalculated(){this._latestDefaultPathCalculated||(this._defaultPathArray=this._recaculateDefaultPath(),this._latestDefaultPathCalculated=!0,this._lastDefaultPathCalculatedTimeHash=this._generateDefaultPathCalculatedTimeHash())}_recaculateDefaultPath(){this._defaultPathArray=[];for(let t=0;t<this._rootNodes.length;t++){let e=this._rootNodes[t];for(this._defaultPathArray[this._defaultPathArray.length]=e.value;e.getNext();){const t=e.getNext();t.value&&(this._defaultPathArray[this._defaultPathArray.length]=t.value),e=t}}return this._defaultPathArray}_addAfterInternal(t,e){t.setNext(e),this._latestDefaultPathCalculated=!1}_generateDefaultPathCalculatedTimeHash(){let t=Math.floor(1e4*Math.random());try{t=crypto.getRandomValues(new Uint32Array(1))[0]}catch(t){}return Date.now().toString()+t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class c{pathChanged(t){this._handler&&!Object(n.b)(t.parentStage)&&this._handler.handleChange(t.parentStage,t.nextStage)}getHandler(){return this._handler}setHandler(t){this._handler=t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class l{constructor(t,e){this._nextStage=e,this._parentStage=t}get parentStage(){return this._parentStage}get nextStage(){return this._nextStage}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class u{constructor(t,e,s){this._context=t,this._defaultPath=e,this._staticPath=s}calculate(){let t=this._startingNodeInDefaultPath();for(let e=0;e<this._staticPath.length;e++){const s=this._staticPath[e];if(!this._context.businessProcessFlowVisitor.get_stagesById().hasOwnProperty(s))continue;const a=this._defaultPath.find(s,!0);a?t=a:(this._defaultPath.addAfter(t,new r(s)),t=t.getNext())}this._lastEvaluatedNode=t}getLastEvaluatedNodeInDefaultPath(){return this._lastEvaluatedNode}getDefaultPath(){return this._defaultPath}_startingNodeInDefaultPath(){return this._startNode||(this._startNode=this._defaultPath.getNode(0)),this._startNode}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class h{constructor(t,e){this._defaultPath=e,this._context=t}calculate(){this._staticPathToDefaultPathCalculator.calculate(),this._defaultPath=this._staticPathToDefaultPathCalculator.getDefaultPath()}getLastDefaultNode(){return this._staticPathToDefaultPathCalculator.getLastEvaluatedNodeInDefaultPath()}get traversedPath(){return this._traversedPath||(this._traversedPath=[]),this._traversedPath}set traversedPath(t){this._traversedPath=t}getDefaultPath(){return this._defaultPath}get _staticPathToDefaultPathCalculator(){return this.__staticPathToDefaultPathCalculator||(this.__staticPathToDefaultPathCalculator=new u(this._context,this._defaultPath,this._traversedPath)),this.__staticPathToDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class d{constructor(t,e){this._context=t,this._defaultPath=e}calculate(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()&&this._calculateForTraveresedStages()}get traversedPath(){return this._traversedPath}set traversedPath(t){this._traversedPath=t}getLastCalculatedDefaultNode(){return this._traversedDefaultPathCalculator?this._traversedDefaultPathCalculator.getLastDefaultNode():null}getDefaultPath(){return this._defaultPath}_calculateForTraveresedStages(){this._traversedDefaultPathCalculator.traversedPath=this._traversedPath.split(","),this._traversedDefaultPathCalculator.calculate()}get _traversedDefaultPathCalculator(){return this.__traversedDefaultPathCalculator||(this.__traversedDefaultPathCalculator=new h(this._context,this._defaultPath)),this.__traversedDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class g{constructor(t){this.context=t}get stage(){return this._stageStep}set stage(t){this._stageStep=t}tryExecute(){const t=Object(a.a)(this.stage.get_stageId());return!!this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t]&&(this.executeCondition(),!0)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class p extends g{executeCondition(){const t="bpf_"+this._sanitizeGuidForFunctionName(this.stage.get_stageId());this.context.processManager.callPblToEvaluateBranching(t)}_sanitizeGuidForFunctionName(t){if(Object(n.b)(t))return t;for(t=Object(a.a)(t);t.indexOf("-")>-1;)t=t.replace("-","");return t}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class f extends g{executeCondition(){const t=Object(a.a)(this.stage.get_stageId()),e=this.context.businessProcessFlowVisitor.get_conditionsByParentStageId()[t];if(!e)return;const s=e.findElseBranch();let n=null;if(s&&s.get_Steps().get_Count()>0){n=s.get_Steps().get_item(0).get_stageId()}this._invokeReflowFunction(t,n)}_invokeReflowFunction(t,e){this.context.processManager.reflow(!1,t,e)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class _{getStageCommand(t,e){const s=t.businessProcessFlowVisitor.get_parentEntityStepByStageId()[Object(a.a)(e.get_stageId())];return t.currentEntityName!==s.get_EntityLogicalName()?new f(t):new p(t)}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class m{constructor(t,e,s){this._defaultPath=e,this._cascadeUpdate=s,this._context=t,this._businessRuleCommandFactory=new _}handleChange(t,e){const s=this._defaultPath.find(t,!1);if(null!=s){const t=Object(n.b)(e)?null:e,a=new r(t);this._defaultPath.addAfter(s,a),t&&this.triggerSubsequentDefaultPathCalculation(a)}}triggerSubsequentDefaultPathCalculation(t){if(!t)return;const e=t.value;if(e&&!this._tryExecuteConditionForStage(t)){const s=this._context.getStageStep(e).get_nextStageId();if(!s)return;const a=this._defaultPath.find(s,!0);if(a)return void(this._cascadeUpdate&&this.triggerSubsequentDefaultPathCalculation(a));this._defaultPath.addAfter(t,new r(s)),this.triggerSubsequentDefaultPathCalculation(t.getNext())}}_tryExecuteConditionForStage(t){const e=this._context.invocationSource;try{this._context.invocationSource="internal";const s=this._context.getStageStep(t.value),a=this._businessRuleCommandFactory.getStageCommand(this._context,s);if(a.stage=s,!a.tryExecute())return!1;if(t.getNext())return!0}finally{this._context.invocationSource=e}return!1}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class b{constructor(t,e,s){this._context=t,this._listener=e,this._defaultPath=s}calculate(){const t=this._pathChangeHandler;this._listener.setHandler(t),t.triggerSubsequentDefaultPathCalculation(this._startNode)}get startingNodeInDefaultPath(){return this._startNode}set startingNodeInDefaultPath(t){this._startNode=t}getDefaultPath(){return this._defaultPath}get _pathChangeHandler(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!0)),this.__pathChangeHandler}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class P{constructor(t,e,s){this._context=t,this._listener=e,this._initialDefaultPath=s}calculate(){this._context.businessProcessFlowVisitor.get_areConditionsPresent()||(this._defaultPath=this._initialDefaultPath),this._calculateForTraversedStages(),this._calculateForNonTraversedStages()}get startingNodeInDefaultPath(){return this._startingNodeInDefaultPath}set startingNodeInDefaultPath(t){this._startingNodeInDefaultPath=t}getDefaultPath(){return this._defaultPath}_calculateForTraversedStages(){this._defaultPath=this._initialDefaultPath}_calculateForNonTraversedStages(){this._nonTraversedDefaultPathCalculator.startingNodeInDefaultPath=this.startingNodeInDefaultPath,this._nonTraversedDefaultPathCalculator.calculate()}get _nonTraversedDefaultPathCalculator(){return this.__nonTraversedDefaultPathCalculator||(this.__nonTraversedDefaultPathCalculator=new b(this._context,this._listener,this._defaultPath)),this.__nonTraversedDefaultPathCalculator}}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class v{constructor(t,e,s){this._context=t,this._changeListener=e,this._defaultPath=s}calculate(){const t=this._pathChangeHandler;this._changeListener.setHandler(t)}getDefaultPath(){return this._defaultPath}get _pathChangeHandler(){return this.__pathChangeHandler||(this.__pathChangeHandler=new m(this._context,this._defaultPath,!1)),this.__pathChangeHandler}}var S=s("SAYH");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class y{constructor(t,e){this._context=e,this._traversedPathProvider=t,this._changeListener=new c,this._initializeDefaultPathFromRootStages()}initializeComplete(){const t=this.defaultPathHash();this._initializeTraversedPath(),this._initializeNonTraversedPath();const e=this._context.processManager.getSelectedStageId(),s=this._context.processManager.getActivePath(),a=!Object(n.a)(e)&&!Object(n.a)(s),i=a&&s.findIndex(t=>t.guid.toString()===e)<0,r=a&&this.getDefaultPath().indexOf(e)>=0;this.getDefaultPath()&&(t!==this.defaultPathHash()||i&&r)&&this._context.processManager.setActivePath(this.getDefaultPath())}updateDefaultPath(t,e){if(!t)return;let s=null;if("internal"!==this._context.invocationSource&&(s=this.defaultPathHash()),this._changeListener.pathChanged(new l(t,e)),"internal"!==this._context.invocationSource){if(s!==this.defaultPathHash()){const t=this.getDefaultPath();this._context.processManager.setActivePath(t)}}}triggerSubsequentDefaultPathCalculation(t){if(!(!!S.a.tryParseOrNull(t)&&!!this.getDefaultPath().find(e=>e.toLowerCase()===t.toLowerCase())))return;let e=null;if("internal"!==this._context.invocationSource&&(e=this.defaultPathHash()),this._changeListener.getHandler().triggerSubsequentDefaultPathCalculation(new r(t)),"internal"!==this._context.invocationSource){if(e!==this.defaultPathHash()){const t=this.getDefaultPath();this._context.processManager.setActivePath(t)}}}getDefaultPath(){return this._defaultPath.getDefaultPath()}defaultPathHash(){return this._defaultPath.getDefaultPathHash()}getNextStage(t){const e=this.getDefaultPath(),s=e.indexOf(Object(a.a)(t));return-1!==s&&s<e.length-1?e[s+1]:null}getPreviousStage(t){const e=this.getDefaultPath(),s=e.indexOf(Object(a.a)(t));return s<=0?null:e[s-1]}_initializeDefaultPathFromRootStages(){this._defaultPath=new o;const t=this._context.businessProcessFlowVisitor.get_firstLevelStages();let e=0;for(const s in t)this._defaultPath.setNode(e,new r(s)),e++}_initializeTraversedPath(){this._loadTimeDefaultPathCalculator.traversedPath=this._traversedPathProvider.getTraversedPath(),this._loadTimeDefaultPathCalculator.calculate(),this._defaultPath=this._loadTimeDefaultPathCalculator.getDefaultPath()}_initializeNonTraversedPath(){this._afterLoadPathCalculator.startingNodeInDefaultPath=this._loadTimeDefaultPathCalculator.getLastCalculatedDefaultNode(),this._afterLoadPathCalculator.calculate(),this._defaultPath=this._afterLoadPathCalculator.getDefaultPath(),this._runTimePathCalculator.calculate()}get _loadTimeDefaultPathCalculator(){return this._loadTimePathCalculator||(this._loadTimePathCalculator=new d(this._context,this._defaultPath)),this._loadTimePathCalculator}get _afterLoadPathCalculator(){return this.__afterLoadPathCalculator||(this.__afterLoadPathCalculator=new P(this._context,this._changeListener,this._defaultPath)),this.__afterLoadPathCalculator}get _runTimePathCalculator(){return this.__runTimePathCalculator||(this.__runTimePathCalculator=new v(this._context,this._changeListener,this._defaultPath)),this.__runTimePathCalculator}}var I=s("i1f0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */class O{setPrimaryModel(t){this._primaryModelName=t}getDefaultPathManager(){return this._defaultPathManager}setObjectModel(t){const e=new Microsoft.Crm.Workflow.ObjectModel.WorkflowStep("",0),s={};t.businessProcessFlowEntities.forEach(t=>{if(this._isRelationshipStep(t)){const s=this._createRelationshipCollectionStep(e,t);s&&e.appendStep(s)}else{const a=this._createEntity(e,t);a&&(e.appendStep(a),s.hasOwnProperty(a.get_EntityLogicalName())||(s[a.get_EntityLogicalName()]=!0))}}),e.set_Name(t.businessProcessFlowName),e.set_Id(t.businessProcessFlowId?t.businessProcessFlowId.guid:""),this._processObjectModel=e,this._initializeVisitor()}initializeDefaultPathManager(t,e){const s=new i;s.processManager=e,s.businessProcessFlowVisitor=this._businessProcessFlowVisitor,s.workflowStep=this._processObjectModel,s.currentEntityName=this._primaryModelName,this._defaultPathManager=new y(t,s),this._defaultPathManager.initializeComplete()}get businessProcessFlowVisitor(){return this._businessProcessFlowVisitor}getEntityStages(){if(!this._processObjectModel)return null;const t=this._processObjectModel.get_Steps(),e=[];if(t){for(let s=0;s<t.get_Count();s++){const a=t.get_item(s);a&&a instanceof Microsoft.Crm.Workflow.ObjectModel.EntityStep&&(e[e.length]=t.get_item(s))}return e}return null}getRequiredFlowStepsForStage(t,e,s,a){const n=[],i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");const r=i.get_Steps();if(!r)throw new Error(t+" does not include valid steps");for(let t=0;t<r.get_Count();t++)if(r.get_item(t)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){const e=r.get_item(t);this._isFlowStep(e)&&e.get_isProcessRequired()&&n.push(e.get_Id())}return n}getRequiredAttributesForStage(t,e,s,a){const n=[],i=this.getStage(t);if(!i)throw new Error(t+" is not a valid stage id.");const r=i.get_Steps();if(!r)throw new Error(t+" does not include valid steps");for(let t=0;t<r.get_Count();t++)if(r.get_item(t)instanceof Microsoft.Crm.Workflow.ObjectModel.StepStep){const i=r.get_item(t);if(!this._isActionStep(i)&&!this._isFlowStep(i))if(i.get_isProcessRequired())n.push(i.get_Description());else{const t=this._getDataFieldNameFromStepStep(i);t&&this._isRequiredAttribute(t,e,s,a)&&n.push(i.get_Description())}}return n}_getDataFieldNameFromStepStep(t){if(this._isActionStep(t)||this._isFlowStep(t))return null;if(this._isControlStep(t)){const e=t.get_Steps().get_item(0);return!e||e.get_isSystemControl()?null:e.get_dataFieldName()}return null}_isRequiredAttribute(t,e,s,a){if(null!=t){return 2===Object(I.pc)(a,e,s,t)}return!1}_isFlowStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.FlowStep)return!0}return!1}_isActionStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ActionStep)return!0}return!1}_isControlStep(t){if(t&&t.get_Steps()&&t.get_Steps().get_Count()>0){if(t.get_Steps().get_item(0)instanceof Microsoft.Crm.Workflow.ObjectModel.ControlStep)return!0}return!1}_initializeVisitor(){this._businessProcessFlowVisitor=new ProcessObjectModel.Visitors.BusinessProcessFlowVisitor,this._businessProcessFlowVisitor.visit(this._processObjectModel)}_isRelationshipStep(t){return!(!t||!t.hasOwnProperty("relationships"))}_createEntity(t,e){const s=new Microsoft.Crm.Workflow.ObjectModel.EntityStep(t,e.entityLogicalName);s.set_Name(e.entityLogicalName),s.set_Description(e.entityDisplayName),s.set_relationshipName(e.relationshipName),s.set_attributeName(e.referencingAttributeName),s.set_parent(t);const a=this._createStage(t,e.stage);s&&a&&s.appendStep(a);for(let s=0;s<e.stage.steps.length;s++){const n=this._createStep(t,e.stage.steps[s]);n&&a.appendStep(n)}const n=this._createConditionStep(t,a,e.stage);return n&&a.appendStep(n),s}_createRelationshipCollectionStep(t,e){const s=new Microsoft.Crm.Workflow.ObjectModel.RelationshipCollectionStep(t);if(s.set_workflow(t),e.relationships)for(let a=0;a<e.relationships.length;a++){const n=this._createRelationshipStep(t,e.relationships[a]);s.appendStep(n)}return s}_createRelationshipStep(t,e){const s=new Microsoft.Crm.Workflow.ObjectModel.RelationshipStep(t);return s.set_workflow(t),s.set_sourceStageId(e.sourceStageId.guid),s.set_targetStageId(e.targetStageId.guid),s.set_attributeName(e.attributeName),s.set_relationshipName(e.relationshipName),s}_createStage(t,e){const s=new Microsoft.Crm.Workflow.ObjectModel.StageStep(t,e.stageDisplayName||"dummy");return s.set_Id(e.stageId.guid),s.set_stageId(e.stageId.guid),s.set_nextStageId(e.nextStageId?e.nextStageId.guid:""),s.set_stageCategory(e.stageCategory),s}_createStep(t,e){const s="action"===e.stepType.toLowerCase()?e.label:e.name,a=new Microsoft.Crm.Workflow.ObjectModel.StepStep(t,s||"dummy");a.set_isProcessRequired(e.required),a.set_Name(e.label),a.set_Id(e.stepId?e.stepId.guid:""),a.set_workflow(t);const n=new Microsoft.Crm.Workflow.ObjectModel.ControlStep(t);if(n.set_dataFieldName(s),"action"===e.stepType.toLowerCase()){const e=new Microsoft.Crm.Workflow.ObjectModel.ActionStep(t);e.set_Name(s),e.set_actionControl(n),a.appendStep(e)}else if("modernflow"===e.stepType.toLowerCase()){const e=new Microsoft.Crm.Workflow.ObjectModel.FlowStep(t);e.set_Name(s),e.set_flowControl(n),a.appendStep(e)}else a.appendStep(n);return a}_createConditionStep(t,e,s){if(!s.conditionJson)return null;const a=new Microsoft.Crm.Workflow.ObjectModel.ConditionStep(t);return a.set_parent(e),a.initializeFromDynamic(JSON.parse(s.conditionJson)),a.fixLinks(),a}getProcessObjectModel(){return this._processObjectModel}getStage(t){return Object(n.a)(t)||!this._processObjectModel?null:this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(t)?this._businessProcessFlowVisitor.get_stagesById()[t]:null}getPreviousStageId(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){const e=this._defaultPathManager.getPreviousStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null}getNextStageId(t){if(this._defaultPathManager&&this._businessProcessFlowVisitor){const e=this._defaultPathManager.getNextStage(t);if(this._businessProcessFlowVisitor.get_stagesById().hasOwnProperty(e))return e}return null}}},dMZy:function(t,e,s){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function a(){return{tabId:"",navigationStack:[]}}s.d(e,"a",(function(){return a}))},lEp6:function(t,e,s){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
function a(t){let e=null;try{e=JSON.parse(t)}catch(t){}return e}
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t){let e="";try{e=JSON.stringify(t)}catch(t){}return e}s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}))},nexV:function(t,e,s){"use strict";s.d(e,"a",(function(){return n}));var a=s("Kvn0");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */function n(t,e){const s={displayState:t};return{type:a.c,payload:s}}},q5Ef:function(t,e,s){"use strict";
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
var a;s.r(e),s.d(e,"UCISyncMessageType",(function(){return _})),s.d(e,"PreviewSync",(function(){return v})),function(t){t[t.SyncMessageRequest=0]="SyncMessageRequest",t[t.SyncMessageResponse=1]="SyncMessageResponse",t[t.HandshakeRequest=2]="HandshakeRequest",t[t.HandshakeAck=3]="HandshakeAck"}(a||(a={}));class n{constructor(t,e,s,n,i){this._outboundMessageHandlers={},this._targetDomain=e,this._channelId=t,this._targetWindow=n,this._displayName=s,this._logger=i,this.Ready=new Promise((t,e)=>{this._onReady={resolve:t,reject:e}}),this._outboundMessageId=1,window.addEventListener("message",t=>{if(this._validateMessageOrigin(t)&&t.data&&void 0!==t.data.messageType&&t.data.messageType in a){const e=t.data;switch(this._logInfo(this._displayName,"received message of type"+e.messageType+", message id is"+e.messageId),e.messageType){case a.HandshakeRequest:if(e.messageData&&e.messageData.channelId===this._channelId){this._targetWindow=t.source;const s=this._createMessage({channelId:this._channelId},a.HandshakeAck);s.sourceId=e.messageId,this._logInfo(this._displayName,"Sending handshake ack"),this._send(s),this._onReady.resolve("")}break;case a.HandshakeAck:e.messageData&&e.messageData.channelId===this._channelId&&e.sourceId&&this._outboundMessageHandlers[e.sourceId]&&(this._outboundMessageHandlers[e.sourceId].resolve(e.messageData),this._onReady.resolve(""));break;case a.SyncMessageRequest:this._messageHandler.call({},e.messageData).then(t=>{const s=this._createMessage(t,a.SyncMessageResponse);s.sourceId=e.messageId,this._logInfo(this._displayName,"Sending response"+s.messageId),this._send(s)});break;case a.SyncMessageResponse:e.sourceId&&this._outboundMessageHandlers[e.sourceId]&&(this._logInfo(this._displayName,"Received response"+e.messageData),this._outboundMessageHandlers[e.sourceId].resolve(e.messageData),delete this._outboundMessageHandlers[e.sourceId]);break;default:throw this._logger.info.apply(void 0,["Channel:"+s+" => "+e]),"Unsupported message type"}}}),n&&this._handshake()}_logInfo(t,e){this._logger&&this._logger.info&&this._logger.info.apply(void 0,["Channel:"+t+" => "+e])}_logError(t,e){this._logger&&this._logger.error&&this._logger.error.apply(void 0,["Channel:"+t+" => "+e])}send(t){return this.Ready.then(()=>{const e=this._createMessage(t,a.SyncMessageRequest),s=new Promise((t,s)=>{this._outboundMessageHandlers[e.messageId]={resolve:t,reject:s}});return this._logInfo(this._displayName,"sending message Id "+e.messageId+"of type "+e.messageType),this._send(e),s})}onReceive(t){this._messageHandler=t}_validateMessageOrigin(t){return"*"===this._targetDomain||t.origin===this._targetDomain}_handshake(){const t={channelId:this._channelId},e=this._createMessage(t,a.HandshakeRequest),s=new Promise((t,s)=>{this._outboundMessageHandlers[e.messageId]={resolve:t,reject:s}});return this._send(e),s}_createMessage(t,e){return{messageId:this._outboundMessageId++,messageType:e,messageData:t}}_send(t){if(!this._targetWindow)throw this._logError(this._displayName,"The channel lost the target window"),"The channel lost the target window";this._targetWindow.postMessage(t,this._targetDomain)}}var i=s("g0tL"),r=s("i1f0"),o=s("K7RF"),c=s("ueZM"),l=s("Or4W"),u=s("SAYH"),h=s("dHD5"),d=s("59++"),g=s("pF61"),p=s("arV0");function f(t){return{type:"preview.metadata.update",execute({dispatch:e,getState:s},a,n){const f=a.TraceManager.getTracer(Object(r.S)(!1,"preview.metadata.update"));if(f.info("Updating form preview metadata"),t){const r=Object(i.g)([t],i.b.Form,s(),void 0,void 0,void 0,void 0);let _;if(r&&r.forms)for(const t in r.forms){_=t;break}f.info("serializeFormDescriptors done. ");const m=new u.a(_);let b="0";switch(t.FormType){case 2:b=Object(g.c)(s());break;case 9:b=Object(g.b)(s());break;default:b="0"}const P=Object(p.g)(s(),b).entityTypeName;return function(t,e,s,a,n,i,r){t.info("Loading custom control manifests for new added custom control.");const o=Object(l.b)(e,s,a,n,i,r);return Promise.all(o).then(()=>(t.info("Custom control manifests loading done for new added custom control."),Promise.resolve())).catch(e=>{const s="Loading manifests for new added custom control failed.";return t.error(s,e),Promise.reject(s)})}(f,s(),e,r.forms[t.FormId],P,a,n).then(()=>{var t;e((t=r,{type:o.a,payload:t})),e(Object(c.a)(m)).then(()=>{const t=Object(h.j)(s(),b);return e(Object(d.b)(m,b,t)).then(()=>{})})})}f.error("No descriptor to update")}}}var _,m=s("Wiik"),b=s("WZ96"),P=s("hBJV");!function(t){t[t.UCISyncMessage=0]="UCISyncMessage"}(_||(_={}));class v{constructor(t,e){this._store=t,this._tracer=e,this._domElementCache={},setInterval(()=>{this._domElementCache={}},18e5),this._debouncedSendDimensions=this._debounce(this.SendDimensions,this,100)}initializeChannel(t){if(this._tracer.info("PreviewSync: Initializing sync channel with id"+t),this._previewChannel&&this._channelId===t)return;const e={info:t=>{this._tracer.info.apply(this._tracer,[t])},error:t=>{this._tracer.error.apply(this._tracer,[t])}};return this._previewChannel=new n(t,"*","UCI_Sync",window.parent,e),this._previewChannel.onReceive(this.HandleRequest.bind(this)),this.RegisterMutationObserver(),this._previewChannel}HandleRequest(t){return new Promise((e,s)=>{if(t&&t.type===_.UCISyncMessage&&t.actionName)switch(this._tracer.info("PreviewSync: Received request with action name: "+t.actionName),t.actionName){case"GetDimensions":e(this.GetDimensions());break;case"ScrollUpdated":this._updateScrollPosition(t.actionData),e({actionName:t.actionName,actionData:{},success:!0,type:_.UCISyncMessage}),this._debouncedSendDimensions(),e(void 0);break;case"ElementClicked":this._handleElementClick(t.actionData),e({actionName:t.actionName,actionData:{},success:!0,type:_.UCISyncMessage});break;case"FormMetadataUpdated":this._store&&(t.actionData.consistencyStrong?(this._store.dispatch(Object(m.b)(!0)),this._store.dispatch(Object(P.a)()).then(()=>{this._store.dispatch(Object(m.b)(!0)),this._store.dispatch(f(t.actionData.formDescriptor)),e({actionName:t.actionName,actionData:{},success:!0,type:_.UCISyncMessage})})):(this._store.dispatch(f(t.actionData)),e({actionName:t.actionName,actionData:{},success:!0,type:_.UCISyncMessage})));break;default:this._tracer.error("PreviewSync: Received request with unsupported action "),e(void 0)}else e(void 0)})}GetDimensions(){this._tracer.info("PreviewSync: Getting Dimensions ");const t={},e=document.documentElement.scrollLeft,s=document.documentElement.scrollTop,a=document.querySelectorAll("[data-"+b.b);if(a&&a.length)for(let n=0;n<a.length;n++){const i=a[n];let r,o,c;if(i){const a=i.attributes.getNamedItem("data-"+b.c),n=i.attributes.getNamedItem("data-"+b.b),l=i.attributes.getNamedItem("role");if(n&&(r=n.value,o=a?parseInt(a.value,10):1,c=l?l.value:"none"),r){r=r.replace(b.a,"");const a=i.getBoundingClientRect(),n={top:a.top+s,left:a.left+e,height:a.bottom-a.top,width:a.right-a.left,scrollTop:0,scrollLeft:0,scrollHeight:0,scrollWidth:0,zIndex:o,role:c};if(i.scrollHeight>n.height||i.scrollWidth>n.width){const t=window.getComputedStyle(i),e=t.getPropertyValue("overflow-x"),s=t.getPropertyValue("overflow-y");"hidden"!==e&&(n.scrollLeft=i.scrollLeft,n.scrollWidth=i.scrollWidth),"hidden"!==s&&(n.scrollTop=i.scrollTop,n.scrollHeight=i.scrollHeight)}const l=r.indexOf(b.d);if(l>0){const e=r.substring(0,l-1);t[e]||(t[e]={});const s={id:r,dimensions:n};t[e].subIds?t[e].subIds.push(s):t[e].subIds=[s]}else t[r]||(t[r]={}),t[r].dimensions=n}}}return{actionName:"DimensionsUpdated",actionData:t,type:_.UCISyncMessage}}RegisterMutationObserver(){this._previewChannel.Ready.then(()=>{const t=document;new MutationObserver(this._debouncedSendDimensions).observe(t,{attributes:!0,childList:!0,subtree:!0})})}SendDimensions(){this._previewChannel.send(this.GetDimensions())}_updateScrollPosition(t){const e=v._isNumber(t.scrollLeft),s=v._isNumber(t.scrollTop);if(t&&t.id&&(e||s)){const a=this._findDOMElement(t.id);a&&(e&&(a.scrollLeft=t.scrollLeft),s&&(a.scrollTop=t.scrollTop))}}static _isNumber(t){return!isNaN(parseFloat(t))}_handleElementClick(t){const e=this._findDOMElement(t.id);e&&e.click()}_findDOMElement(t){const e=this._domElementCache[t];if(e&&e.clientWidth)return e;const s=`${b.a}${t}`,a=document.querySelector(`#${s}, [data-${b.b}=${s}]`);return this._domElementCache[t]=a,a}_debounce(t,e,s){let a;return function(){const n=e,i=arguments,r=function(){a=null,t.apply(n,i)};clearTimeout(a),a=setTimeout(r,s)}}}},sxfa:function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));var a=s("WRDA"),n=s("504W");
/**
 * @license Copyright (c) Microsoft Corporation. All rights reserved.
 */
class i{constructor(t){this.path=t}get path(){return this._traversedPath}set path(t){for(this._traversedPath=Object(a.a)(t);this._traversedPath&&this._traversedPath.indexOf("}")>0;)this._traversedPath=Object(a.a)(this._traversedPath)}static getCandidateTraversedPathFromStagStep(t,e){e=Object(a.a)(e);let s=!1;if(!t||t.length)return null;for(let n=0;n<t.length;n++){const i=Object(a.a)(t[n].get_stageId());if("".concat(i,","),e===i){s=!0;break}}return s?"".substring(0,"".length-2):null}isInTraversedPath(t){return!Object(n.b)(t)&&this._traversedPath.indexOf(Object(a.a)(t))>-1}}}}]),window.bundleExecutionMarkers["scripts/previewsync.js?v=1.4.9962-v91onpremise"].end=window.performance.now(),window.reportBundleExecutionTimes&&window.reportBundleExecutionTimes();