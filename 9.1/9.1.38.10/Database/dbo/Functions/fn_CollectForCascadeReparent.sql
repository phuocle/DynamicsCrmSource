CREATE function [dbo].[fn_CollectForCascadeReparent]
(
  @root_id uniqueidentifier,
  @root_otc int,
  @isoffline int,
  @old_owner uniqueidentifier,
  @old_owner_type int
) 
returns @t table
( 	
	o uniqueidentifier		not null,				-- entity's object id
	t int					not null,				-- entity's object type code
	u uniqueidentifier,								-- ownerid ( NULLable)
	v int,											-- ownerid type ( NULLable)
	q uniqueidentifier,								-- parentobjectid ( NULLable)
	s int					not null,				-- parentobject type code
	l int					not null,				-- keeps track of level on which each record is collected for forcing ordering by the topological order

index ndx_t_o clustered(t, o)						-- t followed by o; since many queries in the MS-TVF filters on t with hardcoded value
)
as
begin
insert into @t values(@root_id,@root_otc,@old_owner, @old_owner_type, N'00000000-0000-0000-0000-000000000000', 0, 0)

if (exists(select * from @t where t=10042))begin insert into @t(o,t,u,v,q,s,l) select o.conversationtranscriptId,10041,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from conversationtranscript o,@t c where o.bot_conversationtranscriptId=c.o and c.t=10042 end
if (exists(select * from @t where t=4720))begin insert into @t(o,t,u,v,q,s,l) select o.workflowbinaryId,10036,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from workflowbinary o,@t c where o.FlowSessionId=c.o and c.t=4720 end
if (exists(select * from @t where t=4724))begin insert into @t(o,t,u,v,q,s,l) select o.processstageparameterId,10035,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from processstageparameter o,@t c where o.ProcessStageId=c.o and c.t=4724 end
if (exists(select * from @t where t=9100))begin insert into @t(o,t,u,v,q,s,l) select o.ReportId,9100,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Report o,@t c where o.ParentReportId=c.o and c.t=9100
while (@@rowcount <> 0)if (exists(select * from @t where t=9100))insert into @t(o,t,u,v,q,s,l) select o.ReportId,9100,o.OwnerId,o.OwnerIdType,c.o,c.t,c.l +1 from Report o,@t c where o.ParentReportId=c.o and c.t=9100 and o.ReportId not in(select o from @t where o=o.ReportId and t=9100) end
if (exists(select * from @t where t=300))begin insert into @t(o,t,u,v,q,s,l) select o.CanvasAppExtendedMetadataId,10034,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CanvasAppExtendedMetadata o,@t c where o.CanvasAppId=c.o and c.t=300 end
if (exists(select * from @t where t=9811))begin insert into @t(o,t,u,v,q,s,l) select o.solutioncomponentrelationshipconfigurationId,10012,NULL,NULL, c.o, c.t, c.l +1 from solutioncomponentrelationshipconfiguration o,@t c where o.EntityRelationshipId=c.o and c.t=9811 end
if (exists(select * from @t where t=1144))begin insert into @t(o,t,u,v,q,s,l) select o.RatingValueId,1142,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from RatingValue o,@t c where o.RatingModel=c.o and c.t=1144 end
if (exists(select * from @t where t=380))begin insert into @t(o,t,u,v,q,s,l) select o.EnvironmentVariableValueId,381,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from EnvironmentVariableValue o,@t c where o.EnvironmentVariableDefinitionId=c.o and c.t=380 end
if (exists(select * from @t where t=9800))begin insert into @t(o,t,u,v,q,s,l) select o.EntityAnalyticsConfigId,430,NULL,NULL, c.o, c.t, c.l +1 from EntityAnalyticsConfig o,@t c where o.ParentEntityId=c.o and c.t=9800 end
if (exists(select * from @t where t=9800))begin insert into @t(o,t,u,v,q,s,l) select o.solutioncomponentconfigurationId,10011,NULL,NULL, c.o, c.t, c.l +1 from solutioncomponentconfiguration o,@t c where o.EntityId=c.o and c.t=9800 end
if (exists(select * from @t where t=10006))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_PostRuleConfigId,10007,NULL,NULL, c.o, c.t, c.l +1 from msdyn_PostRuleConfig o,@t c where o.msdyn_PostConfigId=c.o and c.t=10006 end
if (exists(select * from @t where t=10006))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_wallsavedqueryId,10008,NULL,NULL, c.o, c.t, c.l +1 from msdyn_wallsavedquery o,@t c where o.msdyn_postconfigurationid=c.o and c.t=10006 end
if (exists(select * from @t where t=10008))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_wallsavedqueryusersettingsId,10009,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_wallsavedqueryusersettings o,@t c where o.msdyn_wallsavedqueryid=c.o and c.t=10008 end
if (exists(select * from @t where t=10077))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_upgradeversionId,10079,NULL,NULL, c.o, c.t, c.l +1 from msdyn_upgradeversion o,@t c where o.msdyn_UpgradeRun=c.o and c.t=10077 end
if (exists(select * from @t where t=10079))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_upgradestepId,10078,NULL,NULL, c.o, c.t, c.l +1 from msdyn_upgradestep o,@t c where o.msdyn_UpgradeVersion=c.o and c.t=10079 end
if (exists(select * from @t where t=9011))begin insert into @t(o,t,u,v,q,s,l) select o.AppConfigInstanceId,9013,NULL,NULL, c.o, c.t, c.l +1 from AppConfigInstance o,@t c where o.AppConfigMasterId=c.o and c.t=9011 end
if (exists(select * from @t where t=9012))begin insert into @t(o,t,u,v,q,s,l) select o.AppConfigInstanceId,9013,NULL,NULL, c.o, c.t, c.l +1 from AppConfigInstance o,@t c where o.AppConfigId=c.o and c.t=9012 end
if (exists(select * from @t where t=9012))begin insert into @t(o,t,u,v,q,s,l) select o.NavigationSettingId,9900,NULL,NULL, c.o, c.t, c.l +1 from NavigationSetting o,@t c where o.AppConfigId=c.o and c.t=9012 end
if (exists(select * from @t where t=9808))begin insert into @t(o,t,u,v,q,s,l) select o.solutioncomponentattributeconfigurationId,10010,NULL,NULL, c.o, c.t, c.l +1 from solutioncomponentattributeconfiguration o,@t c where o.AttributeId=c.o and c.t=9808 end
if (exists(select * from @t where t=10023))begin insert into @t(o,t,u,v,q,s,l) select o.datalakeworkspacepermissionId,10024,NULL,NULL, c.o, c.t, c.l +1 from datalakeworkspacepermission o,@t c where o.workspaceid=c.o and c.t=10023 end
if (exists(select * from @t where t=10065))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIBDatasetId,10062,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIBDataset o,@t c where o.msdyn_AIBDatasetsContainerId=c.o and c.t=10065 end
if (exists(select * from @t where t=10062))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIBDatasetRecordId,10064,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIBDatasetRecord o,@t c where o.msdyn_AIBDatasetsId=c.o and c.t=10062 end
if (exists(select * from @t where t=10065))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIBFileId,10066,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIBFile o,@t c where o.msdyn_AIBDatasetsContainerId=c.o and c.t=10065 end
if (exists(select * from @t where t=10056))begin insert into @t(o,t,u,v,q,s,l) select o.CatalogId,10056,NULL,NULL, c.o, c.t, c.l +1 from Catalog o,@t c where o.ParentCatalogId=c.o and c.t=10056
while (@@rowcount <> 0)if (exists(select * from @t where t=10056))insert into @t(o,t,u,v,q,s,l) select o.CatalogId,10056,NULL,NULL,c.o,c.t,c.l +1 from Catalog o,@t c where o.ParentCatalogId=c.o and c.t=10056 and o.CatalogId not in(select o from @t where o=o.CatalogId and t=10056) end
if (exists(select * from @t where t=10062))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIBDatasetFileId,10063,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIBDatasetFile o,@t c where o.msdyn_AIBDatasetId=c.o and c.t=10062 end
if (exists(select * from @t where t=10063))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIBFileAttachedDataId,10067,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIBFileAttachedData o,@t c where o.msdyn_AIBDatasetFileId=c.o and c.t=10063 end
if (exists(select * from @t where t in(8,2020)))begin insert into @t(o,t,u,v,q,s,l) select o.MailboxId,9606,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Mailbox o,@t c where o.RegardingObjectId=c.o and c.t in(8,2020) end
if (exists(select * from @t where t in(9605,9606)))begin insert into @t(o,t,u,v,q,s,l) select o.TraceRegardingId,8052,NULL,NULL, c.o, c.t, c.l +1 from TraceRegarding o,@t c where o.RegardingObjectId=c.o and c.t in(9605,9606) end
if (exists(select * from @t where t=10021))begin insert into @t(o,t,u,v,q,s,l) select o.datalakefolderpermissionId,10022,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from datalakefolderpermission o,@t c where o.folderid=c.o and c.t=10021 end
if (exists(select * from @t where t=10043))begin insert into @t(o,t,u,v,q,s,l) select o.botcomponentId,10043,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from botcomponent o,@t c where o.ParentBotComponentId=c.o and c.t=10043
while (@@rowcount <> 0)if (exists(select * from @t where t=10043))insert into @t(o,t,u,v,q,s,l) select o.botcomponentId,10043,o.OwnerId,o.OwnerIdType,c.o,c.t,c.l +1 from botcomponent o,@t c where o.ParentBotComponentId=c.o and c.t=10043 and o.botcomponentId not in(select o from @t where o=o.botcomponentId and t=10043) end
if (exists(select * from @t where t=1150))begin insert into @t(o,t,u,v,q,s,l) select o.BookableResourceCategoryAssnId,1149,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from BookableResourceCategoryAssn o,@t c where o.Resource=c.o and c.t=1150 end
if (exists(select * from @t where t=1150))begin insert into @t(o,t,u,v,q,s,l) select o.BookableResourceCharacteristicId,1148,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from BookableResourceCharacteristic o,@t c where o.Resource=c.o and c.t=1150 end
if (exists(select * from @t where t=7101))begin insert into @t(o,t,u,v,q,s,l) select o.AppModuleId,9006,NULL,NULL, c.o, c.t, c.l +1 from AppModule o,@t c where o.PublisherId=c.o and c.t=7101 end
if (exists(select * from @t where t=9006))begin insert into @t(o,t,u,v,q,s,l) select o.AppElementId,10029,NULL,NULL, c.o, c.t, c.l +1 from AppElement o,@t c where o.ParentAppModuleId=c.o and c.t=9006 end
if (exists(select * from @t where t=9006))begin insert into @t(o,t,u,v,q,s,l) select o.AppSettingId,10032,NULL,NULL, c.o, c.t, c.l +1 from AppSetting o,@t c where o.ParentAppModuleId=c.o and c.t=9006 end
if (exists(select * from @t where t=9006))begin insert into @t(o,t,u,v,q,s,l) select o.AppModuleComponentId,9007,NULL,NULL, c.o, c.t, c.l +1 from AppModuleComponent o,@t c where o.AppModuleIdUnique=c.o and c.t=9006 end
if (exists(select * from @t where t in(955,950,4700,4710,954,951,952,953)))begin insert into @t(o,t,u,v,q,s,l) select o.WorkflowLogId,4706,NULL,NULL, c.o, c.t, c.l +1 from WorkflowLog o,@t c where o.AsyncOperationId=c.o and c.t in(955,950,4700,4710,954,951,952,953) end
if (exists(select * from @t where t=401))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_AIConfigurationId,402,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_AIConfiguration o,@t c where o.msdyn_AIModelId=c.o and c.t=401 end
if (exists(select * from @t where t=1))begin insert into @t(o,t,u,v,q,s,l) select o.AccountId,1,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Account o,@t c where o.ParentAccountId=c.o and c.t=1
while (@@rowcount <> 0)if (exists(select * from @t where t=1))insert into @t(o,t,u,v,q,s,l) select o.AccountId,1,o.OwnerId,o.OwnerIdType,c.o,c.t,c.l +1 from Account o,@t c where o.ParentAccountId=c.o and c.t=1 and o.AccountId not in(select o from @t where o=o.AccountId and t=1) end
if (exists(select * from @t where t=9813))begin insert into @t(o,t,u,v,q,s,l) select o.RelationshipAttributeId,9814,NULL,NULL, c.o, c.t, c.l +1 from RelationshipAttribute o,@t c where o.RelationshipId=c.o and c.t=9813 end
if (exists(select * from @t where t=9808))begin insert into @t(o,t,u,v,q,s,l) select o.RelationshipAttributeId,9814,NULL,NULL, c.o, c.t, c.l +1 from RelationshipAttribute o,@t c where o.ReferencedAttributeId=c.o and c.t=9808 end
if (exists(select * from @t where t=9808))begin insert into @t(o,t,u,v,q,s,l) select o.RelationshipAttributeId,9814,NULL,NULL, c.o, c.t, c.l +1 from RelationshipAttribute o,@t c where o.ReferencingAttributeId=c.o and c.t=9808 end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.ContactId,2,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Contact o,@t c where o.ParentCustomerId=c.o and c.t in(2,1)
while (@@rowcount <> 0)if (exists(select * from @t where t=2))insert into @t(o,t,u,v,q,s,l) select o.ContactId,2,o.OwnerId,o.OwnerIdType,c.o,c.t,c.l +1 from Contact o,@t c where o.ParentCustomerId=c.o and c.t=2 and o.ContactId not in(select o from @t where o=o.ContactId and t=2) end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.SocialProfileId,99,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SocialProfile o,@t c where o.CustomerId=c.o and c.t in(2,1) end
if (exists(select * from @t where t in(1,2)))begin insert into @t(o,t,u,v,q,s,l) select o.IncidentId,112,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Incident o,@t c where o.CustomerId=c.o and c.t in(1,2) end
if (exists(select * from @t where t in(1,2)))begin insert into @t(o,t,u,v,q,s,l) select o.ContractId,1010,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Contract o,@t c where o.CustomerId=c.o and c.t in(1,2) end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.SalesOrderId,1088,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SalesOrder o,@t c where o.CustomerId=c.o and c.t in(2,1) end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.OpportunityId,3,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Opportunity o,@t c where o.CustomerId=c.o and c.t in(2,1) end
if (exists(select * from @t where t=3))begin insert into @t(o,t,u,v,q,s,l) select o.CustomerOpportunityRoleId,4503,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CustomerOpportunityRole o,@t c where o.OpportunityId=c.o and c.t=3 end
if (exists(select * from @t where t=10059))begin insert into @t(o,t,u,v,q,s,l) select o.CustomAPIResponsePropertyId,10061,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CustomAPIResponseProperty o,@t c where o.CustomAPIId=c.o and c.t=10059 end
if (exists(select * from @t where t=10059))begin insert into @t(o,t,u,v,q,s,l) select o.CustomAPIRequestParameterId,10060,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CustomAPIRequestParameter o,@t c where o.CustomAPIId=c.o and c.t=10059 end
if (exists(select * from @t where t=7101))begin insert into @t(o,t,u,v,q,s,l) select o.SolutionId,7100,NULL,NULL, c.o, c.t, c.l +1 from Solution o,@t c where o.PublisherId=c.o and c.t=7101 end
if (exists(select * from @t where t=7100))begin insert into @t(o,t,u,v,q,s,l) select o.SolutionId,7100,NULL,NULL, c.o, c.t, c.l +1 from Solution o,@t c where o.ParentSolutionId=c.o and c.t=7100
while (@@rowcount <> 0)if (exists(select * from @t where t=7100))insert into @t(o,t,u,v,q,s,l) select o.SolutionId,7100,NULL,NULL,c.o,c.t,c.l +1 from Solution o,@t c where o.ParentSolutionId=c.o and c.t=7100 and o.SolutionId not in(select o from @t where o=o.SolutionId and t=7100) end
if (exists(select * from @t where t=7100))begin insert into @t(o,t,u,v,q,s,l) select o.SolutionComponentId,7103,NULL,NULL, c.o, c.t, c.l +1 from SolutionComponent o,@t c where o.SolutionId=c.o and c.t=7100 end
if (exists(select * from @t where t=7103))begin insert into @t(o,t,u,v,q,s,l) select o.SolutionComponentId,7103,NULL,NULL, c.o, c.t, c.l +1 from SolutionComponent o,@t c where o.RootSolutionComponentId=c.o and c.t=7103
while (@@rowcount <> 0)if (exists(select * from @t where t=7103))insert into @t(o,t,u,v,q,s,l) select o.SolutionComponentId,7103,NULL,NULL,c.o,c.t,c.l +1 from SolutionComponent o,@t c where o.RootSolutionComponentId=c.o and c.t=7103 and o.SolutionComponentId not in(select o from @t where o=o.SolutionComponentId and t=7103) end
if (exists(select * from @t where t=7100))begin insert into @t(o,t,u,v,q,s,l) select o.DependencyNodeId,7106,NULL,NULL, c.o, c.t, c.l +1 from DependencyNode o,@t c where o.TopSolutionId=c.o and c.t=7100 end
if (exists(select * from @t where t=7100))begin insert into @t(o,t,u,v,q,s,l) select o.DependencyNodeId,7106,NULL,NULL, c.o, c.t, c.l +1 from DependencyNode o,@t c where o.BaseSolutionId=c.o and c.t=7100 end
if (exists(select * from @t where t=7106))begin insert into @t(o,t,u,v,q,s,l) select o.DependencyId,7105,NULL,NULL, c.o, c.t, c.l +1 from Dependency o,@t c where o.RequiredComponentNodeId=c.o and c.t=7106 end
if (exists(select * from @t where t=7106))begin insert into @t(o,t,u,v,q,s,l) select o.DependencyId,7105,NULL,NULL, c.o, c.t, c.l +1 from Dependency o,@t c where o.DependentComponentNodeId=c.o and c.t=7106 end
if (exists(select * from @t where t in(9953,3)))begin insert into @t(o,t,u,v,q,s,l) select o.TeamId,9,NULL,NULL, c.o, c.t, c.l +1 from Team o,@t c where o.RegardingObjectId=c.o and c.t in(9953,3) end
if (exists(select * from @t where t=92))begin insert into @t(o,t,u,v,q,s,l) select o.TeamId,9,NULL,NULL, c.o, c.t, c.l +1 from Team o,@t c where o.TeamTemplateId=c.o and c.t=92 end
if (exists(select * from @t where t in(1,2)))begin insert into @t(o,t,u,v,q,s,l) select o.InvoiceId,1090,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Invoice o,@t c where o.CustomerId=c.o and c.t in(1,2) end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.QuoteId,1084,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Quote o,@t c where o.CustomerId=c.o and c.t in(2,1) end
if (exists(select * from @t where t in(2,1)))begin insert into @t(o,t,u,v,q,s,l) select o.LeadId,4,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Lead o,@t c where o.CustomerId=c.o and c.t in(2,1) end
if (exists(select * from @t where t in(1090,1084,1088,1,4,2,3)))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_playbookinstanceId,10089,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_playbookinstance o,@t c where o.Regarding=c.o and c.t in(1090,1084,1088,1,4,2,3) end
if (exists(select * from @t where t=1146))begin insert into @t(o,t,u,v,q,s,l) select o.BookableResourceBookingId,1145,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from BookableResourceBooking o,@t c where o.Header=c.o and c.t=1146 end
if (exists(select * from @t where t in(1146,9953,9986,2,1145,4,1)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4406,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from BulkOperation o,@t c where o.RegardingObjectId=c.o and c.t in(1146,9953,9986,2,1145,4,1) end
if (exists(select * from @t where t=10090))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_playbookactivityId,10086,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_playbookactivity o,@t c where o.msdyn_playbooktemplateid=c.o and c.t=10090 end
if (exists(select * from @t where t=10086))begin insert into @t(o,t,u,v,q,s,l) select o.msdyn_playbookactivityattributeId,10087,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from msdyn_playbookactivityattribute o,@t c where o.msdyn_playbookactivityid=c.o and c.t=10086 end
if (exists(select * from @t where t in(9953,10086,10055,2)))begin insert into @t(o,t,u,v,q,s,l) select o.SharePointDocumentId,9507,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SharePointDocument o,@t c where o.RegardingObjectId=c.o and c.t in(9953,10086,10055,2) end
if (exists(select * from @t where t in(10086,2,10055,9953)))begin insert into @t(o,t,u,v,q,s,l) select o.SharePointDocumentLocationId,9508,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SharePointDocumentLocation o,@t c where o.RegardingObjectId=c.o and c.t in(10086,2,10055,9953) end
if (exists(select * from @t where t in(4400,1145,1146)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4402,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CampaignActivity o,@t c where o.RegardingObjectId=c.o and c.t in(4400,1145,1146) end
if (exists(select * from @t where t in(112,9700,4400,1145,9986,1,4406,3,1146,4402,4,9953)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4209,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from OrderClose o,@t c where o.RegardingObjectId=c.o and c.t in(112,9700,4400,1145,9986,1,4406,3,1146,4402,4,9953) end
if (exists(select * from @t where t=1088))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4209,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from OrderClose o,@t c where o.SalesOrderId=c.o and c.t=1088 end
if (exists(select * from @t where t in(9986,4,1146,9953,4406,3,4400,1,112,9700,4402,1145)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4208,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from OpportunityClose o,@t c where o.RegardingObjectId=c.o and c.t in(9986,4,1146,9953,4406,3,4400,1,112,9700,4402,1145) end
if (exists(select * from @t where t=3))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4208,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from OpportunityClose o,@t c where o.OpportunityId=c.o and c.t=3 end
if (exists(select * from @t where t in(9953,2,1145,9986,4,4406,1146,4400,4402,1)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4401,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from CampaignResponse o,@t c where o.RegardingObjectId=c.o and c.t in(9953,2,1145,9986,4,4406,1146,4400,4402,1) end
if (exists(select * from @t where t in(1010,4400,9702,1145,1090,4406,2,3,10089,10005,112,4402,1146,1084,9953,4,1088,1,9700)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4207,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Letter o,@t c where o.RegardingObjectId=c.o and c.t in(1010,4400,9702,1145,1090,4406,2,3,10089,10005,112,4402,1146,1084,9953,4,1088,1,9700) end
if (exists(select * from @t where t in(9986,10005,4400,9702,112,10089,9953,4406,1145,1,4402,4,1084,3,1088,1010,1146,9700,1090,2)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4214,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from ServiceAppointment o,@t c where o.RegardingObjectId=c.o and c.t in(9986,10005,4400,9702,112,10089,9953,4406,1145,1,4402,4,1084,3,1088,1010,1146,9700,1090,2) end
if (exists(select * from @t where t in(1084,1,1088,10089,9953,9700,3,10005,4700,4,1010,4400,4402,112,4406,1146,2,9702,1090,1145)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4202,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Email o,@t c where o.RegardingObjectId=c.o and c.t in(1084,1,1088,10089,9953,9700,3,10005,4700,4,1010,4400,4402,112,4406,1146,2,9702,1090,1145) end
if (exists(select * from @t where t in(9702,1146,9700,4400,1145,112,1088,4402,1010,1084,4406,2,10005,9953,1,10089,1090,3,4)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4251,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from RecurringAppointmentMaster o,@t c where o.RegardingObjectId=c.o and c.t in(9702,1146,9700,4400,1145,112,1088,4402,1010,1084,4406,2,10005,9953,1,10089,1090,3,4) end
if (exists(select * from @t where t in(1146,9702,2,1084,1,1088,1010,1145,1090,4,4402,10089,9700,3,112,10005,9953,4406,4400)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4210,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from PhoneCall o,@t c where o.RegardingObjectId=c.o and c.t in(1146,9702,2,1084,1,1088,1010,1145,1090,4,4402,10089,9700,3,112,10005,9953,4406,4400) end
if (exists(select * from @t where t in(9700,4400,1,1090,9953,1084,3,4402,1010,1088,4406,9702,10005,10089,1145,112,4,2,1146)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4204,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Fax o,@t c where o.RegardingObjectId=c.o and c.t in(9700,4400,1,1090,9953,1084,3,4402,1010,1088,4406,9702,10005,10089,1145,112,4,2,1146) end
if (exists(select * from @t where t in(10005,4400,9700,1145,112,9953,1088,4402,3,1084,1,10089,4406,4,1010,1090,1146,2,9702)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4201,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Appointment o,@t c where o.RegardingObjectId=c.o and c.t in(10005,4400,9700,1145,112,9953,1088,4402,3,1084,1,10089,4406,4,1010,1090,1146,2,9702) end
if (exists(select * from @t where t in(1145,1,4402,4,4406,1146,9700,4400,9986,9953)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4206,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from IncidentResolution o,@t c where o.RegardingObjectId=c.o and c.t in(1145,1,4402,4,4406,1146,9700,4400,9986,9953) end
if (exists(select * from @t where t=112))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4206,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from IncidentResolution o,@t c where o.IncidentId=c.o and c.t=112 end
if (exists(select * from @t where t in(1010,2,3,10005,1088,112,9700,4402,4400,4406,10089,1146,1,9953,1090,1084,4,1145,9702)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4212,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Task o,@t c where o.RegardingObjectId=c.o and c.t in(1010,2,3,10005,1088,112,9700,4402,4400,4406,10089,1146,1,9953,1090,1084,4,1145,9702) end
if (exists(select * from @t where t in(4400,1,112,1084,4406,1145,3,9986,4,4402,9953,9700,1146)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4211,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from QuoteClose o,@t c where o.RegardingObjectId=c.o and c.t in(4400,1,112,1084,4406,1145,3,9986,4,4402,9953,9700,1146) end
if (exists(select * from @t where t=1084))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4211,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from QuoteClose o,@t c where o.QuoteId=c.o and c.t=1084 end
if (exists(select * from @t where t in(4402,1010,1090,1145,1146,9702,2,4700,4,3,1084,9700,4406,1,4400,112,1088)))begin insert into @t(o,t,u,v,q,s,l) select o.MailboxTrackingFolderId,9608,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from MailboxTrackingFolder o,@t c where o.RegardingObjectId=c.o and c.t in(4402,1010,1090,1145,1146,9702,2,4700,4,3,1084,9700,4406,1,4400,112,1088) end
if (exists(select * from @t where t in(4,1084,1145,3,4402,1090,10089,1146,112,1088,9700,9953,1010,4400,9702,4700,2,10005,1,4406)))begin insert into @t(o,t,u,v,q,s,l) select o.ActivityId,4216,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SocialActivity o,@t c where o.RegardingObjectId=c.o and c.t in(4,1084,1145,3,4402,1090,10089,1146,112,1088,9700,9953,1010,4400,9702,4700,2,10005,1,4406) end
if (exists(select * from @t where t in(1151,9701,1011,4208,4703,127,4202,1090,1088,1150,1145,10089,4211,10068,9606,3005,1146,4215,9600,1148,4210,4209,10069,2,10090,4402,4406,9700,8199,9702,4003,1,4000,1149,9507,4212,4207,8181,4300,4401,4251,1010,4414,10005,4204,4,4201,9605,9953,4001,9400,112,9401,4006,1084,4216,4206,4400,401,3,9300,9750,4214)))begin insert into @t(o,t,u,v,q,s,l) select o.AnnotationId,5,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from Annotation o,@t c where o.ObjectId=c.o and c.t in(1151,9701,1011,4208,4703,127,4202,1090,1088,1150,1145,10089,4211,10068,9606,3005,1146,4215,9600,1148,4210,4209,10069,2,10090,4402,4406,9700,8199,9702,4003,1,4000,1149,9507,4212,4207,8181,4300,4401,4251,1010,4414,10005,4204,4,4201,9605,9953,4001,9400,112,9401,4006,1084,4216,4206,4400,401,3,9300,9750,4214) end
if (exists(select * from @t where t in(4400,4210,9958,1022,9401,1011,4209,129,4230,1013,2010,5,951,1071,1147,955,50,9750,9102,4232,4703,1091,1149,9604,1002,4208,4005,4214,127,1201,1010,950,4712,1036,1028,2,4000,4251,4212,4411,9400,4001,1141,9,7100,1090,9869,4010,9752,9502,4201,1083,9700,1084,3,4300,4211,9954,4402,55,4002,4401,2029,9955,1151,9106,9987,4009,4414,954,3231,952,1089,1111,4207,1088,92,8003,4416,1148,9606,4710,1142,1025,9508,4202,1112,1085,1150,3234,4216,9751,2020,4503,9100,4406,1056,2013,4206,1,4204,1038,135,1016,4724,1145,9602,1200,123,9603,1144,1080,112,8,1146,3008,953,1152,1003,9702,3005,9930,9600,1024,7101,1039,99,10,9105,9959,1019,9605,9953,1004,1001,2011)))begin insert into @t(o,t,u,v,q,s,l) select o.SyncErrorId,9869,o.OwnerId,o.OwnerIdType, c.o, c.t, c.l +1 from SyncError o,@t c where o.RegardingObjectId=c.o and c.t in(4400,4210,9958,1022,9401,1011,4209,129,4230,1013,2010,5,951,1071,1147,955,50,9750,9102,4232,4703,1091,1149,9604,1002,4208,4005,4214,127,1201,1010,950,4712,1036,1028,2,4000,4251,4212,4411,9400,4001,1141,9,7100,1090,9869,4010,9752,9502,4201,1083,9700,1084,3,4300,4211,9954,4402,55,4002,4401,2029,9955,1151,9106,9987,4009,4414,954,3231,952,1089,1111,4207,1088,92,8003,4416,1148,9606,4710,1142,1025,9508,4202,1112,1085,1150,3234,4216,9751,2020,4503,9100,4406,1056,2013,4206,1,4204,1038,135,1016,4724,1145,9602,1200,123,9603,1144,1080,112,8,1146,3008,953,1152,1003,9702,3005,9930,9600,1024,7101,1039,99,10,9105,9959,1019,9605,9953,1004,1001,2011)
while (@@rowcount <> 0)if (exists(select * from @t where t=9869))insert into @t(o,t,u,v,q,s,l) select o.SyncErrorId,9869,o.OwnerId,o.OwnerIdType,c.o,c.t,c.l +1 from SyncError o,@t c where o.RegardingObjectId=c.o and c.t=9869 and o.SyncErrorId not in(select o from @t where o=o.SyncErrorId and t=9869) end
return
end
