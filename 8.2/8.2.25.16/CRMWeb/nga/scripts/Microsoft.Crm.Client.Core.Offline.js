Type.registerNamespace("Microsoft.Crm.Client.Core.Offline");Microsoft.Crm.Client.Core.Offline.$Fw=function(){};Microsoft.Crm.Client.Core.Offline.$Fw.registerInterface("Microsoft.Crm.Client.Core.Offline.$Fw");Microsoft.Crm.Client.Core.Offline.$Fv=function(){};Microsoft.Crm.Client.Core.Offline.$Fv.registerInterface("Microsoft.Crm.Client.Core.Offline.$Fv");Microsoft.Crm.Client.Core.Offline.$t=function(){};Microsoft.Crm.Client.Core.Offline.$t.$7E=function(n){return Xrm.Objects.AttributeType.toString(n)};Microsoft.Crm.Client.Core.Offline.$t.prototype={$18:function(){this.$2tF()},$2tF:function(){Microsoft.Crm.Client.Core.Offline.$t.$AF=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Microsoft.Crm.Client.Core.Offline.$IJ));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(21),new Microsoft.Crm.Client.Core.Offline.$IJ({attributelogicalname:String,entitylogicalname:String,attributetype:Xrm.Objects.AttributeType}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(1),new Microsoft.Crm.Client.Core.Offline.$IJ({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(6),new Microsoft.Crm.Client.Core.Offline.$IJ({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(9),new Microsoft.Crm.Client.Core.Offline.$IJ({id:Microsoft.Crm.Client.Core.Framework.Guid,logicalname:String,name:String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(13),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(12),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(0),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(11),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(2),new Microsoft.Crm.Client.Core.Offline.$IJ({"":Number}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(14),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(15),new Microsoft.Crm.Client.Core.Offline.$IJ({"":Microsoft.Crm.Client.Core.Framework.Guid}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(3),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(4),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(5),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(7),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(8),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(-1),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(10),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(16),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(17),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(18),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(19),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}));Microsoft.Crm.Client.Core.Offline.$t.$AF.set_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(20),new Microsoft.Crm.Client.Core.Offline.$IJ({"":String}))},$1pu:function(n){var t=Microsoft.Crm.Client.Core.Offline.$t.$7E(n);return!Microsoft.Crm.Client.Core.Framework.$3.$9(t)&&Microsoft.Crm.Client.Core.Offline.$t.$AF.$2j0(t)?Microsoft.Crm.Client.Core.Offline.$t.$AF.get_$I(t):null},$1pr:function(n){var t=Microsoft.Crm.Client.Core.Offline.$t.$7E(n);return!Microsoft.Crm.Client.Core.Framework.$3.$9(t)&&Microsoft.Crm.Client.Core.Offline.$t.$AF.$2j0(t)?Microsoft.Crm.Client.Core.Offline.$t.$AF.get_$I(t).$1kB:null},$2zm:function(n,t){return Microsoft.Crm.Client.Core.Offline.$t.$AF&&Microsoft.Crm.Client.Core.Offline.$t.$AF.$2j0(Microsoft.Crm.Client.Core.Offline.$t.$7E(n))?Microsoft.Crm.Client.Core.Offline.$t.$AF.get_$I(Microsoft.Crm.Client.Core.Offline.$t.$7E(n)).$rk.get_$I(t):null},$tn:function(n){switch(n){case 21:case 1:case 6:case 9:return!0;default:return!1}}};Microsoft.Crm.Client.Core.Offline.$1F=function(){};Microsoft.Crm.Client.Core.Offline.$1F.$18=function(n,t){Microsoft.Crm.Client.Core.Offline.$1F.$Ev=new Microsoft.Crm.Client.Core.Offline.$t;Microsoft.Crm.Client.Core.Offline.$1F.$sV=new Microsoft.Crm.Client.Core.Offline.$68;Microsoft.Crm.Client.Core.Offline.$1F.$Ev.$18();Microsoft.Crm.Client.Core.Offline.$1F.$sV.$18(Microsoft.Crm.Client.Core.Offline.$1F.$Ev);Microsoft.Crm.Client.Core.Offline.$1F.$2PJ=new Microsoft.Crm.Client.Core.Offline.$2c(Microsoft.Crm.Client.Core.Offline.$1F.$Ev);Microsoft.Crm.Client.Core.Offline.$1F.$5b=n;Microsoft.Crm.Client.Core.Offline.$1F.$1b=t};Microsoft.Crm.Client.Core.Offline.$1F.$2re=function(n,t){for(var v,f=n.$N.LogicalName,e=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$l(f),s=t,h=s.length,o=0;o<h;++o){var r=s[o],u=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(f,r),i={};switch(r){case"statecode":e.$OY&&(i.value=!$0.$1(u)&&!$0.$1(u.$DD)?u.$DD:0,n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1O.$1A(i),12));break;case"statuscode":if(e.$OY&&!$0.$1(n.getFieldObjectData("statecode"))){var c=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(f,"statecode"),l=n.getFieldObjectData("statecode").value,a=c.$5d.$2f[l.toString()].$e4;i.value=a;n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1O.$1A(i),13)}break;case"createdon":case"modifiedon":i[r]=new Date(Date.now());n.initializeValue(r,i[r],2);break;case"createdby":case"modifiedby":case"ownerid":(r!=="ownerid"||e.$v0===1)&&(i.id=Microsoft.Crm.Client.Core.Offline.$1F.$1b.$3K.getObjectData(),i.logicalname="systemuser",i.name=Microsoft.Crm.Client.Core.Offline.$1F.$1b.$AQ,v=$0.$1(u)?r==="ownerid"?9:6:u.$2K,n.initializeValue(r,Xrm.Objects.EntityReference.createFromObjectData(i),6));break;default:u.$2K!==11&&u.$2K||(i.value=$0.$1(u.$DD)?u.$Aw?1:0:u.$DD,n.initializeValue(r,Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1O.$1A(i),u.$2K))}}return n};Microsoft.Crm.Client.Core.Offline.$1F.$zg=function(n,t,i,r){var u={},c={},p=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)),b=Microsoft.Crm.Client.Core.Offline.$1F.$sV.$310(i.get_$1n(),t),l=Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),a=new String,v=n,o,f,s,h;for(o in v){f={key:o,value:v[o]};f.key===i.get_$Hj()?l=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(f.value.toString().toUpperCase()):f.key===i.get_$Gd()&&(a=f.value);var e=f.key.split("!"),y=$0.$1(e[0])?"":e[0],w=e.length===2&&!$0.$1(e[1])?e[1]:"";Microsoft.Crm.Client.Core.Offline.$1F.$2rd(u,c,t[y],y,w.toLowerCase(),f.value,i.get_$1n())}return s=new Xrm.Objects.EntityReference(i.get_$1n(),l,a),i.$tu&&"versionnumber"in u&&!$0.$1(u.versionnumber)&&s.setValue("RowVersion",u.versionnumber.toString()),u=Microsoft.Crm.Client.Core.Offline.$1F.$2ko(u,t),h=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(s,u,t,c,{},p),h.set_clientRetrieveOptions(r),h};Microsoft.Crm.Client.Core.Offline.$1F.$2rd=function(n,t,i,r,u,f,e){var l,a,s,c,o,v,h;if(Microsoft.Crm.Client.Core.Offline.$1F.$1VO(i)&&(e!=="activityparty"||r!=="ownerid"))if(l=Microsoft.Crm.Client.Core.Offline.$1F.$Ev.$tn(i),a=Microsoft.Crm.Client.Core.Offline.$1F.$Ev.$2zm(i,u),l){r in n||(n[r]={});n[r][u]=a===Microsoft.Crm.Client.Core.Framework.Guid?!$0.$1(f)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(f.toString())?{rawguid:f.toString()}:null:f;switch(i){case 9:case 6:case 1:s=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(e,r);$0.$1(s)||$0.$1(s.$RU)||s.$RU.length!==1||(n[r].logicalname=s.$RU[0])}}else switch(i){case 11:case 12:case 13:case 0:$0.$1(f)?n[r]=null:(c="",o=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(e,r),!$0.$1(o)&&!$0.$1(o.$5d)&&!$0.$1(o.$5d.$2f)&&f.toString()in o.$5d.$2f?c=o.$5d.$2f[f.toString()].$1D:(v=$0.$1(o)?"attributemetadata":$0.$1(o.$5d)?"attributemetadata.OptionSet":"attributemetadata.OptionSet.Options",Microsoft.Crm.Client.Core.Framework.Trace.logError(1031,"{0} value is null for attribute: {1} with type: {2} in entity: {3}",v,r,$1M.$Rb(Xrm.Objects.AttributeType,i),e)),n[r]={value:Number.parseInvariant(f.toString()),label:c});break;case 15:n[r]=!$0.$1(f)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(f.toString())?{rawguid:f.toString()}:null;break;case 2:n[r]=!$0.$1(f)&&f.toString().length>0?Xrm.Soap.CrmDateTimeSerializer.$14V(f.toString()):null;break;case 20:$0.$1(f)?n[r]=null:(h=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$l(f.toString()),$0.$1(h)||(n[r]=h.$d,t[r]=h.$1S));break;default:n[r]=!$0.$1(f)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(f.toString())?f:null}};Microsoft.Crm.Client.Core.Offline.$1F.$2ko=function(n,t){var r={},f=n,u,i;for(u in f){i={key:u,value:f[u]};switch(t[i.key]){case 9:case 1:case 6:r[i.key]=$0.$1(i.value.id)?null:Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord.createSingleFieldFromObjectData(i.value,t[i.key]);break;default:r[i.key]=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord.createSingleFieldFromObjectData(i.value,t[i.key])}}return r};Microsoft.Crm.Client.Core.Offline.$1F.$1VO=function(n){switch(n){case-1:case 3:case 4:case 5:case 7:case 8:case 14:case 15:case 18:case 9:case 1:case 6:case 2:case 11:case 12:case 13:case 0:case 20:return!0;default:return!1}};Microsoft.Crm.Client.Core.Offline.$1F.$3JT=function(n,t,i,r,u){var c=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(Microsoft.Crm.Client.Core.Offline.$2l.get_$1kz()),g,f,e,w,b,s,k,a,o,h,y;if(c.add("versionnumber"),c.remove("ownerid"),g=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),i===1){for(var p=n.get_fieldNames(),nt=p.length,l=0;l<nt;++l)if(f=p[l],!c.contains(f))if(e=t[f],$0.$1(e)||e!==6&&e!==1&&e!==9){if(!$0.$1(r[f])){if(e&&e!==11&&e!==12){if(e===13&&(a=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(n.$N.LogicalName,"statecode"),!$0.$1(a))){var tt=n.getValue("statecode").$1i,it=a.$5d.$2f[tt.toString()].$e4,rt=n.getValue(f).$1i;if(rt===it)continue}}else if(b=n.getValue(f).$1i,s=Microsoft.Crm.Client.Core.Offline.$1F.$5b.$2c(n.$N.LogicalName,f),!$0.$1(s)&&(!$0.$1(s.$Aw)||!$0.$1(s.$DD))&&(k=$0.$1(s.$DD)?s.$Aw?1:0:s.$DD,k===b))continue;n.$4P.add(f)}}else w=Microsoft.Crm.Client.Core.Offline.$1F.$318(f,r),$0.$1(w)||n.$4P.add(f)}else if(i===3)for(var d=n.get_fieldNames(),ut=d.length,v=0;v<ut;++v)o=d[v],c.contains(o)||(h=t[o],$0.$1(h)||h!==6&&h!==1&&h!==9?r[o]!==u[o]&&n.$4P.add(o):(y=o+"!id",r[y]!==u[y]&&n.$4P.add(o)));return n};Microsoft.Crm.Client.Core.Offline.$1F.$318=function(n,t){var i=t[n+"!id"],r=t[n+"!logicalname"],u=t[n+"!name"];return!$0.$1(i)&&!$0.$1(r)?$0.$1(u)?new Xrm.Objects.EntityReference(r.toString(),i):new Xrm.Objects.EntityReference(r.toString(),i,u.toString()):null};Microsoft.Crm.Client.Core.Offline.$2t=function(){};Microsoft.Crm.Client.Core.Offline.$68=function(){};Microsoft.Crm.Client.Core.Offline.$68.prototype={$1Bt:null,$18:function(n){this.$1Bt=new(Microsoft.Crm.Client.Core.Framework.$BH.$$(Microsoft.Crm.Client.Core.Offline.$IG))(1e4);Microsoft.Crm.Client.Core.Offline.$68.$Ev=n},$2sL:function(){this.$1Bt.$3bz()},$310:function(n,t){var h=this.$1Bt.$3by(n),r,u,i,f,s;if($0.$1(h))return this.$2kb(n,t);for(var a=this.$2HO(t),e=h.get_$I(0).$1O1,c=!1,l=a,v=l.length,o=0;o<v;++o)for(r=l[o],u=Microsoft.Crm.Client.Core.Offline.$68.$Ev.$1pr(t[r]),i=0;i<u.length;i++)f=r,u[i]!==""&&(f+="!"+u[i]),f in e||(c=!0,e[f]=r);return s=new Microsoft.Crm.Client.Core.Offline.$IG(e),c&&this.$26Z(s,n),s},$2kb:function(n,t){for(var i,u,r,o,h=this.$2HO(t),f={},s=h,c=s.length,e=0;e<c;++e)for(i=s[e],u=Microsoft.Crm.Client.Core.Offline.$68.$Ev.$1pr(t[i]),r=0;r<u.length;r++)u[r]!==""?f[i+"!"+u[r]]=i:f[i]=i;return o=new Microsoft.Crm.Client.Core.Offline.$IG(f),this.$26Z(o,n),o},$26Z:function(n,t){var i=new(Microsoft.Crm.Client.Core.Framework.$P.$$(Microsoft.Crm.Client.Core.Offline.$IG))(n);this.$1Bt.$1A5(t,i)},$2HO:function(n){var t=[],r=n,i,u;for(i in r)u={key:i,value:r[i]},t[t.length]=u.key;return t}};Microsoft.Crm.Client.Core.Offline.$IJ=function(n){this.$rk=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Type))(n);this.$1kB=this.$rk.get_$3B8()};Microsoft.Crm.Client.Core.Offline.$IJ.prototype={$1kB:null,$rk:null};Microsoft.Crm.Client.Core.Offline.$IG=function(n){this.$1O1=n};Microsoft.Crm.Client.Core.Offline.$IG.prototype={$1O1:null,$2gF:function(){return this.$1O1.toString().length}};Microsoft.Crm.Client.Core.Offline.$IK=function(n,t){this.$25x=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Objects.AttributeType))([17,10]);this.$1R7=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["activitypointer".toLowerCase()]);this.$5G=n;this.$IY=t;this.$WT=""};Microsoft.Crm.Client.Core.Offline.$IK.prototype={$5G:null,$LM:null,$WT:null,$IY:null,$32t:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Object,Microsoft.Crm.Client.Core.Framework.$4),r=this,u=this;return this.$2gK(n,t).then(function(){r.$3Pk().then(function(){i.resolve(r.$LM)},function(n){i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_CalculateMetadataMismatchEntities_Error",1032,"Calculation of offline disabled entities failed with error : "+n.$E);i.reject(n)}),i.promise()},$3Pk:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4);if(!$0.$1(this.$WT)&&!$0.$9g(this.$LM)){var t=new Microsoft.Crm.Client.Core.Offline.$8H(this.$WT,this.$LM),i=this,r=this;this.$5G.$RK("offlinedisabledinfo",t.$1C(),!1).then(function(){Microsoft.Crm.Client.Core.Framework.$B.$1g("OfflineMetadataManager_MetadataSchemaValidator",1032,"Successfully saved the offline disabled info as session state.");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,"Saving offline disabled info as session state failed with error : "+t.$E);n.reject()})}return n.promise()},$2gK:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),f,e,u,s,h,c,r,v,y;if(this.$LM={},!$0.$28(n)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(n.userData)&&n.userData.split("#").length>1)if(this.$WT=t.toString(),f=n.userData.split("#"),f[0]===Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$14j&&f[1]===this.$WT)i.resolve(!0);else{e=[];u={};for(var l=n.tables,a=l.length,o=0;o<a;++o)s=l[o],u[s.name]=s;h=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$LL;for(c in h)r={key:c,value:h[c]},r.key in u?Array.add(e,this.$2iU(u[r.key])):this.$1R7.contains(r.key)||(this.$LM[r.key]=!0);v=this;y=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(){i.resolve(!0)},function(n){i.reject(n)})}else i.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Retrieved client model is corrupt or empty."));return i.promise()},$2iU:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i=this,r=this;return this.$5G.$4o(new Microsoft.Crm.Client.Core.Storage.DataApi.$60(n.name),this.$IY).then(function(r){for(var o,u,h,f={},c=n.column,a=c.length,e=0;e<a;++e)o=c[e],f[o.name]=o.type;for(var l=r.$22N(),v=l.length,s=0;s<v;++s)if(u=l[s],h=u.get_$5R()===6||u.get_$5R()===9||u.get_$5R()===1?u.get_$1n()+"!id":u.get_$1n(),!i.$25x.contains(u.get_$5R())&&(!(h in f)||f[h]!==Microsoft.Crm.Client.Core.Offline.$BM.$32p(u.get_$5R()))){i.$LM[n.name]=!0;break}t.resolve().promise()},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,n.$E);t.reject().promise()}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$BM=function(){};Microsoft.Crm.Client.Core.Offline.$BM.$32p=function(n){switch(n){case 1:case 6:case 7:case 9:case 14:case 15:case 20:return"text";case 4:return"real";case 8:case 3:return"fixed";case 2:return"datetime";case 18:case 5:case 0:case 11:case 12:case 13:case 19:return"integer";default:return""}};Microsoft.Crm.Client.Core.Offline.$8H=function(n,t){this.$WT=n;this.$LM=t};Microsoft.Crm.Client.Core.Offline.$8H.$1A=function(n){var t="",i={};return $0.$1(n)||(Microsoft.Crm.Client.Core.Framework.$3.$9(n.metadataversionused.toString())||(t=n.metadataversionused.toString()),i=n.offlinedisabledentities),new Microsoft.Crm.Client.Core.Offline.$8H(t,i)};Microsoft.Crm.Client.Core.Offline.$8H.prototype={$WT:null,$LM:null,$1C:function(){var n={};return n.metadataversionused=this.$WT,n.offlinedisabledentities=this.$LM,n}};Microsoft.Crm.Client.Core.Offline.$IH=function(){this.$Zy=!1;this.$fe=!1;this.$LM={}};Microsoft.Crm.Client.Core.Offline.$IH.prototype={$nn:0,$nm:0,$km:0,$5G:null,$IY:null,$fe:!1,$Zy:!1,$1VR:!1,$1PD:null,$LM:null,$1vL:null,$1lo:null,get_$1vK:function(){return this.$LM},set_$1vK:function(n){var i,r,u,t;this.$LM=n;i={};r=this.$LM;for(u in r)t={key:u,value:r[u]},t.key in Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$1vJ()&&(i[t.key]=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$1vJ()[t.key]);return this.$1vL=i,this.$5G.get_$6V().get_$3H()&&this.$1Ov(),n},get_$3EH:function(){return this.$1vL},get_$1PE:function(){return Number.parseInvariant(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$14j)},$18:function(n,t,i){this.$5G=t;this.$IY=i;this.$1lo=n;this.$2X3();var r=this,u=this;this.$5G.$XB("offlinedisabledinfo").then(function(n){if(!$0.$1(n)){var t=Microsoft.Crm.Client.Core.Offline.$8H.$1A(n);r.set_$1vK(t.$LM);Microsoft.Crm.Client.Core.Framework.$B.$1g("RetrieveSessionState_OfflineDisabledEntities_Success",1032,n.toString())}},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("RetrieveSessionState_OfflineDisabledEntities_Fail",1032,n.$E)})},$3Kg:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i;return this.$fe||n||this.$1VR?(i=this,this.$26c().always(function(){t.resolve(!0)})):t.resolve(!1),t.promise()},$360:function(){this.$fe&&!this.$Zy&&this.$1lo.$2QH(this,new Sys.EventArgs)},$35y:function(){this.$fe=!0},$3KN:function(n){this.$1VR=!0;this.$3Sb(n);this.$2XO(n)&&this.$2hN()},$35q:function(n){var t,i,r;switch(n.$UO){case 0:case 1:case 5:case 3:case 2:case 6:case 4:this.$Zy=!0;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as true. Stage : "+n.$UO);break;case 8:this.$fe=!1;t=this;i=this;this.$2X3().always(function(){t.$26d().always(function(){t.$Zy=!1;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")})}).done(function(){i.$1Ov()});break;case 7:r=this;this.$26d().always(function(){r.$Zy=!1;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")});break;case 9:this.$Zy=!1;this.$fe=!1;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_HandleMetadataSyncProgress",1032,"Metadata sync progress flag set as false.")}},$1WS:function(){return this.$nn>this.get_$1PE()||this.$nm>this.$km||this.$1sq()},$26d:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return this.$3Tz().then(function(i){i?t.$26c().always(function(){n.resolve()}):n.resolve()},function(){n.reject()}),n.promise()},$3Tz:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,i;return $0.$1(this.$5G)?n.resolve(!1).promise():(t=this,i=this,this.$5G.$XB("offlinedisabledinfo").then(function(i){if($0.$1(i))n.resolve(!0);else{var r=Microsoft.Crm.Client.Core.Offline.$8H.$1A(i);Microsoft.Crm.Client.Core.Framework.$3.$9(r.$WT)?n.resolve(!0):r.$WT===t.$km.toString()?n.resolve(!1):n.resolve(!0)}},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_ShouldReCalculateAfterMetadataSync_Error",1032,"Retrieval of offline disabled info failed. Error: "+t.$E);n.reject()}),n.promise())},$26c:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n,i;return Microsoft.Crm.Client.Core.Framework.$B.$1g("OfflineMetadataManager_CalculateDisabledOfflineEntities",1032,"Calculation of disabled offline entities started"),n=this,i=this,this.$2Iv().then(function(i){var r,u;!$0.$28(i)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(i.userData)&&i.userData.split("#").length>1?(r=i.userData.split("#"),n.$nn=Number.parseInvariant(r[0]),n.$nm=Number.parseInvariant(r[1]),u=new Microsoft.Crm.Client.Core.Offline.$IK(n.$5G,n.$IY),u.$32t(i,n.$km).then(function(i){n.set_$1vK(i);n.$1VR=!1;t.resolve()},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataSync_CalculateDisabledOfflineEntities_Error",1032,n.$E);t.reject()})):t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Retrieved client model is corrupt or empty."))},function(n){t.reject(n)}),t.promise()},$2hN:function(){this.$nm===this.$km&&this.$nn===this.get_$1PE()?this.$fe=!1:(this.$fe=!0,Microsoft.Crm.Client.Core.Framework.$B.$1g("OfflineMetadataManager_CheckIfMetadataSyncIsNeeded",1032,"Metadata updates available detected."))},$1Ov:function(){var n=this;this.$2hX().done(function(t){t&&(Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_CheckForMetadataOutofSyncForSyncStatus",1032,"Client Metadata Version: "+n.$km+" Middleware Metadata Version: "+n.$nm+" Client Profile Version: "+n.get_$1PE()+" Middleware Profile Version: "+n.$nn),n.$km!==n.$nm||n.get_$1PE()!==n.$nn||n.$1sq()?Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(2,3):Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(2))})},$2hX:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t;return this.$nn&&this.$nm?n.resolve(!0):(t=this,this.$2Iv().done(function(i){n.resolve(t.$2XO(i))})),n.promise()},$2XO:function(n){if($0.$1(n)||Microsoft.Crm.Client.Core.Framework.$3.$9(n.userData))Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_SetMiddlewareMetadataVersions_Error",1032,"Data model from middleware incomplete or corrupt.");else{var t=n.userData.split("#");if(!$0.$1(t)&&t.length>1)return this.$nn=Number.parseInvariant(t[0]),this.$nm=Number.parseInvariant(t[1]),Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_SetMiddlewareMetadataVersions",1032,"Middleware versions retrieved successfully."),!0;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_SetMiddlewareMetadataVersions_Error",1032,"Retrieval of Middleware versions failed.")}return!1},$2X3:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return this.$304().then(function(i){t.$km=Number.parseInvariant(i);n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_SetClientMetadataVersion_Error",1032,t.$E);n.reject()}),n.promise()},$3Sb:function(n){var t=[],u;if(!$0.$1(n)&&!$0.$1(n.tables))for(var r=n.tables,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u.name.toString();this.$1PD=t},$30l:function(n){try{return Sys.Serialization.JavaScriptSerializer.deserialize(n)}catch(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.message)}return null},$2Iv:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.NorsyncModel,Microsoft.Crm.Client.Core.Framework.$4),t=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(new Array(0)),i=this,r=this;return this.$5G.get_$6V().$1bI("_NORSYNC_SYSTEM_TABLE",t).then(function(t){if(!$0.$1(t)&&t.rows.length>0&&!$0.$1(t.rows.item(0).DATA_MODEL)){var r=t.rows.item(0).DATA_MODEL.toString(),u=i.$30l(r);n.resolve(u)}else n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Error in the retrieved client model from offline db."))},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.$E);n.reject(t)}),n.promise()},$304:function(){var n=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),t,i;return $0.$1(this.$5G)?n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("parent datasource is null.")).promise():(t=this,i=this,this.$5G.$1Hz().then(function(t){t.length>0?n.resolve(t.split("!")[0]).promise():n.reject()},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineMetadataManager_MetadataSchemaValidator_Error",1032,t.$E);n.reject()}),n.promise())},$1sq:function(){return!Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m.$93.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m.$93.toString()!==Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString()?!0:!1}};Microsoft.Crm.Client.Core.Offline.$IF=function(n,t){this.$s1=Microsoft.Crm.Client.Core.Framework.$3.$9(n)?Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString():n;this.$1b=t;this.$nu=new Microsoft.Crm.Client.Core.Framework.Net.Uri(t.$1H.$1G7);this.$kY=Microsoft.Crm.Client.Core.Framework.AuthenticationManager.$D.get_$19v();this.$93=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString();this.$1Ic=localStorage.getItem("MoCASessionID")};Microsoft.Crm.Client.Core.Offline.$IF.prototype={$s1:null,$1b:null,$93:null,$kY:null,$nu:null,$1Ic:null,$2hh:function(n){var i,t;if($0.$1(n))return Microsoft.Crm.Client.Core.Framework.$B.$1E("CheckWhetherLoginParametersChanged",1031,"Login Parameters are empty"),!0;var u=n.$1C(),f=this.$1C(),r=u;for(i in r)if(t={key:i,value:r[i]},f[t.key]!==t.value)return Microsoft.Crm.Client.Core.Framework.$B.$1E("CheckWhetherLoginParametersChanged",1031,"Login Parameter"+t.key+"Changed"),!0;return Microsoft.Crm.Client.Core.Framework.$B.$1E("CheckWhetherLoginParametersChanged",1031,"Login Parameteres Didn't change"),!1},get_$pj:function(){return this.$1b.$3K.toString()},get_$1xL:function(){return Number.parseInvariant(this.$nu.$vE)},get_$1rO:function(){return this.$nu.$fH},get_$20D:function(){return!Microsoft.Crm.Client.Core.Framework.$3.$9(this.$nu.$cM)&&this.$nu.$cM.length>1?this.$nu.$cM.slice(1):this.$1b.get_$Jt().toString()},get_$2Mw:function(){return this.$nu.$p1==="https"},$1C:function(){var n={};return n.DataBaseName=this.$s1,n.UserId=this.get_$pj(),n.Host=this.get_$1rO(),n.Port=this.get_$1xL().toString(),n.IsSSL=this.get_$2Mw().toString(),n.ServerDataBaseName=this.get_$20D(),n.ProfileId=this.$93,n.AuthToken=this.$kY,n.SessionId=this.$1Ic,n}};Microsoft.Crm.Client.Core.Offline.$l=function(n){this.$1GD=new Microsoft.Crm.Client.Core.Offline.$I9(0);this.get_$1F0=this.get_isMobileOfflineOptinFeatureEnabledInternal;this.set_$1F0=this.set_isMobileOfflineOptinFeatureEnabledInternal;this.get_$12V=this.get_isMobileOfflineOptOutFeatureEnabledInternal;this.set_$12V=this.set_isMobileOfflineOptOutFeatureEnabledInternal;this.get_$1WF=this.get_isOfflineSyncTransitionStarted;this.set_$1WF=this.set_isOfflineSyncTransitionStarted;this.get_$7v=this.get_offlineProfile;this.set_$7v=this.set_offlineProfile;this.$Ac=n};Microsoft.Crm.Client.Core.Offline.$l.get_$6N=function(){return $0.$1(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3)||($0.$1(Microsoft.Crm.Client.Core.Offline.$l.$3)||Microsoft.Crm.Client.Core.Offline.$l.$3.get_$Ld()!==Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld())&&(Microsoft.Crm.Client.Core.Offline.$l.$3=new Microsoft.Crm.Client.Core.Offline.$l(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p()),Microsoft.Crm.Client.Core.Offline.$l.$3.set_$Ld(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld())),Microsoft.Crm.Client.Core.Offline.$l.$3};Microsoft.Crm.Client.Core.Offline.$l.prototype={$Ac:null,$4m_0:null,$1b_0:null,$IV:!1,$1G9:null,$12U_0:!1,get_offlineProfile:function(){return this.$4m_0},set_offlineProfile:function(n){return($0.$1(n)||$0.$1(this.$4m_0)||JSON.stringify(this.get_$K().$4m.$1C())!==JSON.stringify(this.$4m_0.$1C()))&&(this.$4m_0=n,this.$2Yo()),n},get_$2MU:function(){return this.$12U_0},set_$2MU:function(n){return this.$12U_0=n,n},$3T8:function(n){var t=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4);return $0.$1(n)||$0.$1(this.$4m_0)||JSON.stringify(this.get_$K().$4m.$1C())!==JSON.stringify(this.$4m_0.$1C())?(this.$4m_0=n,this.$2Yo()):t.resolve()},get_$2PO:function(){if($0.$1(this.$1GD))throw Error.invalidOperation("OfflineSyncInfo has not been initialized yet.");return this.$1GD},get_$2Z8:function(){return this.get_$2PO().$1dh},set_$2Z8:function(n){return this.get_$2PO().$1dh=n,n},get_$K:function(){if($0.$1(this.$1b_0))if(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$Je())this.$1b_0=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K();else throw Error.invalidOperation("UserContext is not initialized");return this.$1b_0},set_$K:function(n){return this.$1b_0=n,n},get_isMobileOfflineOptinFeatureEnabledInternal:function(){return this.$HX},set_isMobileOfflineOptinFeatureEnabledInternal:function(n){return this.$HX!==n&&(this.$HX=n,n||this.$20q(0),this.$2gC()),n},get_isMobileOfflineOptOutFeatureEnabledInternal:function(){return this.$WH},set_isMobileOfflineOptOutFeatureEnabledInternal:function(n){return this.$WH!==n&&(this.$WH=n,this.$2gD()),n},get_isOfflineSyncTransitionStarted:function(){return this.$12Y},set_isOfflineSyncTransitionStarted:function(n){return this.$12Y!==n&&(this.$12Y=n,Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().get_PALEnabled()&&Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().$EX&&this.$16w()),n},get_$u3:function(){return $0.$1(this.$IV)&&(this.$IV=!1),this.$IV},set_$u3:function(n){return this.$IV=n,n},get_$1vJ:function(){return this.$1G9},set_$1vJ:function(n){return this.$1G9=n,n},$HX:!1,$12Y:!1,$WH:!1,$69_0:null,$Ec_0:null,$18:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i;return this.set_$K(n),i=this,this.$2hD().always(function(){i.$Ac.$37r(i.$1b_0).then(function(n){t.resolve(n)},function(n){t.reject(n)})}),t.promise()},$2Yo:function(){return this.$26a("LastRetrievedOfflineProfileData",$0.$1(this.$4m_0)||Microsoft.Crm.Client.Core.Framework.$3.$9(this.$4m_0.toString())?null:JSON.stringify(this.$4m_0.$1C()),!0)},$2gC:function(){this.$26a("ismobileofflineoptedin",this.$HX,!0)},$2gD:function(){var n={};n.ismobileofflineoptedout=this.$WH;Microsoft.Crm.Client.Core.Framework.$h.get_$5().$RK("ismobileofflineoptedout",n,!0)},$3Op:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$h.get_$5().$LX("ismobileofflineoptedin").then(function(i){!$0.$1(i)&&"ismobileofflineoptedin"in i?(t.$HX=i.ismobileofflineoptedin,n.resolve(t.$HX)):(t.$HX=!1,n.resolve(t.$HX))},function(t){i.$HX=!1;n.reject(t)}),n.promise()},$3Oq:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$h.get_$5().$LX("ismobileofflineoptedout").then(function(i){!$0.$1(i)&&"ismobileofflineoptedout"in i?(t.$WH=i.ismobileofflineoptedout,n.resolve(t.$WH)):(t.$WH=!1,n.resolve(t.$WH))},function(t){i.$WH=!1;n.reject(t)}),n.promise()},get_$Ld:function(){return this.$69_0},set_$Ld:function(n){return this.$69_0=n,n},get_$aG:function(){return Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$r()||$0.$1(this.$Ec_0)||(this.$Ec_0.$PK===-1&&this.$Ec_0.$Lh===1&&(this.$Ec_0.$Lh=0),this.$Ec_0.$PK=this.$2Jo(this.$Ec_0.$Lh)),this.$Ec_0},$2hD:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n=this,i=this;return this.$Ac.$3On().then(function(i){$0.$1(i)?n.$Ac.$2VS(n.get_$K().$1H.$IV).then(function(){n.$IV=n.get_$K().$1H.$IV;Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_CheckForDeploymentChange",1005,"SaveOfflineDbDeploymentInformation succeeded. Value : "+n.get_$u3());t.resolve()},function(i){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_CheckForDeploymentChange_Error",1005,"SaveOfflineDbDeploymentInformation failed. Value : "+n.get_$u3()+". Details : "+i.$E);t.reject(i)}):(n.$IV=Boolean.parse(i.toString()),t.resolve())},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_CheckForDeploymentChange_Error",1005,"Error retrieving Offline db deployment info. Details : "+n.$E);t.reject(n)}),t.promise()},$20q:function(n,t){$0.$1(this.$Ec_0)&&(this.$Ec_0=new Microsoft.Crm.Client.Core.Framework.Offline.$Na(n,t));$0.$1(this.$4m_0)||(this.$Ec_0.$Lh=n,this.$Ec_0.$Lh!==1&&this.$Ec_0.$Lh?(this.$Ec_0.$10I=Microsoft.Crm.Client.Core.Framework.$1I.$m(this.$Ac.get_$6V().get_$13Y().get_$3EH()),this.$Ec_0.$1Bp=Microsoft.Crm.Client.Core.Framework.$1I.$m(this.$1G9)-this.$Ec_0.$10I):(this.$Ec_0.$10I=Microsoft.Crm.Client.Core.Framework.$1I.$m(this.$1G9),this.$Ec_0.$1Bp=0),this.$Ec_0.$PK=$0.$1(t)?this.$2Jo(n):t);Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_SetOfflineSyncStatusInfo",1005,String.format("Sync Status: {0} Sync Status Reason: {1}",$1M.$Rb(Microsoft.Crm.Client.Core.Framework.Offline.$FB,this.$Ec_0.$Lh),$1M.$Rb(Microsoft.Crm.Client.Core.Framework.Offline.$FC,this.$Ec_0.$PK)));Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$6Q().$3GN(this,null)},$Bs:function(n){return this.get_$K().$1H.$LA&&this.$Ac.get_$6V().get_$3H()&&n in this.$4m_0.$LL&&!this.$1En(n)},$1En:function(n){return n in this.$Ac.get_$6V().get_$13Y().get_$1vK()},$1yB:function(n,t,i,r){var c=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$4),o={},w=t.$1Z,l,f,s,u,e,h,a,v,y,p,b,k,d;for(l in w)if(f={key:l,value:w[l]},s=f.value,(s===6||s===1||s===9)&&t.hasValue(f.key.toString())){if(u=t.getValue(f.key.toString()),$0.$1(u))continue;!u.equals(n)&&this.$Bs(u.LogicalName)&&(e=u.LogicalName in o?o[u.LogicalName]:{},u.Id.toString()in e?(h=e[u.Id.toString()],h[h.length]=f.key,e[u.Id.toString()]=h):e[u.Id.toString()]=[f.key],o[u.LogicalName]=e)}a=[];v=o;for(y in v)p={key:y,value:v[y]},b=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Array))(p.value),Array.add(a,this.$Ac.get_$6V().$2UT(b.get_$3B8(),p.key,r,i));return k=this,d=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(a).then(function(n){for(var h,l,i,y,s=n,p=s.length,r=0;r<p;++r){h=s[r];l=h;for(var a=l.get_entities(),w=a.length,u=0;u<w;++u){var f=a[u],v=f.$N,e=o[f.$N.LogicalName][f.$N.Id.toString()];for(i=0;i<e.length;i++)y=t.getValue(e[i]),y.equals(v)||t.setValue(e[i],v)}}c.resolve(t)},function(){c.resolve(t)}),c.promise()},$2T0:function(n,t,i){for(var w,l,a,u,f,s,v,p,d,g,h=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$4),e=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))),c=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),r=n.get_entities(),o=0;o<r.length;o++){w=r[o].$1Z;l=w;for(a in l)if(u={key:a,value:l[a]},(u.value===6||u.value===1||u.value===9)&&r[o].hasValue(u.key)){if(f=r[o].getValue(u.key),$0.$1(f))continue;this.$Bs(f.LogicalName)&&(c.contains(u.key)||c.add(u.key),s=e.$2j0(f.LogicalName)?e.get_$I(f.LogicalName):new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),s.contains(f.get_identifier())||(s.add(f.get_identifier().toUpperCase()),e.set_$I(f.LogicalName,s)))}}v=[];for(var b=e.get_$3B8(),k=b.length,y=0;y<k;++y)p=b[y],Array.add(v,this.$Ac.get_$6V().$2UT(e.get_$I(p).get_Items(),p,i,t));return d=this,g=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(v).then(function(t){for(var u,i,f,e,o,s={},y=t,w=y.length,l=0;l<w;++l){var b=y[l],k=b,a=k.get_entities();for(u=0;u<a.length;u++)s[a[u].get_key()]=a[u]}for(i=0;i<r.length;i++)for(var p=c.get_Items(),d=p.length,v=0;v<d;++v)f=p[v],r[i].hasValue(f)&&!$0.$1(r[i].getValue(f))&&(e=r[i].getValue(f),o=e.get_identifier()in s?s[e.get_identifier()].$N:null,$0.$1(o)||e.equals(o)||r[i].setValue(f,o));h.resolve(n)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineDataSource_RefreshRetrieveMultipleLookupData_OfflineError",1005,t.$E);h.resolve(n)}),h.promise()},$31J:function(n){var t=MscrmComponents.DeferredPromiseFactory(Array,Microsoft.Crm.Client.Core.Framework.$4);if($0.$1(n.getValue("activityid"))||n.getValue("activityid")===Microsoft.Crm.Client.Core.Framework.Guid.get_empty())return Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineDataSource_GetExistingActivityParties",1005,"No activityparty data to retrieve for current entity"),t.resolve(new Array(0));var i=new Array(0),r=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("activityid!id",n.getValue("activityid").toString(),1,0)],u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(r),f=this,e=this;return this.$Ac.get_$6V().$1bI("activityparty",u).then(function(n){for(var f=!$0.$1(n)&&!$0.$1(n.rows)?n.rows.length:0,u="activitypartyid",r=0;r<f;r++)$0.$1(n.rows.item(r))||$0.$1(n.rows.item(r)[u])||(i[i.length]=n.rows.item(r)[u].toUpperCase());Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineDataSource_GetExistingActivityParties",1005,"GetExistingActivityParties completed successfully");t.resolve(i)},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_GetExistingActivityParties - Failure",1005,n.$E);t.reject(n)}),t.promise()},$KD:function(n){Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineDataSource_OnMetadataSyncUpdated",1005,"Metadata Sync Updated");n.$UO!==8&&(n.$UO!==9||$0.$1(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m)||$0.$1(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m.$93)||!Microsoft.Crm.Client.Core.Framework.Guid.$9(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m.$93.toString()))||(Microsoft.Crm.Client.Core.Offline.$l.$3.set_$7v(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$4m),Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().$EX&&this.$16w());$0.$1(this.$Ac.get_$6V().get_$13Y())||this.$Ac.get_$6V().get_$13Y().$35q(n);n.$UO===8&&this.$Ac.get_$6V().$1re()},$16w:function(){var t,n,i;Microsoft.Crm.Client.Core.Framework.UserAgent.getInstance().get_PALEnabled()&&(t=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K(),n={},n.username=t.$AQ,n.serverversion=t.$Yv,n.databaseversion=t.$PD.$Si,n.userroles=t.$ao.join(", "),n.userculturelcid=t.get_$12r().toString(16),i=this.$1st(),n.isoptincommandenabled=i,n.lastsyncdate=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1Wt(),n.isoptoutcommandenabled=this.$2Mf(),Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().$3M(Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().$1X,Microsoft.Crm.Client.Core.Framework.PAL.Core.NativeBridge.get_Instance().get_$2S().get_$3B(),new Microsoft.Crm.Client.Core.Framework.PAL.Dispatchers.$5g(n)))},$21q:function(){var t=MscrmComponents.DeferredPromiseFactory(Object,Microsoft.Crm.Client.Core.Framework.$4),n=this,i=this;return Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.when(this.$Ac.$RI(),this.$3Op(),this.$3Oo(),this.$3Oq()).then(function(i){i.length>0&&!$0.$1(i[0])?(n.set_$K(i[0]),n.get_$K().$1H.$LA&&$0.$1(n.$4m_0)?n.$3T8(n.$1b_0.$4m).then(function(){t.resolve()},function(){t.reject()}):t.resolve()):t.resolve();n.$HX&&n.$20q(0)},function(){t.reject(Microsoft.Crm.Client.Core.Framework.$4.$Vo(-2147094e3))}),t.promise()},$1st:function(){return this.get_$K().$1H.$LA&&!this.$HX&&this.$4m_0.$ml&&!this.$12Y},$2Mf:function(){return this.get_$K().$1H.$LA&&this.$HX&&this.$4m_0.$ml&&!this.$WH&&!this.$12Y},$3Oo:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return Microsoft.Crm.Client.Core.Framework.$h.get_$5().$LX("LastRetrievedOfflineProfileData").then(function(i){!$0.$1(i)&&"LastRetrievedOfflineProfileData"in i&&!$0.$1(i.LastRetrievedOfflineProfileData)&&!Microsoft.Crm.Client.Core.Framework.$3.$9(i.LastRetrievedOfflineProfileData)?(t.$4m_0=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile.$1A(JSON.parse(i.LastRetrievedOfflineProfileData)),n.resolve(t.$4m_0)):(Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineDataSource.RetrieveOfflineProfileCache.Done",1005,"Profile Not Found"),t.$4m_0=null,n.resolve(t.$4m_0))},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_RetrieveOfflineProfileCache_LocalError",1005,t.$E);i.$4m_0=null;n.reject(t)}),n.promise()},$26a:function(n,t,i){var r={};return r[n]=t,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$RK(n,r,$0.$1(i)?!0:i)},$2Jo:function(n){switch(n){case 0:return this.$4m_0.$93===Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?1:2;case 1:return 0;case 2:return 0}return 0},$27Z:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n=[],i,r;return Array.add(n,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$R6.$VR("ismobileofflineoptedin")),Array.add(n,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$R6.$VR("LastRetrievedOfflineProfileData")),Array.add(n,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$R6.$VR("ismobileofflineoptedout")),i=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(n).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()},$27Y:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=[],i,r;return Array.add(t,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$R6.$VR("LastRetrievedOfflineProfileData")),Array.add(t,Microsoft.Crm.Client.Core.Framework.$h.get_$5().$R6.$VR("offlinedisabledinfo")),i=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).then(function(){n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineDataSource_ClearOfflineDataBaseState_LocalError",1005,t.$E);n.reject(t)}),n.promise()}};Microsoft.Crm.Client.Core.Offline.$K=function(){this.$$d_$2bg=Function.createDelegate(this,this.$2bg);this.$$d_$24L=Function.createDelegate(this,this.$24L);this.$$d_$1zw=Function.createDelegate(this,this.$1zw);this.$1R7=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["activitypointer".toLowerCase(),"syncerror".toLowerCase(),"activityparty".toLowerCase(),"postfollow".toLowerCase(),"businessdatalocalizedlabel".toLowerCase()]);this.$LN=new Microsoft.Crm.Client.Core.Offline.$IH;this.$aF=!1};Microsoft.Crm.Client.Core.Offline.$K.$2O8=function(n){var t=n.code;switch(t){case 5:case 6:case 7:Microsoft.Crm.Client.Core.Offline.$K.$1E("Sync.Progress",n.message);break;default:Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.Progress",n.message)}};Microsoft.Crm.Client.Core.Offline.$K.$bK=function(n,t,i){return function(n,r){Microsoft.Crm.Client.Core.Offline.$K.$1E(i+".TxFailure",r);t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i(r))}};Microsoft.Crm.Client.Core.Offline.$K.$16I=function(n,t,i){return function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E(i+".SqlFailure",n);t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i(n))}};Microsoft.Crm.Client.Core.Offline.$K.$1E=function(n,t){Microsoft.Crm.Client.Core.Framework.$B.$1E(n,1031,t)};Microsoft.Crm.Client.Core.Offline.$K.$C=function(n,t){Microsoft.Crm.Client.Core.Framework.$B.$1E(n,1031,t)};Microsoft.Crm.Client.Core.Offline.$K.$33G=function(n){var t=[],u;t[t.length]=n.activityid.toString();t[t.length]=n.participationtypemask.toString();for(var r=n.resolvedparties,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u;return t};Microsoft.Crm.Client.Core.Offline.$K.$33H=function(n){var t=[],u;t[t.length]=n.activityid.toString();t[t.length]=n.activityid.toString();t[t.length]=n.participationtypemask.toString();for(var r=n.resolvedparties,f=r.length,i=0;i<f;++i)u=r[i],t[t.length]=u;return t};Microsoft.Crm.Client.Core.Offline.$K.prototype={$1di:0,$Jx:null,$5b:null,$LN:null,$vc:!0,$IY:null,$UM:null,$AM:!1,$Fi:null,$sV:null,$16j:0,$vw:0,$1ui:6e4,$2Ur:2,$1WL:!1,$aF:!1,$1Jc:null,get_$3EJ:function(){return this.$aF},get_$13Y:function(){return this.$LN},get_$R7:function(){return $0.$1(this.$Jx)&&(this.$Jx=norsyncPlugin.init("OfflineDataSource")),this.$Jx},get_$3H:function(){return this.$AM},set_$3H:function(n){return this.$AM!==n&&(this.$AM=n,n?this.$LN.$1Ov():Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(0)),n},$5G:null,$1b:null,$2sK:function(){$0.$1(this.$sV)||this.$sV.$2sL()},$18:function(n,t,i,r,u){var f,e,o;return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Initialize","Offline DataStore Initialize started"),f=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),this.$5b=t,this.$1di=n.$1H.$1Fs,this.$1b=n,Microsoft.Crm.Client.Core.Offline.$1F.$18(this.$5b,this.$1b),this.$5G=r,this.$IY=u,this.$LN.$18(i,r,u),e=this,o=this,this.$1re().then(function(n){f.resolve(n)},function(n){f.reject(n)}),f.promise()},$1re:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n;return Microsoft.Crm.Client.Core.Storage.DataApi.$H.get_$5().get_$IU()?(n=this,this.$2gB().always(function(){n.$AM||Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(n.$5G.$11e()?1:0);n.$37s().then(function(){n.$Fi!==""?(n.$vc=!0,Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Initialize.InitializeOfflineDatabase","Database name - "+n.$Fi),t.resolve(!0)):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Initialize.InitializeOfflineDatabase","Database name is null"),t.resolve(!1))},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Initialize.InitializeOfflineDatabase",n.$E);t.reject(n)})}),t.promise()):t.resolve(!1).promise()},$2MZ:function(){var n=!$0.$1(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v())&&!$0.$1(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93)&&!Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&!Microsoft.Crm.Client.Core.Framework.$3.$9(this.$1b.$1H.$1G7);return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.IsOfflineConfiguredForUser",n.toString()),n},$37s:function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.InitializeOfflineDatabase","Offline DataStore InitializeOfflineDatabase started");var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n=this,i=this;return this.$5G.$2Uc().then(function(i){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.InitializeOfflineDatabase","RetrieveOfflineDatabaseInformation succeeded. Database name - "+i);n.$Fi=i;n.$1P4(!1).then(function(i){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.InitializeOfflineDatabase","CleanUpDatabases status :"+i.toString());n.$2MZ()?n.$2VY().always(function(){t.resolve(i)}).fail(function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("Scheduling periodic sync job failed",n.$E)}):(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(0),n.$21Y().always(function(){t.resolve(i)}))},function(i){Microsoft.Crm.Client.Core.Offline.$K.$1E("InitializeOfflineDatabase.CleanupFailure",n.$Fi+" "+i.$E);t.reject(i)})},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("InitializeOfflineDatabase.RetrieveOfflineDatabaseInformation.Failure",n.$E);t.reject(n)}),t.promise()},$1P4:function(n){var i;if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","Offline DataStore CleanUpDatabases started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n||!this.$2MZ()||this.$1b.$4m.$93.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Storage.DataApi.$H.$KK||this.$Fi!==Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString()||Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$u3()!==this.$1b.$1H.$IV){var r=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(this.$Fi),u=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.OfflineProfile(r,{},""),f=new Microsoft.Crm.Client.Core.Storage.DataApi.$1j(this.$1b.$3K,this.$1b.$AQ,this.$1b.$G3,this.$1b.$oK,this.$1b.$up,this.$1b.$1H,this.$1b.$2M,this.$1b.$Ek,this.$1b.$SI,this.$1b.$PD,this.$1b.$ao,this.$1b.$Td,this.$1b.$9Y,this.$1b.$lO,this.$1b.$lP,this.$1b.$s6,this.$1b.$Yv,u,this.$1b.$Q,this.$1b.$Fj,this.$1b.$wy),t=this,e=this;this.$1js(this.$Fi,f).then(function(n){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","Offline DataStore ClearStore succeeded. Status - "+n);n?(t.$1b.$4m.$93.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())&&Microsoft.Crm.Client.Core.Offline.$l.get_$6N().set_$7v(t.$1b.$4m),Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$u3()!==t.$1b.$1H.$IV&&t.$5G.$2VS(t.$1b.$1H.$IV).then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDbDeploymentInformation succeeded. Old value : "+Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$u3()+". New Value : "+t.$1b.$1H.$IV);Microsoft.Crm.Client.Core.Offline.$l.get_$6N().set_$u3(t.$1b.$1H.$IV)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDbDeploymentInformation failed. Old value : "+Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$u3()+"New Value : "+t.$1b.$1H.$IV+" Details : "+n.$E)}),t.$5G.$2VR("").then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","Offline DataStore SaveOfflineDatabaseInformation succeeded");t.$Fi="";Microsoft.Crm.Client.Core.Storage.DataApi.$H.get_$5().$27Y().then(function(){i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("CleanUpDatabases.ClearOfflineDataBaseState","Clear Offline Database State failed with error : "+n.$E);i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("CleanUpDatabases.CleanUpDatabases","Save offline info failed with error : "+n.$E);i.reject(n)})):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","Status - "+n),t.$Fi="",i.resolve(!1))},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("CleanUpDatabases.CleanUpDatabases","cleanup database failed for database : "+e.$Fi);i.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Could not delete database"))})}else Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CleanUpDatabases","database cleanup not required"),i.resolve(!0);return i.promise()},$2VY:function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.SchedulePeriodicSyncJob","Offline DataStore SchedulePeriodicSyncJob started");var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n=this;return this.$21Y().always(function(){var i=!n.$5G.$11e();n.$2Z3().always(function(){t.isResolved()||t.resolve(!0)}).fail(function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.SchedulePeriodicSyncJob.SyncFailed",n.$E)}).done(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.SchedulePeriodicSyncJob","Offline DataStore Immediate sync finished")});n.$16j?Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.SchedulePeriodicSyncJob","Sync Job Not Scheduled"):(n.$2gm(),n.$16j=window.setInterval(n.$$d_$1zw,n.$1di));!i&&Microsoft.Crm.Client.Core.Storage.DataApi.$H.$KK&&t.resolve(!1)}),t.promise()},$2gm:function(){(this.$LN.$Zy||!Microsoft.Crm.Client.Core.Storage.DataApi.$H.$KK)&&(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrySync","Sync will be Retried after initlization"),this.$2Us(!1))},$21Y:function(){var n,t,i;return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.StopSync","Offline DataStore StopSync started"),n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),$0.$1(this.$UM)||this.$UM.get_$8C()||(this.$UM.$V8(),this.$aF=!1),$0.$1(this.$16j)||(window.clearInterval(this.$16j),this.$16j=0),t=this,i=this,this.get_$R7().abort(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.StopSync","Succesfully stopped the all running sync calls");n.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.StopSync","Couldnt stop the running sync call");n.resolve(!1)},!0),Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.StopSync","Offline DataStore StopSync finished"),this.$UM=null,n.promise()},$2LC:function(n,t){var r,i,u,f;return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.InitAndLogin","Offline DataStore InitAndLogin started"),r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i=new Microsoft.Crm.Client.Core.Offline.$IF(n,t),i.$2hh(Microsoft.Crm.Client.Core.Offline.$K.$1XG)?(Microsoft.Crm.Client.Core.Offline.$K.$C("InitAndLogin.LoginParameters","UserId:- "+i.get_$pj()+" NorsyncServerEndpointHost:- "+i.get_$1rO()+" NorsyncServerPort:- "+i.get_$1xL()+" OfflineDatabasePath:- /data/data/no.norsync.cordova/databases ServerDatabaseName :- "+i.get_$20D()+" ProfileId:- "+i.$93+" ModelVersion:- -1 MocaSessionId:- "+i.$1Ic),this.$Jx=norsyncPlugin.init(i.$s1),u=this,f=this,this.get_$R7().login(i.$s1,i.get_$pj(),"",i.get_$1rO(),i.get_$1xL(),"/data/data/no.norsync.cordova/databases",i.get_$2Mw(),function(){Microsoft.Crm.Client.Core.Offline.$K.$1XG=i;u.set_$3H(!Microsoft.Crm.Client.Core.Framework.$3.$9(n));Microsoft.Crm.Client.Core.Offline.$K.$C("InitAndLogin.LoginSuccess",i.$s1);r.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("InitAndLogin.LoginFailure",i.$s1);r.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline Store Initialize Failed"))},i.get_$20D(),i.$93,-1,i.$kY,i.$1Ic)):(Microsoft.Crm.Client.Core.Offline.$K.$C("InitAndLogin.LoginSuccess","Already Logged In"),r.resolve(!0)),r.promise()},$1zw:function(){if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ScheduleSync","Offline DataStore ScheduleSync started"),$0.$1(this.$UM))if(this.$aF)Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ScheduleSync","Offline DataStore Sync in progress, wait for completion");else{var n=this;this.$UM=Microsoft.Crm.Client.Core.Framework.Scheduler.Schedule(function(){n.$2Z3()},0,"Norsync Sync")}else this.$UM.get_$8C()||(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ScheduleSync","Offline DataStore ScheduleSync priority increased"),this.$UM.set_$LW(13))},$2Z3:function(){var n,t,i;return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Sync","Offline DataStore Sync started"),n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),Microsoft.Crm.Client.Core.Framework.$3.$9(this.$Fi)||this.$Fi===Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString()?this.$2ZA(n):(t=this,i=this,this.$1P4(!1).then(function(){t.$2ZA(n)},function(t){n.reject(t)})),n.promise()},$2ZA:function(n){var i=new Microsoft.Crm.Client.Core.Framework.PerformanceStopwatch("DataSource_OfflineSync"),t;i.start();t=this;this.$2LC(this.$Fi,this.$1b).done(function(){if(!t.$3U4()){n.resolve(!1);t.$UM=null;return}t.$aF=!0;Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.Start","SyncStarted");var r=new Date,u=t.$34j();t.get_$R7().synchronize(Microsoft.Crm.Client.Core.Offline.$K.$2O8,function(u){if(Microsoft.Crm.Client.Core.Offline.$K.$C("Sync","Offline DataStore Plugin Synchronize progress. Result - "+u.type),Microsoft.Crm.Client.Core.Offline.$K.$2O8(u),u.type==="on-sync-complete")if(Microsoft.Crm.Client.Core.Offline.$K.$C("Sync","Offline DataStore Plugin Synchronize completed"),t.$2U1(),t.$2hE().always(function(){var n=Microsoft.Crm.Client.Core.Framework.$3.$9(t.$Fi)?!0:!1;t.$LN.$3Kg(n).always(function(){t.$AM&&t.$LN.$1Ov();t.$aF=!1;t.$LN.$360()}).done(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.ProcessSyncCompleteForSchemaChanges","offlineMetadataManager.ProcessSyncCompleteForSchemaChanges succeeded")}).fail(function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("Sync.ProcessSyncCompleteForSchemaChanges","offlineMetadataManager.ProcessSyncCompleteForSchemaChanges failed")})}).done(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.CheckForOfflineProfileChange","OfflineDataStore CheckForOfflineProfileChange succeeded")}).fail(function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("Sync.CheckForOfflineProfileChange","OfflineDataStore CheckForOfflineProfileChange failed")}),t.$vc&&t.$2jY(),t.$UM=null,Microsoft.Crm.Client.Core.Framework.$3.$9(t.$Fi)){if(Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.Plugin.Synchronize","Initial Sync"),!t.$AM){var f=new Date,o=f-r,s=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$Ok("MOCADataSyncInitialDownloadCompleted",r.toString(),f.toString(),o,"Success","Initial data downloaded successfully",Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),"","",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1f(s)}t.$5G.$2VR(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString()).done(function(){t.$Fi=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString();t.set_$3H(!0);Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.SaveOfflineDatabaseInformation.Success",t.$Fi)}).always(function(){i.stop();$(window).trigger("offlineSyncComplete");Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.SaveOfflineDatabaseInformation.Complete",t.$Fi);n.resolve(!0)});Microsoft.Crm.Client.Core.Offline.$4b.get_$6N().$26b(null)}else{i.stop();$(window).trigger("offlineSyncComplete");Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.Success",t.$Fi);n.resolve(!0);var e=new Date,h=e-r,c=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$Ok("MOCADataSyncComplete",r.toString(),e.toString(),h,"Success","Delta sync completed successfully",Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),"","",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1f(c);Microsoft.Crm.Client.Core.Offline.$4b.get_$6N().$39T().then(function(n){n&&t.$1P4(!0).then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("SyncInternal.CleanUpDatabases","Full sync because of fls change");t.$2VY()},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("SyncInternal.CleanUpDatabases","Force sync did not happen, cleanup Error: "+n.$E.toString())})},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("SyncInternal.IsFullSyncRequired","Error: "+n.$E.toString())})}else t.$aF=!0},function(i){t.$UM=null;t.$aF=!1;Microsoft.Crm.Client.Core.Offline.$K.$1E("Sync.Failure",t.$Fi+" "+i.message);i.type==="on-sync-complete"&&(i.code===-35?Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$aG().$Lh,-2):Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$aG().$PK===3&&t.$LN.$1WS()||Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$20q(Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$aG().$Lh,-1),t.$2Us(!0),n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i(i.message)))},-1,function(n){return t.$LN.$Zy?(Microsoft.Crm.Client.Core.Offline.$K.$1E("Sync.Aborting","Returning false for syncing data model changes as metadata sync is in progress"),!1):(t.$aF=!0,t.$LN.$3KN(n),t.$vc=!0,Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.ModelChanged",n.toString()),!0)},u)})},$2Us:function(n){if(this.$1WL||(this.$1WL=!0,this.$vw=this.$1ui),this.$vw<this.$1di){var t=this;window.setTimeout(function(){n?Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrySync","Retrying after failure"):Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrySync","Retrying after initlization");t.$1zw()},this.$vw);this.$vw=this.$2Ur*this.$vw}n||this.$2U1()},$2U1:function(){this.$1WL=!1;this.$vw=this.$1ui},$2hE:function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CheckForOfflineProfileChange","Offline DataStore CheckForOfflineProfileChange started");var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("systemuserid",this.$1b.$3K.toString(),0,0)],r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(i),t=this,u=this;return this.$1bI("_systemuser",r).then(function(i){$0.$1(t.$1Jc)&&(t.$1Jc=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$93.toString());$0.$1(i)||!i.rows.length?(Microsoft.Crm.Client.Core.Offline.$K.$1E("CheckForOfflineProfileChange.NosystemUser","No system user records found in offline db."),n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("No system user records found in offline db."))):"mobileofflineprofileid!id"in i.rows.item(0)&&!$0.$1(i.rows.item(0)["mobileofflineprofileid!id"])&&!t.$1sq(i.rows.item(0)["mobileofflineprofileid!id"].toString())||(t.$LN.$35y(),Microsoft.Crm.Client.Core.Offline.$K.$C("CheckForOfflineProfileChange.Detected","Offline Profile Change detected on offline sync completion"));n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.$K.$1E("CheckForOfflineProfileChange.RetrieveSystemUserFailed",t.$E);n.reject(t)}),n.promise()},$1sq:function(n){return n.toLowerCase()!==this.$1Jc.toLowerCase()?(this.$1Jc=n,!0):!1},$2gB:function(){var u,f,h,c;Microsoft.Crm.Client.Core.Offline.$K.$C("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities","Offline DataStore CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities started");var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),e=[],o={},s=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$LL;for(u in s){var t={key:u,value:s[u]},n=Microsoft.Crm.Client.Core.Offline.$2l.get_$1kz(),i=this.$5b.$l(t.key);$0.$1(i)||(i.$1Ew||this.$1R7.contains(t.key)||(o[t.key]=i.$1S),i.$OY&&n.push.apply(n,Microsoft.Crm.Client.Core.Offline.$2l.get_$2Yj()),1!==i.$v0&&Array.remove(n,"ownerid"));f=this.$5b.$Fn(t.key,n);($0.$1(f)||f.length!==n.length)&&Array.add(e,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$4o(new Microsoft.Crm.Client.Core.Storage.DataApi.$60(t.key,n),null))}return Microsoft.Crm.Client.Core.Offline.$l.get_$6N().set_$1vJ(o),h=this,c=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities","Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("CacheDefaultFieldsAttributeMetadataForOfflineEnabledEntities.Failure",n.$E);r.reject(n)}),r.promise()},$3U4:function(){if(this.$5G.$11e())if(this.$LN.$Zy)Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.NotStarted","Sync not started because metadata sync is in progress.");else{if(Microsoft.Crm.Client.Core.Storage.DataApi.$H.$KK)return!0;Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.NotStarted","Sync not started because upsync is in progress.")}else Microsoft.Crm.Client.Core.Offline.$K.$C("Sync.NotStarted","Sync not started due to no network connectivity");return!1},$34j:function(){var i=Microsoft.Crm.Client.Core.Storage.Common.DateTimeOperators.$W.$2Jz(),u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().get_$En(),r=Microsoft.Crm.Client.Core.Framework.$m.$11W(i,u),n=new Date(i.getTime()+r),f=this.$1b.get_$Iv()*6e4,t={};return t[Microsoft.Crm.Client.Core.Offline.$K.$UN.$2AB]=String.format("'{0}-{1:D2}-{2:D2} {3:D2}:{4:D2}:{5:D2}.{6:D3}'",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),t[Microsoft.Crm.Client.Core.Offline.$K.$UN.$2PQ]=f.toString(),t[Microsoft.Crm.Client.Core.Offline.$K.$UN.$2BJ]=r.toString(),t},$32l:function(){var n={};return n.CommandOperation="CommandId",n.Command="Id",n.businessprocessflowinstance="businessprocessflowinstanceid",n},$1A5:function(n,t){var i;if(Microsoft.Crm.Client.Core.Storage.DataApi.$H.$KK&&(i=this.$5b.$l(n.$N.LogicalName),n.hasValue(i.$4S))){var u=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tc(n.$N,i.$4S),f=[n.getValue(i.$4S).toString()],r=this,e=this;this.$Jx.transaction(function(i){i.executeSql(u,f,function(i,u){var f,c,e,o,l;if(!$0.$1(u.rows)&&u.rows.length===1){var a=u.rows.item(0),s=!1,h=a;for(f in h)c={key:f,value:h[f]},s=c.value;if(s){e=n.fields;for(o in e)l={key:o,value:e[o]},n.$4P.add(l.key);r.$7p(n.$N,n,!0,t,!0).done(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Cache.Success",n.$N.get_key())})}else r.$B(n,!0,t,!0).done(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Cache.Success",n.$N.get_key())})}},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Cache.SqlExecutionFailure",n)})},function(n,t){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Cache.TransactionFailure",t)},null)}},$B:function(n,t,i,r){var u,f;if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Create","Offline DataStore Create started"),u=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$4),f=this.$5b.$Fn(n.$N.LogicalName,null),r=$0.$1(r)?!1:r,$0.$1(f)){var e=this,o=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$4o(new Microsoft.Crm.Client.Core.Storage.DataApi.$60(n.$N.LogicalName,null),null).then(function(t){e.$5b.$H1(n.$N.LogicalName,!0,t);e.$dZ(n,u,r)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Create.RetrieveMultipleAttributeMetadata.Fail",n.$E);u.reject(n)})}else this.$dZ(n,u,r);return u.promise()},$dZ:function(n,t,i){$0.$1(n.$N)&&(Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Create.Fail","Entity Record Identifier cannot be null"),t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Entity Record Identifier cannot be null")));var u=this.$5b.$l(n.$N.LogicalName),f=$0.$1(n.$N.Id)||n.$N.Id===Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?$0.$1(n.fields[u.$4S])?Microsoft.Crm.Client.Core.Framework.Guid.newGuid():n.fields[u.$4S]:n.$N.Id,r=this,e=this;Microsoft.Crm.Client.Core.Offline.$2l.$2Iy(n,0,u.$4S,f,this.$5b,this.$1b).then(function(e){var o=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SM(n.$N,e.$3Q),s=e.$NH;r.get_$R7().transaction(function(s){var h=[],c;if(i&&(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CreateInternal","Create called with triggers suppressed"),Array.add(h,r.$Fh(s,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SO(),null))),Array.add(h,r.$Fh(s,o,e.$NH)),u.get_$8p()&&!$0.$1(e.$oM)){n.$N.Id=f;for(var a=e.$oM,v=a.length,l=0;l<v;++l)c=a[l],Array.add(h,r.$Fh(s,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SM(c.entityreference,c.columns),c.values))}i&&Array.add(h,r.$Fh(s,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SP(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(h).then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Create","OfflineDataStore Create succeeded");n.$N.Id=f;t.resolve(n.$N)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Create.Fail",n.$E);t.reject(n)})},Microsoft.Crm.Client.Core.Offline.$K.$bK(Xrm.Objects.EntityReference,t,"Create"),null)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Create.GetOfflineQueryDataObject.Fail",n.$E);t.reject(n)})},$2pc:function(n){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ExecuteTransaction","Offline DataStore ExecuteTransaction started");var t=n.$1K4,r=n.$21j,i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),f=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),u=this,e=this;return this.$10y().then(function(n){var l=new Array(0),a=[],v=new Array(0),e,c,w,d,g,b,k,s;for(r&&(l.push(Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SO()),a.push(null),v.push("Transaction.SuppressTrigger.Failed")),e=0;e<t.get_Count();e++){var nt=$0.$1(t.get_$I(e).$Yp)?null:t.get_$I(e).$Yp.$xj,o=new Microsoft.Crm.Client.Core.Offline.$I6(t.get_$I(e).$1KL,nt),y="",p="",h=[];if(o.$61.length>0||t.get_$I(e).$14I==="Delete"){switch(t.get_$I(e).$14I){case"Create":p="Transaction.Create";h=o.$m0;y=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SM(new Xrm.Objects.EntityReference(t.get_$I(e).$RT,n),o.$61);break;case"Delete":p="Transaction.Delete";h=o.$m0;y=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2EJ(new Xrm.Objects.EntityReference(t.get_$I(e).$RT,n),t.get_$I(e).$Yp);break;case"Update":for(p="Transaction.Update",c="",w=u.$32l(),(t.get_$I(e).$RT in w)&&!$0.$1(w[t.get_$I(e).$RT])?c=w[t.get_$I(e).$RT].toString():(d=t.get_$I(e).$RT.startsWith("_NORSYNC_LOG_")?t.get_$I(e).$RT.replace("_NORSYNC_LOG_",""):t.get_$I(e).$RT,g=u.$5b.$l(d),c=g.get_$Hj()),b=new Array(0),k=-1,s=0;s<o.$61.length;s++)o.$61[s].toString()!==c?(b[b.length]=o.$61[s].toString(),h.push(o.$m0[s])):k=s;k!==-1&&h.push(o.$m0[k]);y=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2EY(new Xrm.Objects.EntityReference(t.get_$I(e).$RT,n),b,c)}l.push(y);a.push(h);v.push(p)}}r&&(l.push(Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SP()),a.push(null),v.push("Transaction.UnSuppressTrigger.Failed"));u.$Jx.transaction(function(n){var u,i;for(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ExecuteTransaction.plugin.Transaction","Succeeded"),u=r?t.get_Count()+2:t.get_Count(),i=0;i<u;i++)n.executeSql(l[i],a[i],null,Microsoft.Crm.Client.Core.Offline.$K.$16I(Boolean,f,v[i]))},Microsoft.Crm.Client.Core.Offline.$K.$bK(Boolean,i,"Transaction failed!"),function(){i.resolve(!0)})},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.ExecuteTransaction.plugin.Transaction",n.$E);i.reject(n)}),i.promise()},$10y:function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.GenerateUID","Offline DataStore GenerateUID started");var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.Guid,Microsoft.Crm.Client.Core.Framework.$4),t=this;return this.get_$R7().generateUUID(function(t){var i=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(t);i.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())?(Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.GenerateUID","Guid empty"),n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("invalid Guid generation"))):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.GenerateUID","Guid - "+i),n.resolve(i))},1),n.promise()},$1bI:function(n,t){var o=t,u=$0.$1(o)?null:o.$xj,i,f,r,s,e;if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLocalEntities","Offline DataStore RetrieveLocalEntities started"),i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$4),f=[],!$0.$1(u))for(r=0;r<u.length;r++)if(u[r].$Hu===7)for(s=u[r].$53,e=0;e<s.get_Items().length;e++)f.push(s.get_Items()[e]);else u[r].$Hu!==6&&f.push(u[r].$53);var h=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2u1(n,o),c=this,l=this;return this.get_$R7().transaction(function(n){n.executeSql(h,f,function(n,t){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLocalEntities.Plugin.Transaction","RetrieveLocalEntities succeeded");i.resolve(t)},Microsoft.Crm.Client.Core.Offline.$K.$16I(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,i,"Retrieve_DAL"))},Microsoft.Crm.Client.Core.Offline.$K.$bK(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,i,"Retrieve_Dal"),function(){i.isPending()&&i.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("No records found"))}),i.promise()},$6I:function(n,t,i,r){var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$4),f,e,o,s;return Microsoft.Crm.Client.Core.Offline.$K.$C("Retrieve.Start",n.get_key()),f=this.$5b.$l(n.LogicalName),e=Microsoft.Crm.Client.Core.Storage.Common.ColumnSet.isInstanceOfType(t)?t.$3Q:null,e=this.$2da(f,e),o=this,s=this,this.$5b.$TG(n.LogicalName,e).then(function(t){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Retrieve.GetAttributeTypes","GetAttributeTypes succeeded");var s=o.$2JE(t,r),h=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1oD(n,s,f.$4S),e=[];e[e.length]=n.Id.toString().toUpperCase();o.get_$R7().transaction(function(s){s.executeSql(h,e,function(e,s){if($0.$1(s.rows)||!s.rows.length)Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Retrieve.NoRecordsFound",n.get_key()),u.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("No records found"));else{var h=Microsoft.Crm.Client.Core.Offline.$1F.$zg(s.rows.item(0),t,f,i);f.get_$8p()?(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Retrieve","Entity metadata is activity"),o.$2rX(h,t,i,r).then(function(n){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Retrieve.FillActivityParty","Succeeded");u.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Retrieve.FillActivityParty",n.$E);u.reject(n)})):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Retrieve","Entity metadata is not activity"),u.resolve(h))}},Microsoft.Crm.Client.Core.Offline.$K.$16I(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,u,"Retrieve"+n.get_key()))},Microsoft.Crm.Client.Core.Offline.$K.$bK(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,u,"Retrieve"+n.get_key()),null)},function(t){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.Retrieve.GetAttributeTypes.Failure",n.LogicalName+"."+t.$E);u.reject(t)}),u.promise()},$2UT:function(n,t,i,r){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$4),f=this.$5b.$l(t),e=[f.$4S,f.$5e],o=this,s=this;return this.$5b.$TG(t,e).then(function(i){var s=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tz(n.length,e,f);o.$Jx.transaction(function(t){t.executeSql(s,n,function(n,t){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords succeeded");var e=o.$2EK(t,i,f,r);u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(e,!1,t.rows.length,!1))},function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLookupRecords","No records found");u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1))})},Microsoft.Crm.Client.Core.Offline.$K.$bK(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrieveLookupRecords"+t),null)},function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveLookupRecords","RetrieveLookupRecords failed");u.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline DB could not retrieve data for retreiveMultiple request"))}),u.promise()},$33:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$4),r;if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveMultiple.Start",n.get_$1a().toString()),r=n.get_$Bz(),Microsoft.Crm.Client.Core.Framework.$3.$9(r))return Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.RetrieveMultiple.SqlQueryNotFound",n.get_$1a().toString()),i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1,n)).promise();r=unescape(r);var f=Microsoft.Crm.Client.Core.Storage.Common.ColumnSet.isInstanceOfType(n.$3R)&&!n.$3R.get_$12L()?n.$3R.$3Q:null,u=this,e=this;return this.$5b.$TG(n.$S,f).then(function(f){var e,o,s;if(!("transactioncurrencyid"in f)){e=f;for(o in e)if(s={key:o,value:e[o]},s.value===8){f.transactioncurrencyid=6;break}}u.get_$R7().transaction(function(e){e.executeSql(r,null,function(r,e){var o,s,h;Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrieveMultiple.SqlSuccess",n.get_$1a().toString());o=!1;s=u.$5b.$l(n.$S);e.rows.length>n.$32&&(e.rows.length=n.$32,o=!0);h=u.$2EK(e,f,s,t);i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(h,o,e.rows.length,!1,n))},Microsoft.Crm.Client.Core.Offline.$K.$16I(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,i,"OfflineDataStore.RetrieveMultiple.QueryId"+n.get_$1a().toString()))},Microsoft.Crm.Client.Core.Offline.$K.$bK(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,i,"OfflineDataStore.RetrieveMultiple.QueryId"+n.get_$1a().toString()),function(){i.isPending()&&(Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.RetrieveMultiple.TransactionSuccessWithExecuteSqlPending","QueryId"+n.get_$1a().toString()),i.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1,n,t)));Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.RetrieveMultiple.TransactionSuccess","QueryId"+n.get_$1a().toString())})},function(){var t=String.format("Offline DB could not retrieve Attribute types for entity {0} from Metadata Cache",n.$S);Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.RetrieveMultiple.AttributeTypeRetrieveFailed",t+".QueryId"+n.get_$1a().toString());i.reject(Microsoft.Crm.Client.Core.Framework.$4.$i(t))}),i.promise()},$2US:function(n){var t=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),i=this.$33L(n),r;return i.length?(r=this,this.get_$R7().transaction(function(n){r.$Fh(n,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$3OU(i.length),i).then(function(n){var r=null,u,i;!$0.$1(n.rows)&&n.rows.length>0&&(u=new Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteRecord,i={},i=n.rows.item(0),$0.$1(i)||$0.$1(i.lastdatasynctime)||(r=Xrm.Soap.CrmDateTimeSerializer.$14V(i.lastdatasynctime.toString())));t.resolve(r)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineDataStore.RetrieveLastSyncTime",n.$E);t.reject(n)})},Microsoft.Crm.Client.Core.Offline.$K.$bK(String,t,"RetrieveLastSyncTime"),null),t.promise()):t.resolve(null)},$7p:function(n,t,i,r,u){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Update","Update started");var e=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$4),o=this.$5b.$l(n.LogicalName),f=this,s=this;return Microsoft.Crm.Client.Core.Offline.$2l.$2Iy(t,1,o.$4S,n.Id,this.$5b,this.$1b).then(function(i){var r=i.$NH;u=$0.$1(u)?!1:u;f.get_$R7().transaction(function(r){var s=[],l,w,h;if(Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1oD(n,[new Microsoft.Crm.Client.Core.Framework.Storage.$4U(o.$4S)],o.$4S),[n.Id.toString()])),u&&(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Update","Update called with triggers suppressed"),Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SO(),null))),Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2EY(n,i.$3Q,o.$4S),i.$NH)),o.get_$8p()){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Update","Entity metadata is activity");for(var p=i.$1Gj,d=p.length,c=0;c<d;++c)l=p[c],w=l.resolvedparties.length,Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tW(w),Microsoft.Crm.Client.Core.Offline.$K.$33G(l)));for(var b=i.$oM,g=b.length,a=0;a<g;++a)h=b[a],Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SM(h.entityreference,h.columns),h.values));for(var k=i.$1Gj,nt=k.length,v=0;v<nt;++v){var y=k[v],it=y.activityid.toString(),tt=y.resolvedparties.length;Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$3WV(tt),Microsoft.Crm.Client.Core.Offline.$K.$33H(y)))}}u&&Array.add(s,f.$Fh(r,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SP(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(s).then(function(n){$0.$1(n[0])||!n[0].rows.length?(Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.Update.Failure","You cant update this record because it doesnt exist in the offline mode"),e.reject(Microsoft.Crm.Client.Core.Framework.$4.$mC(-2147093980))):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Update","Update succeeded"),e.resolve(t.$N))},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.Update.Failure",n.$E);e.reject(n)})},Microsoft.Crm.Client.Core.Offline.$K.$bK(Xrm.Objects.EntityReference,e,"Update"),null)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.Update.GetOfflineQueryDataObject.Failure",n.$E);e.reject(n)}),e.promise()},$Fh:function(n,t,i){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ExecuteInternal","ExecuteInternal started");var r=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$4),u=this;return n.executeSql(t,i,function(n,t){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ExecuteInternal","ExecuteInternal succeeded");r.resolve(t)},Microsoft.Crm.Client.Core.Offline.$K.$16I(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,r,"ExecuteInternal")),r.promise()},Delete:function(n,t,i){var u,r;return Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Delete","Delete started"),u=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$4),i=$0.$1(i)?!1:i,r=this,this.get_$R7().transaction(function(t){var e=r.$5b.$l(n.LogicalName),s=[new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM(e.$4S,null,1,0)],h=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(s),c=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2EJ(n,h),o=[n.Id.toString()],f=[];Array.add(f,r.$Fh(t,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1oD(n,[new Microsoft.Crm.Client.Core.Framework.Storage.$4U(e.$4S)],e.$4S),[n.Id.toString()]));i&&(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Delete","Delete called with triggers suppressed"),Array.add(f,r.$Fh(t,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SO(),null)));Array.add(f,r.$Fh(t,c,o));e.get_$8p()&&(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Delete","Entity metadata is activity"),Array.add(f,r.$Fh(t,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tV(),o)));i&&Array.add(f,r.$Fh(t,Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1SP(),null));Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(f).then(function(t){$0.$1(t[0])||!t[0].rows.length?(Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.Delete.Failure","You cant delete this record because it doesnt exist in the offline mode"),u.reject(Microsoft.Crm.Client.Core.Framework.$4.$mC(-2147093944))):(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.Delete","Delete succeeded"),u.resolve(n))},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.Delete.Failure",n.$E);u.reject(n)})},Microsoft.Crm.Client.Core.Offline.$K.$bK(Xrm.Objects.EntityReference,u,"Delete"),null),u.promise()},$2EK:function(n,t,i,r){for(var u,o=!$0.$1(n)&&!$0.$1(n.rows)?n.rows.length:0,f=[],e=0;e<o;e++)u=n.rows.item(e),$0.$1(u)||Microsoft.Crm.Client.Core.Framework.$3.$9(u[i.$4S])||(f[f.length]=Microsoft.Crm.Client.Core.Offline.$1F.$zg(u,t,i,r));return f},$1js:function(n,t){var i,r;return(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.ClearStore","ClearStore started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),Microsoft.Crm.Client.Core.Framework.$3.$9(n))?(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineStore.ClearStore","Database name is empty"),i.resolve(!1).promise()):(r=this,this.$21Y().always(function(){r.$AM?r.$2Ah(n,i):r.$2LC(n,t).then(function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineStore.ClearStore","InitAndLogin succeeded");r.$2Ah(n,i)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.ClearStore.InitAndLogin.Failure",n.$E);i.reject(n)})}),i.promise())},$2Ah:function(n,t){var i=this,r=this;this.get_$R7().deleteDatabase(n,function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineStore.DeleteDatabase","Database delete successful for database : "+n);i.set_$3H(!1);i.$vc=!0;Microsoft.Crm.Client.Core.Offline.$K.$1XG=null;t.resolve(!0)},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("OfflineStore.DeleteDatabase.Failure",n);t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Could not delete database"))})},$3Ot:function(n,t,i,r){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrievePartyRecords","RetrievePartyRecords started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,Microsoft.Crm.Client.Core.Framework.$4),f=this,e=this;return this.$5b.$TG("activityparty",Microsoft.Crm.Client.Core.Offline.$2t.$2RX).then(function(e){var s,h,l;Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrievePartyRecords.GetAttributeTypes","GetAttributeTypes succeded");var a=f.$2JE(e,r),c=f.$5b.$l("activityparty"),v=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2u0(a,t,c.$d),o=[];o[o.length]=n.Id.toString().toUpperCase();s=t;for(h in s)l={key:h,value:s[h]},o[o.length]=l.key;f.$Jx.transaction(function(n){n.executeSql(v,o,function(n,t){for(var o=t.rows.length,f=[],r=0;r<o;r++)$0.$1(t.rows.item(r))||(f[f.length]=Microsoft.Crm.Client.Core.Offline.$1F.$zg(t.rows.item(r),e,c,i));Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.RetrievePartyRecords","Executesql succeded");u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(f,!1,t.rows.length,!1))},Microsoft.Crm.Client.Core.Offline.$K.$16I(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrievePartyRecords"))},Microsoft.Crm.Client.Core.Offline.$K.$bK(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection,u,"RetrievePartyRecords"),function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("RetreivePartyRecords.TransactionSuccess","Identifier"+n.get_key());u.resolve(new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(new Array(0),!1,0,!1))})},function(t){Microsoft.Crm.Client.Core.Offline.$K.$1E("Retrieve.GetAttributeTypes.Failure",n.LogicalName+"."+t.$E);u.reject(t)}),u.promise()},$2rX:function(n,t,i,r){var o,e,c,l,a;Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.FillActivityParty","FillActivityParty started");var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$4),s=!1,f={},h=t;for(o in h)e={key:o,value:h[o]},e.value===10&&(c=Microsoft.Crm.Client.Core.Offline.$2t.$1ZG[e.key],f[c]=e.key,s=!0);return s?(l=this,a=this,this.$3Ot(n.$N,f,i,r).then(function(t){var i,r,e;if(Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.FillActivityParty","RetrievePartyRecords succeeded"),!$0.$1(t.get_entities())&&t.get_entities().length>0){i=new Array(0);r="";for(var s=t.get_entities(),h=s.length,o=0;o<h;++o)e=s[o],r!==e.getValue("participationtypemask").get_$bV()&&(i.length>0&&(n.initializeValue(f[r].toString(),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(i,!1,i.length,!1),10),i=new Array(0)),r=e.getValue("participationtypemask").get_$bV()),i[i.length]=e;n.initializeValue(f[r].toString(),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection(i,!1,i.length,!1),10)}Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.FillActivityParty","FillActivityparty succeeded");u.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("Retrieve.RetrievePartyRecords.Failure",n.$E);u.reject(n)}),u.promise()):(u.resolve(n),u.promise())},$2JE:function(n,t){var f=Microsoft.Crm.Client.Core.Offline.$2c.$3Og(n,t),e=new Array(0),o=f,r,s,u,i;for(r in o)for(s={key:r,value:o[r]},u=f[s.key],i=0;i<u.length;i++)Array.add(e,new Microsoft.Crm.Client.Core.Framework.Storage.$4U(u[i].toString()));return e},$2da:function(n,t){var i=new Array(0),e,s;if($0.$1(n.$4S)||(i[i.length]=n.$4S),$0.$1(n.$5e)||(i[i.length]=n.$5e),i.length>0){for(var f=t,h=f.length,r=0;r<h;++r)if(e=f[r],Array.remove(i,e)&&!i.length)break;for(var o=i,c=o.length,u=0;u<c;++u)s=o[u],t[t.length]=s}return t},$1YC:function(){var n=[],r=Microsoft.Crm.Client.Core.Offline.$l.get_$6N().get_$7v().$LL,t,i;for(t in r)i={key:t,value:r[t]},Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$1En(i.key)||(n[n.length]=i.key);return n},$2jY:function(){var n,t,i,r;Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CreateActivityPointerView","CreateActivityPointerView started");n=this.$LN.$1PD;t=[];!$0.$1(n)&&n.length>0&&(Array.add(t,this.$2BI("activitypointer")),Array.add(t,this.$2BI("activityattachment")));i=this.$1YC();Array.indexOf(i,"activitypointer".toLowerCase())===-1?Microsoft.Crm.Client.Core.Offline.$K.$C("CreateActivityPointerView","View not created as ActivityPointer is not offline available"):(r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).always(function(){r.$2jZ(n,i)}))},$2jZ:function(n,t){var i=this;Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tM(this.$5b,this.$IY,this.$5G,n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CreateActivityPointerView","CreateActivityPointerView query :"+n);i.$Jx.transaction(function(t){t.executeSql(n,null,function(){Microsoft.Crm.Client.Core.Offline.$K.$C("view creation successful","CreateActivityPointerView");i.$38p()?i.$2jV():i.$vc=!1},i.$$d_$24L)},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("transaction failed while creating the view","CreateActivityPointerView")},null)},null)},$38p:function(){var n=this.$1YC();return Array.indexOf(n,"activitymimeattachment")===-1||Array.indexOf(n,"attachment")===-1||Array.indexOf(n,"activitypointer")===-1?(Microsoft.Crm.Client.Core.Offline.$K.$C("CreateActivityAttachmentView","View not created as ActivityAttachment or Attachment or ActivityPointer is not offline available"),!1):!0},$2jV:function(){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CreateActivityAttachmentView","CreateActivityAttachmentView started");var n=this;Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tL(this.$1YC()).then(function(t){Microsoft.Crm.Client.Core.Offline.$K.$C("OfflineDataStore.CreateActivityAttachmentView","CreateActivityAttachmentView query :"+t);n.$Jx.transaction(function(i){i.executeSql(t,null,function(){Microsoft.Crm.Client.Core.Offline.$K.$C("view creation successful","CreateActivityAttachmentView");n.$vc=!1},n.$$d_$2bg)},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("transaction failed while creating the view","CreateActivityAttachmentView")},null)},null)},$24L:function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("view creation/removal failed","ActivityPointerChangeFailed with error message : "+n)},$2bg:function(n){Microsoft.Crm.Client.Core.Offline.$K.$1E("view creation/removal failed","ActivityAttachmentView creation failed with error message : "+n)},$2BI:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i=this,r=this;return this.$Jx.transaction(function(r){var u=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$2tY(n);r.executeSql(u,null,function(){Microsoft.Crm.Client.Core.Offline.$K.$C("DropView: "+n,"success");t.resolve(!0)},function(n,r){i.$24L(n,r);t.resolve(!1)})},function(){Microsoft.Crm.Client.Core.Offline.$K.$1E("DropView: "+n,"transaction failed");t.resolve(!1)},null),t.promise()},$1pm:function(){var n=new Array(0),t=this.$1YC(),i;return Array.contains(t,"activitypointer")&&(i=this.$LN.$1PD,n=Microsoft.Crm.Client.Core.Offline.$w.get_$5().$1pm(this.$5b,this.$IY,i,t)),n},$33L:function(n){var t=new Array(0);return n==="activitypointer"?t=this.$1pm():t[0]=n,t},$2hy:function(n){this.$1b=n;var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i=this,r=this;return this.$1P4(!0).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$K.$UN=function(){};Microsoft.Crm.Client.Core.Offline.$2c=function(n){Microsoft.Crm.Client.Core.Offline.$2c.$Ev=n};Microsoft.Crm.Client.Core.Offline.$2c.$1TQ=function(n,t){var i,u,f,o;if(!Microsoft.Crm.Client.Core.Offline.$2c.$Ev)return new Array(0);if(i=[],Microsoft.Crm.Client.Core.Offline.$1F.$1VO(t))if(Microsoft.Crm.Client.Core.Offline.$2c.$Ev.$tn(t)){u=Microsoft.Crm.Client.Core.Offline.$2c.$Ev.$1pr(t);f=n+"!";for(var e=u,s=e.length,r=0;r<s;++r)o=e[r],i[i.length]=f+o}else i[i.length]=n;return i};Microsoft.Crm.Client.Core.Offline.$2c.$3Og=function(n){var r={},u=n,i,f,t;for(i in u)f={key:i,value:u[i]},t=f.key,r[t]=Microsoft.Crm.Client.Core.Offline.$2c.$1TQ(t,n[t]);return r};Microsoft.Crm.Client.Core.Offline.$2c.$2IF=function(n,t,i){var r,u,h,e,f;if(!Microsoft.Crm.Client.Core.Offline.$2c.$Ev)return{};if(r={},u=Microsoft.Crm.Client.Core.Offline.$2c.$1C(t,i),Microsoft.Crm.Client.Core.Offline.$2c.$Ev.$tn(t)){h=Microsoft.Crm.Client.Core.Offline.$2c.$1TQ(n,t);e=Microsoft.Crm.Client.Core.Offline.$2c.$Ev.$1pu(t).$rk;for(var s=e.get_$3B8(),c=s.length,o=0;o<c;++o)f=s[o],r[n+"!"+f]=e.get_$I(f)===Microsoft.Crm.Client.Core.Framework.Guid?f in u?Microsoft.Crm.Client.Core.Framework.Guid.createFromObjectData(u[f]).toString().toUpperCase():"":f in u?u[f]:""}else switch(t){case 13:case 12:case 0:case 11:r[n]=$0.$1(u.value)?-1:u.value;break;case 15:r[n]=!$0.$1(i)&&!Microsoft.Crm.Client.Core.Framework.Guid.$9(i.toString())?i.toString().toUpperCase():"";break;case 2:r[n]=$0.$1(i)?"":Xrm.Soap.CrmDateTimeSerializer.$1Jx(i.toISOString());break;case 10:break;default:r[n]=i}return r};Microsoft.Crm.Client.Core.Offline.$2c.$1C=function(n,t){var i={};if($0.$1(t))return i;switch(n){case 9:case 6:case 1:i=t.getObjectData();break;case 11:case 0:case 12:case 13:i=t.$1C();break;case 21:i=t.$1C();break;case 10:i=t.getObjectData();break;case 15:i=t.getObjectData()}return i};Microsoft.Crm.Client.Core.Offline.$2l=function(n,t,i,r){this.$3Q=new Array(0);this.$NH=new Array(0);this.$oM=new Array(0);this.$1Gj=new Array(0);this.$1mz=new Array(0);this.$5b=i;this.$1b=r;var u=this.$30f(n,t);this.$67=Microsoft.Crm.Client.Core.Offline.$1F.$2re(n,u);this.$uu=t};Microsoft.Crm.Client.Core.Offline.$2l.get_$1kz=function(){return["createdon","createdby","ownerid","modifiedon","modifiedby"]};Microsoft.Crm.Client.Core.Offline.$2l.get_$2AX=function(){return["modifiedon","modifiedby"]};Microsoft.Crm.Client.Core.Offline.$2l.get_$2Yj=function(){return["statecode","statuscode"]};Microsoft.Crm.Client.Core.Offline.$2l.get_$3Iv=function(){return["activitypartyid","activityid!id","activityid!name","activityid!logicalname","participationtypemask","partyid!id","partyid!name","partyid!logicalname","ispartydeleted","partyobjecttypecode"]};Microsoft.Crm.Client.Core.Offline.$2l.$2Iy=function(n,t,i,r,u,f){var o=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.$2l,Microsoft.Crm.Client.Core.Framework.$4),e=new Microsoft.Crm.Client.Core.Offline.$2l(n,t,u,f),s=u.$l(n.$N.LogicalName);return!$0.$1(s)&&s.get_$8p()?Microsoft.Crm.Client.Core.Offline.$l.get_$6N().$31J(n).then(function(n){e.$1mz=n;e.$2X4(i,r);Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineQueryData_GetOfflineQueryDataObject",1005,"GetOfflineQueryDataObject completed succesfully");o.resolve(e)},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("OfflineQueryData_GetOfflineQueryDataObject - Failure",1005,n.$E);o.reject(n)}):(e.$2X4(i,r),Microsoft.Crm.Client.Core.Framework.$B.$C("OfflineQueryData_GetOfflineQueryDataObject",1005,"GetOfflineQueryDataObject completed succesfully"),o.resolve(e)),o.promise()};Microsoft.Crm.Client.Core.Offline.$2l.prototype={$1b:null,$67:null,$uu:0,$5b:null,$2X4:function(n,t){var r=new Array(0),a,v,i,f,u,s,h,c,e,l;for(r=this.$uu===1?(a=this.$67.$4P.toArray()).concat.apply(a,Microsoft.Crm.Client.Core.Offline.$2l.get_$2AX()):this.$67.get_fieldNames(),v=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(this.$1mz),i=0;i<r.length;i++)if(this.$67.$1Z[r[i]]===10){if(f=new Array(0),!$0.$1(this.$67.getValue(r[i])))for(var y=this.$67.getValue(r[i]).get_entities(),w=y.length,o=0;o<w;++o)u=y[o],s=u.hasField("activitypartyid")?u.getValue("activitypartyid"):Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),this.$uu===1&&u.hasValue("activitypartyid")&&s!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()&&v.contains(s.toString().toUpperCase())?f[f.length]=u.getValue("activitypartyid").toString().toUpperCase():this.$oM[this.$oM.length]=this.$2Rz(r[i],u,t.toString());this.$uu===1&&(this.$1Gj[this.$1Gj.length]=this.$3K5(t.toString().toUpperCase(),f.length>0?f:[""],r[i]))}else{h=Microsoft.Crm.Client.Core.Offline.$2c.$2IF(r[i],this.$67.$1Z[r[i]],this.$67.getValue(r[i]));for(c in h)e={key:c,value:h[c]},this.$3Q[this.$3Q.length]=e.key,this.$NH[this.$NH.length]=$0.$1(e.value)?"":e.value.toString()}if(this.$67.$N.LogicalName==="annotation"&&(this.$3Q[this.$3Q.length]="objecttypecode",this.$NH[this.$NH.length]=this.$67.getValue("objectid").TypeCode.toString()),$0.$1(this.$67.$N.$S5)||(this.$3Q[this.$3Q.length]="versionnumber",this.$NH[this.$NH.length]=this.$67.$N.$S5),this.$uu)this.$uu===1&&(this.$NH[this.$NH.length]=t.toString().toUpperCase());else if(n in this.$67.fields&&!$0.$1(this.$67.$N)&&!$0.$1(this.$67.$N.Id)&&this.$67.$N.Id!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()||(this.$3Q[this.$3Q.length]=n,this.$NH[this.$NH.length]=t.toString().toUpperCase()),l=this.$5b.$l(this.$67.$N.LogicalName),!$0.$1(l)&&l.get_$8p()){var b=new Xrm.Objects.EntityReference("activityparty",Microsoft.Crm.Client.Core.Framework.Guid.get_empty()),k=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)),p=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(b,{},{},{},{},k);p.initializeValue("partyid",this.$67.getValue("ownerid"),6);this.$oM[this.$oM.length]=this.$2Rz("owner",p,t.toString())}},$30f:function(n,t){var i=[],u,o,f,s,p,w,k,l,r;if(!t){u=Microsoft.Crm.Client.Core.Offline.$2l.get_$1kz();u.push.apply(u,Microsoft.Crm.Client.Core.Offline.$2l.get_$2Yj());for(var v=u,g=v.length,e=0;e<g;++e)o=v[e],n.hasValue(o)||(i[i.length]=o);f=this.$5b.$l(n.$N.LogicalName);!$0.$1(f)&&f.get_$8p()&&(n.hasValue("activitytypecode")||n.initializeValue("activitytypecode",f.$d,14),n.hasValue("isregularactivity")||(s={},s.value=this.$3AI(n.$N.LogicalName)?"1":"0",n.initializeValue("isregularactivity",Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1O.$1A(s),0)))}if(!t||t===1){for(var y=Microsoft.Crm.Client.Core.Offline.$2l.get_$2AX(),nt=y.length,h=0;h<nt;++h)p=y[h],i[i.length]=p;if(w=this.$5b.$2c(n.$N.LogicalName,"fullname"),!$0.$1(w))for(var b=n.$4P.toArray(),tt=b.length,c=0;c<tt;++c)if(k=b[c],Array.contains(Microsoft.Crm.Client.Core.Offline.$2t.$2EB,k)){n.initializeValue("fullname",Mscrm.InternalUtilities.$5T.$2tj(this.$1b.$1H.$1SJ,n.getValue("firstname"),n.getValue("middlename"),n.getValue("lastname")),14);n.$4P.add("fullname");break}}if(!t&&(l=this.$5b.$Fn(n.$N.LogicalName,null),!$0.$1(l)))for(var d=l,it=d.length,a=0;a<it;++a)r=d[a],(!$0.$1(r.$Aw)||!$0.$1(r.$DD))&&Array.indexOf(n.get_fieldNames(),r.$d)<0&&Array.indexOf(i,r.$d)<0&&(i[i.length]=r.$d);return i},$3AI:function(n){var t=this.$5b.$l(n);switch(t.$7u){case 4208:case 4209:case 4211:case 4206:case 4406:case 4251:return!1}return t.$19L?!0:!1},$2Rz:function(n,t,i){var r=t.getFieldObjectData("partyid"),u=this.$5b.$2c("activityparty","ispartydeleted"),f=t.hasField("activitypartyid")&&t.getValue("activitypartyid")!==Microsoft.Crm.Client.Core.Framework.Guid.get_empty()?t.getValue("activitypartyid"):Microsoft.Crm.Client.Core.Framework.Guid.newGuid(),e=[f.toString().toUpperCase(),i.toUpperCase(),this.$67.$N.Name,this.$67.$N.LogicalName,Microsoft.Crm.Client.Core.Offline.$2t.$1ZG[n].toString(),Microsoft.Crm.Client.Core.Framework.Guid.createFromObjectData(r.id).toString().toUpperCase(),$0.$1(r.name)?"":r.name.toString(),r.logicalname.toString(),!$0.$1(u)&&u.$Aw?"1":"0",this.$5b.$l(r.logicalname.toString()).$7u.toString()];return{entityreference:t.$N,columns:Microsoft.Crm.Client.Core.Offline.$2l.get_$3Iv(),values:e}},$3K5:function(n,t,i){return{activityid:n,participationtypemask:Microsoft.Crm.Client.Core.Offline.$2t.$1ZG[i].toString(),resolvedparties:t}}};Microsoft.Crm.Client.Core.Offline.$w=function(){};Microsoft.Crm.Client.Core.Offline.$w.get_$5=function(){return Microsoft.Crm.Client.Core.Offline.$w.$D||(Microsoft.Crm.Client.Core.Offline.$w.$D=new Microsoft.Crm.Client.Core.Offline.$w),Microsoft.Crm.Client.Core.Offline.$w.$D};Microsoft.Crm.Client.Core.Offline.$w.$28Z=function(n){var t="";switch(n){case 0:t="=";break;case 1:t="<>";break;case 2:t="<";break;case 3:t="<=";break;case 4:t=">";break;case 5:t=">=";break;case 6:t="ISNULL";break;case 7:t="IN"}return t};Microsoft.Crm.Client.Core.Offline.$w.$2jF=function(n){var t="";switch(n){case 1:t="OR";break;case 0:t="AND"}return t};Microsoft.Crm.Client.Core.Offline.$w.prototype={$1SM:function(n,t){for(var r,u="",f="",i=0;i<t.length;i++)r=i>0?",":"",u+=r+"["+t[i]+"]",f+=r+"?";return"INSERT INTO ["+n.LogicalName+"] ("+u+") VALUES ("+f+")"},$1oD:function(n,t,i){var u=n.LogicalName,f=new Microsoft.Crm.Client.Core.Framework.Storage.$88(new Microsoft.Crm.Client.Core.Framework.Storage.$4U(i),n.get_key()),e=new Microsoft.Crm.Client.Core.Framework.Storage.$NM(f,null),r=Microsoft.Crm.Client.Core.Storage.PhysicalAccess.Sql.$5i.$B(e,u,!0),o=$0.$1(t)?r.$205():r.$1c1.apply(r,t);return o+" COLLATE NOCASE"},$2EY:function(n,t,i){for(var u="UPDATE "+n.LogicalName+" SET ",r=0;r<t.length;r++)u+=(r>0?",":"")+"["+t[r]+"] = ?";return u+=" WHERE ["+i+"] = ?",u+" COLLATE NOCASE"},$2EJ:function(n,t){var i=t.$xj,r="DELETE FROM ["+n.LogicalName+"] ";return i&&i.length>0&&(r=r+"WHERE "+this.$2A1(i)+" COLLATE NOCASE"),r},$2tc:function(n,t){return"SELECT EXISTS(SELECT 1 FROM "+n.LogicalName+" WHERE ["+t+"] = ? LIMIT 1)"},$2tz:function(n,t,i){for(var o,u,s,f="",e="",r=0;r<t.length;r++)o=r>0?",":"",f+=o+"["+t[r]+"]";for(u=0;u<n;u++)s=u>0?" OR":"",e+=s+"["+i.$4S+"] = ?  COLLATE NOCASE";return"SELECT "+f+" FROM "+i.$d+" WHERE "+e},$2u1:function(n,t){var i=t.$xj,r="SELECT * FROM "+n;return i&&i.length>0&&(r=r+" WHERE "+this.$2A1(i)+this.$2lQ(t)+" COLLATE NOCASE"),r},$2lQ:function(n){var t="",i;return!$0.$1(n.$17O)&&n.$17O>0&&(i=$0.$1(n.$1Kr)?"":" OFFSET "+n.$1Kr.toString(),t+=" LIMIT "+n.$17O.toString()+i),t},$2A1:function(n){for(var r,e,u,f,i="",t=0;t<n.length;t++){if(r=n[t].$1MH?"":" (",e=n[t].$1MH===1?" )":"",i+=t?" "+Microsoft.Crm.Client.Core.Offline.$w.$2jF(n[t].$1gW)+r+" ["+n[t].$1d+"] "+Microsoft.Crm.Client.Core.Offline.$w.$28Z(n[t].$Hu):r+" ["+n[t].$1d+"] "+Microsoft.Crm.Client.Core.Offline.$w.$28Z(n[t].$Hu),n[t].$Hu===7){for(u=n[t].$53.get_Items().length,i+=u>0?"(?":"(",f=1;f<u;f++)i+=", ?";i+=")"}else n[t].$Hu!==6&&(i+=" ?");i+=e}return i},$2u0:function(n,t,i){for(var o,s,h,r="",f="",u="",e=0;e<n.length;e++)r+="["+n[e].$1F+"],";r=r!==""?r.substr(0,r.length-1):r;f="[activityid!id] = ?";o=t;for(s in o)h={key:s,value:o[s]},u+="?,";return u!==""&&(u=u.substr(0,u.length-1),f+=" AND [participationtypemask] in ("+u+")"),"SELECT "+r+" FROM "+i+" WHERE "+f+" COLLATE NOCASE ORDER BY [participationtypemask]"},$2tV:function(){return"DELETE FROM [activityparty] WHERE [activityid!id] = ? COLLATE NOCASE"},$2tW:function(n){for(var i="",t=n;t>0;t--)i+=t>1?"?,":"?";return"DELETE FROM [activityparty] WHERE [activityid!id] = ? AND [participationtypemask] = ?  AND [activitypartyid] NOT IN ("+i+") COLLATE NOCASE"},$3WV:function(n){for(var t="",i=n;i>0;i--)t+="?,";return t.length>1&&(t=t.substring(0,t.length-1)),"UPDATE [activityparty] SET [activityid!id] = ? WHERE [activityid!id] = ? AND [participationtypemask] = ?  AND [activitypartyid] IN ("+t+") COLLATE NOCASE"},$2tM:function(n,t,i,r,u){var e="CREATE VIEW activitypointer AS ",o=this.$1pm(n,t,r,u),f=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),s=new Microsoft.Crm.Client.Core.Storage.DataApi.$60("activitypointer".toLocaleLowerCase()),h=this;return i.$4o(s,t).then(function(n){h.$2u4(n,o,t,i).then(function(n){e+=n;f.resolve(e)},function(){f.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline DB could not create view query."))})},null),f.promise()},$2tL:function(n){var t="CREATE VIEW activityattachment AS ",r=Array.indexOf(n,"template")>-1,i=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4);return t+=this.$2u3(r),i.resolve(t),i.promise()},$2tY:function(n){return"DROP VIEW "+n},$2u4:function(n,t,i,r){for(var v,y,p,e=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),o="",u="",s="",l="",h=0,f=new Microsoft.Crm.Client.Core.Offline.$t,a=[],c=0;c<t.length;c++)v=new Microsoft.Crm.Client.Core.Storage.DataApi.$60(t[c].toString()),Array.add(a,r.$4o(v,i));return y=this,p=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(a).then(function(t){for(var k,v,i,y,r,p,c,d,g,w,a,it,nt,tt=t,rt=tt.length,b=0;b<rt;++b){for(k=tt[b],o="SELECT ",h=0,v=0;v<n.get_$3ZH();v++)if(i=n.get_$I(v),i.$2K!==17){for(y=0;y<k.get_$3ZH();y++)if(u="",r=k.get_$I(y),!$0.$1(r.$tf)&&r.$tf===i.$d){if(f.$tn(r.$2K))for(p=f.$1pu(r.$2K).$rk,c=0;c<p.get_$3B8().length;c++)d=p.get_$3B8()[c],g="["+r.$d+"!"+d+"] AS ["+i.$d+"!"+d+"]",u+=c!==p.get_$3B8().length-1?g+", ":g;else u+=r.$d+" AS "+i.$d;l=r.$S;break}if(!u.length&&f.$tn(i.$2K))for(w=f.$1pu(i.$2K).$rk,a=0;a<w.get_$3B8().length;a++)it=w.get_$3B8()[a],nt="NULL AS ["+i.$d+"!"+it+"]",u+=a!==w.get_$3B8().length-1?nt+", ":nt;else u.length||(u+="NULL AS "+i.$d);o+=h>0?", "+u:u;h++}s+=(s.length>0?" UNION ALL ":"")+o+" FROM "+l}e.resolve(s)},function(){e.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline DB could not create view query."))}),e.promise()},$2u3:function(n){return Microsoft.Crm.Client.Core.Framework.$3.$MN("select xxemail.activityid, xxattachment.body, xxattachment.filename, xxattachment.filesize, xxattachment.mimetype, xxattachment.subject,{0},{1},{2},{3},[xxactivitymimeattachment].[attachmentnumber],[xxactivitymimeattachment].[activitymimeattachmentid],[xxactivitymimeattachment].[versionnumber],[xxactivitymimeattachment].[attachmentid!id],[xxactivitymimeattachment].[attachmentid!name],[xxactivitymimeattachment].[attachmentid!logicalname],[xxactivitymimeattachment].[objectid!id],[xxactivitymimeattachment].[objectid!name],[xxactivitymimeattachment].[objectid!logicalname],[xxactivitymimeattachment].[objecttypecode],[xxactivitymimeattachment].[componentstate],[xxactivitymimeattachment].[overwritetime],[xxactivitymimeattachment].[solutionid],[xxactivitymimeattachment].[supportingsolutionid],[xxactivitymimeattachment].[activitymimeattachmentidunique],[xxactivitymimeattachment].[ismanaged],[xxactivitymimeattachment].[attachmentcontentid] from[activitymimeattachment][xxactivitymimeattachment] left join activitypointer xxemail on xxactivitymimeattachment.[objectid!id] = xxemail.activityid and xxemail.activitytypecode='email' {4} left join attachment xxattachment on xxactivitymimeattachment.[attachmentid!id] = xxattachment.attachmentid where datetime(xxactivitymimeattachment.overwritetime) = datetime('1900-01-01') and xxactivitymimeattachment.componentstate = 0","case when coalesce(xxemail.owneridtype, "+(n?"xxtemplate.owneridtype":'""')+") = 8 then coalesce(xxemail.[ownerid!id],"+(n?"xxtemplate.[ownerid!id]":'""')+") else null end as 'owninguser'","coalesce(xxemail.[ownerid!id], "+(n?"xxtemplate.[ownerid!id]":'""')+") as 'ownerid!id',coalesce(xxemail.[ownerid!logicalname], "+(n?"xxtemplate.[ownerid!logicalname]":'""')+") as 'ownerid!logicalname',coalesce(xxemail.[ownerid!name], "+(n?"xxtemplate.[ownerid!name]":'""')+") as 'ownerid!name'","coalesce(xxemail.owneridtype, "+(n?"xxtemplate.owneridtype":'""')+") as 'owneridtype'","coalesce(xxemail.[owningbusinessunit!id], "+(n?"xxtemplate.[owningbusinessunit!id]":'""')+") as 'owningbusinessunit!id',coalesce(xxemail.[owningbusinessunit!logicalname], "+(n?"xxtemplate.[owningbusinessunit!logicalname]":'""')+") as 'owningbusinessunit!logicalname',coalesce(xxemail.[owningbusinessunit!name], "+(n?"xxtemplate.[owningbusinessunit!name]":'""')+") as 'owningbusinessunit!name'",n?" left join template xxtemplate on xxactivitymimeattachment.[objectid!id] = xxtemplate.templateid":"")},$1pm:function(n,t,i,r){for(var s,u,f=[],o=r,h=o.length,e=0;e<h;++e)s=o[e],u=n.$l(s),!$0.$1(u)&&u.get_$8p()&&u.$d.toLowerCase()!=="activitypointer".toLowerCase()&&Array.indexOf(r,u.$d.toLowerCase())>=0&&($0.$1(i)||Array.indexOf(i,u.$d.toLowerCase())>=0)&&(f[f.length]=u.$d.toLowerCase());return f},$3OU:function(n){for(var t="",i=n;i>0;i--)t+="?,";return t!==""&&(t=t.substr(0,t.length-1)),"SELECT MIN(lastdatasynctime) AS [lastdatasynctime] FROM entitysettings WHERE entitylogicalname IN ("+t+") COLLATE NOCASE"},$1SO:function(){return Microsoft.Crm.Client.Core.Offline.$w.$2Z2},$1SP:function(){return Microsoft.Crm.Client.Core.Offline.$w.$2Z1}};Microsoft.Crm.Client.Core.Offline.$IA=function(n){this.$1K4=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.$ID));this.$21j=n};Microsoft.Crm.Client.Core.Offline.$IA.prototype={$21j:!1,$2cc:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$ID;i.$RT=n;i.$1KL=t;i.$14I="Create";this.$1K4.add(i)},$2dz:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$ID;i.$RT=n;i.$1KL=t;i.$14I="Update";this.$1K4.add(i)},$2ci:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.$ID;i.$RT=n;i.$Yp=t;i.$14I="Delete";this.$1K4.add(i)}};Microsoft.Crm.Client.Core.Offline.$ID=function(){};Microsoft.Crm.Client.Core.Offline.$ID.prototype={$RT:null,$1KL:null,$Yp:null,$14I:null};Microsoft.Crm.Client.Core.Offline.$I6=function(n,t){var i,f,r,u,e,o,s;if(this.$61=[],this.$m0=[],$0.$1(t)){u=0;e=n;for(o in e)s={key:o,value:e[o]},this.$61[u]=s.key,this.$m0[u]=this.$11a(s.value),u++}else for(i=0;i<t.length;i++)if(t[i].$Hu===7)for(f=t[i].$53,r=0;r<f.get_Items().length;r++)this.$m0.push(this.$11a(f.get_Items()[r]));else this.$m0.push(this.$11a(t[i].$53))};Microsoft.Crm.Client.Core.Offline.$I6.prototype={$11a:function(n){return Microsoft.Crm.Client.Core.Framework.Guid.isInstanceOfType(n)?n.toString():n}};Microsoft.Crm.Client.Core.Offline.$4b=function(){};Microsoft.Crm.Client.Core.Offline.$4b.get_$6N=function(){return $0.$1(Microsoft.Crm.Client.Core.Offline.$4b.$3)&&(Microsoft.Crm.Client.Core.Offline.$4b.$3=new Microsoft.Crm.Client.Core.Offline.$4b),Microsoft.Crm.Client.Core.Offline.$4b.$3};Microsoft.Crm.Client.Core.Offline.$4b.prototype={$2Yq:function(n){var t=this,i=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p().$3Pv(n,"MaxTime").then(function(){Microsoft.Crm.Client.Core.Framework.$B.$C("SecurityUtil",1005,"StoreMaxDate: New Date is "+n)},function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtilFailureErrors",1005,"StoreMaxDate Error: "+n.$E.toString())})},$3Od:function(){var n=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p().$3Of("MaxTime").then(function(t){Microsoft.Crm.Client.Core.Framework.$B.$C("SecurityUtil",1005,"RetrieveMaxDate: "+t);n.resolve(t)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtilFailureErrors",1005,"RetrieveMaxDate Error: "+t.$E.toString());n.reject(t)}),n.promise()},$39T:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return this.$3Od().then(function(i){Microsoft.Crm.Client.Core.Framework.$3.$9(i)&&(i=null);t.$26b(i).then(function(t){Microsoft.Crm.Client.Core.Framework.$3.$9(i)||(i=Xrm.Soap.CrmDateTimeSerializer.$14V(i));!$0.$1(t)&&t>new Date(i)?n.resolve(!0):n.resolve(!1)},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtilFailureErrors",1005,"IsFullSyncRequired: CalculateAndStoreMaxDate Error: "+t.$E.toString());n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtilFailureErrors",1005,"IsFullSyncRequired: RetrieveMaxDate Error: "+t.$E.toString());n.reject(t)}),n.promise()},$26b:function(n){var t=MscrmComponents.DeferredPromiseFactory(Date,Microsoft.Crm.Client.Core.Framework.$4),u=new Array(0),i=n;$0.$1(n)||(n=Xrm.Soap.CrmDateTimeSerializer.$14V(n),u[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("CreatedOn",i,1,4));var r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(u),f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p,e=this,o=this;return f.$6I("UserEntityAttributeMap",r).then(function(r){var o=new Date(n),u,f,s;if(r.rows.length>0)for(u=0;u<r.rows.length;u++)$0.$1(r.rows.item(u))||(f=r.rows.item(u).CreatedOn,Microsoft.Crm.Client.Core.Framework.$3.$9(f)?Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtil",1005,"CalculateAndStoreMaxDate date is not stored for row: "+u):(s=new Date(Xrm.Soap.CrmDateTimeSerializer.$14V(f)),o<s&&(o=s,i=f)));e.$2Yq(i);t.resolve(o)},function(i){if($0.$1(n))Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtilFailureErrors",1005,"CalculateAndStoreMaxDate retrieve data was null Error: "+i.$E.toString()),t.reject(i);else{var u=new Array(0);r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(u);f.$6I("UserEntityAttributeMap",r).then(function(){Microsoft.Crm.Client.Core.Framework.$B.$1E("SecurityUtil",1005,"CalculateAndStoreMaxDate retrieve data Error: "+i.$E.toString());t.reject(i)},function(){t.resolve(new Date);o.$2Yq("1970-01-01 00:00:00.000")})}}),t.promise()}};Microsoft.Crm.Client.Core.Offline.$5b=function(){};Microsoft.Crm.Client.Core.Offline.$5b.$zg=function(n,t,i,r,u,f,e,o,s,h,c,l){var b=Microsoft.Crm.Client.Core.Offline.$5b.$31G(h),k=b!==1&&t.toLowerCase()!=="create"?new Xrm.Objects.EntityReference(n,i,r):null,a={},v={},y=new Array(0),w,p;return y.push("name"),a.name=14,v.name=n,y.push("action"),a.action=14,v.action=t,$0.$1(k)||(y.push("regardingobjectid"),a.regardingobjectid=6,v.regardingobjectid=k,y.push("regardingobjectidname"),a.regardingobjectidname=14,v.regardingobjectidname=r,y.push("regardingobjecttypecode"),a.regardingobjecttypecode=20,v.regardingobjecttypecode=u),y.push("errormessage"),a.errormessage=14,v.errormessage=Microsoft.Crm.Client.Core.Offline.$5b.$2Zk("errormessage",f),y.push("actiondata"),a.actiondata=14,v.actiondata=e,y.push("errortime"),a.errortime=2,v.errortime=o,y.push("requestdata"),a.requestdata=14,v.requestdata=s,y.push("errorcode"),a.errorcode=14,v.errorcode=h.toString(),w={},w.value=b,y.push("errortype"),a.errortype=11,v.errortype=Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$1O.$1A(w),y.push("errordetail"),a.errordetail=14,v.errordetail=Microsoft.Crm.Client.Core.Offline.$5b.$2Zk("errordetail",c),p=l,$0.$1(p)&&(p=new Xrm.Objects.EntityReference("syncerror",Microsoft.Crm.Client.Core.Framework.Guid.newGuid())),new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord(p,v,a,{},{},new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.RelatedEntityCollection(new Array(0)))};Microsoft.Crm.Client.Core.Offline.$5b.$31G=function(n){var t;switch(n){case-2147220969:t=1;break;case-2147220685:case-2147220937:t=2;break;case-2147088254:case-2147088253:t=0;break;default:t=3}return t};Microsoft.Crm.Client.Core.Offline.$5b.$2Zk=function(n,t){var i=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c("syncerror",n);return!$0.$1(i)&&!$0.$1(t)&&t.length>i.$LG?t.substring(0,i.$LG):t};Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider=function(n){this.$Ac=n;this.$1GD=Microsoft.Crm.Client.Core.Storage.DataApi.$H.get_$5().$3O;this.$69=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld();this.$Pw=new Microsoft.Crm.Client.Core.Framework.$OA("OfflineSyncErrorLogProvider.BatchedCallbackRunner",Microsoft.Crm.Client.Core.Framework.SchedulerPriorities.$1XE)};Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider.prototype={$69:null,$Pw:null,$1GD:null,$Ac:null,$2ll:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Xrm.Objects.EntityReference,Microsoft.Crm.Client.Core.Framework.$4),r=this,u=this;return this.$Ac.get_$6V().$B(n,!0,t).then(function(n){Microsoft.Crm.Client.Core.Framework.$B.$1E("MOCADataSyncFailureErrors",1005,"CreateOfflineSyncErrorLog Success");i.resolve(n)},function(t){var r=new Microsoft.Crm.Client.Core.Framework.TelemetryCore.$Ok("MOCADataSyncFailureErrors","","",0,"",n.get_key().toString()+" "+t.$E.toString(),Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),(new Date).toString(),"",0);Microsoft.Crm.Client.Core.Framework.TelemetryCore.TelemetryReporter.get_Instance().$1f(r);Microsoft.Crm.Client.Core.Framework.$B.$1E("MOCADataSyncFailureErrors",1005,"CreateOfflineSyncErrorLog Error: "+t.$E.toString());i.reject(t)}),i.promise()},$1bi:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(String,Microsoft.Crm.Client.Core.Framework.$4),r=this,u=this;return this.$Ac.$RK(n,t,!0).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise()},$XB:function(n){return this.$Ac.$XB(n)},$2Ma:function(){return!$0.$1(this.$Ac)&&!$0.$1(this.$Ac.get_$6V())&&this.$Ac.get_$6V().get_$3H()}};Microsoft.Crm.Client.Core.Offline.$I9=function(n){this.$1dh=n};Microsoft.Crm.Client.Core.Offline.$I9.prototype={$1dh:0};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N=function(){this.$18()};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.prototype={$18:function(){Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(15),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(0),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(14),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(11),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(12),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(13),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(20),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ug,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$rK,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ue,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$sO,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$uf,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(1),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(6),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$1mZ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$1vA]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(9),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.In,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$aB,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$1mZ,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$1vA,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$2Bk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$2Bj]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(5),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(18),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(4),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(3),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(8),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))([Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]));Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.set_$I(this.$7E(2),new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["on-or-after","on","on-or-before","today","tomorrow","yesterday","next-seven-days","last-seven-days","next-week","last-week","this-week","next-month","last-month","this-month","next-year","last-year","this-year","last-x-days","next-x-days","last-x-weeks","next-x-weeks","last-x-months","next-x-months","last-x-years","next-x-years","not-null",Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.Null,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Jo,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$GN,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$He,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$ZL,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$mj,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$Zk,Microsoft.Crm.Client.Core.Storage.Common.FetchExpression.$J.$na]))},$7E:function(n){return Xrm.Objects.AttributeType.toString(n)},get_$25w:function(){return Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG.$1e4()}};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$QY=function(){Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$QY.initializeBase(this);this.$Ev=new Microsoft.Crm.Client.Core.Offline.$t;this.$EG=new Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$QY.prototype={$Ev:null,$EG:null,$2cU:function(n,t,i){this.$16f(n,"attributeName");this.$16f(t,"entityName");var r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c(t,n);this.$16f(r,Microsoft.Crm.Client.Core.Framework.$3.$MN("attributeMetadata: {0}.{1}",t,n));this.$Ev.$tn(r.$2K)&&this.$2cV(n,r,t,i)},$2cV:function(n,t,i,r){for(var f,o=Microsoft.Crm.Client.Core.Offline.$2c.$1TQ(n,t.$2K),s=this.$11U(n,i),e=o,h=e.length,u=0;u<h;++u)f=e[u],f!==s&&this.$B8.get_$wA().append(Microsoft.Crm.Client.Core.Framework.$3.$MN("{0} [{1}].[{2}] as [{2}]",Microsoft.Crm.Client.Core.Framework.$3.$9(this.$B8.get_$wA().toString())?"":",",r,f))},$3VV:function(n){if(!Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$78.$1sD(n))throw Error.create(Microsoft.Crm.Client.Core.Framework.$3.$MN("Attribute type {0} for attribute {1} not supported in offline",n.$2K,n.$d));},$11U:function(n,t){if($0.$1(n)||$0.$1(t))throw Error.create("Attribute name or entity name cannot be null or undefined");var i=null,r,u;return n=(u=Microsoft.Crm.Client.Core.Storage.Common.$1N.$10w(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V(),t,n,r={val:i}),i=r.val,u),n.endsWith("]")&&n.startsWith("[")&&(n=n.substring(1,n.length-1)),n},$3Va:function(n,t,i){var r,u;if($0.$1(n)||$0.$1(t))throw Error.create("Attribute name or entity name cannot be null or undefined");if(r=Microsoft.Crm.Client.Core.Storage.Common.QueryGenerator.$2d.$2c(n,t),!$0.$1(r)&&Xrm.Objects.AttributeType.toString(r.get_$5R())in this.$EG.get_$25w()&&(u=this.$EG.get_$25w()[Xrm.Objects.AttributeType.toString(r.get_$5R())],!u.contains(i)))throw Error.create(Microsoft.Crm.Client.Core.Framework.$3.$MN("Condition Operation {0} is not supported on Attribute Type {1}",i,Xrm.Objects.AttributeType.toString(r.get_$5R())));return},$2Ii:function(n,t,i,r,u){var f=new Sys.StringBuilder;return f.append(String.format('\n left outer join {0} as "{1}" on ("{1}".[ObjectId!id] = "{2}".{3} and "{1}".LanguageId = {4} and "{1}".{5} like "%{6}%" )',"businessdatalocalizedlabel",r,n,t,i,"objectcolumnname",u)),f}};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$78=function(){};Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$78.$1sD=function(n){var t=!0;return Microsoft.Crm.Client.Core.Offline.$1F.$1VO(n.$2K)&&$0.$1(n.$Pv)||(t=!1),t};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Hz=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Hz.registerInterface("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Hz");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se.initializeBase(this,[n]);this.$KJ=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se.prototype={$B:function(n,t){this.$KJ.$B(n,t)},$6I:function(n,t){return this.$KJ.$6I(n,t)},$7p:function(n,t){this.$KJ.$7p(n,t)},Delete:function(n,t){this.$KJ.Delete(n,t)},$26D:function(n){this.$KJ.$26D(n)},Commit:function(n){return this.$KJ.Commit(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p.$2Rc=function(n,t){for(var i,f,u,e,o,r=0;r<n.get_Count();r++)i=n.get_$I(r),i.$uv===1?Object.isInstanceOfType(i.$55)&&(f=i.$55,t.$B(i.$JN,f)):i.$uv===2?(u=i.$55,u&&(e=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(u),t.Delete(i.$JN,e))):i.$uv===3&&Object.isInstanceOfType(i.$55)&&(o=i.$55,t.$7p(i.$JN,o))};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p.prototype={$oR:function(n,t,i){var f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa,r=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se(f);r.$26D(i);!$0.$1(t)&&t.get_Count()>0&&Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p.$2Rc(t,r);!$0.$1(n)&&n.get_Count()>0&&Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p.$2Rc(n,r);var u=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),e=this,o=this;return r.Commit(f.$AP).then(function(){u.resolve(!0)},function(n){u.reject(n)}),u.promise()},$6I:function(n,t){var i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa;return i.$6I(n,t)},$10y:function(){var n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p().get_$6V();return n.$10y()},$2jG:function(n,t,i,r){var u=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$4),f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i),e=this,o=this;return this.$316(i,f,n,t,r).then(function(n){u.resolve(n)},function(n){u.reject(n)}),u.promise()},$316:function(n,t,i,r,u){var e=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityRecord,Microsoft.Crm.Client.Core.Framework.$4),f,c,l,o,s,a,h,v,y;if($0.$1(i)||Microsoft.Crm.Client.Core.Framework.$3.$9(i[t.$4S]))e.resolve(null);else{f=new Array(0);c=i;for(l in c)o={key:l,value:c[l]},s=o.key.toLowerCase(),s.indexOf("norsync")<0&&s.toLowerCase()!=="_MODIFIED_ON".toLowerCase()&&(s.indexOf("!")<0?f.push(o.key):(a=o.key.split("!"),h=Microsoft.Crm.Client.Core.Framework.$3.$9(a[0])?"":a[0],Microsoft.Crm.Client.Core.Framework.$3.$9(h)||Array.indexOf(f,h)!==-1||f.push(h)));v=this;y=this;Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$TG(n,f).then(function(n){var o=u!==3?i:r,s=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.$23(2,0),f=Microsoft.Crm.Client.Core.Offline.$1F.$zg(o,n,t,s);f=Microsoft.Crm.Client.Core.Offline.$1F.$3JT(f,n,u,i,r);e.resolve(f)},function(){e.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline DB could not retrieve data"))})}return e.promise()}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa=function(){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa.initializeBase(this);this.$aE=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p().get_$6V()};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa.prototype={$AP:null,$aE:null,$B:function(n,t){this.$AP.$2cc(n,t)},$6I:function(n,t){return this.$aE.$1bI(n,t)},$7p:function(n,t){this.$AP.$2dz(n,t)},Delete:function(n,t){this.$AP.$2ci(n,t)},$26D:function(n){this.$AP=new Microsoft.Crm.Client.Core.Offline.$IA(n)},Commit:function(n){return this.$aE.$2pc(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$II=function(){};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ.initializeBase(this);this.$KJ=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ.prototype={$KJ:null};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c=function(n,t,i){this.$55=n;this.$uv=t;this.$JN=i};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c.prototype={$55:null,$uv:0,$JN:null,get_entity:function(){return this.$55},set_entity:function(n){return this.$55=n,n},get_operationPerformed:function(){return this.$uv},set_operationPerformed:function(n){return this.$uv=n,n},get_entityType:function(){return this.$JN},set_entityType:function(n){return this.$JN=n,n}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM=function(n,t,i,r,u){this.$1d=n;this.$53=t;this.$1gW=i;this.$Hu=r;this.$1MH=$0.$1(u)?2:u};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM.prototype={$1d:null,$53:null,$1gW:0,$Hu:0,$1MH:0};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd=function(n){Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd.initializeBase(this,[n]);this.$KJ=n};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd.prototype={$B:function(n,t){this.$KJ.$B(n,t)},$6I:function(n,t){return this.$KJ.$6I(n,t)},$7p:function(n,t){this.$KJ.$7p(n,t)},Delete:function(n,t){this.$KJ.Delete(n,t)},$26D:function(n){this.$KJ.$26D(n)},Commit:function(n){return this.$KJ.Commit(n)}};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL=function(n,t,i){this.$xj=n;$0.$1(i)||(this.$1Kr=i);$0.$1(t)||(this.$17O=t)};Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL.prototype={$1Kr:0,$17O:0,$xj:null};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$I7=function(n){this.$lp=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Xrm.Objects.EntityReference));this.$Dg=n;this.$Xk=!1;this.$BC=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v));this.$qc=[];this.$yM={};this.$qs=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Number));this.$192=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Number));this.$q8=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String));this.$Ro=Microsoft.Crm.Client.Core.Framework.Guid.get_empty()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$I7.prototype={$Dg:null,$BC:null,$yM:null,$JG:0,$2Z9:3,$qs:null,$Ro:null,$192:null,$q8:null,$qc:null,$Xk:!1,$2S4:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,i;if(this.$Xk)Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.NetworkFailure","ProcessPlaybackQueue Stopped"),Array.clear(this.$qc),n.resolve(!1);else if(this.$qc.length){var r=Array.dequeue(this.$qc),u=this,f=this;this.$2SF(r,0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Success","BatchItem Processed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Failure",t.$E);n.reject(t)})}else this.$qs.get_Count()>0&&this.$Dg.$27X(this.$qs,this.$q8,this.$Ro),t=this,i=this,this.$1Zf(!0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Success","ProcessPlaybackQueue Completed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessBatchForUpSync.Failure",t.$E);n.reject(t)});return n.promise()},$2SF:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList","ProcessUpSyncDataList Started"),$0.$1(n)||n.get_Count()===t||this.$Xk?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Success","ProcessUpSyncDataList Completed"),i.resolve(!0)):(r=this,u=this,this.$3Ki(n.get_Items()[t]).then(function(){r.$2SF(n,++t).then(function(){i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Failure",n.$E);i.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataList.Failure",n.$E);i.reject(n)})),i.promise()},$3Ki:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i,r;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Started","ProcessUpSyncDataList Started"),$0.$1(n)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed"),t.resolve(!0)):(i=this,r=this,this.$2pQ(n).then(function(r){r&&!i.$Xk?n.get_$kr()?i.$3KW(n).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$E);t.reject(n)}):i.$3KK(n).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$E);t.reject(n)}):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Success","ProcessUpSyncDataList Completed"),t.resolve(!0))},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessUpSyncDataItem.Failure",n.$E);t.reject(n)})),t.promise()},$2pQ:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i,r;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired","ExecuteActionDataListIfRequired Started"),i=n.get_$Ps().$Xp,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$21G().contains(i))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Success","ExecuteActionDataListIfRequired Completed"),this.$19V(n.get_$Ps()),t.resolve(!1);else{if(n.get_$kr())return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Non-CRUDActionEncountered","ExecuteActionDataListIfRequired Completed"),this.$1Zf(!0);if(r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(n.get_$Ps()),r!=="activityparty"&&this.$BC.get_Count()===Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance().get_$1XR())return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ExecuteActionDataListIfRequired.Success","ExecuteActionDataListIfRequired Completed"),this.$1Zf(!0);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.CheckActionDataListForExecution.Success","CheckActionDataListForExecution Completed");t.resolve(!0)}return t.promise()},$3KK:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem","ProcessCRUDItem Started"),i=n.$E8.$N.LogicalName,i==="activityparty")Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem.Success","ProcessCRUDItem Completed"),this.$35W(n),t.resolve(!0);else return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessCRUDItem.Success","ProcessCRUDItem Completed"),this.$BC.add(n),this.$1Zf(!1);return t.promise()},$1Zf:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4);return(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList","ProcessActionDataList Started"),this.$BC.get_Count()>0&&(n||this.$BC.get_Count()===Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance().get_$1XR()&&!this.$39h()))?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList.Success","CRUD Criteria satisfied for Execution"),this.$3KJ(),this.$282(0).always(this.$2KF())):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataList.Success","ProcessActionDataList Completed"),t.resolve(!0),t.promise())},$3KJ:function(){var r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String)),i,n,t;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessCrudCommandAction","ProcessCrudCommandAction Started"),i=0;i<this.$BC.get_Count();i++)(n=this.$BC.get_Items()[i],$0.$1(n))||(r.contains(n.$E8.get_key())?"versionnumber"in n.$E8.fields&&(delete n.$E8.fields.versionnumber,n.$qt===2&&(n.$E8.$N.$S5="")):(t=n.$E8.get_key(),r.add(t),t in this.$yM&&(n.$E8.initializeValue("versionnumber",this.$yM[t].toString(),14),n.$E8.$N.$S5=this.$yM[t].toString(),n.$E8.$4P.remove("versionnumber"))));Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessCrudCommandAction.Success","ProcessCrudCommandAction Completed")},$39h:function(){var t=this.$BC.get_Items()[this.$BC.get_Count()-1],i,n;return $0.$1(t)?!1:(i=t.$E8.$N.LogicalName,n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i),!$0.$1(n)&&n.get_$8p()?!0:!1)},$35W:function(n){var t,i,e,o;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleActivityParty","HandleActivityParty Started"),t=this.$BC.get_Count()-1,t>=0&&!$0.$1(this.$BC.get_Items()[t])&&(i=this.$BC.get_Items()[t],!$0.$1(i))){var r=i.$E8,u=n.$E8,f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(r.$N.LogicalName);!$0.$1(f)&&f.get_$8p()&&(i.$bf.add(n),r.hasField("activityid")&&(e=u.getValue("activityid"),o=r.getValue("activityid"),e.Id.toString()===o.toString()&&this.$2cL(u,r)))}Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleActivityParty","HandleActivityParty Completed")},$2cL:function(n,t){var u=n.getValue("participationtypemask"),i=Microsoft.Crm.Client.Core.Offline.$2t.$1Gi[u.$1i.toString()],r;Microsoft.Crm.Client.Core.Framework.$3.$9(i)||(t.hasField(i)&&!$0.$1(t.getValue(i))?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.AddActivityPartyToActivity","Adding activity part to activity "+t.getValue("activitytypecode")),r=t.getValue(i),r.add(n)):(t.initializeValue(i,new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityCollection([n],!1,1,!1),10),t.$4P.add(i)))},$3KW:function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessNonCRUDItem","ProcessNonCRUDItem Started"),this.$BC.add(n),this.$282(n.get_$kr()).always(this.$2KF())},$282:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4);return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.CommandExecutor.Success","CommandExecutor Started"),n===2?Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.get_$5().$3Xo(this.$BC).then(this.$36O(t),this.$2KG(t)):Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.get_$5().$XU(n,this.$BC).then(this.$36N(n,t),this.$2KG(t)),t.promise()},$2KF:function(){var n=this;return function(){n.$Ro=Microsoft.Crm.Client.Core.Framework.Guid.get_empty();n.$BC.clear();n.$qs.clear();n.$q8.clear();n.$192.clear()}},$36N:function(n,t){var i=this;return function(r){i.processSuccessResponse(n,r).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleSuccessResponse.Success","Command Execution succeeded");n?i.$1xd().then(function(){t.resolve(!0)},function(n){t.reject(n)}):t.resolve(!1)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.HandleSuccessResponse.Fail",n.$E);t.reject(n)})}},$36O:function(n){var t=this;return function(i){t.processSuccessJsonResponse(i).then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleSuccssJSonResponse.Success","Command Execution succeeded");i?t.$1xd().then(function(){n.resolve(!0)},function(t){n.reject(t)}):n.resolve(!1)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.HandleSuccssJSonResponse.Fail",t.$E);n.reject(t)})}},$2KG:function(n){var t=this;return function(i){t.processFailureResponse(i).then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleCrmErrorResponse.Success","Command Execution succeeded");i?t.$1xd().then(function(){n.resolve(!0)},function(t){n.reject(t)}):n.resolve(!1)},function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.HandleCrmErrorResponse.Failure",i.get_message());n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i(i.get_message()))})}},processFailureResponse:function(n){var t,r,u,i,f,e,o;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Start","Processing Failure Response Started"),t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),$0.$1(n)||$0.$1(n.$By))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded with no response"),t.resolve(!0);else if(n.$By.status&&n.$By.status!==503){for(r=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2,!$0.$1(n.$6k)&&!$0.$1(n.$6k.get_message())&&n.$6k.$Cq.get_Count()>0&&(n.$6k.$Cq.get_Items()[0]=n.$By.responseText),r=this.$26X(n.$6k),u=[],i=this.$BC.get_Count()-1;i>=0;i--)this.$2Mz(this.$BC.get_Items()[i])?(this.$2OG(this.$BC.get_$I(i).get_$Ps().$J5),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Warning","One Sync Error Entity Failed to Upsync")):(f=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e(this.$Dg),Array.add(u,f.$1U8(this.$BC.get_Items()[i],r)));e=this;o=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(u).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Fail",n.$E);t.reject(n)})}else Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessFailureResponse.Success","Processing Failure Response succeeded with unknown status"),this.$Xk=!0,t.resolve(!1);return t.promise()},processSuccessResponse:function(n,t){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),s,e,i,c,l,a,p;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse","ProcessSuccessResponse Started");this.$JG=0;this.$lp=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(Xrm.Objects.EntityReference));var u=[],f=t,v=f.responses.length;if(v||(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Command Execution Succeeded At Server"),r.resolve(!0)),f.isFaulted)for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.ServerFailure","Few Command Execution failed At Server"),e=f.responses.length-1;e>=0;e--)i=f.responses[e],!$0.$1(i.$G7)&&!$0.$1(i.$G7.$Cq)&&!$0.$1(i.$G7.$Cq.get_Items())&&i.$G7.$Cq.get_Count()>0?(c=this.$26X(i.$G7),$0.$1(this.$BC.get_Items()[i.$S3])||(this.$2Mz(this.$BC.get_Items()[i.$S3])?this.$2OG(this.$BC.get_Items()[i.$S3].get_$Ps().$J5):(l=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e(this.$Dg),Array.add(u,l.$1U8(this.$BC.get_Items()[i.$S3],c))))):Array.add(u,this.processSuccessMultipleResponseItem(n,this.$BC.get_Items()[i.$S3],i));else{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Command Execution Succeeded At Server");for(var h=f.responses,y=h.length,o=0;o<y;++o)s=h[o],Array.add(u,this.processSuccessMultipleResponseItem(n,this.$BC.get_Items()[s.$S3],s))}return u.length?(a=this,p=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(u).then(function(){a.$3Kb().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Success","Processing Success Response succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Fail",n.$E);r.reject(n)})},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessSuccessResponse.Fail",n.$E);r.reject(n)})):r.resolve(!0),r.promise()},processSuccessMultipleResponseItem:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),u,e,f;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem","ProcessSuccessMultipleResponseItem Started"),n===1&&i.$Ap.name==="Retrieve")Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","ProcessSuccessMultipleResponseItem Completed"),u=i.$Ap.entity,$0.$1(u.$N.$S5)||this.$lp.set_$I(u.get_key(),u.$N),r.resolve(!0);else if(e=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2,$0.$1(t)||$0.$1(t.get_$Ps()))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","Empty Data"),r.resolve(!1);else{f=t.get_$Ps().$J5;f.toString()in Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()&&delete Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()[f.toString()];var s=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX(this.$Dg),o=this,h=this;s.$1U8(t,e).then(function(){var u,f;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Success","ProcessSuccessMultipleResponseItem Completed");n||(t.get_$Ps().$c2===1||t.get_$Ps().$c2===3)&&(i.$Ap.name==="Create"&&(u=i.$Ap.entityReference,o.$lp.set_$I(u.Id.toString(),u)),i.$Ap.name==="Update"&&(f=i.$Ap.entityReference,o.$lp.set_$I(f.Id.toString(),f)));r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessMultipleResponseItem.Failure",n.$E);r.reject(n)})}return r.promise()},processSuccessJsonResponse:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse","ProcessSuccessJsonResponse Started"),i=this.$BC.get_Items()[0],n.$9G)Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.Success ","Command Execution Succeeded At Server Processed Sucessfully"),t.resolve(!0);else if($0.$1(i.get_$Ps()))Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.Success ","Command Execution Succeeded At Server Processed Sucessfully"),t.resolve(!1);else{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Start ","Command Execution Failed At Server Processing Started");var r=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2,u=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX(this.$Dg),f=this,e=this;u.$1U8(i,r).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Success ","Command Execution Failed At Server Processed Sucessfully");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessSuccessJsonResponse.ServerFailure.Fail ",n.$E);t.reject(n)})}return t.promise()},$3Kb:function(){var t,n,u;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Start","Process Returned Row Versions Started");t=[];n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4);this.$lp.$m()||(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Success","Process Returned Row Versions succeeded"),n.resolve(!0));for(var r=this.$lp.get_$3B8(),e=r.length,i=0;i<e;++i)u=r[i],Array.add(t,this.$3XU(u));var f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c)),o=this,s=this;return Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(t).then(function(t){for(var r,e,u=t,s=u.length,i=0;i<s;++i)r=u[i],$0.$1(r)||(e=r,f.addRange(e.get_Items()));o.$Dg.$oR(f,null,!0).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Success","Updation of Row Version Succeeded");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Fail",t.$E);n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.ProcessReturnedRowVersions.Fail",t.$E);n.reject(t)}),n.promise()},$3XU:function(n){var i,t,r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Start","Updation of Row Version started"),i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c),Microsoft.Crm.Client.Core.Framework.$4),t=this.$lp.get_$I(n),$0.$1(t)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Success","Updation of Row Version Succeeded"),i.resolve(null)):(r=this,u=this,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$76(t.LogicalName,Microsoft.Crm.Client.Core.Framework.$G.$b(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld(),"PlaybackBatchManager")).then(function(n){var u,f;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Success","Updation of Row Version Succeeded");u={};u.versionnumber=t.$S5;u[n.get_$Hj()]=t.get_identifier();r.$yM[t.get_key()]=t.$S5;f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c))([new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(u,3,t.LogicalName),new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(u,3,"_NORSYNC_LOG_"+t.LogicalName)]);i.resolve(f)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackBatchManager.UpdateRowVersion.Fail",n.$E);i.reject(n)})),i.promise()},$26X:function(n){var i=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2,r,t,u,f;return i.$1LF=!$0.$1(n)&&!$0.$1(n.$15H)?n.$15H.get_$7Y():"",$0.$1(n)||$0.$1(n.$Cq)?(i.$E="",i.$xg=new Date):(r=Sys.Net.XMLDOM(n.$Cq.get_Items()[0]),r?(t=Microsoft.Crm.Client.Core.Storage.Common.Xml.$A.$B(r),t.$3G("d","http://schemas.microsoft.com/xrm/2011/Contracts/Services"),t.$3G("a","http://schemas.microsoft.com/xrm/2011/Contracts"),t.$3G("b","http://schemas.datacontract.org/2004/07/System.Collections.Generic"),t.$3G("c","http://schemas.microsoft.com/xrm/2012/Contracts"),t.$3G("i","http://www.w3.org/2001/XMLSchema-instance"),i.$z=$0.$1(t.$O(".//a:ErrorCode"))?$0.$1(n.$6e)?-1:n.$6e:Number.parseInvariant(t.$O(".//a:ErrorCode").get_$u()),i.$E=$0.$1(t.$O(".//a:Message"))?Microsoft.Crm.Client.Core.Framework.$3.$9(n.get_message())?"":n.get_message():t.$O(".//a:Message").get_$u(),u=$0.$1(t.$O(".//a:Timestamp"))?"":t.$O(".//a:Timestamp").get_$u(),f=Microsoft.Crm.Client.Core.Framework.$3.$9(u)?new Date:new Date(Date.parse(u.toString())),i.$xg=f):(i.$E=n.get_message(),i.$xg=new Date)),i},$1xd:function(){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n,f,e;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete","ProcessActionDataListToDelete Started");for(var r=this.$BC.get_Items(),u=r.length,i=0;i<u;++i){n=r[i];switch(n.get_$kr()){case 0:this.$3KL(n);break;case 2:case 1:this.$3KX(n)}}return f=this,e=this,this.$Dg.$27X(this.$qs,this.$q8,this.$Ro).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete.Success","ProcessActionDataListToDelete Completed");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackBatchManager.ProcessActionDataListToDelete.Failure","ProcessActionDataListToDelete Failed");t.reject(n)}),t.promise()},$3KL:function(n){var i;if(this.$19V(n.$UZ),!$0.$1(n.$bf))for(var r=n.$bf.get_Items(),u=r.length,t=0;t<u;++t)i=r[t],$0.$1(i)||this.$19V(i.$UZ)},$3KX:function(n){var r;if(this.$19V(n.$UZ),!$0.$1(n.$ps)){this.$Ro=n.$Ro;for(var i=n.$ps.get_Items(),u=i.length,t=0;t<u;++t)r=i[t],this.$19V(r)}},$19V:function(n){$0.$1(n)||this.$192.contains(n.$J5)||(this.$qs.add(n.$J5),this.$q8.contains(n.$Xp)||this.$q8.add(n.$Xp))},$2Mz:function(n){return $0.$1(n)||$0.$1(n.get_$Ps())?!1:Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(n.get_$Ps())==="_NORSYNC_LOG_syncerror"},$2OG:function(n){var t=n.toString()in Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()?Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()[n.toString()]:this.$2Z9;t>0?(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()[n.toString()]=--t,this.$192.add(n)):delete Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM()[n.toString()]}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager=function(){this.$Dg=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$IO};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_DefaultInstance=function(){return $0.$1(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.set_DefaultInstance=function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=n,n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM=function(){return $0.$1(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$1JZ)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$1JZ={}),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$1JZ};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$21G=function(){return new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["_NORSYNC_LOG_commandoperation","_NORSYNC_LOG_businessprocessflowinstance"])};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$2L9=function(){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$cI++};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.prototype={$u9:0,$zV:0,$Dg:null,$1hT:null,$Ur:null,$Dd:null,$q7:null,$Mq:null,$PV:null,get_$1XR:function(){return 10},$1dO:function(){var n=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em,Microsoft.Crm.Client.Core.Framework.$4),t,i;return(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$cI=0,this.$u9=0,!Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$2Ma())?n.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Offline database is not available.")):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPlayback","Started Upsync"),t=this,i=this,this.$386().then(function(){t.$3KY().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1bi("SyncErrorFailureMap",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM());Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1zN("lastsuccessfulsaveoncrm").then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPlayback","Upsync successful");i&&!Microsoft.Crm.Client.Core.Framework.$1I.$12L(i)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$jm=i.lastsuccessfulsaveoncrm);Microsoft.Crm.Client.Core.Storage.DataApi.$H.get_$5().$3O.set_$2Z8(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$cI);var r=!$0.$1(t.$Ur)&&t.$Ur.$Xk?0:1;n.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em(r,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$cI,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$jm))},function(t){n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPlayback","Upsync failed");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1bi("SyncErrorFailureMap",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$pM());Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1zN("lastsuccessfulsaveoncrm").then(function(i){i&&!Microsoft.Crm.Client.Core.Framework.$1I.$12L(i)&&(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$jm=i.lastsuccessfulsaveoncrm);n.reject(t)},function(){n.reject(t)})})},function(t){n.reject(t)}),n.promise())},$1rC:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=new Array(0);t[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("SID",this.$u9,1,4);var i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(t),r=this,u=this;return this.$Dg.getNorSyncMainLogs(i).then(function(t){$0.$1(t)||!t.length?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Success","No Items found for upsync"),n.resolve(!1)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Success","Found items for upsync"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.HasPlayBackQueueItems.Faliure",t.$E);n.reject(t)}),n.promise()},$39k:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(n),f,r;if($0.$1(u))i.resolve(!1);else{f=u.$4S;r=new Array(0);r[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM(f,t.toString(),1,0);var e=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(r),o=this,s=this;this.$Dg.getNorSyncEntityLogs(e,n).then(function(n){!$0.$1(n)&&n.rows.length>0?i.resolve(!0):i.resolve(!1)},function(n){i.reject(n)})}return i.promise()},$386:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t=this,i=this;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1zN("SyncErrorFailureMap").then(function(t){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$1JZ=$0.$1(t)?{}:t;n.resolve(!0)},function(t){n.reject(t)}),n.promise()},$3KY:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack","I Pass Started"),t=this,i=this,this.$2Yg().then(function(i){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","I Pass Completed");i?t.$Ur.$Xk?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.NetworkFailure","II Pass Not Started due to Network Issue"),n.resolve(!1)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack","II Pass Started"),t.$2Yg().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","II Pass Completed");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.Faliure",t.$E);n.reject(t)})):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.Success","Completed"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessPlayBack.Failure",t.$E);n.reject(t)}),n.promise()},$2Yg:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass","Started"),t=this,i=this,this.$1rC().then(function(i){i?(t.$Ur=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$I7(t.$Dg),t.$XU().then(function(){t.$Ur.$Xk?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass.NetworkFaliure","Faliure"),n.resolve(!0)):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass.Success","StartPass Finished"),n.resolve(!0))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass.Failure",t.$E);n.reject(t)})):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass.Success","StartPass Completed"),n.resolve(!1))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.StartPass.Failure",t.$E);n.reject(t)}),n.promise()},$XU:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i,t,r;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync","UpSync Started"),i=[],Array.add(i,this.$Ur.$2S4()),Array.add(i,this.$3K4()),t=this,r=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(i).then(function(){t.$Ur.$Xk&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Warning","NetWork Issue Encountered while upsync"),n.resolve(!1));t.$Ur.$qc.length?t.$XU().then(function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Success","ManagePlayBackQueue Finished");n.resolve(t)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Failure",t.$E);n.reject(t)}):(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Info","ManagePlayBackQueue PlayBack All Remaining Requests Started"),t.$Ur.$2S4().then(function(){n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Failure",t.$E);n.reject(t)}))},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpSync.Success",t.$E);n.reject(t)}),n.promise()},$3K4:function(){var n=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,i;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch","ProcessBatch Started"),t=this,i=this,this.$2UI(!0).then(function(){$0.$1(t.$Dd)||!t.$Dd.get_Count()?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch.Success","ProcessBatch Completed"),n.resolve(!1)):t.$2jt().then(function(i){!$0.$1(i)&&i.get_Count()>0&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch","Batch Added to PlayBackBatchManager"),Array.enqueue(t.$Ur.$qc,i));Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch.Success","ProcessBatch Finished");n.resolve(!0)},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch.Failure",t.$E);n.reject(t)})},function(t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PrepareNextBatch.Failure",t.$E);n.reject(t)}),n.promise()},$3K0:function(n){for(var t=0,i=!n,r,u;t<this.$Mq.length&&(this.$Dd.get_Count()<this.get_$1XR()||i);)r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(this.$Mq[t]),u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$2I3(r),this.$Dd.add(this.$Mq[t]),this.$q7.contains(u)||this.$q7.add(u),i?r.toLowerCase()==="_NORSYNC_LOG_commandoperation".toLowerCase()?this.$zV++:(this.$zV--,this.$zV<=0&&(i=!1,this.$zV=0)):r.toLowerCase()==="_NORSYNC_LOG_Command".toLowerCase()&&(i=!0,this.$zV=0),t++;return this.$u9=this.$Dd.get_Items()[this.$Dd.get_Count()-1].$J5,this.$Mq.splice(0,t),i},$3K3:function(){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),t,f,r,o,n,h;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveEntityLogs","RetrieveEntityLogs Started");this.$PV={};t=new Array(0);t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("NORSYNC_LOG_SID",this.$Dd.get_Items()[0].$J5,0,5));t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("NORSYNC_LOG_SID",this.$u9,0,3));f=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(t);r=[];for(var e=this.$q7.get_Items(),s=e.length,u=0;u<s;++u)o=e[u],Array.add(r,this.$Dg.getNorSyncEntityLogs(f,o));return n=this,h=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(r).then(function(t){var r,o,s,u,e,f,h;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveEntityLogs.Success","RetrieveEntityLogs Completed"),r=0;r<n.$q7.get_Count();r++)if(o=n.$q7.get_Items()[r],$0.$1(t[r]))n.$PV[o]=null;else{for(s=t[r],u={},e=0;e<s.rows.length;e++)f=s.rows.item(e),h=f.NORSYNC_LOG_SID.toString()in u?u[f.NORSYNC_LOG_SID.toString()]:new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Object)),h.add(f),u[f.NORSYNC_LOG_SID.toString()]=h;n.$PV[o]=u}i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveEntityLogs.Failure",n.$E);i.reject(n)}),i.promise()},$2jt:function(){var r=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v),Microsoft.Crm.Client.Core.Framework.$4),i,o,s;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.CreateBatchData","CreateBatchData Started");this.$1hT=new Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ip(this.$Dg,this.$Dd,this.$PV);for(var f=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v)),e=[],n=0,t=0,u=!1;n<this.$Dd.get_Count();)i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(this.$Dd.get_Items()[n]),u?i.toLowerCase()==="_NORSYNC_LOG_commandoperation".toLowerCase()?(t++,n++):(n+=i.toLowerCase()==="_NORSYNC_LOG_businessprocessflowinstance".toLowerCase()&&!t?1:t,u=!1,t=0):(i.toLowerCase()==="_NORSYNC_LOG_Command".toLowerCase()&&(u=!0,t=0),Array.add(e,this.$1hT.$2k4(n)),n++);return o=this,s=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(e).then(function(n){var u;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.CreateBatchData.Success","CreateBatchData Completed");for(var i=n,e=i.length,t=0;t<e;++t)u=i[t],f.add(u);r.resolve(f)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.CreateBatchData.Failure",n.$E);r.reject(n)}),r.promise()},$2zp:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),r=new Array(0);r[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("SID",this.$u9,1,4);var u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(r,n),i=this,f=this;return this.$Dg.getNorSyncMainLogs(u).then(function(n){if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.GetBatch.Success","GetBatch Completed."),$0.$1(i.$Mq))i.$Mq=n;else{var r;(r=i.$Mq).push.apply(r,n)}t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackManager.GetBatch.Fail",n.$E);t.reject(n)}),t.promise()},$2UI:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),r,i,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveBatch","RetrieveBatch Started."),n&&(this.$Dd=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik)),this.$q7=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))),r=this.get_$1XR(),!$0.$1(this.$Mq)&&this.$Mq.length>0&&(r-=this.$Mq.length,this.$u9=this.$Mq[this.$Mq.length-1].$J5),i=this,u=this,this.$2zp(r).then(function(){$0.$1(i.$Mq)||!i.$Mq.length?t.resolve(!0):i.$3K0(n)?i.$2UI(!1).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveBatch.Force.Success","Force RetrieveBatch Completed.");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveBatch.Force.Failure",n.$E);t.reject(n)}):i.$3K3().then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveBatch.Success","RetrieveBatch Completed.");t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.RetrieveBatch.Failure",n.$E);t.reject(n)})},function(n){t.reject(n)}),t.promise()}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Hn=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Hn.registerInterface("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Hn");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$IO=function(){this.$1BG=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa;this.$nt=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd(this.$1BG);this.$1PM=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se(this.$1BG);this.$17G=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$IO.prototype={$1BG:null,$nt:null,$1PM:null,$17G:null,getNorSyncMainLogs:function(n){var t=MscrmComponents.DeferredPromiseFactory(Array,Microsoft.Crm.Client.Core.Framework.$4),i=this,r=this;return this.$nt.$6I("_NORSYNC_MAIN_LOG_TABLE",n).then(function(n){t.resolve(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$2jH(n))},function(n){t.reject(n)}),t.promise()},getNorSyncEntityLogs:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Imported.Norsync.SQLiteResults,Microsoft.Crm.Client.Core.Framework.$4),r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$32o(t),u=this,f=this;return this.$nt.$6I(r,n).then(function(n){i.resolve(n)},function(n){i.reject(n)}),i.promise()},$oR:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),u=this,f=this;return this.$17G.$oR(n,t,i).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.UpdateRowVersion.Success","Updation of Row Version Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackManager.UpdateRowVersion.Fail",n.$E);r.reject(n)}),r.promise()},$27X:function(n,t,i){var r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),u,o,f,s,c,a,v;if(n.get_Count()){u=new Array(0);u.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("SID",n,1,7));o=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(u);f=new Array(0);f.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("NORSYNC_LOG_SID",n,1,7));s=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(f);this.$nt.$26D(!0);for(var h=t.get_Items(),l=h.length,e=0;e<l;++e)c=h[e],this.deleteNorSyncEntityLog(c,s);this.deleteNorSyncMainLogs(o);i.equals(Microsoft.Crm.Client.Core.Framework.Guid.get_empty())||this.$10B(i);a=this;v=this;this.$nt.Commit(this.$1BG.$AP).then(function(){r.resolve(!0)},function(n){r.reject(n)})}else r.resolve(!0);return r.promise()},$2a2:function(n,t){if($0.$1(n))return null;var i=n.$1e4();return i.Status=t,new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(i,3,"Command")},$10B:function(n){var t=new Array(0),i,r,u;t.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("Id",n.toString(),1,0));i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(t);r=new Array(0);r.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("CommandId",n.toString(),1,0));u=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(t);this.$1PM.Delete("Command",i);this.$1PM.Delete("CommandOperation",u)},deleteNorSyncMainLogs:function(n){this.$nt.Delete("_NORSYNC_MAIN_LOG_TABLE",n)},deleteNorSyncEntityLog:function(n,t){this.$nt.Delete(n,t)}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ip=function(n,t,i){this.$Dg=n;this.$Dd=t;this.$PV=i;this.$1lg=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ip.prototype={$1lg:null,$Dd:null,$PV:null,$Dg:null,$17M:null,$17L:null,$1LD:null,$2k4:function(n){var t=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v,Microsoft.Crm.Client.Core.Framework.$4),i,r,u,f;return n>=this.$Dd.get_Count()?t.reject(Microsoft.Crm.Client.Core.Framework.$4.$i("Invalid index specified for batch logs")):(i=[],r=this.$Dd.get_Items()[n],r.$Xp.toLowerCase()!=="_NORSYNC_LOG_Command".toLowerCase()?Array.add(i,this.$30P(n)):Array.add(i,this.$32m(n)),u=this,f=this,Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(i).then(function(n){var i=$0.$1(n[0])?null:n[0];$0.$1(i)?t.resolve(null):(i.set_$Ps(r),i.set_$2ey(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh(r,u.$PV)),t.resolve(i))},function(n){t.reject(n)})),t.promise()},$30P:function(n){var i=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v,Microsoft.Crm.Client.Core.Framework.$4),t=this.$Dd.get_Items()[n],r=t.$c2;if(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$21G().contains(t.$Xp))i.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il(r,null));else{var u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh(t,this.$PV),f=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$34G(t,this.$PV),e=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(t),o=this,s=this;this.$1lg.$2jG(u,f,e,r).then(function(n){i.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il(r,n))},function(n){i.reject(n)})}return i.promise()},$32m:function(n){var t=MscrmComponents.DeferredPromiseFactory(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v,Microsoft.Crm.Client.Core.Framework.$4),f=this.$Dd.get_Items()[n];this.$1LD=new(Microsoft.Crm.Client.Core.Framework.$8d.$$(String));this.$17M=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik));this.$17L={};var r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh(f,this.$PV),e=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(r.Id.toString()),u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$309(r),i=this,o=this;return this.$3KQ(n,u).then(function(){t.resolve(new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Im(e,u,i.$1LD,i.$17M,i.$17L))},function(n){t.reject(n)}),t.promise()},$30A:function(n){for(var t=0,i;n<this.$Dd.get_Count();){if(i=this.$Dd.get_Items()[n],i.$Xp.toLowerCase()!=="_NORSYNC_LOG_commandoperation".toLowerCase())break;t++;n++}return t},$3KQ:function(n,t){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),r,e,o,f,u,s,h;if(t.$1d.toLowerCase()==="ChangeProcessAndStage".toLowerCase())n+1>=this.$Dd.get_Count()?i.resolve(!0):(r=this.$Dd.get_$I(n+1),e=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(r),e==="_NORSYNC_LOG_businessprocessflowinstance"?(this.$17M.add(r),this.$17L[r.$J5.toString()]=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh(r,this.$PV),i.resolve(!0)):i.resolve(!0));else{for(o=this.$30A(n+1),f=[],u=1;u<=2*o;u++)Array.add(f,this.$3JX(n+u));s=this;h=this;Microsoft.Crm.Client.Core.Imported.DeferredPromiseHelper.whenArray(f).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.ProcessEntitiesInNonCrud.Success","Processing of Entities in NonCrud Succeeded");i.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackManager.ProcessEntitiesInNonCrud.Fail",n.$E);i.reject(n)})}return i.promise()},$3JX:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),s,r,e,h;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Start","Population of Entities in NonCrud Started"),n>=this.$Dd.get_Count())Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud Succeeded"),t.resolve(!1);else{var i=this.$Dd.get_Items()[n],o=i.$Xp,u=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(i),f=new Array(0);f.push(new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("NORSYNC_LOG_SID",i.$J5,1,0));s=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL(f);r=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh(i,this.$PV);this.$17M.add(i);this.$17L[i.$J5.toString()]=r;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.get_$21G().contains(o)?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud is skipped"),t.resolve(!0)):(e=this,h=this,Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.$76(u,Microsoft.Crm.Client.Core.Framework.$G.$b(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld(),"UpSyncDataBuilder")).then(function(n){!$0.$1(n)&&n.get_$Hj()in r?(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Success","Population of Entities in NonCrud Succeeded"),e.$1LD.set_$I(r[n.get_$Hj()].toString(),u),t.resolve(!0)):t.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.PlaybackManager.PopulateEntitiesInNonCrud.Fail",n.$E);t.reject(n)}))}return t.promise()}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Iq=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e=function(n){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.initializeBase(this);this.$Dg=n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl=function(n,t,i,r){var e,h,u,o,f,s;for(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:CreateActionData","Started"),e=r,($0.$1(e)||!e.get_Count())&&(e=n.$4P),h=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(n.$N.LogicalName),u=new Sys.StringBuilder,o=0;o<e.get_Count();o++)if(!Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$21F.contains(e.get_$I(o)))if(f=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c(t,e.get_$I(o)),$0.$1(f)||f.$2K===15)$0.$1(f)&&!$0.$1(r)&&(u.append(e.get_$I(o)),u.append(" - "),u.appendLine(n.getValue(e.get_$I(o)).toString()));else if($0.$1(n.getValue(e.get_$I(o))))u.append(f.$1S),u.append(" - "),u.appendLine("");else if(f.$2K===6||f.$2K===1||f.$2K===9)u.append(f.$1S),u.append(" - "),u.appendLine(n.getValue(e.get_$I(o)).Name);else if(f.$2K!==12&&f.$2K!==13&&f.$2K!==11&&f.$2K)if(f.$2K===20&&i==="create")continue;else f.$2K===2?(u.append(f.$1S),u.append(" - "),u.appendLine($0.$1(n.getValue(e.get_$I(o)))?"":Xrm.Soap.CrmDateTimeSerializer.$FR(n.getValue(e.get_$I(o))))):(u.append(f.$1S),u.append(" - "),u.appendLine(n.getValue(e.get_$I(o)).toString()));else{if(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$2Y2(h,i,e.get_$I(o).toString()))continue;s=n.getValue(e.get_$I(o)).get_$bV();u.append(f.$1S);u.append(" - ");u.appendLine(s!=="-1"&&!$0.$1(f.$5d.$2f[s])?f.$5d.$2f[s].$1D.toString():"")}return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:CreateActionData","Completed"+u.toString()),u.toString()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$3IV=function(n,t,i){var f,y=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld(),p=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$2O(y),a,c,r,o,u,s,h,e,l,v;try{Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","Started");a=Microsoft.Crm.Client.Core.Storage.Common.Xml.$A.$Z(p.$1kv(t,t,n));c=Microsoft.Crm.Client.Core.Storage.Common.Xml.$A.$B(a);Xrm.Soap.Serializer.$D6(c);f=Xrm.Soap.Serializer.$2No(c,t)}catch(w){return""}r=new Sys.StringBuilder;switch(t){case"WinOpportunity":return o=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl(o.opportunityClose,i,"WinOpportunity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(o.opportunityClose.get_fieldNames()))),u=o.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","WinOpportunityOperation:Completed "+r.toString()),r.toString();case"LoseOpportunity":return s=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl(s.opportunityClose,i,"LoseOpportunity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(s.opportunityClose.get_fieldNames()))),u=s.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","LoseOpportunityOperation:Completed "+r.toString()),r.toString();case"CloseIncident":return h=f,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl(h.incidentResolution,i,"CloseIncident",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(h.incidentResolution.get_fieldNames()))),u=h.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z(i,u,"statuscode")),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","CloseIncidentOperation:Completed "+r.toString()),r.toString();case"ConvertActivity":return e=f,r.appendLine(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl(e.targetEntity,e.targetEntityName,"ConvertActivity",new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(e.targetEntity.get_fieldNames()))),r.append("CreateCampaignResponse - "),r.append(e.createCampaignResponse.toString()),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","ConvertActivityOperation:Completed "+r.toString()),r.toString();case"SetState":return i!=="lead"&&(l=f,v=l.state,u=l.status,r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z(i,v,"statecode")),r.append(Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z(i,u,"statuscode"))),r.toString();default:return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:ParseActionDataForNonCud","default:Completed "),""}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$19Z=function(n,t,i){var r=new Sys.StringBuilder,u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c(n,i);return $0.$1(u)||u.$2K!==13&&u.$2K!==12||t===-1?t!==-1&&(i.toLowerCase()==="statuscode"?r.append("status - "):r.append("state - "),r.appendLine(t.toString())):(r.append(u.$1S),r.append(" - "),r.appendLine(u.$5d.$2f[t.toString()].$1D.toString())),r.toString()};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$2Y2=function(n,t,i){return!$0.$1(n)&&t.toLowerCase()==="create"&&(n.get_$8p()&&i==="isregularactivity"||n.$FG&&i==="statecode")?!0:!1};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.prototype={$Dg:null,get_$f:function(){return Microsoft.Crm.Client.Core.Framework.$G.$b(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld(),"RollBackHandler")},$1U8:function(n,t){var i,r,u;return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.RollBackHandler.Handle.Start","Rollback of failed command started"),i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n.get_$kr()?(u=this,this.$3PN(n).always(function(){u.$251(n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.RollBackHandler.Handle.Success","Rollback of failed Non-CRUD command succeeded");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$2L9();i.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.RollBackHandler.Handle.Failure",n.$E);i.reject(n)})})):(r=this,this.$3PL(n).always(function(){r.$251(n,t).then(function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.RollBackHandler.Handle.Success","Rollback of failed CUD command succeeded");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$2L9();i.resolve(n)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.RollBackHandler.Handle.Failure",n.$E);i.reject(n)})})),i.promise()},$3PL:function(n){var i=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c)),t=this.$1zi(n.$x6,n.$E8.$N.LogicalName,n.$qt),f,s,h;if($0.$1(t))i.resolve(!1);else{if(r.add(t),!$0.$1(n.$bf)&&n.$bf.get_Count()>0)for(var e=n.$bf.get_Items(),o=e.length,u=0;u<o;++u)f=e[u],t=this.$1zi(f.$x6,"activityparty",f.$qt),$0.$1(t)||r.add(t);s=this;h=this;this.$Dg.$oR(r,null,!0).then(function(){i.resolve(!0)},function(n){i.reject(n)})}return i.promise()},$3PN:function(n){for(var u,v,y,t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),h=n.$jP,f=n.$ps,c=n.$1Kk,e=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c)),o=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c)),i=f.get_Count()-1;i>=0;i--){var r=f.get_Items()[i],l=c[r.$J5.toString()],a=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(r),s=this.$1zi(l,a,r.$c2);$0.$1(s)||e.add(s)}return u=this.$Dg.$2a2(h,3),$0.$1(u)||o.add(u),v=this,y=this,this.$Dg.$oR(e,o,!0).then(function(){t.resolve(!0)},function(n){t.reject(n)}),t.promise()},$251:function(n,t){var r,s,h,l;if(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Start","Sync Error Creation Started"),r=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),n.get_$kr()){var u=n,f=u.$jP,i="",e=null,o=Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),c="";n.get_$kr()===2?(s=JSON.parse(f.$pp),i=s.entitylogicalname.toString(),o=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(s.entityid.toString()),e=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i)):(h=u.$ps.get_Items()[u.$ps.get_Count()-1],l=u.$1Kk[h.$J5.toString()],i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(h),e=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i),o=Microsoft.Crm.Client.Core.Framework.Guid.tryCreate(l[e.$4S].toString()),c=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$3IV(f.$pp,f.$1d,i));var a=Microsoft.Crm.Client.Core.Offline.$5b.$zg(i,f.$1d,o,i,e.$d,t.$E,c,t.$xg,"",t.$z,t.$1LF),v=this,y=this;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1lL(a,this.get_$f()).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Success","Sync Error Creation Succeeded");r.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.RollBackHandler.AddRecordSyncErrorLog.Fail",n.$E);r.reject(n)})}else return this.$1lL(n,t);return r.promise()},$1lL:function(n,t){var e=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),p=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(n.$UZ),o=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$2I3(p),i=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(o),r=n.$E8,y=r.$N.Id,f,c,l,a,v;if($0.$1(r))e.resolve(!1);else{var w=!!i&&(i.get_$8p()||o==="activityparty"),u=n.$qt,s=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$1Pl(r,o,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26.toString(u)),h=this.$1t8(u)?this.$2mG(r,i,y.toString(),u):null;if(w&&(f=this.$2zF(n,u,i),$0.$1(f.ActivityPartyActionData)||(s=s+f.ActivityPartyActionData),this.$1t8(u)&&!$0.$1(f.ActivityPartyCollection))){c=JSON.parse(h);l=f.ActivityPartyCollection;for(a in l)v={key:a,value:l[a]},c[v.key]=v.value;h=this.$28b(c)}var b=Microsoft.Crm.Client.Core.Offline.$5b.$zg(o,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26.toString(u),y,$0.$1(r.getValue(i.$5e))?"":r.getValue(i.$5e).toString(),i.$d,t.$E,s,t.$xg,h,t.$z,t.$1LF),k=this,d=this;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1lL(b,this.get_$f()).then(function(){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.RollBackHandler.CreateSyncErrorLog.Success","Sync Error Creation Succeeded");e.resolve(!0)},function(n){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E("OfflineUpSync.RollBackHandler.CreateSyncErrorLog.Fail",n.$E);e.reject(n)})}return e.promise()},$2zF:function(n,t,i){for(var y,p,s,f,h,w,b=n.$bf,c=new Sys.StringBuilder,e={},u={},l=n.$E8,a=b.get_Items(),k=a.length,o=0;o<k;++o){var v=a[o],d=v.$UZ,r=v.$E8;i.get_$8p()&&t===1&&this.$3A8(r)||(l.hasField("activityid")&&(y=r.getValue("activityid"),p=l.getValue("activityid"),y.Id.toString()===p.toString()&&c.appendLine(this.$2zE(r))),this.$1t8(t)&&d.$c2!==2&&(s=r.getValue("participationtypemask"),$0.$1(s)||(f=Microsoft.Crm.Client.Core.Offline.$2t.$1Gi[s.$1i.toString()],h=r.getValue("partyid"),$0.$1(h)||(w=h.getObjectData(),$0.$1(u[f])&&(u[f]=[]),u[f].push(w)))))}return e.ActivityPartyCollection=u,e.ActivityPartyActionData=c.toString(),e},$3A8:function(n){var t=n.getValue("participationtypemask"),i;return!$0.$1(t)&&(i=Microsoft.Crm.Client.Core.Offline.$2t.$1Gi[t.$1i.toString()],i==="owner")?!0:!1},$2zE:function(n){var i=n.getValue("participationtypemask"),r,t,u;return!$0.$1(i)&&(r=Microsoft.Crm.Client.Core.Offline.$2t.$1Gi[i.$1i.toString()],t=n.getValue("partyid"),!$0.$1(t))?(u=t,r+" - "+u.Name):""},$1zi:function(n,t,i){var r=null;return i===1?r=this.$3PK(n,t):i===2?r=this.$3PM(n,t):i===3&&(r=this.$3PO(n,t)),r},$3PK:function(n,t){var i=new Array(0),r;return t==="CommandOperation".toLowerCase()?i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("Id",n.Id.toString(),1,0):t==="businessprocessflowinstance".toLowerCase()?i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM("businessprocessflowinstanceid",n.businessprocessflowinstanceid.toString(),1,0):(r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(t),$0.$1(n)||$0.$1(r)||(i[0]=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM(r.$4S,n[r.$4S].toString(),1,0))),new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(i,2,t)},$3PO:function(n,t){var i=null;return $0.$1(n)||(n=this.$2Tq(n),i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(n,3,t)),i},$3PM:function(n,t){var i=null;return $0.$1(n)||(n=this.$2Tq(n),i=new Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c(n,1,t)),i},$2Tq:function(n){return delete n.NORSYNC_SID,delete n.NORSYNC_LOG_SID,delete n.NORSYNC_TABLE_ID,delete n.NORSYNC_LOG_TYPE,n},$2mG:function(n,t,i,r){var f,u,l,s;Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:CreateRequestData","Started");var e=n.$4P,o={},h=Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$21F;for(r===1&&h.add(t.$4S),o.syncerror__regardingentityid=i,o.entitylogicalname=t.$d,f=0;f<e.get_Count();f++)if(!h.contains(e.get_$I(f))&&(u=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c(t.$d,e.get_$I(f)),!$0.$1(u)))if($0.$1(n.getValue(e.get_$I(f))))o[u.$d]="";else if(u.$2K===6||u.$2K===1||u.$2K===9){var a=n.getValue(e.get_$I(f)),v=a.getObjectData(),c=[];c.push(v);o[u.$d]=c}else if(u.$2K!==12&&u.$2K!==13&&u.$2K!==11&&u.$2K)if(u.$2K===20&&r===1)continue;else o[u.$d]=u.$2K===2?$0.$1(n.getValue(e.get_$I(f)))?"":Xrm.Soap.CrmDateTimeSerializer.$FR(n.getValue(e.get_$I(f))):n.getValue(e.get_$I(f)).toString();else{if(l=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$34W(r),Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$2Y2(t,l,e.get_$I(f).toString()))continue;s=n.getValue(e.get_$I(f)).get_$bV();o[u.$d]=s!=="-1"?s:""}return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C("RollbackHandler:CreateRequestData","Completed"+o.toString()),this.$28b(o)},$28b:function(n){return JSON.stringify(n)},$1t8:function(n){return n===1||n===3?!0:!1}};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX=function(n){Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX.initializeBase(this);this.$1Y4=n};Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX.prototype={$1Y4:null,$1U8:function(n){var t=MscrmComponents.DeferredPromiseFactory(Boolean,Microsoft.Crm.Client.Core.Framework.$4),i,r,u,f,e;return n.get_$kr()?(i=n.$jP,$0.$1(i)?t.resolve(!1):(r=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c)),u=this.$1Y4.$2a2(i,2),r.add(u),f=this,e=this,this.$1Y4.$oR(null,r,!0).then(function(){f.$2XK();t.resolve(!0)},function(n){t.reject(n)}))):(this.$2XK(),t.resolve(!0)),t.promise()},$2XK:function(){var t=new Date,n={};n.lastsuccessfulsaveoncrm=Microsoft.Crm.Client.Core.Storage.Common.CrmFormatter.$D.$OL(t,0);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5().$1bi("lastsuccessfulsaveoncrm",n)}};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.Common");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$5d=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$5d.prototype={failure:0,success:1};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$5d.registerEnum("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$5d",!1);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26.prototype={create:1,Delete:2,update:3,retrieve:4};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26.registerEnum("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26",!1);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J=function(n){this.$13Z=new Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider(n)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.get_$5=function(){return $0.$1(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D)&&(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D=new Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J(Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$1p())),Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.prototype={$13Z:null,$1lL:function(n,t){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D.$13Z.$2ll(n,t)},$1bi:function(n,t){Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D.$13Z.$1bi(n,t)},$1zN:function(n){return Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D.$13Z.$XB(n)},$2Ma:function(){return this.$13Z.$2Ma()}};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$32o=function(n){return"_NORSYNC_LOG_"+n};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$2jH=function(n){for(var i,t,u=new Array(n.rows.length),r=0;r<n.rows.length;r++)i=n.rows.item(r),t=new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik,t.$J5=i.SID,t.$23v=i.DEVICE_ID.toString(),t.$Xp=i.LOG_TABLE_ID.toString(),t.$c2=i.OPERATION_TYPE,t.$Y5=i.TIME_STAMP,u[r]=t;return u};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1E=function(n,t){Microsoft.Crm.Client.Core.Framework.$B.$1E(n,1035,t)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$C=function(n,t){Microsoft.Crm.Client.Core.Framework.$B.$1E(n,1035,t)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n=function(n){return n.$Xp};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$2I3=function(n){return n.replace("_NORSYNC_LOG_","")};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$1Dh=function(n,t){var u,r;if($0.$1(n))return null;var i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(n),f=n.$J5,e=n.$c2;return!$0.$1(i)&&!$0.$1(t)&&i in t?(u=t[i],r=u[f.toString()],$0.$1(r)?null:r.get_Items()[0]):null};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$34G=function(n,t){var f,r;if($0.$1(n))return null;var i=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK(n),e=n.$J5,u=n.$c2;return u!==1&&u!==2&&!$0.$1(i)&&!$0.$1(t)&&i in t?(f=t[i],r=f[e.toString()],$0.$1(r)?null:r.get_Items()[1]):null};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$tK=function(n){var t=Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$11n(n);return t.replace("_NORSYNC_LOG_","")};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$309=function(n){if($0.$1(n))return new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a(Microsoft.Crm.Client.Core.Framework.Guid.get_empty(),null,1,null);var t=n.Id,i=n.Name.toString(),r=n.Status,u=n.ActionData.toString();return new Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a(t,i,r,u)};Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.$34W=function(n){var t="";switch(n){case 1:t="Create";break;case 2:t="Delete";break;case 3:t="Update";break;case 4:t="Retrieve"}return t};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.Entities");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v.registerInterface("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a=function(n,t,i,r){this.$2b=n;this.$1d=t;this.$qu=i;this.$pp=r;this.$jR=new Date};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a.prototype={$2b:null,$1d:null,$qu:0,$pp:null,$jR:null,$1e4:function(){var n={};return n.Id=this.$2b,n.Name=this.$1d,n.Status=this.$qu,n.ActionData=this.$pp,n.CreatedOn=this.$jR,n}};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ir=function(n,t,i,r){this.$2b=n;this.$Ro=t;this.$7i=i;this.$1gl=r};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ir.prototype={$2b:null,$Ro:null,$7i:null,$1gl:0,$1e4:function(){var n={};return n.Id=this.$2b,n.CommandId=this.$Ro,n.EntityName=this.$7i,n.Operation=this.$1gl,n}};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il=function(n,t){this.$xH=0;this.$qt=n;this.$E8=t;this.$bf=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il))};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il.prototype={$xH:0,get_$kr:function(){return this.$xH},$UZ:null,get_$Ps:function(){return this.$UZ},set_$Ps:function(n){return this.$UZ=n,n},$x6:null,set_$2ey:function(n){return this.$x6=n,n},$qt:0,$E8:null,$bf:null};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Im=function(n,t,i,r,u){this.$xH=t.$1d.toLowerCase()==="ChangeProcessAndStage".toLowerCase()?2:1;this.$Ro=n;this.$jP=t;this.$1fn=i;this.$ps=r;this.$1Kk=u};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Im.prototype={$xH:0,get_$kr:function(){return this.$xH},$UZ:null,get_$Ps:function(){return this.$UZ},set_$Ps:function(n){return this.$UZ=n,n},$x6:null,set_$2ey:function(n){return this.$x6=n,n},$Ro:null,$jP:null,$1fn:null,$ps:null,$1Kk:null};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik.prototype={$J5:0,$Y5:null,$Xp:null,$23v:null,$c2:0};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em=function(n,t,i){this.$qu=n;this.$1LE=t;this.$jm=i};Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em.prototype={$qu:0,$1LE:0,$jm:null};Type.registerNamespace("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9u=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9u.$28S=function(n,t){switch(n){case 0:return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9w.$28T(t);case 1:return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F.$28T(t.get_Items()[0]);default:return null}};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9w=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9w.$28T=function(n){var u,o;Microsoft.Crm.Client.Core.Framework.Utils.$D.$1U(n,"crudCommandActionData");u=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Sdk.Request));for(var e=n.get_Items(),s=e.length,f=0;f<s;++f){var h=e[f],i=h,c=$1M.$Cu(Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26,Microsoft.Crm.Client.Core.Offline.Upsync.Common.$26.toString(i.$qt)),r,t=null;switch(c){case 1:t=new Xrm.Gen.CreateRequest(i.$E8);t.returnRowVersion=!0;break;case 3:r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i.$E8.$N.LogicalName);t=new Xrm.Gen.UpdateRequest(i.$E8);!$0.$1(r)&&r.$tu&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$1H.$1Ee&&(t.concurrencyBehavior=1);t.returnRowVersion=!0;break;case 2:r=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(i.$E8.$N.LogicalName);o=i.$E8;t=new Xrm.Gen.DeleteRequest(o.$N);!$0.$1(r)&&r.$tu&&Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$K().$1H.$1Ee&&(t.concurrencyBehavior=1)}t&&u.add(t)}return new Xrm.Gen.ExecuteMultipleRequest(u.toArray(),new Xrm.Gen.ExecuteMultipleSettings(!0,!0))};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F.$28T=function(n){var v=n.$jP.$pp,r=n.$jP.$1d,u,h,c,t,i,y,p,f,a,b;Microsoft.Crm.Client.Core.Framework.Utils.$D.$1U(r,"commandName");Microsoft.Crm.Client.Core.Framework.Utils.$D.$1U(v,"data");var e=n.$1fn,k=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld(),d=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$2O(k),o=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(Xrm.Sdk.Request)),g=Microsoft.Crm.Client.Core.Storage.Common.Xml.$A.$Z(d.$1kv(r,r,v)),s=Microsoft.Crm.Client.Core.Storage.Common.Xml.$A.$B(g);if(Xrm.Soap.Serializer.$D6(s),u=Xrm.Soap.Serializer.$2No(s,r),Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F.$2cS(u),h=s.$O(".//a:KeyValuePairOfstringanyType[b:key='OfflineData']/b:value"),!$0.$1(h)&&(c={},t=h.get_$Bj(),!$0.$1(t))){for(i=0,y=t.childNodes.length;i<y;i++)c[t.childNodes[i].childNodes[0].textContent]=t.childNodes[i].childNodes[1].textContent;u.$Wc=c}o.add(u);p=new Microsoft.Crm.Client.Core.Storage.Common.ColumnSet(["versionnumber"]);for(var w=e.get_$3B8(),nt=w.length,l=0;l<nt;++l)f=w[l],a=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$l(e.get_$I(f)),$0.$1(a)||(b=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$V().$2c(a.$d,"versionnumber"),$0.$1(b)||o.add(new Xrm.Gen.RetrieveRequest(new Xrm.Objects.EntityReference(e.get_$I(f),new Microsoft.Crm.Client.Core.Framework.Guid(f)),p)));return new Xrm.Gen.ExecuteMultipleRequest(o.toArray(),new Xrm.Gen.ExecuteMultipleSettings(!0,!0))};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F.$2cS=function(n){var t=null,u,f,e,o,r;if(n.name==="ConvertActivity"?(u=n,t=u.targetEntity):n.name==="LoseOpportunity"?(f=n,t=f.opportunityClose):n.name==="WinOpportunity"?(e=n,t=e.opportunityClose):n.name==="CloseIncident"&&(o=n,t=o.incidentResolution),!$0.$1(t)&&!$0.$1(t.get_fieldNames()))for(var s=t.get_fieldNames(),h=s.length,i=0;i<h;++i)r=s[i],Microsoft.Crm.Client.Core.Framework.$3.$1O(r)||t.$4P.add(r)};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.get_$5=function(){return Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.$3||(Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.$3=new Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g),Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.$3};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.prototype={$CN:null,get_$7a:function(){if(!this.$CN){var n=Microsoft.Crm.Client.Core.Storage.DataApi.DataSource.$3.get_$Ld();this.$CN=new Microsoft.Crm.Client.Core.Storage.CrmSoapServiceProxy.$2O(n)}return this.$CN},$XU:function(n,t){var i=Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9u.$28S(n,t);return this.get_$7a().$2F(i,Microsoft.Crm.Client.Core.Framework.$G.$b("","MobileClient-OfflineSync"))},$3Xo:function(n){var t=JSON.parse(n.get_Items()[0].$jP.$pp);return $0.$1(t)?null:this.get_$7a().$rZ(t.entityid.toString(),t.entitylogicalname.toString(),t.processid.toString(),"",t.stageid.toString(),t.traversedpath.toString(),Microsoft.Crm.Client.Core.Framework.$G.$b("","MobileClient-OfflineSync"))}};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2=function(){};Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2.prototype={$E:null,$1LF:null,$z:0,$xg:null};Microsoft.Crm.Client.Core.Offline.$t.registerClass("Microsoft.Crm.Client.Core.Offline.$t",null,Microsoft.Crm.Client.Core.Offline.$Fw);Microsoft.Crm.Client.Core.Offline.$1F.registerClass("Microsoft.Crm.Client.Core.Offline.$1F");Microsoft.Crm.Client.Core.Offline.$2t.registerClass("Microsoft.Crm.Client.Core.Offline.$2t");Microsoft.Crm.Client.Core.Offline.$68.registerClass("Microsoft.Crm.Client.Core.Offline.$68",null,Microsoft.Crm.Client.Core.Offline.$Fv);Microsoft.Crm.Client.Core.Offline.$IJ.registerClass("Microsoft.Crm.Client.Core.Offline.$IJ");Microsoft.Crm.Client.Core.Offline.$IG.registerClass("Microsoft.Crm.Client.Core.Offline.$IG",null,Microsoft.Crm.Client.Core.Framework.$Hw);Microsoft.Crm.Client.Core.Offline.$IK.registerClass("Microsoft.Crm.Client.Core.Offline.$IK");Microsoft.Crm.Client.Core.Offline.$BM.registerClass("Microsoft.Crm.Client.Core.Offline.$BM");Microsoft.Crm.Client.Core.Offline.$8H.registerClass("Microsoft.Crm.Client.Core.Offline.$8H",null,Microsoft.Crm.Client.Core.Framework.ISerializable);Microsoft.Crm.Client.Core.Offline.$IH.registerClass("Microsoft.Crm.Client.Core.Offline.$IH",null,Microsoft.Crm.Client.Core.Storage.DataApi.$G6);Microsoft.Crm.Client.Core.Offline.$IF.registerClass("Microsoft.Crm.Client.Core.Offline.$IF");Microsoft.Crm.Client.Core.Offline.$l.registerClass("Microsoft.Crm.Client.Core.Offline.$l",null,Microsoft.Crm.Client.Core.Storage.DataApi.$Fy,Microsoft.Crm.Client.Core.Storage.DataApi.$Ff);Microsoft.Crm.Client.Core.Offline.$K.registerClass("Microsoft.Crm.Client.Core.Offline.$K",null,Microsoft.Crm.Client.Core.Storage.DataApi.$G5);Microsoft.Crm.Client.Core.Offline.$K.$UN.registerClass("Microsoft.Crm.Client.Core.Offline.$K.$UN");Microsoft.Crm.Client.Core.Offline.$2c.registerClass("Microsoft.Crm.Client.Core.Offline.$2c");Microsoft.Crm.Client.Core.Offline.$2l.registerClass("Microsoft.Crm.Client.Core.Offline.$2l");Microsoft.Crm.Client.Core.Offline.$w.registerClass("Microsoft.Crm.Client.Core.Offline.$w");Microsoft.Crm.Client.Core.Offline.$IA.registerClass("Microsoft.Crm.Client.Core.Offline.$IA");Microsoft.Crm.Client.Core.Offline.$ID.registerClass("Microsoft.Crm.Client.Core.Offline.$ID");Microsoft.Crm.Client.Core.Offline.$I6.registerClass("Microsoft.Crm.Client.Core.Offline.$I6");Microsoft.Crm.Client.Core.Offline.$4b.registerClass("Microsoft.Crm.Client.Core.Offline.$4b");Microsoft.Crm.Client.Core.Offline.$5b.registerClass("Microsoft.Crm.Client.Core.Offline.$5b");Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineSyncErrorLogProvider");Microsoft.Crm.Client.Core.Offline.$I9.registerClass("Microsoft.Crm.Client.Core.Offline.$I9");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N");Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$QY.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$QY",Microsoft.Crm.Client.Core.Storage.Common.QueryGenerator.$K9);Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$78.registerClass("Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$78");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$II.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$II");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$II);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Se",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$7p",null,Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Hz);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Qa",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$II);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$6c");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IM");Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$Sd",Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$QZ);Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL.registerClass("Microsoft.Crm.Client.Core.Offline.OfflineStore.DAL.$IL");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$I7.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.$I7");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$IO.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$IO",null,Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Hn);Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ip.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Common.$Ip");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Iq.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Iq");Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Iq);Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$QX",Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$Iq);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J");Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Common.$L");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$3a");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ir.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ir");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Il",null,Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v);Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Im.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Im",null,Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$7v);Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Ik");Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.Entities.$Em");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9u.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9u");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9w.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$9w");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$8F");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g");Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2.registerClass("Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$J2");Microsoft.Crm.Client.Core.Offline.$t.$AF=null;Microsoft.Crm.Client.Core.Offline.$1F.$sV=null;Microsoft.Crm.Client.Core.Offline.$1F.$Ev=null;Microsoft.Crm.Client.Core.Offline.$1F.$2PJ=null;Microsoft.Crm.Client.Core.Offline.$1F.$5b=null;Microsoft.Crm.Client.Core.Offline.$1F.$1b=null;Microsoft.Crm.Client.Core.Offline.$2t.$2EB=["firstname","middlename","lastname"];Microsoft.Crm.Client.Core.Offline.$2t.$2RX=["participationtypemask","activityid","activitypartyid","partyid","ispartydeleted","partyobjecttypecode"];Microsoft.Crm.Client.Core.Offline.$2t.$1ZG={from:"1",to:"2",cc:"3",bcc:"4",requiredattendees:"5",optionalattendees:"6",organizer:"7",regarding:"8",owner:"9",resources:"10",customer:"11",partner:"12"};Microsoft.Crm.Client.Core.Offline.$2t.$1Gi={"1":"from","2":"to","3":"cc","4":"bcc","5":"requiredattendees","6":"optionalattendees","7":"organizer","8":"regarding","9":"owner","10":"resources","11":"customer","12":"partner"};Microsoft.Crm.Client.Core.Offline.$68.$Ev=null;Microsoft.Crm.Client.Core.Offline.$l.$3=null;Microsoft.Crm.Client.Core.Offline.$K.$1XG=null;Microsoft.Crm.Client.Core.Offline.$K.$UN.$2AB="$_NORSYNC_CURRENT_TIME";Microsoft.Crm.Client.Core.Offline.$K.$UN.$2PQ="$_NORSYNC_TIMEZONE_OFFSET";Microsoft.Crm.Client.Core.Offline.$K.$UN.$2BJ="$_NORSYNC_DST_ADJUSTMENT";Microsoft.Crm.Client.Core.Offline.$2c.$Ev=null;Microsoft.Crm.Client.Core.Offline.$w.$D=null;Microsoft.Crm.Client.Core.Offline.$w.$2Z2="INSERT INTO _NORSYNC_SUPPRESS_TRIGGERS(value) VALUES(1)";Microsoft.Crm.Client.Core.Offline.$w.$2Z1="DELETE FROM _NORSYNC_SUPPRESS_TRIGGERS";Microsoft.Crm.Client.Core.Offline.$4b.$3=null;Microsoft.Crm.Client.Core.Offline.Common.QueryGenerator.$2N.$EG=null;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$3=null;this.$cI=0;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.PlaybackManager.$1JZ=null;this.$jm=null;Microsoft.Crm.Client.Core.Offline.Upsync.BatchManager.Handlers.$2e.$21F=new(Microsoft.Crm.Client.Core.Framework.List$1.$$(String))(["traversedpath","stageid","processid"]);Microsoft.Crm.Client.Core.Offline.Upsync.Common.$2J.$D=null;Microsoft.Crm.Client.Core.Offline.Upsync.UpSyncManager.$4g.$3=null
//# sourceMappingURL=../../../../../../../../../../Symbols/retail/amd64/jsmin/Microsoft.Crm.Client.Core.Offline.js.srcmap
