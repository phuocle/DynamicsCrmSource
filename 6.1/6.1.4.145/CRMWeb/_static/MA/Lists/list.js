function CreateMiniCampaign(){var oArgs={};oArgs.ObjectTypeCode=List;oArgs.MCOption=1;oArgs.TotalRecords=1;oArgs.SelectedRecords=1;oArgs.GridXml="";oArgs.Ids="";oArgs.CreatedFromOtc=CREATED_FROM_OTC;oArgs.MCOptionTitle=LOCID_MC_SELECTION_SELECTED;var idArray=new Array(1);idArray[0]=Xrm.Page.data.entity.getId();oArgs.Ids=idArray;var oUrl=Mscrm.CrmUri.create("/MA/MiniCampaign/MiniCampaign.aspx"),crmDialog=new Mscrm.CrmDialog(oUrl,oArgs,parseInt(LOCID_MC_WINDOW_WIDTH,10),parseInt(LOCID_MC_WINDOW_HEIGHT,10),null);crmDialog.setCallbackInfo("RefreshMiniCampaign",this);crmDialog.show()}function RefreshMiniCampaign(oResult){oResult&&auto(BulkOperation)}function FormOnLoad(){SetVisibleSubgrid();DisableLockStatus();UpdateClientListState()}function DisableLockStatus(obj,eventArgs){var lockstatusControl=Xrm.Page.getControl("lockstatus"),typeAttribute=Xrm.Page.data.entity.attributes.get("type");if(typeAttribute.getValue()){Xrm.Page.data.entity.attributes.get("lockstatus").setValue(0);lockstatusControl.setDisabled(true)}else lockstatusControl.setDisabled(false);CREATED_FROM_OTC=Xrm.Page.data.entity.attributes.get("createdfromcode").getValue()}function UpdateClientListState(context){var lockStatus=Xrm.Page.data.entity.attributes.get("lockstatus").getValue();window.IS_LIST_LOCKED=lockStatus;var listState=Xrm.Page.data.entity.attributes.get("statecode").getValue();window.LIST_STATE_CODE=listState=="0"?"Active":"Inactive"}function SetVisibleSubgrid(obj,eventArgs){var accountsGrid=$get("accounts_d"),contactsGrid=$get("contacts_d"),leadsGrid=$get("leads_d");if(!IsNull(accountsGrid)&&!IsNull(contactsGrid)&&!IsNull(leadsGrid)){var accountsRow=accountsGrid.parentNode.parentNode,contactsRow=contactsGrid.parentNode.parentNode,leadsRow=leadsGrid.parentNode.parentNode,memberTypeValue=Xrm.Page.data.entity.attributes.get("createdfromcode").getValue();accountsRow.style.display=memberTypeValue!=1?"none":"";contactsRow.style.display=memberTypeValue!=2?"none":"";leadsRow.style.display=memberTypeValue!=4?"none":""}}function locAssocObjMember(iType,sSubType,sAssociationName,iRoleOrdinal,parentId,parentObjectTypeCode){var parent=GetParentObject(parentId,parentObjectTypeCode);if(Xrm.Page.data.entity.attributes.get("type").getValue())OpenDynamicListQuery(iType,parent.objectTypeCode,parent.id);else OpenManageMembersWizard(iType,parent.objectTypeCode,parent.id,440,450)}function AddToCampaign(){doAction(null,List,"addtocampaign",Xrm.Page.data.entity.getId())}function locAssocObjList(iType,sSubType,sAssociationName,iRoleOrdinal,parentId,parentObjectTypeCode){var parent=GetParentObject(parentId,parentObjectTypeCode);switch(iType){case Campaign:var parameters=[iType,sSubType,sAssociationName,iRoleOrdinal,parent],callbackRef=Mscrm.Utilities.createCallbackFunctionObject("openListCaAssociation",this,parameters,false);LookupObjectsWithCallback(callbackRef,null,"single","4400",0);return;case BulkOperation:CreateMiniCampaign();return;default:var parameters=[iType,sSubType,sAssociationName,iRoleOrdinal,parent],callbackRef=Mscrm.Utilities.createCallbackFunctionObject("associateListAction",this,parameters,false);LookupObjectsWithCallback(callbackRef,null,"multi",iType,0);return}}function openListCaAssociation(lookupItems,iType,sSubType,sAssociationName,iRoleOrdinal,parent){if(IsNull(lookupItems)==false)if(lookupItems.items.length>0){var parameters=[lookupItems,iType,sSubType,sAssociationName,iRoleOrdinal,parent],oUrl=Mscrm.CrmUri.create("/_grid/cmds/dlg_listcaassociation.aspx?iObjType="+CrmEncodeDecode.CrmUrlEncode(iType)),crmDialog=new Mscrm.CrmDialog(oUrl,null,450,250,null);crmDialog.setCallbackInfo("performActionAfterListAssociate",this,parameters);crmDialog.show()}}function performActionAfterListAssociate(oResult,lookupItems,iType,sSubType,sAssociationName,iRoleOrdinal,parent){if(IsNull(lookupItems)==false)if(lookupItems.items.length>0){if(IsNull(oResult)==true)lookupItems=null;if(oResult)sSubType=sSubType+"addtoCA"}associateListAction(lookupItems,iType,sSubType,sAssociationName,iRoleOrdinal,parent)}function associateListAction(lookupItems,iType,sSubType,sAssociationName,iRoleOrdinal,parent){if(IsNull(lookupItems)==false)if(lookupItems.items.length>0){iRoleOrdinal=IsNull(iRoleOrdinal)?-1:iRoleOrdinal;!IsNull(parent)&&AssociateObjects(parent.objectTypeCode,parent.id,iType,lookupItems,iRoleOrdinal==-1?false:iRoleOrdinal==2,sSubType,sAssociationName)}}function mailMergeList(){if(Mscrm.Utilities.isIosDevice()){alert(LOCID_UNSUPPORTED_RIBBONACTION);return}try{var oUrl=Mscrm.CrmUri.create("/_grid/cmds/dlg_webmailmerge.aspx?objectTypeCode="+CrmEncodeDecode.CrmUrlEncode(List)+"&objectId="+CrmEncodeDecode.CrmUrlEncode(Xrm.Page.data.entity.getId())),dialogOptions=new Xrm.DialogOptions;dialogOptions.height=550;dialogOptions.width=600;Xrm.Internal.openDialog(oUrl.toString(),dialogOptions,null,null,null)}catch(e){onError(e)}}function isListActive(){var listStateCode;if(!Mscrm.InternalUtilities.JSTypes.isNull(window.LIST_STATE_CODE))listStateCode=window.LIST_STATE_CODE;else if(!Mscrm.InternalUtilities.JSTypes.isNull(window.parent.LIST_STATE_CODE))listStateCode=window.parent.LIST_STATE_CODE;else return false;if(listStateCode=="Inactive")return false;else return true}function isListUnLocked(){var lockStatus;if(!Mscrm.InternalUtilities.JSTypes.isNull(window.IS_LIST_LOCKED))lockStatus=window.IS_LIST_LOCKED;else if(!Mscrm.InternalUtilities.JSTypes.isNull(window.parent.IS_LIST_LOCKED))lockStatus=window.parent.IS_LIST_LOCKED;else return false;if(lockStatus)return false;else return true}