function CopyCampaignResponse(){if(Mscrm.Utilities.isRefreshForm())Mscrm.CampaignResponsePageHandler.copy();else CopyRemoteCommand()}function CopyRemoteCommand(){try{var command=new RemoteCommand("MarketingAutomation","CopyResponse"),campaignResponseId=Xrm.Page.data.entity.getId();command.SetParameter("campaignResponseId",campaignResponseId);var result=command.Execute(),copyCampaignResponseGuid=result.ReturnValue;openObj(CampaignResponse,copyCampaignResponseGuid)}catch(e){}}function ConvertResponse(){var customerItems=Xrm.Page.data.entity.attributes.get("customer").getValue(),sUrlElement="";if(customerItems&&customerItems.length==1)sUrlElement="customerId="+CrmEncodeDecode.CrmUrlEncode(customerItems[0].id)+"&customerType="+CrmEncodeDecode.CrmUrlEncode(customerItems[0].type)+"&customerName="+CrmEncodeDecode.CrmUrlEncode(customerItems[0].name);var oUrl=Mscrm.CrmUri.create("/MA/CampaignResponse/Dialogs/conv_response.aspx?"+sUrlElement),crmDialog=new Mscrm.CrmDialog(oUrl,null,475,550,null);crmDialog.setCallbackInfo("convertResponseCallback",this,null);crmDialog.show()}function convertResponseCallback(objRet){if(objRet)if(objRet.Convert)if(objRet.ConvertExistingLead)ConvertLead(objRet.Lead,objRet.ShowNew,objRet.LeadCompanyName);else Convert(objRet);else objRet.Close&&Close(objRet.ResponseState)}function Convert(objRet){if(Mscrm.Utilities.isRefreshForm())ConvertInlineEdit(objRet);else ConvertSubmitCrmForm(objRet)}function ConvertInlineEdit(objRet){Mscrm.CampaignResponsePageHandler.convert(boolToStr(objRet.Convert),boolToStr(objRet.CreateNewLead),boolToStr(objRet.Customer),boolToStr(objRet.Quote),boolToStr(objRet.Order),boolToStr(objRet.Opportunity),objRet.Account,objRet.Contact,objRet.Currency)}function ConvertSubmitCrmForm(objRet){var oCrConvert=createHiddenInput("crConvert",boolToStr(objRet.Convert)),oCrCreateNewLead=createHiddenInput("crCreateNewLead",boolToStr(objRet.CreateNewLead)),oCrCustomer=createHiddenInput("crCustomer",boolToStr(objRet.Customer)),oCrQuote=createHiddenInput("crQuote",boolToStr(objRet.Quote)),oCrOrder=createHiddenInput("crOrder",boolToStr(objRet.Order)),oCrOpportunity=createHiddenInput("crOpportunity",boolToStr(objRet.Opportunity)),oCrAccount=createHiddenInput("crAccount",objRet.Account),oCrContact=createHiddenInput("crContact",objRet.Contact),oCrCurrency=createHiddenInput("crCurrency",objRet.Currency);if(!$find("crmForm").SubmitCrmForm(CAMPAIGN_RESPONSE_CONVERTRESPONSE,true,true,false)){deleteInput(oCrConvert);deleteInput(oCrCreateNewLead);deleteInput(oCrCustomer);deleteInput(oCrQuote);deleteInput(oCrOrder);deleteInput(oCrOpportunity);deleteInput(oCrAccount);deleteInput(oCrContact);deleteInput(oCrCurrency)}}function Close(state){if(Mscrm.Utilities.isRefreshForm())Mscrm.CampaignResponsePageHandler.close(state);else CloseSubmitCrmForm(state)}function CloseSubmitCrmForm(state){var oCrNewState=createHiddenInput("newStateCode",state);!$find("crmForm").SubmitCrmForm(CAMPAIGN_RESPONSE_DEACTIVATE,true,true,false)&&deleteInput(oCrNewState)}function ConvertLead(leadId,ckShowNew,leadCompanyName){var cond=ckShowNew==true?"true":"false",parameters=[];parameters[0]=leadId;parameters[1]=leadCompanyName;var oUrl=Mscrm.CrmUri.create("/SFA/Leads/Dialogs/conv_lead.aspx?checkShowNew="+cond),crmDialog=new Mscrm.CrmDialog(oUrl,null,410,430,null);crmDialog.setCallbackInfo("performActionAfterConvertLead",this,parameters);crmDialog.show()}function performActionAfterConvertLead(objRetCl,leadId,leadCompanyName){if(objRetCl)if(objRetCl.qualify){if(!(typeof leadCompanyName==="undefined")&&leadCompanyName===""&&objRetCl.account){alert(LOCID_LEADCOMP_MUST_BE_SUPPLIED);return}if(objRetCl.parentAccount)QualifyLead(leadId,objRetCl.showNew,objRetCl.account,objRetCl.contact,objRetCl.opportunity,CAMPAIGN_RESPONSE_ACCOUNT,objRetCl.parentAccount,false);else if(objRetCl.parentContact)QualifyLead(leadId,objRetCl.showNew,objRetCl.account,objRetCl.contact,objRetCl.opportunity,CAMPAIGN_RESPONSE_CONTACT,objRetCl.parentContact,false);else QualifyLead(leadId,objRetCl.showNew,objRetCl.account,objRetCl.contact,objRetCl.opportunity,-1,null,false)}else objRetCl.unqualify&&UnqualifyLead(leadId,objRetCl.unqualifyStatus)}function QualifyLead(leadId,showNew,account,contact,opportunity,parentTypeId,parent,suppressDuplicateDetection){if(IsNull(parent)||parent.length==0)parent=CAMPAIGN_GUID_EMPTY;if(IsNull(leadId)||leadId.length==0)leadId=CAMPAIGN_GUID_EMPTY;if(typeof suppressDuplicateDetection=="undefined"||IsNull(suppressDuplicateDetection))suppressDuplicateDetection=false;var campaignItems=Xrm.Page.data.entity.attributes.get("regardingobjectid").getValue(),campaignId=CAMPAIGN_GUID_EMPTY,campaignType=CAMPAIGN_GUID_EMPTY;if(campaignItems&&campaignItems.length==1){campaignId=campaignItems[0].id;campaignType=campaignItems[0].type}if(Mscrm.Utilities.isRefreshForm())QualifyLeadInlineEdit(leadId,account,contact,campaignId,campaignType,opportunity,parent,parentTypeId,showNew,suppressDuplicateDetection);else QualifyLeadSubmitCrmForm(leadId,account,contact,campaignId,campaignType,opportunity,parent,parentTypeId,showNew,suppressDuplicateDetection)}function QualifyLeadInlineEdit(leadId,account,contact,campaignId,campaignType,opportunity,parent,parentTypeId,showNew,suppressDuplicateDetection){Mscrm.CampaignResponsePageHandler.convertAndQualifyLead(leadId,boolToStr(account),boolToStr(contact),boolToStr(opportunity),campaignId,campaignType,parent,parentTypeId,suppressDuplicateDetection,showNew)}function QualifyLeadSubmitCrmForm(leadId,account,contact,campaignId,campaignType,opportunity,parent,parentTypeId,showNew,suppressDuplicateDetection){var oShowNew=createHiddenInput("qlShowNew",boolToStr(showNew)),oCreateAccount=createHiddenInput("qlCreateAccount",boolToStr(account)),oCreateContact=createHiddenInput("qlCreateContact",boolToStr(contact)),oCreateOpportunity=createHiddenInput("qlCreateOpportunity",boolToStr(opportunity)),oOpportunityParentType=createHiddenInput("qlOpportunityParentType",parentTypeId),oOpportunityParentId=createHiddenInput("qlOpportunityParentId",parent),oLeadId=createHiddenInput("qlLeadId",leadId),ocampaignId=createHiddenInput("qlCampaignId",campaignId),ocampaignType=createHiddenInput("qlCampaignType",campaignType),oSuppressDuplicateDetection=createHiddenInput("qlSuppressDuplicateDetection",boolToStr(suppressDuplicateDetection));if(!$find("crmForm").SubmitCrmForm(CAMPAIGN_LEAD_QUALIFY,true,true,false)){deleteInput(oShowNew);deleteInput(oCreateAccount);deleteInput(oCreateContact);deleteInput(oCreateOpportunity);deleteInput(oOpportunityParentType);deleteInput(oOpportunityParentId);deleteInput(oLeadId);deleteInput(ocampaignId);deleteInput(ocampaignType);deleteInput(oSuppressDuplicateDetection)}}function UnqualifyLead(leadId,unqualifyStatus){if(Mscrm.Utilities.isRefreshForm())Mscrm.CampaignResponsePageHandler.closeAndDisqualifyLead(leadId,unqualifyStatus);else DisqualifyLeadSubmitCrmForm(leadId,unqualifyStatus)}function DisqualifyLeadSubmitCrmForm(leadId,unqualifyStatus){var oNewStatus=createHiddenInput("ulNewStatus",unqualifyStatus),oLeadId=createHiddenInput("ulLeadId",leadId);if(!$find("crmForm").SubmitCrmForm(CAMPAIGN_LEAD_UNQUALIFY,true,true,false)){deleteInput(oNewStatus);deleteInput(oLeadId)}}function isCampaignResponseOpen(){if(CAMPAIGNRESPONSE_STATE=="Open")return true;return false}