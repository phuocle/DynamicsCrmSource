Type.registerNamespace("Mscrm.FormInputControl");Mscrm.FormInputControl.LinkControlFlyOutType=function(){};Mscrm.FormInputControl.LinkControlFlyOutType.prototype={standard:0,composite:1};Mscrm.FormInputControl.LinkControlFlyOutType.registerEnum("Mscrm.FormInputControl.LinkControlFlyOutType",false);Mscrm.FormInputControl.LinkControlBehavior=function(element){this.$$d_$f_4=Function.createDelegate(this,this.$f_4);this.$$d_$j_4=Function.createDelegate(this,this.$j_4);this.$3_4={};this.$5_4=[];Mscrm.FormInputControl.LinkControlBehavior.initializeBase(this,[element]);var $$t_2=this;this.$J_4=function($p1_0){if($$t_2.get_isLinkControlInitialized())if(IsNull($$t_2.$E_4))$$t_2.openFlyOut($p1_0);else window[$$t_2.$E_4](null)}};Mscrm.FormInputControl.LinkControlBehavior.prototype={$a_4:null,$Z_4:null,$E_4:null,$O_4:null,$7_4:null,$D_4:null,$0_4:null,$H_4:false,$I_4:true,$1_4:null,$L_4:null,$F_4:null,$C_4:false,$V_4:false,$J_4:null,$U_4:false,$N_4:false,$W_4:false,$M_4:false,$9_4:null,$T_4:false,$S_4:null,$R_4:null,$B_4:null,$4_4:null,$A_4:null,$8_4:null,get_isEnabledForNewState:function(){return this.$M_4},set_isEnabledForNewState:function(value){this.$M_4=value;return value},get_isDirty:function(){return false},get_flyOutDialog:function(){return this.$0_4},get_initialLabel:function(){return this.$L_4},get_completedLabel:function(){return this.$F_4},set_completedLabel:function(value){this.$F_4=value;return value},get_isLinkControlInitialized:function(){return this.$U_4&&this.$N_4},get_wasFlyOutOpened:function(){return this.$W_4},get_anchor:function(){return this.$7_4},set_anchor:function(value){this.$7_4=value;return value},$P_4:function(){var $v_0=this.get_element().getAttribute(Mscrm.InlineEditConstants.LinkControlFlyOutType),$v_1=isNullOrEmptyString($v_0)?0:parseInt($v_0);return $v_1},get_viewport:function(){return this.$D_4},set_viewport:function(value){this.$D_4=value;return value},get_$Y_4:function(){if(IsNull(this.$8_4)){var $v_0=this.get_element().getAttribute("id"),$v_1=$get($v_0+"_flyoutContent");this.$8_4=$P_CRM($v_1)}return this.$8_4},get_$k_4:function(){if(IsNull(this.$A_4)){var $v_0=this.get_element().getAttribute("id"),$v_1=$get($v_0+"_flyoutLoadingArea");this.$A_4=$P_CRM($v_1)}return this.$A_4},get_showProgressIndicator:function(){return this.$C_4},set_showProgressIndicator:function(value){this.$C_4=value;if(this.$C_4&&IsNull(this.$4_4))this.$4_4=new Mscrm.ProgressControl;return value},get_hostId:function(){return this.$S_4},set_hostId:function(value){this.$S_4=value;return value},get_fieldName:function(){return this.$R_4},set_fieldName:function(value){this.$R_4=value;return value},get_isAssociatedStepCompleted:function(){if(!IsNull(this.$B_4)){this.$H_4=this.$B_4();this.$c_4()}return this.$H_4},set_isAssociatedStepCompleted:function(value){this.$H_4=value;this.$c_4();return value},get_onAssociatedStepCheck:function(){return this.$B_4},set_onAssociatedStepCheck:function(value){this.$B_4=value;return value},get_isEligibleForMarkComplete:function(){return this.$I_4},set_isEligibleForMarkComplete:function(value){this.$I_4=value;return value},onRender:function(){var $v_0=$P_CRM(this.get_element());if(!this.$X_4())$v_0.addClass("linkControlDisabled");else $v_0.hasClass("linkControlDisabled")&&$v_0.removeClass("linkControlDisabled")},initialize:function(){Mscrm.FormControlInputBehavior.prototype.initialize.call(this);var $v_0=this.$P_4();this.$0_4=new Mscrm.InlineFlyOutDialog;this.$0_4.set_shouldDisposeContent(false);switch($v_0){case 1:this.$0_4.set_position(Mscrm.FlyOutPosition.right);this.$0_4.set_isCompositeFlyOut(true);break;default:this.$0_4.set_position(Mscrm.FlyOutPosition.bottom);this.$0_4.set_isCompositeFlyOut(false);break}this.$0_4.get_options().set_showCloseButton(false);this.$0_4.get_options().set_showButtonPane(true);this.$0_4.get_options().set_applyAnchorClassChange(false);var $v_1=this.get_element().getAttribute("id");this.$1_4=$P_CRM(this.get_element());if(!IsNull($v_1)){this.$L_4=this.$1_4.text();this.$I_4=Boolean.parse(this.get_element().getAttribute("isEligibleForMarkComplete").toString());this.$g_4();var $v_2=this.get_$Y_4()[0];if(!IsNull($v_2)&&$v_2.hasChildNodes()){var $v_3=$v_2.getAttribute("flyoutWidthInPixels");!IsNull($v_3)&&this.$0_4.get_options().set_width(parseInt($v_3.toString()));var $v_4=$v_2.getAttribute("flyoutHeightInPixels");!IsNull($v_4)&&this.$0_4.get_options().set_height(parseInt($v_4.toString()));var $v_5=$v_2.getAttribute("flyoutTabIndex");!IsNull($v_5)&&this.$0_4.set_buttonsInitialTabIndex(parseInt($v_5.toString()));var $v_6=this.$h_4($v_2);this.setFlyOutViewport($v_6);this.$0_4.get_options().set_isInDelayMode(true);this.$0_4.setContent(this.get_$k_4());this.$7_4=this.$1_4;var $v_7=$v_2.getAttribute("flyOutTitle");if(!IsNull($v_7)){var $v_B=$v_7.toString();if($v_B.length){this.$0_4.get_options().set_title($v_B);this.$0_4.get_options().set_showTitlePane(true)}}var $v_8=$v_2.getAttribute("confirm");!IsNull($v_8)&&this.$0_4.setButtonTooltip(Mscrm.FlyOutButtonType.confirm,$v_8.toString());var $v_9=$v_2.getAttribute("cancel");!IsNull($v_9)&&this.$0_4.setButtonTooltip(Mscrm.FlyOutButtonType.cancel,$v_9.toString());var $$t_I=this;this.$0_4.bind(Mscrm.FlyOutDialogEventName.visibleChanged,function($p1_0){if(!$$t_I.$0_4.get_visible()){Mscrm.InlineEditCommonUtilities.setIFramesSourceUrls($v_2);$$t_I.$1_4.trigger(Mscrm.EditEvents.attributeChanged,[$$t_I.$1_4.data()])}else if($$t_I.$V_4)for(var $v_D=0;$v_D<$$t_I.$5_4.length;$v_D++){var $v_E=$$t_I.$5_4[$v_D];$v_E.handleLinkControlEvents()}if($$t_I.$0_4.get_visible()){$$t_I.$C_4&&$$t_I.$4_4.hide();for(var $v_F=0;$v_F<$$t_I.get_$Q_4().length;$v_F++){var $v_G=$$t_I.get_$Q_4()[$v_F];$v_G.resetLayout()}}});var $v_A=$v_2.getAttribute("flyout-opening");if(!IsNull($v_A))this.$a_4=$v_A.toString();$v_A=null;$v_A=$v_2.getAttribute("flyout-opened");if(!IsNull($v_A))this.$Z_4=$v_A.toString();$v_A=null;$v_A=$v_2.getAttribute(Mscrm.FlyOutDialogEventName.confirming);if(!IsNull($v_A))this.$O_4=$v_A.toString();$v_A=null;$v_A=$v_2.getAttribute("onclick");if(!IsNull($v_A))this.$E_4=$v_A.toString();this.$l_4($v_2);this.$i_4($v_2);if($v_0===1){var $v_C=this.$0_4.dialogChrome();$v_C.addClass("composite-callout");$v_C.addClass("composite-border-callout");$v_C.prepend('<b class="composite-notch"></b>');$v_C.prepend('<b class="composite-border-notch composite-notch"></b>')}this.onRender()}}$addHandler(this.get_element(),"click",this.$J_4);$addHandler(this.get_element(),"keydown",this.$$d_$j_4);$addHandler(this.get_element(),"keypress",this.$$d_$j_4);if($v_0===1){!window.UseTabletExperience&&$addHandler(window,"resize",this.$$d_$f_4);var $$t_J=this;this.$0_4.bind(Mscrm.FlyOutDialogEventName.overlayClicked,function(){$$t_J.$6_4($$t_J.$O_4)})}this.$0_4.get_visible()&&this.$b_4();this.$U_4=true},setFlyOutViewport:function(viewportObject){this.$0_4.set_viewport(viewportObject);this.$D_4=this.$0_4.get_viewport()},$h_4:function($p0){var $v_0=null,$v_1=$p0.getAttribute("flyoutviewportdomid");if(!IsNull($v_1))$v_0=$P_CRM("#"+$v_1.toString());else{$v_0=$P_CRM("#processControlContainer");if(0===$v_0.length)$v_0=$P_CRM("#HeaderTilesWrapperLayoutElement");if(0===$v_0.length)$v_0=$P_CRM("#crmFormHeaderTop")}if(0===$v_0.length)$v_0=$P_CRM("#HeaderTilesWrapperLayoutElement");return $v_0},$b_4:function(){if(this.$T_4)return;this.$T_4=true;var $v_0=this.get_$Y_4().find("div["+Mscrm.InlineEditConstants.HtmlAttributeForAttributeLogicalName+"]"),$v_1={},$$t_D=this;$v_0.each(function($p1_0,$p1_1){var $v_2=$P_CRM($p1_1),$v_3=$v_2.attr(Mscrm.InlineEditConstants.HtmlAttributeForFormDataEntityId),$v_4=$v_2.attr(Mscrm.InlineEditConstants.HtmlAttributeForAttributeLogicalName),$v_5=$v_1[$v_4];if(IsNull($v_5)){var $v_6=$find($v_3),$v_7=$v_6.get_attributes().get($v_4);$v_1[$v_4]=$v_7;$v_7.get_controls().forEach(function($p2_0,$p2_1){var $v_8=$p2_0;Array.add($$t_D.get_$Q_4(),$v_8)})}})},get_$Q_4:function(){if(IsNull(this.$9_4)){this.$9_4=new Array(0);this.$b_4()}return this.$9_4},subscribeToEvent:function(eventCode,eventHandler){if(!IsNull(eventHandler)){this.get_eventManager().subscribeEvent(eventCode,this.get_id());if(eventCode.toString() in this.$3_4){var $v_0=this.$3_4[eventCode.toString()];$v_0[$v_0.length]=eventHandler}else{var $v_1=[];$v_1[0]=eventHandler;this.$3_4[eventCode.toString()]=$v_1}}},handleEvent:function(eventCode,parameters,sourceComponent){if(eventCode.toString() in this.$3_4)for(var $v_0=this.$3_4[eventCode.toString()],$v_1=0;$v_1<$v_0.length;$v_1++){var $v_2=$v_0[$v_1];!IsNull($v_2)&&$v_2(this,eventCode,parameters,sourceComponent)}return Mscrm.CrmUIBehavior.prototype.handleEvent.call(this,eventCode,parameters,sourceComponent)},$j_4:function($p0){switch($p0.keyCode){case 13:if(IsNull(this.$E_4))this.openFlyOut($p0);else window[this.$E_4](null);$p0.preventDefault();$p0.stopPropagation();break;default:break}},$f_4:function($p0){if(this.$0_4.get_visible()){this.$0_4.hide();this.$6_4(this.$O_4)}},$g_4:function(){for(var $v_0=Mscrm.Utilities.getChildElementsByClassName(this.get_element().parentNode,"ms-crm-Form-SubGrid-Layout-Lite",false),$v_1=0;$v_1<$v_0.length;$v_1++){var $v_2=$v_0[$v_1].parentNode.id,$v_3=$find($v_2);if(!IsNull($v_3)){this.$V_4=true;Array.add(this.$5_4,$v_3)}}},$i_4:function($p0){var $v_0=$p0.getAttribute("flyout-initialize");if(null!==$v_0){var $v_1=$v_0.toString(),$$t_3=this;window.setTimeout(function(){$$t_3.$6_4($v_1);$$t_3.$N_4=true},0)}else this.$N_4=true},$K_4:function($p0,$p1){var $v_0=$p0.getAttribute($p1);if(!IsNull($v_0)){var $v_1=$v_0.toString(),$$t_5=this;this.$0_4.bind($p1,function($p1_0){$$t_5.$6_4($v_1)})}},$l_4:function($p0){this.$K_4($p0,Mscrm.FlyOutDialogEventName.confirming);this.$K_4($p0,Mscrm.FlyOutDialogEventName.confirmed);this.$K_4($p0,Mscrm.FlyOutDialogEventName.canceling);this.$K_4($p0,Mscrm.FlyOutDialogEventName.canceled)},dispose:function(){if(this.get_isDisposed())return;var $v_0=this.$P_4();if(!IsNull(this.get_element())){null!==this.$0_4&&this.$0_4.dispose();$removeHandler(this.get_element(),"click",this.$J_4);this.$J_4=null;$removeHandler(this.get_element(),"keydown",this.$$d_$j_4);$removeHandler(this.get_element(),"keypress",this.$$d_$j_4);$v_0===1&&!window.UseTabletExperience&&$removeHandler(window,"resize",this.$$d_$f_4)}if(!IsNull(this.$1_4)){this.$1_4.unbind();this.$1_4.remove()}this.$1_4=null;if(!IsNull(this.$A_4))this.$A_4=null;if(!IsNull(this.$8_4))this.$8_4=null;if(!IsNull(this.$4_4)){this.$4_4.dispose();Mscrm.Utilities.destroyObject(this.$4_4);this.$4_4=null}Mscrm.Utilities.destroyObject(this.$3_4);this.$3_4=null;Mscrm.Utilities.destroyObject(this.$9_4);this.$9_4=null;Mscrm.Utilities.destroyObject(this.$5_4);this.$5_4=null;this.$B_4=null;Mscrm.CrmUIBehavior.prototype.dispose.call(this)},openFlyOut:function(domEvent,anchorPoint){setPerfMarkerTimestamp(Mscrm.RefreshFormMarker.StartOpenFlyOut);if(!IsNull(domEvent)||!IsNull(anchorPoint)){if(!this.$X_4())return;if(!this.$I_4){var $$t_2=this;window.setTimeout(function(){$$t_2.$e_4(anchorPoint)},0)}this.$6_4(this.$a_4);if(this.$C_4){this.$4_4.show(Mscrm.InlineCommands.None);var $$t_3=this;window.setTimeout(function(){$$t_3.openFlyOutWithAnchor(anchorPoint)},0)}else this.openFlyOutWithAnchor(anchorPoint)}},$e_4:function($p0){var $v_0=null;if(!IsNull($p0))$v_0=$p0;else $v_0=this.$7_4;var $v_1="";if(!IsNull($v_0)&&!IsNull($v_0[0])){if(!isNullOrEmptyString($v_0[0].id))$v_1=$v_0[0].id.replace("_ledit","");else{var $v_2=XUI.Html.DomUtils.GetNextSibling(XUI.Html.DomUtils.GetNextSibling($v_0[0]));if(!IsNull($v_2)&&!isNullOrEmptyString($v_2.id))$v_1=$v_2.id.replace("_ledit","")}if(!IsNull($get($v_1))){var $v_3=Sys.UI.Behavior.getBehaviors($get($v_1));if(!IsNull($v_3)&&$v_3.length){var $v_4=$v_3[0];!IsNull($v_4)&&$v_4.hideValidationElement()}}}},openFlyOutWithAnchor:function(anchorPoint){if(!IsNull(anchorPoint))this.$0_4.show(anchorPoint,this.$D_4);else this.$0_4.show(this.$7_4,this.$D_4);this.$6_4(this.$Z_4);var $v_0=this.$P_4();$v_0===1&&this.$d_4();this.$W_4=true;setPerfMarkerTimestamp(Mscrm.RefreshFormMarker.FinishOpenFlyOut)},$d_4:function(){var $v_0=this.$0_4.dialogChrome().find(".composite-notch");if(this.$0_4.get_overflow())$v_0.addClass("flyout-overflow");else $v_0.removeClass("flyout-overflow")},get_flyOutId:function(){return this.$0_4.get_id()},$X_4:function(){var $v_0=$find(Mscrm.ClientApiConstants.primaryEntityId),$v_1=$v_0.get_isNew(),$v_2=$v_0.get_isDisabled();if($v_1&&!this.$M_4)return false;if($v_2)return false;return true},$6_4:function($p0){if(!IsNull($p0)){var $v_0=eval($p0);$v_0(this)}},$c_4:function(){if(isNullOrEmptyString(this.$F_4))return;if(this.$H_4)this.$1_4.text(this.$F_4);else this.$1_4.text(this.$L_4)}};Mscrm.FormInputControl.LinkControlInitializer=function(){};Mscrm.FormInputControl.LinkControlInitializer.initializeAllLinkControls=function(){$P_CRM("["+Mscrm.InlineEditConstants.HtmlAttributeForLinkControlBegin+"]").each(function($p1_0,$p1_1){var $v_0=false,$v_1=$p1_1.getAttribute("linkcontroldefinitionid");if(IsNull($v_1))$v_0=true;else if(IsNull(Mscrm.FormInputControl.LinkControlInitializer.$G[$v_1.toString()])||!Mscrm.FormInputControl.LinkControlInitializer.$G[$v_1.toString()]){$v_0=true;Mscrm.FormInputControl.LinkControlInitializer.$G[$v_1.toString()]=true}if($v_0){var $v_2={};$v_2["eventManager"]="__Page_crmEventManager";Mscrm.CrmUIComponent.crmCreate(Mscrm.FormInputControl.LinkControlBehavior,null,null,$v_2,$p1_1)}})};Mscrm.FormInputControl.LinkControlBehavior.registerClass("Mscrm.FormInputControl.LinkControlBehavior",Mscrm.FormControlInputBehavior,Mscrm.IProcessAwareDataUnboundControl);Mscrm.FormInputControl.LinkControlInitializer.registerClass("Mscrm.FormInputControl.LinkControlInitializer");Mscrm.FormInputControl.LinkControlInitializer.$G={}