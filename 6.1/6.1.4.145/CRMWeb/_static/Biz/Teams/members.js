var ACTION_ADD=0;function ModifyMembership(oInputGrid,refreshGridId,aTargetIds,action,oTypeToAdd,additionalParams,dataProvider){if(oInputGrid){var aTargetIds=getSelected(oInputGrid);if(IsNull(aTargetIds)||aTargetIds.length==0){alert(LOCID_ACTION_NOITEMSELECTED);return false}}var targetids="",lookupSelectionStatus="multi";if(oTypeToAdd==Territory)lookupSelectionStatus="single";for(i=0;i<aTargetIds.length;i++)targetids+=aTargetIds[i]+";";var parameters=[targetids,oTypeToAdd,action,refreshGridId],callbackRef=Mscrm.Utilities.createCallbackFunctionObject("modifyMemberShipAction",this,parameters,false);if(typeof dataProvider!="undefined"&&!isNullOrEmptyString(dataProvider))LookupObjectsWithCallback(callbackRef,null,lookupSelectionStatus,oTypeToAdd==AppSalesPerson?SystemUser:oTypeToAdd,0,null,additionalParams,0,0,1,"","",dataProvider);else LookupObjectsWithCallback(callbackRef,null,lookupSelectionStatus,oTypeToAdd==AppSalesPerson?SystemUser:oTypeToAdd,0,null,additionalParams)}function modifyMemberShipAction(retval,targetids,oTypeToAdd,action,refreshGridId){var memberXml="",retvals="";if(!retval||retval.items.length==0)return false;else{for(i=0;i<retval.items.length;i++)retvals+=retval.items[i].id+";";targetids=targetids.substr(0,targetids.length-1);retvals=retvals.substr(0,retvals.length-1);switch(oTypeToAdd){case SystemUser:case AppSalesPerson:memberXml="<membership><users>"+retvals+"</users><teams>"+targetids+"</teams></membership>";break;case Team:memberXml="<membership><users>"+targetids+"</users><teams>"+retvals+"</teams></membership>";oTypeToAdd=SystemUser;break;case Territory:memberXml="<membership><users>"+targetids+"</users><teams>"+retvals+"</teams></membership>";oTypeToAdd=AppSalesPerson;break}var oXml=XUI.Xml.LoadXml(memberXml),submitUrl=Mscrm.CrmUri.create("");if(action==ACTION_ADD)submitUrl=Mscrm.CrmUri.create("/_grid/cmds/cmd_adduserteam.aspx");var xmlhttp=new XMLHttpRequest;submitUrl.get_query()["iObjType"]=oTypeToAdd;xmlhttp.open("POST",submitUrl.toString(),false);Mscrm.Utilities.setResponseTypeToMSXml(xmlhttp);SetTokenInHeader(xmlhttp,submitUrl);xmlhttp.send(oXml);var oXml=xmlhttp.responseXML,gridControl=$find(refreshGridId);!Mscrm.InternalUtilities.JSTypes.isNull(gridControl)&&handleXMLErr(oXml)&&gridControl.Refresh()}}function processLookupIds(lookup_results,okButton){try{var oLUItems=lookup_results.items,oIds=new Array(oLUItems.length);if(oLUItems.length<1){okButton.disabled=true;return}for(i=0;i<oLUItems.length;++i)oIds[i]=oLUItems[i].id;okButton.disabled=false;__dialogXml="<userids>"+oIds.join(";")+"</userids>"}catch(e){okButton.disabled=__dialogXml==""}}