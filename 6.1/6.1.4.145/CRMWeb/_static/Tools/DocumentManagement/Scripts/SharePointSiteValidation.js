Type.registerNamespace("Mscrm");Mscrm.SharePointSiteValidationHelper=function(){};Mscrm.SharePointSiteValidationHelper.$Q=function($p0){var $v_0=function($p1_0){Mscrm.SharePointSiteValidationHelper.$S($p0)},$v_1=function($p1_0){Mscrm.SharePointSiteValidationHelper.$R($p0,$p1_0)};(new Mscrm.UrlValidatorUsingSharePointGrid).validateUrl(Mscrm.SharePointSiteValidationHelper.$7[$p0],Mscrm.SharePointSiteValidationHelper.$1[$p0],$v_0,$v_1)};Mscrm.SharePointSiteValidationHelper.$S=function($p0){Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_SUCCESS_MSG,"");$p0+1<Mscrm.SharePointSiteValidationHelper.$1.length&&Mscrm.SharePointSiteValidationHelper.validate($p0+1)};Mscrm.SharePointSiteValidationHelper.$R=function($p0,$p1){Mscrm.SharePointSiteValidationHelper.$K($p0)};Mscrm.SharePointSiteValidationHelper.$K=function($p0){var $v_0=function(){Mscrm.SharePointSiteValidationHelper.$L($p0)},$v_1=function($p1_0){Mscrm.SharePointSiteValidationHelper.$I($p0,$p1_0)};(new Mscrm.UrlValidatorUsingPing).pingUrl(Mscrm.SharePointSiteValidationHelper.$6[$p0],$v_0,$v_1)};Mscrm.SharePointSiteValidationHelper.$L=function($p0){Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_SUCCESS_MSG,"");$p0+1<Mscrm.SharePointSiteValidationHelper.$1.length&&Mscrm.SharePointSiteValidationHelper.validate($p0+1)};Mscrm.SharePointSiteValidationHelper.$I=function($p0,$p1){if($p1===Mscrm.SPSiteValidateResult.xmlHttpErrorUrlNotFound)Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_SP_VALIDATION_URL_FAIL);else if($p1===Mscrm.SPSiteValidateResult.xmlHttpException)Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_SP_VALIDATION_REASONS["5"]);else if($p1===Mscrm.SPSiteValidateResult.xmlHttpErrorDifferentSchemes)Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_SP_VALIDATION_REASONS["4"]);else if($p1===Mscrm.SPSiteValidateResult.xmlHttpErrorTimeout)Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_SP_VALIDATION_TIMEOUT);else if($p1===Mscrm.SPSiteValidateResult.emptyOrNullUrl)if(XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$p0],"LocationType",null))===Mscrm.EntityTypeCode.SharePointSite.toString())Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_DOCM_SPSITE_INVALIDPARENT);else Mscrm.SharePointSiteValidationHelper.updateValidationStatus($p0,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_DOCM_SPLOC_INVALIDPARENT);$p0+1<Mscrm.SharePointSiteValidationHelper.$1.length&&Mscrm.SharePointSiteValidationHelper.validate($p0+1)};Mscrm.SharePointSiteValidationHelper.validate=function(index){var $v_0=$get("siteValidationTable"),$v_1=$v_0.rows[index],$v_2=$v_1.cells[2],$v_3=document.createElement("img");$v_3.setAttribute("src","/_imgs/ico/16_progress.gif");$v_3.setAttribute("alt",window.LOCID_SP_VALIDATION_IN_PROGRESS);$v_2.appendChild($v_3);if(isNullOrEmptyString(Mscrm.SharePointSiteValidationHelper.$1[index]))Mscrm.SharePointSiteValidationHelper.$I(index,Mscrm.SPSiteValidateResult.emptyOrNullUrl);else if(XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[index],"IsGridPresent",null))==="1")Mscrm.SharePointSiteValidationHelper.$Q(index);else Mscrm.SharePointSiteValidationHelper.$K(index)};Mscrm.SharePointSiteValidationHelper.$H=function($p0){var $v_0=$p0.get_urlValidationResult(),$v_1=XUI.Xml.LoadXml($v_0),$v_2=XUI.Xml.SelectNodes($v_1,"/siteUrlsXml/siteUrl",null);if($v_2.length<1)$v_2=XUI.Xml.SelectNodes($v_1,"/locationUrlsXml/locationUrl",null);for(var $v_3,$v_4,$v_5=0;$v_5<$v_2.length;$v_5++){$v_3=Number.parseInvariant(XUI.Xml.GetText($v_2[$v_5].attributes.getNamedItem("index")));$v_4=XUI.Xml.GetText($v_2[$v_5]);if($v_4.toLowerCase()==="true")Mscrm.SharePointSiteValidationHelper.updateValidationStatus($v_3,window.LOCID_SP_VALIDATION_SUCCESS_MSG,"");else Mscrm.SharePointSiteValidationHelper.updateValidationStatus($v_3,window.LOCID_SP_VALIDATION_FAILURE_MSG,window.LOCID_SP_VALIDATION_URL_FAIL)}};Mscrm.SharePointSiteValidationHelper.$G=function($p0){var $v_0=$p0.get_organizationServiceFault();if(!IsNull($v_0)){var $v_1=$v_0.get_errorCode();Xrm.Internal.openErrorDialog($v_1,$p0.get_message())}};Mscrm.SharePointSiteValidationHelper.openFormLocation=function(e){var $v_0=e.target;while($v_0.tagName!=="A")$v_0=$v_0.parentNode;var $v_1=$v_0.attributes.getNamedItem("locationGuid"),$v_2=$v_0.attributes.getNamedItem("locationTypeCode"),$v_3=Mscrm.CrmUri.create("/userdefined/edit.aspx");$v_3.get_query()["etc"]=$v_2.value;$v_3.get_query()["id"]=$v_1.value;openStdWin($v_3,"openform",800,600,null)};Mscrm.SharePointSiteValidationHelper.$J=function(){var $v_0=$get("toBeValidated");XUI.Html.SetText($v_0,Mscrm.SharePointSiteValidationHelper.$5.toString());$v_0=$get("totalValidated");XUI.Html.SetText($v_0,Mscrm.SharePointSiteValidationHelper.$C.toString());$v_0=$get("successCount");XUI.Html.SetText($v_0,Mscrm.SharePointSiteValidationHelper.$B.toString());$v_0=$get("failureCount");XUI.Html.SetText($v_0,Mscrm.SharePointSiteValidationHelper.$A.toString())};Mscrm.SharePointSiteValidationHelper.$9=function($p0){var $v_0=$get($p0);$v_0.setAttribute("title",XUI.Html.GetText($v_0))};Mscrm.SharePointSiteValidationHelper.$M=function(){Mscrm.SharePointSiteValidationHelper.$9("columnHeader1");Mscrm.SharePointSiteValidationHelper.$9("columnHeader2");Mscrm.SharePointSiteValidationHelper.$9("columnHeader3");Mscrm.SharePointSiteValidationHelper.$9("columnHeader4")};Mscrm.SharePointSiteValidationHelper.process=function(){var $v_0=getDialogArguments();if(IsNull($v_0)||!$v_0.length)return;var $v_1=new RemoteCommand("DocumentManagementWebService","GetXmlForSharePointValidation");$v_0.type="string";$v_1.SetParameter("selectedRecords",$v_0);var $v_2=$v_1.Execute();if($v_2.Success){var $v_3=XUI.Xml.LoadXml($v_2.ReturnValue.toString());Mscrm.SharePointSiteValidationHelper.$M();Mscrm.SharePointSiteValidationHelper.$0=XUI.Xml.SelectNodes($v_3,"/Locations/Location",null);Mscrm.SharePointSiteValidationHelper.$5=Mscrm.SharePointSiteValidationHelper.$0.length;Mscrm.SharePointSiteValidationHelper.$J();Mscrm.SharePointSiteValidationHelper.$1=new Array(Mscrm.SharePointSiteValidationHelper.$0.length);Mscrm.SharePointSiteValidationHelper.$6=new Array(Mscrm.SharePointSiteValidationHelper.$0.length);Mscrm.SharePointSiteValidationHelper.$2=new Array(Mscrm.SharePointSiteValidationHelper.$0.length);Mscrm.SharePointSiteValidationHelper.$7=new Array(Mscrm.SharePointSiteValidationHelper.$0.length);Mscrm.SharePointSiteValidationHelper.$8={};for(var $v_4=$get("siteValidationTable"),$v_5=0;$v_5<Mscrm.SharePointSiteValidationHelper.$0.length;$v_5++){Mscrm.SharePointSiteValidationHelper.$6[$v_5]=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"EncodedUrl",null));Mscrm.SharePointSiteValidationHelper.$1[$v_5]=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"Url",null));Mscrm.SharePointSiteValidationHelper.$2[$v_5]=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"LocationId",null));Mscrm.SharePointSiteValidationHelper.$7[$v_5]=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"LocationSiteCollectionUrl",null));var $v_6=$v_4.rows.length,$v_7=$v_4.insertRow($v_6),$v_8=$v_7.insertCell(0);$v_8.className="mscrm-validate-RowColumn mscrm-validate-Column1-width";var $v_9=Mscrm.CrmUri.create("/userdefined/edit.aspx"),$v_A=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"LocationType",null));$v_9.get_query()["etc"]=$v_A;$v_9.get_query()["id"]=Mscrm.SharePointSiteValidationHelper.$2[$v_5];if(Number.parseInvariant($v_A)===Mscrm.EntityTypeCode.SharePointSite)Mscrm.SharePointSiteValidationHelper.$8[Mscrm.SharePointSiteValidationHelper.$1[$v_5]]=$v_5;else{if(IsNull(Mscrm.SharePointSiteValidationHelper.$4))Mscrm.SharePointSiteValidationHelper.$4={};Mscrm.SharePointSiteValidationHelper.$4[Mscrm.SharePointSiteValidationHelper.$1[$v_5]]=$v_5}var $v_B=XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[$v_5],"Name",null)),$v_C=document.createElement("a"),$v_D=document.createAttribute("locationGuid"),$v_E=document.createAttribute("locationTypeCode");$v_D.value=Mscrm.SharePointSiteValidationHelper.$2[$v_5];$v_E.value=$v_A;$v_C.attributes.setNamedItem($v_D);$v_C.attributes.setNamedItem($v_E);$addHandler($v_C,"click",Mscrm.SharePointSiteValidationHelper.openFormLocation);$v_C.setAttribute("title",$v_B);$v_C.setAttribute("href","javascript:;");$v_C.style.cursor="pointer";$v_C.className="mscrm-underlineOnHover";var $v_F=document.createElement("nobr"),$v_G=document.createElement("span");XUI.Html.SetText($v_G,$v_B);$v_F.appendChild($v_G);$v_C.appendChild($v_F);$v_8.appendChild($v_C);var $v_H=$v_7.insertCell(1),$v_I=Mscrm.SharePointSiteValidationHelper.$1[$v_5];$v_H.className="mscrm-validate-RowColumn mscrm-validate-Column2-width";var $v_J=document.createElement("a");$v_J.setAttribute("title",$v_I);$v_J.setAttribute("href",$v_I);$v_J.setAttribute("target","_blank");$v_J.className="ms-crm-gridUrl";$v_J.style.cursor="pointer";var $v_K=document.createElement("nobr"),$v_L=document.createElement("span");XUI.Html.SetText($v_L,$v_I);$v_K.appendChild($v_L);$v_J.appendChild($v_K);$v_H.appendChild($v_J);var $v_M=$v_7.insertCell(2);$v_M.className="mscrm-validate-RowColumn mscrm-validate-Column3-width";$v_M.innerHTML="&nbsp;";var $v_N=$v_7.insertCell(3);$v_N.className="mscrm-validate-RowColumn mscrm-validate-Column4-width";$v_N.innerHTML="&nbsp;"}if(!Mscrm.SharePointSiteValidationHelper.$D)Mscrm.SharePointSiteValidationHelper.validate(0);else Mscrm.SharePointSiteValidationHelper.$N()}};Mscrm.SharePointSiteValidationHelper.$N=function(){Mscrm.CrmHeader.setScriptFile(Mscrm.CrmUri.create("/_static/_common/scripts/jquery-1.11.3.min.js"),true);Mscrm.CrmHeader.setScriptFile(Mscrm.CrmUri.create("/_static/_common/scripts/CrmServiceProxyFramework.js"),true);Mscrm.CrmHeader.setScriptFile(Mscrm.CrmUri.create("/_static/_common/scripts/CrmServiceProxy.js"),true);Mscrm.SharePointSiteValidationHelper.$P();!IsNull(Mscrm.SharePointSiteValidationHelper.$4)&&Mscrm.SharePointSiteValidationHelper.$O()};Mscrm.SharePointSiteValidationHelper.$P=function(){var $v_0="<siteUrlsXml/>",$v_1=XUI.Xml.LoadXml($v_0),$v_2=XUI.Xml.SelectSingleNode($v_1,"/siteUrlsXml",null),$v_3,$$dict_4=Mscrm.SharePointSiteValidationHelper.$8;for(var $$key_5 in $$dict_4){var $v_4={key:$$key_5,value:$$dict_4[$$key_5]};$v_3=Mscrm.SharePointSiteValidationHelper.$F($v_1,$v_4,"siteUrl");$v_2.appendChild($v_3);Mscrm.SharePointSiteValidationHelper.$E($v_4)}Xrm.Internal.messages.validateUrl(XUI.Xml.XMLSerializer.serializeToString($v_1)).then(function($p1_0){Mscrm.SharePointSiteValidationHelper.$H($p1_0)},Mscrm.SharePointSiteValidationHelper.$G)};Mscrm.SharePointSiteValidationHelper.$F=function($p0,$p1,$p2){var $v_0;$v_0=$p0.createElement($p2);var $v_1=$p0.createAttribute("url");$v_1.value=$p1.key;$v_0.attributes.setNamedItem($v_1);var $v_2=$p0.createAttribute("index");$v_2.value=$p1.value.toString();$v_0.attributes.setNamedItem($v_2);var $v_3=$p0.createAttribute("id");$v_3.value=Mscrm.SharePointSiteValidationHelper.$2[Number.parseInvariant($p1.value.toString())];$v_0.attributes.setNamedItem($v_3);$v_0.appendChild($p0.createTextNode("false"));return $v_0};Mscrm.SharePointSiteValidationHelper.$E=function($p0){var $v_0=$get("siteValidationTable"),$v_1,$v_2;$v_1=$v_0.rows[Number.parseInvariant($p0.value.toString())];$v_2=document.createElement("img");$v_2.setAttribute("src","/_imgs/ico/16_progress.gif");$v_2.setAttribute("alt",window.LOCID_SP_VALIDATION_IN_PROGRESS);$v_1.cells[2].appendChild($v_2)};Mscrm.SharePointSiteValidationHelper.$O=function(){var $v_0="<locationUrlsXml/>",$v_1=XUI.Xml.LoadXml($v_0),$v_2=XUI.Xml.SelectSingleNode($v_1,"/locationUrlsXml",null),$v_3,$$dict_4=Mscrm.SharePointSiteValidationHelper.$4;for(var $$key_5 in $$dict_4){var $v_4={key:$$key_5,value:$$dict_4[$$key_5]};$v_3=Mscrm.SharePointSiteValidationHelper.$F($v_1,$v_4,"locationUrl");$v_2.appendChild($v_3);Mscrm.SharePointSiteValidationHelper.$E($v_4)}Xrm.Internal.messages.validateUrl(XUI.Xml.XMLSerializer.serializeToString($v_1)).then(function($p1_0){Mscrm.SharePointSiteValidationHelper.$H($p1_0)},Mscrm.SharePointSiteValidationHelper.$G)};Mscrm.SharePointSiteValidationHelper.updateValidationStatus=function(index,res,failureReason){var $v_0=Mscrm.SharePointSiteValidationHelper.$1[index];Mscrm.SharePointSiteValidationHelper.$5--;Mscrm.SharePointSiteValidationHelper.$C++;var $v_1,$v_2;if(res===window.LOCID_SP_VALIDATION_SUCCESS_MSG){$v_1=Mscrm.SPValidationStatusValue.urlValid;$v_2=Mscrm.SPValidationStatusReasonValue.urlValid;Mscrm.SharePointSiteValidationHelper.$B++}else{if(failureReason===window.LOCID_SP_VALIDATION_REASONS["4"]){$v_1=Mscrm.SPValidationStatusValue.urlCouldNotBeValidated;$v_2=Mscrm.SPValidationStatusReasonValue.xmlHttpErrorDifferentSchemes}else if(failureReason===window.LOCID_SP_VALIDATION_REASONS["5"]){$v_1=Mscrm.SPValidationStatusValue.urlCouldNotBeValidated;$v_2=Mscrm.SPValidationStatusReasonValue.xmlHttpIESettingException}else{$v_1=Mscrm.SPValidationStatusValue.urlInvalid;$v_2=Mscrm.SPValidationStatusReasonValue.urlInvalid}Mscrm.SharePointSiteValidationHelper.$A++}if(!Mscrm.SharePointSiteValidationHelper.$D&&XUI.Xml.GetText(XUI.Xml.SelectSingleNode(Mscrm.SharePointSiteValidationHelper.$0[index],"LocationType",null))===Mscrm.EntityTypeCode.SharePointSite.toString()){var $v_9=new RemoteCommand("DocumentManagementWebService","UpdateLastValidated");$v_9.SetParameter("id",Mscrm.SharePointSiteValidationHelper.$2[index]);$v_9.SetParameter("logicalName","sharepointsite");$v_9.SetParameter("validationStatus",$v_1);$v_9.SetParameter("validationStatusReason",$v_2);$v_9.Execute()}var $v_3=$get("siteValidationTable"),$v_4=$v_3.rows[index],$v_5=$v_4.cells[2],$v_6=$v_4.cells[3],$v_7=$v_5.getElementsByTagName("IMG"),$v_8=$v_7[0];$v_8.style.display="none";XUI.Html.SetText($v_5,res);$v_5.setAttribute("title",res);if(res===window.LOCID_SP_VALIDATION_SUCCESS_MSG){$v_5.className="mscrm-validate-RowColumn mscrm-validate-Column3-width mscrm-validate-Success";$v_6.innerHTML="&nbsp;"}else{$v_5.className="mscrm-validate-RowColumn mscrm-validate-Column3-width mscrm-validate-Failure";XUI.Html.SetText($v_6,failureReason);$v_6.setAttribute("title",failureReason)}Mscrm.SharePointSiteValidationHelper.$J()};Mscrm.SharePointSiteValidationHelper.isValidationRunning=function(){return Mscrm.SharePointSiteValidationHelper.$5>0};Mscrm.SharePointSiteValidationHelper.registerClass("Mscrm.SharePointSiteValidationHelper");Mscrm.SharePointSiteValidationHelper.$1=null;Mscrm.SharePointSiteValidationHelper.$6=null;Mscrm.SharePointSiteValidationHelper.$2=null;Mscrm.SharePointSiteValidationHelper.$7=null;Mscrm.SharePointSiteValidationHelper.$0=null;Mscrm.SharePointSiteValidationHelper.$8=null;Mscrm.SharePointSiteValidationHelper.$4=null;Mscrm.SharePointSiteValidationHelper.$5=0;Mscrm.SharePointSiteValidationHelper.$C=0;Mscrm.SharePointSiteValidationHelper.$B=0;Mscrm.SharePointSiteValidationHelper.$A=0;Mscrm.SharePointSiteValidationHelper.$D=Mscrm.FeatureControl.get_Current().isFeatureEnabled(Mscrm.FeatureNames.SharePointS2S)