Type.registerNamespace("Mscrm");Mscrm.SolutionExportWizardReturnValue=function(){};Mscrm.AsyncJobCommandParameter=function(){};Mscrm.SolutionHandler=function(){};Mscrm.SolutionHandler.publishSolution=function(){Mscrm.FormAction.onActionMenuClick("publishsolution",Mscrm.EntityTypeCode.Solution)};Mscrm.SolutionHandler.publishAllCustomization=function(){DisplayActionMsg(window.LOCID_ENTUTL_PUBLISHINGENT,400,150);window.setTimeout(Mscrm.SolutionHandler.$6,200)};Mscrm.SolutionHandler.$6=function(){try{var $v_0=new Mscrm.RemoteCommandXml("SystemCustomization","PublishAllCustomizations"),$v_1=$v_0.execute(null)}finally{HideActionMsg();var $v_2=$get("areaSolutionComponentFrame");if(!IsNull($v_2)){var $v_3=$v_2.contentWindow.document;if(!IsNull($v_3)){var $v_4=$find("gridDisplayStrings");!IsNull($v_4)&&$v_4.refresh()}}}};Mscrm.SolutionHandler.importSolution=function(){var $v_0=Mscrm.CrmUri.create("/tools/solution/import/SolutionImportWizard.aspx"),$v_1=Mscrm.WindowInformation.getWindowInformation(9208);openStdWin($v_0,null,$v_1.Width,$v_1.Height,null)};Mscrm.SolutionHandler.openSolutionsMarketplace=function(){openStdWin(Mscrm.CrmUri.create(SOLUTIONS_MARKETPLACE_URL),null,window.screen.availWidth*.9,window.screen.availHeight*.9,"scrollbars=1,toolbar=1,menubar=1,location=1")};Mscrm.SolutionHandler.exportSolution=function(solutionId){var $v_0=Mscrm.CrmUri.create("/WebWizard/WizardContainer.aspx?WizardId=BB1FACEB-E1F0-4FE7-91D3-8C9DEEB4885D");$v_0.get_query()["appSolutionId"]=solutionId;var $v_1=Mscrm.WindowInformation.getWindowInformation(Mscrm.EntityTypeCode.SolutionExportWizard),$v_2=new Xrm.DialogOptions;$v_2.width=$v_1.Width;$v_2.height=$v_1.Height;var $v_3=[solutionId],$v_4=Mscrm.InternalUtilities.GridUtilities.createCallbackFunctionFactory(Mscrm.SolutionHandler.exportSolutionWizardCallback,$v_3);Xrm.Internal.openDialog($v_0.toString(),$v_2,null,null,$v_4)};Mscrm.SolutionHandler.exportSolutionWizardCallback=function(result,solutionId){if(!IsNull(result)&&result.bExport){var $v_0=Mscrm.CrmUri.create("/_grid/cmds/dlg_exportsolution.aspx");$v_0.get_query()["appSolutionId"]=solutionId;$v_0.get_query()["command"]="exportsolution";$v_0.get_query()["ismanaged"]=result.bProtected?"1":"0";if(!isNullOrEmptyString(result.sTargetVersion))$v_0.get_query()["targetVersion"]=result.sTargetVersion;if(!isNullOrEmptyString(result.sOptionsXML))$v_0.get_query()["optionxml"]=result.sOptionsXML;!isNullOrEmptyString(result.wrpcTokenAsQueryString)&&$v_0.appendToQuery(result.wrpcTokenAsQueryString);Mscrm.SolutionHandler.doExportWithFileContent($v_0.toString(),result.sFileContent)}};Mscrm.SolutionHandler.doExport=function(url){Mscrm.SolutionHandler.doExportWithFileContent(url,null)};Mscrm.SolutionHandler.doExportWithFileContent=function(url,fileContent){var $v_0=window.document.getElementsByName("exportWizardFormId")[0];if(IsNull($v_0)){$v_0=window.document.createElement("form");$v_0.setAttribute("name","exportWizardFormId");$v_0.setAttribute("method","post");$v_0.setAttribute("style","display:none");document.body.appendChild($v_0)}var $v_1=null;if(!isNullOrEmptyString(fileContent)){$v_1=window.document.createElement("input");$v_1.type="hidden";$v_1.name="fileContent";$v_1.value=fileContent;$v_0.appendChild($v_1)}$v_0.action=url;$v_0.target="exportFrame";$v_0.submit();!IsNull($v_1)&&$v_0.removeChild($v_1)};Mscrm.SolutionHandler.exportTranslation=function(solutionId){if(Mscrm.SolutionHandler.isSolutionManaged()==="1"){confirm(window.LOCID_EXPORT_TRANSLATION_ERROR);return}if(confirm(window.LOCID_EXPORT_TRANSLATION_WARN)){var $v_0=Mscrm.CrmUri.create("/_grid/cmds/dlg_exportsolution.aspx");$v_0.get_query()["appSolutionId"]=solutionId;$v_0.get_query()["command"]="exporttranslation";Mscrm.SolutionHandler.doExport($v_0.toString())}};Mscrm.SolutionHandler.importTranslation=function(solutionId){var $v_0=Mscrm.CrmUri.create("/tools/muiProvisioning/Dialogs/LangTranslationsImport.aspx");$v_0.get_query()["appSolutionId"]=solutionId;var $v_1=new Xrm.DialogOptions;$v_1.height=270;$v_1.width=600;Xrm.Internal.openDialog($v_0.toString(),$v_1,null,null,null)};Mscrm.SolutionHandler.importTranslationFromGrid=function(){var $v_0=Mscrm.SolutionHandler.selectedElements(),$v_1=null;if($v_0.length<1){alert(window.LOCID_SELECTONE_WARN);return}if($v_0.length>1){alert(window.LOCID_ONLYSELECTONE_WARN);return}$v_1=$v_0[0];Mscrm.SolutionHandler.importTranslation($v_1)};Mscrm.SolutionHandler.selectedElements=function(){return getSelected("crmGrid")};Mscrm.SolutionHandler.isSolutionManaged=function(){var $v_0=$find("crmGrid");if(!$v_0)return "0";else{var $v_1=$v_0.get_selectedIds()[0];return $v_0.getCellValue("ismanaged",$v_1)}};Mscrm.SolutionHandler.publishFromGrid=function(){var $v_0=Mscrm.SolutionHandler.selectedElements(),$v_1=null;if($v_0.length<1){alert(window.LOCID_SELECTONE_WARN);return}if($v_0.length>1){alert(window.LOCID_ONLYSELECTONE_WARN);return}$v_1=$v_0[0];doAction("crmGrid",Mscrm.EntityTypeCode.Solution,"publishsolution",$v_1)};Mscrm.SolutionHandler.deleteSolution=function(){var $v_0=Mscrm.SolutionHandler.selectedElements();if($v_0.length<1){alert(window.LOCID_SELECTONE_WARN);return}if($v_0.length>1){alert(window.LOCID_ONLYSELECTONE_WARN);return}var $v_1=$v_0[0],$v_2=Mscrm.CrmUri.create("/tools/solution/dlg_uninstall.aspx");$v_2.get_query()["id"]=$v_1;var $v_3=new Xrm.DialogOptions;$v_3.height=275;$v_3.width=570;Xrm.Internal.openDialog($v_2.toString(),$v_3,null,null,Mscrm.SolutionHandler.refreshGridCallback)};Mscrm.SolutionHandler.refreshGridCallback=function(){refreshGrid("crmGrid")};Mscrm.SolutionHandler.exportSolutionFromGrid=function(){var $v_0=Mscrm.SolutionHandler.selectedElements();if($v_0.length<1){alert(window.LOCID_SELECTONE_WARN);return}if($v_0.length>1){alert(window.LOCID_ONLYSELECTONE_WARN);return}var $v_1=$v_0[0];Mscrm.SolutionHandler.exportSolution($v_1)};Mscrm.SolutionHandler.exportTranslationFromGrid=function(){var $v_0=Mscrm.SolutionHandler.selectedElements(),$v_1="";if($v_0.length<1){alert(window.LOCID_SELECTONE_WARN);return}if($v_0.length>1){alert(window.LOCID_ONLYSELECTONE_WARN);return}$v_1=$v_0[0];Mscrm.SolutionHandler.exportTranslation($v_1)};Mscrm.SolutionHandler.onDisplayNameChange=function(){var $v_0=$get("crmFormSubmit");if(!IsNull($v_0))if(IsNull($v_0.crmFormSubmitId.value)||$v_0.crmFormSubmitId.value===""){var $v_1=Mscrm.FormControlInputBehavior.GetBehavior("friendlyname"),$v_2=Mscrm.FormControlInputBehavior.GetBehavior("uniquename"),$v_3=$v_1.get_dataValue(),$v_4=$v_2.get_dataValue();if(!IsNull($v_3)&&$v_3.length>0&&(IsNull($v_4)||!$v_4.length)){var $v_5=new RegExp("[^A-Za-z0-9_]","g");$v_2.set_dataValue($v_3.replace($v_5,"").substr(0,$v_2.get_maxLength()))}}};Mscrm.AsyncJobCommand=function(input){this.$$d_$9_0=Function.createDelegate(this,this.$9_0);this.$$d_$5_0=Function.createDelegate(this,this.$5_0);this.$$d_$8_0=Function.createDelegate(this,this.$8_0);this.$$d_$7_0=Function.createDelegate(this,this.$7_0);if(IsNull(input)||IsNull(input.cmd))throw Error.argumentNull("input","null or recommand command is not defined");this.$0_0=input};Mscrm.AsyncJobCommand.prototype={$2_0:null,$3_0:false,$0_0:null,$1_0:"",$7_0:function($p0,$p1){if("ServerError"===$p0)return;if(!IsNull(this.$2_0))try{if(!this.$3_0){this.$4_0();this.$2_0($p0,$p1);!IsNull(this.$0_0.postAction)&&this.$0_0.postAction(false)}}catch($$e_2){}},$8_0:function($p0,$p1){if(!IsNull($p0)&&$p0.Success)if(!this.$3_0){this.$4_0();!IsNull(this.$0_0.postAction)&&this.$0_0.postAction(true)}},executeCommand:function(){this.$1_0=Mscrm.Utilities.createGuid();this.$2_0=this.$0_0.cmd.ErrorHandler;this.$0_0.cmd.ErrorHandler=this.$$d_$7_0;this.$0_0.cmd.SetParameter("importJobId",this.$1_0);this.$0_0.cmd.Execute(this.$$d_$8_0);!IsNull(this.$0_0.preAction)&&this.$0_0.preAction();window.setTimeout(this.$$d_$5_0,1e3)},$4_0:function(){this.$3_0=true;if(!isNullOrEmptyString(this.$1_0)){var $v_0=new RemoteCommand("ImportJob","DeleteJob");$v_0.ErrorHandler=this.$$d_$9_0;$v_0.SetParameter("importJobId",this.$1_0);$v_0.Execute();this.$1_0=""}},$5_0:function(){if(this.$3_0)return;var $v_0=new RemoteCommand("ImportJob","RetrieveProgress");$v_0.ErrorHandler=this.$$d_$9_0;$v_0.SetParameter("id",this.$1_0);try{var $v_1=$v_0.Execute();if($v_1.Success){var $v_2=$v_1.ReturnValue;if(!IsNull($v_2)&&$v_2!==""){var $v_3=XUI.Xml.LoadXml($v_2);if(!IsNull($v_3)){var $v_4=XUI.Xml.SelectSingleNode($v_3,"importexportxml",null);if($v_4)if(!IsNull($v_4.attributes.getNamedItem("succeeded"))&&$v_4.attributes.getNamedItem("succeeded").nodeValue!==""){if(!this.$3_0){var $v_5=true;this.$4_0();if($v_4.attributes.getNamedItem("succeeded").nodeValue==="false"){var $v_6=$v_4.attributes.getNamedItem("errorcode").nodeValue,$v_7=null;if(!IsNull($v_4.attributes.getNamedItem("errormessage")))$v_7=XUI.Xml.LoadXml($v_4.attributes.getNamedItem("errormessage").nodeValue);!IsNull(this.$2_0)&&this.$2_0($v_6,$v_7);$v_5=false}!IsNull(this.$0_0.postAction)&&this.$0_0.postAction($v_5)}return}}}}}catch($$e_8){}window.setTimeout(this.$$d_$5_0,1e3)},$9_0:function($p0,$p1){}};Mscrm.SolutionExportWizardReturnValue.registerClass("Mscrm.SolutionExportWizardReturnValue");Mscrm.AsyncJobCommandParameter.registerClass("Mscrm.AsyncJobCommandParameter");Mscrm.SolutionHandler.registerClass("Mscrm.SolutionHandler");Mscrm.AsyncJobCommand.registerClass("Mscrm.AsyncJobCommand")