Type.registerNamespace("Mscrm");Mscrm.DashboardEditorConstants=function(){};Mscrm.DashboardEditorUtils=function(){};Mscrm.DashboardEditorUtils.refreshPreviewAsync=function(visualizationId,isUserChart,viewId,isUserView,formAccessType,componentId){var $v_0=isUserChart==="true"?Mscrm.EntityTypeCode.UserQueryVisualization:Mscrm.EntityTypeCode.SavedQueryVisualization,$v_1=isUserView==="true"?Mscrm.EntityTypeCode.UserQuery:Mscrm.EntityTypeCode.SavedQuery,$v_2=formAccessType===Mscrm.EntityTypeCode.SystemForm?false:true;window.setTimeout(function(){Mscrm.DashboardEditorUtils.refreshPreview(visualizationId,$v_0,viewId,$v_1,$v_2,componentId,true)},0)};Mscrm.DashboardEditorUtils.refreshPreview=function(visualizationId,visualizationType,viewId,viewType,isUserDashboard,componentId,fromDashboardEditor){var $v_0="/Visualization/visualization.aspx",$v_1=visualizationId.replace("{","").replace("}",""),$v_2=Mscrm.DashboardEditorUtils.$0("vizForm",componentId),$v_3=$get($v_2),$v_4=Mscrm.DashboardEditorUtils.$0("previewFrame",componentId),$v_5=$get($v_4);if(IsNull($v_5))return;var $v_6=$v_5.parentNode.clientWidth-10,$v_7=$v_5.parentNode.clientHeight-10,$v_8="",$v_9=Mscrm.DashboardEditorUtils.$0("vizXml",componentId),$v_A=$get($v_9);if(!IsNull($v_3)&&fromDashboardEditor)if($v_3.action.indexOf($v_0)!==-1){Mscrm.DashboardEditorUtils.onPreviewChartLoaded(componentId,fromDashboardEditor);return}var $v_B=Mscrm.CrmUri.create($v_0),$v_C=Math.random();$v_B.get_query()["uniqueId"]=$v_C.toString()+$v_1;var $v_D=$v_B.toString();$v_3.action=$v_D;if(visualizationId==="{00000000-0000-0000-0000-000000000000}"||visualizationId.length<36){Mscrm.DashboardEditorUtils.initializeChartFrame(componentId);return}Mscrm.DashboardEditorUtils.showDiv("previewLoadingDiv",componentId);var $v_E={};$v_E["visualizationId"]=visualizationId;$v_E["visType"]=visualizationType;$v_E["viewId"]=viewId;$v_E["viewType"]=viewType;$v_E["paneContentWidth"]=$v_6;$v_E["paneContentHeight"]=$v_7;$v_E["isPreview"]="true";$v_E["detailedPreview"]="true";$v_E["isSubGridMode"]="true";$v_E["isDashboardComponent"]="true";$v_E["enableViewPicker"]="false";$v_E["ie-browser-version"]=Mscrm.Utilities.get_ieBrowserVersion().toString();if(isUserDashboard)$v_E["fetchPublishedForSystem"]="true";var $v_F="<{0}{1}>{2}</{0}>",$v_G=new Sys.StringBuilder("<vizXml>"),$$dict_O=$v_E;for(var $$key_P in $$dict_O){var $v_H={key:$$key_P,value:$$dict_O[$$key_P]},$v_I=!$v_H.value?"":$v_H.value,$v_J="";$v_G.append(String.format($v_F,CrmEncodeDecode.CrmXmlEncode($v_H.key),$v_J,CrmEncodeDecode.CrmXmlEncode($v_I)))}$v_G.append("</vizXml>");$v_8=$v_G.toString();$v_A.value=$v_8;$v_3.submit()};Mscrm.DashboardEditorUtils.initializeChartFrame=function(componentId){var $v_0=Mscrm.DashboardEditorUtils.$0("previewFrame",componentId);!IsNull($get($v_0))&&$get($v_0).contentWindow.location.replace(Mscrm.CrmUri.create("/_static/blank.htm").toString())};Mscrm.DashboardEditorUtils.onPreviewChartLoadedHandler=function(domEvent){Mscrm.DashboardEditorUtils.onPreviewChartLoaded()};Mscrm.DashboardEditorUtils.onPreviewChartLoaded=function(componentId,fromDashboardEditor){var $v_0=Mscrm.DashboardEditorUtils.$0("previewFrame",componentId),$v_1=$get($v_0),$v_2=$v_1;if(!IsNull($v_2)&&!IsNull($v_2.contentWindow)&&!IsNull($v_2.contentWindow.document)){var $v_3=$v_2.contentWindow.document.getElementsByTagName("BODY")[0];if(fromDashboardEditor)if(!IsNull($v_3)){var $v_5=function($p1_0){Mscrm.DashboardEditorUtils.setActiveObjectForCell($p1_0,$v_2)};$addHandler($v_3,"mousedown",$v_5);$addHandler($v_3,"click",$v_5);var $v_6=function($p1_0){Mscrm.DashboardEditorUtils.viewPropertiesNowForCell($p1_0,$v_2)};$addHandler($v_3,"dblclick",$v_6);var $v_7=function($p1_0){Mscrm.DashboardEditorUtils.onDocumentMouseUpForCell($p1_0)};$addHandler($v_2.contentWindow.document,"mouseup",$v_7)}!IsNull($v_3)&&!isNullOrEmptyString($v_3.innerHTML)&&Mscrm.DashboardEditorUtils.showDiv("previewFrame",componentId);var $v_4=$v_2.contentWindow.document.getElementById("CrmChart");!IsNull($v_4)&&XUI.Html.SetOpacity($v_4,1);$clearHandlers($v_1.contentWindow);fromDashboardEditor&&$clearHandlers($v_1)}};Mscrm.DashboardEditorUtils.clearHandlersFromIframes=function(element){var $v_0=null;if(IsNull(element))$v_0=document.getElementsByTagName("IFRAME");else $v_0=element.getElementsByTagName("IFRAME");for(var $v_1=0;$v_1<$v_0.length;$v_1++){if($v_0[$v_1].className==="socialInsightsPreviewFrame")continue;$v_0[$v_1].src="";$clearHandlers($v_0[$v_1].contentWindow);$clearHandlers($v_0[$v_1])}};Mscrm.DashboardEditorUtils.showDiv=function(divTobeShown,componentId){var $v_0=Mscrm.DashboardEditorUtils.$0("previewFrame",componentId),$v_1=Mscrm.DashboardEditorUtils.$0("previewLoadingDiv",componentId),$v_2=Mscrm.DashboardEditorUtils.$0("contentDiv",componentId),$v_3=$get($v_0),$v_4=$get($v_1),$v_5=$get($v_2);if(!IsNull($v_3))$v_3.style.display=divTobeShown==="previewFrame"?"inline":"none";if(!IsNull($v_4))$v_4.style.display=divTobeShown==="previewLoadingDiv"?"inline":"none";if(!IsNull($v_5))$v_5.style.display=divTobeShown==="contentDiv"?"inline":"none"};Mscrm.DashboardEditorUtils.viewPropertiesNowForCell=function(domEvent,element){Mscrm.DashboardEditorUtils.$2(domEvent);ViewPropertiesNow(domEvent,element)};Mscrm.DashboardEditorUtils.setActiveObjectForCell=function(domEvent,element){Mscrm.DashboardEditorUtils.$2(domEvent);SetActiveObject(domEvent,element)};Mscrm.DashboardEditorUtils.onDocumentMouseUpForCell=function(domEvent){Mscrm.DashboardEditorUtils.$2(domEvent);OnDocumentMouseUp()};Mscrm.DashboardEditorUtils.registerDragObjectForCell=function(domEvent,element){Mscrm.DashboardEditorUtils.$2(domEvent);RegisterDragObject(domEvent,"fromMainCanvas",element)};Mscrm.DashboardEditorUtils.refreshSocialInsightsPreviewAsync=function(formAccessType,formId,componentId){window.setTimeout(function(){Mscrm.DashboardEditorUtils.refreshSocialInsightsPreview(formAccessType,formId,componentId)},0)};Mscrm.DashboardEditorUtils.refreshSocialInsightsPreview=function(formAccessType,formId,componentId){var $v_0=new Microsoft.Crm.Core.Application.WebServices.SocialInsightsConfiguration;$v_0.FormTypeCode=formAccessType;$v_0.FormId=formId;$v_0.ControlId=componentId;var $v_1=Mscrm.DashboardEditorUtils.$0("socialInsightsPreviewFrame",componentId),$v_2=Mscrm.DashboardEditorUtils.$0("socialInsightsPreviewOverlay",componentId),$v_3=Mscrm.DashboardEditorUtils.$0("socialInsightsPreviewErrorMessage",componentId);if(!window._IsSocialInsightsInstanceAvailable){Mscrm.DashboardEditorUtils.socialInsightsPreviewError(window.LOCID_NETBREEZE_NO_INSTANCE,$v_1,$v_2,$v_3);return}if((new Microsoft.Dynamics.Client.Core.Framework.Guid($v_0.FormId)).toString()===Microsoft.Dynamics.Client.Core.Framework.Guid.get_empty().toString()){var $v_4=Mscrm.FormEditorVariables.socialInsightsConfigurations[$v_0.ControlId];Mscrm.DashboardEditorUtils.$3($v_1,$v_2,$v_3,$v_4)}else(new Mscrm.SocialInsights.SocialInsightsConfigurationService).retrieve($v_0).done(function($p1_0){Mscrm.DashboardEditorUtils.$3($v_1,$v_2,$v_3,$p1_0)}).fail(function($p1_0){Mscrm.DashboardEditorUtils.socialInsightsPreviewError(window.LOCID_NETBREEZE_CONNECTION_ERROR,$v_1,$v_2,$v_3)})};Mscrm.DashboardEditorUtils.$3=function($p0,$p1,$p2,$p3){if(IsNull($p3))Mscrm.DashboardEditorUtils.socialInsightsPreviewError(window.LOCID_NETBREEZE_NO_CONFIG,$p0,$p1,$p2);else{var $v_0=$get($p0),$v_1=$p3.SocialDataParameters.split("-"),$v_2=(new Mscrm.SocialInsights.Runtime.Services.UrlService).createDisplayUrl($p3.SocialDataItemId,$v_1);if($v_2!==$v_0.src)$v_0.src=$v_2}};Mscrm.DashboardEditorUtils.socialInsightsPreviewError=function(errorMessage,previewFrameId,previewOverlayId,errorMessageContainerId){$get(previewFrameId).style.display="none";$get(previewOverlayId).style.display="none";var $v_0=$get(errorMessageContainerId);$v_0.style.display="block";$v_0.className="socialInsightsDashboardPreviewMessage";$P_CRM($v_0).text(errorMessage)};Mscrm.DashboardEditorUtils.$2=function($p0){!IsNull($p0)&&$p0.stopPropagation()};Mscrm.DashboardEditorUtils.$0=function($p0,$p1){if(isNullOrEmptyString($p1))return $p0;return $p0+"_"+$p1};Mscrm.DashboardEditorConstants.registerClass("Mscrm.DashboardEditorConstants");Mscrm.DashboardEditorUtils.registerClass("Mscrm.DashboardEditorUtils");Mscrm.DashboardEditorConstants.componentGalleryWidth=630;Mscrm.DashboardEditorConstants.componentGalleryHeight=420;Mscrm.DashboardEditorConstants.emptyGuid="{00000000-0000-0000-0000-000000000000}";Mscrm.DashboardEditorConstants.chartFrameId="previewFrame";Mscrm.DashboardEditorConstants.loadingDivId="previewLoadingDiv";Mscrm.DashboardEditorConstants.contentDivId="contentDiv";Mscrm.DashboardEditorConstants.vizFormId="vizForm";Mscrm.DashboardEditorConstants.vizXmlId="vizXml";Mscrm.DashboardEditorConstants.chartImageId="CrmChart"