Type.registerNamespace("Mscrm.EmailConnector");Mscrm.EmailConnector.ApplyMailboxSettingsMode=function(){};Mscrm.EmailConnector.ApplyMailboxSettingsMode.prototype={selectedRecords:0,currentPage:1,currentView:2};Mscrm.EmailConnector.ApplyMailboxSettingsMode.registerEnum("Mscrm.EmailConnector.ApplyMailboxSettingsMode",false);Mscrm.EmailConnector.ActionMask=function(){};Mscrm.EmailConnector.ActionMask.prototype={none:0,performTestAccess:1,applyDefaultMailboxSettings:2,setCrmOrgAsExchangeMailboxOrg:4};Mscrm.EmailConnector.ActionMask.registerEnum("Mscrm.EmailConnector.ActionMask",false);Mscrm.EmailConnector.ApplyMailboxSettings=function(mode,gridControl,selectedRecords,allRecords,dialogMode,testEmailConfiguration,entityTypeCode,setCrmOrgAsExchangeMailboxOrg){this.$0_0=-1;this.$2_0=Number.parseInvariant(dialogMode);this.$6_0=entityTypeCode;this.$5_0=allRecords;this.$9_0=mode;this.$7_0=gridControl;this.$A_0=selectedRecords;if(this.$2_0===1)this.$1_0=1;else if(testEmailConfiguration)this.$1_0=3;else this.$1_0=2;if(setCrmOrgAsExchangeMailboxOrg===1)this.$1_0=this.$1_0|4;this.$8_0=Mscrm.EmailConnector.ApplyMailboxSettings.$C(this.$E_0())};Mscrm.EmailConnector.ApplyMailboxSettings.$G=function($p0){var $v_0='<filter type="and"><condition attribute="emailserverprofile" operator="eq" value="{0}" /></filter>';return String.format($v_0,CrmEncodeDecode.CrmXmlEncode($p0[0].Id))};Mscrm.EmailConnector.ApplyMailboxSettings.$H=function($p0){for(var $v_0='<filter type="and"><condition attribute="mailboxid" operator="in">{0}</condition></filter>',$v_1=new Sys.StringBuilder,$v_2="<value>{0}</value>",$v_3=0;$v_3<$p0.length;$v_3++)$v_1.append(String.format($v_2,CrmEncodeDecode.CrmXmlEncode($p0[$v_3].Id)));return String.format($v_0,$v_1.toString())};Mscrm.EmailConnector.ApplyMailboxSettings.$I=function($p0){if(isNullOrEmptyString($p0))return "";var $v_0=XUI.Xml.LoadXml($p0),$v_1=XUI.Xml.SelectSingleNode($v_0,"fetch/entity[1]",null);while(!IsNull(XUI.Xml.SelectSingleNode($v_1,"//attribute",null))){var $v_8=XUI.Xml.SelectSingleNode($v_1,"//attribute",null);$v_1.removeChild($v_8)}var $v_2=$v_0.createElement("attribute"),$v_3=$v_0.createAttribute("name");$v_3.value="mailboxid";$v_2.attributes.setNamedItem($v_3);var $v_4=$v_0.createElement("attribute"),$v_5=$v_0.createAttribute("name");$v_5.value="isforwardmailbox";$v_4.attributes.setNamedItem($v_5);var $v_6=$v_0.createElement("attribute"),$v_7=$v_0.createAttribute("name");$v_7.value="regardingobjectid";$v_6.attributes.setNamedItem($v_7);$v_1.appendChild($v_2);$v_1.appendChild($v_4);$v_1.appendChild($v_6);return XUI.Xml.XMLSerializer.serializeToString($v_0)};Mscrm.EmailConnector.ApplyMailboxSettings.$C=function($p0){if(IsNull($p0))return "";var $v_0=XUI.Xml.LoadXml($p0),$v_1=XUI.Xml.SelectSingleNode($v_0,"fetch",null);!IsNull($v_1.attributes.getNamedItem("paging-cookie"))&&$v_1.attributes.removeNamedItem("paging-cookie");!IsNull($v_1.attributes.getNamedItem("page"))&&$v_1.attributes.removeNamedItem("page");!IsNull($v_1.attributes.getNamedItem("count"))&&$v_1.attributes.removeNamedItem("count");!IsNull($v_1.attributes.getNamedItem("returntotalrecordcount"))&&$v_1.attributes.removeNamedItem("returntotalrecordcount");var $v_2=$v_0.createAttribute("count");$v_2.value="200";$v_1.attributes.setNamedItem($v_2);return XUI.Xml.XMLSerializer.serializeToString($v_0)};Mscrm.EmailConnector.ApplyMailboxSettings.prototype={processBatch:function(pageNumber,callback){var $v_0=this.$D_0(this.$8_0,pageNumber);if(isNullOrEmptyString($v_0))return;var $v_1=new RemoteCommand("MailboxService","SubmitApplyMailboxSettingsJob",null);$v_1.SetParameter("fetchXml",$v_0);$v_1.SetParameter("actionMask",this.$1_0);var $v_2=$v_1.Execute();if($v_2.Success){var $v_3=$v_2.ReturnValue.split(",",4);this.$3_0+=Number.parseInvariant($v_3[0]);var $v_4=Number.parseInvariant($v_3[2])>0;if(this.$0_0===-1)this.$0_0=Number.parseInvariant($v_3[1]);this.$4_0=$v_3[3];if(pageNumber>this.$0_0/200&&!$v_4){this.$3_0>0&&alert(String.format(window.LOCID_APPLYMLBOX_MULTIPLEERRORS,this.$3_0,this.$0_0));callback(-1,pageNumber*200,this.$0_0);return}else{if(pageNumber>this.$0_0/200)this.$0_0=(pageNumber+1)*200;callback(pageNumber,pageNumber*200,this.$0_0)}}},$E_0:function(){switch(this.$9_0){case 0:return this.$B_0(this.$A_0);case 1:return this.$B_0(this.$5_0);case 2:return Mscrm.EmailConnector.ApplyMailboxSettings.$I(this.$7_0.GetParameter("effectiveFetchXml"));default:throw Error.invalidOperation()}},$F_0:function($p0){if(this.$2_0===1&&this.$6_0===Mscrm.EntityTypeCode.EmailServerProfile)return Mscrm.EmailConnector.ApplyMailboxSettings.$G($p0);else return Mscrm.EmailConnector.ApplyMailboxSettings.$H($p0)},$B_0:function($p0){if(!$p0.length)return "";return String.format('<fetch><entity name="mailbox"><attribute name="mailboxid" /><attribute name="isforwardmailbox" /><attribute name="regardingobjectid" />{0}</entity></fetch>',this.$F_0($p0))},$D_0:function($p0,$p1){if(IsNull($p0))return "";var $v_0=XUI.Xml.LoadXml($p0),$v_1=XUI.Xml.SelectSingleNode($v_0,"fetch",null);if(this.$4_0){var $v_3=$v_0.createAttribute("paging-cookie");$v_3.value=this.$4_0;$v_1.attributes.setNamedItem($v_3)}var $v_2=$v_0.createAttribute("page");$v_2.value=$p1.toString();$v_1.attributes.setNamedItem($v_2);if(this.$0_0===-1){var $v_4=$v_0.createAttribute("returntotalrecordcount");$v_4.value="true";$v_1.attributes.setNamedItem($v_4)}return XUI.Xml.XMLSerializer.serializeToString($v_0)},$A_0:null,$5_0:null,$9_0:0,$7_0:null,$2_0:0,$6_0:0,$1_0:0,$8_0:null,$4_0:null,$3_0:0};Mscrm.EmailConnector.ApplyMailboxSettings.registerClass("Mscrm.EmailConnector.ApplyMailboxSettings");Mscrm.EmailConnector.ApplyMailboxSettings.batchSize=200