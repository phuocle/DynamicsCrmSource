function CreateOrder(){if(!Xrm.Page.data.getIsValid())return;if(IsOutlookClient())if(!ConfirmCreateOrder())return;Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteCreateOrder,null)}function reviseActiveQuote(){if(!Xrm.Page.data.getIsValid())return;var closeQuote=true;Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteCreateRevision,closeQuote)}function reviseClosedQuote(){if(!Xrm.Page.data.getIsValid())return;var closeQuote=false;Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteCreateRevision,closeQuote)}function showCloseQuoteDlg(){var oDlgParams={};oDlgParams.quoteNumber=Xrm.Page.data.entity.attributes.get("quotenumber").getValue();oDlgParams.revisionNumber=Xrm.Page.data.entity.attributes.get("revisionnumber").getValue();var aoItems=Xrm.Page.data.entity.attributes.get("opportunityid").getValue(),sOppID=aoItems!=null?aoItems[0].id:"",parameters=[],oUrl=Mscrm.CrmUri.create("/sfa/quotes/dlg_close.aspx?quoteid="+CrmEncodeDecode.CrmUrlEncode(Xrm.Page.data.entity.getId())+"&opportunityid="+CrmEncodeDecode.CrmUrlEncode(sOppID)),crmDialog=new Mscrm.CrmDialog(oUrl,oDlgParams,350,475,null);crmDialog.setCallbackInfo("PerformActionAfterCloseQuote",this,parameters);crmDialog.show()}function closeQuote(){if(!Xrm.Page.data.getIsValid())return;showCloseQuoteDlg()}function PerformActionAfterCloseQuote(oResult){if(oResult){var closeq={};closeq["CloseDate"]=oResult.closeDate;closeq["ReviseQuote"]=oResult.createRevision;closeq["CloseOpp"]=oResult.CloseOpportunity;closeq["Description"]=oResult.description;closeq["NewStatus"]=oResult.newStatus;if(closeq["CloseOpp"]==true){closeq["ActivityXml"]=oResult.ActivityXml;closeq["OpportunityStatus"]=oResult.OpportunityStatus;closeq["OpportunityState"]=oResult.OpportunityState}Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteCloseQuote,closeq)}}function AcceptQuote(){if(!Xrm.Page.data.getIsValid())return;if(IsOutlookClient())if(!ConfirmCreateOrder())return;var oDlgParams={};oDlgParams.quoteNumber=Xrm.Page.data.entity.attributes.get("quotenumber").getValue();oDlgParams.revisionNumber=Xrm.Page.data.entity.attributes.get("revisionnumber").getValue();var aoItems=Xrm.Page.data.entity.attributes.get("opportunityid").getValue(),sOppID=aoItems!=null?aoItems[0].id:"";oDlgParams.opportunityID=sOppID;var parameters=[],oUrl=Mscrm.CrmUri.create("/sfa/quotes/dlg_accept.aspx?QuoteId="+CrmEncodeDecode.CrmUrlEncode(Xrm.Page.data.entity.getId())+"&opportunityid="+CrmEncodeDecode.CrmUrlEncode(sOppID)),crmDialog=new Mscrm.CrmDialog(oUrl,oDlgParams,500,475,null);crmDialog.setCallbackInfo("performActionAfterAcceptQuote",this,parameters);crmDialog.show()}function performActionAfterAcceptQuote(oResult){if(oResult){var commandData={};commandData["NewStatusCode"]=oResult.newStatus;commandData["CloseDate"]=oResult.closeDate;commandData["Description"]=oResult.description;if(oResult.closeOpportunity){commandData["CloseQpportunity"]=boolToStr(true);if(oResult.useGivenRevenue){commandData["UseRevenue"]=boolToStr(true);commandData["ActualRevenue"]=oResult.actualRevenue}else{commandData["UseRevenue"]=boolToStr(false);commandData["ActualRevenue"]=""}}else{commandData["CloseQpportunity"]=boolToStr(false);commandData["UseRevenue"]=boolToStr(false);commandData["ActualRevenue"]=""}Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteAccept,commandData)}}function activateQuote(){if(!Xrm.Page.data.getIsValid())return;Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.QuoteActivate,null)}function printQuote(){if(Mscrm.Utilities.isIosDevice()){alert(LOCID_UNSUPPORTED_RIBBONACTION);return}try{var dialogOptions=new Xrm.DialogOptions;dialogOptions.height=500;dialogOptions.width=600;Xrm.Internal.openDialog(Mscrm.CrmUri.create("/_grid/cmds/dlg_webmailmerge.aspx?mergetype=3&objectTypeCode="+CrmEncodeDecode.CrmUrlEncode(Quote)+"&objectId="+CrmEncodeDecode.CrmUrlEncode(Xrm.Page.data.entity.getId())).toString(),dialogOptions,null,null,null)}catch(e){onError(e)}}function ConfirmCreateOrder(){try{if(!IsOnline())return confirm(LOCID_OFFLINE_CRE_ORD_FROM_QUO);else return true}catch(e){onError(e)}}function reCalculate(){Mscrm.RefreshPageCommandHandler.executeCommand(Mscrm.InlineCommands.RecalculateRecord,null)}function getProductsForQuote(){getProducts()}function acceptQuoteOrCreateOrder(){if(window.QUOTE_STATE===undefined)return;if(QUOTE_STATE=="Active")AcceptQuote();else QUOTE_STATE=="Won"&&CreateOrder()}function reviseActiveOrClosedQuote(){if(window.QUOTE_STATE===undefined)return;if(isQuoteActive())reviseActiveQuote();else QUOTE_STATE=="Closed"&&reviseClosedQuote()}function canAppendToCustomer(){if(window.CAN_APPEND_TO_CUST===undefined)return;if(CAN_APPEND_TO_CUST=="1")return true;return false}function isQuoteActive(){if(window.QUOTE_STATE===undefined)return false;if(QUOTE_STATE=="Active")return true;return false}function isQuoteActiveOrWon(){if(window.QUOTE_STATE===undefined)return false;if(QUOTE_STATE=="Active"||QUOTE_STATE=="Won")return true;return false}function isQuoteActiveOrClosed(){if(window.QUOTE_STATE===undefined)return false;if(QUOTE_STATE=="Active"||QUOTE_STATE=="Closed")return true;return false}