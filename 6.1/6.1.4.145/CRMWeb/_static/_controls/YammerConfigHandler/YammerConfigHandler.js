Type.registerNamespace("Mscrm");Mscrm.YammerConfigHandler=function(element){this.$$d_$U_3=Function.createDelegate(this,this.$U_3);this.$$d_$S_3=Function.createDelegate(this,this.$S_3);this.$$d_$T_3=Function.createDelegate(this,this.$T_3);this.$$d_onAuthorize=Function.createDelegate(this,this.onAuthorize);Mscrm.YammerConfigHandler.initializeBase(this,[element])};Mscrm.YammerConfigHandler.verifyUserEmail=function(){var $v_0=jQueryApi.jQueryDeferredFactory.Deferred(Boolean,Object),$v_1=Mscrm.YammerLogOnDialog.create(true);$v_1.setCallbackInfo("resolve",$v_0,null);$v_1.show();return $v_0.promise()};Mscrm.YammerConfigHandler.verifyUser=function(email,password){var $v_0=jQueryApi.jQueryDeferredFactory.Deferred(Boolean,RemoteCommandResult),$v_1=Mscrm.YammerWebServiceClient.createCommand("VerifyYammerUserCredentials",null);$v_1.SetParameter("email",email);$v_1.SetParameter("password",password);$v_1.Execute(function($p1_0,$p1_1){if(IsNull($p1_0)||!$p1_0.Success)$v_0.reject($p1_0);else $v_0.resolve($p1_0.ReturnValue)});return $v_0.promise()};Mscrm.YammerConfigHandler.onResetYammerCredentials=function(clickEvent){clickEvent.preventDefault();Mscrm.YammerConfigHandler.$H=$P_CRM(clickEvent.target).data("userid");var $v_0={};$v_0["OnReset"]=Mscrm.YammerConfigHandler.$W;var $v_1=Mscrm.CrmUri.create("/_grid/cmds/dlg_confirmation.aspx");$v_1.get_query()["resource_title"]="Web.Tools.Yammer.Embed.OnPremiseResetEmailConfirmationTitle";$v_1.get_query()["resource_description"]="Web.Tools.Yammer.Embed.OnPremiseResetEmailConfirmation";var $v_2=new Mscrm.CrmDialog($v_1,null,500,150,null);$v_2.setCallbackInfo("OnReset",$v_0,null);$v_2.show()};Mscrm.YammerConfigHandler.$W=function($p0){if($p0&&$p0){var $v_0=Mscrm.YammerWebServiceClient.createCommand("ResetYammerCredentials",null);$v_0.SetParameter("userId",Mscrm.YammerConfigHandler.$H);$v_0.Execute();location.reload()}};Mscrm.YammerConfigHandler.$C=function($p0){return "#"+$p0};Mscrm.YammerConfigHandler.$M=function($p0){return $p0+" option:selected"};Mscrm.YammerConfigHandler.$P=function($p0){return $p0+":checked"};Mscrm.YammerConfigHandler.prototype={$A_3:null,initialize:function(){Mscrm.CrmUIControl.prototype.initialize.call(this);var $v_0=$P_CRM(".authorizeLink");$v_0.click(this.$$d_onAuthorize);$P_CRM(Mscrm.YammerConfigHandler.$D).change(this.$$d_$T_3);$P_CRM(Mscrm.YammerConfigHandler.$9).change(this.$$d_$S_3);$P_CRM(Mscrm.YammerConfigHandler.$F).change(this.$$d_$U_3)},dispose:function(){$P_CRM(".authorizeLink").unbind("click",this.$$d_onAuthorize);$P_CRM(Mscrm.YammerConfigHandler.$D).unbind("change",this.$$d_$T_3);$P_CRM(Mscrm.YammerConfigHandler.$9).unbind("change",this.$$d_$S_3);$P_CRM(Mscrm.YammerConfigHandler.$F).unbind("change",this.$$d_$U_3);Mscrm.CrmUIControl.prototype.dispose.call(this)},onAuthorize:function(clickEvent){clickEvent.preventDefault();if($P_CRM(clickEvent.target).hasClass("disabled"))return;var $v_0=$P_CRM(".authorizeLink").attr("onpremise").toString();if($v_0==="True"){var $v_1=Mscrm.YammerLogOnDialog.create(false);$v_1.setCallbackInfo("onAuthorizeOnPremise",this,null);$v_1.show()}else this.$X_3()},onAuthorizeOnPremise:function(returnValue){returnValue&&returnValue&&this.$V_3()},$V_3:function(){this.$J_3()},$X_3:function(){this.$0_3("stepAuthorize",false);$P_CRM("#radioSecurityPrivate").click();this.$3_3("stepSelectNetwork",false);this.$3_3("stepSelectGroup",false);this.$3_3("stepSetSecurity",false);this.$0_3("stepSelectNetwork",false);this.$0_3("stepSelectGroup",false);this.$0_3("stepSetSecurity",false);$P_CRM("div.footer").hide();if(this.$A_3&&!this.$A_3.$7_0.closed)return;this.$A_3=Mscrm.YammerOAuthDialogHandler.startOAuth(false);var $$t_0=this;this.$A_3.waitForCompletion().done(function(){$$t_0.$J_3()})},$J_3:function(){this.$A_3=null;this.$3_3("stepAuthorize",true);this.$0_3("stepAuthorize",true);this.$Q_3();$P_CRM("#radioSecurityPrivate").click()},$T_3:function($p0){var $v_0=$P_CRM(Mscrm.YammerConfigHandler.$M(Mscrm.YammerConfigHandler.$D)).val(),$v_1=Number.parseInvariant($v_0);this.$L_3($v_1)},$N_3:function($p0,$p1){var $v_0=$P_CRM(Mscrm.YammerConfigHandler.$9);$v_0.find(":not(option:first-child)").remove();if(!IsNull($p1)&&$p1.length)for(var $v_1=0;$v_1<$p1.length;$v_1++)$v_0.append(String.format("<option value='{0}'>{1}</option>",$p1[$v_1].$1_0,$p1[$v_1].$5_0));if($p0){this.$0_3("stepSelectNetwork",true);this.$3_3("stepSelectGroup",true);this.$3_3("stepSetSecurity",true);$P_CRM("div.footer").show();this.$0_3("stepSelectGroup",true)}else{this.$0_3("stepSelectNetwork",false);this.$3_3("stepSelectGroup",false);this.$3_3("stepSetSecurity",false);$P_CRM("div.footer").hide();this.$0_3("stepSelectGroup",false)}},$S_3:function($p0){this.$0_3("stepSelectGroup",false);var $v_0=$P_CRM(Mscrm.YammerConfigHandler.$M(Mscrm.YammerConfigHandler.$9)).val();this.$Y_3(Number.parseInvariant($v_0));this.$0_3("stepSelectGroup",true)},$U_3:function($p0){var $v_0=$P_CRM(Mscrm.YammerConfigHandler.$P(Mscrm.YammerConfigHandler.$F)).val();this.$Z_3(Number.parseInvariant($v_0))},$Q_3:function(){var $v_0=Mscrm.YammerWebServiceClient.createCommand("GetAdminNetworks",null),$$t_7=this;$v_0.Execute(function($p1_0,$p1_1){if(!IsNull($p1_0)&&$p1_0.Success){var $v_1=new Mscrm.Yammer.GetAdminNetworksResult($p1_0.Xml),$v_2=$v_1.$6_0;if(IsNull($v_2)||!$v_2.length){alert(LOCID_YAMMER_NONETWORK);return}var $v_3=$P_CRM(Mscrm.YammerConfigHandler.$C("stepAuthorize")+" .networkName");$v_3.text($v_2[0].$E_0);$v_3.attr("data-networkId",$v_2[0].$1_0);var $v_4=Number.parseInvariant($v_2[0].$1_0);$$t_7.$L_3($v_4)}else{alert(LOCID_YAMMER_NONETWORK);return}})},$L_3:function($p0){var $v_0={};$v_0["networkId"]=$p0;var $v_1=Mscrm.YammerWebServiceClient.createCommand("SaveSelectedNetworkAndGetGroups",$v_0);$v_1.SetParameter("networkId",$p0);var $$t_9=this;$v_1.Execute(function($p1_0,$p1_1){if(!IsNull($p1_0)&&$p1_0.Success){var $v_2=new Mscrm.Yammer.SaveSelectedNetworkAndGetGroupsResult($p1_0.Xml),$v_3=$v_1.Reference["networkId"],$v_4=$v_2.$8_0;$$t_9.$N_3($v_3,$v_4)}else{var $v_5=$v_1.Reference["networkId"];$$t_9.$N_3($v_5,new Array(0))}})},$Y_3:function($p0){var $v_0=Mscrm.YammerWebServiceClient.createCommand("SaveSelectedGroup",null);$v_0.SetParameter("groupId",$p0);var $$t_5=this;$v_0.Execute(function($p1_0,$p1_1){if(IsNull($p1_0)||!$p1_0.Success){var $v_1=IsNull($p1_0)?null:$p1_0.Xml;Mscrm.YammerWebServiceClient.defaultErrorHandler("SaveSelectedGroup",$v_1)}})},$Z_3:function($p0){var $v_0=Mscrm.YammerWebServiceClient.createCommand("SaveYammerPostMethod",null);$v_0.SetParameter("yammerPostMethod",$p0);var $$t_5=this;$v_0.Execute(function($p1_0,$p1_1){if(IsNull($p1_0)||!$p1_0.Success){var $v_1=IsNull($p1_0)?null:$p1_0.Xml;Mscrm.YammerWebServiceClient.defaultErrorHandler("SaveYammerPostMethod",$v_1)}})},$0_3:function($p0,$p1){var $v_0=$P_CRM("#"+$p0+" img.check");if($p1)$v_0.show();else $v_0.hide()},$3_3:function($p0,$p1){var $v_0=$P_CRM("#"+$p0+" .overlay");$v_0.toggle(!$p1)}};Mscrm.YammerLogOnDialog=function(){};Mscrm.YammerLogOnDialog.checkCredentials=function(){var $v_0=$P_CRM("#YammerEmail").val(),$v_1=$P_CRM("#YammerPassword").val(),$v_2=userVerification,$v_3=Mscrm.YammerWebServiceClient.createCommand($v_2?"VerifyYammerUserCredentials":"VerifyYammerAdminCredentials",null);$v_3.ErrorHandler=null;$v_3.SetParameter("email",$v_0);$v_3.SetParameter("password",$v_1);$P_CRM("#loadingContainer").show();Mscrm.YammerLogOnDialog.toggleInput(false);var $v_4=jQueryApi.jQueryDeferredFactory.Deferred(Boolean,Object);$v_3.Execute(function($p1_0,$p1_1){Mscrm.YammerLogOnDialog.toggleInput(true);$P_CRM("#loadingContainer").hide();if(!$p1_0.Success){Mscrm.YammerLogOnDialog.$b($p1_0.RawResponse);$v_4.resolve(false)}if(!$p1_0.ReturnValue){Mscrm.YammerLogOnDialog.showError(LOCID_YAMMER_INVALID_CREDS,false);$v_4.resolve(false)}$v_4.resolve(true)});return $v_4.promise()};Mscrm.YammerLogOnDialog.toggleInput=function(enable){var $v_0=$P_CRM("#YammerEmail, #YammerPassword, #butBegin");if(enable)$v_0.removeAttr("disabled");else $v_0.attr("disabled","disabled")};Mscrm.YammerLogOnDialog.create=function(user){var $v_0=Mscrm.CrmUri.create("/_grid/cmds/dlg_VerifyYammerAccount.aspx");if(user)$v_0.get_query()["user"]="1";var $v_1=new Mscrm.CrmDialog($v_0,null,630,222,null);return $v_1};Mscrm.YammerLogOnDialog.showError=function(message,showWarning){$P_CRM("#errorIconImage").attr("src",showWarning?"/_imgs/error/notif_icn_warn16.png":"/_imgs/error/notif_icn_crit16.png");$P_CRM("#errorsBlock").show();$P_CRM("#Notification0_text").text(message).attr("title",message);var $v_0=$P_CRM("#errorsBlock").outerHeight();window.parent.parent.$P_CRM("#InlineDialog").height(222+$v_0);window.parent.parent.$P_CRM("#InlineDialog_Iframe").height(222+$v_0)};Mscrm.YammerLogOnDialog.$b=function($p0){var $v_0=XUI.Xml.SelectSingleNode($p0.documentElement,"//error/description",null),$v_1=XUI.Xml.SelectSingleNode($p0.documentElement,"//error/code",null),$v_2=IsNull($v_1)?"":XUI.Xml.GetText($v_1),$v_3=$v_2==="0x8004B016"?true:false,$v_4=IsNull($v_0)?$p0+"":XUI.Xml.GetText($v_0);Mscrm.YammerLogOnDialog.showError($v_4,$v_3)};Mscrm.YammerOAuthDialogHandler=function($p0){this.$$d_$R_0=Function.createDelegate(this,this.$R_0);this.$$d_$K_0=Function.createDelegate(this,this.$K_0);if(IsNull($p0))throw Error.argumentNull("child");this.$7_0=$p0};Mscrm.YammerOAuthDialogHandler.startOAuth=function(user){var $v_0=Mscrm.CrmUri.create("/tools/yammer/yammeroauthhandler.aspx",null);$v_0.get_query()["CRMWRPCToken"]=YAM_OAUTH_WRPC;$v_0.get_query()["CRMWRPCTokenTimeStamp"]=YAM_OAUTH_WRPC_TIME;if(user)$v_0.get_query()["user"]=1;var $v_1=safeWindowOpen($v_0,"","height=600,width=800");return new Mscrm.YammerOAuthDialogHandler($v_1)};Mscrm.YammerOAuthDialogHandler.prototype={waitForCompletion:function(){if(!this.$G_0)throw Error.invalidOperation();this.$G_0=false;this.$4_0=jQueryApi.jQueryDeferredFactory.Deferred(Boolean,String);this.$K_0();this.$a_0();return this.$4_0.promise()},get_child:function(){return this.$7_0},$7_0:null,$I_0:0,$B_0:1e3,$G_0:true,$4_0:null,$K_0:function(){try{var $v_0=Mscrm.YammerWebServiceClient.createCommand("GetOAuthStatus",null),$$t_6=this;$v_0.Execute(function($p1_0,$p1_1){if(!IsNull($p1_0)&&$p1_0.Success){var $v_1=$p1_0.Xml;if(!IsNull($v_1)&&$v_1.nodeName==="GetOAuthStatusResult"){var $v_2=XUI.Xml.GetText($v_1);$$t_6.$O_0(!$v_2.trim().length,$v_2);return}$$t_6.$B_0=1e3}else $$t_6.$B_0+=500;!$$t_6.$G_0&&window.setTimeout($$t_6.$$d_$K_0,$$t_6.$B_0)})}catch($v_3){this.$B_0+=500;window.setTimeout(this.$$d_$K_0,this.$B_0);Mscrm.YammerWebServiceClient.defaultErrorHandler(String.format("{0}:{1}","GetOAuthStatus",$v_3.message),null)}},$O_0:function($p0,$p1){this.$G_0=true;if(IsNull(this.$4_0))return;if($p0)this.$4_0.resolve(true);else this.$4_0.reject($p1);this.$4_0=null},$a_0:function(){this.$I_0&&window.clearTimeout(this.$I_0);this.$I_0=window.setTimeout(this.$$d_$R_0,6e5)},$R_0:function(){this.$O_0(false,null);if(!this.$7_0.closed)this.$7_0.location.href=Mscrm.CrmUri.create("/tools/yammer/yammeroauthhandler.aspx?timedout=true",window.location.href).toString()}};Mscrm.YammerWebServiceClient=function(){};Mscrm.YammerWebServiceClient.createCommand=function($p0,$p1){var $v_0=new RemoteCommand("YammerConfigWebService",$p0);$v_0.ErrorHandler=Mscrm.YammerWebServiceClient.defaultErrorHandler;if(IsNull($p1))$p1={};if(!("command" in $p1))$p1["command"]=$p0;$v_0.Reference=$p1;return $v_0};Mscrm.YammerWebServiceClient.defaultErrorHandler=function($p0,$p1){var $v_0=IsNull($p0)?"":$p0,$v_1=IsNull($p1)?"":XUI.Xml.GetText($p1);catchError(String.format("{0}:{1}",$v_0,$v_1),window.location.href,0,true)};Type.registerNamespace("Mscrm.Yammer");Mscrm.Yammer.ConfigOptions=function(){};Mscrm.Yammer.EmailAddress=function(){};Mscrm.Yammer.Contact=function(){};Mscrm.Yammer.User=function(){};Mscrm.Yammer.ObjectProperties=function(){};Mscrm.Yammer.Config=function(){};Mscrm.Yammer.FeedOptions=function(){};Mscrm.Yammer.Network=function(){};Mscrm.Yammer.Network.prototype={$5_0:null,$E_0:null,$1_0:null,get_name:function(){return this.$5_0},set_name:function(value){this.$5_0=value;return value},get_permalink:function(){return this.$E_0},set_permalink:function(value){this.$E_0=value;return value},get_id:function(){return this.$1_0},set_id:function(value){this.$1_0=value;return value}};Mscrm.Yammer.Group=function(){};Mscrm.Yammer.Group.prototype={$5_0:null,$1_0:null,get_name:function(){return this.$5_0},set_name:function(value){this.$5_0=value;return value},get_id:function(){return this.$1_0},set_id:function(value){this.$1_0=value;return value}};Mscrm.Yammer.GetAdminNetworksResult=function(node){if(IsNull(node)){this.$6_0=new Array(0);return}var $v_0={};$v_0["a"]="http://schemas.microsoft.com/crm/2009/WebServices";var $v_1=XUI.Xml.SelectNodes(node,"//a:Network",$v_0);if(!$v_1.length){this.$6_0=new Array(0);return}this.$6_0=new Array($v_1.length);for(var $v_2=0;$v_2<$v_1.length;$v_2++){var $v_3=new Mscrm.Yammer.Network;$v_3.$1_0=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_1[$v_2],"a:Id",$v_0));$v_3.$E_0=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_1[$v_2],"a:Permalink",$v_0));this.$6_0[$v_2]=$v_3}};Mscrm.Yammer.GetAdminNetworksResult.prototype={$6_0:null,get_networks:function(){return this.$6_0}};Mscrm.Yammer.SaveSelectedNetworkAndGetGroupsResult=function(node){var $v_0={};$v_0["a"]="http://schemas.microsoft.com/crm/2009/WebServices";var $v_1=XUI.Xml.SelectNodes(node,"//a:Group",$v_0);if(!$v_1.length){this.$8_0=new Array(0);return}this.$8_0=new Array($v_1.length);for(var $v_2=0;$v_2<$v_1.length;$v_2++){var $v_3=new Mscrm.Yammer.Group;$v_3.$1_0=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_1[$v_2],"a:Id",$v_0));$v_3.$5_0=XUI.Xml.GetText(XUI.Xml.SelectSingleNode($v_1[$v_2],"a:Name",$v_0));this.$8_0[$v_2]=$v_3}};Mscrm.Yammer.SaveSelectedNetworkAndGetGroupsResult.prototype={$8_0:null,get_groups:function(){return this.$8_0}};Mscrm.YammerConfigHandler.registerClass("Mscrm.YammerConfigHandler",Mscrm.CrmUIControl);Mscrm.YammerLogOnDialog.registerClass("Mscrm.YammerLogOnDialog");Mscrm.YammerOAuthDialogHandler.registerClass("Mscrm.YammerOAuthDialogHandler");Mscrm.YammerWebServiceClient.registerClass("Mscrm.YammerWebServiceClient");Mscrm.Yammer.ConfigOptions.registerClass("Mscrm.Yammer.ConfigOptions");Mscrm.Yammer.EmailAddress.registerClass("Mscrm.Yammer.EmailAddress");Mscrm.Yammer.Contact.registerClass("Mscrm.Yammer.Contact");Mscrm.Yammer.User.registerClass("Mscrm.Yammer.User");Mscrm.Yammer.ObjectProperties.registerClass("Mscrm.Yammer.ObjectProperties");Mscrm.Yammer.Config.registerClass("Mscrm.Yammer.Config");Mscrm.Yammer.FeedOptions.registerClass("Mscrm.Yammer.FeedOptions");Mscrm.Yammer.Network.registerClass("Mscrm.Yammer.Network");Mscrm.Yammer.Group.registerClass("Mscrm.Yammer.Group");Mscrm.Yammer.GetAdminNetworksResult.registerClass("Mscrm.Yammer.GetAdminNetworksResult");Mscrm.Yammer.SaveSelectedNetworkAndGetGroupsResult.registerClass("Mscrm.Yammer.SaveSelectedNetworkAndGetGroupsResult");Mscrm.YammerConfigHandler.$D=Mscrm.YammerConfigHandler.$C("stepSelectNetwork")+" .networkSelect";Mscrm.YammerConfigHandler.$9=Mscrm.YammerConfigHandler.$C("stepSelectGroup")+" .groupSelect";Mscrm.YammerConfigHandler.$F=Mscrm.YammerConfigHandler.$C("stepSetSecurity")+" input.securitySelect";Mscrm.YammerConfigHandler.$H=null