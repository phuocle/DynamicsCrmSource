Type.registerNamespace("Mscrm");Mscrm.ActivityCommandBarButton=function(element){Mscrm.ActivityCommandBarButton.initializeBase(this,[element]);this.$5_3=new Mscrm.ActivityCommandBarButtonMenu(element.id)};Mscrm.ActivityCommandBarButton.prototype={$5_3:null,get_menu:function(){return this.$5_3},dispose:function(){if(this.get_isDisposed())return;!IsNull(this.$5_3)&&this.$5_3.dispose();Mscrm.CrmUIControl.prototype.dispose.call(this)}};Mscrm.ActivityCommandBarButtonMenu=function(parentDomElementId){this.$$d_$F_0=Function.createDelegate(this,this.$F_0);this.$$d_$J_0=Function.createDelegate(this,this.$J_0);this.$4_0="#"+parentDomElementId};Mscrm.ActivityCommandBarButtonMenu.$C=function($p0){var $v_0=String.format(".{0}","moreActivityMenuSelected"),$v_1=$P_CRM($v_0),$v_2;if($p0.which===40||$p0.which===9&&!$p0.shiftKey){$v_2=$v_1.next();if(!$v_2.length)$v_2=$P_CRM("#moreActivitiesList").children(":first-child")}else{$v_2=$v_1.prev();if(!$v_2.length)$v_2=$P_CRM("#moreActivitiesList").children(":last-child")}$v_2.hasClass("ms-crm-RefreshForm-MoreMenu")&&Mscrm.ActivityCommandBarButtonMenu.$D($v_2,$v_1)};Mscrm.ActivityCommandBarButtonMenu.$H=function($p0){var $v_0=$P_CRM($p0.target);if(!$v_0.hasClass("ms-crm-RefreshForm-MoreMenu")){$v_0=$v_0.parents("li");if($v_0.length!==1)return}var $v_1=String.format(".{0}","moreActivityMenuSelected"),$v_2=$P_CRM($v_1);Mscrm.ActivityCommandBarButtonMenu.$D($v_0,$v_2)};Mscrm.ActivityCommandBarButtonMenu.$I=function($p0){var $v_0=$P_CRM($p0.target);if(!$v_0.hasClass("ms-crm-RefreshForm-MoreMenu")){$v_0=$v_0.parents("li");if($v_0.length!==1)return}$v_0.removeClass("moreActivityMenuSelected");$v_0.addClass("moreActivityMenuUnselected")};Mscrm.ActivityCommandBarButtonMenu.$D=function($p0,$p1){$p1.addClass("moreActivityMenuUnselected");$p1.removeClass("moreActivityMenuSelected");$p0.removeClass("moreActivityMenuUnselected");$p0.addClass("moreActivityMenuSelected");$p0.find("a").focus()};Mscrm.ActivityCommandBarButtonMenu.prototype={$2_0:false,$0_0:null,$1_0:null,$7_0:false,$4_0:null,$9_0:null,$A_0:0,$B_0:0,$6_0:null,processAndShowMenu:function(){this.$K_0();if(this.$2_0){this.$0_0.hide();this.$2_0=false;return}var $v_0=this.$G_0();this.$E_0($v_0);this.$0_0.show($P_CRM(this.$4_0),null);var $v_1=$P_CRM("#moreActivitiesList").children(":first-child");$P_CRM(".ms-crm-RefreshForm-MoreMenu").show();$v_1.addClass("moreActivityMenuSelected");$v_1.removeClass("moreActivityMenuUnselected");$P_CRM("#moreActivitiesList IMG").removeClass("moreActivityMenuUnselected");this.$2_0=true;var $v_2=$P_CRM("body");this.$A_0=$v_2.height();this.$B_0=$v_2.width();$P_CRM(window).bind("resize",this.$$d_$J_0)},$J_0:function($p0){if(this.$2_0){var $v_0=$P_CRM("body");if(this.$A_0!==$v_0.height()||this.$B_0!==$v_0.width()){this.$0_0.hide();this.$2_0=false}}},changeSelectedMenuItem:function(selectedItemId){if(!selectedItemId.localeCompare(this.$6_0))return;var $v_0=$get(selectedItemId);$P_CRM(this.$4_0).children(":first-child").text(XUI.Html.GetText(XUI.Html.DomUtils.GetFirstChild($v_0.getElementsByTagName("A")[0])));$P_CRM("#"+selectedItemId).siblings("li").removeClass("moreActivityItemselected");$P_CRM("#"+selectedItemId).addClass("moreActivityItemselected");this.$6_0=selectedItemId},get_currentMenu:function(){return this.$6_0},set_currentMenu:function(value){this.$6_0=value;return value},$F_0:function($p0){switch($p0.which){case 13:var $v_0=$P_CRM($p0.target);$v_0.click();break;case 9:if($p0.target.tagName==="A"){$p0.preventDefault();Mscrm.ActivityCommandBarButtonMenu.$C($p0)}break;case 38:case 40:$p0.target.tagName==="A"&&Mscrm.ActivityCommandBarButtonMenu.$C($p0);break;case 27:this.$0_0.hide();this.$2_0=false;var $$t_2=this;window.setTimeout(function(){$P_CRM($$t_2.$4_0+" a").focus()},1);break}$p0.stopImmediatePropagation()},$K_0:function(){if(this.$7_0)return;this.$0_0=new Mscrm.FlyOutDialog;this.$0_0.get_options().set_showButtonPane(false);this.$0_0.get_options().set_modal(true);this.$0_0.get_options().set_closeOnEscape(true);this.$0_0.set_shouldDisposeContent(false);var $$t_2=this;this.$0_0.bind(Mscrm.FlyOutDialogEventName.canceled,function($p1_0){$$t_2.$8_0()});var $$t_3=this;this.$0_0.bind(Mscrm.FlyOutDialogEventName.closed,function($p1_0){$$t_3.$8_0()});this.$7_0=true},$E_0:function($p0){var $v_0=$P_CRM("<div class='ui-flyout-dialog-moreCommands'></div>"),$v_1=$P_CRM("<ul id='moreActivitiesList'></ul>");$v_1.append($p0);$v_0.append($v_1);this.$9_0=$v_0;this.$0_0.setContent($v_0);this.$1_0=$P_CRM("#moreActivitiesList");this.$1_0.keydown(this.$$d_$F_0);this.$1_0.mouseover(Mscrm.ActivityCommandBarButtonMenu.$H);this.$1_0.mouseout(Mscrm.ActivityCommandBarButtonMenu.$I);var $$t_7=this;this.$1_0.find("li").each(function($p1_0,$p1_1){var $v_2=$P_CRM($p1_1),$v_3=$v_2.attr("onclick");$v_2.click(function(){$$t_7.$0_0.hide();window.setTimeout($v_3,0)});$v_2.removeAttr("onclick")});this.$0_0.set_position(Mscrm.FlyOutPosition.bottom);this.$0_0.get_options().set_width(145);this.$0_0.get_options().set_minHeight(10);this.$0_0.get_options().set_showTitlePane(false)},$G_0:function(){var $v_0=$P_CRM(this.$4_0+"_Menu");return $v_0.html()},$8_0:function(){this.$1_0&&this.$1_0.unbind();if(this.$0_0){this.$0_0.unbind();this.$0_0.dispose()}$P_CRM(window).unbind("resize",this.$$d_$J_0);this.$2_0=false;this.$7_0=false;this.$0_0=null;this.$1_0=null},dispose:function(){this.$9_0&&this.$8_0()}};Mscrm.ActivityCommandBarButton.registerClass("Mscrm.ActivityCommandBarButton",Mscrm.CrmUIControl);Mscrm.ActivityCommandBarButtonMenu.registerClass("Mscrm.ActivityCommandBarButtonMenu")