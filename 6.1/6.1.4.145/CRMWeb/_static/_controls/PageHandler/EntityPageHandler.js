Type.registerNamespace("Mscrm");Mscrm.ActivityPageHandler=function(){Mscrm.ActivityPageHandler.initializeBase(this);this.promoteToResponse=false};Mscrm.ActivityPageHandler.$8=function($p0){if(!IsNull($p0))if(!IsNull($p0.getValue())){var $v_0=$p0.getValue();if(!IsNull($v_0)&&$v_0.length===1){var $v_1=$v_0[0];if(!IsNull($v_1))if($v_1.entityType===Mscrm.InternalUtilities.EntityNames.CampaignActivity||$v_1.entityType===Mscrm.InternalUtilities.EntityNames.BulkOperation)return true}}return false};Mscrm.ActivityPageHandler.prototype={promoteToResponse:false,execute:function(){this.$6_1();this.postInlineInitialization()},postInlineInitialization:function(){this.$5_1()},$5_1:function(){if(!this.promoteToResponse)return;var $v_0=false,$v_1=false,$v_2=false,$v_3=Xrm.Page.data.entity.attributes.get("regardingobjectid"),$v_4=Xrm.Page.data.entity.attributes.get("directioncode"),$v_5=Xrm.Page.data.entity.attributes.get("from"),$v_6=Xrm.Page.data.entity.attributes.get("to"),$v_7=Xrm.Page.data.entity.attributes.get("requiredattendees");$v_0=Mscrm.ActivityPageHandler.$8($v_3);if(!IsNull($v_4))if(!IsNull($v_4.getValue()))$v_2=$v_4.getValue().toString()==="0"?true:false;var $v_8=null;if($v_2){if(!IsNull($v_5))if(!IsNull($v_5.getValue()))$v_8=$v_5.getValue()}else if(!IsNull($v_6)&&!IsNull($v_6.getValue()))$v_8=$v_6.getValue();var $v_9=Xrm.Page.data.entity.getEntityName();if($v_9===Mscrm.InternalUtilities.EntityNames.Appointment)if(!IsNull($v_7)&&!IsNull($v_7.getValue()))$v_8=$v_7.getValue();if(!IsNull($v_8)&&$v_8.length===1){var $v_A=$v_8[0];if(!IsNull($v_A))if($v_A.entityType===Mscrm.InternalUtilities.EntityNames.Account||$v_A.entityType===Mscrm.InternalUtilities.EntityNames.Contact||$v_A.entityType===Mscrm.InternalUtilities.EntityNames.Lead)$v_1=true}if($v_0&&$v_1){window.LOCID_PROMOTE_TO_RESPONSE=true;if(Xrm.Page.data.entity.getEntityName()===Mscrm.InternalUtilities.EntityNames.Email)window.LOCID_PROMOTE_EMAIL_TO_RESPONSE=true;try{RibbonUtilityMethods.RefreshRibbon()}catch($$e_B){}}},$6_1:function(){(isNullOrEmptyString(this.get_entityId())||this.get_entityId()==="{00000000-0000-0000-0000-000000000000}")&&this.setDefaultValues()},setDefaultValues:function(){var $v_0=this.get_entityAttributes().get("ownerid");try{!IsNull($v_0)&&$v_0.setValue(this.getCurrentUser())}catch($$e_1){}},getCurrentUser:function(){var $v_0=new Array(1);$v_0[0]=new Xrm.LookupObject;$v_0[0].id=Xrm.Page.context.getUserId();$v_0[0].name=Xrm.Page.context.getUserName();$v_0[0].entityType="systemuser";return $v_0},setOrganizer:function(){try{var $v_0=this.get_entityAttributes().get("organizer");!IsNull($v_0)&&$v_0.setValue(this.getCurrentUser())}catch($$e_1){}},setFocusToSubject:function(){SetFocusOnSubject()}};Mscrm.AppointmentPageHandler=function(){Mscrm.AppointmentPageHandler.initializeBase(this);this.promoteToResponse=true};Mscrm.AppointmentPageHandler.prototype={$1_2:30,execute:function(){Mscrm.ActivityPageHandler.prototype.execute.call(this);this.$E_2();this.$A_2();var $v_0=this.get_entityAttributes().get("activityid");!IsNull($v_0)&&$v_0.setSubmitMode("never");this.setFocusToSubject()},setDefaultValues:function(){Mscrm.ActivityPageHandler.prototype.setDefaultValues.call(this);this.setOrganizer();var $v_0=this.get_entityAttributes().get("statuscode");if(!IsNull($v_0)&&IsNull($v_0.getValue()))Xrm.Page.context.client.getClient()!==Xrm.ClientNames.mobile&&$v_0.setValue(5);var $v_1=this.get_entityAttributes().get("isalldayevent");!IsNull($v_1)&&$v_1.setValue(0);this.$F_2()},$F_2:function(){var $v_0=this.get_entityAttributes().get("scheduleddurationminutes");!IsNull($v_0)&&IsNull($v_0.getValue())&&$v_0.setValue(this.$1_2)},$E_2:function(){var $v_0=this.get_entityAttributes().get("isalldayevent").getValue();if($v_0){var $v_1=Xrm.Page.ui.controls.get("scheduledend");!IsNull($v_1)&&$v_1.setIsAllDay(true)}},$A_2:function(){if(isNullOrEmptyString(this.get_entityId())){var $v_0=Mscrm.CrmUri.create(window.location.href),$v_1=$v_0.get_query()["_StartTime"];if(!isNullOrEmptyString($v_1)){var $v_2=this.get_entityAttributes().get("scheduledstart").getValue(),$v_3=$v_2;$v_3.setMinutes($v_2.getMinutes()+this.$1_2);this.get_entityAttributes().get("scheduledend").setValue($v_3);this.get_entityAttributes().get("scheduleddurationminutes").setValue(this.$1_2)}}}};Mscrm.EmailPageHandler=function(){this.$0_2=1;Mscrm.EmailPageHandler.initializeBase(this);this.promoteToResponse=true};Mscrm.EmailPageHandler.prototype={postInlineInitialization:function(){Mscrm.ActivityPageHandler.prototype.postInlineInitialization.call(this);this.$D_2();this.$C_2();Xrm.Page.ui.getFormType()!==3&&this.setFocusToSubject()},$D_2:function(){if(!isNullOrEmptyString(this.get_entityId())){var $v_0=this.get_entityAttributes().get("statuscode");if(!IsNull($v_0)){var $v_1=$v_0.getValue();switch($v_1){case 1:this.$0_2=1;break;case 3:this.$0_2=3;break;case 4:this.$0_2=4;break;case 5:this.$0_2=5;break;case 2:this.$0_2=2;break;case 6:this.$0_2=6;break;case 7:this.$0_2=7;break;case 8:this.$0_2=8;break}}}},$C_2:function(){var $v_0=isNullOrEmptyString(this.get_entityId())?1:2;if(1!==$v_0&&2!==$v_0)return;var $v_1=this.get_entityAttributes().get("statecode");if(IsNull($v_1))return;var $v_2=$v_1.getValue();if($v_2!==0)if(this.$0_2===3||this.$0_2===4||this.$0_2===6||this.$0_2===7){this.$7_2();(this.$0_2===3||this.$0_2===4)&&this.$G_2()}},$G_2:function(){var $v_0=Mscrm.FormControlInputBehavior.GetBehavior("from_i"),$v_1=Mscrm.FormControlInputBehavior.GetBehavior("to_i");if(!IsNull($v_0)&&!IsNull($v_1)){$v_0.set_lookupTypes($v_1.get_lookupTypes());$v_0.set_lookupTypeNames($v_1.get_lookupTypeNames())}},$7_2:function(){var $v_0=this.get_uiControls().get("regardingobjectid");!IsNull($v_0)&&$v_0.setDisabled(false)}};Mscrm.EntityPageHandlerFactory=function(){};Mscrm.EntityPageHandlerFactory.create=function(){var $v_0=null;if(Mscrm.Utilities.isRefreshForm()){var $v_1=Xrm.Page.data.entity.getEntityName();switch($v_1){case Mscrm.InternalUtilities.EntityNames.PhoneCall:$v_0=new Mscrm.PhonePageHandler;break;case Mscrm.InternalUtilities.EntityNames.Email:$v_0=new Mscrm.EmailPageHandler;break;case Mscrm.InternalUtilities.EntityNames.Letter:$v_0=new Mscrm.LetterPageHandler;break;case Mscrm.InternalUtilities.EntityNames.Appointment:$v_0=new Mscrm.AppointmentPageHandler;break;case Mscrm.InternalUtilities.EntityNames.RecurringAppointmentMaster:$v_0=new Mscrm.RecurringAppointmentMasterPageHandler;break;case Mscrm.InternalUtilities.EntityNames.Fax:$v_0=new Mscrm.FaxPageHandler;break;default:$v_0=new Mscrm.ActivityPageHandler;break}$v_0.execute();return $v_0}return null};Mscrm.EntityPageHandler=function(){};Mscrm.EntityPageHandler.prototype={get_entityAttributes:function(){return Xrm.Page.data.entity.attributes},get_uiControls:function(){return Xrm.Page.ui.controls},get_entityId:function(){return Xrm.Page.data.entity.getId()},execute:function(){}};Mscrm.FaxPageHandler=function(){Mscrm.FaxPageHandler.initializeBase(this);this.promoteToResponse=true};Mscrm.FaxPageHandler.prototype={execute:function(){Mscrm.ActivityPageHandler.prototype.execute.call(this);this.setFocusToSubject()}};Mscrm.PhonePageHandler=function(){Mscrm.PhonePageHandler.initializeBase(this);this.promoteToResponse=true};Mscrm.PhonePageHandler.prototype={$4_2:30,setDefaultValues:function(){Mscrm.ActivityPageHandler.prototype.setDefaultValues.call(this);var $v_0=this.get_entityAttributes().get("directioncode");if(!IsNull($v_0)){var $v_1=this.getCurrentUser();if($v_0.getValue())this.$3_2("from",$v_1);else this.$3_2("to",$v_1)}this.$B_2()},$3_2:function($p0,$p1){try{var $v_0=this.get_entityAttributes().get($p0);!IsNull($v_0)&&$v_0.setValue($p1)}catch($$e_3){}},$B_2:function(){var $v_0=this.get_entityAttributes().get("actualdurationminutes");!IsNull($v_0)&&IsNull($v_0.getValue())&&$v_0.setValue(this.$4_2)}};Mscrm.RecurringAppointmentMasterPageHandler=function(){Mscrm.RecurringAppointmentMasterPageHandler.initializeBase(this);window._appointId=Mscrm.InternalUtilities._String.Empty;this.promoteToResponse=true};Mscrm.RecurringAppointmentMasterPageHandler.$9=function($p0){var $v_0=window._appointId;if(isNullOrEmptyString($v_0))return;Mscrm.CommandBarActions.addRecurrenceSdkCall($v_0);!IsNull($p0)&&$p0.getEventArgs().preventDefault()};Mscrm.RecurringAppointmentMasterPageHandler.prototype={$2_2:null,execute:function(){Mscrm.ActivityPageHandler.prototype.execute.call(this);var $v_0=false,$v_1="recurringAppointmentFormData",$v_2=Xrm.Page.context.getQueryStringParameters();if(!IsNull($v_2)&&!IsNull($v_2[$v_1]))$v_0=true;isNullOrEmptyString(this.get_entityId())&&$v_0&&this.configureNewRecurringAppointmentForm($v_1);var $v_3=this.get_entityAttributes().get("activityid");!IsNull($v_3)&&$v_3.setSubmitMode("never");this.setFocusToSubject()},configureNewRecurringAppointmentForm:function($p0){try{var $v_0=Mscrm.CrmLocalStorage.getItem($p0);if($v_0){this.$2_2=$v_0;Mscrm.CrmLocalStorage.removeItem($p0)}}catch($$e_2){}window._appointId=Mscrm.Utilities.getActivityId(this.$2_2,Xrm.Page.data.entity.getEntityName());Mscrm.Utilities.setEntityAttributeValueFromXml(this.$2_2,Xrm.Page.data.entity.getEntityName());Xrm.Page.data.entity.addOnSave(Mscrm.RecurringAppointmentMasterPageHandler.$9)},setDefaultValues:function(){Mscrm.ActivityPageHandler.prototype.setDefaultValues.call(this);this.setOrganizer()}};Mscrm.LetterPageHandler=function(){Mscrm.LetterPageHandler.initializeBase(this);this.promoteToResponse=true};Mscrm.LetterPageHandler.prototype={execute:function(){Mscrm.ActivityPageHandler.prototype.execute.call(this);this.setFocusToSubject()}};Mscrm.EntityPageHandler.registerClass("Mscrm.EntityPageHandler");Mscrm.ActivityPageHandler.registerClass("Mscrm.ActivityPageHandler",Mscrm.EntityPageHandler);Mscrm.AppointmentPageHandler.registerClass("Mscrm.AppointmentPageHandler",Mscrm.ActivityPageHandler);Mscrm.EmailPageHandler.registerClass("Mscrm.EmailPageHandler",Mscrm.ActivityPageHandler);Mscrm.EntityPageHandlerFactory.registerClass("Mscrm.EntityPageHandlerFactory");Mscrm.FaxPageHandler.registerClass("Mscrm.FaxPageHandler",Mscrm.ActivityPageHandler);Mscrm.PhonePageHandler.registerClass("Mscrm.PhonePageHandler",Mscrm.ActivityPageHandler);Mscrm.RecurringAppointmentMasterPageHandler.registerClass("Mscrm.RecurringAppointmentMasterPageHandler",Mscrm.ActivityPageHandler);Mscrm.LetterPageHandler.registerClass("Mscrm.LetterPageHandler",Mscrm.ActivityPageHandler);Mscrm.EntityPageHandler.emptyGuid="{00000000-0000-0000-0000-000000000000}"