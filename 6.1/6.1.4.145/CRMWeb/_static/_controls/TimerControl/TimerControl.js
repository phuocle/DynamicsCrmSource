Type.registerNamespace("Mscrm");Mscrm.TimerControl=function(element){this.$$d_$d_3=Function.createDelegate(this,this.$d_3);this.$$d_$b_3=Function.createDelegate(this,this.$b_3);Mscrm.TimerControl.initializeBase(this,[element]);this.initialize()};Mscrm.TimerControl.prototype={$3_3:null,$L_3:null,$M_3:null,$I_3:null,$J_3:null,$O_3:null,$P_3:null,$G_3:null,$H_3:null,$2_3:null,$D_3:null,$8_3:null,$E_3:null,$7_3:null,$K_3:null,$9_3:null,$N_3:0,$4_3:0,$C_3:0,$1_3:false,$5_3:false,$0_3:null,$A_3:null,$B_3:null,get_oldViewObject:function(){return this.$A_3},set_oldViewObject:function(value){this.$A_3=value;return value},get_failureDateTime:function(){return this.$9_3},set_failureDateTime:function(value){this.$9_3=value;return value},get_failureDateTimeUtcString:function(){return this.$2_3},set_failureDateTimeUtcString:function(value){this.$2_3=value;return value},get_failureTimeField:function(){return this.$3_3},set_failureTimeField:function(value){this.$3_3=value;return value},get_successConditionName:function(){return this.$L_3},set_successConditionName:function(value){this.$L_3=value;return value},get_failureConditionValue:function(){return this.$J_3},set_failureConditionValue:function(value){this.$J_3=value;return value},get_failureConditionName:function(){return this.$I_3},set_failureConditionName:function(value){this.$I_3=value;return value},get_successConditionValue:function(){return this.$M_3},set_successConditionValue:function(value){this.$M_3=value;return value},get_warningConditionName:function(){return this.$O_3},set_warningConditionName:function(value){this.$O_3=value;return value},get_warningConditionValue:function(){return this.$P_3},set_warningConditionValue:function(value){this.$P_3=value;return value},get_cancelConditionName:function(){return this.$G_3},set_cancelConditionName:function(value){this.$G_3=value;return value},get_cancelConditionValue:function(){return this.$H_3},set_cancelConditionValue:function(value){this.$H_3=value;return value},get_timeDifferenceInSeconds:function(){return this.$4_3},set_timeDifferenceInSeconds:function(value){this.$4_3=value;return value},get_serverOffset:function(){return this.$C_3},set_serverOffset:function(value){this.$C_3=value;return value},get_timeRemainingInMilliseconds:function(){return this.$N_3},set_timeRemainingInMilliseconds:function(value){this.$N_3=value;return value},initialize:function(){Mscrm.CrmUIControl.prototype.initialize.call(this);Mscrm.OnLoadDeferredExecutor.queueCallback(this.$$d_$b_3,2)},$b_3:function(){var $v_0=window._timeDifferenceInSeconds,$v_1=window._severOffset,$v_2=window._serverUtcTimesXml;if(IsNull($v_0)||IsNull($v_1)||IsNull($v_2)){var $v_3=new RemoteCommand("DateTimeService","GetCurrentServerDateTimeInUtc");$v_3.SetParameter("entityName",Xrm.Page.data.entity.getEntityName());$v_3.SetParameter("entityId",Xrm.Page.data.entity.getId());var $v_4=$v_3.Execute();if($v_4.Success&&$v_4.ReturnValue){var $v_5="Times",$v_6=XUI.Xml.LoadXml($v_4.ReturnValue),$v_7=XUI.Xml.SelectSingleNode($v_6,$v_5,null);if($v_7){var $v_8=this.$6_3($v_7,"ServerTime");this.$C_3=Number.parseInvariant(this.$6_3($v_7,"Offset").toString());var $v_9=new Date,$v_A=new Date($v_8);if($v_A.toString()==="NaN"&&Mscrm.Utilities.isIE8OrLower()){$v_8=this.$6_3($v_7,"ServerTimeForIE8");$v_A=new Date($v_8)}this.$4_3=Math.floor((Date.parse($v_9.toUTCString())-Date.parse($v_A.toUTCString()))/1e3);this.$2_3=this.$6_3($v_7,this.$3_3)}}setAttributeInWindow("_timeDifferenceInSeconds",this.$4_3.toString());setAttributeInWindow("_severOffset",this.$C_3.toString());setAttributeInWindow("_serverUtcTimesXml",$v_4.ReturnValue)}else{this.$4_3=Number.parseInvariant($v_0.toString());this.$C_3=Number.parseInvariant($v_1.toString());var $v_B="Times",$v_C=XUI.Xml.LoadXml($v_2.toString()),$v_D=XUI.Xml.SelectSingleNode($v_C,$v_B,null);if($v_D)this.$2_3=this.$6_3($v_D,this.$3_3)}this.$W_3();this.$X_3();this.$V_3()},$6_3:function($p0,$p1){var $v_0=null;if(!IsNull($p0))if($p0.attributes.getNamedItem($p1))$v_0=$p0.attributes.getNamedItem($p1).nodeValue;return $v_0},$V_3:function(){var $v_0=this.$c_3();$v_0.render();Mscrm.Utilities.isRefreshForm()&&this.$e_3($v_0,this.get_element())},$X_3:function(){this.$F_3(this.$K_3);this.$F_3(this.$D_3);this.$F_3(this.$8_3);this.$F_3(this.$7_3);this.$F_3(this.$E_3);this.$Y_3();this.$Z_3()},$Z_3:function(){Mscrm.InlineEditDataService.get_dataService().add_formRefreshed(this.$$d_$d_3)},$f_3:function(){!Mscrm.InlineEditDataService.get_dataService().get_isDisposed()&&Mscrm.InlineEditDataService.get_dataService().remove_formRefreshed(this.$$d_$d_3)},$d_3:function($p0,$p1){this.$U_3();this.refresh()},$Y_3:function(){if(!isNullOrEmptyString(Xrm.Page.data.entity.getId()))return;var $v_0=$find(Mscrm.ClientApiConstants.primaryEntityId),$$t_2=this;this.$B_3=function($p1_0){$$t_2.$U_3();$$t_2.refresh()};$v_0&&$v_0.addOnRecordIdChanged(this.$B_3,false)},$F_3:function($p0){if(!IsNull($p0)){var $$t_2=this;$p0.addOnChange(function($p1_0){$$t_2.refresh()})}},$T_3:function($p0){if(!$p0)this.$1_3=true;else this.$1_3=false},$Q_3:function($p0,$p1){if(!isNullOrEmptyString($p0)&&!this.$1_3){var $v_0=Xrm.Page.data.entity.attributes.get($p0);$p1.val=$v_0;this.$T_3($p1.val);if(!this.$1_3)if(!$v_0.getUserPrivilege().canRead)this.$5_3=false}return !this.$1_3&&this.$5_3},$U_3:function(){var $v_0=new RemoteCommand("DateTimeService","RetrieveDateTimeAttributesInUtc");$v_0.SetParameter("entityName",Xrm.Page.data.entity.getEntityName());$v_0.SetParameter("entityId",Xrm.Page.data.entity.getId());var $v_1=$v_0.Execute();if($v_1.Success&&$v_1.ReturnValue){var $v_2="AttributeUtcTimes",$v_3=XUI.Xml.LoadXml($v_1.ReturnValue),$v_4=XUI.Xml.SelectSingleNode($v_3,$v_2,null);if($v_4)this.$2_3=this.$6_3($v_4,this.$3_3)}},$a_3:function(){var $v_0=Xrm.Page.data.entity.attributes.get(this.$3_3);this.$K_3=$v_0;this.$T_3(this.$K_3);if(!this.$1_3)if(!$v_0.getUserPrivilege().canRead)this.$5_3=false;return !this.$1_3&&this.$5_3},$W_3:function(){this.$5_3=true;var $$t_0,$$t_1,$$t_2,$$t_3,$$t_4,$$t_5,$$t_6,$$t_7;if(($$t_1=this.$Q_3(this.$L_3,$$t_0={val:this.$D_3}),this.$D_3=$$t_0.val,$$t_1)&&($$t_3=this.$Q_3(this.$I_3,$$t_2={val:this.$8_3}),this.$8_3=$$t_2.val,$$t_3)&&($$t_5=this.$Q_3(this.$O_3,$$t_4={val:this.$E_3}),this.$E_3=$$t_4.val,$$t_5)&&($$t_7=this.$Q_3(this.$G_3,$$t_6={val:this.$7_3}),this.$7_3=$$t_6.val,$$t_7)&&this.$a_3()){this.$9_3=this.$K_3.getValue();!IsNull(this.$9_3)&&!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString(Xrm.Page.data.entity.getId())&&this.$g_3()}},$g_3:function(){var $v_0=new Date;$v_0.setMinutes($v_0.getMinutes()+$v_0.getTimezoneOffset());var $v_1=$v_0.toUTCString();this.$N_3=Date.parse(this.$2_3)-Date.parse($v_1)+this.$4_3*1e3},$R_3:function($p0){if($p0.getAttributeType()==="boolean")if($p0.getValue())return "1";else return "0";else return $p0.getValue().toString()},$c_3:function(){if(!this.$5_3)this.$0_3=new Mscrm.InlineTimerControlNoPrivilegeView(this);else if(IsNull(this.$9_3)||isNullOrEmptyString(this.$2_3)||this.$1_3)this.$0_3=new Mscrm.InlineTimerControlNotSetView(this);else if(!isNullOrEmptyString(this.$I_3)&&!isNullOrEmptyString(this.$J_3)&&!IsNull(this.$8_3.getValue())&&this.$J_3===this.$R_3(this.$8_3))this.$0_3=new Mscrm.InlineTimerControlFailureView(this);else if(!isNullOrEmptyString(this.$G_3)&&!isNullOrEmptyString(this.$H_3)&&!IsNull(this.$7_3.getValue())&&this.$H_3===this.$R_3(this.$7_3))this.$0_3=new Mscrm.InlineTimerControlCanceledView(this);else if(!isNullOrEmptyString(this.$L_3)&&!isNullOrEmptyString(this.$M_3)&&!IsNull(this.$D_3.getValue())&&this.$M_3===this.$R_3(this.$D_3))this.$0_3=new Mscrm.InlineTimerControlSuccessView(this);else if(this.$N_3>0)if(!isNullOrEmptyString(this.$O_3)&&!isNullOrEmptyString(this.$P_3)&&!IsNull(this.$E_3.getValue())&&this.$P_3===this.$R_3(this.$E_3))this.$0_3=new Mscrm.InlineTimerControlWarningView(this);else this.$0_3=new Mscrm.InlineTimerControlInProgressView(this);else this.$0_3=new Mscrm.InlineTimerControlViolatedView(this);return this.$0_3},$e_3:function($p0,$p1){var $v_0=Xrm.Page.ui;if(IsNull($v_0.controls))$v_0.controls=new Mscrm.ClientApiCollection;$v_0.controls.add($p0);Mscrm.InlineEditInitializerUtility.associateControlWithParentSection($p1,$p0)},refresh:function(){if(!IsNull(this.$0_3)){var $v_0=Xrm.Page.ui;!IsNull($v_0.controls)&&$v_0.controls.remove(this.$0_3);this.$0_3.dispose();this.$0_3=null}if(!IsNull(this.$A_3)){this.$A_3.dispose();this.$A_3=null}this.$W_3();this.$V_3()},dispose:function(){var $v_0=$find(Mscrm.ClientApiConstants.primaryEntityId);if($v_0&&!IsNull(this.$B_3)){$v_0.removeOnRecordIdChanged(this.$B_3);this.$B_3=null}this.$f_3();Mscrm.CrmUIControl.prototype.dispose.call(this)}};Mscrm.TimerControl.registerClass("Mscrm.TimerControl",Mscrm.CrmUIControl)