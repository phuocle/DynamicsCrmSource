Type.registerNamespace("Mscrm");Mscrm.showErrorMessage=function(errorMessage,overwrite){Mscrm.ErrorStatusControl&&Mscrm.ErrorStatusControl.showError(errorMessage,overwrite)};Mscrm.serviceaddress_onclick=function(){};Mscrm.billtoaddress_onclick=function(){};Mscrm.serviceaddress_setadditionalparams_1=function(context){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehaviorForForm("serviceaddress");lookupBehavior.AddDependantParameters("customerid")};Mscrm.serviceaddress_setadditionalparams_0=function(context){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehaviorForForm("serviceaddress");lookupBehavior.AddDependantParameters("customerid");var customerId=Mscrm.FormControlInputBehavior.GetBehaviorForForm("customerid"),customerData=customerId.get_dataValue();if(!IsNull(customerData)){lookupBehavior.AddParam("parentId",customerData[0].id);lookupBehavior.AddParam("parentType",customerData[0].type);lookupBehavior.set_enableSearchResults(true)}else{Mscrm.showErrorMessage(LOCID_ERROR_MISSING_CUSTOMER,true);lookupBehavior.set_enableSearchResults(false);return false}};Mscrm.billtoaddress_setadditionalparams=function(context){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billtoaddress");lookupBehavior.AddDependantParameters("billingcustomerid");var billingCustomerId=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billingcustomerid"),billingCustomerData=billingCustomerId.get_dataValue();if(!IsNull(billingCustomerData)){lookupBehavior.AddParam("parentId",billingCustomerData[0].id);lookupBehavior.AddParam("parentType",billingCustomerData[0].type);lookupBehavior.set_enableSearchResults(true)}else{Mscrm.showErrorMessage(LOCID_ERROR_MISSING_BT_CST,true);lookupBehavior.set_enableSearchResults(false);return false}};Mscrm.Form_onload=function(){var activeon=Xrm.Page.data.entity.attributes.get("activeon"),expireson=Xrm.Page.data.entity.attributes.get("expireson");activeon.setValue(CloneDate(activeon.getValue()));expireson.setValue(CloneDate(expireson.getValue()))};Mscrm.customerid_onchange=function(){var serviceaddress=Xrm.Page.data.entity.attributes.get("serviceaddress");serviceaddress.setValue([]);serviceaddress=Xrm.Page.ui.controls.get("serviceaddress");var customerid=Xrm.Page.data.entity.attributes.get("customerid");serviceaddress.setDisabled(IsNull(customerid.getValue()));var billingcustomerid=Xrm.Page.data.entity.attributes.get("billingcustomerid");IsNull(billingcustomerid.getValue())&&billingcustomerid.setValue(customerid.getValue())};Mscrm.serviceaddress_onchange=function(){var customerid=Xrm.Page.data.entity.attributes.get("customerid"),billingcustomerid=Xrm.Page.data.entity.attributes.get("billingcustomerid");if(!IsNull(customerid.getValue())&&!IsNull(billingcustomerid.getValue()))if(customerid.getValue()[0].id==billingcustomerid.getValue()[0].id){var billtoaddress=Xrm.Page.data.entity.attributes.get("billtoaddress");IsNull(billtoaddress.getValue())&&billtoaddress.setValue(Xrm.Page.data.entity.attributes.get("serviceaddress").getValue())}};Mscrm.activeon_onchange=function(){var activeon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("activeon"),expireson=Mscrm.FormControlInputBehavior.GetBehaviorForForm("expireson");if(!IsNull(expireson)&&IsStartDateLessThanEndDate(activeon.get_dataValue(),expireson.get_dataValue(),activeon,LOCID_CONTRACT_ED_DT_LT_ST_DT)){var billingstarton=Xrm.Page.data.entity.attributes.get("billingstarton");IsNull(billingstarton.getValue())&&billingstarton.setValue(activeon.get_dataValue())}Mscrm.CalculateDuration()};Mscrm.expireson_onchange=function(){var activeon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("activeon"),expireson=Mscrm.FormControlInputBehavior.GetBehaviorForForm("expireson");if(!IsNull(expireson.get_dataValue())&&IsStartDateLessThanEndDate(activeon.get_dataValue(),expireson.get_dataValue(),expireson,LOCID_CONTRACT_ED_DT_LT_ST_DT)){var contractExpireTime=CloneDate(expireson.get_dataValue());contractExpireTime.setHours(23,59,59);if(contractExpireTime.getTime()!=expireson.get_dataValue().getTime()){var newexpireson=Xrm.Page.data.entity.attributes.get("expireson");newexpireson.setValue(CloneDate(contractExpireTime))}var billingendon=Xrm.Page.data.entity.attributes.get("billingendon");IsNull(billingendon.getValue())&&billingendon.setValue(expireson.get_dataValue())}Mscrm.CalculateDuration()};Mscrm.CalculateDuration=function(){var activeon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("activeon"),expireson=Mscrm.FormControlInputBehavior.GetBehaviorForForm("expireson");if(!IsNull(activeon.get_dataValue())&&!IsNull(expireson.get_dataValue())){var days=((new Date(expireson.get_dataValue())-new Date(activeon.get_dataValue()))/8.64e7).toFixed(0),durationSpan=XUI.Html.DomUtils.GetFirstChild(XUI.Html.DomUtils.GetFirstChild(document.getElementById("duration")));if(!IsNull(durationSpan))if(!isNaN(days))durationSpan.textContent=days}};Mscrm.billingcustomerid_onchange=function(){var billtoaddress=Xrm.Page.data.entity.attributes.get("billtoaddress"),billingcustomerid=Xrm.Page.data.entity.attributes.get("billingcustomerid");billtoaddress.setValue([]);billtoaddress=Xrm.Page.ui.controls.get("billtoaddress");billtoaddress.setDisabled(IsNull(billingcustomerid.getValue()))};Mscrm.billingstarton_onchange=function(){var billingstarton=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billingstarton"),billingendon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billingendon");if(!IsNull(billingendon))return IsStartDateLessThanEndDate(billingstarton.get_dataValue(),billingendon.get_dataValue(),billingstarton,LOCID_CONTRACT_ED_DT_LT_ST_DT);else return true};Mscrm.billingendon_onchange=function(){var billingstarton=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billingstarton"),billingendon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("billingendon"),billingEndTime=CloneDate(billingendon.get_dataValue());billingEndTime.setHours(23,59,59);if(billingEndTime.getTime()!=billingendon.get_dataValue().getTime()){var newbillingendon=Xrm.Page.data.entity.attributes.get("billingendon");newbillingendon.setValue(CloneDate(billingEndTime))}return IsStartDateLessThanEndDate(billingstarton.get_dataValue(),billingendon.get_dataValue(),billingendon,LOCID_CONTRACT_ED_DT_LT_ST_DT)}