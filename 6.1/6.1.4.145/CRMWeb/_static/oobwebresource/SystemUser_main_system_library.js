var _gArrDependentPicklists=null,_in_Mscrm_domainname_onchange=false;Type.registerNamespace("Mscrm");Mscrm.accessmode_onchange=function(){paramParentFieldId="accessmode";paramChildFieldId="caltype";for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList];if(DependentPicklist.ParentFieldId===paramParentFieldId&&DependentPicklist.ChildFieldId===paramChildFieldId){var ParentFieldControl=Xrm.Page.ui.controls.get(paramParentFieldId),ParentField=Xrm.Page.data.entity.attributes.get(paramParentFieldId),ChildFieldControl=Xrm.Page.ui.controls.get(DependentPicklist.ChildFieldId),ChildField=Xrm.Page.data.entity.attributes.get(DependentPicklist.ChildFieldId),CurrentChildFieldValue=ChildField.getValue();if(ParentField.getValue()==null){ChildField.setValue(null);ChildField.setSubmitMode("always");ChildField.fireOnChange();ChildFieldControl.setDisabled(true);return}for(var og in DependentPicklist.OptionsGroup){var OptionsGroup=DependentPicklist.OptionsGroup[og];if(ParentField.getValue()==OptionsGroup.ParentValue){ChildFieldControl.setDisabled(false);var bCurrentValueIsValid=false;ChildFieldControl.clearOptions();for(var i=0;i<OptionsGroup.Options.length;i++){ChildFieldControl.addOption(OptionsGroup.Options[i]);if(CurrentChildFieldValue==OptionsGroup.Options[i].value)bCurrentValueIsValid=true}ChildFieldControl.removeOption("");if(bCurrentValueIsValid)ChildField.setValue(CurrentChildFieldValue);else{ChildField.setValue(OptionsGroup.Options[0].value);ChildField.setSubmitMode("always")}OptionsGroup.Options.length==1&&ChildFieldControl.setDisabled(true);break}}}}};Mscrm.domainname_onchange=function(){if(_in_Mscrm_domainname_onchange!==true)try{_in_Mscrm_domainname_onchange=true;var domainname=Xrm.Page.data.entity.attributes.get("domainname").getValue();if(domainname!=null&&domainname.length>0){var oCommand=new RemoteCommand("UserManager","RetrieveADUserProperties");if(oCommand!=null){oCommand.SetParameter("domainAccountName",domainname);var oResult=oCommand.Execute();if(oResult.Success&&!IsNull(oResult.ReturnValue)&&oResult.ReturnValue.length>0){var oUserXmlDocRoot=XUI.Xml.LoadXml(oResult.ReturnValue),oUserXmlDoc=XUI.Xml.DomUtils.GetFirstChild(oUserXmlDocRoot),childIterator=function(child){var oAttribute=Xrm.Page.data.entity.attributes.get(child.nodeName);!IsNull(oAttribute)&&oAttribute.setValue(XUI.Xml.GetText(child));return false};XUI.Xml.DomUtils.ForEachChild(oUserXmlDoc,childIterator)}}}}finally{_in_Mscrm_domainname_onchange=false}};function assign_control(controlname,value){var control=Xrm.Page.ui.controls.get(controlname);control!==null&&control.getAttribute().setValue(value)}function initialize_emaildelivery(){typeof _incomingEmailDeliveryMethod!=="undefined"&&assign_control("incomingemaildeliverymethod",_incomingEmailDeliveryMethod);typeof _outgoingEmailDeliveryMethod!=="undefined"&&assign_control("outgoingemaildeliverymethod",_outgoingEmailDeliveryMethod)}function hide_parentcontrol(controlName){var control=Xrm.Page.getControl(controlName);if(!Mscrm.InternalUtilities.JSTypes.isNull(control)){var controlParent=control.getParent();if(!Mscrm.InternalUtilities.JSTypes.isNull(controlParent)){controlParent.setVisible(false);return true}}return false}function initialize_accountinfo(){var context=Xrm.Page.context;if(!Mscrm.InternalUtilities.JSTypes.isNull(context.isCrmOnline)&&context.isCrmOnline()){if(!Mscrm.InternalUtilities.JSTypes.isNull(context.isOffice365)&&!context.isOffice365())hide_parentcontrol("domainname")&&Xrm.Page.getAttribute("domainname").setRequiredLevel(Xrm.RequiredLevel.none);else hide_parentcontrol("windowsliveid");var caltypeControl=Xrm.Page.getControl("caltype");!Mscrm.InternalUtilities.JSTypes.isNull(caltypeControl)&&caltypeControl.setVisible(false)}else hide_parentcontrol("windowsliveid")}Mscrm.Form_onload=function(){var CRM_FORM_TYPE_CREATE=1,CRM_FORM_TYPE_UPDATE=2;initialize_accountinfo();switch(Xrm.Page.ui.getFormType()){case CRM_FORM_TYPE_CREATE:case CRM_FORM_TYPE_UPDATE:_gArrDependentPicklists=[{ParentFieldId:"accessmode",ChildFieldId:"caltype",ChildFieldLabel:"License Type",OptionsGroup:[{ParentValue:"0",ChildOptionValues:["5","6","2","4","0","3","7","8"]},{ParentValue:"1",ChildOptionValues:["1"]},{ParentValue:"2",ChildOptionValues:["2","4"]}]}];for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList],options=Xrm.Page.data.entity.attributes.get(DependentPicklist.ChildFieldId).getOptions();for(var og in DependentPicklist.OptionsGroup){var OptionsGroup=DependentPicklist.OptionsGroup[og],aOptionGroup=[];for(var value in OptionsGroup.ChildOptionValues)for(var opt in options)OptionsGroup.ChildOptionValues[value]==options[opt].value&&aOptionGroup.push(options[opt]);OptionsGroup.Options=aOptionGroup}}for(var depPickList in _gArrDependentPicklists){var DependentPicklist=_gArrDependentPicklists[depPickList];Xrm.Page.data.entity.attributes.get(DependentPicklist.ParentFieldId).fireOnChange()}break}Mscrm.accessmode_onchange();if(Xrm.Page.context.client.getClient()==="Mobile")return;initialize_emaildelivery()}