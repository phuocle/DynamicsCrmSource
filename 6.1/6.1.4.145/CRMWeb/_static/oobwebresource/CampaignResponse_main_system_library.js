Type.registerNamespace("Mscrm");Mscrm.Form_onload=function(){if(Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString(Xrm.Page.data.entity.getId())){var now=LocalDateTimeNow().getTime(),today=new Date(now);today.setHours(0,0,0,0);var receivedOn=Xrm.Page.data.entity.attributes.get("receivedon");receivedOn.setValue(today)}var customerLookupControl=Xrm.Page.ui.controls.get("customer").getAttribute();if(!Mscrm.InternalUtilities.JSTypes.isNull(customerLookupControl)){customerLookupControl.addOnChange(customer_onchange);customerLookupControl.fireOnChange()}window.onbeforeunload=function(){var customerLookupControl=Xrm.Page.ui.controls.get("customer").getAttribute();!Mscrm.InternalUtilities.JSTypes.isNull(customerLookupControl)&&customerLookupControl.removeOnChange(customer_onchange)}};function customer_onchange(context){var closedState=1,state=Xrm.Page.data.entity.attributes.get("statecode").getValue();if(state!==closedState&&!Mscrm.InternalUtilities.JSTypes.isNull(context)&&!Mscrm.InternalUtilities.JSTypes.isNull(context.getEventSource())){var customerLookupItems=context.getEventSource().getValue();if(Mscrm.InternalUtilities.JSTypes.isNull(customerLookupItems))enableNewCustomerFields();else disableAndClearNewCustomerFields()}}function enableNewCustomerFields(){disableNewCustomerFields(false)}function disableAndClearNewCustomerFields(){disableNewCustomerFields(true);setFieldValue("companyname","");setFieldValue("lastname","");setFieldValue("firstname","");setFieldValue("telephone","");setFieldValue("emailaddress","");setFieldValue("yomicompanyname","");setFieldValue("yomilastname","");setFieldValue("yomifirstname","")}function disableNewCustomerFields(disabled){setControlDisabled("companyname",disabled);setControlDisabled("lastname",disabled);setControlDisabled("firstname",disabled);setControlDisabled("telephone",disabled);setControlDisabled("emailaddress",disabled);setControlDisabled("yomicompanyname",disabled);setControlDisabled("yomilastname",disabled);setControlDisabled("yomifirstname",disabled)}function setControlDisabled(controlName,disabled){var control=Xrm.Page.getControl(controlName);control&&control.setDisabled(disabled)}function setFieldValue(name,value){var attribute=Xrm.Page.data.entity.attributes.get(name);attribute&&attribute.setValue(value)}