Type.registerNamespace("Mscrm");Mscrm.LeadCommandActions=function(){};Mscrm.LeadCommandActions.qualifyLeadQuick=function(){Mscrm.LeadCommandActions.qualifyLeadAs(-1)};Mscrm.LeadCommandActions.qualifyLeadAs=function(qualifyStatus){if(Mscrm.InternalUtilities.JSTypes.isNull(Xrm.Page.data.entity.getId()))return;if(!Xrm.Page.data.getIsValid())return;Xrm.Page.context.saveMode=Xrm.SaveMode.qualify;Xrm.Page.data.save().then(function(){Mscrm.LeadCommandActions.$7(qualifyStatus)},Mscrm.InternalUtilities.ClientApiUtility.operationFailedCallback);Xrm.Page.context.saveMode=-1};Mscrm.LeadCommandActions.disqualifyLeadQuick=function(){Mscrm.LeadCommandActions.disqualifyLeadAs(-1)};Mscrm.LeadCommandActions.disqualifyLeadAs=function(disqualifyStatus){Xrm.Page.context.saveMode=Xrm.SaveMode.disqualify;var $v_0=2;Mscrm.CommandBarActions.setState(Xrm.Page.data.entity.getId(),Mscrm.InternalUtilities.EntityNames.Lead,$v_0,disqualifyStatus);Xrm.Page.context.saveMode=-1};Mscrm.LeadCommandActions.performActionAfterHandleLeadDuplication=function(returnValue){var $v_0=returnValue.qualifyStatus,$v_1=returnValue.transactionCurrencyId,$v_2=returnValue.parentAccountId,$v_3=returnValue.parentContactId,$v_4=returnValue.parentAccountName,$v_5=returnValue.parentContactName;Mscrm.LeadCommandActions.$5("parentaccountid",$v_4,$v_2,Mscrm.InternalUtilities.EntityNames.Account);Mscrm.LeadCommandActions.$5("parentcontactid",$v_5,$v_3,Mscrm.InternalUtilities.EntityNames.Contact);if(Xrm.Page.data.entity.getIsDirty())Xrm.Page.data.save().then(function(){Mscrm.LeadCommandActions.$3($v_0,$v_1,true)},Mscrm.InternalUtilities.ClientApiUtility.operationFailedCallback);else Mscrm.LeadCommandActions.$3($v_0,$v_1,true)};Mscrm.LeadCommandActions.getTransactionCurrencyId=function(succeedCallback,errorCallback){var $v_0=Xrm.Page.getAttribute("transactioncurrencyid");if(!Mscrm.InternalUtilities.JSTypes.isNull($v_0)){var $v_3=$v_0.getValue();if(!Mscrm.InternalUtilities.JSTypes.isNull($v_3)&&$v_3.length>0){succeedCallback($v_3[0].id);return}}var $v_1=Xrm.Page.context.getUserId(),$v_2=["transactioncurrencyid","organizationid"];Xrm.Internal.messages.retrieve(Mscrm.InternalUtilities.EntityNames.SystemUser,$v_1,$v_2).then(function($p1_0){var $v_4=$p1_0.get_entity();if($v_4.hasValue("transactioncurrencyid"))succeedCallback($v_4.getValue("transactioncurrencyid").Id.toString());else{$v_1=$v_4.getValue("organizationid").toString();$v_2=["basecurrencyid"];Xrm.Internal.messages.retrieve(Mscrm.InternalUtilities.EntityNames.Organization,$v_1,$v_2).then(function($p2_0){var $v_5=$p2_0.get_entity();succeedCallback($v_5.getValue("basecurrencyid").Id.toString())},errorCallback)}},errorCallback)};Mscrm.LeadCommandActions.$3=function($p0,$p1,$p2){var $v_0=null,$v_1=null,$v_2=null,$v_3=null,$v_4=false,$v_5=false,$v_6=Mscrm.InternalUtilities._String.Empty,$v_7=false,$v_8=true,$v_9=true,$v_A=Mscrm.LeadCommandActions.$1(Mscrm.LeadCommandActions.$2("campaignid")),$v_B=null,$v_C=Mscrm.LeadCommandActions.$2("parentaccountid");$v_0=Mscrm.LeadCommandActions.$1($v_C);if(!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($v_0)){$v_5=true;$v_2=$v_C.name}var $v_D=Mscrm.LeadCommandActions.$2("parentcontactid");$v_1=Mscrm.LeadCommandActions.$1($v_D);if(!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($v_1)){$v_4=true;$v_3=$v_D.name}var $v_E=Xrm.Page.getAttribute("companyname");if(!Mscrm.InternalUtilities.JSTypes.isNull($v_E)){var $v_J=$v_E.getValue();if(!Mscrm.InternalUtilities.JSTypes.isNull($v_J))$v_6=$v_J}if(!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($v_6))$v_7=true;if($v_5&&$v_4){$v_7=false;$v_8=false;$v_B=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference(Mscrm.InternalUtilities.EntityNames.Account,new Microsoft.Dynamics.Client.Core.Framework.Guid($v_0))}else if($v_5){$v_7=false;$v_8=true}else if($v_4)if(!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($v_6)){$v_7=true;$v_8=false}else{$v_7=false;$v_8=false;$v_B=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference(Mscrm.InternalUtilities.EntityNames.Contact,new Microsoft.Dynamics.Client.Core.Framework.Guid($v_1))}var $v_F=new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference(Mscrm.InternalUtilities.EntityNames.Lead,new Microsoft.Dynamics.Client.Core.Framework.Guid(Xrm.Page.data.entity.getId())),$v_G=Mscrm.InternalUtilities._String.isNullOrWhiteSpace($p1)?null:new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference(Mscrm.InternalUtilities.EntityNames.Lead,new Microsoft.Dynamics.Client.Core.Framework.Guid($p1)),$v_H=Mscrm.InternalUtilities._String.isNullOrWhiteSpace($v_A)?null:new Microsoft.Crm.Client.Core.Storage.Common.ObjectModel.EntityReference(Mscrm.InternalUtilities.EntityNames.Campaign,new Microsoft.Dynamics.Client.Core.Framework.Guid($v_A)),$v_I=function($p1_0){var $v_K=-2147220685;if($p1_0.get_organizationServiceFault().get_errorCode()===$v_K)Mscrm.LeadCommandActions.$6($v_0,$v_1,$v_2,$v_3,$p0,$p1);else Mscrm.CommandBarActions.actionFailedCallback($p1_0)};Xrm.Internal.messages.qualifyLead($v_F,$v_7,$v_8,$v_9,$v_G,$v_B,$v_H,$p0,$p2).then(function($p1_0){for(var $v_L=$p1_0,$v_M=null,$v_N=0;$v_N<$v_L.get_createdEntities().length;$v_N++)if($v_L.get_createdEntities()[$v_N].LogicalName===Mscrm.InternalUtilities.EntityNames.Opportunity){$v_M=$v_L.get_createdEntities()[$v_N];break}if(!Mscrm.InternalUtilities.JSTypes.isNull($v_M)){var $v_O=Xrm.Internal.getEntityCode(Xrm.Page.data.entity.getEntityName());Xrm.Internal.refreshParentGrid($v_O,"",Xrm.Page.data.entity.getId());Xrm.Utility.openEntityForm($v_M.LogicalName,$v_M.Id.toString(),{})}},$v_I)};Mscrm.LeadCommandActions.$6=function($p0,$p1,$p2,$p3,$p4,$p5){var $v_0=Mscrm.CrmUri.create("/SFA/Leads/Dialogs/dup_warning.aspx");$v_0.get_query()["parentAccountId"]=$p0;$v_0.get_query()["parentContactId"]=$p1;$v_0.get_query()["parentAccountName"]=$p2;$v_0.get_query()["parentContactName"]=$p3;$v_0.get_query()["qualifyStatus"]=$p4;$v_0.get_query()["transactionCurrencyId"]=$p5;$v_0.get_query()["leadId"]=window._id;var $v_1=new Xrm.DialogOptions;$v_1.width=400;$v_1.height=300;var $v_2=Mscrm.LeadCommandActions.performActionAfterHandleLeadDuplication;Xrm.Internal.openDialog($v_0.toString(),$v_1,null,null,$v_2)};Mscrm.LeadCommandActions.$7=function($p0){Mscrm.LeadCommandActions.getTransactionCurrencyId(function($p1_0){Mscrm.LeadCommandActions.$3($p0,$p1_0,false)},Mscrm.CommandBarActions.actionFailedCallback)};Mscrm.LeadCommandActions.$2=function($p0){var $v_0=Xrm.Page.getAttribute($p0);if(!Mscrm.InternalUtilities.JSTypes.isNull($v_0)){var $v_2=$v_0.getValue();if(!Mscrm.InternalUtilities.JSTypes.isNull($v_2))return $v_2[0]}var $v_1=new Xrm.LookupObject;return $v_1};Mscrm.LeadCommandActions.$1=function($p0){var $v_0=null;if(!Mscrm.InternalUtilities.JSTypes.isNull($p0))$v_0=$p0.id;return $v_0};Mscrm.LeadCommandActions.$5=function($p0,$p1,$p2,$p3){var $v_0=Xrm.Page.getAttribute($p0);if(!Mscrm.InternalUtilities.JSTypes.isNull($v_0)&&!Mscrm.InternalUtilities.JSTypes.isNullOrEmptyString($p2)){if(!Mscrm.InternalUtilities.JSTypes.isNull($v_0.getValue()))if($v_0.getValue()[0].id===$p2)return;var $v_1=new Xrm.LookupObject;$v_1.entityType=$p3;$v_1.id=$p2;$v_1.name=$p1;var $v_2=new Array(1);$v_2[0]=$v_1;$v_0.setValue($v_2);Xrm.Page.data.setFormDirty(true)}};Mscrm.LeadGridCommandActions=function(){};Mscrm.LeadGridCommandActions.qualifyLeadQuick=function(gridControl,records,entityTypeCode){Mscrm.LeadGridCommandActions.qualifyLeadAs(gridControl,records,entityTypeCode,-1)};Mscrm.LeadGridCommandActions.qualifyLeadAs=function(gridControl,records,entityTypeCode,statusCode){Mscrm.LeadGridCommandActions.$4(gridControl,records,entityTypeCode,true,statusCode)};Mscrm.LeadGridCommandActions.disqualifyLeadQuick=function(gridControl,records,entityTypeCode){Mscrm.LeadGridCommandActions.disqualifyLeadAs(gridControl,records,entityTypeCode,-1)};Mscrm.LeadGridCommandActions.disqualifyLeadAs=function(gridControl,records,entityTypeCode,statusCode){Mscrm.LeadGridCommandActions.$4(gridControl,records,entityTypeCode,false,statusCode)};Mscrm.LeadGridCommandActions.$4=function($p0,$p1,$p2,$p3,$p4){var $v_0=Mscrm.CrmUri.create("/_grid/cmds/dlg_convertlead.aspx");$v_0.get_query()["iObjType"]=$p2;$v_0.get_query()["iTotal"]=$p1.length;$v_0.get_query()["qualify"]=$p3;$v_0.get_query()["qlShowNew"]=false;$v_0.get_query()["ulNewStatus"]=$p4;Mscrm.InternalUtilities.GridUtilities.executeStandardAction($v_0,$p1,400,200,Mscrm.InternalUtilities.ClientApiUtility.createRefreshGridCallback($p0))};Mscrm.LeadCommandActions.registerClass("Mscrm.LeadCommandActions");Mscrm.LeadGridCommandActions.registerClass("Mscrm.LeadGridCommandActions")