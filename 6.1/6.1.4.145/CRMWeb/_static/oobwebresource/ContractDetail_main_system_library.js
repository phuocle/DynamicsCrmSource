Type.registerNamespace("Mscrm");Mscrm.productid_setadditionalparams=function(context){var oLookup=Mscrm.FormControlInputBehavior.GetBehaviorForForm("productid");oLookup.AddBindingColumn("defaultuomscheduleid")};Mscrm.uomid_setadditionalparams=function(context){var uomscheduleid=$get("uomscheduleid");if(uomscheduleid.value!=undefined&&uomscheduleid.value!=""){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehaviorForForm("uomid");lookupBehavior.AddParam("parentId",uomscheduleid.value);lookupBehavior.AddParam("parentType",UoMSchedule)}};Mscrm.serviceaddress_setadditionalparams=function(context){var oLookup=Mscrm.FormControlInputBehavior.GetBehaviorForForm("serviceaddress");oLookup.AddDependantParameters("customerid")};Mscrm.Form_onload=function(){var crmForm=$find("crmForm");if(crmForm.get_formType()!=Mscrm.SdkFormType.readOnlyForm&&crmForm.get_formType()!=Mscrm.SdkFormType.disabledForm){if(!IsNull(_bIsDateAllotment)&&_bIsDateAllotment){var totalallotmentsControl=Xrm.Page.data.entity.attributes.get("totalallotments");totalallotmentsControl.setRequiredLevel(Xrm.RequiredLevel.none);totalallotmentsControl.setValue(null);Mscrm.setDisabled("totalallotments",true);Xrm.Page.data.entity.attributes.get("allotmentsused").setValue(null);Xrm.Page.data.entity.attributes.get("allotmentsremaining").setValue(null)}if(!IsNull(_bIsActiveForm)&&_bIsActiveForm){Xrm.Page.data.entity.attributes.get("uomid").setSubmitMode("always");Mscrm.setDisabled("uomid",IsNull(Xrm.Page.data.entity.attributes.get("productid").getValue()))}}};Mscrm.Form_onsave=function(context){var args=context.getEventArgs(),discountControl=Xrm.Page.data.entity.attributes.get("discount"),priceControl=Xrm.Page.data.entity.attributes.get("price");if(!IsNull(discountControl)&&!IsNull(priceControl))if(!IsNull(discountControl.getValue())&&!isNaN(discountControl.getValue())&&(!IsNull(priceControl.getValue())&&!isNaN(priceControl.getValue())))if(discountControl.getValue()>priceControl.getValue()){alert(LOCID_ERROR_INVALID_DISCOUNT);args.preventDefault();return false}};Mscrm.productid_onchange=function(context){var uomid=Xrm.Page.data.entity.attributes.get("uomid");uomid.setValue(null);Mscrm.setDisabled("uomid",IsNull(Xrm.Page.data.entity.attributes.get("productid").getValue()));var uomScheduleId="",items=Mscrm.FormControlInputBehavior.GetBehaviorForForm(context.getEventSource().getName()).Items(false,false,false,false,false);if(!IsNull(items)&&items.length>0)if(!IsNull(items[0].keyValues["defaultuomscheduleid_Hidden"]))uomScheduleId=items[0].keyValues["defaultuomscheduleid_Hidden"].value;else if(!IsNull(items[0].keyValues["defaultuomscheduleid"]))uomScheduleId=items[0].keyValues["defaultuomscheduleid"].value;var uomschedule=Mscrm.getUomSchedule(uomScheduleId),uomscheduleid=Xrm.Page.data.entity.attributes.get("uomscheduleid");!IsNull(uomscheduleid)&&uomscheduleid.setValue(uomschedule)};Mscrm.activeon_onchange=function(){var activeon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("activeon"),expireson=Mscrm.FormControlInputBehavior.GetBehaviorForForm("expireson");return IsStartDateLessThanEndDate(activeon.get_dataValue(),expireson.get_dataValue(),activeon,LOCID_CONTRACT_ED_DT_LT_ST_DT)};Mscrm.expireson_onchange=function(){var activeon=Mscrm.FormControlInputBehavior.GetBehaviorForForm("activeon"),expireson=Mscrm.FormControlInputBehavior.GetBehaviorForForm("expireson"),currentExpiresonValue=expireson.get_dataValue();if(currentExpiresonValue&&IsStartDateLessThanEndDate(activeon.get_dataValue(),currentExpiresonValue,expireson,LOCID_CONTRACT_ED_DT_LT_ST_DT)){var newExpiresonValue=CloneDate(currentExpiresonValue);newExpiresonValue.setHours(23,59,59);newExpiresonValue.getTime()!=currentExpiresonValue.getTime()&&Xrm.Page.getAttribute("expireson").setValue(newExpiresonValue);return true}return false};Mscrm.discount_onchange=function(){Mscrm.handleEmptyInputValue("discount",0)};Mscrm.discountpercentage_onchange=function(){Mscrm.handleEmptyInputValue("discountpercentage",0)};Mscrm.handleEmptyInputValue=function(attributeId,attributeValue){var attribute=Xrm.Page.getAttribute(attributeId);if(!IsNull(attribute)){var dataValue=attribute.getValue();(IsNull(dataValue)||Trim(dataValue.toString())=="")&&attribute.setValue(attributeValue)}};Mscrm.setDisabled=function(attributeId,value){if(!IsNull(attributeId)){var attribute=Xrm.Page.data.entity.attributes.get(attributeId);if(!IsNull(attribute))for(var controls=attribute.controls.get(),count=controls.length,i=0;i<count;i++)controls[i].setDisabled(value)}};Mscrm.getUomSchedule=function(id){if(!IsNull(id)&&id!=""){var uomschedule=new Array(1);uomschedule[0]=new Xrm.LookupObject;uomschedule[0].id=id;uomschedule[0].name="";uomschedule[0].entityType="uomschedule";return uomschedule}return null}