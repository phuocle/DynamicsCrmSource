Type.registerNamespace("Mscrm");var sourcetypecode=null,convertruleid=null;Mscrm._toggleParentDisplay=function(Element,flg){Element.parentElement.style.display=flg?"table-row":"none"};Mscrm.Form_onsave=function(){Xrm.Page.getAttribute("name").setSubmitMode("dirty")};Mscrm.Form_onload=function(){Xrm.Page.getAttribute("name").setSubmitMode("always");Mscrm.CheckIfResolved_onchange();Mscrm.SendAutomaticResponse_onchange();var isCreate=Xrm.Page.ui.getFormType()==Xrm.FormType.create,extraqs=Mscrm.CrmUri.create(window.location.search);sourcetypecode=Xrm.Page.data.entity.attributes.get("sourcetypecode").getValue().toString();if(!IsNull(extraqs)&&isCreate){extraqs=CrmEncodeDecode.CrmUrlDecode(extraqs);convertruleid=Mscrm.CrmUri.create(extraqs).get_query()["id"]}else convertruleid=Xrm.Page.data.entity.attributes.get("convertruleid").getValue().toString();if(sourcetypecode=="1"){Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(true);Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(false)}else if(sourcetypecode=="2"){Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(true);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(true);Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(false)}else{Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(false)}if(!IsNull(convertruleid)){Xrm.Page.getControl("sourcetypecode").setDisabled(true);if(!isCreate&&Xrm.Page.data.entity.attributes.get("sourcetypecode").getValue()==2){var notificationText="";if(Xrm.Page.data.entity.attributes.get("statecode").getValue()==0)notificationText=LOCID_ERROR_MISSING_RRI;else notificationText=LOCID_ERROR_MISSING_ALL;Xrm.Page.ui.setFormNotification(notificationText,"WARNING","ConvertRuleErrorNotofication")}if(!isCreate&&Xrm.Page.data.entity.attributes.get("sourcetypecode").getValue()==1){var notificationText="";if(Xrm.Page.data.entity.attributes.get("statecode").getValue()==0){notificationText=LOCID_DRAFT_WARNING_MSG;Xrm.Page.ui.setFormNotification(notificationText,"WARNING","ConvertRuleErrorNotification")}}}};Mscrm.CheckIfResolved_onchange=function(){sourcetypecode=Xrm.Page.data.entity.attributes.get("sourcetypecode").getValue();if(sourcetypecode=="2"){var resolveSinceCtrId="ResolvedSince_c";Mscrm._toggleParentDisplay($get(resolveSinceCtrId),Xrm.Page.getAttribute("checkifresolved").getValue());var resolveSinceSpan=XUI.Html.DomUtils.GetFirstChild($get(resolveSinceCtrId));if(!IsNull(resolveSinceSpan)&&resolveSinceSpan.className.indexOf("ms-crm-InlineEditLabelWap")<0)resolveSinceSpan.className+=" ms-crm-InlineEditLabelWap"}};Mscrm.SendAutomaticResponse_onchange=function(){Mscrm._toggleParentDisplay($get("ResponseTemplateId_c"),Xrm.Page.getAttribute("sendautomaticresponse").getValue())};Mscrm.sourcetypecode_onchange=function(){sourcetypecode=Xrm.Page.data.entity.attributes.get("sourcetypecode").getValue();if(sourcetypecode=="1"){Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(true);Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(false)}else if(sourcetypecode=="2"){Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(true);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(true)}else{Xrm.Page.ui.tabs.get("general").sections.get("SocialMonitoringCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("EmailCaseConditions").setVisible(false);Xrm.Page.ui.tabs.get("general").sections.get("AutoResponseSettings").setVisible(false)}Mscrm.CheckIfResolved_onchange()}