Type.registerNamespace("Mscrm");Mscrm.uomid_setadditionalparams=function(context){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehavior("uomid");lookupBehavior.AddParam("ObjectTypeCode",1088);lookupBehavior.AddParam("ObjectId",$get("salesorderid").value);lookupBehavior.AddParam("ProductId",Mscrm.FormControlInputBehavior.GetBehavior("productid").get_dataValue()[0].id);lookupBehavior.AddParam("ShowNewButton",0)};Mscrm.Form_onload=function(){var crmForm=$find("crmForm");if(crmForm.get_formType()!=Mscrm.SdkFormType.readOnlyForm&&crmForm.get_formType()!=Mscrm.SdkFormType.disabledForm){var quantityControl=Mscrm.FormControlInputBehavior.GetBehavior("quantity"),iOriginalQty=quantityControl.get_dataValue();EnableDisableShippingAddress();_defaultQtyAcc=quantityControl.get_precision();var ispriceoverridden=Mscrm.FormControlInputBehavior.GetBehavior("ispriceoverridden"),productid=Mscrm.FormControlInputBehavior.GetBehavior("productid"),uomid=Mscrm.FormControlInputBehavior.GetBehavior("uomid"),productdescription=Mscrm.FormControlInputBehavior.GetBehavior("productdescription"),isproductoverridden=Mscrm.FormControlInputBehavior.GetBehavior("isproductoverridden"),priceperunit=Mscrm.FormControlInputBehavior.GetBehavior("priceperunit");_productQtyDec=IsNull(productid.get_dataValue())?_defaultQtyAcc:PRODUCT_QTY_DEC;if(PRICING_LOCKED){FORM_STATE!=FORM_STATE_NEW&&productid.set_disabled(true);uomid.set_disabled(true);isproductoverridden.set_disabled(true);productdescription.set_disabled(true);ispriceoverridden.set_disabled(true);priceperunit.set_disabled(true);$find("crmForm").SetFieldReqLevel("productid",true);$find("crmForm").SetFieldReqLevel("uomid",true);quantityControl.set_precision(_productQtyDec)}else{SetAttributeIfNotNull(ispriceoverridden.get_element().id,"prevDataValue",ispriceoverridden.get_dataValue());SetAttributeIfNotNull(productid.get_element().id,"prevDataValue",productid.get_dataValue());SetAttributeIfNotNull(uomid.get_element().id,"prevDataValue",uomid.get_dataValue());SetAttributeIfNotNull(productdescription.get_element().id,"prevDataValue",productdescription.get_dataValue());ProductOverriddenHandler();if(!CAN_OVERRIDE_PRICE){isproductoverridden.set_disabled(true);ispriceoverridden.set_disabled(true)}}quantityControl.get_isDirty()&&alert(formatString(LOCID_QTY_CHANGED_DUE_TO_ACC_H,Mscrm.NumberUtility.addFormatting(iOriginalQty),Mscrm.NumberUtility.addFormatting(quantityControl.get_dataValue(),quantityControl.get_precision()))+"\n"+LOCID_QTY_CHANGED_DUE_TO_ACC_F)}};Mscrm.isproductoverridden_onchange=function(){ProductOverriddenHandler()};Mscrm.productid_onchange=function(){var uomid=Mscrm.FormControlInputBehavior.GetBehavior("uomid"),productid=Mscrm.FormControlInputBehavior.GetBehavior("productid");uomid.Clear();uomid.set_disabled(IsNull(productid.get_dataValue()));_productQtyDec=_defaultQtyAcc;Mscrm.FormControlInputBehavior.GetBehavior("quantity").set_precision(_defaultQtyAcc);Mscrm.FormControlInputBehavior.GetBehavior("quantityshipped").set_precision(_defaultQtyAcc);Mscrm.FormControlInputBehavior.GetBehavior("quantitybackordered").set_precision(_defaultQtyAcc);Mscrm.FormControlInputBehavior.GetBehavior("quantitycancelled").set_precision(_defaultQtyAcc)};Mscrm.uomid_onchange=function(){var uomid=Mscrm.FormControlInputBehavior.GetBehavior("uomid"),productid=Mscrm.FormControlInputBehavior.GetBehavior("productid"),aoItems=uomid.get_dataValue();if(IsNull(aoItems))_productQtyDec=_defaultQtyAcc;else _productQtyDec=GetQuantityDecimal(1088,$get("salesorderid").value,productid.get_dataValue()[0].id,aoItems[0].id);Mscrm.FormControlInputBehavior.GetBehavior("quantity").set_precision(_productQtyDec);Mscrm.FormControlInputBehavior.GetBehavior("quantityshipped").set_precision(_productQtyDec);Mscrm.FormControlInputBehavior.GetBehavior("quantitybackordered").set_precision(_productQtyDec);Mscrm.FormControlInputBehavior.GetBehavior("quantitycancelled").set_precision(_productQtyDec);Mscrm.FormControlInputBehavior.GetBehavior("quantitycancelled").set_precision(_productQtyDec)};Mscrm.ispriceoverridden_onchange=function(){UpdatePriceOverriden()};Mscrm.willcall_onchange=function(){EnableDisableShippingAddress()};Mscrm.productid_setadditionalparams=function(context){var lookupBehavior=Mscrm.FormControlInputBehavior.GetBehavior("productid");lookupBehavior.AddParam("ObjectTypeCode",1088);lookupBehavior.AddParam("ObjectId",$get("salesorderid").value)};Mscrm.Form_onsave=function(context){CheckPriceAndQuantityNonNegative(context.getEventArgs())}