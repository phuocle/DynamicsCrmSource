Type.registerNamespace("Mscrm");function loadArea(selectedNavLink,area,parameters,url,isvMode,passParams){return Mscrm.Details.loadArea(selectedNavLink,area,parameters,url,isvMode,passParams)}function loadIsvArea(selectedNavLink,url,passParams,domEvent){return Mscrm.Details.loadIsvArea(selectedNavLink,url,passParams,domEvent)}function addActivityTo(typeCode,id,type,name,partyId,partyType,partyName,location,contentId){Mscrm.AddActivity.addActivityTo(typeCode,id,type,name,partyId,partyType,partyName,location,contentId)}Mscrm.Details=function(){};Mscrm.Details.get_usingMainFormRibbonData=function(){return !IsNull($get("areaForm"))};Mscrm.Details.$A=function(){var $v_0=window.top.document.getElementById("crmRibbonManager");if(Mscrm.Utilities.isRefreshForm()&&$v_0){$v_0.style.visibility="hidden";Mscrm.PerceivedCommandBarHelper.setPerceivedCommandBarAsHidden()}};Mscrm.Details.$8=function(){var $v_0=$get("FormTitle"),$v_1=$find("crmForm");if(!IsNull($v_0)&&!IsNull($v_1)){var $v_2=$v_1.get_formUrl();if("extraqs" in $v_2.get_query()){var $v_4=Mscrm.CrmUri.create($v_2.get_query()["extraqs"]);!IsNull($v_4.get_query()["id"])&&$v_0.setAttribute("sourceUrl",$v_2)}$v_0.style.cursor="pointer";var $v_3=XUI.Html.DomUtils.GetFirstChild($v_0);if(!IsNull($v_3)){$v_3.setAttribute("formTitleText",$v_3.title.toString());$v_3.title=window.LOCID_FORM_HEADER_LINK}$addHandler($v_0,"click",function($p1_0){if(IsNull($v_0.getAttribute("sourceUrl")))Xrm.Utility.openEntityForm(Xrm.Page.data.entity.getEntityName(),Xrm.Page.data.entity.getId(),null);else window.location.replace($v_0.getAttribute("sourceUrl").toString())})}};Mscrm.Details.loadArea=function(selectedNavLink,area,parameters,url,isvMode,passParams){Mscrm.Details.$8();Mscrm.Details.$A();if(!Mscrm.FormNavControl.isNavLinkEnabled(selectedNavLink))return false;var $v_0=$get("tdAreas"),$v_1=XUI.Html.DomUtils.GetFirstChild($v_0);if($v_1.className==="ms-crm-IE7-Height-Fix-Dummy-Container"||$v_1.className==="ms-crm-IE7-Height-Fix-Dummy-Container-ReadForm")$v_0=$v_1;var $v_2=false;if(IsNull(parameters))parameters="";else if(parameters.length>0&&(parameters.charAt(0)==="&"||parameters.charAt(0)==="?"))parameters=parameters.substr(1);if(parameters.length>11){var $v_7=Mscrm.CrmUri.create("areas.aspx?"+parameters);if($v_7.get_query()["refreshmode"]==="1")$v_2=true;delete $v_7.get_query().refreshmode;var $v_8=$v_7.get_queryString();if(!isNullOrEmptyString($v_8))if($v_8.charAt(0)==="&"||$v_8.charAt(0)==="?")$v_8=$v_8.substr(1);parameters=$v_8}if(!Mscrm.Details.currentArea)Mscrm.Details.currentArea=XUI.Html.DomUtils.GetFirstChild($v_0);var $v_3=null,$v_4=function($p1_0){var $v_T=$p1_0;if($v_T.id===area){var $v_U=IsNull($v_T.params)?"":$v_T.params;if($v_U===parameters){$v_3=$v_T;return true}}return false};XUI.Html.DomUtils.ForEachChild($v_0,$v_4);setSelectedControl(null);if(!IsNull($v_3)){if($v_3===Mscrm.Details.currentArea&&!$v_2)return false;Mscrm.Details.$4();Mscrm.Details.currentArea.style.display="none";$v_3.style.display="";if($v_2){var $v_F=XUI.Html.DomUtils.GetFirstChild($v_3);$v_F.contentWindow.location.reload()}var $v_9=Mscrm.Details.$1(Mscrm.Details.currentArea),$v_A=Mscrm.Details.$2(Mscrm.Details.currentArea);if(Mscrm.Details.currentArea.id!=="areaForm"&&$v_A)unloadRibbonData($v_9);else Mscrm.CommandBarData.isInstanceOfType($v_9)&&Mscrm.Details.$3($v_9);var $v_B=Mscrm.Details.$1($v_3),$v_C=window._initialTabId;window._initialTabId=null;var $v_D={};if(!isNullOrEmptyString($v_C))$v_D["initialTabId"]=$v_C;var $v_E=XUI.Html.DomUtils.GetFirstChild($v_3);if(!IsNull($v_E)){var $v_G=$v_E.getAttribute("src");if(!IsNull($v_G)&&!isNullOrEmptyString($v_G.toString()))$v_D["sourceUri"]=$v_G.toString()}loadRibbonData($v_B,$v_D);Mscrm.Details.$C($v_3)}else{var $v_H=Mscrm.Details.$7(parameters),$v_I=true;if(url){url.checkParamsNoEqual=true;if(!url.isEmpty()){var $v_Q=url.toString();$v_H=Mscrm.CrmUri.create($v_Q+($v_Q.indexOf("?")===-1?"?":"&")+parameters);if(!$v_H.get_path().toLowerCase().endsWith("areas.aspx"))$v_I=false}}var $v_J=$get("crmFormSubmit"),$v_K=null;$v_K=isNullOrEmptyString($v_J.crmFormSubmitId.value)?Xrm.Page.data.entity.getId():$v_J.crmFormSubmitId.value;if(IsNull(passParams)||true===passParams){if(!IsNull(isvMode)&&isvMode){$v_H.get_query()["id"]=$v_K;$v_H.get_query()["type"]=$v_J.crmFormSubmitObjectType.value;$v_H.get_query()["typename"]=$v_J.crmFormSubmitObjectTypeName.value}else{$v_H.get_query()["oId"]=$v_K;$v_H.get_query()["oType"]=$v_J.crmFormSubmitObjectType.value;$v_H.get_query()["rof"]=Mscrm.Details.$5().toString()}if(window._IsRefreshForm==="1"){if($v_I)$v_H.get_query()["inlineEdit"]="1";$v_H.get_query()["theme"]=window.RefreshFormTheme}var $v_R=XUI.Html.GetText(selectedNavLink);if($v_I&&!isNullOrEmptyString($v_R))$v_H.get_query()["navItemName"]=$v_R.trim();$v_H.get_query()["security"]=$v_J.crmFormSubmitSecurity.value;$v_H.get_query()["tabSet"]=area;$v_H.get_query()["pagemode"]="iframe";var $v_S=$find("crmFormSelector");if($v_S)$v_H.get_query()["formid"]=$v_S.get_currentFormId()}$v_3=document.createElement("DIV");$v_3.id=area;$v_3.className="ms-crm-Form-Area";if(!IsNull(parameters))$v_3.params=parameters;$v_H.checkParamsNoEqual=true;var $v_L=$v_H.toString();Mscrm.PerformanceTracing.write("Navigate",$v_L);raiseEvent(Mscrm.ScriptEvents.PreserveCurrentIFrame,null,null);var $v_M=CrmEncodeDecode.CrmHtmlAttributeEncode(area),$v_N="100%";$v_3.innerHTML=String.format("<iframe allowTransparency='-1' src='"+CrmEncodeDecode.CrmHtmlAttributeEncode($v_L)+"' id='"+$v_M+"Frame' name='"+$v_M+"Frame' scrolling='auto' isArea='1' frameborder='0' style=\"width: 100%; height: {0}\"></iframe>",$v_N);Mscrm.Details.$4();Mscrm.Details.currentArea.style.display="none";Mscrm.Details.$D($v_0);$v_0.appendChild($v_3);var $v_O=Mscrm.Details.$1(Mscrm.Details.currentArea),$v_P=Mscrm.Details.$2(Mscrm.Details.currentArea);if(Mscrm.Details.currentArea.id!=="areaForm"&&$v_P)unloadRibbonData($v_O);else Mscrm.CommandBarData.isInstanceOfType($v_O)&&Mscrm.Details.$3($v_O)}Mscrm.Details.currentArea=$v_3;Mscrm.Details.resetBreadcrumb(selectedNavLink);var $v_5=$get("_MBdocumentallRelatedInformationPaneExpanddocumentallRelatedInformationPaneLoadContextDatafollowup");if($v_5)$v_5.disabled=area!=="areaForm";var $v_6=XUI.Html.DomUtils.GetFirstChild($v_3);$addHandler($v_6,"load",Mscrm.Details.$B);$addHandler($v_6,"load",Mscrm.Details.$6);return true};Mscrm.Details.$2=function($p0){var $v_0=XUI.Html.DomUtils.GetFirstChild($p0).getAttribute("src"),$v_1=IsNull($v_0)?null:Mscrm.CrmUri.create($v_0.toString()),$v_2=IsNull($v_1)||!IsNull($v_1)&&!$v_1.get_isWebResource()&&$v_1.get_isLocalServer();return $v_2};Mscrm.Details.$4=function(){if(!IsNull(Mscrm.Details.currentArea)){var $v_0=XUI.Html.DomUtils.GetFirstChild(Mscrm.Details.currentArea);if(!IsNull($v_0)&&!IsNull($v_0.contentWindow))try{$v_0.contentWindow.Mscrm.Menu.hideOpenedMenu()}catch($$e_1){}}};Mscrm.Details.$7=function($p0){var $v_0=Mscrm.Utilities.getContentUrl(null);if(Mscrm.Details.$5())return Mscrm.CrmUri.create("/userdefined/areas.aspx?"+$p0);return Mscrm.CrmUri.create("areas.aspx?"+$p0,$v_0.toString())};Mscrm.Details.$5=function(){var $v_0=$get("rofContainer");return !IsNull($v_0)};Mscrm.Details.$C=function($p0){for(var $v_0=$p0.getElementsByTagName("select"),$v_1=0;$v_1<$v_0.length;$v_1++){var $v_2=$v_0[$v_1],$v_3=$v_2.size;$v_2.size=$v_3+2;$v_2.size=$v_3}};Mscrm.Details.$D=function($p0){var $v_0=$get("progress");if(!$v_0){$v_0=document.createElement("DIV");$p0.appendChild($v_0);$v_0.id="progress";var $v_1=window.LOCID_PAGELOADING_MSG;$v_0.innerHTML="<div class='ms-crm-IE7-Height-Fix-Dummy-Container'><TABLE class='ms-crm-Loading-Message' morerecords='0'><TR><TD ID='GridLoadingMessage'><IMG alt='' src='/_imgs/AdvFind/progress.gif'><br>"+CrmEncodeDecode.CrmHtmlEncode($v_1)+"</TD></TR></TABLE></div>";$v_0.className="ms-crm-absolutePosition"}$v_0.style.display="block"};Mscrm.Details.$B=function($p0){var $v_0=$get("progress");if($v_0)$v_0.style.display="none";Mscrm.Details.currentArea.style.display=""};Mscrm.Details.$6=function($p0){var $v_0=$get("areaSPDocuments");if($v_0)if($v_0.style.display!=="none"){var $v_2=$get("areaSPDocumentsFrame");if($v_2){var $v_3=$v_2.contentDocument.getElementById("gridBodyTable");if($v_3){var $v_4=$v_3.getAttribute("folderpath"),$v_5=$v_3.getAttribute("siteNotFound");if($v_5){var $v_6=Mscrm.CrmUri.create("/_grid/cmds/dlg_sharepointsiterror.aspx");$v_6.get_query()["attribSiteError"]=CrmEncodeDecode.CrmUrlEncode($v_5);var $v_7=new Xrm.DialogOptions;$v_7.width=500;$v_7.height=200;Xrm.Internal.openDialog($v_6.toString(),$v_7,null,null,null)}if($v_4){var $v_8=Xrm.Page.data.entity.getId(),$v_9=Xrm.Page.data.entity.getPrimaryAttributeValue(),$v_A=Xrm.Page.context.getQueryStringParameters()["etc"],$v_B=Mscrm.CrmUri.create("/_grid/cmds/dlg_createsharepointfolder.aspx");$v_B.get_query()["folderpath"]=CrmEncodeDecode.CrmUrlEncode($v_4);$v_B.get_query()["objectId"]=$v_8;$v_B.get_query()["oType"]=$v_A;$v_B.get_query()["folderName"]=$v_9;var $v_C=new Xrm.DialogOptions;$v_C.width=500;$v_C.height=200;var $v_D=Mscrm.Details.createFolderCB;Xrm.Internal.openDialog($v_B.toString(),$v_C,null,null,$v_D)}}}}var $v_1=$p0.target;$removeHandler($v_1,"load",Mscrm.Details.$6)};Mscrm.Details.createFolderCB=function(returnValue){var $v_0=returnValue["objType"],$v_1=returnValue["objId"],$v_2=returnValue["folderName"];Xrm.Internal.messages.createFolder($v_2,$v_0,$v_1).then(function(){var $v_3=$get("areaSPDocumentsFrame");$v_3.contentWindow.location.reload()},Mscrm.Details.$9)};Mscrm.Details.$9=function($p0){var $v_0=$p0.get_organizationServiceFault();if(!Mscrm.InternalUtilities.JSTypes.isNull($v_0)){var $v_1=$v_0.get_errorCode();Xrm.Internal.openErrorDialog($v_1,$p0.get_message())}};Mscrm.Details.$1=function($p0){if(!Mscrm.Details.$E($p0)){var $v_0=XUI.Html.DomUtils.GetFirstChild($p0);if(!IsNull($v_0)&&$v_0.tagName.toUpperCase()==="IFRAME")try{return $v_0.contentWindow.$find("crmRibbonData")}catch($$e_2){}}return $find("crmRibbonData")};Mscrm.Details.$3=function($p0){var $v_0=window.top.$find("crmRibbonManager");!IsNull($v_0)&&$v_0.closeAllMenu($p0)};Mscrm.Details.$E=function($p0){return $p0.id==="areaForm"};Mscrm.Details.loadIsvArea=function(selectedNavLink,url,passParams,domEvent){if(passParams)url=addIsvParameters(url);var $v_0=domEvent.target;while(!IsNull($v_0)&&$v_0.tagName!=="A")$v_0=$v_0.parentNode;return Mscrm.Details.loadArea(selectedNavLink,$v_0.id+"Area","",url,true,passParams)};Mscrm.Details.resetBreadcrumb=function(selectedNav){var $v_0=Mscrm.Details.findNavigationComponent(selectedNav,"IMG"),$v_1=Mscrm.Details.findNavigationComponent(selectedNav,"NOBR"),$v_2=$get("leftNavBreadcrumbImg"),$v_3=$get("leftNavBreadcrumbText");if($v_2&&$v_0){$v_2.src=$v_0.src;var $v_4=Mscrm.ImageStrip.getImageStripClassName($v_2);$v_4&&$v_4.length>0&&Sys.UI.DomElement.removeCssClass($v_2,$v_4);var $v_5=Mscrm.ImageStrip.getImageStripClassName($v_0);$v_5&&$v_5.length>0&&Sys.UI.DomElement.addCssClass($v_2,$v_5)}$v_3&&$v_1&&XUI.Html.SetText($v_3,XUI.Html.GetText($v_1))};Mscrm.Details.findNavigationComponent=function(eventSourceElement,elementTagName){var $v_0="A"===eventSourceElement.tagName?eventSourceElement:eventSourceElement.parentNode,$v_1=$v_0.getElementsByTagName(elementTagName)[0];if($v_1)return $v_1;else if(Sys.UI.DomElement.containsCssClass($v_0,"ms-crm-Nav-Subitem-Link")){var $v_2=$v_0.parentNode.parentNode.parentNode.getElementsByTagName("A")[0];if($v_2)return Mscrm.Details.findNavigationComponent($v_2,elementTagName)}return null};Mscrm.Details.registerClass("Mscrm.Details");Mscrm.Details.currentArea=null