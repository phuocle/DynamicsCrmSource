


--
-- base view for Organization
--
create view dbo.[Organization]
 (
    -- logical attributes
    [CreatedByYomiName],
    [ModifiedByYomiName],
    [EntityImage_URL],
    [DefaultEmailServerProfileIdName],
    [CreatedByName],
    [EntityImage],
    [CreatedOnBehalfByYomiName],
    [CreatedOnBehalfByName],
    [EntityImage_Timestamp],
    [AcknowledgementTemplateIdName],
    [ModifiedOnBehalfByYomiName],
    [ModifiedOnBehalfByName],
    [BaseCurrencyIdName],
    [ModifiedByName],

    -- physical attributes
    [OrganizationId],
    [Name],
    [UserGroupId],
    [PrivilegeUserGroupId],
    [RecurrenceExpansionJobBatchSize],
    [RecurrenceExpansionJobBatchInterval],
    [FiscalPeriodType],
    [FiscalCalendarStart],
    [DateFormatCode],
    [TimeFormatCode],
    [CurrencySymbol],
    [WeekStartDayCode],
    [DateSeparator],
    [FullNameConventionCode],
    [NegativeFormatCode],
    [NumberFormat],
    [IsDisabled],
    [DisabledReason],
    [KbPrefix],
    [CurrentKbNumber],
    [CasePrefix],
    [CurrentCaseNumber],
    [ContractPrefix],
    [CurrentContractNumber],
    [QuotePrefix],
    [CurrentQuoteNumber],
    [OrderPrefix],
    [CurrentOrderNumber],
    [InvoicePrefix],
    [CurrentInvoiceNumber],
    [UniqueSpecifierLength],
    [CreatedOn],
    [ModifiedOn],
    [FiscalYearFormat],
    [FiscalPeriodFormat],
    [FiscalYearPeriodConnect],
    [LanguageCode],
    [SortId],
    [DateFormatString],
    [TimeFormatString],
    [PricingDecimalPrecision],
    [ShowWeekNumber],
    [NextTrackingNumber],
    [TagMaxAggressiveCycles],
    [TokenKey],
    [SystemUserId],
    [CreatedBy],
    [GrantAccessToNetworkService],
    [AllowOutlookScheduledSyncs],
    [AllowMarketingEmailExecution],
    [SqlAccessGroupId],
    [CurrencyFormatCode],
    [FiscalSettingsUpdated],
    [ReportingGroupId],
    [TokenExpiry],
    [ShareToPreviousOwnerOnAssign],
    [AcknowledgementTemplateId],
    [ModifiedBy],
    [IntegrationUserId],
    [TrackingTokenIdBase],
    [BusinessClosureCalendarId],
    [AllowAutoUnsubscribeAcknowledgement],
    [AllowAutoUnsubscribe],
    [Picture],
    [VersionNumber],
    [TrackingPrefix],
    [MinOutlookSyncInterval],
    [BulkOperationPrefix],
    [AllowAutoResponseCreation],
    [MaximumTrackingNumber],
    [CampaignPrefix],
    [SqlAccessGroupName],
    [CurrentCampaignNumber],
    [FiscalYearDisplayCode],
    [SiteMapXml],
    [IsRegistered],
    [ReportingGroupName],
    [CurrentBulkOperationNumber],
    [SchemaNamePrefix],
    [IgnoreInternalEmail],
    [TagPollingPeriod],
    [TrackingTokenIdDigits],
    [NumberGroupFormat],
    [LongDateFormatCode],
    [UTCConversionTimeZoneCode],
    [TimeZoneRuleVersionNumber],
    [CurrentImportSequenceNumber],
    [ParsedTablePrefix],
    [V3CalloutConfigHash],
    [IsFiscalPeriodMonthBased],
    [LocaleId],
    [ParsedTableColumnPrefix],
    [SupportUserId],
    [AMDesignator],
    [CurrencyDisplayOption],
    [MinAddressBookSyncInterval],
    [IsDuplicateDetectionEnabledForOnlineCreateUpdate],
    [FeatureSet],
    [BlockedAttachments],
    [IsDuplicateDetectionEnabledForOfflineSync],
    [AllowOfflineScheduledSyncs],
    [AllowUnresolvedPartiesOnEmailSend],
    [TimeSeparator],
    [CurrentParsedTableNumber],
    [MinOfflineSyncInterval],
    [AllowWebExcelExport],
    [ReferenceSiteMapXml],
    [IsDuplicateDetectionEnabledForImport],
    [CalendarType],
    [SQMEnabled],
    [NegativeCurrencyFormatCode],
    [AllowAddressBookSyncs],
    [ISVIntegrationCode],
    [DecimalSymbol],
    [MaxUploadFileSize],
    [IsAppMode],
    [EnablePricingOnCreate],
    [IsSOPIntegrationEnabled],
    [PMDesignator],
    [CurrencyDecimalPrecision],
    [MaxAppointmentDurationDays],
    [EmailSendPollingPeriod],
    [RenderSecureIFrameForEmail],
    [NumberSeparator],
    [PrivReportingGroupId],
    [BaseCurrencyId],
    [MaxRecordsForExportToExcel],
    [PrivReportingGroupName],
    [YearStartWeekCode],
    [IsPresenceEnabled],
    [IsDuplicateDetectionEnabled],
    [ExpireSubscriptionsInDays],
    [IsAuditEnabled],
    [BaseCurrencyPrecision],
    [BaseCurrencySymbol],
    [BaseISOCurrencyCode],
    [NextCustomObjectTypeCode],
    [MaxRecordsForLookupFilters],
    [AllowEntityOnlyAudit],
    [DefaultRecurrenceEndRangeType],
    [FutureExpansionWindow],
    [PastExpansionWindow],
    [RecurrenceExpansionSynchCreateMax],
    [RecurrenceDefaultNumberOfOccurrences],
    [CreatedOnBehalfBy],
    [ModifiedOnBehalfBy],
    [GetStartedPaneContentEnabled],
    [UseReadForm],
    [InitialVersion],
    [SampleDataImportId],
    [ReportScriptErrors],
    [RequireApprovalForUserEmail],
    [RequireApprovalForQueueEmail],
    [GoalRollupExpiryTime],
    [GoalRollupFrequency],
    [FiscalYearFormatPrefix],
    [FiscalYearFormatSuffix],
    [FiscalYearFormatYear],
    [FiscalPeriodFormatPeriod],
    [AllowClientMessageBarAd],
    [AllowUserFormModePreference],
    [HashFilterKeywords],
    [HashMaxCount],
    [HashDeltaSubjectCount],
    [HashMinAddressCount],
    [EnableSmartMatching],
    [PinpointLanguageCode],
    [OrgDbOrgSettings],
    [IsUserAccessAuditEnabled],
    [UserAccessAuditingInterval],
    [QuickFindRecordLimitEnabled],
    [EnableBingMapsIntegration],
    [IsDefaultCountryCodeCheckEnabled],
    [DefaultCountryCode],
    [UseSkypeProtocol],
    [IncomingEmailExchangeEmailRetrievalBatchSize],
    [EmailCorrelationEnabled],
    [MetadataSyncTimestamp],
    [MetadataSyncLastTimeOfNeverExpiredDeletedObjects],
    [YammerOAuthAccessTokenExpired],
    [DefaultEmailSettings],
    [YammerGroupId],
    [YammerNetworkPermalink],
    [YammerPostMethod],
    [EmailConnectionChannel],
    [DefaultEmailServerProfileId],
    [IsAutoSaveEnabled],
    [BingMapsApiKey],
    [GenerateAlertsForErrors],
    [GenerateAlertsForInformation],
    [GenerateAlertsForWarnings],
    [NotifyMailboxOwnerOfEmailServerLevelAlerts],
    [MaximumActiveBusinessProcessFlowsAllowedPerEntity],
    [EntityImageId],
    [AllowUsersSeeAppdownloadMessage],
    [SignupOutlookDownloadFWLink],
    [CascadeStatusUpdate],
    [RestrictStatusUpdate],
    [SuppressSLA],
    [SocialInsightsTermsAccepted],
    [SocialInsightsInstance],
    [DisableSocialCare],
    [IsMailboxInactiveBackoffEnabled],
    [IsMailboxForcedUnlockingEnabled],
    [IsEmailServerProfileContentFilteringEnabled]
) with view_metadata as
select
    -- logical attributes
    [lk_organizationbase_createdby].[YomiFullName],
    [lk_organizationbase_modifiedby].[YomiFullName],
    [lk_organization_entityimage].[ImageURL],
    [EmailServerProfile_Organization].[Name],
    [lk_organizationbase_createdby].[FullName],
    [lk_organization_entityimage].[ImageData],
    [lk_organizationbase_createdonbehalfby].[YomiFullName],
    [lk_organizationbase_createdonbehalfby].[FullName],
    [lk_organization_entityimage].[ImageTimestamp],
    [Template_Organization].[Title],
    [lk_organizationbase_modifiedonbehalfby].[YomiFullName],
    [lk_organizationbase_modifiedonbehalfby].[FullName],
    [basecurrency_organization].[CurrencyName],
    [lk_organizationbase_modifiedby].[FullName],

    -- physical attribute
    [OrganizationBase].[OrganizationId],
    [OrganizationBase].[Name],
    [OrganizationBase].[UserGroupId],
    [OrganizationBase].[PrivilegeUserGroupId],
    [OrganizationBase].[RecurrenceExpansionJobBatchSize],
    [OrganizationBase].[RecurrenceExpansionJobBatchInterval],
    [OrganizationBase].[FiscalPeriodType],
    [OrganizationBase].[FiscalCalendarStart],
    [OrganizationBase].[DateFormatCode],
    [OrganizationBase].[TimeFormatCode],
    [OrganizationBase].[CurrencySymbol],
    [OrganizationBase].[WeekStartDayCode],
    [OrganizationBase].[DateSeparator],
    [OrganizationBase].[FullNameConventionCode],
    [OrganizationBase].[NegativeFormatCode],
    [OrganizationBase].[NumberFormat],
    [OrganizationBase].[IsDisabled],
    [OrganizationBase].[DisabledReason],
    [OrganizationBase].[KbPrefix],
    [OrganizationBase].[CurrentKbNumber],
    [OrganizationBase].[CasePrefix],
    (SELECT CAST(current_value as int) + 1 FROM sys.sequences WHERE name = 'SO_currentcasenumber') as [CurrentCaseNumber],
    [OrganizationBase].[ContractPrefix],
    [OrganizationBase].[CurrentContractNumber],
    [OrganizationBase].[QuotePrefix],
    [OrganizationBase].[CurrentQuoteNumber],
    [OrganizationBase].[OrderPrefix],
    [OrganizationBase].[CurrentOrderNumber],
    [OrganizationBase].[InvoicePrefix],
    [OrganizationBase].[CurrentInvoiceNumber],
    [OrganizationBase].[UniqueSpecifierLength],
    [OrganizationBase].[CreatedOn],
    [OrganizationBase].[ModifiedOn],
    [OrganizationBase].[FiscalYearFormat],
    [OrganizationBase].[FiscalPeriodFormat],
    [OrganizationBase].[FiscalYearPeriodConnect],
    [OrganizationBase].[LanguageCode],
    [OrganizationBase].[SortId],
    [OrganizationBase].[DateFormatString],
    [OrganizationBase].[TimeFormatString],
    [OrganizationBase].[PricingDecimalPrecision],
    [OrganizationBase].[ShowWeekNumber],
 
CASE 
WHEN (SELECT CAST(current_value as int) FROM sys.sequences WHERE name = 'SO_NextEmailTrackingNumber') < MaximumTrackingNumber THEN  (SELECT CAST(current_value as int) + 1 FROM sys.sequences WHERE name = 'SO_NextEmailTrackingNumber') 
ELSE 0
END as [NextTrackingNumber],    [OrganizationBase].[TagMaxAggressiveCycles],
    [OrganizationBase].[TokenKey],
    [OrganizationBase].[SystemUserId],
    [OrganizationBase].[CreatedBy],
    [OrganizationBase].[GrantAccessToNetworkService],
    [OrganizationBase].[AllowOutlookScheduledSyncs],
    [OrganizationBase].[AllowMarketingEmailExecution],
    [OrganizationBase].[SqlAccessGroupId],
    [OrganizationBase].[CurrencyFormatCode],
    [OrganizationBase].[FiscalSettingsUpdated],
    [OrganizationBase].[ReportingGroupId],
    [OrganizationBase].[TokenExpiry],
    [OrganizationBase].[ShareToPreviousOwnerOnAssign],
    [OrganizationBase].[AcknowledgementTemplateId],
    [OrganizationBase].[ModifiedBy],
    [OrganizationBase].[IntegrationUserId],
    [OrganizationBase].[TrackingTokenIdBase],
    [OrganizationBase].[BusinessClosureCalendarId],
    [OrganizationBase].[AllowAutoUnsubscribeAcknowledgement],
    [OrganizationBase].[AllowAutoUnsubscribe],
    [OrganizationBase].[Picture],
    [OrganizationBase].[VersionNumber],
    [OrganizationBase].[TrackingPrefix],
    [OrganizationBase].[MinOutlookSyncInterval],
    [OrganizationBase].[BulkOperationPrefix],
    [OrganizationBase].[AllowAutoResponseCreation],
    [OrganizationBase].[MaximumTrackingNumber],
    [OrganizationBase].[CampaignPrefix],
    [OrganizationBase].[SqlAccessGroupName],
    [OrganizationBase].[CurrentCampaignNumber],
    [OrganizationBase].[FiscalYearDisplayCode],
    [OrganizationBase].[SiteMapXml],
    [OrganizationBase].[IsRegistered],
    [OrganizationBase].[ReportingGroupName],
    [OrganizationBase].[CurrentBulkOperationNumber],
    [OrganizationBase].[SchemaNamePrefix],
    [OrganizationBase].[IgnoreInternalEmail],
    [OrganizationBase].[TagPollingPeriod],
    [OrganizationBase].[TrackingTokenIdDigits],
    [OrganizationBase].[NumberGroupFormat],
    [OrganizationBase].[LongDateFormatCode],
    [OrganizationBase].[UTCConversionTimeZoneCode],
    [OrganizationBase].[TimeZoneRuleVersionNumber],
    [OrganizationBase].[CurrentImportSequenceNumber],
    [OrganizationBase].[ParsedTablePrefix],
    [OrganizationBase].[V3CalloutConfigHash],
    [OrganizationBase].[IsFiscalPeriodMonthBased],
    [OrganizationBase].[LocaleId],
    [OrganizationBase].[ParsedTableColumnPrefix],
    [OrganizationBase].[SupportUserId],
    [OrganizationBase].[AMDesignator],
    [OrganizationBase].[CurrencyDisplayOption],
    [OrganizationBase].[MinAddressBookSyncInterval],
    [OrganizationBase].[IsDuplicateDetectionEnabledForOnlineCreateUpdate],
    [OrganizationBase].[FeatureSet],
    [OrganizationBase].[BlockedAttachments],
    [OrganizationBase].[IsDuplicateDetectionEnabledForOfflineSync],
    [OrganizationBase].[AllowOfflineScheduledSyncs],
    [OrganizationBase].[AllowUnresolvedPartiesOnEmailSend],
    [OrganizationBase].[TimeSeparator],
    [OrganizationBase].[CurrentParsedTableNumber],
    [OrganizationBase].[MinOfflineSyncInterval],
    [OrganizationBase].[AllowWebExcelExport],
    [OrganizationBase].[ReferenceSiteMapXml],
    [OrganizationBase].[IsDuplicateDetectionEnabledForImport],
    [OrganizationBase].[CalendarType],
    [OrganizationBase].[SQMEnabled],
    [OrganizationBase].[NegativeCurrencyFormatCode],
    [OrganizationBase].[AllowAddressBookSyncs],
    [OrganizationBase].[ISVIntegrationCode],
    [OrganizationBase].[DecimalSymbol],
    [OrganizationBase].[MaxUploadFileSize],
    [OrganizationBase].[IsAppMode],
    [OrganizationBase].[EnablePricingOnCreate],
    [OrganizationBase].[IsSOPIntegrationEnabled],
    [OrganizationBase].[PMDesignator],
    [OrganizationBase].[CurrencyDecimalPrecision],
    [OrganizationBase].[MaxAppointmentDurationDays],
    [OrganizationBase].[EmailSendPollingPeriod],
    [OrganizationBase].[RenderSecureIFrameForEmail],
    [OrganizationBase].[NumberSeparator],
    [OrganizationBase].[PrivReportingGroupId],
    [OrganizationBase].[BaseCurrencyId],
    [OrganizationBase].[MaxRecordsForExportToExcel],
    [OrganizationBase].[PrivReportingGroupName],
    [OrganizationBase].[YearStartWeekCode],
    [OrganizationBase].[IsPresenceEnabled],
    [OrganizationBase].[IsDuplicateDetectionEnabled],
    [OrganizationBase].[ExpireSubscriptionsInDays],
    [OrganizationBase].[IsAuditEnabled],
    [OrganizationBase].[BaseCurrencyPrecision],
    [OrganizationBase].[BaseCurrencySymbol],
    [OrganizationBase].[BaseISOCurrencyCode],
    [OrganizationBase].[NextCustomObjectTypeCode],
    [OrganizationBase].[MaxRecordsForLookupFilters],
    [OrganizationBase].[AllowEntityOnlyAudit],
    [OrganizationBase].[DefaultRecurrenceEndRangeType],
    [OrganizationBase].[FutureExpansionWindow],
    [OrganizationBase].[PastExpansionWindow],
    [OrganizationBase].[RecurrenceExpansionSynchCreateMax],
    [OrganizationBase].[RecurrenceDefaultNumberOfOccurrences],
    [OrganizationBase].[CreatedOnBehalfBy],
    [OrganizationBase].[ModifiedOnBehalfBy],
    [OrganizationBase].[GetStartedPaneContentEnabled],
    [OrganizationBase].[UseReadForm],
    [OrganizationBase].[InitialVersion],
    [OrganizationBase].[SampleDataImportId],
    [OrganizationBase].[ReportScriptErrors],
    [OrganizationBase].[RequireApprovalForUserEmail],
    [OrganizationBase].[RequireApprovalForQueueEmail],
    [OrganizationBase].[GoalRollupExpiryTime],
    [OrganizationBase].[GoalRollupFrequency],
    [OrganizationBase].[FiscalYearFormatPrefix],
    [OrganizationBase].[FiscalYearFormatSuffix],
    [OrganizationBase].[FiscalYearFormatYear],
    [OrganizationBase].[FiscalPeriodFormatPeriod],
    [OrganizationBase].[AllowClientMessageBarAd],
    [OrganizationBase].[AllowUserFormModePreference],
    [OrganizationBase].[HashFilterKeywords],
    [OrganizationBase].[HashMaxCount],
    [OrganizationBase].[HashDeltaSubjectCount],
    [OrganizationBase].[HashMinAddressCount],
    [OrganizationBase].[EnableSmartMatching],
    [OrganizationBase].[PinpointLanguageCode],
    [OrganizationBase].[OrgDbOrgSettings],
    [OrganizationBase].[IsUserAccessAuditEnabled],
    [OrganizationBase].[UserAccessAuditingInterval],
    [OrganizationBase].[QuickFindRecordLimitEnabled],
    [OrganizationBase].[EnableBingMapsIntegration],
    [OrganizationBase].[IsDefaultCountryCodeCheckEnabled],
    [OrganizationBase].[DefaultCountryCode],
    [OrganizationBase].[UseSkypeProtocol],
    [OrganizationBase].[IncomingEmailExchangeEmailRetrievalBatchSize],
    [OrganizationBase].[EmailCorrelationEnabled],
    [OrganizationBase].[MetadataSyncTimestamp],
    [OrganizationBase].[MetadataSyncLastTimeOfNeverExpiredDeletedObjects],
    [OrganizationBase].[YammerOAuthAccessTokenExpired],
    [OrganizationBase].[DefaultEmailSettings],
    [OrganizationBase].[YammerGroupId],
    [OrganizationBase].[YammerNetworkPermalink],
    [OrganizationBase].[YammerPostMethod],
    [OrganizationBase].[EmailConnectionChannel],
    [OrganizationBase].[DefaultEmailServerProfileId],
    [OrganizationBase].[IsAutoSaveEnabled],
    [OrganizationBase].[BingMapsApiKey],
    [OrganizationBase].[GenerateAlertsForErrors],
    [OrganizationBase].[GenerateAlertsForInformation],
    [OrganizationBase].[GenerateAlertsForWarnings],
    [OrganizationBase].[NotifyMailboxOwnerOfEmailServerLevelAlerts],
    [OrganizationBase].[MaximumActiveBusinessProcessFlowsAllowedPerEntity],
    [OrganizationBase].[EntityImageId],
    [OrganizationBase].[AllowUsersSeeAppdownloadMessage],
    [OrganizationBase].[SignupOutlookDownloadFWLink],
    [OrganizationBase].[CascadeStatusUpdate],
    [OrganizationBase].[RestrictStatusUpdate],
    [OrganizationBase].[SuppressSLA],
    [OrganizationBase].[SocialInsightsTermsAccepted],
    [OrganizationBase].[SocialInsightsInstance],
    [OrganizationBase].[DisableSocialCare],
    [OrganizationBase].[IsMailboxInactiveBackoffEnabled],
    [OrganizationBase].[IsMailboxForcedUnlockingEnabled],
    [OrganizationBase].[IsEmailServerProfileContentFilteringEnabled]
from [OrganizationBase] 
    left join [TransactionCurrencyBase] [basecurrency_organization] on ([OrganizationBase].[BaseCurrencyId] = [basecurrency_organization].[TransactionCurrencyId])
    left join [EmailServerProfileBase] [EmailServerProfile_Organization] on ([OrganizationBase].[DefaultEmailServerProfileId] = [EmailServerProfile_Organization].[EmailServerProfileId])
    left join [ImageDescriptor] [lk_organization_entityimage] on ([OrganizationBase].[EntityImageId] = [lk_organization_entityimage].[ImageDescriptorId])
    left join [SystemUserBase] [lk_organizationbase_createdby] with(nolock) on ([OrganizationBase].[CreatedBy] = [lk_organizationbase_createdby].[SystemUserId])
    left join [SystemUserBase] [lk_organizationbase_createdonbehalfby] with(nolock) on ([OrganizationBase].[CreatedOnBehalfBy] = [lk_organizationbase_createdonbehalfby].[SystemUserId])
    left join [SystemUserBase] [lk_organizationbase_modifiedby] with(nolock) on ([OrganizationBase].[ModifiedBy] = [lk_organizationbase_modifiedby].[SystemUserId])
    left join [SystemUserBase] [lk_organizationbase_modifiedonbehalfby] with(nolock) on ([OrganizationBase].[ModifiedOnBehalfBy] = [lk_organizationbase_modifiedonbehalfby].[SystemUserId])
    left join [TemplateBase] [Template_Organization] on ([OrganizationBase].[AcknowledgementTemplateId] = [Template_Organization].[TemplateId] and [Template_Organization].OverwriteTime = 0 and [Template_Organization].ComponentState = 0)
